window.__require=function e(t,a,i){function n(o,s){if(!a[o]){if(!t[o]){var p=o.split("/");if(p=p[p.length-1],!t[p]){var c="function"==typeof __require&&__require;if(!s&&c)return c(p,!0);if(r)return r(p,!0);throw new Error("Cannot find module '"+o+"'")}o=p}var h=a[o]={exports:{}};t[o][0].call(h.exports,function(e){return n(t[o][1][e]||e)},h,h.exports,e,t,a,i)}return a[o].exports}for(var r="function"==typeof __require&&__require,o=0;o<i.length;o++)n(i[o]);return n}({ActivityCornucopia:[function(e,t){"use strict";cc._RF.push(t,"a89d0qtW45CR58aDHngGU8W","ActivityCornucopia");var a,i,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),r=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},o=cc._decorator,s=o.ccclass,p=o.property,c=e("basePage"),h=e("../lang/langMgr");(function(e){e[e.Input=0]="Input",e[e.Reward=1]="Reward"})(i||(i={}));var l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.btnOperate=null,t.spBtnFrame=null,t.labBonus=null,t.labEstate=null,t.btnTxtFrames=[],t.labTime=null,t.spCornucopia=null,t._btnState=i.Input,t._sTime=0,t._eTime=0,t}var a;return n(t,e),a=t,t.prototype.onLoad=function(){var e=this;a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0,200),this.handleUI(),this.addUIEvent(),this.spCornucopia.setCompleteListener(function(){cc.isValid(e)&&(e.spCornucopia.node.active=!1)})},t.prototype.setParam=function(){this.renderView()},t.prototype.addUIEvent=function(){var e=this;this.btnOperate.node.on("click",function(){if(app.playSound("click"),e._btnState===i.Input){if(app.player.getCount("30086")<=0)return app.showNotice(h.getString("activityLuxuryGifts",2)),void app.pages.windowspagesource.showPage("30086");app.player.sfActivityJbpReward({rwid:"proitem1",time:app.player.getCount("30086")}).then(function(t){app.player.addItem(t.items),app.player.reduceItem(t.castitems),cc.isValid(e)&&(e.spCornucopia.node.active=!0,app.playSound("jbp_input"),e.spCornucopia.setAnimation(0,"Atouchofgold",!1),e.renderView())}).catch(function(e){cc.warn("\u805a\u5b9d\u76c6\u4e00\u952e\u6295\u5165\u9519\u8bef:",e)})}else if(e._btnState===i.Reward){if(app.player.getCount("90589")<=0)return void app.showNotice(h.getString("activityLuxuryGifts",3));app.player.sfActivityJbpReward({rwid:"proitem2",time:app.player.getCount("90589")}).then(function(t){app.player.addItem(t.items),app.player.reduceItem(t.castitems);var a={showtype:1,reward:t.items};e.scheduleOnce(function(){app.pages.windowspagereward.showPage(a)},1),cc.isValid(e)&&(e.spCornucopia.node.active=!0,app.playSound("jbp_harvest"),e.spCornucopia.setAnimation(0,"HarvestYuanbao",!1),e.renderView())}).catch(function(e){cc.warn("\u805a\u5b9d\u76c6\u4e00\u952e\u9886\u53d6\u9519\u8bef:",e)})}},this)},t.prototype.renderView=function(){this.labBonus.string=""+app.player.getCount("90589"),this.labEstate.string=""+app.player.getCount("30086");var e=app.arrZhdTime.JBP;if(!e)return cc.warn("\u805a\u5b9d\u76c6\u6d3b\u52a8\u4fe1\u606f\u7f3a\u5931"),void this.onClose();this._sTime=e.time[0],this._eTime=e.time[1],this.labTime.string=gUtils.dateFormatter(h.getString("activityLuxuryGifts",1),this._sTime)+"-"+gUtils.dateFormatter(""+h.getString("activityLuxuryGifts",1),this._eTime);var t=JSON.parse(e.expand).REWARD_TIME;app.player.getCount("30086")>0||app.player.getServerTime()<t?this._btnState=i.Input:(this._btnState=i.Reward,app.setNodeState(this.btnOperate.node,app.player.getCount("90589")<=0)),this.spBtnFrame.spriteFrame=this.btnTxtFrames[this._btnState]},t.prototype.onDestroy=function(){e.prototype.onDestroy&&e.prototype.onDestroy.call(this),this.spCornucopia.setCompleteListener(null)},t.prefabPath="activityCornucopia",t.pageType=1,t.isOpen=function(){var e=app.player.getServerTime(),t=gUtils.getActivityArrTime("JBP");return e>=t[0]&&e<=t[1]},r([p(cc.Button)],t.prototype,"btnOperate",void 0),r([p(cc.Sprite)],t.prototype,"spBtnFrame",void 0),r([p(cc.Label)],t.prototype,"labBonus",void 0),r([p(cc.Label)],t.prototype,"labEstate",void 0),r([p({type:[cc.SpriteFrame]})],t.prototype,"btnTxtFrames",void 0),r([p(cc.Label)],t.prototype,"labTime",void 0),r([p(sp.Skeleton)],t.prototype,"spCornucopia",void 0),a=r([s],t)}(c);t.exports=l,cc._RF.pop()},{"../lang/langMgr":void 0,basePage:void 0}],ActivityHydtPage:[function(e,t){"use strict";cc._RF.push(t,"9d696xUXTdFHqhOZ83+yERH","ActivityHydtPage");var a,i,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),r=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},o=cc._decorator,s=o.ccclass,p=o.property,c=e("basePage"),h=e("langMgr");(function(e){e[e.Info=0]="Info",e[e.RedPacket=1]="RedPacket"})(i||(i={}));var l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.boards=[],t._packetId=0,t}var a;return n(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0,200),this.handleUI()},t.prototype.setParam=function(e){this.boards.forEach(function(t,a){return t.active=e.pageType===a}),e.pageType===i.RedPacket&&(this._packetId=e.redPacketId,this.addUIEvent())},t.prototype.addUIEvent=function(){var e=this;this.boards[i.RedPacket].on(cc.Node.EventType.TOUCH_END,function(){app.player.sfGetHydtReward({id:e._packetId}).then(function(t){var a={showtype:1,reward:t};app.player.addItem(t),cc.isValid(app.mainScene)&&app.mainScene.refreshCoin(),app.pages.windowspagereward.showPage(a),eventMgr.emit(eventStr.xchd.REFRESH_RED_PACKET),cc.isValid(e)&&e.onClose()}).catch(function(e){"invalid id"===e&&app.showNotice(h.getString("ActivityHydtPage",0)),cc.warn("\u9886\u53d6\u7ea2\u5305\u9519\u8bef:",e)})},this)},t.prefabPath="activityHydtPage",t.pageType=1,t.isOpen=function(){var e=app.player.getServerTime(),t=gUtils.getActivityArrTime("HYDT");return e>=t[0]&&e<=t[1]},r([p([cc.Node])],t.prototype,"boards",void 0),a=r([s],t)}(c);t.exports=l,cc._RF.pop()},{basePage:void 0,langMgr:void 0}],ActivityLuxuryGifts:[function(e,t){"use strict";cc._RF.push(t,"4ddb4WCpJhD8pNOrrUOk4TH","ActivityLuxuryGifts");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=cc._decorator,o=r.ccclass,s=r.property,p=e("basePage"),c=e("../lang/langMgr"),h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.cellContent=null,t.labTime=null,t.signCellTemp=null,t._dayCount=0,t._rewardObject=null,t._sTime=0,t._eTime=0,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0,200),this.handleUI()},t.prototype.setParam=function(e){this._rewardObject=e.reward,this._sTime=e.start,this._eTime=e.eTime,this.renderView()},t.prototype.renderView=function(){this._dayCount=Object.keys(this._rewardObject).length;for(var e=0;e<this._dayCount;++e){var t=this._rewardObject["DAY"+(e+1)];if(t){var a=void 0;0===e?a=this.signCellTemp:(a=cc.instantiate(this.signCellTemp)).parent=this.cellContent,a.getComponent("ActivityLuxuryGiftsItem").renderCell({reward:t,index:e})}}this.labTime.string=""+c.getString("activityLuxuryGifts",0)+gUtils.dateFormatter(c.getString("activityLuxuryGifts",1),this._sTime)+"-"+gUtils.dateFormatter(""+c.getString("activityLuxuryGifts",1),this._eTime)},t.prototype.addEvent=function(){var e=this;cc.director.on("EVT_REDRAW_VIEW",function(){app.player.sfActivatyXcflInfo().then(function(t){cc.isValid(e)&&e.setParam({reward:t.params.reward,start:e._sTime,eTime:e._eTime})}).catch(function(t){cc.warn("\u65b0\u6625\u8c6a\u793c err: ",t),e.onClose()})},this)},t.prototype.removeEvent=function(){cc.director.targetOff(this)},t.prototype.onDestroy=function(){e.prototype.onDestroy&&e.prototype.onDestroy.call(this),this.removeEvent()},t.prefabPath="activityLuxuryGifts",t.pageType=1,t.refreshRed=function(e){var t=!1;return app.arrZhdTime&&app.arrZhdTime.XCFL&&(t=app.arrZhdTime.XCFL.canget>0),cc.isValid(e)&&(e.active=t),t},t.isOpen=function(){var e=app.player.getServerTime(),t=gUtils.getActivityArrTime("XCFL");return e>=t[0]&&e<=t[1]},n([s(cc.Node)],t.prototype,"cellContent",void 0),n([s(cc.Label)],t.prototype,"labTime",void 0),n([s(cc.Node)],t.prototype,"signCellTemp",void 0),a=n([o],t)}(p);t.exports=h,cc._RF.pop()},{"../lang/langMgr":void 0,basePage:void 0}],ActivityRebatePage:[function(e,t){"use strict";cc._RF.push(t,"e581bvy2l9OlJV7OItGqgJk","ActivityRebatePage");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=e("../lang/langMgr"),o=cc._decorator,s=o.ccclass,p=o.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.labRebate=null,t.btnPreview=null,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.btnPreview.node.on("click",function(){var e={gsid:30999,count:app.player.getCount(30999)};app.showPropTips(e)},this)},t.prototype.setParam=function(){this.labRebate.string=r.getString("ActivityRebatePage",0,app.player.getCount(90222))},t.prefabPath="activityRebatePage",t.pageType=1,n([p(cc.Label)],t.prototype,"labRebate",void 0),n([p(cc.Button)],t.prototype,"btnPreview",void 0),a=n([s],t)}(e("basePage"));t.exports=c,cc._RF.pop()},{"../lang/langMgr":void 0,basePage:void 0}],ActivityRebateProcessPage:[function(e,t){"use strict";cc._RF.push(t,"95111HIPA1Nm52OXXTKn3vV","ActivityRebateProcessPage");var a,i,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),r=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},o=cc._decorator,s=o.ccclass,p=o.property,c=e("basePage");(function(e){e[e.NoRebate=-1]="NoRebate",e[e.Unreceived=0]="Unreceived",e[e.ReceivedEnough=1]="ReceivedEnough",e[e.ReceivedNoEnough=2]="ReceivedNoEnough"})(i||(i={}));var h=["\u606d\u559c\u4e3b\u516c\u901a\u8fc7\u9a8c\u8bc1\uff0c\u8bf7\u9886\u53d6\u4ee5\u4e0b\u300a\u519b\u5e08\u8bf7\u5e03\u9635\u300b\u5c01\u6d4b\u5145\u503c\u8fd4\u5229\uff01","\u73b0\u91d1\u5238\u53ef\u4ee5\u7528\u4e8e\u5728\u6e38\u620f\u4e2d\u8d2d\u4e70\u6240\u6709\u5145\u503c\u4ed8\u8d39\u5185\u5bb9\uff01","\u60a8\u7684\u73b0\u91d1\u5238\u4e0d\u8db36\u5143\uff0c\u6211\u4eec\u8d34\u5fc3\u7684\u4e3a\u4e3b\u516c\u51c6\u5907\u4e86-\u5143\u793c\u5305\u4f9b\u60a8\u6d88\u8d39\uff01"],l=[{GSID:38006,COUNT:15e4}],g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.labRoleLines=null,t.labRebateValue=null,t.btnGet=null,t.spBtnTxt=null,t.btnTxtFrames=[],t.propContainer=null,t.spTitle=null,t.titleFrames=[],t.stepLayers=[],t.labSurplusCount=null,t._curState=i.NoRebate,t._rewards=[],t}var a;return n(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.addUIEvent()},t.prototype.setParam=function(e){var t=this;this._curState=e.state-1,this._rewards=e.rewards||[];var a=e.amount;if(this._curState===i.ReceivedEnough){var n=app.player.getCount(30999);this._rewards=[{GSID:30999,COUNT:n}],this._curState=n>=6?i.ReceivedEnough:i.ReceivedNoEnough}switch(this._curState){case i.NoRebate:var r=app.mainScene.p_btnRechargeRebate;return cc.isValid(r)&&r.node.active&&(r.node.active=!1),this.onClose();case i.Unreceived:this.labRebateValue.string=a+"\u5143";break;case i.ReceivedEnough:break;case i.ReceivedNoEnough:var o=app.player.getCount(30999);if(this.labSurplusCount.string=o+"\u5143",this._rewards=l,o<1){this.btnGet.interactable=!1,app.setNodeState(this.btnGet.node,!0);var s=app.mainScene.p_btnRechargeRebate;cc.isValid(s)&&s.node.active&&(s.node.active=!1)}}this.propContainer.children.forEach(function(e,a){e.active=Boolean(t._rewards[a]),t._rewards[a]&&(e.getComponent("propItem").initForRebate(t._rewards[a]),e.getComponent("propItem").setClick(!0))}),this.labRoleLines.string=h[this._curState],this.spTitle.spriteFrame=this.titleFrames[this._curState],this.spBtnTxt.spriteFrame=this.btnTxtFrames[this._curState],this.stepLayers.forEach(function(e,a){return e.active=a===t._curState})},t.prototype.addUIEvent=function(){var e=this;this.btnGet.node.on("click",function(){switch(app.playSound("click"),e._curState){case i.Unreceived:app.pages.windowsPageTipsRebate.showPage({rewards:e._rewards}),e.onClose();break;case i.ReceivedEnough:app.goToPage(1042);break;case i.ReceivedNoEnough:app.player.sfExchange("recharge_rebate",1,0,function(){app.pages.windowspagereward.showPage({showtype:1,reward:l}),e._refreshView()})}},this)},t.prototype._refreshView=function(){if(this._curState===i.ReceivedNoEnough){var e=app.player.getCount(30999);if(this.labSurplusCount.string=e+"\u5143",e<1){this.onClose();var t=app.mainScene.p_btnRechargeRebate;cc.isValid(t)&&t.node.active&&(t.node.active=!1)}}},t.prefabPath="activityRebateProcessPage",t.pageType=1,r([p(cc.Label)],t.prototype,"labRoleLines",void 0),r([p(cc.Label)],t.prototype,"labRebateValue",void 0),r([p(cc.Button)],t.prototype,"btnGet",void 0),r([p(cc.Sprite)],t.prototype,"spBtnTxt",void 0),r([p([cc.SpriteFrame])],t.prototype,"btnTxtFrames",void 0),r([p(cc.Node)],t.prototype,"propContainer",void 0),r([p(cc.Sprite)],t.prototype,"spTitle",void 0),r([p({type:[cc.SpriteFrame]})],t.prototype,"titleFrames",void 0),r([p([cc.Node])],t.prototype,"stepLayers",void 0),r([p(cc.Label)],t.prototype,"labSurplusCount",void 0),a=r([s],t)}(c);t.exports=g,cc._RF.pop()},{basePage:void 0}],ActivityZHDPageSoul:[function(e,t){"use strict";cc._RF.push(t,"01709j0hhtCN4sU29q4QQnk","ActivityZHDPageSoul");var a,i,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),r=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},o=e("../lang/langMgr"),s=cc._decorator,p=s.ccclass,c=s.property,h=e("basePage");(function(e){e[e.Unreceived=0]="Unreceived",e[e.Received=1]="Received"})(i||(i={}));var l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.btnFreeUse=null,t.timeLabel=null,t.activityHero=null,t.txtSp=null,t.btnTxtFrames=[],t.srcGeneral=null,t.dstGeneral=null,t.btnHelp=null,t.ropeAnim=null,t.lightAnim=null,t.lightFrames=[],t.bindGsid="",t.rewardState=i.Unreceived,t.soulHeroGuid="",t.eTime=0,t}var a;return n(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.schedule(this.dealTime,1)},t.prototype.start=function(){this.addUIEvent()},t.prototype.addUIEvent=function(){var e=this;this.btnFreeUse.on("click",function(){if(window.app.playSound("click"),window.app.player.getServerTime()>e.eTime)return window.app.showNotice(o.getString("ActivityZHDPageSoul",0)),void e.onClose();e.rewardState===i.Unreceived?e.gotoGeneralReward():e.gotoSoulBinding()},this),this.btnHelp.on("click",function(){window.app.playSound("click"),window.app.pages.windowspagetipshelp.showPage("1066")},this),this.ropeAnim.getComponent(sp.Skeleton).setCompleteListener(function(t){"1"==t.animation.name&&e.playRopeStandbyAnim()})},t.prototype.setParam=function(e){this.initUI(e)},t.prototype.initUI=function(e){this.bindGsid=e.reward.GSID,this.eTime=e.eTime,this.soulHeroGuid=e.bindGuid;var t=this.bindGsid;this.rewardState=this.soulHeroGuid?i.Received:i.Unreceived,this.srcGeneral.getComponent("generalPortraitItem").initForTips({gsid:t,level:"1\u7ea7"}),this.dstGeneral.getComponent("generalPortraitItem").initForTips({gsid:"12049",level:"1\u7ea7"});var a=this.btnTxtFrames[this.rewardState];this.txtSp.spriteFrame=a,this.playLightAnim(),this.scheduleOnce(this.playRopeMoveAnim,1.15),this.scheduleOnce(this.playShakeAction,1.2),this.scheduleOnce(this.playFrameAction,1.2)},t.prototype.refreshUI=function(){this.rewardState=this.soulHeroGuid?i.Received:i.Unreceived;var e=this.btnTxtFrames[this.rewardState];this.txtSp.spriteFrame=e,this.playLightAnim(),this.scheduleOnce(this.playRopeMoveAnim,1.15),this.scheduleOnce(this.playShakeAction,1.2),this.scheduleOnce(this.playFrameAction,1.2)},t.prototype.gotoGeneralReward=function(){var e=this;window.app.player.sfGetSoulBindReward(function(t,a){if(t){switch(t){case"already received":t=o.getString("ActivityZHDPageSoul",1);break;case"nmore bag":t=o.getString("ActivityZHDPageSoul",2);break;case"finished":t=o.getString("ActivityZHDPageSoul",3)}return window.app.showNotice(t),void e.onClose()}var i=a.general;window.app.player.addGeneral([i]),window.app.player.addItem(a.items),e.soulHeroGuid=i.guid,window.app.pages.windowspagerewardgeneral.showPage({gsid:i.gsid,confirmcb:function(){cc.isValid(e)&&e.refreshUI()},target:e})})},t.prototype.gotoSoulBinding=function(){return this.soulHeroGuid?window.app.player.general[this.soulHeroGuid]?(window.app.pages.generalSoulBindingPage.showPage({guid:this.soulHeroGuid}),void this.onClose()):cc.warn("\u6b66\u5c06guid\u9519\u8bef\u6216\u5df2\u8fc7\u671f"):cc.log("=== soulHeroGuid is invalid ===")},t.prototype.dealTime=function(){if(!this.eTime)return this.unschedule(this.dealTime);var e=app.player.getServerTime(),t=this.eTime-e>0?this.eTime-e:0;return this.timeLabel.string=gUtils.getCountDownStr(t),""},t.prototype.playRopeMoveAnim=function(){this.ropeAnim.active=!0,this.ropeAnim.getComponent(sp.Skeleton).setAnimation(0,"1",!1)},t.prototype.playRopeStandbyAnim=function(){this.ropeAnim.active=!0,this.ropeAnim.getComponent(sp.Skeleton).setAnimation(0,"2",!0)},t.prototype.playLightAnim=function(){this.lightAnim.active=!0,this.lightAnim.getComponent(sp.Skeleton).setAnimation(0,"animation",!1)},t.prototype.playFrameAction=function(){this.lightFrames.forEach(function(e){e.opacity=0,e.runAction(cc.fadeIn(.4))})},t.prototype.playShakeAction=function(){var e=cc.moveBy(.1,cc.v2(8,0)),t=cc.moveBy(.1,cc.v2(-13,0)),a=cc.moveBy(.1,cc.v2(5,0)),i=cc.sequence(e,t,a);this.dstGeneral.runAction(i)},t.prefabPath="activityZHDPageSoul",t.pageType=1,r([c({type:cc.Node})],t.prototype,"btnFreeUse",void 0),r([c(cc.Label)],t.prototype,"timeLabel",void 0),r([c(cc.Node)],t.prototype,"activityHero",void 0),r([c({type:cc.Sprite})],t.prototype,"txtSp",void 0),r([c({type:[cc.SpriteFrame]})],t.prototype,"btnTxtFrames",void 0),r([c({type:cc.Node})],t.prototype,"srcGeneral",void 0),r([c({type:cc.Node})],t.prototype,"dstGeneral",void 0),r([c({type:cc.Node})],t.prototype,"btnHelp",void 0),r([c({type:cc.Node})],t.prototype,"ropeAnim",void 0),r([c({type:cc.Node})],t.prototype,"lightAnim",void 0),r([c({type:[cc.Node]})],t.prototype,"lightFrames",void 0),a=r([p],t)}(h);t.exports=l,cc._RF.pop()},{"../lang/langMgr":void 0,basePage:void 0}],AttributeInfoChange:[function(e,t,a){"use strict";cc._RF.push(t,"0ea6bRuJmhCEr/BNNxZfRk9","AttributeInfoChange");var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function a(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(a.prototype=t.prototype,new a)}),r=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o};Object.defineProperty(a,"__esModule",{value:!0});var o=cc._decorator,s=o.ccclass,p=o.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.beforeValue=null,t.afterValue=null,t.labTitle=null,t.nodeArrow=null,t}return n(t,e),t.prototype.initValues=function(e){var t="";void 0!==e.attrKey&&2==app.db.dbProperty[e.attrKey].NUMTYPE&&(t="%"),void 0!==e.beforeValue&&cc.isValid(this.beforeValue)&&(this.beforeValue.string=""+(t?e.beforeValue/10+t:e.beforeValue)),void 0!==e.afterValue?cc.isValid(this.afterValue)&&(this.afterValue.string=""+(t?e.afterValue/10+t:e.afterValue)):(cc.isValid(this.afterValue)&&(this.afterValue.node.active=!1),cc.isValid(this.beforeValue)&&this.beforeValue.node.setPosition(this.beforeValue.node.getPosition().addSelf(cc.v2(200,0))),cc.isValid(this.labTitle)&&this.labTitle.node.setPosition(this.labTitle.node.getPosition().addSelf(cc.v2(200,0))),cc.isValid(this.nodeArrow)&&(this.nodeArrow.active=!1)),e.titleInfo&&cc.isValid(this.labTitle)&&(this.labTitle.string=e.titleInfo)},t.prototype.setVisible=function(e){this.node.active=e},r([p(cc.Label)],t.prototype,"beforeValue",void 0),r([p(cc.Label)],t.prototype,"afterValue",void 0),r([p(cc.Label)],t.prototype,"labTitle",void 0),r([p(cc.Node)],t.prototype,"nodeArrow",void 0),r([s],t)}(cc.Component);a.default=c,cc._RF.pop()},{}],BookIntensifyPage:[function(e,t){"use strict";cc._RF.push(t,"aa30eVcoo1Aa7fhxMc1WIzH","BookIntensifyPage");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=cc._decorator,o=r.ccclass,s=r.property,p=e("langMgr"),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_labName=null,t.p_nodeMian=null,t.p_arrNodeRand=[],t.p_labHit=null,t.p_labLevelLeft=null,t.p_labLevelRight=null,t.p_labPro=null,t.p_proBar=null,t.p_nodeTabView=null,t.p_btnAkey=null,t.p_btnOk=null,t.p_btnHelp=null,t.pfbPropItem=null,t.nodeContent=null,t._nodeItem=null,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){var e=this;a.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.fitTopMenu(),this.p_btnAkey.node.on("click",function(){app.playSound("click"),e.onClickOneKey()}),this.p_btnOk.node.on("click",function(){app.playSound("click"),e.onClickStarUp()}),this.p_btnHelp.node.on("click",function(){app.playSound("click"),app.pages.windowspagetipshelp.showPage(1113)})},t.prototype.setParam=function(e){if(cc.log("now star up treas is ",e.gsid),this.m_strGuid=e.guid,this.m_strBookGuid=e.bookGuid,this.m_closeCb=e.closecb,this.m_objNewGData=null,this.m_type=e.type,this.m_strGuid&&1==this.m_type)for(var t=app.player.general[this.m_strGuid].book,a=0;a<t.length;a++)t[a]&&t[a].guid==this.m_strBookGuid&&(this.m_bookInfo=t[a]);else this.m_bookInfo=app.player.books[this.m_strBookGuid];this.refreshUI()},t.prototype.refreshUI=function(){this.refreshData(),this.refreshTarget(),this.refreshView(),this.initExp(),this.refreshInfo()},t.prototype.refreshView=function(){cc.log("refreshview");var e=this.m_arrShowData.length;this.p_nodeTabView.getComponent("tableView").initTableView(e,{array:this.m_arrShowData,target:this})},t.prototype.refreshTarget=function(){this.m_generalInfo=app.player.general[this.m_strGuid]||[],this.m_gsid=this.m_bookInfo.gsid,cc.log("now treas id is ",this.m_strTargetGsid,this.m_gsid),cc.isValid(this._nodeItem)||(this._nodeItem=cc.instantiate(this.pfbPropItem),this.nodeContent.addChild(this._nodeItem),this._nodeItem.setPosition(cc.Vec2.ZERO)),this._nodeItem.getComponent("propItem").initForGsid(this.m_gsid);var e=app.db.getBBaseByGsid(this.m_gsid);this.p_labName.string=e.NAME},t.prototype.refreshData=function(){this.m_arrShowData=this.setData()},t.prototype.refreshInfo=function(e){void 0===e&&(e=!1);var t=app.db.getBBaseByGsid(this.m_gsid),a=this.m_bookInfo.level,i=a%3;this.p_labHit.node.opacity=this.m_isMaxLv?0:255,this.p_labHit.string=p.getString("BookIntensifyPage",0,a+3-i);var n=this.p_nodeMian.getChildByName("tx_key").getComponent(cc.Label),r=this.p_nodeMian.getChildByName("val_now").getComponent(cc.Label),o=this.p_nodeMian.getChildByName("val_next").getComponent(cc.Label),s=this.p_nodeMian.getChildByName("arrow"),c=this.m_bookInfo.main[0],h=app.db.getPropertyCnByEn(c.key),l=c.val[0]+c.val[1],g=l+t.ADDVALUE,d=app.db.getPropertyIdByEn(c.key);d&&2==app.db.dbProperty[d].NUMTYPE&&(l=l/10+"%",g=g/10+"%"),n.string=h,r.string=l,s.active=e,o.node.active=e,e&&(o.string=g);for(var u=this.m_bookInfo.rand,f=0;f<this.p_arrNodeRand.length;f++){var m=this.p_arrNodeRand[f],_=u[f];if(m.active=!!_,_){var v=m.getChildByName("tx_key").getComponent(cc.Label),b=m.getChildByName("val_now").getComponent(cc.Label),y=m.getChildByName("val_next").getComponent(cc.Label);m.getChildByName("arrow").active=e,y.node.active=e;var P=_.val[0]+_.val[1],w=app.db.getPropertyIdByEn(_.key);w&&2==app.db.dbProperty[w].NUMTYPE&&(P=Math.floor(P/10*100)/100+"%"),v.string=app.db.getPropertyCnByEn(_.key),b.string=P,y.string=(a+1)%3!=0?P:"?"}}},t.prototype.itemClickHandler=function(e,t){this.m_isMaxLv||(this.refreshPick(e,t),this.refreshExp())},t.prototype.refreshPick=function(e,t){if(e){console.log(e);var a=app.db.getBBaseByGsid(e.gsid);e.guid?this.m_objPickItem[e.guid]?("plus"==t&&(this.m_objPickItem[e.guid]=Number(e.count)),"minus"==t&&delete this.m_objPickItem[e.guid]):this.m_objPickItem[e.guid]=Number(e.count):this.m_objPickItem[e.gsid]?("plus"==t&&(this.m_objPickItem[e.gsid]=Number(e.count)),"minus"==t&&delete this.m_objPickItem[e.gsid]):this.m_objPickItem[e.gsid]=Number(e.count);var i=0;if(e.guid)for(var n=app.player.books[e.guid],r=0;r<n.level;r++)i+=app.db.getBookNeedExpByPosStar(a.POS,r);"plus"==t&&(30092==e.gsid?this.m_numPickExp+=app.player.getCount(e.gsid):this.m_numPickExp+=a.EXP*e.count+i),"minus"==t&&(30092==e.gsid?this.m_numPickExp-=app.player.getCount(e.gsid):this.m_numPickExp-=a.EXP*e.count+i)}},t.prototype.refreshExp=function(){this.m_numPickExp<this.m_needExp?(this.m_isMaxExp=!1,this.refreshInfo()):(this.m_isMaxExp=!0,this.refreshInfo(!0)),this.p_labLevelLeft.string=p.getString("BookIntensifyPage",1,this.m_bookInfo.level);var e=p.getString("BookIntensifyPage",1,this.m_bookInfo.level+1);this.p_labLevelRight.string=e,this.p_labPro.string=this.m_numPickExp+"/"+this.m_needExp,this.p_proBar.progress=this.m_numPickExp/this.m_needExp},t.prototype.initExp=function(){this.m_isMaxExp=!1,this.m_isMaxLv=!1,this.m_objPickItem={},this.m_numPickExp=0;var e=app.db.getBBaseByGsid(this.m_gsid),t=e.MAXLEVEL;if(this.m_needExp=app.db.getBookNeedExpByPosStar(e.POS,this.m_bookInfo.level),!t||t<=this.m_bookInfo.level){this.m_isMaxLv=!0;var a=this.m_bookInfo.level,i=this.m_bookInfo.level;this.p_labLevelLeft.string=p.getString("BookIntensifyPage",1,a),this.p_labLevelRight.string=p.getString("BookIntensifyPage",2,i),this.p_labPro.string=p.getString("BookIntensifyPage",3),this.p_proBar.progress=1}else{a=this.m_bookInfo.level,i=this.m_bookInfo.level+1,this.p_labLevelLeft.string=p.getString("BookIntensifyPage",1,a);var n=p.getString("BookIntensifyPage",1,i);this.p_labLevelRight.string=n,this.p_labPro.string="0/"+this.m_needExp,this.p_proBar.progress=0,this.m_numNextBeginExp=0,this.m_numNextExp=this.m_needExp}},t.prototype.setData=function(){var e=[];for(var t in app.player.books){var a=app.player.books[t].count||1,i={guid:t,gsid:app.player.books[t].gsid,count:a,picked:0};i.guid!=this.m_strBookGuid&&e.push(i)}return e.sort(function(e,t){var a=app.player.books[e.guid],i=app.player.books[t.guid],n=app.db.getBBaseByGsid(a.gsid),r=app.db.getBBaseByGsid(i.gsid);return n.STAR>r.STAR?1:n.STAR==r.STAR&&a.level>i.level?1:-1}),e.unshift({gsid:30092,count:app.player.getCount(30092)}),cc.log(e),e},t.prototype.setArrChooseItem=function(){this.m_expitem=0;var e=[];for(var t in this.m_objPickItem)"30092"==t?this.m_expitem=1:e.push(t);return e},t.prototype.onClickStarUp=function(){var e=this;if(cc.log("click star up"),this.m_isMaxLv)app.showNotice(p.getString("BookIntensifyPage",4));else if(this.m_needExp>this.m_numPickExp)app.showNotice(p.getString("BookIntensifyPage",5));else{var t=function(){var t=e.setArrChooseItem();cc.log(t),app.player.sfBookIntensify(e.m_strGuid,e.m_strBookGuid,t,e.m_expitem,function(t,a){t?app.showNotice(t):(e.m_bookInfo=a.book,app.player.sfPlayerByParam(["books","props"],function(){e.refreshUI()}))})};if(this.checkStar()){var a={content:window.langMgr.getString("bookResolvePage",9),confirmcb:function(){t&&t()},cancelcb:function(){},target:this};app.pages.windowspagetipsmsg.showPage(a)}else t&&t()}},t.prototype.onClickOneKey=function(){if(this.m_isMaxLv)app.showNotice(p.getString("BookIntensifyPage",6));else{var e=this.m_needExp-this.m_numPickExp,t=0;if(e>=0){for(var a=0;a<this.m_arrShowData.length&&t<e;++a){var i=this.m_arrShowData[a];if(!i.picked){var n=i.count;if(30092==i.gsid)n=i.count;else{var r=app.db.getBBaseByGsid(i.gsid),o=0;if(i.guid)for(var s=app.player.books[i.guid],c=0;c<s.level;c++)o+=app.db.getBookNeedExpByPosStar(r.POS,c);n=r.EXP+o}var h=i.count;t+=n,i.picked=1,this.refreshPick({gsid:i.gsid,guid:i.guid,count:h},"plus")}}this.refreshExp(),this.refreshView()}else app.showNotice(p.getString("BookIntensifyPage",6))}},t.prototype.checkStar=function(){for(var e=this.setArrChooseItem(),t=0;t<e.length;t++){var a=app.player.books[e[t]];if(app.db.getBBaseByGsid(a.gsid).STAR>4)return!0}return!1},t.prototype.onClose=function(){eventMgr.emit(eventStr.generalPageBook.RefreshBook),eventMgr.emit(eventStr.generalPageBook.RefreshBookBag),e.prototype.onClose.call(this)},t.prefabPath="BookIntensifyPage",n([s(cc.Label)],t.prototype,"p_labName",void 0),n([s(cc.Node)],t.prototype,"p_nodeMian",void 0),n([s(cc.Node)],t.prototype,"p_arrNodeRand",void 0),n([s(cc.Label)],t.prototype,"p_labHit",void 0),n([s(cc.Label)],t.prototype,"p_labLevelLeft",void 0),n([s(cc.Label)],t.prototype,"p_labLevelRight",void 0),n([s(cc.Label)],t.prototype,"p_labPro",void 0),n([s(cc.ProgressBar)],t.prototype,"p_proBar",void 0),n([s(cc.Node)],t.prototype,"p_nodeTabView",void 0),n([s(cc.Button)],t.prototype,"p_btnAkey",void 0),n([s(cc.Button)],t.prototype,"p_btnOk",void 0),n([s(cc.Button)],t.prototype,"p_btnHelp",void 0),n([s(cc.Prefab)],t.prototype,"pfbPropItem",void 0),n([s(cc.Node)],t.prototype,"nodeContent",void 0),a=n([o],t)}(e("basePage"));t.exports=c,cc._RF.pop()},{basePage:void 0,langMgr:void 0}],BulletScreen:[function(e,t,a){"use strict";cc._RF.push(t,"8cc8fhO1uZNaZ54oACwdvIb","BulletScreen");var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function a(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(a.prototype=t.prototype,new a)}),r=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o};Object.defineProperty(a,"__esModule",{value:!0});var o=cc._decorator,s=o.ccclass,p=o.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.content=null,t.bulletDefSpeed=50,t.bulletDefInterval=0,t.defLabColor=null,t.defLabFontSize=30,t.defDelayTime=0,t.defLabOutlineWidth=2,t._designResolution=null,t._frameSize=cc.view.getVisibleSize(),t._viewH=cc.view.getVisibleSize().height,t._viewW=cc.view.getVisibleSize().width,t._msgList=[],t._isInit=!1,t._curInterval=0,t._bulletPool=[],t._runningList=[],t._isPaused=!1,t._waitBuffer=[],t}return n(t,e),Object.defineProperty(t.prototype,"viewW",{get:function(){return this._viewW},set:function(e){this._viewW=e;var t=this.content.getComponent(cc.Mask);this.viewW<this._frameSize.width?cc.isValid(t)?t.enabled=!0:t=this.content.addComponent(cc.Mask):cc.isValid(t)&&(t.enabled=!1)},enumerable:!1,configurable:!0}),t.prototype.onLoad=function(){this._designResolution=cc.Canvas.instance.designResolution},t.prototype.update=function(e){var t=this;if(!this._isPaused)if(this._runningList.filter(function(e){return t._judgeOut(e)}).forEach(function(e){t._putBullet(e),0===t._runningList.length&&0===t._waitBuffer.length&&0===t._msgList.length&&cc.director.emit("EVT_FINISH_BULLET_PLAY")}),this._runningList.forEach(function(a){var i=a.msg&&a.msg.bulletAttr&&a.msg.bulletAttr.moveSpeed?a.msg&&a.msg.bulletAttr.moveSpeed:t.bulletDefSpeed;a.setPosition(a.getPosition().addSelf(cc.v2(-e*i,0)))}),this._curInterval>0)this._curInterval-=e;else{if(this._waitBuffer.length>0){cc.log("launch bullet, biu biu biu~");var a=this._waitBuffer.shift(),i=this._getBullet();this._initBullet(i,a),this._runningList.push(i)}if(0!==this._msgList.length){var n=this._msgList.shift();this._curInterval=n.bulletAttr&&void 0!==n.bulletAttr.delayTime?n.bulletAttr.delayTime:this.defDelayTime,this._waitBuffer.push(n)}}},t.prototype._getBullet=function(){var e=this._bulletPool.shift();return cc.isValid(e)?(cc.log("reuse bullet"),e.opacity=255,e):(cc.log("create new bullet"),(e=new cc.Node("Bullet")).addComponent(cc.Label),this.content.addChild(e),e.setPosition(5e3,5e3),e)},t.prototype._putBullet=function(e){if(cc.isValid(e)){cc.log("recycle bullet",JSON.stringify(e.getPosition()),e.width);var t=this._runningList.indexOf(e);-1!==t&&this._runningList.splice(t,1),e.opacity=0,e.setPosition(cc.v2(5e3,5e3)),this._bulletPool[this._bulletPool.length]=e,this._clearBulletAttr(e)}},t.prototype._initBullet=function(e,t){this._addBulletAttr(e,t),this._renderLabelBullet(e),this._setBulletRandomPos(e)},t.prototype._renderLabelBullet=function(e){var t=e.msg,a=e.getComponent(cc.Label);cc.isValid(a)||(a=e.addComponent(cc.Label)),a.string=t.content,a.fontSize=t.labelStyle&&t.labelStyle.fontSize||this.defLabFontSize,a.lineHeight=a.fontSize+2,e.color=t.labelStyle&&t.labelStyle.fontColor?(new cc.Color).fromHEX(t.labelStyle.fontColor):this.defLabColor;var i=e.getComponent(cc.LabelOutline);t.labelStyle&&t.labelStyle.outlineColor?(cc.isValid(i)||(i=e.addComponent(cc.LabelOutline)),i.enabled||(i.enabled=!0),i.color=(new cc.Color).fromHEX(t.labelStyle.outlineColor),i.width=void 0===t.labelStyle.outlineSize?this.defLabOutlineWidth:t.labelStyle.outlineSize):cc.isValid(i)&&i.enabled&&(i.enabled=!1)},t.prototype._judgeOut=function(e){var t=e.getPosition().x,a=e.width;return t+(1-e.anchorX)*a<-this._viewW*this.content.anchorX},t.prototype._addBulletAttr=function(e,t){cc.isValid(e)&&cc.Node.isNode(e)&&e.attr({msg:t})},t.prototype._clearBulletAttr=function(e){this._addBulletAttr(e,{})},t.prototype._setBulletRandomPos=function(e){this._isInit||this.setViewSize();var t=e.msg,a=this._viewH-e.height,i=void 0!==t.defaultYCoords?t.defaultYCoords*this._designResolution.height/this._frameSize.height:a*Math.random()-this.content.height*this.content.anchorY;cc.isValid(e.getComponent(cc.Label))&&e.getComponent(cc.Label)._forceUpdateRenderData(),e.setPosition(cc.v2(e.width*e.anchorX+this.content.width*(1-this.content.anchorX),i)),cc.log("generate random pos: ",JSON.stringify(e.getPosition()))},t.prototype.setViewSize=function(e){void 0===e&&(e=new cc.Size(this._viewW,this._viewH)),void 0!==e.height&&(this._viewH=e.height),void 0!==e.width&&(this.viewW=e.width),this.content.setContentSize(this.viewW,this._viewH),this._isInit=!0},t.prototype.addMsg=function(e){var t;e instanceof Array?(t=this._msgList).push.apply(t,e):this._msgList[this._msgList.length]=e},t.prototype.clearBulletPool=function(){this._bulletPool.filter(function(e){return cc.isValid(e)}).forEach(function(e){return e.destroy()}),this._bulletPool.length=0},t.prototype.pauseBullet=function(){this._isPaused=!0},t.prototype.resumeBullet=function(){this._isPaused=!1},t.prototype.clearAllMsgList=function(){this._msgList.length=0,this._waitBuffer.length=0},t.prototype.clearFullScreen=function(){var e=this;this._runningList.forEach(function(t){return e._putBullet(t)}),this._runningList.length=0},t.prototype.clearTargetMsgList=function(e){for(var t=this._msgList.length;t>=0;--t){var a=this._msgList[t].id;e.includes(a)&&this._msgList.splice(t,1)}for(t=this._waitBuffer.length;t>=0;--t)a=this._waitBuffer[t].id,e.includes(a)&&this._waitBuffer.splice(t,1)},t.prototype.clearTargetBullet=function(e){for(var t=this._runningList.length;t>=0;--t){var a=this._runningList[t];e.includes(a)&&this._putBullet(a)}},t.prototype.getMsgList=function(){return gUtils.deepClone(this._msgList)},t.prototype.getRunningBullet=function(){return this._runningList},t.prototype.getWaitingMsg=function(){return this._waitBuffer},t.prototype.setFontDefColor=function(e){this.defLabColor=e},t.prototype.setFontDefSize=function(e){this.defLabFontSize=e},t.prototype.setBulletDefSpeed=function(e){this.bulletDefSpeed=e},t.prototype.setDefInterval=function(e){this.bulletDefInterval=e},t.prototype.onDestroy=function(){this.clearBulletPool()},r([p({type:cc.Node,displayName:"\u5f39\u5e55\u5bb9\u5668"})],t.prototype,"content",void 0),r([p({displayName:"\u5f39\u5e55\u9ed8\u8ba4\u901f\u5ea6"})],t.prototype,"bulletDefSpeed",void 0),r([p({displayName:"\u53d1\u5c04\u9ed8\u8ba4\u95f4\u9694"})],t.prototype,"bulletDefInterval",void 0),r([p({displayName:"\u5f39\u5e55\u9ed8\u8ba4\u989c\u8272"})],t.prototype,"defLabColor",void 0),r([p({displayName:"\u5f39\u5e55\u5b57\u53f7\u9ed8\u8ba4\u5927\u5c0f"})],t.prototype,"defLabFontSize",void 0),r([p({displayName:"\u9ed8\u8ba4\u7b49\u5f85\u65f6\u95f4"})],t.prototype,"defDelayTime",void 0),r([p({displayName:"\u9ed8\u8ba4\u63cf\u8fb9\u5bbd\u5ea6"})],t.prototype,"defLabOutlineWidth",void 0),r([s],t)}(cc.Component);a.default=c,cc._RF.pop()},{}],ChooseTutorPage:[function(e,t){"use strict";cc._RF.push(t,"3486ayTQoZCLZvJo77t1fOT","ChooseTutorPage");var a,i,n,r=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),o=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},s=cc._decorator,p=s.ccclass,c=s.property,h=e("basePage");(function(e){e[e.ZhanShi=0]="ZhanShi",e[e.CiKe=1]="CiKe",e[e.FaShi=2]="FaShi",e[e.SheShou=3]="SheShou"})(i||(i={})),function(e){e[e.Cartoon=0]="Cartoon",e[e.Realism=1]="Realism"}(n||(n={}));var l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.toggles=[],t.generalBanner=null,t.generalBannerFrames=[],t.realismBannerFrames=[],t.realismCheckFrames=[],t.realismBgFrames=[],t.cartoonCheckFrames=[],t.cartoonBgFrames=[],t.btnChoose=null,t._curIdx=i.CiKe,t._curShowT=n.Cartoon,t._iconCheckList=[],t._iconBgList=[],t._bannerList=[],t._defIndex=i.CiKe,t}var a;return r(t,e),a=t,Object.defineProperty(t.prototype,"curShowT",{get:function(){return this._curShowT},set:function(e){this._curShowT!==e&&(this._curShowT=e,this.renderUI())},enumerable:!1,configurable:!0}),t.prototype.onLoad=function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(),this.handleUI(),this.addUIEvent(),this._bannerList=[this.generalBannerFrames,this.realismBannerFrames],this._iconBgList=[this.cartoonBgFrames,this.realismBgFrames],this._iconCheckList=[this.cartoonCheckFrames,this.realismCheckFrames]},t.prototype.start=function(){},t.prototype.setParam=function(e){if(e.type>1)this.onClose();else{e.type=window.gSetting.clientRunJudge("JSQBZ")?n.Realism:n.Cartoon;var t=this.toggles[this._defIndex];cc.isValid(t)&&(t.check(),t._emitToggleEvents()),this.curShowT=e.type,this._playRoleLine(this._curIdx)}},t.prototype.renderUI=function(){var e=this;this.toggles.forEach(function(t,a){t.checkMark.spriteFrame=e._iconCheckList[e.curShowT][a];var i=t.node.getChildByName("Background");cc.isValid(i)&&(i.getComponent(cc.Sprite).spriteFrame=e._iconBgList[e.curShowT][a])}),this.generalBanner.spriteFrame=this._bannerList[this.curShowT][this._curIdx]},t.prototype.addUIEvent=function(){var e=this;this.btnChoose.node.on("click",function(){app.playSound("click"),app.player.sfChooseTutor({tutor:e._curIdx+1}).then(function(){e.onClose(),window.GodGuide.addGuideProgress("guide_pick_tutor_end"),window.GodGuide.checkGuideProgress("picktutor")&&app.runGuide()}).catch(function(e){cc.warn("choose tutor error: "+JSON.stringify(e))})},this),this.toggles.forEach(function(t,a){t.node.on("toggle",function(){e._curIdx=a,e._playRoleLine(e._curIdx),e.generalBanner.spriteFrame=e._bannerList[e.curShowT][e._curIdx]},e)})},t.prototype._playRoleLine=function(e){if(this._curShowT===n.Realism){window.GodGuide.nowPlayAuidoId&&window.audioMsg.stopEffects(window.GodGuide.nowPlayAuidoId);var t=window.gConfig.rootPath.guidesound,a=window.gConfig.tutorType[e],i=t+a.NPC+"/"+a.VOICE;app.playGuideSound(i,1)}},t.prefabPath="chooseTutorPage",t.pageType=1,o([c({type:[cc.Toggle]})],t.prototype,"toggles",void 0),o([c({type:cc.Sprite})],t.prototype,"generalBanner",void 0),o([c({type:[cc.SpriteFrame]})],t.prototype,"generalBannerFrames",void 0),o([c({type:[cc.SpriteFrame]})],t.prototype,"realismBannerFrames",void 0),o([c({type:[cc.SpriteFrame]})],t.prototype,"realismCheckFrames",void 0),o([c({type:[cc.SpriteFrame]})],t.prototype,"realismBgFrames",void 0),o([c({type:[cc.SpriteFrame]})],t.prototype,"cartoonCheckFrames",void 0),o([c({type:[cc.SpriteFrame]})],t.prototype,"cartoonBgFrames",void 0),o([c(cc.Button)],t.prototype,"btnChoose",void 0),a=o([p],t)}(h);t.exports=l,cc._RF.pop()},{basePage:void 0}],FiveWarIntroducePage:[function(e,t){"use strict";cc._RF.push(t,"754ecIhBq1BbrIRsG/lfUq6","FiveWarIntroducePage");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=cc._decorator,o=r.ccclass,s=r.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.nodeContent=null,t.spIntroFrames=[],t._menu=null,t._menuIdx=-1,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,e.prototype.onLoad&&e.prototype.onLoad.call(this),this.stopBgNodeEvent(),this.handleUI(),this.creatMask(!0),this._menu=this.node.getComponent("menu"),this._menu.init(this)},t.prototype.setParam=function(){this._menu.setMenuIndex(0)},t.prototype.menuHandler=function(e){if(e===this._menuIdx)return!1;var t=this.spIntroFrames[e];return!!cc.isValid(t)&&(this._menuIdx=e,this.nodeContent.getComponent(cc.Sprite).spriteFrame=t,!0)},t.prefabPath="fiveWarIntroducePage",t.pageType=1,t.pageParent="fivewarmainpage",n([s(cc.Node)],t.prototype,"nodeContent",void 0),n([s({type:[cc.SpriteFrame]})],t.prototype,"spIntroFrames",void 0),a=n([o],t)}(e("basePage"));t.exports=p,cc._RF.pop()},{basePage:void 0}],GeneralAppoint:[function(e,t,a){"use strict";cc._RF.push(t,"ecaeedV3MBKVbTwbSpfa7YW","GeneralAppoint");var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function a(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(a.prototype=t.prototype,new a)}),r=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o};Object.defineProperty(a,"__esModule",{value:!0});var o=cc._decorator,s=o.ccclass,p=o.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.officeList=[],t.retinueContainer=null,t.retinuePfb=null,t.bannerNode=null,t.btnPreview=null,t.newOfficeUnlock=null,t.p_animNode=null,t.p_animPower_01=null,t.p_animPower_02=null,t.p_animPower_03=null,t.p_nodePowerNum=null,t.unlockTipAnim=null,t.btnHelp=null,t.retinueList=[],t}return n(t,e),t.prototype.start=function(){this.addUIEvent(),this.addEvent()},t.prototype.initRetinueContainer=function(e){for(var t=0;t<e;++t){var a=cc.instantiate(this.retinuePfb);a.parent=this.retinueContainer,this.retinueList[this.retinueList.length]=a}},t.prototype.refreshUI=function(e){var t,a,i=this,n=app.redDataServer.official;n&&(n.general_official=n.general_retinue=0,null===(a=null===(t=app.pages.officepage.instance)||void 0===t?void 0:t.p_menu)||void 0===a||a.refreshRed());var r=[];if(e.official)for(var o in e.official){var s=e.official[o];if(s&&Object.prototype.hasOwnProperty.call(e.official,o)){var p=s.guid;if(p){var c=app.player.general[p];c&&r.push(c.level||1)}Boolean(s.NEW)}}var h=Math.min.apply(Math,r);if(this.officeList.forEach(function(t,a){var n,r=e.official?e.official[a+1]:{},o=null!==(n=null==r?void 0:r.guid)&&void 0!==n?n:"",s=Boolean(null==r?void 0:r.NEW);t.getComponent("OfficeItem").init({officePos:a+1,guid:o,minLevel:h,isNewUnlock:s,target:i})}),app.db.checkRetinueUnLock()){this.bannerNode.active=!1,this.retinueContainer.active=!0,0===this.retinueList.length&&this.initRetinueContainer(app.db.getDBRetinueKeys().length);var l=e.retinue?e.retinue:{},g=this.canAppointRetinue(),d=g[0];g[1],this.retinueList.forEach(function(e,t){var a=t+1;e.getComponent("RetinueItem").init({retinuePos:a,retinueData:l[a],target:i,isUnlock:d})})}else this.bannerNode.active=!0,this.retinueContainer.active=!1},t.prototype.addUIEvent=function(){var e=this;this.btnPreview.node.on("click",function(){app.playSound("click"),app.pages.windowsPageOfficeBuffInfo.showPage()},this),this.newOfficeUnlock.on("touchend",function(){e.newOfficeUnlock.active=!1,cc.director.emit("EVT_OFFICE_PLAY_UNLOCK")},this),this.btnHelp.on("click",function(){app.playSound("click"),app.pages.windowspagetipshelp.showPage("1074")},this)},t.prototype.addEvent=function(){var e=this;cc.director.on("EVT_GENERAL_APPOINT_REFRESH_UI",function(t){e.refreshUI(t)},this),cc.director.on("EVT_OFFICE_POWER_CHANGE",function(t){t>0&&e.scheduleOnce(function(){e.playPowerChangeAnim(t)},1.5)},this),cc.director.on("EVT_OFFICE_PLAY_FLASH_ANIM",function(t){t.forEach(function(t){var a=e.officeList[t-1];cc.isValid(a)&&a.getComponent("OfficeItem").playFlashAnim()})},this)},t.prototype.removeEvent=function(){cc.director.targetOff(this)},t.prototype.onDestroy=function(){this.removeEvent()},t.prototype.playPowerChangeAnim=function(){},t.prototype.canAppointRetinue=function(){for(var e=app.player.general_official,t=!0,a="",i=app.db.getDBOfficialKeys(),n=0;n<i.length;n++){var r=i[n],o=e.official[r];if(!o||"object"==typeof o&&o.NEW){t=!1;var s=app.db.getOfficeInfoByPos(r);s&&(a=s.NAME);break}}return[t,a]},r([p({type:[cc.Node]})],t.prototype,"officeList",void 0),r([p(cc.Node)],t.prototype,"retinueContainer",void 0),r([p(cc.Prefab)],t.prototype,"retinuePfb",void 0),r([p(cc.Node)],t.prototype,"bannerNode",void 0),r([p({type:cc.Button})],t.prototype,"btnPreview",void 0),r([p(cc.Node)],t.prototype,"newOfficeUnlock",void 0),r([p(cc.Animation)],t.prototype,"p_animNode",void 0),r([p(cc.Animation)],t.prototype,"p_animPower_01",void 0),r([p(cc.Animation)],t.prototype,"p_animPower_02",void 0),r([p(cc.Animation)],t.prototype,"p_animPower_03",void 0),r([p(cc.Node)],t.prototype,"p_nodePowerNum",void 0),r([p(sp.Skeleton)],t.prototype,"unlockTipAnim",void 0),r([p(cc.Node)],t.prototype,"btnHelp",void 0),r([s],t)}(cc.Component);a.default=c,cc._RF.pop()},{}],GeneralRankListPage:[function(e,t){"use strict";cc._RF.push(t,"2915eztVz1I0Z80SfzTuMUw","GeneralRankListPage");var a,i,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),r=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},o=e("../lang/langMgr"),s=cc._decorator,p=s.ccclass,c=s.property,h=e("basePage");(function(e){e[e.None=-1]="None",e[e.GlobalServers=0]="GlobalServers",e[e.LocalServers=1]="LocalServers"})(i||(i={}));var l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.btnHelp=null,t.container=null,t.tipNode=null,t.labRankName=null,t._listData=null,t._rankData=[],t._generalName="",t._menuIndex=i.None,t._menu=null,t}var a;return n(t,e),a=t,Object.defineProperty(t.prototype,"menuIndex",{set:function(e){this._menuIndex!=e&&(this._menuIndex=e,cc.isValid(this._menu)?this._menu.setMenuIndex(this._menuIndex):(this._menu=this.node.getComponent("menu"),cc.isValid(this._menu)&&(this._menu.init(this),this._menu.setMenuIndex(this._menuIndex))))},enumerable:!1,configurable:!0}),t.prototype.onLoad=function(){a.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.addUIEvent(),this.creatMask(!0),this.fitTopMenu()},t.prototype.setParam=function(e){this._listData=e.dataList,this._generalName=e.generalName,this.menuIndex=i.GlobalServers},t.prototype.renderUI=function(){this.tipNode.active=this._rankData.length<=0,this.labRankName.string=o.getString("GeneralRankListPage",0,this._generalName),this.container.getComponent("tableView").initTableView(this._rankData.length,{array:this._rankData,target:this})},t.prototype.addUIEvent=function(){this.btnHelp.on("click",function(){app.playSound("click"),app.pages.windowspagetipshelp.showPage("1066")},this)},t.prototype.menuHandler=function(e){switch(this.menuIndex=e,!0){case this._menuIndex===i.GlobalServers:this._rankData=this._listData.global_server;break;case this._menuIndex===i.LocalServers:this._rankData=this._listData.local_server;break;default:return!1}return this.renderUI(),!0},t.prefabPath="generalRankListPage",t.pageType=0,r([c({type:cc.Node})],t.prototype,"btnHelp",void 0),r([c({type:cc.Node})],t.prototype,"container",void 0),r([c({type:cc.Node})],t.prototype,"tipNode",void 0),r([c({type:cc.Label})],t.prototype,"labRankName",void 0),a=r([p],t)}(h);t.exports=l,cc._RF.pop()},{"../lang/langMgr":void 0,basePage:void 0}],GeneralSkinPanel:[function(e,t,a){"use strict";cc._RF.push(t,"2fa0fgGTGhABaikOEzqwLEN","GeneralSkinPanel");var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function a(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(a.prototype=t.prototype,new a)}),r=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},o=this&&this.__awaiter||function(e,t,a,i){return new(a||(a=Promise))(function(n,r){function o(e){try{p(i.next(e))}catch(t){r(t)}}function s(e){try{p(i.throw(e))}catch(t){r(t)}}function p(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(o,s)}p((i=i.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var a,i,n,r,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(e){return function(t){return p([e,t])}}function p(r){if(a)throw new TypeError("Generator is already executing.");for(;o;)try{if(a=1,i&&(n=2&r[0]?i.return:r[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,r[1])).done)return n;switch(i=0,n&&(r=[2&r[0],n.value]),r[0]){case 0:case 1:n=r;break;case 4:return o.label++,{value:r[1],done:!1};case 5:o.label++,i=r[1],r=[0];continue;case 7:r=o.ops.pop(),o.trys.pop();continue;default:if(!(n=(n=o.trys).length>0&&n[n.length-1])&&(6===r[0]||2===r[0])){o=0;continue}if(3===r[0]&&(!n||r[1]>n[0]&&r[1]<n[3])){o.label=r[1];break}if(6===r[0]&&o.label<n[1]){o.label=n[1],n=r;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(r);break}n[2]&&o.ops.pop(),o.trys.pop();continue}r=t.call(e,o)}catch(s){r=[6,s],i=0}finally{a=n=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(a,"__esModule",{value:!0});var p=cc._decorator,c=p.ccclass,h=p.property,l=e("langMgr"),g=(new cc.Color).fromHEX("#FFDD23"),d=(new cc.Color).fromHEX("#472707"),u=(new cc.Color).fromHEX("#FFDD23"),f=(new cc.Color).fromHEX("#472707"),m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.btnLeft=null,t.btnRight=null,t.pageView=null,t.skinPfb=null,t.normalizeDelta=50,t.pLabSkinName=null,t.pBtnGetChip=null,t.pBtnChange=null,t.pNodeChangeTxt=null,t.pNodeActivateTxt=null,t.pNodeDressed=null,t.pNodePropInfo=null,t.pBtnHelp=null,t.propTitles=[],t.propValues=[],t.btnTip=null,t._skinList=[],t._curSkinId=0,t._curIdx=-1,t._curGuid="",t._skinSum=0,t._operaLock=!1,t._skinInfoList=[],t}return n(t,e),Object.defineProperty(t.prototype,"curSkinId",{get:function(){if(this._skinInfoList[this._curIdx])return this._curSkinId=this._skinInfoList[this._curIdx].SKIN_ID,cc.log("=== curSkinId: ",this._curSkinId),this._curSkinId},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"curIdx",{get:function(){return this._curIdx},set:function(e){this._curIdx!==e&&(this._curIdx=e,this._skinInfoList[this._curIdx]&&(cc.director.emit("EVT_SKIN_PREVIEW_CHANGED",this.curSkinId),this._refreshSkinInfo(),this._refreshBtnVisible()))},enumerable:!1,configurable:!0}),t.prototype.onLoad=function(){this.addUIEvent()},t.prototype.addUIEvent=function(){var e=this;this.pageView.node.on("scrolling",function(){e.curIdx=e.pageView.getCurrentPageIndex(),e.refreshSwitchBtnVis(),e.setSkinItemScale()},this),this.btnLeft.on(cc.Node.EventType.TOUCH_END,function(){e.curIdx<=0||(e.curIdx--,e.setPagePos(e.curIdx),e.refreshSwitchBtnVis())},this),this.btnRight.on(cc.Node.EventType.TOUCH_END,function(){e._skinSum-1<=e.curIdx||(e.curIdx++,e.setPagePos(e.curIdx),e.refreshSwitchBtnVis())},this),this.pBtnGetChip.node.on("click",function(){app.playSound("click"),app.showNotice("\u53ef\u5728\u9650\u65f6\u6d3b\u52a8\u94dc\u96c0\u591c\u5bb4\u4e2d\u83b7\u53d6")},this),this.pBtnChange.node.on("click",function(){return o(e,void 0,void 0,function(){var e,t,a,i,n,r,o,p,c,h,l,g,d=this;return s(this,function(s){switch(s.label){case 0:if(app.playSound("click"),e=this._skinInfoList[this.curIdx],t=app.player.general[this._curGuid],!e||!t)return[2,cc.warn("no skin info")];if((a=e.SKIN_ID)==t.skin)return[2];if(i=this._curGuid,!this.pNodeActivateTxt.opacity)return[3,5];s.label=1;case 1:return s.trys.push([1,3,,4]),n=e.UNLOCK_CONSUME,r=n.GSID,o=n.COUNT,app.player.getCount(r)<o?[2,app.showNotice("\u76ae\u80a4\u788e\u7247\u4e0d\u8db3")]:[4,app.player.sfActivateSkin({skinid:this.curSkinId})];case 2:return h=s.sent(),app.player.reduceItem(h.castitems),app.pages.windowsPageSkinReward.showPage({skinInfo:e,guid:i}),app.player.sfPlayerByParam(["_skins"],function(){cc.director.emit("EVT_REFRESH_SKIN_ITEM",e),cc.director.emit("EVT_REFRESH_SKIN_RED_POINT"),cc.isValid(d)&&(d._refreshSkinInfo(),d._refreshBtnVisible())}),[3,4];case 3:return p=s.sent(),cc.warn("Activate Skin Error: ",JSON.stringify(p)),[3,4];case 4:return[3,9];case 5:if(!this.pNodeChangeTxt.opacity)return[3,9];s.label=6;case 6:return s.trys.push([6,8,,9]),c=t.power,[4,app.player.sfWearSkin({guid:this._curGuid,skinid:a})];case 7:return h=s.sent(),l=h.power,app.player.addGeneral([h]),cc.director.emit("EVT_PLAY_POWER_ANIM",{curPower:l,beforePower:c}),cc.director.emit("EVT_SKIN_DISPLAY_CHANGED",a),app.pages.generalpage.instance.refreshInfo(h),this._refreshSkinInfo(),this._refreshBtnVisible(),[3,9];case 8:return g=s.sent(),cc.warn("Wear Skin Error: ",JSON.stringify(g)),[3,9];case 9:return[2]}})})},this),this.btnTip.node.on("click",function(){app.playSound("click"),app.showNotice(l.getString("GeneralSkinPanel",0))},this)},t.prototype.refreshUI=function(e){this._curGuid=e;var t=app.player.general[this._curGuid].skin;this.renderSkinItems(this._curGuid);for(var a=0,i=0;i<this._skinInfoList.length;++i)if(this._skinInfoList[i].SKIN_ID===t){if(app.player._skins[t]&&-1!==app.player._skins[t]&&app.player._skins[t]<app.player.getServerTime())break;a=i;break}this._curIdx=a,this._refreshSkinInfo(),this._refreshBtnVisible(),this.setPagePos(a),this.setSkinItemScale()},t.prototype.setPagePos=function(e){cc.isValid(this._skinList[e])||(e=0),this.curIdx=e,this.pageView.setCurrentPageIndex(e)},t.prototype.setSkinItemScale=function(){var e=this;this._skinList.forEach(function(t){var a=t.convertToWorldSpaceAR(cc.Vec2.ZERO),i=e.pageView.node.convertToNodeSpaceAR(a),n=1/((Math.abs(i.x)+1e-6)/e.normalizeDelta);n=cc.misc.clampf(n,.8,1),t.getChildByName("Content").setScale(n)})},t.prototype.refreshSwitchBtnVis=function(){this.btnLeft.active=this.curIdx>0,this.btnRight.active=this.curIdx<this._skinSum-1},t.prototype.renderSkinItems=function(e){var t=this,a=app.player.general[e];if(a){var i=app.db.getGeneralSkinList(a.gsid),n=[];for(var r in i)n.push(i[r]);this._skinSum=n.length,this.refreshSwitchBtnVis(),this._skinInfoList=n;var o=n.length;for(n.sort(function(e,t){return e.SKIN_ID-t.SKIN_ID}).forEach(function(e,a){var i=t._skinList[a];cc.isValid(i)?t.showPage(i):(i=cc.instantiate(t.skinPfb),t.pageView.insertPage(i,a),t._skinList[a]=i,t.addItemEvent(i)),cc.log("=== Skin Info: ",e),i.getComponent("SkinItem").init(e,t._curGuid)});cc.isValid(this._skinList[o]);)this.hidePage(this._skinList[o++])}},t.prototype.addItemEvent=function(e){var t=this;if(cc.isValid(e)){var a=this._skinList.indexOf(e);a<0||e.on(cc.Node.EventType.TOUCH_END,function(){t._operaLock||(t._operaLock=!0,t.pageView._unregisterEvent(),t.setPagePos(a),t.scheduleOnce(function(){t.pageView._registerEvent(),t._operaLock=!1},.5))},this)}},t.prototype.hidePage=function(e){var t=this;if(e&&this.pageView.content){var a=this.pageView._pages.indexOf(e);-1!==a&&function(e){var a=t.pageView._pages;if(!(e<0||e>=a.length)){var i=a[e];i&&(i.active=!1,a.splice(e,1),t.pageView._updatePageView())}}(a)}},t.prototype.showPage=function(e){var t=this._skinList.indexOf(e);if(!(t<0)&&e&&-1===this.pageView._pages.indexOf(e)&&this.pageView.content){var a=this.pageView._pages.length;e.active=!0,t>=a?this.pageView._pages.push(e):this.pageView._pages.splice(t,0,e),this.pageView._updatePageView()}},t.prototype._refreshSkinInfo=function(){var e=this._skinInfoList[this.curIdx],t=app.player.general[this._curGuid];if(!e||!t)return cc.warn("no skin info");var a=e.SKIN_ID,i=t.skin===a;this.pLabSkinName.string=e.SKIN_NAME||l.getString("GeneralSkinPanel",1);var n=e.ARRATT,r=n.length;if(this.pNodePropInfo.active=r>0,r>0){for(var o=0;o<r;o++){var s=app.db.getPropertyIdByCn(n[o].ATT);this.propTitles[o].node.active=!0,this.propValues[o].node.active=!0,this.propTitles[o].string=s,this.propValues[o].string="+"+n[o].COUNT/10+"%",this.propTitles[o].node.color=this.propValues[o].node.color=i?g:u,this.propTitles[o].getComponent(cc.LabelOutline).color=this.propValues[o].getComponent(cc.LabelOutline).color=i?d:f}for(var p=r;p<this.propTitles.length;)cc.isValid(this.propTitles[p])&&(this.propTitles[p].node.active=!1),cc.isValid(this.propValues[p])&&(this.propValues[p].node.active=!1),p++}},t.prototype._refreshBtnVisible=function(){var e=this._skinInfoList[this.curIdx],t=app.player.general[this._curGuid];if(!e||!t)return cc.warn("no skin info");var a=e.SKIN_ID,i=void 0===e.UNLOCK_CONSUME||void 0!==app.player._skins[a],n=t.skin?t.skin===a:app.db.isDefaultSkin(t.gsid,a),r=!0;if(!i){var o=e.UNLOCK_CONSUME,s=o.GSID,p=o.COUNT;r=app.player.getCount(s)>=p}this.pNodeDressed.active=n,this.pBtnGetChip.node.active=!n&&!r,this.pBtnChange.node.active=!n&&r,this.pNodeChangeTxt.opacity=i?255:0,this.pNodeActivateTxt.opacity=i?0:255},r([h(cc.Node)],t.prototype,"btnLeft",void 0),r([h(cc.Node)],t.prototype,"btnRight",void 0),r([h(cc.PageView)],t.prototype,"pageView",void 0),r([h(cc.Prefab)],t.prototype,"skinPfb",void 0),r([h],t.prototype,"normalizeDelta",void 0),r([h(cc.Label)],t.prototype,"pLabSkinName",void 0),r([h(cc.Button)],t.prototype,"pBtnGetChip",void 0),r([h(cc.Button)],t.prototype,"pBtnChange",void 0),r([h(cc.Node)],t.prototype,"pNodeChangeTxt",void 0),r([h(cc.Node)],t.prototype,"pNodeActivateTxt",void 0),r([h(cc.Node)],t.prototype,"pNodeDressed",void 0),r([h(cc.Node)],t.prototype,"pNodePropInfo",void 0),r([h(cc.Button)],t.prototype,"pBtnHelp",void 0),r([h([cc.Label])],t.prototype,"propTitles",void 0),r([h([cc.Label])],t.prototype,"propValues",void 0),r([h(cc.Button)],t.prototype,"btnTip",void 0),r([c],t)}(cc.Component);a.default=m,cc._RF.pop()},{langMgr:void 0}],MilitaryRankRewardPage:[function(e,t){"use strict";cc._RF.push(t,"77446m2cAJK3IHkZgCJWOjX","MilitaryRankRewardPage");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=cc._decorator,o=r.ccclass,s=r.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.nodeItemContainer=null,t.nodeRankItem=null,t.labNoRankTip=null,t._playerRank=0,t._rewardList=[],t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},t.prototype._renderView=function(){var e=this,t=this._rewardList;if(t.forEach(function(a,i){var n=t[i].Rank,r=cc.instantiate(e.nodeRankItem);e.nodeItemContainer.addChild(r),r.getComponent("pvpRewardItem").refreshUI({MIN:n[0],MAX:n[1],REWARDS:t[i].Reward})}),this.nodeRankItem.active=void 0!==this._playerRank,this.labNoRankTip.node.opacity=void 0===this._playerRank?255:0,this.nodeRankItem.active){var a=this._calSelfRankReward(this._rewardList,this._playerRank),i=a.Rank;this.nodeRankItem.getComponent("pvpRewardItem").refreshUI({MIN:i[0],MAX:i[1],REWARDS:a.Reward})}},t.prototype._calSelfRankReward=function(e,t){for(var a=0;a<e.length;++a){var i=e[a].Rank;if(t>=i[0]&&t<=i[1])return e[a]}return e[e.length-1]},t.prototype.setParam=function(e){this._playerRank=e.rank,this._rewardList=e.rewardList,this._renderView()},t.prefabPath="militaryRankRewardPage",t.pageType=1,t.pageParent="windowsPageMilitaryRank",n([s(cc.Node)],t.prototype,"nodeItemContainer",void 0),n([s(cc.Node)],t.prototype,"nodeRankItem",void 0),n([s(cc.Label)],t.prototype,"labNoRankTip",void 0),a=n([o],t)}(e("basePage"));t.exports=p,cc._RF.pop()},{basePage:void 0}],NationRoyalMemberListPage:[function(e,t){"use strict";cc._RF.push(t,"773677zyDBOkZ6KRS9H3Rfw","NationRoyalMemberListPage");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=cc._decorator,o=r.ccclass,s=r.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.nodeTabView=null,t.labTopTitle=null,t.labMidTitle=null,t.labServerName=null,t.labNationName=null,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.creatMask(!0)},t.prototype.setParam=function(e){var t,a;this.labServerName.string="\u670d\u52a1\u5668\uff1a"+gUtils.getServNameForShow(e.serverId),this.labNationName.string="\u56fd\u53f7: "+e.nationName,this.nodeTabView.getComponent("tableView").initTableView(null!==(a=null===(t=e.royalList)||void 0===t?void 0:t.length)&&void 0!==a?a:0,{array:e.royalList,serverId:e.serverId,target:this})},t.prefabPath="nationRoyalMemberListPage",t.pageType=1,t.pageParent="nationWarMainPage",n([s(cc.Node)],t.prototype,"nodeTabView",void 0),n([s(cc.Label)],t.prototype,"labTopTitle",void 0),n([s(cc.Label)],t.prototype,"labMidTitle",void 0),n([s(cc.Label)],t.prototype,"labServerName",void 0),n([s(cc.Label)],t.prototype,"labNationName",void 0),a=n([o],t)}(e("basePage"));t.exports=p,cc._RF.pop()},{basePage:void 0}],NationWarMainPage:[function(e,t){"use strict";cc._RF.push(t,"ee3b2uPkcBOmq/rr/dGNHsa","NationWarMainPage");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,a=1,i=arguments.length;a<i;a++)for(var n in t=arguments[a])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},r=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},o=cc._decorator,s=o.ccclass,p=o.property,c=e("basePage"),h=e("langMgr"),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.nodeCityList=[],t.spriteNationName=null,t.btnRank=null,t.btnMilitary=null,t.btnTalent=null,t.btnAuction=null,t.btnRingBattle=null,t.btnShop=null,t.btnHelp=null,t.btnGoBattleground=null,t.labCurrRank=null,t.labCurrHonor=null,t.labCountDown=null,t.labCountDownTip=null,t.nodeBattleTip=null,t.nodeCountDown=null,t.nameFrames=[],t.spriteMilRankIcon=null,t._rankInfo=null,t._iconTween=null,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.fitTopMenu(),this.addUIEvent()},t.prototype.onEnable=function(){e.prototype.onEnable&&e.prototype.onEnable.call(this),this.addEvent()},t.prototype.onDisable=function(){e.prototype.onDisable&&e.prototype.onDisable.call(this),this.removeEvent()},t.prototype.addUIEvent=function(){var e=this;this.btnMilitary.node.on("click",function(){app.playSound("click"),e._rankInfo&&app.pages.windowsPageMilitaryRank.showPage({rankInfo:e._rankInfo})},this),this.btnAuction.node.on("click",function(){app.playSound("click"),app.player.sfAuctionList(2).then(function(e){var t=n({},e);t.type=2,app.pages.windowsPageAuction.showPage(t)}).catch(function(e){cc.warn("auction error: ",JSON.stringify(e))})},this),this.btnRingBattle.node.on("click",function(){var e;app.playSound("click"),null!==(e=app.lockFunConfig.NATION_RING)&&void 0!==e&&e.lock?app.showNotice(h.getString("nationWarMainPage",3)):app.player.sfQueryRingRank().then(function(e){if(!e.owner)return cc.log("\u73a9\u5bb6\u672a\u62a5\u540d\u64c2\u53f0\u8d5b"),app.battleType="ringpvpsave",void app.goToNormBattle();app.pages.windowsPageRingRank.showPage(Object.assign({},e))}).catch(function(e){cc.warn("\u56fd\u6218\u64c2\u53f0\u6392\u884c\u699c\u6570\u636e\u9519\u8bef",e),"ring finished"===e&&app.showNotice(h.getString("nationWarMainPage",3))})},this),this.btnTalent.node.on("click",function(){app.playSound("click"),app.pages.occthalentpage.showPage()},this),this.btnShop.node.on("click",function(){app.playSound("click"),app.db.checkFuncUnLock("SHOP_NATION")?app.pages.shoppage.showPage("nation"):app.showNotice("\u56fd\u6218\u5546\u5e97\u5c1a\u672a\u89e3\u9501")},this),this.btnRank.node.on("click",function(){app.playSound("click"),e._rankInfo&&app.pages.ranklistpage.showPage({rank:e._rankInfo,rtype:"military",title:null})},this),this.btnHelp.node.on("click",function(){app.playSound("click"),app.pages.windowspagetipshelp.showPage("1120")},this),this.btnGoBattleground.node.on("click",function(){app.playSound("click"),app.pages.fivewarmainpage.showPage()},this),this.nodeCityList.forEach(function(t,a){t.on(cc.Node.EventType.TOUCH_END,function(){var t,i=null===(t=app.fiveWarInfo)||void 0===t?void 0:t.areas[a];if(!i)return cc.warn("country information unknown");app.player.getOtherAreaInfo({areamark:i.areamark},function(t,a){e._showRoyalMember(t,a)})},e)})},t.prototype.addEvent=function(){eventMgr.on(eventStr.commonEvent.RefreshTime,this._renderCountDown,this),eventMgr.on(eventStr.redEvent.RefreshNationWarMainRed,this._renderRed,this),eventMgr.on(eventStr.militaryRank.RefreshMilitaryIcon,this._renderMilitary,this),cc.director.on("EVT_REFRESH_SELF_OWN_HONOR",this._renderHonor,this),cc.director.on("EVT_REFRESH_MILITARY_RANK_DATA",this.refreshMilitary,this)},t.prototype.removeEvent=function(){eventMgr.off(eventStr.commonEvent.RefreshTime,this._renderCountDown,this),eventMgr.off(eventStr.redEvent.RefreshNationWarMainRed,this._renderRed,this),eventMgr.off(eventStr.militaryRank.RefreshMilitaryIcon,this._renderMilitary,this),cc.director.off("EVT_REFRESH_SELF_OWN_HONOR",this._renderHonor,this),cc.director.off("EVT_REFRESH_MILITARY_RANK_DATA",this.refreshMilitary,this)},t.prototype._renderView=function(){this._renderHonor()},t.prototype._renderHonor=function(){this.labCurrHonor.string=""+h.getString("windowsPageMilitaryRank",0)+gUtils.showNum(app.player.getCount(38018))},t.prototype._renderMilitary=function(){app.loadTexture(app.db.getMilitRankIconByLv(app.player.getCount(38021)+1),this.spriteMilRankIcon,this.prefabPath),this._iconTween||(this._iconTween=cc.tween(this.spriteMilRankIcon.node).repeatForever(cc.tween().by(2,{y:30}).by(2,{y:-30}).delay(.1)).start())},t.prototype.setParam=function(){var e=this;app.player.sfGetNationInfo().then(function(t){e.spriteNationName.spriteFrame=e.nameFrames[t.game_type]}).catch(function(){}),this._renderView(),this._renderMilitary(),this._renderRed(),app.player.sfMilitaryRankInfo().then(function(t){app.player.sfWarBaseInfo(function(){cc.isValid(e)&&e._renderCountry()}),cc.isValid(e)&&(e._rankInfo=t,e.labCurrRank.string=""+h.getString("windowsPageMilitaryRank",1)+(e._rankInfo&&e._rankInfo.selfrank?e._rankInfo.selfrank:h.getString("windowsPageMilitaryRank",2)))}).catch(function(e){return cc.warn("\u519b\u8854\u8be6\u60c5\u9519\u8bef: ",e)}),cc.sys.localStorage.setItem("Last_Visit_Nation_Time"+app.player.id,app.player.getServerTime())},t.prototype.refreshMilitary=function(){var e=this;app.player.sfMilitaryRankInfo().then(function(t){cc.isValid(e)&&(e._rankInfo=t,e.labCurrRank.string=""+h.getString("windowsPageMilitaryRank",1)+(e._rankInfo&&e._rankInfo.selfrank?e._rankInfo.selfrank:h.getString("windowsPageMilitaryRank",2)))}).catch(function(e){return cc.warn("\u519b\u8854\u8be6\u60c5\u9519\u8bef: ",e)})},t.prototype._renderCountry=function(){for(var e,t,a,i,n,r,o,s,p,c,h,l,g=null!==(t=null===(e=app.fiveWarInfo)||void 0===e?void 0:e.areas)&&void 0!==t?t:[],d=0;d<g.length;d++){var u=g[d];if(cc.isValid(this.nodeCityList[d])){app.setNodeState(this.nodeCityList[d],!1);var f=null===(i=null===(a=this.nodeCityList[d])||void 0===a?void 0:a.getChildByName("CountryFlag"))||void 0===i?void 0:i.getComponent(cc.Sprite),m=null===(r=null===(n=this.nodeCityList[d])||void 0===n?void 0:n.getChildByName("ServName"))||void 0===r?void 0:r.getComponent(cc.Label);app.loadTexture(app.db.getCountryFlagByIndex(u.flag),f,this.prefabPath),cc.isValid(m)&&(m.string=""+gUtils.getServNameForShow(u.servid)),cc.isValid(null===(o=this.nodeCityList[d])||void 0===o?void 0:o.getChildByName("CountryFlag"))&&(this.nodeCityList[d].getChildByName("CountryFlag").opacity=255),cc.isValid(null===(s=this.nodeCityList[d])||void 0===s?void 0:s.getChildByName("ServName"))&&(this.nodeCityList[d].getChildByName("ServName").opacity=255),cc.isValid(null===(p=this.nodeCityList[d])||void 0===p?void 0:p.getChildByName("NameBg"))&&(this.nodeCityList[d].getChildByName("NameBg").opacity=255)}}for(;d<this.nodeCityList.length;++d)cc.isValid(this.nodeCityList[d])&&(app.setNodeState(this.nodeCityList[d],!0),cc.isValid(null===(c=this.nodeCityList[d])||void 0===c?void 0:c.getChildByName("CountryFlag"))&&(this.nodeCityList[d].getChildByName("CountryFlag").opacity=0),cc.isValid(null===(h=this.nodeCityList[d])||void 0===h?void 0:h.getChildByName("ServName"))&&(this.nodeCityList[d].getChildByName("ServName").opacity=0),cc.isValid(null===(l=this.nodeCityList[d])||void 0===l?void 0:l.getChildByName("NameBg"))&&(this.nodeCityList[d].getChildByName("NameBg").opacity=0))},t.prototype._renderCountDown=function(){if(!app.fiveWarInfo)return this.nodeCountDown.opacity=0,void(this.btnGoBattleground.node.active&&(this.btnGoBattleground.node.active=!1));var e=app.fiveWarInfo.getCountTime();this.btnGoBattleground.node.active=0!==app.fiveWarInfo.getState(),this.nodeCountDown.opacity=0===app.fiveWarInfo.getState()?0:255,this.labCountDownTip.string=""+e.title,this.labCountDown.string=e.diff},t.prototype._showRoyalMember=function(e,t){if(e)return"no open"===e&&app.showNotice(h.getString("nationWarMainPage",2)),void cc.warn("\u8bf7\u6c42\u56fd\u5bb6\u7687\u5ba4\u6210\u5458\u5217\u8868\u9519\u8bef",e);app.pages.nationRoyalMemberListPage.showPage({nationName:t.name,serverId:t.servid,royalList:t.palace})},t.prototype._renderRed=function(){app.pages.occthalentpage.refreshRed(this.btnTalent.node.getChildByName("rednotice")),app.pages.windowsPageMilitaryRank.refreshRed(this.btnMilitary.node.getChildByName("rednotice")),app.pages.windowsPageRingRank.refreshRed(this.btnRingBattle.node.getChildByName("rednotice"))},t.prefabPath="nationWarMainPage",t.pageType=0,t.checkBattleRed=function(e){var t=cc.sys.localStorage.getItem("Last_Visit_Nation_Time"+app.player.id),a=!0;if(t){var i=parseInt(t);a=!gUtils.checkTime(i)}return cc.isValid(e)&&cc.Node.isNode(e)&&(e.active=a),a},r([p({type:[cc.Node]})],t.prototype,"nodeCityList",void 0),r([p(cc.Sprite)],t.prototype,"spriteNationName",void 0),r([p(cc.Button)],t.prototype,"btnRank",void 0),r([p(cc.Button)],t.prototype,"btnMilitary",void 0),r([p(cc.Button)],t.prototype,"btnTalent",void 0),r([p(cc.Button)],t.prototype,"btnAuction",void 0),r([p(cc.Button)],t.prototype,"btnRingBattle",void 0),r([p(cc.Button)],t.prototype,"btnShop",void 0),r([p(cc.Button)],t.prototype,"btnHelp",void 0),r([p(cc.Button)],t.prototype,"btnGoBattleground",void 0),r([p({type:cc.Label,tooltip:"\u5f53\u524d\u6392\u540d"})],t.prototype,"labCurrRank",void 0),r([p({type:cc.Label,tooltip:"\u5f53\u524d\u8363\u8a89"})],t.prototype,"labCurrHonor",void 0),r([p({type:cc.Label,tooltip:"\u56fd\u5c55\u5f00\u59cb\u5012\u8ba1\u65f6"})],t.prototype,"labCountDown",void 0),r([p({type:cc.Label,tooltip:"\u591a\u8bed\u8a00-\u56fd\u5c55\u5f00\u59cb\u5012\u8ba1\u65f6"})],t.prototype,"labCountDownTip",void 0),r([p({type:cc.Node})],t.prototype,"nodeBattleTip",void 0),r([p({type:cc.Node})],t.prototype,"nodeCountDown",void 0),r([p({type:[cc.SpriteFrame]})],t.prototype,"nameFrames",void 0),r([p({type:cc.Sprite,tooltip:"\u519b\u8854icon"})],t.prototype,"spriteMilRankIcon",void 0),a=r([s],t)}(c);l.refreshRed=function(e){var t;return t=app.pages.occthalentpage.refreshRed()||app.pages.windowsPageMilitaryRank.refreshRed()||app.pages.windowsPageRingRank.refreshRed()||app.pages.nationWarMainPage.checkBattleRed(),e&&(e.active=t),t},t.exports=l,cc._RF.pop()},{basePage:void 0,langMgr:void 0}],RecordBroadcast:[function(e,t){"use strict";cc._RF.push(t,"f9eb1xamV5AlK2zW15chdTQ","RecordBroadcast");var a,i,n,r=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),o=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},s=cc._decorator,p=s.ccclass,c=s.property;(function(e){e[e.FOLD=0]="FOLD",e[e.UNFOLD=1]="UNFOLD"})(i||(i={})),function(e){e[e.NoseOut=0]="NoseOut",e[e.EdgeOut=1]="EdgeOut",e[e.Whup=2]="Whup"}(n||(n={}));var h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.pfbRecord=null,t.nodeScrollView=null,t.btnSwitch=null,t._foldState=i.FOLD,t._recordList=[],t._recordData=[],t._content=null,t}return r(t,e),t.prototype.onLoad=function(){this._content=this.nodeScrollView.getComponent(cc.ScrollView).content,this.addUIEvent()},t.prototype.init=function(){var e,t,a,i,n=app.fiveWarInfo.getWarGround();this._sortReport(null!==(t=null===(e=null==n?void 0:n.report)||void 0===e?void 0:e.left)&&void 0!==t?t:[],null!==(i=null===(a=null==n?void 0:n.report)||void 0===a?void 0:a.right)&&void 0!==i?i:[]),this._renderItems()},t.prototype._renderItems=function(){for(var e,t,a=0;a<this._recordData.length;++a){var i=this._recordData[a];if(i){var r=this._recordList[a];cc.isValid(r)||(r=cc.instantiate(this.pfbRecord),this._content.addChild(r),this._recordList[this._recordList.length]=r);var o,s="win"===i.result?i.l_role:i.r_role,p="win"===i.result?i.r_role:i.l_role;o=i.hpper<3e3?n.NoseOut:i.hpper<7e3?n.EdgeOut:n.Whup,r.getComponent("NationWarRecordItem").init({armyType:"left"===s.direction?0:1,lSerId:s.servid,lNick:null!==(e=s.rname)&&void 0!==e?e:"#unknown"+a,rSerId:p.servid,rNick:null!==(t=p.rname)&&void 0!==t?t:"#unknown"+a,result:o,videoId:i.videoid})}}this._setScrollEnable(this._foldState)},t.prototype.onEnable=function(){eventMgr.on(eventStr.fiveWar.GROUND_INFO,this.init,this),eventMgr.on(eventStr.fiveWar.GROUND_CHANGE,this.init,this)},t.prototype.onDisable=function(){eventMgr.off(eventStr.fiveWar.GROUND_INFO,this.init,this),eventMgr.off(eventStr.fiveWar.GROUND_CHANGE,this.init,this)},t.prototype.addUIEvent=function(){var e=this;this.btnSwitch.node.on("click",function(){app.playSound("click"),e._foldState=(e._foldState+1)%2;var t=e._foldState===i.FOLD;e.node.height+=400*(t?-1:1),e.nodeScrollView.height+=400*(t?-1:1),e.nodeScrollView.getChildByName("view").height+=400*(t?-1:1),e._setScrollEnable(e._foldState),e.btnSwitch.node.setScale(1,t?1:-1),e.scheduleOnce(function(){e.nodeScrollView.getComponent(cc.ScrollView).stopAutoScroll(),t&&e.nodeScrollView.getComponent(cc.ScrollView)[e._recordList.length<4?"scrollToTop":"scrollToBottom"](),e.nodeScrollView.getComponent(cc.Widget).updateAlignment(),e.btnSwitch.getComponent(cc.Widget).updateAlignment()})},this)},t.prototype._setScrollEnable=function(e){var t=e===i.FOLD?"_unregisterEvent":"_registerEvent";this.nodeScrollView.getComponent(cc.ScrollView)[t]()},t.prototype._sortReport=function(e,t){this._recordData.length=0;for(var a=e.length-1,i=t.length-1;a>=0&&i>=0&&this._recordData.length<20;)e[a].btime>=t[i].btime?this._recordData[this._recordData.length]=e[a--]:this._recordData[this._recordData.length]=t[i--];for(;a>=0&&this._recordData.length<20;)this._recordData[this._recordData.length]=e[a--];for(;i>=0&&this._recordData.length<20;)this._recordData[this._recordData.length]=t[i--];return this._recordData},o([c(cc.Prefab)],t.prototype,"pfbRecord",void 0),o([c(cc.Node)],t.prototype,"nodeScrollView",void 0),o([c(cc.Button)],t.prototype,"btnSwitch",void 0),o([p],t)}(cc.Component);t.exports=h,cc._RF.pop()},{}],RegisterCdkPage:[function(e,t){"use strict";cc._RF.push(t,"ec008ZGYUlMfa4cKYwKH3Da","RegisterCdkPage");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=cc._decorator,o=r.ccclass,s=r.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.btnConfirm=null,t.btnCancel=null,t.inputEdt=null,t._cancelCb=null,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(),this.handleUI()},t.prototype.setParam=function(e){this._cancelCb=e.cancelCb},t.prototype.start=function(){this.addUIEvent()},t.prototype.addUIEvent=function(){var e=this;this.btnConfirm.node.on("click",function(){if(e.inputEdt.string){var t=e.inputEdt.string;app.player.sfCreateRole(function(e){if(app.clickTwo=!1,e){switch(e){case"code nexist":e="\u60a8\u7684\u9650\u91cf\u6d4b\u8bd5\u6fc0\u6d3b\u7801\u9519\u8bef\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165";break;case"already confirm":e="\u6fc0\u6d3b\u5931\u8d25\uff0c\u8be5\u9650\u91cf\u6d4b\u8bd5\u6fc0\u6d3b\u7801\u5df2\u88ab\u4f7f\u7528\u3002"}app.showNotice(e)}else cc.director.emit("ACTIVE_CODE_SUCCESS")},t)}},this),this.btnCancel.node.on("click",function(){app.playSound("click"),"function"==typeof e._cancelCb&&e._cancelCb()},this)},t.prefabPath="registerCdkPage",t.pageType=1,n([s(cc.Button)],t.prototype,"btnConfirm",void 0),n([s(cc.Button)],t.prototype,"btnCancel",void 0),n([s(cc.EditBox)],t.prototype,"inputEdt",void 0),a=n([o],t)}(e("basePage"));t.exports=p,cc._RF.pop()},{basePage:void 0}],Typewriter:[function(e,t,a){"use strict";cc._RF.push(t,"c771fKVa8tIgY4zQZAzf/la","Typewriter");var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function a(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(a.prototype=t.prototype,new a)}),r=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o};Object.defineProperty(a,"__esModule",{value:!0});var o=cc._decorator,s=o.ccclass,p=(o.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._renderLab=null,t._roleLines=[],t._isBegan=!1,t._isPaused=!1,t._curInterval=0,t._lineBuff=[],t}return n(t,e),t.prototype.pauseWrite=function(){this._isPaused=!0},t.prototype.resumeWrite=function(){this._isPaused=!1},t.prototype.writeAllImmediate=function(){var e=this;this.pauseWrite(),this._roleLines.forEach(function(t){e._renderLab.string+=t.digitChar}),this._roleLines.length=0},t.prototype.beginWrite=function(){this._isBegan=!0},t.prototype.addRoleLines=function(e){var t;e instanceof Array?(t=this._roleLines).push.apply(t,e):this._roleLines.push(e)},t.prototype.onLoad=function(){this._renderLab=this.node.getComponent(cc.Label)},t.prototype.update=function(e){if(this._isBegan&&!this._isPaused&&(0!==this._roleLines.length||0!==this._lineBuff.length))if(this._curInterval>0)this._curInterval-=e;else if(this._lineBuff.length>0&&this.renderLabel(this._lineBuff.shift()),this._roleLines.length>0){var t=this._roleLines.shift();this._lineBuff.push(t),this._curInterval+=t.delayTime}},t.prototype.renderLabel=function(e){cc.isValid(this._renderLab)&&(this._renderLab.string+=e.digitChar)},r([s],t)}(cc.Component));a.default=p,cc._RF.pop()},{}],WindowsPageAppointSuccess:[function(e,t){"use strict";cc._RF.push(t,"30cc1yCqOJGTYw8Q+dxOzNp","WindowsPageAppointSuccess");var a,i,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),r=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},o=e("../lang/langMgr"),s=cc._decorator,p=s.ccclass,c=s.property,h=e("basePage");(function(e){e[e.Appoint=0]="Appoint",e[e.Change=1]="Change"})(i||(i={}));var l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.appointLayer=null,t.centerGeneralContent=null,t.centerBuffTips=[],t.centerNameTxt=null,t.centerNameImg=null,t.centerOfficeName=null,t.changeLayer=null,t.pfbGeneralItem=null,t.leftGenContent=null,t.rightGenContent=null,t.leftBufTxts=[],t.rightBufTxts=[],t.leftOfficeName=null,t.rightOfficeName=null,t.changeTip=null,t.centerFrames=[],t.leftFrames=[],t.rightFrames=[],t.labAppointGenName=[],t.spfArrow=[],t.spTitleAnim=null,t._leftGeneral=null,t._rightGeneral=null,t._centerGeneral=null,t.centerBuffChange=null,t.centerPos=0,t.layerType=i.Appoint,t.centerGuid="",t.leftPos=0,t.rightPos=0,t.powerChange=0,t.leftGuid="",t.rightGuid="",t.leftBuffChange=null,t.rightBuffChange=null,t}var a;return n(t,e),a=t,t.prototype.onLoad=function(){a.instance=this},t.prototype.start=function(){this.creatMask(!0),this.handleUI()},t.prototype.setParam=function(e){cc.log("appoint success",e),this.layerType=e.type,e.type===i.Appoint?(this.centerPos=e.centerPos,this.centerGuid=e.centerGuid,this.centerBuffChange=e.centerBuffChange):e.type===i.Change&&(this.leftGuid=e.leftGuid,this.rightGuid=e.rightGuid,this.leftBuffChange=e.leftBuffChange,this.rightBuffChange=e.rightBuffChange),this.powerChange=e.powerChange,cc.log("=== change power",this.powerChange),this.refreshUI()},t.prototype.refreshUI=function(){app.playUpgradeAnim({spComp:this.spTitleAnim,startName:"appear",endName:"loop",index:2,target:this}),this.layerType===i.Appoint?(this.appointLayer.active=!0,this.changeLayer.active=!1,this.initNormalAppoint()):this.layerType===i.Change&&(this.appointLayer.active=!1,this.changeLayer.active=!0,this.initChangeAppoint())},t.prototype._renderPropertyChange=function(e,t,a){var i=this;void 0===a&&(a=""),e.forEach(function(e){e.string=a;var t=e.node.getChildByName("Arrow");cc.isValid(t)&&(t.getComponent(cc.Sprite).spriteFrame=i.spfArrow[0])});var n=0;for(var r in t)if(t.hasOwnProperty(r)){var s=t[r];if(s<=0)continue;if(!cc.isValid(e[n]))continue;e[n].node.active=!0;var p=s>0?"+":"",c=app.db.getPropertyIdByEn(r),h=c&&2==app.db.dbProperty[c].NUMTYPE?""+p+s/10+"%":""+p+s;e[n].string+=o.getString("WindowsPageAppointSuccess",0,[app.db.getPropertyCnByEn(r),h]),e[n]._forceUpdateRenderData(),++n}},t.prototype.initNormalAppoint=function(){this._renderPropertyChange(this.centerBuffTips,this.centerBuffChange,o.getString("WindowsPageAppointSuccess",4));var e=app.player.general[this.centerGuid];cc.isValid(this._centerGeneral)||(this._centerGeneral=cc.instantiate(this.pfbGeneralItem),this.centerGeneralContent.addChild(this._centerGeneral),this._centerGeneral.setPosition(cc.Vec2.ZERO)),this._centerGeneral.getComponent("generalPortraitItem").initForOffice({gsid:e.gsid,level:""+(e.level||1),skinId:e.skin}),this.centerNameTxt.string=e.name;var t=app.db.getOfficeInfoByPos(this.centerPos),a=app.db.getOfficeNameTitlePathByPos(this.centerPos);app.loadTexture(a,this.centerNameImg),this.centerOfficeName.string=""+t.NAME;var i=this.getFrameTypeByPos(this.centerPos);this.centerFrames.forEach(function(e,t){e.active=Boolean(i===t)}),this.centerNameImg.node.y=2===i?45:35},t.prototype.initChangeAppoint=function(){this.leftPos=app.db.getOfficePosByGuid(this.leftGuid),this.leftOfficeName.node.active=Boolean(this.leftPos);var e=app.db.getOfficeNameTitlePathByPos(this.leftPos);app.loadTexture(e,this.leftOfficeName);var t=[],a=app.player.general[this.leftGuid];t[0]=a.gsid,cc.isValid(this._leftGeneral)||(this._leftGeneral=cc.instantiate(this.pfbGeneralItem),this.leftGenContent.addChild(this._leftGeneral),this._leftGeneral.setPosition(cc.Vec2.ZERO)),this._leftGeneral.getComponent("generalPortraitItem").initForOffice({gsid:a.gsid,level:""+(a.level||1),skinId:a.skin});var i=this.getFrameTypeByPos(this.leftPos);this.leftFrames.forEach(function(e,t){e.active=Boolean(i===t)}),this.leftOfficeName.node.y=2===i?45:35,this.rightPos=app.db.getOfficePosByGuid(this.rightGuid),this.rightOfficeName.node.active=Boolean(this.rightPos);var n=0;this.leftPos>0&&n++,this.rightPos>0&&n++;var r=["",o.getString("WindowsPageAppointSuccess",2),o.getString("WindowsPageAppointSuccess",3)];this.changeTip.string=o.getString("WindowsPageAppointSuccess",1,r[n]);var s=app.db.getOfficeNameTitlePathByPos(this.rightPos);app.loadTexture(s,this.rightOfficeName);var p=app.player.general[this.rightGuid];t[1]=p.gsid,cc.isValid(this._rightGeneral)||(this._rightGeneral=cc.instantiate(this.pfbGeneralItem),this.rightGenContent.addChild(this._rightGeneral),this._rightGeneral.setPosition(cc.Vec2.ZERO)),this._rightGeneral.getComponent("generalPortraitItem").initForOffice({gsid:p.gsid,level:""+(p.level||1),skinId:p.skin}),this.labAppointGenName.forEach(function(e,a){var i=app.db.getGNameByGsid(t[a]);e.string=i});var c=this.getFrameTypeByPos(this.rightPos);this.rightFrames.forEach(function(e,t){e.active=Boolean(c===t)}),this.rightOfficeName.node.y=2===c?45:35;var h=0;for(var l in this.leftBuffChange)if(this.leftBuffChange.hasOwnProperty(l)){if((f=this.leftBuffChange[l])<=0)continue;this.leftBufTxts[h].node.active=!0;var g=f>0?"+":"",d=(m=app.db.getPropertyIdByEn(l))&&2==app.db.dbProperty[m].NUMTYPE?""+g+f/10+"%":""+g+f;this.leftBufTxts[h].string=""+app.db.getPropertyCnByEn(l)+d,this.leftBufTxts[h]._forceUpdateRenderData();var u=this.leftBufTxts[h].node.getChildByName("Arrow");cc.isValid(u)&&(u.getComponent(cc.Sprite).spriteFrame=this.spfArrow[f>=0?0:1]),h++}for(var l in h=0,this.rightBuffChange)if(this.rightBuffChange.hasOwnProperty(l)){var f,m;if((f=this.rightBuffChange[l])<=0)continue;this.rightBufTxts[h].node.active=!0,g=f>0?"+":"",d=(m=app.db.getPropertyIdByEn(l))&&2==app.db.dbProperty[m].NUMTYPE?""+g+f/10+"%":""+g+f,this.rightBufTxts[h].string=""+app.db.getPropertyCnByEn(l)+d,this.rightBufTxts[h]._forceUpdateRenderData(),u=this.rightBufTxts[h].node.getChildByName("Arrow"),cc.isValid(u)&&(u.getComponent(cc.Sprite).spriteFrame=this.spfArrow[f>=0?0:1]),h++}},t.prototype.onDestroy=function(){app.player.sfGetOfficialInfo().then(function(e){cc.director.emit("EVT_GENERAL_APPOINT_REFRESH_UI",e)}).catch(function(e){cc.warn("sfGetOfficialInfo error",e)}),cc.director.emit("EVT_OFFICE_POWER_CHANGE",this.powerChange);var t=this.layerType===i.Appoint?[this.centerPos]:[this.leftPos,this.rightPos];cc.director.emit("EVT_OFFICE_PLAY_FLASH_ANIM",t),e.prototype.onDestroy.call(this)},t.prototype.getFrameTypeByPos=function(e){for(var t=[[1,2,3,4],[5,6],[7]],a=0;a<t.length;++a)if(t[a].includes(e))return a;return 0},t.prefabPath="windowsPageAppointSuccess",t.pageType=1,r([c({type:cc.Node})],t.prototype,"appointLayer",void 0),r([c({type:cc.Node})],t.prototype,"centerGeneralContent",void 0),r([c(cc.Label)],t.prototype,"centerBuffTips",void 0),r([c(cc.Label)],t.prototype,"centerNameTxt",void 0),r([c(cc.Sprite)],t.prototype,"centerNameImg",void 0),r([c(cc.Label)],t.prototype,"centerOfficeName",void 0),r([c(cc.Node)],t.prototype,"changeLayer",void 0),r([c(cc.Prefab)],t.prototype,"pfbGeneralItem",void 0),r([c({type:cc.Node})],t.prototype,"leftGenContent",void 0),r([c({type:cc.Node})],t.prototype,"rightGenContent",void 0),r([c({type:[cc.Label]})],t.prototype,"leftBufTxts",void 0),r([c({type:[cc.Label]})],t.prototype,"rightBufTxts",void 0),r([c({type:cc.Sprite})],t.prototype,"leftOfficeName",void 0),r([c({type:cc.Sprite})],t.prototype,"rightOfficeName",void 0),r([c({type:cc.Label})],t.prototype,"changeTip",void 0),r([c([cc.Node])],t.prototype,"centerFrames",void 0),r([c([cc.Node])],t.prototype,"leftFrames",void 0),r([c([cc.Node])],t.prototype,"rightFrames",void 0),r([c([cc.Label])],t.prototype,"labAppointGenName",void 0),r([c([cc.SpriteFrame])],t.prototype,"spfArrow",void 0),r([c(sp.Skeleton)],t.prototype,"spTitleAnim",void 0),a=r([p],t)}(h);t.exports=l,cc._RF.pop()},{"../lang/langMgr":void 0,basePage:void 0}],WindowsPageAuctionBuyTips:[function(e,t){"use strict";cc._RF.push(t,"02318jPpbdKZ5waGRdwsAHf","WindowsPageAuctionBuyTips");var a,i,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),r=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},o=this&&this.__awaiter||function(e,t,a,i){return new(a||(a=Promise))(function(n,r){function o(e){try{p(i.next(e))}catch(t){r(t)}}function s(e){try{p(i.throw(e))}catch(t){r(t)}}function p(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(o,s)}p((i=i.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var a,i,n,r,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(e){return function(t){return p([e,t])}}function p(r){if(a)throw new TypeError("Generator is already executing.");for(;o;)try{if(a=1,i&&(n=2&r[0]?i.return:r[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,r[1])).done)return n;switch(i=0,n&&(r=[2&r[0],n.value]),r[0]){case 0:case 1:n=r;break;case 4:return o.label++,{value:r[1],done:!1};case 5:o.label++,i=r[1],r=[0];continue;case 7:r=o.ops.pop(),o.trys.pop();continue;default:if(!(n=(n=o.trys).length>0&&n[n.length-1])&&(6===r[0]||2===r[0])){o=0;continue}if(3===r[0]&&(!n||r[1]>n[0]&&r[1]<n[3])){o.label=r[1];break}if(6===r[0]&&o.label<n[1]){o.label=n[1],n=r;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(r);break}n[2]&&o.ops.pop(),o.trys.pop();continue}r=t.call(e,o)}catch(s){r=[6,s],i=0}finally{a=n=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},p=e("../lang/langMgr"),c=cc._decorator,h=c.ccclass,l=c.property,g=e("basePage");(function(e){e[e.None=-1]="None",e[e.Legion=0]="Legion",e[e.AllServer=1]="AllServer",e[e.NationWar=2]="NationWar"})(i||(i={}));var d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.btnConfirm=null,t.labCount=null,t.labPropName=null,t.btnTxt=null,t.btnTxtFrames=[],t.titleSp=null,t.titleFrames=[],t.spCurrencyIcon=null,t._curData=null,t}var a;return n(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.creatMask(!0)},t.prototype.start=function(){this.addUIEvent()},t.prototype.setParam=function(e){this._curData=e,this.renderUI()},t.prototype.renderUI=function(){var e;this.labPropName.string=app.db.getPropsName(this._curData.gsid),this.labCount.string=""+this._curData.price,this.titleSp.spriteFrame=this.titleFrames[Number(this._curData.isOnce)],this.btnTxt.spriteFrame=this.btnTxtFrames[Number(this._curData.isOnce)],app.loadTexture(app.db.getPropsIconPath(null!==(e=this._curData.currencyId)&&void 0!==e?e:38005),this.spCurrencyIcon,this.prefabPath)},t.prototype.addUIEvent=function(){var e=this;this.btnConfirm.node.on("click",function(){return o(e,void 0,void 0,function(){var e,t,a,i,n,r;return s(this,function(o){switch(o.label){case 0:app.playSound("click"),e={id:this._curData.id,price:this._curData.price,isonce:Number(this._curData.isOnce)},o.label=1;case 1:return o.trys.push([1,3,,4]),t=this._curData.referenceData,[4,app.player.sfBuyAuction(this._curData.type,e)];case 2:if((a=o.sent()).error)return[2,app.showNotice(a.error)];for(i=[],n=0;n<t.length;++n)if(t[n]._id===a.auction._id){t[n]=a.auction;break}return i[i.length]=a.auction._id,cc.director.emit("EVT_REFRESH_AUCTION_ITEMS",i),a.success?(app.player.reduceItem(a.castitems),cc.isValid(app.pages.windowsPageAuction.instance)&&app.pages.windowsPageAuction.instance.renderAccount()):app.showNotice(p.getString("WindowsPageAuctionBuyTips",0)),cc.isValid(this)&&this.onClose(),[3,4];case 3:return"prop limit"===(r=o.sent())?app.showNotice(p.getString("WindowsPageAuctionBuyTips",1)):app.showNotice(p.getString("WindowsPageAuctionBuyTips",0)),cc.isValid(this)&&this.onClose(),cc.warn("auction buy error: ",JSON.stringify(r)),[3,4];case 4:return[2]}})})},this)},t.prefabPath="windowsPageAuctionBuyTips",t.pageType=1,r([l({type:cc.Button})],t.prototype,"btnConfirm",void 0),r([l(cc.Label)],t.prototype,"labCount",void 0),r([l(cc.Label)],t.prototype,"labPropName",void 0),r([l(cc.Sprite)],t.prototype,"btnTxt",void 0),r([l([cc.SpriteFrame])],t.prototype,"btnTxtFrames",void 0),r([l(cc.Sprite)],t.prototype,"titleSp",void 0),r([l([cc.SpriteFrame])],t.prototype,"titleFrames",void 0),r([l(cc.Sprite)],t.prototype,"spCurrencyIcon",void 0),a=r([h],t)}(g);t.exports=d,cc._RF.pop()},{"../lang/langMgr":void 0,basePage:void 0}],WindowsPageAuctionRecordList:[function(e,t){"use strict";cc._RF.push(t,"4834f/VDDdJbKHT6Ua9A3C2","WindowsPageAuctionRecordList");var a,i,n,r=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),o=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},s=cc._decorator,p=s.ccclass,c=s.property,h=e("basePage");(function(e){e[e.Person=0]="Person",e[e.Other=1]="Other"})(i||(i={})),function(e){e[e.None=-1]="None",e[e.Legion=0]="Legion",e[e.AllServer=1]="AllServer",e[e.NationWar=2]="NationWar"}(n||(n={}));var l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.selfTitle=null,t.legionTitle=null,t.historyList=null,t.spOtherMenu=null,t.legionTip=null,t._menuIndex=i.Person,t._historyData=null,t._type=n.None,t}var a;return r(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.node.getComponent("menu").init(this)},t.prototype.setParam=function(e){this._historyData=e.history,this._type=e.type,i.Person,i.Other,i.Other,this.legionTip.opacity=this._type===n.Legion?255:0,this.node.getComponent("menu").setMenuIndex(this._menuIndex)},t.prototype.menuHandler=function(e){return this._menuIndex=e,this.selfTitle.active=this._menuIndex===i.Person,this.legionTitle.active=this._menuIndex===i.Other,this.renderUI(),!0},t.prototype.refreshMenuRed=function(){return!1},t.prototype.renderUI=function(){var e=this._menuIndex===i.Person?this._historyData.owner:this._historyData.other;this.historyList.getComponent("tableView").initTableView(e.length,{array:e,target:this,historyType:this._menuIndex===i.Person?i.Person:this._type+1})},t.prefabPath="windowsPageAuctionRecordList",t.pageType=1,o([c({type:cc.Node})],t.prototype,"selfTitle",void 0),o([c({type:cc.Node})],t.prototype,"legionTitle",void 0),o([c({type:cc.Node})],t.prototype,"historyList",void 0),o([c(cc.Sprite)],t.prototype,"spOtherMenu",void 0),o([c(cc.Node)],t.prototype,"legionTip",void 0),a=o([p],t)}(h);t.exports=l,cc._RF.pop()},{basePage:void 0}],WindowsPageAuction:[function(e,t){"use strict";cc._RF.push(t,"7ebc1hYgkZHYY0Nzc7mtC9R","WindowsPageAuction");var a,i,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),r=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},o=this&&this.__awaiter||function(e,t,a,i){return new(a||(a=Promise))(function(n,r){function o(e){try{p(i.next(e))}catch(t){r(t)}}function s(e){try{p(i.throw(e))}catch(t){r(t)}}function p(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(o,s)}p((i=i.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var a,i,n,r,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(e){return function(t){return p([e,t])}}function p(r){if(a)throw new TypeError("Generator is already executing.");for(;o;)try{if(a=1,i&&(n=2&r[0]?i.return:r[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,r[1])).done)return n;switch(i=0,n&&(r=[2&r[0],n.value]),r[0]){case 0:case 1:n=r;break;case 4:return o.label++,{value:r[1],done:!1};case 5:o.label++,i=r[1],r=[0];continue;case 7:r=o.ops.pop(),o.trys.pop();continue;default:if(!(n=(n=o.trys).length>0&&n[n.length-1])&&(6===r[0]||2===r[0])){o=0;continue}if(3===r[0]&&(!n||r[1]>n[0]&&r[1]<n[3])){o.label=r[1];break}if(6===r[0]&&o.label<n[1]){o.label=n[1],n=r;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(r);break}n[2]&&o.ops.pop(),o.trys.pop();continue}r=t.call(e,o)}catch(s){r=[6,s],i=0}finally{a=n=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},p=e("langMgr"),c=cc._decorator,h=c.ccclass,l=c.property,g=e("basePage");(function(e){e[e.None=-1]="None",e[e.Legion=0]="Legion",e[e.AllServer=1]="AllServer",e[e.NationWar=2]="NationWar"})(i||(i={}));var d=["legion_time","north_time","nation_time"],u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.auctionList=null,t.labBonus=null,t.btnHelp=null,t.btnAuctionRecord=null,t.btnMyAuction=null,t.labTime=null,t.labTimeState=null,t.labNoBonus=null,t.briefContainer=null,t.noBriefTip=null,t.scrollSpeed=1.2,t.scrollSpacingY=3,t.gameRuleMask=null,t.scrollDelayTime=2,t.flowTipFrames=[],t.legionBonusTip=null,t.auctionDataList=[],t._type=i.None,t._coin="",t._surplusTime=0,t._scheduleState=!1,t._briefList=[],t._briefNodeList=[],t._curBriefIdx=0,t._currencyList=[],t}var a;return n(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,this.stopBgNodeEvent(),this.handleUI()},t.prototype.start=function(){this.addUIEvent(),this.addEvent()},t.prototype.setParam=function(e){this.auctionDataList=e.auctions,this._type=e.type,this._type==i.AllServer&&(this._coin="38005"),this._currencyList=this.auctionDataList.reduce(function(e,t){return void 0===t.coin||e.includes(t.coin)||(e[e.length]=t.coin),e},[]),this.renderUI(),this.legionBonusTip.opacity=this._type===i.Legion?255:0,this.labNoBonus.node.active=!e.bonus.bounce,this.labNoBonus.node.active&&(this.labBonus.string=p.getString("WindowsPageAuction",6)),this.labBonus.node.parent.parent.active=this.auctionDataList.length>0,this.labBonus.node.parent.active=e.bonus.bounce;var t=e.bonus[app.player.id]?e.bonus[app.player.id]:e.bonus.def;t=gUtils.isNaN(t)?0:t,this.labBonus.string=""+t,this.gameRuleMask.active=this.auctionDataList.length<=0,app.pages.activityyblbpage.isTan()&&app.pages.activityyblbpage.showPage()},t.prototype.renderUI=function(){if(this.renderAccount(),this.noBriefTip.opacity=this.auctionDataList.length>0?0:255,this._genBriefs(),this._exeBriefScroll(),this.auctionDataList.length>0){if(this.auctionList.getComponent("tableView").initTableView(this.auctionDataList.length,{array:this.auctionDataList,target:this,type:this._type}),this._surplusTime=this._calculateSurplusTime()/1e3|0,this._surplusTime<=0)return this.labTime.string="00:00:00",void(this.labTimeState.string=p.getString("WindowsPageAuction",2));this._cancelCountDown(),this._scheduleState=!0,this._countDown(),this.schedule(this._countDown,1)}else this.labTime.node.parent.opacity=0;this._checkRebeck()},t.prototype.addUIEvent=function(){var e=this;this.btnHelp.node.on("click",function(){app.playSound("click"),app.pages.windowspagetipshelp.showPage("1082")},this),this.btnMyAuction.node.on("click",function(){app.playSound("click");var t=e._handlePersonData();cc.isValid(app.pages.windowsPagePersonAuctionList.instance)||e.btnMyAuction.node.getComponent("menuBtnItem").setRed(!1),app.pages.windowsPagePersonAuctionList.showPage({personAuctionsRef:t,target:e})},this),this.btnAuctionRecord.node.on("click",function(){return o(e,void 0,void 0,function(){var e,t;return s(this,function(a){switch(a.label){case 0:app.playSound("click"),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,app.player.sfQueryAuctionHistory(this._type)];case 2:return e=a.sent(),app.pages.windowsPageAuctionRecordList.showPage({history:e,type:this._type}),[3,4];case 3:return t=a.sent(),cc.warn("query auction history err: ",JSON.stringify(t)),[3,4];case 4:return[2]}})})},this)},t.prototype._calculateSurplusTime=function(){return Math.max.apply(Math,this.auctionDataList.map(function(e){return e.expireAt}))-app.player.getServerTime()},t.prototype._calcOpenSurplusTime=function(){var e=this;return Math.min.apply(Math,this.auctionDataList.filter(function(t){return!e._isPastDue(t)}).map(function(e){return e.start}))-app.player.getServerTime()},t.prototype._countDown=function(){var e=this._calcOpenSurplusTime()/1e3|0,t=this._calculateSurplusTime()/1e3|0;e>0?(this.labTime.string=""+gUtils.getCountDownStr(1e3*e),this.labTimeState.string=p.getString("WindowsPageAuction",1)):t>0?(this.labTime.string=""+gUtils.getCountDownStr(1e3*t),this.labTimeState.string=p.getString("WindowsPageAuction",2)):(this.labTime.string="00:00:00",this.labTimeState.string=p.getString("WindowsPageAuction",2),this._cancelCountDown())},t.prototype._cancelCountDown=function(){this._scheduleState&&(this.unschedule(this._countDown),this._scheduleState=!1)},t.prototype.addEvent=function(){cc.director.on("EVT_REFRESH_AUCTION_ITEMS",this._checkRebeck,this)},t.prototype.onDestroy=function(){e.prototype.onDestroy.call(this),this.removeEvent();try{var t=d[this._type],a=Math.max.apply(Math,this.auctionDataList.map(function(e){return e.expireAt})),i=app.redDataServer.auction[t].etime;app.redDataServer.auction[t].etime=Math.max(i,a)}catch(n){cc.warn("refresh redDataServer auction info err: ",n)}},t.prototype.removeEvent=function(){cc.director.targetOff(this)},t.prototype._handlePersonData=function(){return this.auctionDataList.filter(function(e){return Boolean(e.care)})},t.prototype._checkRebeck=function(){return o(this,void 0,Promise,function(){var e,t,a,i,n,r,o=this;return s(this,function(s){switch(s.label){case 0:if((e=this.auctionDataList.filter(function(e){return!o._isPastDue(e)}).filter(function(e){return e.history.slice(0,e.history.length-1).filter(function(e){return e.rid===app.player.id&&!e.state}).reduce(function(e,t){return e+t.price},0)>0}).map(function(e){return e._id})).length<=0)return[2];s.label=1;case 1:return s.trys.push([1,3,,4]),[4,app.player.sfAuctionRefund(this._type,{ids:e})];case 2:for(t=s.sent(),a=!1,i=0,n=t.items;i<n.length;i++)if(n[i].COUNT>0){a=!0;break}return a?(app.player.addItem(t.items),this.freshAuctionListRef({type:this._type,auctions:t.auctions}),this.renderAccount(),this.btnMyAuction.node.getComponent("menuBtnItem").setRed(!0),app.showNotice(p.getString("WindowsPageAuction",0)),[3,4]):[2];case 3:return r=s.sent(),cc.warn("reback cost err: ",JSON.stringify(r)),[3,4];case 4:return[2]}})})},t.prototype.freshAuctionListRef=function(e){var t=this,a=e.type,i=e.auctions,n=e.isObjAss;if(a===this._type&&i instanceof Array&&!(i.length<=0)){var r=i.map(function(e){for(var a=0;a<t.auctionDataList.length;++a)if(t.auctionDataList[a]._id===e._id){t.auctionDataList[a]=n?Object.assign(t.auctionDataList[a],e):e;break}return e._id});cc.director.emit("EVT_REFRESH_AUCTION_ITEMS",r)}},t.prototype.renderAccount=function(){this.node.getComponent("currency").refreshCoin(this._currencyList)},t.prototype.refreshBonus=function(){this.labBonus.string=""+this.auctionDataList.reduce(function(e,t){var a=t.bounce[app.player.id]?t.bounce[app.player.id]:t.bounce.def;return e+(gUtils.isNaN(a)?0:a)},0)},t.prototype._isPastDue=function(e){return app.player.getServerTime()>=e.expireAt},t.prototype._genBriefs=function(){this._briefList=this.auctionDataList.filter(function(e){return e.history.length>0}).reduce(function(e,t){var a=Object.assign({gsid:t.item.gsid,id:t._id},t.history[t.history.length-1]);return e[e.length]=a,e},[])},t.prototype._exeBriefScroll=function(){var e=this,t=this.briefContainer.children[0];this.briefContainer.children.forEach(function(e){return e.opacity=0});for(var a=Math.min(6,this._briefList.length),i=function(a){var i=n.briefContainer.children[a],r=function(){i.opacity=255,i.setPosition(cc.v2(0,-a*(e.scrollSpacingY+t.height))),e._renderBrief(i,e._briefList[a]),e._curBriefIdx++,e._briefNodeList[e._briefNodeList.length]=i};cc.isValid(i)?r():n.scheduleOnce(function(){i=cc.instantiate(t),e.briefContainer.addChild(i),r()},.05*a)},n=this,r=0;r<a;r++)i(r)},t.prototype._renderBrief=function(e,t){if(!cc.isValid(e))return cc.warn("brief rich text is not valid");if(e.briefInfo=t,!t)return e.opacity=0;var a=t.price,i=app.db.getPropsName(t.gsid),n=p.getString("WindowsPageAuction",t.isonce?3:4),r=app.db.getPropsInfoByGsid(this._coin).NAME||"#unknown";e.getComponent(cc.RichText).string=p.getString("WindowsPageAuction",5,a,r,n,i)},t.prototype.addBriefMsg=function(e,t){if(t===this._type){for(var a=this._briefList.length-1;a>=0;--a){var i=this._briefList[a];i.id===e.id&&(i.isRepeat=!0)}if(this._briefNodeList.reduce(function(e,t){return t.opacity>0&&e++,e},0)<6){var n=this.briefContainer.children[0],r=null;for(a=0;a<this._briefNodeList.length;++a)if(0===this._briefNodeList[a].opacity){r=this._briefNodeList[a];break}cc.isValid(r)||(r=cc.instantiate(n),this.briefContainer.addChild(r),this._briefNodeList[this._briefNodeList.length]=r),r.opacity=255,r.setPosition(cc.v2(0,-this._briefList.length*(this.scrollSpacingY+n.height))),this._renderBrief(r,e),this._curBriefIdx++}this._briefList[this._briefList.length]=e,this._briefList.sort(function(e,t){return e.create-t.create})}},t.prototype.update=function(e){if(this.scrollDelayTime>0)this.scrollDelayTime-=e;else if(this._briefNodeList.reduce(function(e,t){return t.opacity>0&&e++,e},0)>5)for(var t=5;t>=0;--t){var a=this._briefNodeList[t];if(!cc.isValid(a))break;if(a.y+=this.scrollSpeed,a.y>a.height){a.setPosition(cc.v2(0,-5*(this.scrollSpacingY+a.height))),this._briefNodeList.splice(t,1),this._briefNodeList.push(a);var i=!1,n=a.briefInfo;if(n&&n.isRepeat){var r=this._briefList.indexOf(n);r>=0&&(this._briefList.splice(r,1),i=!0)}this._briefList.length>5?(this._curBriefIdx>=this._briefList.length&&(this._curBriefIdx%=this._briefList.length),this._renderBrief(a,this._briefList[this._curBriefIdx]),!i&&this._curBriefIdx++):(this._curBriefIdx=this._briefList.length,a.opacity=0)}}},t.prefabPath="windowsPageAuction",r([l({type:cc.Node})],t.prototype,"auctionList",void 0),r([l({type:cc.Label})],t.prototype,"labBonus",void 0),r([l({type:cc.Button})],t.prototype,"btnHelp",void 0),r([l({type:cc.Button})],t.prototype,"btnAuctionRecord",void 0),r([l({type:cc.Button})],t.prototype,"btnMyAuction",void 0),r([l(cc.Label)],t.prototype,"labTime",void 0),r([l(cc.Label)],t.prototype,"labTimeState",void 0),r([l(cc.Label)],t.prototype,"labNoBonus",void 0),r([l(cc.Node)],t.prototype,"briefContainer",void 0),r([l(cc.Node)],t.prototype,"noBriefTip",void 0),r([l],t.prototype,"scrollSpeed",void 0),r([l],t.prototype,"scrollSpacingY",void 0),r([l(cc.Node)],t.prototype,"gameRuleMask",void 0),r([l],t.prototype,"scrollDelayTime",void 0),r([l([cc.SpriteFrame])],t.prototype,"flowTipFrames",void 0),r([l(cc.Node)],t.prototype,"legionBonusTip",void 0),a=r([h],t)}(g);t.exports=u,cc._RF.pop()},{basePage:void 0,langMgr:void 0}],WindowsPageCompleteChoiceSkill:[function(e,t){"use strict";cc._RF.push(t,"cb4ffcHyEREjKi79j7noW6p","WindowsPageCompleteChoiceSkill");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=e("../lang/langMgr"),o=cc._decorator,s=o.ccclass,p=o.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.btnConfirm=null,t.oldSkillItems=[],t.newSkillItems=[],t.skillCount=null,t._generalGuid="",t._oldSkillGuids=[],t._newSkillGuids=[],t._targetCtr=null,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},t.prototype.start=function(){},t.prototype.handleUI=function(){var t=this;e.prototype.handleUI.call(this),this.btnConfirm.on("click",function(){var e=window.app;e.playSound("click"),e.player.sfMountChoiceSkill(t._generalGuid,t._newSkillGuids).then(function(a){cc.log(a),e.player.reduceItem({GSID:30047,COUNT:1}),e.player.addGeneral(a),cc.director.emit("EVT_REFRESH_EXCLUS_INFO",t._newSkillGuids),cc.isValid(t._targetCtr)&&"function"==typeof t._targetCtr.onClose&&t._targetCtr.onClose(),t.onClose()}).catch(function(e){cc.error(e)})},this)},t.prototype.setParam=function(e){var t=this;this._oldSkillGuids=e.oldSkillGuids,this._newSkillGuids=e.newSkillGuids,this._targetCtr=e.target,this._generalGuid=e.generalGuid,this.refreshSkillItems(this.oldSkillItems,this._oldSkillGuids),this.refreshSkillItems(this.newSkillItems,this._newSkillGuids);var a=this._oldSkillGuids.reduce(function(e,a){return t._newSkillGuids.includes(a)||e++,e},0);this.skillCount.string=r.getString("WindowsPageCompleteChoiceSkill",0,a)},t.prototype.refreshSkillItems=function(e,t){e.forEach(function(e,a){if(cc.isValid(e)){var i=t[a];e.active=Boolean(i),e.active&&cc.isValid(e.getComponent("skillIExclusItem"))&&e.getComponent("skillIExclusItem").refreshUI(i)}})},t.prefabPath="windowsPageCompleteChoiceSkill",t.pageType=1,n([p({type:cc.Node})],t.prototype,"btnConfirm",void 0),n([p({type:[cc.Node]})],t.prototype,"oldSkillItems",void 0),n([p({type:[cc.Node]})],t.prototype,"newSkillItems",void 0),n([p(cc.Label)],t.prototype,"skillCount",void 0),a=n([s],t)}(e("basePage"));t.exports=c,cc._RF.pop()},{"../lang/langMgr":void 0,basePage:void 0}],WindowsPageCompleteSoulBinding:[function(e,t){"use strict";cc._RF.push(t,"2d044qySoxGbKGH42DzmOjo","WindowsPageCompleteSoulBinding");var a,i,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),r=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},o=cc._decorator,s=o.ccclass,p=o.property,c=e("basePage");(function(e){e[e.Unlock=0]="Unlock",e[e.Lock=1]="Lock"})(i||(i={}));var h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.generalPortraitL=null,t.generalPortraitR=null,t.beforePower=null,t.afterPower=null,t.levelValueL=null,t.hpValueL=null,t.attackValueL=null,t.defenseValueL=null,t.magicDefenseValueL=null,t.levelValueR=null,t.hpValueR=null,t.attackValueR=null,t.defenseValueR=null,t.magicDefenseValueR=null,t.titleNode=null,t.titleFrames=[],t.beforeInfo=null,t.afterInfo=null,t.bindType=i.Unlock,t}var a;return n(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},t.prototype.start=function(){},t.prototype.setParam=function(e){e.beforeInfo&&e.afterInfo&&(this.beforeInfo=e.beforeInfo,this.afterInfo=e.afterInfo,this.bindType=e.bindType,this.initUI())},t.prototype.initUI=function(){var e=this.titleFrames[this.bindType];cc.isValid(e)&&(this.titleNode.getComponent(cc.Sprite).spriteFrame=e),this.beforePower.getComponent("num").init(this.beforeInfo.power),this.levelValueL.string=""+this.beforeInfo.level,this.hpValueL.string=""+this.beforeInfo.property.hp,this.attackValueL.string=""+this.beforeInfo.property.atk,this.defenseValueL.string=""+this.beforeInfo.property.def,this.magicDefenseValueL.string=""+this.beforeInfo.property.mdef,this.afterPower.getComponent("num").init(this.afterInfo.power),this.levelValueR.string=""+this.afterInfo.level,this.hpValueR.string=""+this.afterInfo.property.hp,this.attackValueR.string=""+this.afterInfo.property.atk,this.defenseValueR.string=""+this.afterInfo.property.def,this.magicDefenseValueR.string=""+this.afterInfo.property.mdef,this.generalPortraitL.getComponent("generalPortraitItem").initForTips({gsid:this.beforeInfo.gsid,level:""+this.beforeInfo.level}),this.generalPortraitR.getComponent("generalPortraitItem").initForTips({gsid:this.afterInfo.gsid,level:""+this.afterInfo.level})},t.prefabPath="windowsPageCompleteSoulBinding",t.pageType=1,r([p({type:cc.Node})],t.prototype,"generalPortraitL",void 0),r([p({type:cc.Node})],t.prototype,"generalPortraitR",void 0),r([p({type:cc.Node})],t.prototype,"beforePower",void 0),r([p({type:cc.Node})],t.prototype,"afterPower",void 0),r([p(cc.Label)],t.prototype,"levelValueL",void 0),r([p(cc.Label)],t.prototype,"hpValueL",void 0),r([p(cc.Label)],t.prototype,"attackValueL",void 0),r([p(cc.Label)],t.prototype,"defenseValueL",void 0),r([p(cc.Label)],t.prototype,"magicDefenseValueL",void 0),r([p(cc.Label)],t.prototype,"levelValueR",void 0),r([p(cc.Label)],t.prototype,"hpValueR",void 0),r([p(cc.Label)],t.prototype,"attackValueR",void 0),r([p(cc.Label)],t.prototype,"defenseValueR",void 0),r([p(cc.Label)],t.prototype,"magicDefenseValueR",void 0),r([p({type:cc.Node})],t.prototype,"titleNode",void 0),r([p({type:[cc.SpriteFrame]})],t.prototype,"titleFrames",void 0),a=r([s],t)}(c);t.exports=h,cc._RF.pop()},{basePage:void 0}],WindowsPageEquipCompound:[function(e,t){"use strict";cc._RF.push(t,"1feb8/C5BxKnocCe91QUBOo","WindowsPageEquipCompound");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=cc._decorator,o=r.ccclass,s=r.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.newNode=null,t.beforeEquip=null,t.afterEquip=null,t.btnAdd=null,t.btnReduce=null,t.btnMaximum=null,t.btnMinimum=null,t.labCount=null,t.btnHelp=null,t.btnCompound=null,t.btnAutoCompound=null,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,this.stopBgNodeEvent(),this.handleUI()},t.prototype.start=function(){},t.prefabPath="windowsPageEquipCompound",n([s({type:cc.Node})],t.prototype,"newNode",void 0),n([s({type:cc.Node})],t.prototype,"beforeEquip",void 0),n([s({type:cc.Node})],t.prototype,"afterEquip",void 0),n([s({type:cc.Button})],t.prototype,"btnAdd",void 0),n([s({type:cc.Button})],t.prototype,"btnReduce",void 0),n([s({type:cc.Button})],t.prototype,"btnMaximum",void 0),n([s({type:cc.Button})],t.prototype,"btnMinimum",void 0),n([s(cc.Label)],t.prototype,"labCount",void 0),n([s({type:cc.Button})],t.prototype,"btnHelp",void 0),n([s({type:cc.Button})],t.prototype,"btnCompound",void 0),n([s({type:cc.Button})],t.prototype,"btnAutoCompound",void 0),a=n([o],t)}(e("basePage"));t.exports=p,cc._RF.pop()},{basePage:void 0}],WindowsPageExclusiveEquip:[function(e,t){"use strict";cc._RF.push(t,"8fbd8Ezq2xK26lGQE7QsnZ4","WindowsPageExclusiveEquip");var a,i,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),r=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},o=this&&this.__awaiter||function(e,t,a,i){return new(a||(a=Promise))(function(n,r){function o(e){try{p(i.next(e))}catch(t){r(t)}}function s(e){try{p(i.throw(e))}catch(t){r(t)}}function p(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(o,s)}p((i=i.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var a,i,n,r,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(e){return function(t){return p([e,t])}}function p(r){if(a)throw new TypeError("Generator is already executing.");for(;o;)try{if(a=1,i&&(n=2&r[0]?i.return:r[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,r[1])).done)return n;switch(i=0,n&&(r=[2&r[0],n.value]),r[0]){case 0:case 1:n=r;break;case 4:return o.label++,{value:r[1],done:!1};case 5:o.label++,i=r[1],r=[0];continue;case 7:r=o.ops.pop(),o.trys.pop();continue;default:if(!(n=(n=o.trys).length>0&&n[n.length-1])&&(6===r[0]||2===r[0])){o=0;continue}if(3===r[0]&&(!n||r[1]>n[0]&&r[1]<n[3])){o.label=r[1];break}if(6===r[0]&&o.label<n[1]){o.label=n[1],n=r;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(r);break}n[2]&&o.ops.pop(),o.trys.pop();continue}r=t.call(e,o)}catch(s){r=[6,s],i=0}finally{a=n=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},p=e("langMgr"),c=e("./AttributeInfoChange"),h=cc._decorator,l=h.ccclass,g=h.property,d=e("basePage");(function(e){e[e.Activate=0]="Activate",e[e.Strength=1]="Strength",e[e.Break=2]="Break"})(i||(i={}));var u=["2","1","3"],f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.bottomPropItem=null,t.skillItem=null,t.attributeInfos=[],t.labSkillLockTip=null,t.labActivateLockTip=null,t.btnActivate=null,t.p_spNameIcon=null,t.materialsContent=null,t.equipIcon=null,t.strengthAnim=null,t.breakAnim=null,t.txtMaxLv=null,t.spBtnTxt=null,t.btnFrames=[],t.btnHelp=null,t.p_pfbPropItem=null,t._generalId="",t._isActivate=!1,t._equipLv=0,t._consumeList=[],t._beforePower=0,t._completeFunc=null,t._curEffectUrl="",t._btnState=i.Activate,t}var a;return n(t,e),a=t,Object.defineProperty(t.prototype,"btnState",{get:function(){return this._btnState},set:function(e){this._btnState=e,this.spBtnTxt.spriteFrame=this.btnFrames[this._btnState]},enumerable:!1,configurable:!0}),t.prototype.onLoad=function(){a.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.fitTopMenu(),this.addUIEvent(),this._consumeList.push(this.bottomPropItem)},t.prototype.setParam=function(e){this._generalId=e.guid,this._beforePower=app.player.general[this._generalId]?app.player.general[this._generalId].power:0,this._loadEquipIcon(),this._renderView()},t.prototype.addUIEvent=function(){var e=this;this.btnActivate.node.on("click",function(){return o(e,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return app.playSound("click"),[4,this._strengthEquip()];case 1:return e.sent(),[2]}})})},this),this.node.on(cc.Node.EventType.TOUCH_END,function(){cc.log("*** skip animation ***"),e._skipAnim()},this),this.btnHelp.node.on("click",function(){app.playSound("click"),app.pages.windowspagetipshelp.showPage("1096")},this)},t.prototype._renderView=function(){var e=this,t=app.player.general[this._generalId];if(!t)return this.onClose();if(this._equipLv=t.exclusive_equip?t.exclusive_equip:0,t.star<11)this.labActivateLockTip.node.parent.opacity=255,this.btnActivate.node.active=!1,this.txtMaxLv.opacity=0;else{var a=app.db.getExclMaxLv(t.gsid);this.labActivateLockTip.node.parent.opacity=0,this.btnActivate.node.active=this._equipLv<a,this.txtMaxLv.opacity=this._equipLv<a?0:255,this._isActivate=Boolean(this._equipLv)}var n=app.db.getGenExclEquipInfoByGsid(t.gsid);if(!n)return this.onClose();this._refreshIconBgColor(n.BG_COLORS),app.loadTexture(gConfig.getExclusiveEquipNamePath(n.NAME_ICON),this.p_spNameIcon,app.getPrefabPathFrom(this));var r=app.db.getExclEquipStrengthInfoByOccu(t.occu,this._equipLv),o=app.db.getExclEquipStrengthInfoByOccu(t.occu,this._equipLv+1);if(!o&&!n)return this.onClose();if(!r&&o){r={ATTR:[]};for(var s=0;s<o.ATTR.length;s++)r.ATTR.push({KEY:o.ATTR[s].KEY,VAL:0})}var c=0;for(this.attributeInfos[c].setVisible(!0),this.attributeInfos[c].initValues({titleInfo:p.getString("windowsPageExclusiveStrengthenSuccess",0),beforeValue:this._equipLv,afterValue:this._equipLv===app.db.getExclMaxLv(t.gsid)?void 0:this._equipLv+1});c<r.ATTR.length;c++){for(var h=r.ATTR[c],l={},g=(a=app.db.getExclMaxLv(t.gsid),0);this._equipLv<a&&g<o.ATTR.length;g++)if(h.KEY===o.ATTR[g].KEY){l=o.ATTR[g];break}this.attributeInfos[c+1].setVisible(!0),this.attributeInfos[c+1].initValues({titleInfo:app.db.getPropertyCnByEn(h.KEY),beforeValue:h.VAL||0,afterValue:this._equipLv===app.db.getExclMaxLv(t.gsid)?void 0:l.VAL||0,attrKey:app.db.getPropertyIdByEn(h.KEY)})}for(c++;c<this.attributeInfos.length;c++)this.attributeInfos[c].setVisible(!1);for(var d=app.db.getExclusiveSkillLockLv(t.occu).map(function(e,t){return{skillIdx:t,unlockLv:e}}).sort(function(e,t){return e.unlockLv-t.unlockLv}),u=0,f=0,m=0;m<d.length;++m)if(this._equipLv<d[m].unlockLv){u=d[m].unlockLv,f=d[m].skillIdx;break}if(u===this._equipLv+1){this.labSkillLockTip.string=p.getString("windowsPageExclusiveEquip",5,u);var _=app.db.getGBaseByGsid(t.gsid).SKILL[f];if(_){var v=this._equipLv?_+1:n.EXCLUSIVE_SKILLS[f];this.skillItem.getComponent("skillItem").initForExclusive(v)}this.skillItem.parent.active=Boolean(_)}else this.skillItem.parent.active=!1;this.btnState=0===this._equipLv?i.Activate:u===this._equipLv+1?i.Break:i.Strength;var b=app.db.getExclConsumeByGsid(t.gsid,this._equipLv);b.forEach(function(t,a){var i,n,r,o,s,p,c=e._consumeList[a];c?c.active||(c.active=!0):((c=cc.instantiate(e.bottomPropItem)).parent=e.materialsContent,e._consumeList[a]=c);var h=null===(i=c.getChildByName("PropContent"))||void 0===i?void 0:i.children[0];cc.isValid(h)||(h=cc.instantiate(e.p_pfbPropItem),null===(n=c.getChildByName("PropContent"))||void 0===n||n.addChild(h),h.setPosition(cc.Vec2.ZERO)),h.getComponent("propItem").setClick(!0);var l=app.player.getCount(t.GSID);h.getComponent("propItem").initExclusiveEquipMaterials({gsid:t.GSID,need:t.COUNT,have:l});var g=null===(o=null===(r=c.getChildByName("UILabLayout"))||void 0===r?void 0:r.getChildByName("LabHaveCnt"))||void 0===o?void 0:o.getComponent(cc.Label),d=null===(p=null===(s=c.getChildByName("UILabLayout"))||void 0===s?void 0:s.getChildByName("LabNeedCnt"))||void 0===p?void 0:p.getComponent(cc.Label);cc.isValid(g)&&(g.string=""+l,g.node.color=l>=t.COUNT?d.node.color:(new cc.Color).fromHEX("#FF2323")),cc.isValid(d)&&(d.string="/"+t.COUNT)}),this._consumeList.slice(b.length).filter(function(e){return cc.isValid(e)}).forEach(function(e){return e.active=!1}),app.setNodeState(this.btnActivate.node,!this._checkBtnEnable())},t.prototype._loadEquipIcon=function(){var e=app.player.general[this._generalId];if(e){var t=app.db.getGenExclEquipInfoByGsid(e.gsid);if(t){var a=app.db.getBigExclEquipPath(t.EXCLUSIVE_ICON);app.loadTexture(a,this.equipIcon,this.prefabPath),this._playEquipAct()}}},t.prototype._playEquipAct=function(){return cc.tween(this.equipIcon.node).repeatForever(cc.tween().by(2,{y:30}).by(2,{y:-30}).delay(.1)).start()},t.prototype._refreshIconBgColor=function(e){var t=app.player.general[this._generalId],a=app.db.getExclMaxLv(t.gsid),i=this._equipLv>=a?2:this._equipLv/10|0,n=(new cc.Color).fromHEX(e[i]);this.equipIcon.getMaterial(0).setProperty("uGlowColor",n)},t.prototype._checkBtnEnable=function(){var e=app.player.general[this._generalId],t=e.exclusive_equip?e.exclusive_equip:0;return!(t>=app.db.getExclMaxLv(e.gsid))&&0===app.db.getExclConsumeByGsid(e.gsid,t).filter(function(e){var t=e.COUNT;return app.player.getCount(e.GSID)<t}).length},t.prototype._skipAnim=function(){if("function"==typeof this._completeFunc){this.strengthAnim.node.active&&(this.strengthAnim.clearTrack(0),this.strengthAnim.setToSetupPose(),this.strengthAnim.node.active=!1),this.breakAnim.node.active&&(this.breakAnim.clearTrack(0),this.breakAnim.setToSetupPose(),this.breakAnim.node.active=!1),this.materialsContent.children.filter(function(e){return e.active}).forEach(function(e){var t=e.getChildByName("ConsumeAnim");cc.isValid(t)&&(t.getComponent(sp.Skeleton).clearTrack(0),t.getComponent(sp.Skeleton).setToSetupPose(),t.opacity=0)}),this._completeFunc(),this._completeFunc=null;var e=window.audioMsg.getSoundInfoByUrl(this._curEffectUrl);e&&cc.audioEngine.stopEffect(e.id)}},t.prototype._strengthEquip=function(){return o(this,void 0,Promise,function(){var e,t,a,n,r,o,c,h,l,g,d=this;return s(this,function(s){switch(s.label){case 0:if(e=this._generalId,!(t=app.player.general[e]))return[2,this.onClose()];if(a=app.db.getExclMaxLv(t.gsid),this._equipLv>=a)return[2,app.showNotice(p.getString("windowsPageExclusiveEquip",0))];if(n=app.db.getExclConsumeByGsid(t.gsid,this._equipLv),(r=n.filter(function(e){var t=e.COUNT;return app.player.getCount(e.GSID)<t}).map(function(e){return e.GSID})).length)return app.showNotice(p.getString("windowsPageExclusiveEquip",4)),[2,app.pages.windowspagesource.showPage(r[0])];s.label=1;case 1:return s.trys.push([1,3,,4]),this.btnActivate.enabled=!1,app.setNodeState(this.btnActivate.node,!0),[4,app.player.sfUpgradeExclusive({guid:e})];case 2:return o=s.sent(),app.player.addGeneral(o.general),app.player.reduceItem(o.castitems),this.materialsContent.children.filter(function(e){return e.active}).forEach(function(e){var t=e.getChildByName("ConsumeAnim");cc.isValid(t)&&(t.opacity||(t.opacity=255),t.getComponent(sp.Skeleton).setAnimation(0,"animation",!1))}),c=this._btnState,this._curEffectUrl=c===i.Strength?"glevelup":"exclusiveupgrade",app.playSound(this._curEffectUrl),(h=c===i.Strength?this.strengthAnim:this.breakAnim).node.active=!0,l=c===i.Strength?"effect":u[cc.misc.clampf((this._equipLv+1)/10|0,0,u.length-1)],h.setAnimation(0,l,!1),this._completeFunc=function(){cc.isValid(d)&&(d.btnActivate.enabled=!0,app.setNodeState(d.btnActivate.node,!d._checkBtnEnable()),d._isActivate||(d._isActivate=!0),d._renderView(),app.pages.windowsPageExclusiveStrengthenSuccess.showPage({guid:e,upgradeType:c}))},h.setCompleteListener(function(){cc.isValid(d)&&"function"==typeof d._completeFunc&&(d._completeFunc(),d._completeFunc=null)}),[3,4];case 3:switch(g=s.sent()){case"exclusive max":g=p.getString("windowsPageExclusiveEquip",0);break;case"exclusive luck":g=p.getString("windowsPageExclusiveEquip",1)}return app.showNotice(g),this.btnActivate.enabled=!0,app.setNodeState(this.btnActivate.node,!1),[3,4];case 4:return[2]}})})},t.prototype.onDestroy=function(){e.prototype.onDestroy&&e.prototype.onDestroy.call(this);var t=app.player.general[this._generalId]?app.player.general[this._generalId].power:0;cc.director.emit("EVT_PLAY_POWER_ANIM",{curPower:t,beforePower:this._beforePower}),cc.director.emit("EVT_REFRESH_EXCLUSIVE_STATUS")},t.prefabPath="windowsPageExclusiveEquip",r([g(cc.Node)],t.prototype,"bottomPropItem",void 0),r([g(cc.Node)],t.prototype,"skillItem",void 0),r([g([c.default])],t.prototype,"attributeInfos",void 0),r([g(cc.Label)],t.prototype,"labSkillLockTip",void 0),r([g(cc.Label)],t.prototype,"labActivateLockTip",void 0),r([g(cc.Button)],t.prototype,"btnActivate",void 0),r([g(cc.Sprite)],t.prototype,"p_spNameIcon",void 0),r([g(cc.Node)],t.prototype,"materialsContent",void 0),r([g(cc.Sprite)],t.prototype,"equipIcon",void 0),r([g(sp.Skeleton)],t.prototype,"strengthAnim",void 0),r([g(sp.Skeleton)],t.prototype,"breakAnim",void 0),r([g(cc.Node)],t.prototype,"txtMaxLv",void 0),r([g(cc.Sprite)],t.prototype,"spBtnTxt",void 0),r([g([cc.SpriteFrame])],t.prototype,"btnFrames",void 0),r([g(cc.Button)],t.prototype,"btnHelp",void 0),r([g(cc.Prefab)],t.prototype,"p_pfbPropItem",void 0),a=r([l],t)}(d);t.exports=f,cc._RF.pop()},{"./AttributeInfoChange":"AttributeInfoChange",basePage:void 0,langMgr:void 0}],WindowsPageExclusiveStrengthenSuccess:[function(e,t){"use strict";cc._RF.push(t,"7cb9bD44sdEsKW3jYIUSa0V","WindowsPageExclusiveStrengthenSuccess");var a,i,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),r=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},o=e("langMgr"),s=e("./AttributeInfoChange"),p=cc._decorator,c=p.ccclass,h=p.property,l=e("basePage");(function(e){e[e.Activate=0]="Activate",e[e.Strength=1]="Strength",e[e.Break=2]="Break"})(i||(i={}));var g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.titleAnim=null,t.attributeInfos=[],t.skillItem=null,t.skillContent=null,t.labSkillLockTip=null,t.equipIcon=null,t._generalId="",t._equipLv=0,t._upgradeType=i.Strength,t}var a;return n(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0,220),this.handleUI()},t.prototype.setParam=function(e){this._generalId=e.guid,this._upgradeType=e.upgradeType;var t=app.player.general[this._generalId];this._equipLv=t.exclusive_equip||0,this._renderMainView(),this._renderAttrItems(),this._renderSkillItem()},t.prototype._renderMainView=function(){var e=app.player.general[this._generalId],t=app.db.getGenExclEquipInfoByGsid(e.gsid);this._loadEquipIcon(),this._refreshIconBgColor(t.BG_COLORS),app.playUpgradeAnim({spComp:this.titleAnim.getComponent(sp.Skeleton),startName:"appear",endName:"loop",index:["9","10","11"][this._upgradeType],target:this})},t.prototype._renderAttrItems=function(){var e=app.player.general[this._generalId];if(!app.db.getGenExclEquipInfoByGsid(e.gsid))return this.onClose();var t=app.db.getExclEquipStrengthInfoByOccu(e.occu,this._equipLv),a=app.db.getExclEquipStrengthInfoByOccu(e.occu,this._equipLv-1);if(!t)return this.onClose();if(!a){a={ATTR:[]};for(var i=0;i<t.ATTR.length;i++)a.ATTR.push({KEY:t.ATTR[i].KEY,VAL:0})}var n=0;for(this.attributeInfos[n].setVisible(!0),this.attributeInfos[n].initValues({titleInfo:o.getString("windowsPageExclusiveStrengthenSuccess",0),beforeValue:this._equipLv-1,afterValue:this._equipLv});n<a.ATTR.length;n++){for(var r=a.ATTR[n],s={},p=0;p<t.ATTR.length;p++)if(r.KEY===t.ATTR[p].KEY){s=t.ATTR[p];break}this.attributeInfos[n+1].setVisible(!0),this.attributeInfos[n+1].initValues({titleInfo:app.db.getPropertyCnByEn(r.KEY),beforeValue:r.VAL||0,afterValue:s.VAL||0,attrKey:app.db.getPropertyIdByEn(r.KEY)})}for(n++;n<this.attributeInfos.length;n++)this.attributeInfos[n].setVisible(!1)},t.prototype._renderSkillItem=function(){var e=app.player.general[this._generalId],t=app.db.getExclusiveSkillLockLv(e.occu).indexOf(this._equipLv);if(this.skillContent.active=t>-1,t>-1){var a=app.db.getGBaseByGsid(e.gsid).SKILL;this.skillItem.getComponent("skillItem").initForExclusive(a[t]+1),this.labSkillLockTip.string=o.getString("windowsPageExclusiveStrengthenSuccess",1,t+1)}},t.prototype._loadEquipIcon=function(){var e=app.player.general[this._generalId];if(e){var t=app.db.getGenExclEquipInfoByGsid(e.gsid);if(t){var a=app.db.getBigExclEquipPath(t.EXCLUSIVE_ICON);app.loadTexture(a,this.equipIcon,this.prefabPath)}}},t.prototype._refreshIconBgColor=function(e){var t=this._equipLv>=30?2:this._equipLv/10|0,a=(new cc.Color).fromHEX(e[t]);this.equipIcon.getMaterial(0).setProperty("uGlowColor",a)},t.prefabPath="windowsPageExclusiveStrengthenSuccess",t.pageType=1,r([h(cc.Node)],t.prototype,"titleAnim",void 0),r([h([s.default])],t.prototype,"attributeInfos",void 0),r([h(cc.Node)],t.prototype,"skillItem",void 0),r([h(cc.Node)],t.prototype,"skillContent",void 0),r([h(cc.Label)],t.prototype,"labSkillLockTip",void 0),r([h(cc.Sprite)],t.prototype,"equipIcon",void 0),a=r([c],t)}(l);t.exports=g,cc._RF.pop()},{"./AttributeInfoChange":"AttributeInfoChange",basePage:void 0,langMgr:void 0}],WindowsPageFastUpgrade:[function(e,t){"use strict";cc._RF.push(t,"7e5c2vuGpNMJK8TTBpih2KA","WindowsPageFastUpgrade");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=cc._decorator,o=r.ccclass,s=r.property,p=e("basePage"),c=e("../lang/langMgr"),h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.btnConfirm=null,t.beforeLv=null,t.afterLv=null,t.p_arrNodeCost=[],t.pfbGeneralItem=null,t.gItemContent=null,t.curGeneralInfo=null,t.maxLv=0,t._gItem=null,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this},t.prototype.start=function(){this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.addUIEvent()},t.prototype.addUIEvent=function(){var e=this;this.btnConfirm.node.on("click",function(){if(app.playSound("click"),e.curGeneralInfo){var t=e.curGeneralInfo.power,a=e.curGeneralInfo.guid;app.player.sfGenealFastUpgrade({levelTo:e.maxLv,guid:e.curGeneralInfo.guid}).then(function(i){app.player.reduceItem(i.castitems),app.player.addGeneral(i.general),e.onClose(),app.player.sfPlayerByParam(["others"],function(){var e=app.db.getNeedRefreshGeneralArray(a);e.length>0&&app.player.sfQueryGeneralListInfo(e),cc.director.emit("EVT_AUTO_UPGRADE_REFRESH",{beforePower:t,generalInfo:i.general})})}).catch(function(t){cc.warn(t),e.onClose()})}},this)},t.prototype.setParam=function(e){this.curGeneralInfo=app.player.general[e.generalGuid],this.maxLv=e.maxLv,this.renderUI()},t.prototype.renderUI=function(){for(var e=this.calculateUpgradeCost(this.curGeneralInfo),t=0;t<this.p_arrNodeCost.length;++t)e[t]?(this.p_arrNodeCost[t].getComponent("costItem").refreshUI(e[t].GSID,e[t].COUNT,this),this.p_arrNodeCost[t].active=!0):this.p_arrNodeCost[t].active=!1;cc.isValid(this._gItem)||(this._gItem=cc.instantiate(this.pfbGeneralItem),this.gItemContent.addChild(this._gItem),this._gItem.setPosition(cc.Vec2.ZERO)),this._gItem.getComponent("generalPortraitItem").initForTips({gsid:this.curGeneralInfo?this.curGeneralInfo.gsid:"",level:c.getString("WindowsPageFastUpgrade",0,this.maxLv),skinId:this.curGeneralInfo?this.curGeneralInfo.skin:""}),this.beforeLv.string=this.curGeneralInfo?c.getString("WindowsPageFastUpgrade",0,this.curGeneralInfo.level):c.getString("WindowsPageFastUpgrade",0,1),this.afterLv.string=c.getString("WindowsPageFastUpgrade",0,this.maxLv)},t.prototype.calculateUpgradeCost=function(e){for(var t=this.maxLv,a={38006:0,30001:0,30015:0},i=e.level+1;i<t;++i)(app.db.getGLevelCostByLevel(i)||[]).forEach(function(e){var t=e.GSID;void 0===a[t]?a[t]=e.COUNT:a[t]+=e.COUNT});var n=[];for(var r in a)a.hasOwnProperty(r)&&a[r]&&(n[n.length]={GSID:r,COUNT:a[r]});return n.sort(function(e,t){var a=[38006,30001,30015];return a.indexOf(Number(e.GSID))-a.indexOf(Number(t.GSID))})},t.prefabPath="windowsPageFastUpgrade",t.pageType=1,n([s({type:cc.Button})],t.prototype,"btnConfirm",void 0),n([s({type:cc.Label})],t.prototype,"beforeLv",void 0),n([s({type:cc.Label})],t.prototype,"afterLv",void 0),n([s({type:[cc.Node]})],t.prototype,"p_arrNodeCost",void 0),n([s(cc.Prefab)],t.prototype,"pfbGeneralItem",void 0),n([s(cc.Node)],t.prototype,"gItemContent",void 0),a=n([o],t)}(p);t.exports=h,cc._RF.pop()},{"../lang/langMgr":void 0,basePage:void 0}],WindowsPageGeneralTeamList:[function(e,t){"use strict";cc._RF.push(t,"78ceaFoAZFOS7JOob7G9JGO","WindowsPageGeneralTeamList");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=this&&this.__awaiter||function(e,t,a,i){return new(a||(a=Promise))(function(n,r){function o(e){try{p(i.next(e))}catch(t){r(t)}}function s(e){try{p(i.throw(e))}catch(t){r(t)}}function p(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(o,s)}p((i=i.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var a,i,n,r,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(e){return function(t){return p([e,t])}}function p(r){if(a)throw new TypeError("Generator is already executing.");for(;o;)try{if(a=1,i&&(n=2&r[0]?i.return:r[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,r[1])).done)return n;switch(i=0,n&&(r=[2&r[0],n.value]),r[0]){case 0:case 1:n=r;break;case 4:return o.label++,{value:r[1],done:!1};case 5:o.label++,i=r[1],r=[0];continue;case 7:r=o.ops.pop(),o.trys.pop();continue;default:if(!(n=(n=o.trys).length>0&&n[n.length-1])&&(6===r[0]||2===r[0])){o=0;continue}if(3===r[0]&&(!n||r[1]>n[0]&&r[1]<n[3])){o.label=r[1];break}if(6===r[0]&&o.label<n[1]){o.label=n[1],n=r;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(r);break}n[2]&&o.ops.pop(),o.trys.pop();continue}r=t.call(e,o)}catch(s){r=[6,s],i=0}finally{a=n=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},s=cc._decorator,p=s.ccclass,c=s.property,h=e("basePage"),l=e("../lang/langMgr"),g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_nodeGeneralContent=null,t.p_nodePowerContent=null,t.scrContent=null,t.sourceCell=null,t.generalName=null,t.m_arrItems=[],t._target=null,t._curGuid="",t._generalItem=null,t._powerItem=null,t._generalPfb=null,t._powerPfb=null,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.m_arrItems.length=0,this.m_arrItems[this.m_arrItems.length]=this.sourceCell},t.prototype.start=function(){this.addEvent()},t.prototype.setParam=function(e){this._target=e.target,this._curGuid=e.guid,this.renderUI(this._curGuid)},t.prototype.renderUI=function(e){var t=app.player.general[e];t||this.onClose(),this._loadGeneral({gsid:t.gsid,level:""+t.level}),this.generalName.string=t.name,this._loadPower(t.power),this._initTeamList(e)},t.prototype._loadGeneral=function(e){return r(this,void 0,void 0,function(){var t;return o(this,function(a){switch(a.label){case 0:return cc.isValid(this._generalPfb)?[3,2]:(t=this,[4,app.loadGeneralPortrait()]);case 1:t._generalPfb=a.sent(),a.label=2;case 2:return cc.isValid(this._generalItem)||(this._generalItem=cc.instantiate(this._generalPfb),this.p_nodeGeneralContent.addChild(this._generalItem),this._generalItem.setPosition(cc.Vec2.ZERO)),this._generalItem.getComponent("generalPortraitItem").initForTips(e),[2]}})})},t.prototype._loadPower=function(e){return r(this,void 0,void 0,function(){var t;return o(this,function(a){switch(a.label){case 0:return cc.isValid(this._powerPfb)?[3,2]:(t=this,[4,app.loadPowerDisplay()]);case 1:t._powerPfb=a.sent(),a.label=2;case 2:return cc.isValid(this._powerItem)||(this._powerItem=cc.instantiate(this._powerPfb),this.p_nodePowerContent.addChild(this._powerItem),this._powerItem.setPosition(cc.Vec2.ZERO)),this._powerItem.getComponent("PowerDisplay").init({val:e}),[2]}})})},t.prototype.getTeamNameCN=function(e){var t="",a=["pvpdef","teampvp","kingpvp1","kingpvp2","kingpvp3","legionpvp1","legionpvp2","wangpvp1","wangpvp2","wangpvp3","soulBinding","official","ringpvp1","ringpvp2","ringpvp3","nationwar1","nationwar2","nationwar3"],i=[l.getString("WindowsPageGeneralTeamList",0),l.getString("WindowsPageGeneralTeamList",1),l.getString("WindowsPageGeneralTeamList",2),l.getString("WindowsPageGeneralTeamList",2),l.getString("WindowsPageGeneralTeamList",2),l.getString("WindowsPageGeneralTeamList",3),l.getString("WindowsPageGeneralTeamList",4),l.getString("WindowsPageGeneralTeamList",5),l.getString("WindowsPageGeneralTeamList",6),l.getString("WindowsPageGeneralTeamList",7),l.getString("WindowsPageGeneralTeamList",8),l.getString("WindowsPageGeneralTeamList",9),l.getString("WindowsPageGeneralTeamList",10,1),l.getString("WindowsPageGeneralTeamList",10,2),l.getString("WindowsPageGeneralTeamList",10,3),l.getString("WindowsPageGeneralTeamList",11,1),l.getString("WindowsPageGeneralTeamList",11,2),l.getString("WindowsPageGeneralTeamList",11,3)];return a.includes(e)&&(t=i[a.indexOf(e)]),t},t.prototype._initTeamList=function(e){var t=app.player.getGeneralTeamList(e);app.player.hasBeenSoulBind(e)&&(t[t.length]="soulBinding"),app.player.isOfficialGeneral(e)&&(t[t.length]="official");var a=cc.isValid(app.pages.generalrelivepage.instance)&&1===app.pages.generalrelivepage.instance.m_menuIndex,i={pvpdef:{sign:"pvpdef",type:"team"},teampvp:{sign:"teampvp",type:"team"},kingpvp1:{sign:"kingpvpsave",type:"team"},kingpvp2:{sign:"kingpvpsave",type:"team"},kingpvp3:{sign:"kingpvpsave",type:"team"},legionpvp1:{sign:"legionpvpsave0",type:"team"},legionpvp2:{sign:"legionpvpsave1",type:"team"},wangpvp1:{sign:"wangpvpsave",type:"team"},wangpvp2:{sign:"wangpvpsave",type:"team"},wangpvp3:{sign:"wangpvpsave",type:"team"},soulBinding:{sign:"soulBinding",type:"soul"},official:{sign:"official",type:"official"},ringpvp1:{sign:"ringpvpsave",type:"team"},ringpvp2:{sign:"ringpvpsave",type:"team"},ringpvp3:{sign:"ringpvpsave",type:"team"},nationwar1:{sign:"nationwar1",type:"team"},nationwar2:{sign:"nationwar2",type:"team"},nationwar3:{sign:"nationwar3",type:"team"}};if(this.m_arrItems.forEach(function(e){return e.active=!1}),t.length<=0)return this.onClose();for(var n=0;n<t.length;++n)if(!a||"official"!==t[n]){var r=this.m_arrItems[n];cc.isValid(r)||((r=cc.instantiate(this.sourceCell)).parent=this.scrContent.content,this.m_arrItems[this.m_arrItems.length]=r),r.active=!0;var o={type:i[t[n]].type,name:this.getTeamNameCN(t[n]),battleType:i[t[n]].sign,target:this,curGuid:this._curGuid};r.getComponent("wSourceItem").renderUI(o)}},t.prototype.addUIEvent=function(){},t.prototype.addEvent=function(){var e=this;window.eventMgr.on(window.eventStr.battleEvent.ExitBattle,function(){e.renderUI(e._curGuid)},this)},t.prototype.onDestroy=function(){e.prototype.onDestroy.call(this),this.removeEvent()},t.prototype.removeEvent=function(){window.eventMgr.targetOff(this)},t.prefabPath="windowsPageGeneralTeamList",t.pageType=1,n([c({type:cc.Node})],t.prototype,"p_nodeGeneralContent",void 0),n([c(cc.Node)],t.prototype,"p_nodePowerContent",void 0),n([c({type:cc.ScrollView})],t.prototype,"scrContent",void 0),n([c({type:cc.Node})],t.prototype,"sourceCell",void 0),n([c(cc.Label)],t.prototype,"generalName",void 0),a=n([p],t)}(h);t.exports=g,cc._RF.pop()},{"../lang/langMgr":void 0,basePage:void 0}],WindowsPageLegionWarRewardDisplay:[function(e,t){"use strict";cc._RF.push(t,"b325b/RZzdKHpmarZHdAMPk","WindowsPageLegionWarRewardDisplay");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=cc._decorator,o=r.ccclass,s=r.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.winProps=[],t.failProps=[],t.propList=null,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},t.prototype.start=function(){var e=app.db.getLegionRewardDisplay();this.winProps.forEach(function(t,a){var i=e.WIN_ITEMS[a];t.active=Boolean(i),i&&(t.getComponent("propItem").initForBag(i),t.getComponent("propItem").setClick(!0))}),this.failProps.forEach(function(t,a){var i=e.LOSE_ITEMS[a];t.active=Boolean(i),i&&(t.getComponent("propItem").initForBag(i),t.getComponent("propItem").setClick(!0))});var t=[].concat(app.db.getLegionAuctionDisplay()).sort(function(e,t){var a=app.db.getPropsInfoByGsid(e).QUALITY||0;return(app.db.getPropsInfoByGsid(t).QUALITY||0)-a});this.propList.getComponent("tableView").initTableView(t.length,{target:this,array:t,initfun:"initForGsid"})},t.prefabPath="windowsPageLegionWarRewardDisplay",t.pageType=1,n([s({type:[cc.Node]})],t.prototype,"winProps",void 0),n([s({type:[cc.Node]})],t.prototype,"failProps",void 0),n([s(cc.Node)],t.prototype,"propList",void 0),a=n([o],t)}(e("basePage"));t.exports=p,cc._RF.pop()},{basePage:void 0}],WindowsPageMilitaryRankPreview:[function(e,t){"use strict";cc._RF.push(t,"95537Hx4MNMc5SlpXw8hyzJ","WindowsPageMilitaryRankPreview");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=cc._decorator,o=r.ccclass,s=r.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.nodeRewardList=null,t.nodesAttrInfo=[],t.btnLeft=null,t.btnRight=null,t.spriteMilRankName=null,t.spriteMilRankIcon=null,t.nodeMaxLvTip=null,t._currMilitRank=0,t._militRankConfig=null,t._maxLevel=0,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.creatMask(!0),this.addUIEvent()},t.prototype.addUIEvent=function(){var e=this;this.btnLeft.node.on("click",function(){app.playSound("click"),--e._currMilitRank,e._renderView()},this),this.btnRight.node.on("click",function(){app.playSound("click"),++e._currMilitRank,e._renderView()},this)},t.prototype.setParam=function(e){var t;this._currMilitRank=null!==(t=null==e?void 0:e.militRank)&&void 0!==t?t:1,this._militRankConfig=app.db.getMilitaryRankConfig(),this._maxLevel=this._militRankConfig.length,this._renderView()},t.prototype._renderView=function(){app.loadTexture(app.db.getMilitRankNameByLv(this._currMilitRank),this.spriteMilRankName,this.prefabPath),app.loadTexture(app.db.getMilitRankIconByLv(this._currMilitRank),this.spriteMilRankIcon,this.prefabPath),this._refreshArrow(),this._renderRewardList(),this._renderAttributes(),this.nodeMaxLvTip.opacity=this._maxLevel===this._currMilitRank?255:0},t.prototype._refreshArrow=function(){this.btnRight.node.active=this._currMilitRank<this._maxLevel,this.btnLeft.node.active=this._currMilitRank>1},t.prototype._renderRewardList=function(){var e=this._militRankConfig[this._currMilitRank-1].UpgradeReward;if(this.nodeRewardList.parent.active=this._currMilitRank<this._maxLevel,this.nodeRewardList.parent.active){for(var t=0;t<e.length;++t){var a=this.nodeRewardList.children[t];if(!cc.isValid(a)){if(0===t)break;a=cc.instantiate(this.nodeRewardList.children[0]),this.nodeRewardList.addChild(a)}a.active||(a.active=!0),a.getComponent("propItem").initForBag(e[t]),a.getComponent("propItem").setClick(!0)}for(;t<this.nodeRewardList.children.length;++t)this.nodeRewardList.children[t].active=!1}},t.prototype._renderAttributes=function(){for(var e,t,a=this._militRankConfig[this._currMilitRank-1].Attribute,i=0;i<a.length;++i){var n=this.nodesAttrInfo[i];if(cc.isValid(n)){0===n.opacity&&(n.opacity=255);var r=null===(e=n.getChildByName("LabAttributeName"))||void 0===e?void 0:e.getComponent(cc.Label);cc.isValid(r)&&(r.string=app.db.getPropertyCnByEn(a[i].KEY));var o=null===(t=n.getChildByName("LabAttributeValue"))||void 0===t?void 0:t.getComponent(cc.Label),s=app.db.getPropertyIdByEn(a[i].KEY);cc.isValid(o)&&(o.string="+"+(2==app.db.dbProperty[s].NUMTYPE?a[i].VAL/10+"%":a[i].VAL))}}for(;i<this.nodesAttrInfo.length;++i)this.nodesAttrInfo[i].opacity=0},t.prefabPath="windowsPageMilitaryRankPreview",t.pageType=1,t.pageParent="windowsPageMilitaryRank",n([s(cc.Node)],t.prototype,"nodeRewardList",void 0),n([s([cc.Node])],t.prototype,"nodesAttrInfo",void 0),n([s(cc.Button)],t.prototype,"btnLeft",void 0),n([s(cc.Button)],t.prototype,"btnRight",void 0),n([s(cc.Sprite)],t.prototype,"spriteMilRankName",void 0),n([s(cc.Sprite)],t.prototype,"spriteMilRankIcon",void 0),n([s(cc.Node)],t.prototype,"nodeMaxLvTip",void 0),a=n([o],t)}(e("basePage"));t.exports=p,cc._RF.pop()},{basePage:void 0}],WindowsPageMilitaryRank:[function(e,t){"use strict";cc._RF.push(t,"4f8dcAIMPpLy5WLls5jW1Pm","WindowsPageMilitaryRank");var a,i,n,r=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),o=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},s=cc._decorator,p=s.ccclass,c=s.property,h=e("basePage"),l=e("langMgr"),g=null!==(i=l.getString.bind(l))&&void 0!==i?i:function(){for(var e=[],t=2;t<arguments.length;t++)e[t-2]=arguments[t];return""};(function(e){e[e.Red=0]="Red",e[e.Green=1]="Green"})(n||(n={}));var d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.nodeMilAttrList=[],t.btnHelp=null,t.btnRank=null,t.btnMilRankPrev=null,t.btnRewardPrev=null,t.btnPromote=null,t.labCurrRank=null,t.labCurrHonor=null,t.labPromoteExp=null,t.labSettleExp=null,t.labUpgradeTip=null,t.labMidNextMilitName=null,t.labBotNextMilitName=null,t.labOwnCurr=null,t.labNeedCurr=null,t.sprMilRankName=null,t.spriteMilRankIcon=null,t.nodeRewardPrevCont=null,t.nodeRewardItemList=[],t.nodeExpProgress=null,t.labProgressValue=null,t.nodeExpChaProgress=null,t.spfExpProgress=[],t.nodeMaxLvTip=null,t.labMiddleTitle=null,t._currMilitRank=0,t._militRankConfig=null,t._maxLevel=0,t._rankInfo=null,t._ownExp=0,t._needExp=0,t._needCurrency=0,t._progTween=null,t._iconTween=null,t._iconOrigPos=null,t}var a;return r(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.fitTopMenu(),this.addUIEvent()},t.prototype.addUIEvent=function(){var e=this;this.btnHelp.node.on("click",function(){app.playSound("click"),app.pages.windowspagetipshelp.showPage("1121")},this),this.btnMilRankPrev.node.on("click",function(){app.playSound("click"),app.pages.windowsPageMilitaryRankPreview.showPage({militRank:e._currMilitRank})},this),this.btnPromote.node.on("click",function(){app.playSound("click"),app.player.getCount(30099)<e._needCurrency?app.pages.windowspagesource.showPage(30099):app.player.sfMilitaryUpgrade().then(function(t){app.pages.windowspagereward.showPage({showtype:1,reward:t.items.filter(function(e){return 38021!==e.GSID})}),app.player.addItem(t.items),app.player.reduceItem(t.castitems),eventMgr.emit(eventStr.militaryRank.RefreshMilitaryIcon),cc.isValid(e)&&e._renderView()}).catch(function(e){cc.warn("\u519b\u8854\u664b\u5347\u5931\u8d25: ",e)})},this),this.btnRank.node.on("click",function(){app.playSound("click"),app.pages.ranklistpage.showPage({rank:e._rankInfo,rtype:"military",title:null})},this),this.btnRewardPrev.node.on("click",function(){var t,a;app.playSound("click"),app.pages.militaryRankRewardPage.showPage({rank:null!==(a=null===(t=e._rankInfo)||void 0===t?void 0:t.selfrank)&&void 0!==a?a:0,rewardList:app.db.getMilitaryRankRewardList()})},this)},t.prototype.onDestroy=function(){e.prototype.onDestroy&&e.prototype.onDestroy.call(this),this._stopMilitRankIconAnim(),this._stopProgBarChangeAnim()},t.prototype.setParam=function(e){var t;this._militRankConfig=app.db.getMilitaryRankConfig(),this._maxLevel=this._militRankConfig.length,this._rankInfo=null!==(t=null==e?void 0:e.rankInfo)&&void 0!==t?t:cc.js.createMap(),this.labMiddleTitle.string=g("windowsPageMilitaryRank",7),this._renderView()},t.prototype._renderView=function(){this._currMilitRank=cc.misc.clampf(app.player.getCount(38021),0,this._maxLevel-1)+1,this._ownExp=app.player.getCount(38019),this._renderRewardList(),this._renderUpgradeConsume(),this._renderMidView(),this._renderAttributes(),this._refreshPromoteBtn()},t.prototype._renderRewardList=function(){var e=this._militRankConfig[this._currMilitRank-1].UpgradeReward;if(this.nodeRewardPrevCont.parent.active=this._currMilitRank<this._maxLevel,this.nodeRewardPrevCont.parent.active){this.labBotNextMilitName.string=this.labMidNextMilitName.string="\u3010"+this._militRankConfig[this._currMilitRank].MiliRankName+"\u3011";for(var t=0;t<e.length;++t){var a=this.nodeRewardPrevCont.children[t];if(!cc.isValid(a)){if(0===t)break;a=cc.instantiate(this.nodeRewardPrevCont.children[0]),this.nodeRewardPrevCont.addChild(a)}a.active||(a.active=!0),a.getComponent("propItem").initForBag(e[t]),a.getComponent("propItem").setClick(!0)}for(;t<this.nodeRewardPrevCont.children.length;++t)this.nodeRewardPrevCont.children[t].active=!1}},t.prototype._renderUpgradeConsume=function(){var e=this;if(this._currMilitRank>=this._maxLevel)this._renderMaxLvView();else{var t=this._militRankConfig[this._currMilitRank-1].UpgradeConsume,a=app.player.getCount(30099);t.forEach(function(t){var i,n;switch(!0){case 30099===t.gsid:e._renderPromoteConsume(a,t.count);break;case 38019===t.gsid:e._needExp=t.count,e.labProgressValue.string=e._ownExp+"/"+t.count,e.labPromoteExp.string=""+(t.count-e._ownExp);var r=(null!==(n=null===(i=e._rankInfo)||void 0===i?void 0:i.preSettleExp)&&void 0!==n?n:0)-e._militRankConfig[e._currMilitRank-1].WeeklyDecrease;cc.log("===== \u672c\u5468\u7ecf\u9a8c\u503c\u53d8\u5316\uff1a",r),gUtils.isNaN(r)&&(r=0),e._renderProgressBar(t.count,r),e._playProgBarChangeAnim(),e._renderExpLabs(t.count)}})}},t.prototype._renderMidView=function(){var e,t,a,i;this._loadMilitaryRankTextures(),this._playMilitRankIconAnim(),this.labCurrHonor.string=""+g("windowsPageMilitaryRank",0)+gUtils.showNum(app.player.getCount(38018)),this.labCurrRank.string=""+g("windowsPageMilitaryRank",1)+(this._rankInfo&&this._rankInfo.selfrank?this._rankInfo.selfrank:g("windowsPageMilitaryRank",2)),this.labSettleExp.string=""+g("windowsPageMilitaryRank",3)+((null!==(t=null===(e=this._rankInfo)||void 0===e?void 0:e.preSettleExp)&&void 0!==t?t:0)-(null!==(i=null===(a=this._militRankConfig[this._currMilitRank-1])||void 0===a?void 0:a.WeeklyDecrease)&&void 0!==i?i:0))},t.prototype._renderAttributes=function(){for(var e,t,a=this._militRankConfig[this._currMilitRank-1].Attribute,i=0;i<a.length;++i){var n=this.nodeMilAttrList[i];if(cc.isValid(n)){0===n.opacity&&(n.opacity=255);var r=null===(e=n.getChildByName("LabAttributeName"))||void 0===e?void 0:e.getComponent(cc.Label);cc.isValid(r)&&(r.string=app.db.getPropertyCnByEn(a[i].KEY));var o=null===(t=n.getChildByName("LabAttributeValue"))||void 0===t?void 0:t.getComponent(cc.Label),s=app.db.getPropertyIdByEn(a[i].KEY);cc.isValid(o)&&(o.string="+"+(2==app.db.dbProperty[s].NUMTYPE?a[i].VAL/10+"%":a[i].VAL))}}for(;i<this.nodeMilAttrList.length;++i)this.nodeMilAttrList[i].opacity=0},t.prototype._refreshPromoteBtn=function(){this._currMilitRank<this._maxLevel?(this.btnPromote.interactable=this._ownExp>=this._needExp,app.setNodeState(this.btnPromote.node,this._ownExp<this._needExp)):(this.btnPromote.node.active=!1,this.labOwnCurr.node.parent.opacity=0)},t.prototype._playMilitRankIconAnim=function(){this._iconTween||(this._iconOrigPos=this.spriteMilRankIcon.node.getPosition(),this._iconTween=cc.tween(this.spriteMilRankIcon.node).repeatForever(cc.tween().by(2,{y:30}).by(2,{y:-30}).delay(.1)).start())},t.prototype._stopMilitRankIconAnim=function(){var e,t;this._iconTween&&(this._iconTween.stop(),null===(t=null===(e=this.spriteMilRankIcon)||void 0===e?void 0:e.node)||void 0===t||t.setPosition(this._iconOrigPos),this._iconTween=null)},t.prototype._playProgBarChangeAnim=function(){this._progTween||(this._progTween=cc.tween(this.nodeExpChaProgress).repeatForever(cc.tween().to(.8,{opacity:0}).delay(.8).to(.8,{opacity:255})).start())},t.prototype._stopProgBarChangeAnim=function(){this._progTween&&(this._progTween.stop(),cc.isValid(this.nodeExpChaProgress)&&(this.nodeExpChaProgress.opacity=255),this._progTween=null)},t.prototype._renderProgressBar=function(e,t){var a=this.nodeExpChaProgress.getComponent(cc.ProgressBar);0===t||this._ownExp>=e&&this._ownExp+t>=e?(a.barSprite.spriteFrame=null,this.nodeExpProgress.getComponent(cc.ProgressBar).progress=this._ownExp/e):t>0?(a.barSprite.spriteFrame=this.spfExpProgress[n.Green],a.progress=(t+this._ownExp)/e,this.nodeExpProgress.getComponent(cc.ProgressBar).progress=this._ownExp/e):(a.barSprite.spriteFrame=this.spfExpProgress[n.Red],a.progress=this._ownExp/e,this.nodeExpProgress.getComponent(cc.ProgressBar).progress=(t+this._ownExp)/e)},t.prototype._renderExpLabs=function(e){0===this.labPromoteExp.node.parent.opacity&&(this.labPromoteExp.node.parent.opacity=255),e>this._ownExp?(this.labUpgradeTip.string=g("windowsPageMilitaryRank",6),this.labPromoteExp.string=""+(e-this._ownExp),this.labPromoteExp.node.opacity=255):(this.labUpgradeTip.string=g("windowsPageMilitaryRank",5),this.labPromoteExp.node.opacity=0),this.nodeMaxLvTip.opacity&&(this.nodeMaxLvTip.opacity=0)},t.prototype._renderPromoteConsume=function(e,t){this._needCurrency=t,this.labNeedCurr.string="/"+t,this.labOwnCurr.string=""+e,this.labOwnCurr.node.color=(new cc.Color).fromHEX(e>=t?"#FFD8B0":"#FF3939")},t.prototype._renderMaxLvView=function(){this.nodeMaxLvTip.opacity=255,this.labPromoteExp.node.opacity=0,this.labMidNextMilitName.node.opacity=0,this.labSettleExp.node.opacity=0,this.labProgressValue.node.opacity=0,this.nodeExpProgress.getComponent(cc.ProgressBar).progress=1,this.nodeExpChaProgress.getComponent(cc.ProgressBar).barSprite.spriteFrame=null,this._stopProgBarChangeAnim(),this.labUpgradeTip.string=g("windowsPageMilitaryRank",4)},t.prototype._loadMilitaryRankTextures=function(){app.loadTexture(app.db.getMilitRankNameByLv(this._currMilitRank),this.sprMilRankName,this.prefabPath),app.loadTexture(app.db.getMilitRankIconByLv(this._currMilitRank),this.spriteMilRankIcon,this.prefabPath)},t.prefabPath="windowsPageMilitaryRank",t.pageType=0,t.refreshRed=function(e){var t=!1,a=app.db.getMilitaryRankConfig(),i=a.length,n=cc.misc.clampf(app.player.getCount(38021),0,i-1)+1;if(n<i)for(var r=a[n-1].UpgradeConsume,o=app.player.getCount(38019),s=0;s<r.length;++s)if(38019===r[s].gsid){t=o>=r[s].count;break}return cc.isValid(e)&&cc.Node.isNode(e)&&(e.active=t),t},o([c({type:[cc.Node],tooltip:"\u519b\u8854\u5c5e\u6027"})],t.prototype,"nodeMilAttrList",void 0),o([c(cc.Button)],t.prototype,"btnHelp",void 0),o([c({type:cc.Button,tooltip:"\u6392\u884c\u699c\u6309\u94ae"})],t.prototype,"btnRank",void 0),o([c({type:cc.Button,tooltip:"\u519b\u8854\u9884\u89c8\u6309\u94ae"})],t.prototype,"btnMilRankPrev",void 0),o([c({type:cc.Button,tooltip:"\u5956\u52b1\u9884\u89c8\u6309\u94ae"})],t.prototype,"btnRewardPrev",void 0),o([c({type:cc.Button,tooltip:"\u664b\u5347\u6309\u94ae"})],t.prototype,"btnPromote",void 0),o([c({type:cc.Label,tooltip:"\u5f53\u524d\u6392\u540d"})],t.prototype,"labCurrRank",void 0),o([c({type:cc.Label,tooltip:"\u5f53\u524d\u8363\u8a89"})],t.prototype,"labCurrHonor",void 0),o([c({type:cc.Label,tooltip:"\u664b\u5347\u6240\u9700\u7ecf\u9a8c"})],t.prototype,"labPromoteExp",void 0),o([c({type:cc.Label,tooltip:"\u9884\u4f30\u7ed3\u7b97\u7ecf\u9a8c"})],t.prototype,"labSettleExp",void 0),o([c({type:cc.Label,tooltip:"\u5347\u7ea7\u63d0\u793a\u6587\u672c"})],t.prototype,"labUpgradeTip",void 0),o([c({type:cc.Label,tooltip:"\u4e2d\u95f4\u4e0b\u4e00\u519b\u8854\u540d\u79f0"})],t.prototype,"labMidNextMilitName",void 0),o([c({type:cc.Label,tooltip:"\u5e95\u90e8\u4e0b\u4e00\u519b\u8854\u540d\u79f0"})],t.prototype,"labBotNextMilitName",void 0),o([c({type:cc.Label,tooltip:"\u664b\u5347\u8d27\u5e01\u62e5\u6709\u6570\u91cf"})],t.prototype,"labOwnCurr",void 0),o([c({type:cc.Label,tooltip:"\u664b\u5347\u8d27\u5e01\u9700\u8981\u6570\u91cf"})],t.prototype,"labNeedCurr",void 0),o([c({type:cc.Sprite,tooltip:"\u519b\u8854\u540d\u5b57\u56fe\u7247"})],t.prototype,"sprMilRankName",void 0),o([c({type:cc.Sprite,tooltip:"\u519b\u8854icon"})],t.prototype,"spriteMilRankIcon",void 0),o([c({type:cc.Node,tooltip:"\u4e0b\u4e00\u4e2a\u519b\u8854\u5956\u52b1\u5217\u8868\u5bb9\u5668"})],t.prototype,"nodeRewardPrevCont",void 0),o([c({type:[cc.Node],tooltip:"\u4e0b\u4e00\u4e2a\u519b\u8854\u5956\u52b1\u5217\u8868 items"})],t.prototype,"nodeRewardItemList",void 0),o([c({type:cc.Node,tooltip:"\u8fdb\u5ea6\u6761\u8282\u70b9"})],t.prototype,"nodeExpProgress",void 0),o([c({type:cc.Label,tooltip:"\u8fdb\u5ea6\u6570\u503c\u6587\u672c"})],t.prototype,"labProgressValue",void 0),o([c({type:cc.Node,tooltip:"\u8fdb\u5ea6\u6761\u53d8\u5316\u8282\u70b9"})],t.prototype,"nodeExpChaProgress",void 0),o([c({type:[cc.SpriteFrame],tooltip:"\u8fdb\u5ea6\u6761\u53d8\u5316\u7ea2/\u7eff\u56fe\u7247"})],t.prototype,"spfExpProgress",void 0),o([c({type:cc.Node,tooltip:"\u5e95\u90e8\u6700\u5927\u7b49\u7ea7\u63d0\u793a"})],t.prototype,"nodeMaxLvTip",void 0),o([c({type:cc.Label,tooltip:"\u519b\u8854\u6807\u9898-Mid"})],t.prototype,"labMiddleTitle",void 0),a=o([p],t)}(h);t.exports=d,cc._RF.pop()},{basePage:void 0,langMgr:void 0}],WindowsPageOfficeBuffInfo:[function(e,t){"use strict";cc._RF.push(t,"38492lmUA1JX4m9R49oCETp","WindowsPageOfficeBuffInfo");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=this&&this.__spreadArrays||function(){for(var e=0,t=0,a=arguments.length;t<a;t++)e+=arguments[t].length;var i=Array(e),n=0;for(t=0;t<a;t++)for(var r=arguments[t],o=0,s=r.length;o<s;o++,n++)i[n]=r[o];return i},o=cc._decorator,s=o.ccclass,p=o.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.scrollContent=null,t.officePfb=null,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},t.prototype.setParam=function(){this.renderUI()},t.prototype.renderUI=function(){var e=app.player.general_official.official,t=Object.keys(e).filter(function(t){return Object.prototype.hasOwnProperty.call(e,t)}).length,a=new Array(t).fill(void 0);for(var i in e)if(e.hasOwnProperty(i)){var n=e[i];if(n){var o=app.player.general[n].globalbuf||null;a[Number(i)-1]={pos:i,globalBuf:o}}}var s=(a=a.map(function(e,t){return void 0===e?{pos:t+1}:e})).filter(function(e){return void 0!==e.globalBuf}).sort(function(e,t){return t.pos-e.pos}),p=a.filter(function(e){return void 0===e.globalBuf}).sort(function(e,t){return e.pos-t.pos});a=r(s,p);for(var c=0;c<t;++c){var h=cc.instantiate(this.officePfb);h.getComponent("OfficeBuffInfoItem").init(c,a[c].pos,a[c].globalBuf,this),h.parent=this.scrollContent}},t.prefabPath="windowsPageOfficeBuffInfo",t.pageType=1,n([p({type:cc.Node})],t.prototype,"scrollContent",void 0),n([p(cc.Prefab)],t.prototype,"officePfb",void 0),a=n([s],t)}(e("basePage"));t.exports=c,cc._RF.pop()},{basePage:void 0}],WindowsPageOfficeChangeTip:[function(e,t){"use strict";cc._RF.push(t,"acb24toIR9PZKg16J3mEEVT","WindowsPageOfficeChangeTip");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=cc._decorator,o=r.ccclass,s=r.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.btnConfirm=null,t.leftGeneral=null,t.rightGeneral=null,t.pfbPowerItem=null,t.leftPowerContent=null,t.rightPowerContent=null,t.labGenNames=[],t.leftGuid="",t.rightGuid="",t._leftPower=null,t._rightPower=null,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.addUIEvent()},t.prototype.setParam=function(e){this.leftGuid=e.leftGuid,this.rightGuid=e.rightGuid,this.appointPos=e.pos,this.renderUI()},t.prototype.addUIEvent=function(){var e=this;this.btnConfirm.on("click",function(){if(app.playSound("click"),!e.rightGuid)return cc.warn("right general guid is null");var t={type:0,guid:e.rightGuid,pos:e.appointPos},a=e.getBuffInfo(e.leftGuid),i=e.getBuffInfo(e.rightGuid);app.player.sfGeneralAppoint(t).then(function(){var t=app.player.power;app.player.sfPlayerData(function(){var n=e.getBuffInfo(e.leftGuid),r=e.getBuffInfo(e.rightGuid),o=e.getBuffChangeInfo(a,n),s=e.getBuffChangeInfo(i,r);app.pages.windowsPageAppointSuccess.showPage({type:1,leftGuid:e.leftGuid,rightGuid:e.rightGuid,powerChange:app.player.power-t,leftBuffChange:o,rightBuffChange:s}),app.player.refreshMostGeneral(),e.onClose()})}).catch(function(e){return cc.warn(e)})},this)},t.prototype.renderUI=function(){this.initGeneral(this.leftGuid,this.rightGuid)},t.prototype.initGeneral=function(e,t){var a=app.player.general[e];this.leftGeneral.getComponent("GeneralOfficeCandidateTabvItem").refreshUI(e);var i=[];a&&(i[0]=a.gsid,cc.isValid(this._leftPower)||(this._leftPower=cc.instantiate(this.pfbPowerItem),this.leftPowerContent.addChild(this._leftPower),this._leftPower.setPosition(cc.Vec2.ZERO)),this._leftPower.getComponent("PowerDisplay").init({val:a.power})),this.rightGeneral.getComponent("GeneralOfficeCandidateTabvItem").refreshUI(t);var n=app.player.general[t];n&&(i[1]=n.gsid,cc.isValid(this._rightPower)||(this._rightPower=cc.instantiate(this.pfbPowerItem),this.rightPowerContent.addChild(this._rightPower),this._rightPower.setPosition(cc.Vec2.ZERO)),this._rightPower.getComponent("PowerDisplay").init({val:n.power})),this.labGenNames.forEach(function(e,t){var a=app.db.getGNameByGsid(i[t]);e.string=a})},t.prototype.getBuffInfo=function(e){var t=app.player.general[e],a={};if(t){var i=t.globalbuf;i&&(a=window.gUtils.deepClone(i))}return a},t.prototype.getBuffChangeInfo=function(e,t){var a={};for(var i in e)e[i]&&e.hasOwnProperty(i)&&(a[i]?a[i]-=e[i]:a[i]=-e[i]);for(var i in t)t[i]&&t.hasOwnProperty(i)&&(a[i]?a[i]=t[i]+a[i]:a[i]=t[i]);return a},t.prefabPath="windowsPageOfficeChangeTip",t.pageType=1,n([s({type:cc.Node})],t.prototype,"btnConfirm",void 0),n([s({type:cc.Node})],t.prototype,"leftGeneral",void 0),n([s({type:cc.Node})],t.prototype,"rightGeneral",void 0),n([s(cc.Prefab)],t.prototype,"pfbPowerItem",void 0),n([s({type:cc.Node})],t.prototype,"leftPowerContent",void 0),n([s({type:cc.Node})],t.prototype,"rightPowerContent",void 0),n([s([cc.Label])],t.prototype,"labGenNames",void 0),a=n([o],t)}(e("basePage"));t.exports=p,cc._RF.pop()},{basePage:void 0}],WindowsPageOfficeConsumeTip:[function(e,t){"use strict";cc._RF.push(t,"c2284jbh6pPHZuRfp8aUYgE","WindowsPageOfficeConsumeTip");var a,i,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),r=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},o=cc._decorator,s=o.ccclass,p=o.property,c=e("basePage");(function(e){e[e.Unlock=0]="Unlock",e[e.Unfreeze=1]="Unfreeze"})(i||(i={}));var h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.contentTxt=null,t.btnConfirm=null,t.btnCancel=null,t.coinIcon=null,t.coinCount=null,t.goldCount=null,t.goldIcon=null,t._confirmCb=null,t._cancelCb=null,t._contentTxt="",t._propGsids=[],t._type=i.Unlock,t}var a;return n(t,e),a=t,t.prototype.onLoad=function(){a.instance=this},t.prototype.start=function(){this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.addUIEvent()},t.prototype.setParam=function(e){this._confirmCb=e.confirmCb,this._cancelCb=e.cancelCb,this._propGsids=e.propGsids,this._contentTxt=e.text,this._type=e.type,this.refreshUI()},t.prototype.refreshUI=function(){var e=window.app;this.btnCancel.node.active=Boolean("function"==typeof this._cancelCb),this.btnCancel.node.active||(this.btnConfirm.node.x=0),this.coinCount.string=window.gUtils.showCoinNum(e.player.getCount(38006)),this.goldCount.string=window.gUtils.showCoinNum(e.player.getCount(38005));for(var t=this.contentTxt.imageAtlas,a=/propIcon/i,n=0,r=t.getSpriteFrame(this._propGsids[n]),o="";a.test(this._contentTxt);)o=cc.isValid(r)?"<img src='"+this._propGsids[n]+"'/>":"",this._contentTxt=this._contentTxt.replace(a,o),n++,r=t.getSpriteFrame(this._propGsids[n]);this.contentTxt.string="<color=#7B4E32>"+this._contentTxt+"</c>",this.coinIcon.active=Boolean(this._type===i.Unlock),e.loadTexture(gConfig.getCurrencyIconPath("38006"),this.coinIcon.getComponent(cc.Sprite),e.getPrefabPathFrom(this)),this.coinCount.node.active=Boolean(this._type===i.Unlock),this._type===i.Unfreeze&&(this.goldIcon.active=!0,this.goldCount.node.active=!0,this.goldIcon.x=this.coinIcon.x,this.goldCount.node.x=this.coinCount.node.x,e.loadTexture(gConfig.getCurrencyIconPath("38005"),this.goldIcon.getComponent(cc.Sprite),e.getPrefabPathFrom(this)))},t.prototype.addUIEvent=function(){var e=this;this.btnConfirm.node.on("click",function(){window.app.playSound("click"),"function"==typeof e._confirmCb&&e._confirmCb(),e.onClose()},this),this.btnCancel.node.on("click",function(){window.app.playSound("click"),"function"==typeof e._cancelCb&&e._cancelCb(),e.onClose()},this)},t.prefabPath="windowsPageOfficeConsumeTip",t.pageType=1,r([p({type:cc.RichText})],t.prototype,"contentTxt",void 0),r([p(cc.Button)],t.prototype,"btnConfirm",void 0),r([p(cc.Button)],t.prototype,"btnCancel",void 0),r([p(cc.Node)],t.prototype,"coinIcon",void 0),r([p(cc.Label)],t.prototype,"coinCount",void 0),r([p(cc.Label)],t.prototype,"goldCount",void 0),r([p(cc.Node)],t.prototype,"goldIcon",void 0),a=r([s],t)}(c);t.exports=h,cc._RF.pop()},{basePage:void 0}],WindowsPageOfficialCandidate:[function(e,t){"use strict";cc._RF.push(t,"b73dfh0SXlLH7iX/BmbSb0A","WindowsPageOfficialCandidate");var a,i,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),r=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},o=e("../lang/langMgr"),s=cc._decorator,p=s.ccclass,c=s.property,h=e("basePage");(function(e){e[e.NormalAppoint=0]="NormalAppoint",e[e.ChangeAppoint=1]="ChangeAppoint",e[e.RetinueAppoint=2]="RetinueAppoint"})(i||(i={}));var l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.generalContent=null,t.btnConfirm=null,t.tips=null,t.selectList=[],t.levelLimit=0,t.appointPos=0,t.appointType=i.NormalAppoint,t}var a;return n(t,e),a=t,t.prototype.onLoad=function(){a.instance=this},t.prototype.start=function(){this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.addUIEvent()},t.prototype.setParam=function(e){this.levelLimit=e.levelLimit,this.appointPos=e.appointPos,this.appointType=e.appointType,this.renderUI()},t.prototype.renderUI=function(){var e=this.handleListData(this.levelLimit);this.generalContent.getComponent("tableView").initTableView(e.length,{array:e,target:this,arrPick:this.selectList}),this.tips.string=this.appointType===i.RetinueAppoint?o.getString("WindowsPageOfficialCandidate",1):o.getString("WindowsPageOfficialCandidate",2)},t.prototype.addUIEvent=function(){var e=this;this.btnConfirm.on("click",function(){app.playSound("click");var t=e.selectList[0];if(t)switch(!0){case e.appointType===i.NormalAppoint:e.normalOfficialAppoint(t);break;case e.appointType===i.ChangeAppoint:e.changeOfficialAppoint(t);break;case e.appointType===i.RetinueAppoint:e.retinueAppoint(t)}},this)},t.prototype.handleListData=function(e){var t=this,a=Object.keys(app.player.general),n=app.player.general_official.official,r=app.player.general_official.retinue;a=a.filter(function(a){var n=app.player.general[a],r=app.player.isSoulGeneral(a),o=t.appointType===i.RetinueAppoint&&app.player.hasBeenSoulBind(a);return n.level>=e&&!r&&!o});var o={},s=this.appointType!==i.RetinueAppoint?n[this.appointPos]:"",p=[];if(n)for(var c=10;c>0;--c)if(n[c]){var h=app.player.general[n[c]];n[c]!==s&&h.level>=e&&(p[p.length]=n[c]),(u=a.indexOf(n[c]))>=0&&a.splice(u,1);var l=n[c];if(f=app.player.general[l]){var g=f.name;o[g]=l}}var d=[];if(r)for(c=20;c>0;--c)if(r[c]){var u,f;d[d.length]=r[c],(u=a.indexOf(r[c]))>=0&&a.splice(u,1),l=r[c],(f=app.player.general[l])&&(g=f.name,o[g]=l)}cc.log("==== \u5df2\u5c01\u8d4f\u5b98\u804c/\u968f\u4ece\u7684\u6b66\u5c06 Map: ",JSON.stringify(o)),a=a.filter(function(e){var t=app.player.general[e];if(!t)return!1;var a=t.name;return!(o[a]&&o[a]!==e)});var m=[];this.appointType!==i.RetinueAppoint&&m.push.apply(m,p);var _={5:1,6:2,1:3,2:4,3:5,4:6};return a.sort(function(e,t){var a=app.player.general[e]||{},i=app.player.general[t]||{};return a.star!==i.star?i.star-a.star:a.level!==i.level?i.level-a.level:a.camp!==i.camp?_[a.camp]-_[i.camp]:a.occu!==i.occu?a.occu-i.occu:i.gsid-a.gsid}),m.push.apply(m,a),m},t.prototype.normalOfficialAppoint=function(e){var t=this,a=app.player.general_official.official[this.appointPos];if(e===a)return app.showNotice(o.getString("WindowsPageOfficialCandidate",0));if(!e)return cc.warn("select guid is null");var i=this.appointPos,n={type:0,guid:e,pos:i},r=this.getBuffInfo(e);app.player.sfGeneralAppoint(n).then(function(){var a=app.player.power;app.player.sfPlayerData(function(){var n=t.getBuffInfo(e),o=t.getBuffChangeInfo(r,n);app.pages.windowsPageAppointSuccess.showPage({type:t.appointType,centerGuid:e,centerPos:i,powerChange:app.player.power-a,centerBuffChange:o}),t.onClose()})}).catch(function(e){return cc.warn(e)})},t.prototype.changeOfficialAppoint=function(e){var t=app.player.general_official.official[this.appointPos];if(e===t)return cc.warn("\u6ca1\u6709\u6539\u53d8\u4efb\u804c\u6b66\u5c06");var a=this.appointPos;app.pages.windowsPageOfficeChangeTip.showPage({pos:a,leftGuid:t,rightGuid:e}),this.onClose()},t.prototype.retinueAppoint=function(e){var t=this;if(!e)return cc.warn("retinue appoint select guid is null");var a=this.appointPos,i={type:1,guid:e,pos:a},n=gUtils.deepClone(app.player.general[e]);app.player.sfGeneralAppoint(i).then(function(){var a=app.player.power;app.player.sfPlayerData(function(){app.pages.windowsPageRetinueSuccess.showPage({bGeneralInfo:n,generalGuid:e,powerChange:app.player.power-a}),t.onClose()})}).catch(function(e){return cc.warn(e)})},t.prototype.getBuffInfo=function(e){var t=app.player.general[e],a={};if(t){var i=t.globalbuf;i&&(a=window.gUtils.deepClone(i))}return a},t.prototype.getBuffChangeInfo=function(e,t){var a={};for(var i in e)e[i]&&e.hasOwnProperty(i)&&(a[i]?a[i]-=e[i]:a[i]=-e[i]);for(var i in t)t[i]&&t.hasOwnProperty(i)&&(a[i]?a[i]=t[i]+a[i]:a[i]=t[i]);return a},t.prefabPath="windowsPageOfficialCandidate",t.pageType=1,r([c({type:cc.Node})],t.prototype,"generalContent",void 0),r([c({type:cc.Node})],t.prototype,"btnConfirm",void 0),r([c({type:cc.Label})],t.prototype,"tips",void 0),a=r([p],t)}(h);t.exports=l,cc._RF.pop()},{"../lang/langMgr":void 0,basePage:void 0}],WindowsPageOfficialInfo:[function(e,t){"use strict";cc._RF.push(t,"f5982d+Q7tD95L/eeYiCXC9","WindowsPageOfficialInfo");var a,i,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),r=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},o=cc._decorator,s=o.ccclass,p=o.property,c=e("basePage");(function(e){e[e.NormalAppoint=0]="NormalAppoint",e[e.ChangeAppoint=1]="ChangeAppoint"})(i||(i={}));var h=e("../lang/langMgr"),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.btnAppoint=null,t.btnChange=null,t.officialName=null,t.buffTip=null,t.appointLimitTip=null,t.officeFrames=[],t.pfbGeneral=null,t.generalContent=null,t.generalPortrait=null,t._curGuid="",t._officeInfo=null,t._curPos=0,t}var a;return n(t,e),a=t,t.prototype.onLoad=function(){a.instance=this},t.prototype.start=function(){this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},t.prototype.setParam=function(e){this._curGuid=e.guid,this._curPos=e.pos,this._officeInfo=app.db.getOfficeInfoByPos(this._curPos),this.renderUI(),this.addUIEvent()},t.prototype.renderUI=function(){var e=this,t=app.player.general[this._curGuid];cc.isValid(this.generalPortrait)||(this.generalPortrait=cc.instantiate(this.pfbGeneral),this.generalContent.addChild(this.generalPortrait),this.generalPortrait.setPosition(cc.Vec2.ZERO));var a=this.getFrameTypeByPos(this._curPos);if(this.officeFrames.forEach(function(e,t){e.active=Boolean(a===t)}),this.officialName.y=2===a?45:35,t)this.generalPortrait.getComponent("generalPortraitItem").initForOffice({gsid:t.gsid,level:""+(t.level||1),skinId:t.skin}),this.btnAppoint.active=!1,this.btnChange.active=!0;else{this.generalPortrait.getComponent("generalPortraitItem").initForOfficeNone(!1);var n=this.generalPortrait.getComponent("generalPortraitItem").getPlusNode();cc.isValid(n)&&(n.off(cc.Node.EventType.TOUCH_END,this),n.on(cc.Node.EventType.TOUCH_END,function(){app.playSound("click"),e._officeInfo&&(app.pages.windowsPageOfficialCandidate.showPage({levelLimit:e._officeInfo.REQUIRE_LV,appointPos:e._curPos,appointType:i.NormalAppoint}),e.onClose())},this)),this.btnAppoint.active=!0,this.btnChange.active=!1}var r=app.db.getOfficeNameTitlePathByPos(this._curPos);app.loadTexture(r,this.officialName.getComponent(cc.Sprite),this.prefabPath),this.buffTip.string=""+this._officeInfo.INTRO;var o=h.getString("WindowsPageOfficialInfo",0,this._officeInfo.REQUIRE_LV);this.appointLimitTip.string=o},t.prototype.addUIEvent=function(){var e=this;this.btnAppoint.active&&this.btnAppoint.on("click",function(){app.playSound("click"),e._officeInfo&&(app.pages.windowsPageOfficialCandidate.showPage({levelLimit:e._officeInfo.REQUIRE_LV,appointPos:e._curPos,appointType:i.NormalAppoint}),e.onClose())},this),this.btnChange.active&&this.btnChange.on("click",function(){app.playSound("click"),e._officeInfo&&(app.pages.windowsPageOfficialCandidate.showPage({levelLimit:e._officeInfo.REQUIRE_LV,appointPos:e._curPos,appointType:i.ChangeAppoint}),e.onClose())},this)},t.prototype.getFrameTypeByPos=function(e){for(var t=[[1,2,3,4],[5,6],[7]],a=0;a<t.length;++a)if(t[a].includes(e))return a;return 0},t.prefabPath="windowsPageOfficialInfo",t.pageType=1,r([p({type:cc.Node})],t.prototype,"btnAppoint",void 0),r([p({type:cc.Node})],t.prototype,"btnChange",void 0),r([p({type:cc.Node})],t.prototype,"officialName",void 0),r([p({type:cc.Label})],t.prototype,"buffTip",void 0),r([p({type:cc.Label})],t.prototype,"appointLimitTip",void 0),r([p([cc.Node])],t.prototype,"officeFrames",void 0),r([p(cc.Prefab)],t.prototype,"pfbGeneral",void 0),r([p(cc.Node)],t.prototype,"generalContent",void 0),a=r([s],t)}(c);t.exports=l,cc._RF.pop()},{"../lang/langMgr":void 0,basePage:void 0}],WindowsPagePersonAuctionList:[function(e,t){"use strict";cc._RF.push(t,"59399psSYVJZLkVjGPxm3pM","WindowsPagePersonAuctionList");var a,i,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),r=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},o=cc._decorator,s=o.ccclass,p=o.property,c=e("basePage");(function(e){e[e.None=0]="None",e[e.SellOut=1]="SellOut",e[e.AbortiveAuction=2]="AbortiveAuction"})(i||(i={}));var h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.viewList=null,t._auctionListRef=[],t._target=null,t}var a;return n(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},t.prototype.start=function(){this.addEvent()},t.prototype.setParam=function(e){this._auctionListRef=e.personAuctionsRef,this._target=e.target,this.renderUI()},t.prototype.renderUI=function(){this.viewList.getComponent("tableView").initTableView(this._auctionListRef.length,{array:this._auctionListRef,target:this,type:0})},t.prototype.addEvent=function(){cc.director.on("EVT_REFRESH_AUCTION_ITEMS",this._refreshViewData,this)},t.prototype.onDestroy=function(){e.prototype.onDestroy.call(this),this.removeEvent()},t.prototype.removeEvent=function(){cc.director.targetOff(this)},t.prototype._refreshViewData=function(){var e;cc.isValid(this._target)&&(this._auctionListRef.length=0,(e=this._auctionListRef).push.apply(e,this._target._handlePersonData()))},t.prefabPath="windowsPagePersonAuctionList",t.pageType=1,r([p({type:cc.Node})],t.prototype,"viewList",void 0),a=r([s],t)}(c);t.exports=h,cc._RF.pop()},{basePage:void 0}],WindowsPageRelieveSoulBinding:[function(e,t){"use strict";cc._RF.push(t,"69300C9cZdMfbNFkKGy8/Vk","WindowsPageRelieveSoulBinding");var a,i,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),r=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},o=e("../lang/langMgr"),s=cc._decorator,p=s.ccclass,c=s.property,h=e("basePage");(function(e){e[e.Unlock=0]="Unlock",e[e.Lock=1]="Lock"})(i||(i={}));var l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.btnConfirm=null,t.costLabel=null,t.btnCancel=null,t.generalPortraitL=null,t.generalPortraitR=null,t.targetGuid="",t}var a;return n(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},t.prototype.start=function(){this.addUIEvent()},t.prototype.addUIEvent=function(){var e=this;this.btnConfirm.on("click",function(){window.app.playSound("click");var t=window.app.player.getServerTime();try{if(t>(window.app.player.general[e.targetGuid].expireAt?window.app.player.general[e.targetGuid].expireAt:0))return window.app.showNotice(o.getString("WindowsPageRelieveSoulBinding",0)),void e.onClose()}catch(a){return cc.error("\u7075\u9b42\u6b66\u5c06\u83b7\u53d6\u8fc7\u671f\u65f6\u95f4\u9519\u8bef"),window.app.showNotice(o.getString("WindowsPageRelieveSoulBinding",0)),void e.onClose()}e.targetGuid&&window.app.player.sfGeneralSoulBind({guid:e.targetGuid},function(t){var a=window.app.player.general[e.targetGuid],n=a.inherit.guid,r=window.app.player.general[n];r&&r.deleteInHerited(),window.app.pages.windowsPageCompleteSoulBinding.showPage({beforeInfo:a,afterInfo:t.general,bindType:i.Unlock}),window.app.player.addGeneral([t.general]),t.castitems&&window.app.player.reduceItem(t.castitems),cc.director.emit("EVT_REFRESH_BIND_UI"),e.onClose()})},this),this.btnCancel.on("click",function(){window.app.playSound("click"),e.onClose()},this)},t.prototype.setParam=function(e){this.targetGuid=e.bindGuid,this.initUI()},t.prototype.initUI=function(){try{var e=window.app.player.general[this.targetGuid],t=e.level,a=e.gsid;this.generalPortraitL.getComponent("generalPortraitItem").initForTips({gsid:a,level:""+t});var i=Number(a)-Number(a)%20+1;this.generalPortraitR.getComponent("generalPortraitItem").initForTips({gsid:i,level:"1\u7ea7"})}catch(n){cc.log("initUI error",JSON.stringify(n))}},t.prefabPath="windowsPageRelieveSoulBinding",t.pageType=1,r([c({type:cc.Node})],t.prototype,"btnConfirm",void 0),r([c({type:cc.Label})],t.prototype,"costLabel",void 0),r([c(cc.Node)],t.prototype,"btnCancel",void 0),r([c({type:cc.Node})],t.prototype,"generalPortraitL",void 0),r([c({type:cc.Node})],t.prototype,"generalPortraitR",void 0),a=r([p],t)}(h);t.exports=l,cc._RF.pop()},{"../lang/langMgr":void 0,basePage:void 0}],WindowsPageRetinueResetTip:[function(e,t){"use strict";cc._RF.push(t,"bca8fe3QcdO3rYWRe3sK2pN","WindowsPageRetinueResetTip");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=this&&this.__awaiter||function(e,t,a,i){return new(a||(a=Promise))(function(n,r){function o(e){try{p(i.next(e))}catch(t){r(t)}}function s(e){try{p(i.throw(e))}catch(t){r(t)}}function p(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(o,s)}p((i=i.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var a,i,n,r,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(e){return function(t){return p([e,t])}}function p(r){if(a)throw new TypeError("Generator is already executing.");for(;o;)try{if(a=1,i&&(n=2&r[0]?i.return:r[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,r[1])).done)return n;switch(i=0,n&&(r=[2&r[0],n.value]),r[0]){case 0:case 1:n=r;break;case 4:return o.label++,{value:r[1],done:!1};case 5:o.label++,i=r[1],r=[0];continue;case 7:r=o.ops.pop(),o.trys.pop();continue;default:if(!(n=(n=o.trys).length>0&&n[n.length-1])&&(6===r[0]||2===r[0])){o=0;continue}if(3===r[0]&&(!n||r[1]>n[0]&&r[1]<n[3])){o.label=r[1];break}if(6===r[0]&&o.label<n[1]){o.label=n[1],n=r;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(r);break}n[2]&&o.ops.pop(),o.trys.pop();continue}r=t.call(e,o)}catch(s){r=[6,s],i=0}finally{a=n=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},s=cc._decorator,p=s.ccclass,c=s.property,h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.btnConfirm=null,t.lGeneralContent=null,t.rGeneralContent=null,t.leftGeneral=null,t.rightGeneral=null,t._strGuid="",t._retinuePos=0,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this},t.prototype.start=function(){this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.addUIEvent()},t.prototype.addUIEvent=function(){var e=this;this.btnConfirm.on("click",function(){return r(e,void 0,void 0,function(){var e,t,a=this;return o(this,function(i){switch(i.label){case 0:app.playSound("click"),e={type:1,guid:"",pos:this._retinuePos},i.label=1;case 1:return i.trys.push([1,3,,4]),[4,app.player.sfGeneralAppoint(e)];case 2:return i.sent(),app.player.sfPlayerData(function(){return r(a,void 0,void 0,function(){var e;return o(this,function(t){switch(t.label){case 0:return[4,app.player.sfGetOfficialInfo()];case 1:return e=t.sent(),cc.director.emit("EVT_GENERAL_APPOINT_REFRESH_UI",e),[2]}})})}),this.onClose(),[3,4];case 3:return t=i.sent(),cc.warn("sfGetOfficialInfo error",t),[3,4];case 4:return[2]}})})},this)},t.prototype.setParam=function(e){this._strGuid=e.guid,this._retinuePos=e.retinuePos,this.renderUI()},t.prototype.renderUI=function(){return r(this,void 0,void 0,function(){var e,t,a;return o(this,function(i){switch(i.label){case 0:e=app.player.general[this._strGuid],i.label=1;case 1:return i.trys.push([1,3,,4]),[4,app.loadGeneralPortrait()];case 2:return t=i.sent(),e&&(cc.isValid(this.leftGeneral)||(this.leftGeneral=cc.instantiate(t),this.lGeneralContent.addChild(this.leftGeneral),this.leftGeneral.setPosition(cc.Vec2.ZERO)),this.leftGeneral.getComponent("generalPortraitItem").initForOffice({gsid:e.gsid,level:""+e.level,hideOccu:!0,levelColor:"#ffde59",skinId:e.skin}),cc.isValid(this.rightGeneral)||(this.rightGeneral=cc.instantiate(t),this.rGeneralContent.addChild(this.rightGeneral),this.rightGeneral.setPosition(cc.Vec2.ZERO)),this.rightGeneral.getComponent("generalPortraitItem").initForOffice({gsid:e.gsid,level:""+e._ownerlevel,hideOccu:!0,skinId:e.skin})),[3,4];case 3:return a=i.sent(),cc.warn("windowsPageRetinueResetTip ERROR: ",a),[3,4];case 4:return[2]}})})},t.prefabPath="windowsPageRetinueResetTip",t.pageType=1,n([c({type:cc.Node})],t.prototype,"btnConfirm",void 0),n([c({type:cc.Node})],t.prototype,"lGeneralContent",void 0),n([c({type:cc.Node})],t.prototype,"rGeneralContent",void 0),a=n([p],t)}(e("basePage"));t.exports=h,cc._RF.pop()},{basePage:void 0}],WindowsPageRetinueSuccess:[function(e,t){"use strict";cc._RF.push(t,"c4a8eB4VSxAO4Pv7j6JptdD","WindowsPageRetinueSuccess");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=this&&this.__awaiter||function(e,t,a,i){return new(a||(a=Promise))(function(n,r){function o(e){try{p(i.next(e))}catch(t){r(t)}}function s(e){try{p(i.throw(e))}catch(t){r(t)}}function p(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(o,s)}p((i=i.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var a,i,n,r,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(e){return function(t){return p([e,t])}}function p(r){if(a)throw new TypeError("Generator is already executing.");for(;o;)try{if(a=1,i&&(n=2&r[0]?i.return:r[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,r[1])).done)return n;switch(i=0,n&&(r=[2&r[0],n.value]),r[0]){case 0:case 1:n=r;break;case 4:return o.label++,{value:r[1],done:!1};case 5:o.label++,i=r[1],r=[0];continue;case 7:r=o.ops.pop(),o.trys.pop();continue;default:if(!(n=(n=o.trys).length>0&&n[n.length-1])&&(6===r[0]||2===r[0])){o=0;continue}if(3===r[0]&&(!n||r[1]>n[0]&&r[1]<n[3])){o.label=r[1];break}if(6===r[0]&&o.label<n[1]){o.label=n[1],n=r;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(r);break}n[2]&&o.ops.pop(),o.trys.pop();continue}r=t.call(e,o)}catch(s){r=[6,s],i=0}finally{a=n=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},s=cc._decorator,p=s.ccclass,c=s.property,h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.lGeneralContent=null,t.rGeneralContent=null,t.labGenNameL=null,t.labGenNameR=null,t.lPowerContent=null,t.rPowerContent=null,t._lPower=null,t._rPower=null,t._lGeneral=null,t._rGeneral=null,t._pfbPower=null,t._pfbGeneral=null,t._powerChange=0,t._generalGuid="",t._bGeneralInfo=null,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this},t.prototype.start=function(){this.creatMask(!0),this.handleUI()},t.prototype.setParam=function(e){this._generalGuid=e.generalGuid,this._bGeneralInfo=e.bGeneralInfo,this._powerChange=e.powerChange,this.renderUI()},t.prototype.renderUI=function(){return r(this,void 0,Promise,function(){var e,t,a=this;return o(this,function(){return this._bGeneralInfo?(e=app.db.getGNameByGsid(this._bGeneralInfo.gsid),t=app.player.general[this._generalGuid],this.labGenNameL.string=this.labGenNameR.string=e,this._pfbPower?(this._lPower.getComponent("PowerDisplay").init({val:this._bGeneralInfo.power}),this._rPower.getComponent("PowerDisplay").init({val:t.power})):app.loadPowerDisplay().then(function(e){cc.isValid(a)&&(a._pfbPower=e,a._lPower=a._createPowerNode(a.lPowerContent,{val:a._bGeneralInfo.power}),a._rPower=a._createPowerNode(a.rPowerContent,{val:t.power}))}).catch(function(e){cc.warn(e)}),this._pfbGeneral?(this._lGeneral.getComponent("generalPortraitItem").initForOfficeByInfo(this._bGeneralInfo),this._rGeneral.getComponent("generalPortraitItem").initForOffice({gsid:t.gsid,level:""+(t.level||1),skinId:t.skin})):app.loadGeneralPortrait().then(function(e){cc.isValid(a)&&(a._pfbGeneral=e,a._lGeneral=a._createGeneralNode(a.lGeneralContent),a._lGeneral.getComponent("generalPortraitItem").initForOfficeByInfo(a._bGeneralInfo),a._rGeneral=a._createGeneralNode(a.rGeneralContent),a._rGeneral.getComponent("generalPortraitItem").initForOffice({gsid:t.gsid,level:""+(t.level||1),skinId:t.skin}))}).catch(function(e){cc.warn(e)}),[2]):[2]})})},t.prototype.onDestroy=function(){app.player.sfGetOfficialInfo().then(function(e){cc.director.emit("EVT_GENERAL_APPOINT_REFRESH_UI",e)},function(e){cc.warn("sfGetOfficialInfo error",e)}),cc.director.emit("EVT_OFFICE_POWER_CHANGE",this._powerChange),e.prototype.onDestroy.call(this)},t.prototype._createPowerNode=function(e,t){var a=cc.instantiate(this._pfbPower);return e.addChild(a),a.setPosition(cc.Vec2.ZERO),a.getComponent("PowerDisplay").init(t),a},t.prototype._createGeneralNode=function(e){if(!this._pfbGeneral)return null;var t=cc.instantiate(this._pfbGeneral);return e.addChild(t),t.setPosition(cc.Vec2.ZERO),t},t.prefabPath="windowsPageRetinueSuccess",t.pageType=1,n([c({type:cc.Node})],t.prototype,"lGeneralContent",void 0),n([c(cc.Node)],t.prototype,"rGeneralContent",void 0),n([c(cc.Label)],t.prototype,"labGenNameL",void 0),n([c(cc.Label)],t.prototype,"labGenNameR",void 0),n([c(cc.Node)],t.prototype,"lPowerContent",void 0),n([c(cc.Node)],t.prototype,"rPowerContent",void 0),a=n([p],t)}(e("basePage"));t.exports=h,cc._RF.pop()},{basePage:void 0}],WindowsPageRingRank:[function(e,t){"use strict";cc._RF.push(t,"978bfaMcRZKwrLspL0D4niL","WindowsPageRingRank");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=cc._decorator,o=r.ccclass,s=r.property,p=e("basePage"),c=e("langMgr"),h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.nodeTabV=null,t.labTime=null,t.labOwnHonor=null,t.labHourlyHonor=null,t.labHonorEarnings=null,t.labHonorLimit=null,t.btnGetReward=null,t.labPlaceholder=null,t.btnChallenge=null,t.btnDefense=null,t.btnHistory=null,t.btnHelp=null,t.btnPrevReward=null,t.nodeSelfRankItem=null,t.nodeChallengeRedPoint=null,t.labTimeTip=null,t.btnReward=null,t._listData=[],t._selfInfo=null,t._lastRewardTime=0,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(),this.handleUI(),this.fitTopMenu()},t.prototype.start=function(){this.addUIEvent(),this.addEvent()},t.prototype.setParam=function(e){this._listData=e.items,this._selfInfo=e.owner,this._lastRewardTime=this._selfInfo.last_honor_time,this._renderView(),this.labTimeTip.string=c.getString("windowsPageRingRank",0)},t.prototype.addUIEvent=function(){var e=this;this.btnHelp.node.on("click",function(){app.playSound("click"),app.pages.windowspagetipshelp.showPage("1122")},this),this.btnChallenge.node.on("click",function(){app.playSound("click"),a.isOpen()?app.pages.pvpmatchpage.showPage({type:"ringpvp"}):app.showNotice(c.getString("windowsPageRingRank",1))},this),this.btnDefense.node.on("click",function(){app.playSound("click"),app.battleType="ringpvpsave",app.goToNormBattle()},this),this.btnHistory.node.on("click",function(){app.playSound("click"),app.player.sfQueryRingHistory({type:0}).then(function(e){app.pages.pvpreplaypage.showPage({videoList:e,type:1})}).catch(function(e){cc.warn("\u67e5\u8be2\u5168\u90e8\u8bb0\u5f55\u5931\u8d25: ",e)})},this),this.btnGetReward.node.on("click",function(){app.playSound("click"),e.btnGetReward.interactable=!1,e.scheduleOnce(function(){e.btnGetReward.interactable=!0},3),app.player.sfGetRingHonorReward().then(function(t){var a;cc.isValid(e)&&void 0!==t.honor&&(e._selfInfo.honor=0,e._selfInfo.role.honor_value+=t.honor,app.player.addItem([{GSID:38018,COUNT:t.honor}]),e._renderEarningLabel(),e.labOwnHonor.string=""+c.getString("pvpRanktabvItem",3)+gUtils.showNum(e._selfInfo.role.honor_value),cc.director.emit("EVT_REFRESH_SELF_OWN_HONOR",{rid:e._selfInfo.rid,honor:null!==(a=e._selfInfo.role.honor_value)&&void 0!==a?a:0}))}).catch(function(e){cc.warn("get ring honor reward err: ",e),"ring finished"===e&&app.showNotice(c.getString("windowsPageRingRank",1))})},this),this.btnReward.node.on("click",function(){var t,a;app.playSound("click"),app.pages.militaryRankRewardPage.showPage({rank:null!==(a=null===(t=e._selfInfo)||void 0===t?void 0:t.rank)&&void 0!==a?a:0,rewardList:app.db.getRingRankReward()})},this)},t.prototype._renderView=function(){var e,t,a;this.nodeSelfRankItem.getComponent("RingRankItem").renderSelfView(this._selfInfo,this);var i=this._listData.length;this.labPlaceholder.node.opacity=i>0?0:255,i>0&&this.nodeTabV.getComponent("tableView").initTableView(i,{array:this._listData,target:this});var n=12*(this._selfInfo.honor_rate||0),r=(null!==(e=this._selfInfo.honor)&&void 0!==e?e:0)/(this._selfInfo.honor_pool_limit||.1)>=.9,o=(new cc.Color).fromHEX(r?"#FF5C1D":"#89FF25");this.labHonorEarnings.node.color=o,this.labHonorEarnings.getComponent(cc.LabelOutline).color=o.fromHEX(r?"#631414":"#2A5707"),this.labHourlyHonor.string=""+Math.floor(n),this._selfInfo.honor=null!==(t=this._selfInfo.honor)&&void 0!==t?t:0,this._renderEarningLabel(),this.schedule(this._increaseHonor,5),this.labHonorLimit.string="/"+gUtils.showNum(this._selfInfo.honor_pool_limit),this.labOwnHonor.string=""+c.getString("pvpRanktabvItem",3)+gUtils.showNum(null!==(a=this._selfInfo.role.honor_value)&&void 0!==a?a:0),this._refreshRedPoint()},t.prototype._increaseHonor=function(){a.isOpen()&&(this._selfInfo.honor+=this._selfInfo.honor_rate,this._selfInfo.honor=cc.misc.clampf(this._selfInfo.honor,0,this._selfInfo.honor_pool_limit),gUtils.showNum(Math.floor(this._selfInfo.honor))!==this.labHonorEarnings.string&&this._renderEarningLabel())},t.prototype._renderEarningLabel=function(){var e=this._selfInfo.honor/(this._selfInfo.honor_pool_limit||.1)>=.9,t=(new cc.Color).fromHEX(e?"#FF5C1D":"#89FF25");this.labHonorEarnings.node.color=t,this.labHonorEarnings.getComponent(cc.LabelOutline).color=t.fromHEX(e?"#631414":"#2A5707"),this.labHonorEarnings.string=""+gUtils.showNum(Math.floor(this._selfInfo.honor))},t.prototype.addEvent=function(){var e=this;eventMgr.on(eventStr.ringPvp.REFRESH_RANK_VIEW,function(){app.player.sfQueryRingRank().then(function(t){if(cc.isValid(e)){if(!t.owner)return cc.warn("\u73a9\u5bb6\u672a\u62a5\u540d\u64c2\u53f0\u8d5b"),void e.onClose();e._listData=t.items,e._selfInfo=t.owner,e._lastRewardTime=e._selfInfo.last_honor_time,e._renderView()}}).catch(function(e){cc.warn("\u56fd\u6218\u64c2\u53f0\u6392\u884c\u699c\u6570\u636e\u9519\u8bef",e)})},this),eventMgr.on(eventStr.commonEvent.RefreshTime,this._refreshCountDown,this)},t.prototype.removeEvent=function(){eventMgr.targetOff(this)},t.prototype.onDestroy=function(){e.prototype.onDestroy&&e.prototype.onDestroy.call(this),this.removeEvent()},t.prototype._refreshRedPoint=function(){this.nodeChallengeRedPoint.opacity=a.isOpen()&&app.player.getCount(90050)>0?255:0},t.prototype._refreshCountDown=function(){var e,t,a=(null!==(t=null===(e=app.lockFunConfig.NATION_RING)||void 0===e?void 0:e.end)&&void 0!==t?t:0)-app.player.getServerTime();a<0&&(a=0),this.labTime.string=gUtils.getCountDownStr(a)},t.prototype.onClose=function(){e.prototype.onClose&&e.prototype.onClose.call(this),cc.director.emit("EVT_REFRESH_MILITARY_RANK_DATA")},t.prefabPath="windowsPageRingRank",t.isOpen=function(){var e,t,a,i,n;return 0===(null===(t=null===(e=app.lockFunConfig)||void 0===e?void 0:e.NATION_RING)||void 0===t?void 0:t.lock)&&app.player.getServerTime()<(null!==(n=null===(i=null===(a=app.lockFunConfig)||void 0===a?void 0:a.NATION_RING)||void 0===i?void 0:i.end)&&void 0!==n?n:0)},t.refreshRed=function(e){var t=app.player.getCount(90050)>0&&a.isOpen();return cc.isValid(e)&&cc.Node.isNode(e)&&(e.active=t),t},n([s(cc.Node)],t.prototype,"nodeTabV",void 0),n([s(cc.Label)],t.prototype,"labTime",void 0),n([s({type:cc.Label,tooltip:"\u73a9\u5bb6\u62e5\u6709\u8363\u8a89\u503c"})],t.prototype,"labOwnHonor",void 0),n([s({type:cc.Label,tooltip:"\u8363\u8a89\u503c\u6bcf\u5c0f\u65f6\u6536\u76ca"})],t.prototype,"labHourlyHonor",void 0),n([s({type:cc.Label,tooltip:"\u5f53\u524d\u8363\u8a89\u503c\u6302\u673a\u6536\u76ca"})],t.prototype,"labHonorEarnings",void 0),n([s({type:cc.Label,tooltip:"\u8363\u8a89\u503c\u6302\u673a\u6536\u76ca\u4e0a\u9650"})],t.prototype,"labHonorLimit",void 0),n([s({type:cc.Button,tooltip:"\u6302\u673a\u6536\u76ca\u5b9d\u7bb1\u6309\u94ae"})],t.prototype,"btnGetReward",void 0),n([s({type:cc.Label,tooltip:"\u6392\u884c\u699c\u4e3a\u7a7a\u5360\u4f4d\u6587\u672c"})],t.prototype,"labPlaceholder",void 0),n([s(cc.Button)],t.prototype,"btnChallenge",void 0),n([s(cc.Button)],t.prototype,"btnDefense",void 0),n([s(cc.Button)],t.prototype,"btnHistory",void 0),n([s(cc.Button)],t.prototype,"btnHelp",void 0),n([s(cc.Button)],t.prototype,"btnPrevReward",void 0),n([s(cc.Node)],t.prototype,"nodeSelfRankItem",void 0),n([s(cc.Node)],t.prototype,"nodeChallengeRedPoint",void 0),n([s(cc.Label)],t.prototype,"labTimeTip",void 0),n([s(cc.Button)],t.prototype,"btnReward",void 0),a=n([o],t)}(p);t.exports=h,cc._RF.pop()},{basePage:void 0,langMgr:void 0}],WindowsPageSkinReward:[function(e,t){"use strict";cc._RF.push(t,"3569cDOEiRK4rhnJg8lpmwl","WindowsPageSkinReward");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=cc._decorator,o=r.ccclass,s=r.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_sprGeneral=null,t.p_spGeneral=null,t.p_animGeneral=null,t.labSkinName=null,t.spSkinBg=null,t.p_sprName=null,t.p_sprStar=[],t.p_sprCamp=null,t.p_sprOccu=null,t.p_sprOccu2=null,t._curGuid="",t._skinInfo=null,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,this.handleUI(),this.stopNodeEvent(),app.playSound("reward")},t.prototype.handleUI=function(){var e=this;this.spSkinBg.node.on("touchend",function(){e.onClose()})},t.prototype.setParam=function(e){this._curGuid=e.guid,this._skinInfo=e.skinInfo,this._initView()},t.prototype._initView=function(){var e=this;this._loadGeneralSkin(),this._loadSkinThemeBg();var t=app.db.getGBaseByGsid(this._skinInfo.GENERAL_GSID);t||(t={GSID:0,NAME:"\u672a\u77e5\u6b66\u5c06",CAMP:1,STAR:1,TGRADE:1});var a=app.db.getGNamePathHByGsid(this._skinInfo.GENERAL_GSID);app.loadTexture(a,this.p_sprName,this.prefabPath);var i=gConfig.getIconGCampPath(t.CAMP-1);if(app.loadTexture(i,this.p_sprCamp,this.prefabPath),gConfig.getNameGOccu(t.OCCU-1)){var n=gConfig.getIconGOccuPath(t.OCCU-1);app.loadTexture(n,this.p_sprOccu,this.prefabPath),this.p_sprOccu.node.active=!0}else this.p_sprOccu.node.active=!1;t.OCCU2&&gConfig.getNameGOccu(t.OCCU2-1)?(n=gConfig.getIconGOccuPath(t.OCCU2-1),app.loadTexture(n,this.p_sprOccu2,this.prefabPath),this.p_sprOccu2.node.active=!0):this.p_sprOccu2.node.active=!1;var r=t.STAR,o=(r-1)%5;r>=10&&(o=0);var s=gConfig.getIconGBigStarPath(t.STAR);this.p_sprStar.forEach(function(t,a){t.node.active=o>=a,app.loadTexture(s,t,e.prefabPath)})},t.prototype._loadGeneralSkin=function(){var e=app.player.general[this._curGuid];if(e){var t=this._skinInfo.SKIN_ID;app.loadGeneral(e.gsid,this.p_sprGeneral,this.p_spGeneral,this.p_animGeneral,null,this.prefabPath,t)}},t.prototype._loadSkinThemeBg=function(){var e=app.player.general[this._curGuid],t=this._skinInfo.SKIN_ID,a=app.db.getSkinThemeBySkinId(e.gsid,t);a&&app.loadTexture(a,this.spSkinBg)},t.prefabPath="windowsPageSkinReward",t.pageType=1,n([s({type:cc.Sprite,tooltip:"\u6b66\u5c06\u7acb\u7ed8"})],t.prototype,"p_sprGeneral",void 0),n([s({type:sp.Skeleton,tooltip:"\u6b66\u5c06spine"})],t.prototype,"p_spGeneral",void 0),n([s({type:cc.Animation,tooltip:"\u6b66\u5c06anim"})],t.prototype,"p_animGeneral",void 0),n([s(cc.Label)],t.prototype,"labSkinName",void 0),n([s({type:cc.Sprite})],t.prototype,"spSkinBg",void 0),n([s(cc.Sprite)],t.prototype,"p_sprName",void 0),n([s([cc.Sprite])],t.prototype,"p_sprStar",void 0),n([s(cc.Sprite)],t.prototype,"p_sprCamp",void 0),n([s(cc.Sprite)],t.prototype,"p_sprOccu",void 0),n([s(cc.Sprite)],t.prototype,"p_sprOccu2",void 0),a=n([o],t)}(e("basePage"));t.exports=p,cc._RF.pop()},{basePage:void 0}],WindowsPageSoulBindingInfo:[function(e,t){"use strict";cc._RF.push(t,"e22afPTxBBA7qvvCQoQol6M","WindowsPageSoulBindingInfo");var a,i,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),r=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},o=e("../lang/langMgr"),s=cc._decorator,p=s.ccclass,c=s.property,h=e("basePage");(function(e){e[e.Unlock=0]="Unlock",e[e.Lock=1]="Lock"})(i||(i={}));var l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.btnConfirm=null,t.btnCancel=null,t.generalPortraitL=null,t.generalPortraitR=null,t.beforePower=null,t.afterPower=null,t.levelValueL=null,t.hpValueL=null,t.attackValueL=null,t.defenseValueL=null,t.magicDefValueL=null,t.levelValueR=null,t.hpValueR=null,t.attackValueR=null,t.defenseValueR=null,t.magicDefValueR=null,t.beforeInfo=null,t.afterInfo=null,t.bindInfo=null,t}var a;return n(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},t.prototype.start=function(){this.addUIEvent()},t.prototype.addUIEvent=function(){var e=this;this.btnConfirm.on("click",function(){window.app.playSound("click");var t=window.app.player.getServerTime();try{if(t>(window.app.player.general[e.bindInfo.guid].expireAt?window.app.player.general[e.bindInfo.guid].expireAt:0))return window.app.showNotice(o.getString("WindowsPageSoulBindingInfo",0)),void e.onClose()}catch(a){return cc.error("\u7075\u9b42\u6b66\u5c06\u83b7\u53d6\u8fc7\u671f\u65f6\u95f4\u9519\u8bef"),window.app.showNotice(o.getString("WindowsPageSoulBindingInfo",1)),void e.onClose()}e.bindInfo&&window.app.player.sfGeneralSoulBind(e.bindInfo,function(t){cc.log("=== soul bind success ===",t),window.app.player.addGeneral([t.general]),cc.director.emit("EVT_REFRESH_BIND_UI"),e.onClose(),window.app.pages.windowsPageCompleteSoulBinding.showPage({beforeInfo:e.beforeInfo,afterInfo:e.afterInfo,bindType:i.Lock})})},this),this.btnCancel.on("click",function(){window.app.playSound("click"),e.onClose()},this)},t.prototype.setParam=function(e){this.beforeInfo=e.beforeInfo,this.afterInfo=e.afterInfo,this.bindInfo=e.bindInfo,this.initUI()},t.prototype.initUI=function(){this.beforePower.getComponent("num").init(this.beforeInfo.power),this.levelValueL.string=""+this.beforeInfo.level,this.hpValueL.string=""+this.beforeInfo.property.hp,this.attackValueL.string=""+this.beforeInfo.property.atk,this.defenseValueL.string=""+this.beforeInfo.property.def,this.magicDefValueL.string=""+this.beforeInfo.property.mdef,this.afterPower.getComponent("num").init(this.afterInfo.power),this.levelValueR.string=""+this.afterInfo.level,this.hpValueR.string=""+this.afterInfo.property.hp,this.attackValueR.string=""+this.afterInfo.property.atk,this.defenseValueR.string=""+this.afterInfo.property.def,this.magicDefValueR.string=""+this.afterInfo.property.mdef,this.generalPortraitL.getComponent("generalPortraitItem").initForTips({gsid:this.beforeInfo.gsid,level:""+this.beforeInfo.level}),this.generalPortraitR.getComponent("generalPortraitItem").initForTips({gsid:this.afterInfo.gsid,level:""+this.afterInfo.level})},t.prefabPath="windowsPageSoulBindingInfo",t.pageType=1,r([c({type:cc.Node})],t.prototype,"btnConfirm",void 0),r([c({type:cc.Node})],t.prototype,"btnCancel",void 0),r([c({type:cc.Node})],t.prototype,"generalPortraitL",void 0),r([c({type:cc.Node})],t.prototype,"generalPortraitR",void 0),r([c({type:cc.Node})],t.prototype,"beforePower",void 0),r([c({type:cc.Node})],t.prototype,"afterPower",void 0),r([c(cc.Label)],t.prototype,"levelValueL",void 0),r([c(cc.Label)],t.prototype,"hpValueL",void 0),r([c(cc.Label)],t.prototype,"attackValueL",void 0),r([c(cc.Label)],t.prototype,"defenseValueL",void 0),r([c(cc.Label)],t.prototype,"magicDefValueL",void 0),r([c(cc.Label)],t.prototype,"levelValueR",void 0),r([c(cc.Label)],t.prototype,"hpValueR",void 0),r([c(cc.Label)],t.prototype,"attackValueR",void 0),r([c(cc.Label)],t.prototype,"defenseValueR",void 0),r([c(cc.Label)],t.prototype,"magicDefValueR",void 0),a=r([p],t)}(h);t.exports=l,cc._RF.pop()},{"../lang/langMgr":void 0,basePage:void 0}],WindowsPageSportsReward:[function(e,t){"use strict";cc._RF.push(t,"a69cb/mSNxFMqAZxKEdlN2D","WindowsPageSportsReward");var a,i,n,r=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),o=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},s=cc._decorator,p=s.ccclass,c=s.property,h=e("basePage");(function(e){e[e.None=0]="None",e[e.UnReceived=1]="UnReceived",e[e.Received=2]="Received"})(i||(i={})),function(e){e[e.None=-1]="None",e[e.JDCard=0]="JDCard",e[e.CashCoupon=1]="CashCoupon"}(n||(n={}));var l=[38017,30999],g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.propItems=[],t.labRank=null,t.labCountDown=null,t.labSevInfo=null,t.btnHelp=null,t.btnRewards=[],t.labRewardCounts=[],t.nodeReceived=[],t._state=i.None,t._rank=0,t._rewardType=n.None,t._rewardList=[],t}var a;return r(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.addUIEvent()},t.prototype.addUIEvent=function(){var e=this;this.btnHelp.node.on("click",function(){app.playSound("click"),app.pages.windowspagetipshelp.showPage(1106)},this),this.btnRewards.forEach(function(t,a){t.node.on("click",function(){app.pages.windowspagetipsmsg.showPage({content:"\u5956\u52b1\u4e3a\u4e8c\u9009\u4e00\uff0c\u662f\u5426\u786e\u8ba4\u5f53\u524d\u9009\u62e9\uff1f",confirmcb:function(){var t;t=e._rewardList[a],app.player.sfChooseSportsReward({type:a}).then(function(){app.sportsRewardInfo.rewardType=a,app.sportsRewardInfo.state=i.Received,a===n.CashCoupon?(app.player.addItem(t),app.pages.windowspagereward.showPage({showtype:1,reward:[t]})):a===n.JDCard&&app.showNotice("\u9886\u53d6\u6210\u529f\uff0c\u8bf7\u8010\u5fc3\u7b49\u5f85\u90ae\u4ef6\uff01"),cc.isValid(e)&&(e._state=i.Received,e._rewardType=a,e._drawView())}).catch(function(e){cc.warn("\u516c\u5e73\u7ade\u6280\u573a\u5956\u52b1\u9009\u62e9\u5931\u8d25: ",e)})},target:e})},e)})},t.prototype.setParam=function(e){this._state=e.state,this._rank=e.rank,this._rewardList=e.rewards.sort(function(e,t){return t.GSID-e.GSID}),this._rewardType=e.rewardType,this.labSevInfo.string=(app.serverarea||"")+"    "+(app.serverserv||""),this.labRank.string="\u7b2c"+this._rank+"\u540d",this.schedule(this._renderCountDown,1),this._drawView()},t.prototype._drawView=function(){var e=this;if(this._state===i.None)return cc.warn("\u6b64\u8d26\u53f7\u65e0\u5956\u52b1"),void this.onClose();this.btnRewards.forEach(function(t){e._state===i.Received&&(t.node.active=!1)}),this.nodeReceived.forEach(function(t,a){e._state===i.Received?t.opacity=a===e._rewardType?255:0:t.opacity=0}),this.propItems.forEach(function(e,t){e.getComponent("propItem").initForGsid(l[t]),e.getComponent("propItem").setClick(!0)}),this.labRewardCounts.forEach(function(t,a){t.string=(e._rewardList[a]?e._rewardList[a].COUNT:0)+"\u5143"})},t.prototype._renderCountDown=function(){if(app.sportsRewardInfo){var e=app.sportsRewardInfo.etime-app.player.getServerTime();if(e<0)return this.onClose();this.labCountDown.string=gUtils.getCountDownStr(e)}},t.prototype.onDestroy=function(){"function"==typeof e.prototype.onDestroy&&e.prototype.onDestroy.call(this),this.unschedule(this._renderCountDown)},t.prefabPath="windowsPageSportsReward",t.pageType=1,t.isOpen=function(){if(!app.sportsRewardInfo)return!1;var e=app.player.getServerTime(),t=app.sportsRewardInfo.start,a=app.sportsRewardInfo.etime;return app.sportsRewardInfo.state>i.None&&e>=t&&e<=a},o([c([cc.Node])],t.prototype,"propItems",void 0),o([c(cc.Label)],t.prototype,"labRank",void 0),o([c(cc.Label)],t.prototype,"labCountDown",void 0),o([c(cc.Label)],t.prototype,"labSevInfo",void 0),o([c(cc.Button)],t.prototype,"btnHelp",void 0),o([c([cc.Button])],t.prototype,"btnRewards",void 0),o([c([cc.Label])],t.prototype,"labRewardCounts",void 0),o([c([cc.Node])],t.prototype,"nodeReceived",void 0),a=o([p],t)}(h);t.exports=g,cc._RF.pop()},{basePage:void 0}],WindowsPageTipsExclusiveEquip:[function(e,t){"use strict";cc._RF.push(t,"c4d0cLYHzdMoJMdo+LNGp/p","WindowsPageTipsExclusiveEquip");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=e("langMgr"),o=cc._decorator,s=o.ccclass,p=o.property,c=e("basePage"),h=(new cc.Color).fromHEX("#606060"),l=(new cc.Color).fromHEX("#E8E8E8"),g=(new cc.Color).fromHEX("#434343"),d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_spEquipFrame=null,t.equipIcon=null,t.labPropLv=null,t.labPropName=null,t.labExclusiveName=null,t.labPropIntro=null,t.skillItems=[],t.btnStrength=null,t.propertyList=[],t.skillLockTips=[],t.btnMaxLv=null,t.btnActivate=null,t._genUid="",t._equipLv=1,t._propPfb=null,t}var a;return i(t,e),a=t,t.prototype.setParam=function(e){this._genUid=e.guid,this.renderView()},t.prototype.renderView=function(){var e,t=this,a=app.player.general[this._genUid];if(a){this._equipLv=a.exclusive_equip||0;var i=app.db.getExclMaxLv(a.gsid),n=app.db.getGenExclEquipInfoByGsid(a.gsid),o=((0===this._equipLv?i:this._equipLv)-1)/10|0,s=gConfig.getGlobalQualityPath(o+4);app.loadTexture(s,this.p_spEquipFrame,this.prefabPath);var p=app.db.getExclEquipIconPath(n.PROP_ICON);app.loadTexture(p,this.equipIcon,this.prefabPath),this.labPropLv.string="+"+(this._equipLv||i),this.labPropIntro.string=null!==(e=n.EXCLUSIVE_INTRO)&&void 0!==e?e:"",this.labPropName.string=n.EXCLUSIVE_NAME;var c=app.db.getGBaseByGsid(a.gsid);this.labExclusiveName.string=r.getString("windowsPageTipsExclusiveEquip",0,c.NAME);var d=app.db.getExclEquipStrengthInfoByOccu(a.occu,this._equipLv||i);if(this.btnStrength.node.active=0!==this._equipLv&&this._equipLv<i,this.btnActivate.node.active=0===this._equipLv,this.btnStrength.node.active){var u=this.btnStrength.node.getChildByName("rednotice");cc.isValid(u)&&(u.opacity=this._checkBtnRedVisible()?255:0)}cc.isValid(this.btnMaxLv)&&(this.btnMaxLv.node.active=this._equipLv===i),this.propertyList.forEach(function(e,t){var a=d.ATTR[t];if(!a)return e.opacity=0;e.getComponent("propertyItem").refreshUI(a)});for(var f=app.db.getExclusiveSkillLockLv(a.occu),m=[],_=0===this._equipLv?i:this._equipLv,v=0;v<f.length;++v)f[v]>_&&m.push(v);var b=n.EXCLUSIVE_SKILLS,y=function(e){if(!cc.isValid(P.skillItems[e]))return"break";P.skillItems[e].getComponent("skillItem").initForShow(b[e]),P.skillItems[e].targetOff(P),P.skillItems[e].on(cc.Node.EventType.TOUCH_END,function(){var t={type:"general",gsid:b[e],index:e};app.pages.windowspagetipsskill.showPage(t)},P)},P=this;for(v=0;v<b.length&&"break"!==y(v);v++);this.skillLockTips.forEach(function(e,a){if(m.includes(a)||0===t._equipLv){if(e.node.opacity||(e.node.opacity=255),e.string=r.getString("windowsPageTipsExclusiveEquip",1,f[a]),t.skillLockTips[a].node.color=l,t.skillLockTips[a].getComponent(cc.LabelOutline).color=g,0!=t._equipLv){var i=t.skillItems[a].getComponent("skillItem").p_labName;if(!cc.isValid(i))return;i.node.color=h,app.setNodeState(t.skillItems[a],!0)}}else e.node.opacity=0})}},t.prototype._checkBtnRedVisible=function(){var e=app.player.general[this._genUid];if(!e)return!1;var t=e.exclusive_equip?e.exclusive_equip:0;return!(t>=app.db.getExclMaxLv(e.gsid))&&!(app.db.getExclConsumeByGsid(e.gsid,t).filter(function(e){var t=e.COUNT;return app.player.getCount(e.GSID)<t}).length>0)&&Boolean(t)},t.prototype.onLoad=function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.addUIEvent()},t.prototype.addUIEvent=function(){var e=this;this.btnStrength.node.on("click",function(){app.playSound("click"),e.onClose(),app.pages.windowsPageExclusiveEquip.showPage({guid:e._genUid})},this),cc.isValid(this.btnMaxLv)&&(app.setNodeState(this.btnMaxLv.node,!0),this.btnMaxLv.node.on("click",function(){app.playSound("click"),app.showNotice(r.getString("windowsPageTipsExclusiveEquip",2))},this)),cc.isValid(this.btnActivate)&&this.btnActivate.node.on("click",function(){app.playSound("click"),e.onClose(),app.pages.windowsPageExclusiveEquip.showPage({guid:e._genUid})},this)},t.prefabPath="windowsPageTipsExclusiveEquip",t.pageType=1,n([p(cc.Sprite)],t.prototype,"p_spEquipFrame",void 0),n([p(cc.Sprite)],t.prototype,"equipIcon",void 0),n([p(cc.Label)],t.prototype,"labPropLv",void 0),n([p(cc.Label)],t.prototype,"labPropName",void 0),n([p(cc.Label)],t.prototype,"labExclusiveName",void 0),n([p(cc.Label)],t.prototype,"labPropIntro",void 0),n([p({type:[cc.Node]})],t.prototype,"skillItems",void 0),n([p(cc.Button)],t.prototype,"btnStrength",void 0),n([p({type:[cc.Node]})],t.prototype,"propertyList",void 0),n([p([cc.Label])],t.prototype,"skillLockTips",void 0),n([p(cc.Button)],t.prototype,"btnMaxLv",void 0),n([p(cc.Button)],t.prototype,"btnActivate",void 0),a=n([s],t)}(c);t.exports=d,cc._RF.pop()},{basePage:void 0,langMgr:void 0}],WindowsPageTipsRebate:[function(e,t){"use strict";cc._RF.push(t,"aa45eQuoARGX7lPGsET0R/D","WindowsPageTipsRebate");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=cc._decorator,o=r.ccclass,s=r.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.btnGet=null,t.propItems=[],t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,this.handleUI(),this.stopBgNodeEvent(),this.creatMask(!0),this.addUIEvent()},t.prototype.addUIEvent=function(){var e=this;this.btnGet.node.on("click",function(){app.playSound("click"),app.player.sfRebateConfirm("jsfc",function(t,a){if(t)return cc.warn(t);app.player.addItem(a.items),app.pages.windowspagereward.showPage({showtype:1,reward:a.items,target:e,confirmcb:function(){app.player.sfRebateCheck("jsfc",function(t,a){t?cc.warn(t):(e.onClose(),app.pages.activityRebateProcessPage.showPage(a))})}})})},this)},t.prototype.setParam=function(e){this.propItems.forEach(function(t,a){t.active=Boolean(e.rewards[a]),e.rewards[a]&&(t.getComponent("propItem").initForRebate(e.rewards[a]),t.getComponent("propItem").setClick(!0))})},t.prefabPath="windowsPageTipsRebate",t.pageType=1,n([s(cc.Button)],t.prototype,"btnGet",void 0),n([s({type:[cc.Node]})],t.prototype,"propItems",void 0),a=n([o],t)}(e("basePage"));t.exports=p,cc._RF.pop()},{basePage:void 0}],WindowsPageWarRewardList:[function(e,t){"use strict";cc._RF.push(t,"71f416KyzBIe6dkZXDixA8u","WindowsPageWarRewardList");var a,i,n,r=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,a=1,i=arguments.length;a<i;a++)for(var n in t=arguments[a])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},s=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},p=cc._decorator,c=p.ccclass,h=p.property,l=e("basePage");(function(e){e[e.Fail=-1]="Fail",e[e.Draw=0]="Draw",e[e.Win=1]="Win"})(i||(i={})),function(e){e[e.None=-1]="None",e[e.Legion=0]="Legion",e[e.AllServer=1]="AllServer",e[e.Nation=2]="Nation"}(n||(n={}));var g=e("../lang/langMgr"),d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.btnGo=null,t.labTip=[],t.nodeLevelLine=null,t.propList=null,t.labName=null,t.labChapter=null,t.labRewardNum=null,t._type=n.None,t._auctionList=[],t._resultState=i.Draw,t}var a;return r(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},t.prototype.start=function(){this.addUIEvent()},t.prototype.setParam=function(e){if(this._auctionList=e.auctionList,this._type=e.type,e.otherInfo&&(this._otherInfo=e.otherInfo),this._type===n.Legion&&app.updateLegionAuctionInfo(this._auctionList),this._type===n.Legion&&app.legionPvpInfo)if(app.legionPvpInfo.report.winner){var t=app.legionInfo.servid+"_"+app.legionInfo.id,a="";for(var r in app.legionPvpInfo.report._legion_)if(app.legionPvpInfo.report._legion_.hasOwnProperty(r)&&app.legionPvpInfo.report._legion_[r]===t){a=r;break}this._resultState=a===app.legionPvpInfo.report.winner?i.Win:i.Fail}else this._resultState=i.Draw;this.renderUI()},t.prototype.renderUI=function(){this.propList.getComponent("tableView").initTableView(this._auctionList.length,{target:this,array:this._auctionList.map(function(e){return e.item}),initfun:"initForBag"}),this.propList.getComponent("tableView").getCells(function(e){e.forEach(function(e){e.getComponentInChildren("propItem")&&e.getComponentInChildren("propItem").setClick(!0)})});var e="";if(this._type==n.Legion){switch(!0){case this._resultState===i.Draw:e=g.getString("WindowsPageWarRewardList",0);break;case this._resultState===i.Fail:e=g.getString("WindowsPageWarRewardList",1);break;case this._resultState===i.Win:e=g.getString("WindowsPageWarRewardList",2)}e=g.getString("WindowsPageWarRewardList",3,[e,this._auctionList.length]),this.labName.node.parent.active=!1}else this._type==n.AllServer&&(this.labTip.forEach(function(e,t){e.string=g.getString("WindowsPageWarRewardList",t+5)}),this.labName.node.parent.active=!0,this.labName.string=this._otherInfo.rname,this._otherInfo.chapter>0?(this.nodeLevelLine.active=!0,this.labChapter.string=g.getString("WindowsPageWarRewardList",10,this._otherInfo.chapter)):this.nodeLevelLine.active=!1,this.labRewardNum.string=g.getString("WindowsPageWarRewardList",11,this._otherInfo.rewardnum))},t.prototype.addUIEvent=function(){var e=this;this.btnGo.node.on("click",function(){app.playSound("click"),app.player.sfAuctionList(e._type).then(function(t){var a=o({},t);a.type=e._type,app.pages.windowsPageAuction.showPage(a)}).catch(function(e){cc.warn("auction error: ",JSON.stringify(e))})},this)},t.prefabPath="windowsPageWarRewardList",t.pageType=1,s([h({type:cc.Button})],t.prototype,"btnGo",void 0),s([h(cc.Label)],t.prototype,"labTip",void 0),s([h(cc.Node)],t.prototype,"nodeLevelLine",void 0),s([h(cc.Node)],t.prototype,"propList",void 0),s([h(cc.Label)],t.prototype,"labName",void 0),s([h(cc.Label)],t.prototype,"labChapter",void 0),s([h(cc.Label)],t.prototype,"labRewardNum",void 0),a=s([c],t)}(l);t.exports=d,cc._RF.pop()},{"../lang/langMgr":void 0,basePage:void 0}],WindowsPageWeektargetLclb:[function(e,t){"use strict";cc._RF.push(t,"03199s8KvNPJoyU0+TKVWCp","WindowsPageWeektargetLclb");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=cc._decorator,o=r.ccclass,s=r.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.lclbItemsscollew=null,t.qrmbItem=null,t.giftName=null,t.nextConsume=null,t.currentConsume=null,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},t.prototype.setParam=function(e){this.m_lclbItemsInfo=e,this.m_consumeMark=this.m_lclbItemsInfo[0].ITEMS[0].MARK,this.m_currentConsume=app.player.getCount(this.m_consumeMark),this.m_nextLv=0,this.m_Lv=0,this.m_arrItems=[],this.renderUI()},t.prototype.renderUI=function(){for(var e=0;e<this.m_lclbItemsInfo.length;e++){var t=this.m_lclbItemsInfo[e].ITEMS[0],a=this.m_arrItems[e];a||((a=cc.instantiate(this.qrmbItem)).parent=this.lclbItemsscollew.content,this.m_arrItems.push(a)),a.getComponent("activeQrmbItemLclb").refreshUI(t,e,this),a.active=!0,0==this.m_nextLv&&this.m_lclbItemsInfo[e].ITEMS[0].NUM>=this.m_currentConsume&&(this.m_nextLv=this.m_lclbItemsInfo[e].ITEMS[0].NUM,this.m_Lv=e+1)}this.currentConsume.string=""+this.m_currentConsume,this.nextConsume.string=""+(this.m_nextLv-this.m_currentConsume);var i=gConfig.rootPath.uiweektargetlclb+"txt_qrmb_rlclb0"+this.m_Lv+"_lang";app.loadTexture(i,this.giftName,this.prefabPath)},t.prefabPath="windowsPageWeektargetLclb",t.pageType=1,n([s({type:cc.ScrollView})],t.prototype,"lclbItemsscollew",void 0),n([s({type:cc.Prefab})],t.prototype,"qrmbItem",void 0),n([s({type:cc.Sprite})],t.prototype,"giftName",void 0),n([s({type:cc.Label})],t.prototype,"nextConsume",void 0),n([s({type:cc.Label})],t.prototype,"currentConsume",void 0),a=n([o],t)}(e("basePage"));t.exports=p,cc._RF.pop()},{basePage:void 0}],activityBlessBagPage:[function(e,t){"use strict";var a;cc._RF.push(t,"b0971MTp4FK3ITh3Bk0c448","activityBlessBagPage");var i=cc.Class({extends:e("basePage"),statics:{prefabPath:"activityblessbagpage",pageType:1},properties:(a={p_labTime:cc.Label,p_btnHelp:cc.Button,p_arrNodeItem:[cc.Node],p_btnBuy:cc.Button,p_nodePrice:cc.Node,p_labLimit:cc.Label,p_arrRewardItem:[cc.Node]},a.p_labTime=cc.Label,a),onLoad:function(){i.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.schedule(this.refreshTime,1),eventMgr.on(eventStr.blessBagPage.PAGE_REFRESH,this.refreshUI,this)},handleUI:function(){var e=this;this.p_btnHelp.node.on("click",function(){app.playSound("click"),app.pages.windowspagetipshelp.showPage(1094)}),this.p_btnBuy.node.on("click",function(){app.playSound("click"),e.m_objData&&(e.m_objData.buynum<=0?app.showNotice("\u8d2d\u4e70\u6b21\u6570\u5df2\u8fbe\u5230\u4e0a\u9650"):app.player.sfBlessBagBuy(e.m_objData.pack.price,function(){var t=e.m_objData.pack.reward[e.m_objData.buyday];e.m_objData.buynum<=0&&(t=e.m_objData.pack.reward[e.m_objData.buyday-1]);var a,i={showtype:1,reward:t=t||e.m_objData.pack.reward[0]};app.pages.windowspagereward.showPage(i),e.m_objData.buynum-=1,e.m_objData.buyday+=1;for(var n=0;n<e.m_objData.box.length;++n)0==(a=e.m_objData.box[n]).status&&a.day<=e.m_objData.buyday&&(a.status=1);eventMgr.emit(eventStr.blessBagPage.PAGE_REFRESH),app.player.sfPlayerData(function(){cc.log("\u8d2d\u4e70\u6210\u529f")})},function(){cc.log("fail buy bless bag")}))})},setParam:function(){var e=this;app.player.sfBlessBagInfo(function(t,a){t?app.showNotice(t):(e.m_objData=a,cc.log(e.m_objData),e.refreshUI())})},refreshUI:function(){if(this.m_objData&&this.m_objData.pack){this.p_nodePrice.getComponent("price_num_item").init(this.m_objData.pack.price,1,2);var e=this.m_objData.pack.reward[this.m_objData.buyday];this.m_objData.buynum<=0&&(e=this.m_objData.pack.reward[this.m_objData.buyday-1]),e=e||this.m_objData.pack.reward[0];for(var t=0;t<this.p_arrNodeItem.length;++t)e[t]?(this.p_arrNodeItem[t].getComponent("propItem").initForBag(e[t]),this.p_arrNodeItem[t].getComponent("propItem").setClick(!0),this.p_arrNodeItem[t].active=!0):this.p_arrNodeItem[t].active=!1;this.p_labLimit.string="\u9650\u8d2d"+this.m_objData.buynum+"\u6b21",app.setSpriteState(this.p_btnBuy.node.getComponent(cc.Sprite),this.m_objData.buynum<=0),this.refreshReward()}},refreshReward:function(){for(var e=0;e<this.p_arrRewardItem.length;++e)this.p_arrRewardItem[e].getComponent("activityBlessBagItem").init(e,this.m_objData)},refreshTime:function(){var e,t=app.player.getServerTime();e=gUtils.getActivityArrTime("HDFD")[1],this.p_labTime.string=gUtils.getCountDownStr(e-t)},onDestroy:function(){eventMgr.off(eventStr.blessBagPage.PAGE_REFRESH,this.refreshUI,this),this._super()}});i.isOpen=function(){return!!app.db.checkFuncUnLock("ACTIVITY_HDFD")&&!!gUtils.activityIsOpen("HDFD")},i.refreshRed=function(e){return e&&(e.active=!1),!1},cc._RF.pop()},{basePage:void 0}],activityCbgPageBjsd:[function(e,t){"use strict";cc._RF.push(t,"711cekzG75ALYr/8PcFZ3hS","activityCbgPageBjsd");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activitycbgpagebjsd",pageParent:"activitycbgpage"},properties:{p_labTime:cc.Label,p_btnHelp:cc.Button,p_arrNodeItem:[cc.Node]},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(),this.p_btnHelp.node.on("click",function(){app.playSound("click")})},onEnable:function(){this._super(),eventMgr.on(eventStr.commonEvent.RefreshTime,this.refreshTime,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.commonEvent.RefreshTime,this.refreshTime,this)},refreshUI:function(){this.refreshTime();for(var e=0;e<this.p_arrNodeItem.length;e++){var t=this.m_data[e];t?this.p_arrNodeItem[e].getComponent("bjsdItem").refreshUI(t,this):this.p_arrNodeItem[e].active=!1}},refreshTime:function(){var e=app.player.getServerTime(),t=gUtils.getActivityArrTime("BJSR")[1]||0,a=t-e;(!t||a<0)&&(a=0),this.p_labTime.string=0!=a?gUtils.getCountDownStr(a):"00:00:00"},setParam:function(){this.setData()},setData:function(){var e=this,t=app.db.dbFreeGift.bjsr;app.player.sfGetBjsdList(function(a,i){if(!a){for(var n=0,r=0;r<i.length;r++){var o=i[r];o.index=r,r>0&&o.id==i[r-1].id?o.sprIndex=i[r-1].sprIndex:(o.sprIndex=n,n++)}for(var s=[],p=0;p<i.length;p++){var c=i[p];s.length&&s[s.length-1].id==c.id?s[s.length-1].buytime||(s[s.length-1]=c):s.push(c)}e.m_data=s,console.log(e.m_data);var h={buytime:1-app.player.getCount(t.MARK),items:t.ITEMS,limit:1,mark:t.MARK,sprIndex:0,refresh:1};s.unshift(h);for(var l=[],g=[],d=0;d<s.length;d++)s[d].buytime?l.push(s[d]):g.push(s[d]);e.m_data=l.concat(g),console.log(e.m_data),e.refreshUI()}})}});a.isOpen=function(){return!(!gUtils.activityIsOpen("BJSR")&&!gUtils.activityIsOpen("BJSR")||!app.db.checkFuncUnLock("ACTIVITY_ZHD"))},a.refreshRed=function(e){var t=!1,a=app.player.getCount(94841);return null!=a&&(t=a<1),e&&(e.active=t),t},cc._RF.pop()},{basePage:void 0}],activityCbgPageMjsl:[function(e,t){"use strict";cc._RF.push(t,"fe575L2nJpFLrgyDBDXxB07","activityCbgPageMjsl");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activitycbgpagemjsl",pageParent:"activitycbgpage"},properties:{p_btnHelp:cc.Button,p_nodeItemContent:cc.Node,p_nodeItem:cc.Node,p_labTime:cc.Label,p_arrNodeMenu:[cc.Node],p_arrNodeClicked:[cc.Node]},onLoad:function(){var e=this;a.instance=this,this.stopBgNodeEvent(),this.creatMask(),this.p_btnHelp.node.on("click",function(){app.playSound("click")}),this.p_arrNodeMenu.forEach(function(t,a){t.on("touchend",function(){app.playSound("click"),e.clickMenu(a)})})},onEnable:function(){this._super(),eventMgr.on(eventStr.commonEvent.RefreshTime,this.refreshTime,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.commonEvent.RefreshTime,this.refreshTime,this)},getData:function(){var e=this;app.player.sfGetDbrwList("mjsl",function(t,a){t||(e.m_data=a,e.refreshUI())})},refreshUI:function(){this.refreshRed();for(var e=this.m_data,t=0;t<e.length;t++){var a=e[t],i=this.p_nodeItemContent.children[t];i||((i=cc.instantiate(this.p_nodeItem)).parent=this.p_nodeItemContent),i.active=!0,i.getComponent("mjslItem").refreshUI(a,this)}this.refreshTime()},refreshTime:function(){var e=app.player.getServerTime(),t=gUtils.getActivityArrTime("MJSL")[1]||0,a=t-e;(!t||a<0)&&(a=0),this.p_labTime.string=0!=a?gUtils.getCountDownStr(a):"00:00:00"},refreshRed:function(){var e=this.p_arrNodeMenu[0].getChildByName("rednotice"),t=this.p_arrNodeMenu[1].getChildByName("rednotice");e.active=!1,t.active=!1;for(var a=0;a<this.m_data[0].length;a++)0==this.m_data[0][a].status&&(e.active=!0);for(var i=0;i<this.m_data[1].length;i++)0==this.m_data[1][i].status&&(t.active=!0)},setParam:function(){this.getData()}});a.isOpen=function(){return!(!gUtils.activityIsOpen("MJSL")&&!gUtils.activityIsOpen("MJSL")||!app.db.checkFuncUnLock("ACTIVITY_ZHD"))},a.refreshRed=function(e){var t=!1,a=app.getRedInfoByObj(["act","mjsl"],null);return null!=a&&(t=a>0),e&&(e.active=t),t},cc._RF.pop()},{basePage:void 0}],activityCbgPageZcjbLog:[function(e,t){"use strict";cc._RF.push(t,"f1906zUYblFa5cLILgxf48z","activityCbgPageZcjbLog");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=cc._decorator,o=r.ccclass,s=r.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_nodeTab=null,t.m_zcjbLogList=null,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},t.prototype.setParam=function(e){this.m_zcjbLogList=e.log,this.refreshTableV()},t.prototype.refreshTableV=function(){var e=this.m_zcjbLogList.length;this.p_nodeTab.getComponent("tableView").initTableView(e,{array:this.m_zcjbLogList,target:this})},t.prefabPath="activityCbgPageZcjbLog",t.pageType=1,n([s(cc.Node)],t.prototype,"p_nodeTab",void 0),a=n([o],t)}(e("basePage"));t.exports=p,cc._RF.pop()},{basePage:void 0}],activityCbgPageZcjb:[function(e,t){"use strict";cc._RF.push(t,"0ba96RnFbNMdbb/H4vCmnv5","activityCbgPageZcjb");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activitycbgpagezcjb",pageParent:"activitycbgpage"},properties:{p_btnHelp:cc.Button,p_btnResult:cc.Button,p_labTime:cc.Label,p_btnOne:cc.Button,p_labOne:cc.Label,p_labelMinOne:cc.Label,p_btnTen:cc.Button,p_labTen:cc.Label,p_labelMinTen:cc.Label,p_arrNodeCost:[cc.Node],p_labelTodayTimes:cc.Label,p_labResidueCount:cc.Label,p_barActivity:cc.ProgressBar,p_arrNodeBox:[cc.Node],p_nodePool:cc.Prefab,p_nodePoolParent:cc.Node,p_btnLog:cc.Button,p_spAnim:sp.Skeleton},onLoad:function(){var e=this;a.instance=this,this.stopBgNodeEvent(),this.creatMask(),this.p_btnHelp.node.on("click",function(){app.playSound("click"),app.pages.windowspagetipshelp.showPage("1107")}),this.p_btnOne.node.on("click",function(){app.playSound("click"),e.onClickZC(1)}),this.p_btnTen.node.on("click",function(){app.playSound("click"),e.onClickZC(10)}),this.p_btnLog.node.on("click",function(){app.playSound("click"),app.player.sfZcjbLog(function(e,t){e||app.pages.activityCbgPageZcjbLog.showPage({log:t})})}),this.myPool=new cc.NodePool("reward"),this.p_labOne.string=langMgr.getString("activityCbgPageZcjb",4),this.p_labTen.string=langMgr.getString("activityCbgPageZcjb",4)},setParam:function(){var e=this;app.player.sfZcjbInfo(function(t,a){t||(e.m_data=a,e.refreshUI())})},onEnable:function(){this._super(),eventMgr.on(eventStr.commonEvent.RefreshTime,this.refreshTime,this),this.p_spAnim.setAnimation(0,"changtai",!0)},onDisable:function(){this._super(),eventMgr.off(eventStr.commonEvent.RefreshTime,this.refreshTime,this)},refreshUI:function(){this.p_labelTodayTimes.string=gUtils.showCoinNum(this.m_data.daycoin),this.p_labResidueCount.string=langMgr.getString("activityCbgPageZcjb",0,this.m_data.remain),this.p_barActivity.progress=this.m_data.dayhit/this.m_data.box[1].num,this.refreshCost(),this.refreshBox()},refreshBox:function(){for(var e=this.m_data.box,t=0;t<e.length;t++){var a=this.p_arrNodeBox[t],i={target:this,status:e[t].status,reward:e[t].reward,circle:this.m_data.dayhit,num:e[t].num,index:t};a.getComponent("zcjbBoxItem").refreshUI(i)}},refreshReward:function(e){var t=this,a=0,i=Math.max(0,e.length-1);this.schedule(function(){var i=t.myPool.get();i||(i=cc.instantiate(t.p_nodePool)),i.parent=t.p_nodePoolParent,i.getComponent("zcjbRewardItem").refreshUI({target:t,data:e[a]}),a>=e.length-1&&(t.m_click=!1),a++},.1,i,0)},refreshCost:function(){for(var e=this.m_data.cost,t=0;t<this.p_arrNodeCost.length;t++){var a=this.p_arrNodeCost[t],i=a.getChildByName("str").getComponent(cc.Label),n=a.getChildByName("icon").getComponent(cc.Sprite),r=a.getChildByName("num").getComponent(cc.Label);if(0==t&&this.m_data.freeremain)i.string=langMgr.getString("activityCbgPageZcjb",1),n.node.active=!1,r.node.active=!1;else{i.string=langMgr.getString("activityCbgPageZcjb",2),n.node.active=!0,r.node.active=!0;var o=app.db.getPropsIconPath(e[t].item[0].GSID);app.loadTexture(o,n,this.prefabPath);var s=e[0].item[0].COUNT;t&&(s=e[0].item[0].COUNT*(10-this.m_data.freeremain)),r.string=s}}this.p_labelMinOne.string=e[0].get[0].COUNT,this.p_labelMinTen.string=e[1].get[0].COUNT},refreshTime:function(){var e=app.player.getServerTime(),t=gUtils.getActivityArrTime("ZCJB")[1]||0,a=t-e;(!t||a<0)&&(a=0),this.p_labTime.string=0!=a?gUtils.getCountDownStr(a):"00:00:00"},onClickZC:function(e){if(!this.m_click)if(this.m_data.remain<e)app.showNotice(langMgr.getString("activityCbgPageZcjb",3));else{var t=this.m_data.cost[0].item[0],a=t.COUNT;if((1!=e||1==e&&!this.m_data.freeremain)&&(10==e&&(a=t.COUNT*(10-this.m_data.freeremain)),app.player.getCount(t.GSID)<a)){var i=app.db.getPropsInfoByGsid(t.GSID);app.showNotice(langMgr.getString("playerData",0,i.NAME))}else{var n=this,r=function(){var i=1==e?"zcjb1":"zcjb10";app.playSound(i),n.m_click=!0,n.p_spAnim.setAnimation(0,e,!1),n.p_spAnim.setAnimation(1,"changtai",!0),app.player.sfZcjbRoll(e,function(i,r){i?n.m_click=!1:((1!=e||1==e&&!n.m_data.freeremain)&&app.player.reduceItem({GSID:t.GSID,COUNT:a}),1==e&&n.m_data.freeremain?app.redDataServer&&app.redDataServer.act&&app.redDataServer.act.zcjb&&app.redDataServer.act.zcjb--:n.m_data.freeremain&&app.redDataServer&&app.redDataServer.act&&app.redDataServer.act.zcjb&&(app.redDataServer.act.zcjb-=n.m_data.freeremain),eventMgr.emit(eventStr.commonEvent.RefershActivityZhdCoinUi),n.refreshReward(r.items),n.setParam())})};if(1==e&&this.m_data.freeremain)r();else{var o={content:langMgr.getString("activityCbgPageZcjb",5,[a,e]),confirmcb:function(){r()},target:this};app.pages.windowspagetipsmsg.showPage(o)}}}}});a.isOpen=function(){return!!gUtils.activityIsOpen("ZCJB")},a.refreshRed=function(e){var t=app.getRedInfoByObj(["act","zcjb"],0)>0;return e&&(e.active=t),t},cc._RF.pop()},{basePage:void 0}],activityCbgPage:[function(e,t){"use strict";cc._RF.push(t,"5a4efUqwfdNk6D26393UDLq","activityCbgPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activitycbgpage"},properties:{p_nodeBg:cc.Node,p_scrView:cc.ScrollView,p_nodeItem:cc.Node,p_labNoActivity:cc.Node,p_nodeTop:cc.Node,p_nodeMask:cc.Node},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(),this.fitTopMenu(),this.handleUI(),this.m_menu=this.node.getComponent("menu"),this.m_arrZhdData=gUtils.deepClone(app.db.dbMWelfare.cbg),this.m_menu.init(this)},onEnable:function(){this._super(),eventMgr.on(eventStr.redEvent.RefreshActivityRed,this.refreshRed,this),eventMgr.on(eventStr.commonEvent.RefershActivityZhdCoinUi,this.refreshCoinUI,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.redEvent.RefreshActivityRed,this.refreshRed,this),eventMgr.off(eventStr.commonEvent.RefershActivityZhdCoinUi,this.refreshCoinUI,this)},handleUI:function(){this._super()},menuHandler:function(e){if(this.m_index=e,this.m_arrShowPage[e]){var t=this.m_arrShowPage[e].SUOXIE;return!!gUtils.activityIsOpen(t,!0)&&(this.m_index=e,this.openShopPage(e),!0)}},setParam:function(e){this.m_arrShowPage=[];for(var t=0;t<this.m_arrZhdData.length;t++){var a=this.m_arrZhdData[t],i=!0,n=!1;a.FUNCTION_ID&&(i=app.db.checkFuncUnLock(a.FUNCTION_ID));var r=gUtils.getActivityArrTime(a.SUOXIE),o=app.player.getServerTime();r[0]<=o&&o<=r[1]&&(n=!0),n&&i&&this.m_arrShowPage.push(a)}this.m_arrShowPage.length<=0&&(this.p_labNoActivity.active=!0,app.mainScene&&app.mainScene.refreshLeftButton()),this.setMenuIndex(e)},setMenuIndex:function(e){var t=this,a=0;if(e)for(var i=0;i<this.m_arrShowPage.length;i++)if(e==this.m_arrShowPage[i].SUOXIE){a=i;break}this.m_arrShowPage[a]||(a=0),this.m_index!=a&&(this.m_index=a,app.player.sfPlayerByParam(["others"],function(){t.refreshSView(t.m_arrShowPage,t.m_index),t.m_menu.setMenuIndex(t.m_index)}))},openShopPage:function(e){var t=this,a=this.m_arrShowPage[e].PAGE,i=app.pages[a],n=function(){i.showPage({SUOXIE:t.m_arrShowPage[e].SUOXIE},t.p_nodeBg,function(){t.m_showPage=i.instance,t.m_showPage.node.opacity=0,t.m_showPage.node.runAction(cc.fadeIn(.1)),t.refreshCoinUI(t.m_arrShowPage[e].SUOXIE)})};this.m_showPage?(this.m_showPage.node.active=!0,this.m_showPage.node.runAction(cc.sequence(cc.fadeOut(.1),cc.callFunc(function(){t.m_showPage.onClose(),t.m_showPage=null,n()})))):n(),this.refreshRed()},refreshSView:function(e,t){var a=this;if(e){this.m_arrItems||(this.m_arrItems=[],this.m_arrItems.push(this.p_nodeItem));for(var i=function(e){var t=a.m_arrItems[e];t||((t=cc.instantiate(a.p_nodeItem)).parent=a.p_scrView.content,a.m_menu.p_arrBtnMenu.push(t),t.on("click",function(){app.playSound("click"),a.m_menu._onClickMenu(e)}),a.m_arrItems.push(t)),t.active=!0},n=0;n<e.length;++n)i(n);for(var r=0;r<e.length;++r)this.m_arrItems[r].getComponent("activityZhdGameItem").refreshUI(e[r],r,this);for(var o=e.length;o<this.m_arrItems.length;++o)this.m_arrItems[o].active=!1;this.scheduleOnce(function(){if(e.length<=4)a.p_scrView.content.x=(4-e.length)*a.p_nodeItem.width-320;else{t=Math.max(t-1,0);var i=a.p_nodeItem.width*t;a.p_scrView.scrollToOffset(cc.Vec2(i,0))}},.1)}},refreshCoinUI:function(e){if(this.m_arrShowPage&&this.m_arrShowPage[this.m_index]){var t=[{type:"gold",gsid:38006},{type:"",gsid:38005}];switch(e||this.m_arrShowPage[this.m_index].SUOXIE){case"XSDH":t.push({type:"qxt",gsid:30014});break;case"GJDL":t.push({type:"shzl",gsid:30060});break;case"BJSR":t.push({type:"bjsd",gsid:30064});break;case"MJSL":t.push({type:"mjsl",gsid:30064})}this.p_nodeTop&&this.p_nodeTop.getComponent("currency").refreshCoin(t)}},refreshMenuRed:function(e){var t=this.m_arrShowPage[e].PAGE;return app.pages[t].refreshRed(null,this.m_arrShowPage[e].SUOXIE)},refreshRed:function(){this.m_menu.refreshRed()},onClose:function(){this.m_showPage&&cc.isValid(this.m_showPage.node)&&this.m_showPage.onClose(),this._super()}});a.refreshRed=function(e){for(var t=!1,a=0;a<app.db.dbMWelfare.cbg.length;a++){var i=app.db.dbMWelfare.cbg[a],n=!0;i.FUNCTION_ID&&(n=app.db.checkFuncUnLock(i.FUNCTION_ID));var r=gUtils.activityIsOpen(i.SUOXIE),o=i.PAGE,s=app.pages[o]&&app.pages[o].refreshRed(null,i.SUOXIE);if(t=n&&r&&s)break}return e&&(e.active=t),t},a.isOpen=function(){for(var e=!1,t=0;t<app.db.dbMWelfare.cbg.length;t++){var a=app.db.dbMWelfare.cbg[t],i=!0;a.FUNCTION_ID&&(i=app.db.checkFuncUnLock(a.FUNCTION_ID));var n=!1,r=gUtils.getActivityArrTime(a.SUOXIE),o=app.player.getServerTime();if(r[0]<=o&&o<=r[1]&&(n=!0),e=n&&i)break}return e},cc._RF.pop()},{basePage:void 0}],activityCfhdPage:[function(e,t){"use strict";cc._RF.push(t,"2659ck36dVLaJXN3T5+7i5z","activityCfhdPage");var a=[{FUNCTION_ID:"",SUOXIE:"",ARRCOIN:[{type:"yb",gsid:38005},{type:"gold",gsid:38006}]}],i=cc.Class({extends:e("basePage"),statics:{prefabPath:"activitycfhdpage"},properties:{p_nodeBg:cc.Node,p_nodeTop:cc.Node,p_nodeMain:cc.Node,p_prefabWwzdz:cc.Prefab,p_prefabJttz:cc.Prefab,p_prefabWzcg:cc.Prefab},onLoad:function(){i.instance=this,this.stopBgNodeEvent(),this.creatMask(),this.fitTopMenu(),this.handleUI(),this.m_menu=this.node.getComponent("menu"),this.m_menu.init(this)},onEnable:function(){this._super()},onDisable:function(){this._super()},handleUI:function(){this._super()},setParam:function(e){this.m_numShowIndex=e||0,this.setMenuIndex(),this.refreshCoinUI()},refreshUI:function(){},setMenuIndex:function(){this.m_menu.setMenuIndex(this.m_numShowIndex)},refreshCoinUI:function(){this.p_nodeTop&&this.p_nodeTop.getComponent("currency").refreshCoin(a[this.m_numShowIndex].ARRCOIN)},menuHandler:function(e){return this.m_numShowIndex=e||0,cc.log("\u663e\u793a\u754c\u9762index",this.m_numShowIndex),this.showWwzdzItem(),this.showJttzItem(),this.showWzcgItem(),!0},refreshMenuRed:function(){},showWzcgItem:function(){0!=this.m_numShowIndex&&this.m_itemWzcg?this.m_itemWzcg.active=!1:(this.m_itemWzcg||(this.m_itemWzcg=cc.instantiate(this.p_prefabWzcg),this.m_itemWzcg.parent=this.p_nodeMain,this.m_itemWzcg.x=this.m_itemWzcg.y=0),this.m_itemWzcg.active=!0,this.m_itemWzcg.getComponent("activityCfhdWzcgItem").initSelf())},showJttzItem:function(){1!=this.m_numShowIndex&&this.m_itemJttz?this.m_itemJttz.active=!1:(this.m_itemJttz||(this.m_itemJttz=cc.instantiate(this.p_prefabJttz),this.m_itemJttz.parent=this.p_nodeMain,this.m_itemJttz.x=this.m_itemJttz.y=0),this.m_itemJttz.active=!0,this.m_itemJttz.getComponent("activityCfhdJttzItem").initSelf())},showWwzdzItem:function(){2!=this.m_numShowIndex&&this.m_itemWwzdz?this.m_itemWwzdz.active=!1:(this.m_itemWwzdz||(this.m_itemWwzdz=cc.instantiate(this.p_prefabWwzdz),this.m_itemWwzdz.parent=this.p_nodeMain,this.m_itemWwzdz.x=this.m_itemWwzdz.y=0),this.m_itemWwzdz.active=!0,this.m_itemWwzdz.getComponent("activityCfhdWwzdzItem").initSelf())}});i.refreshRed=function(){return!1},i.isOpen=function(){return!1},cc._RF.pop()},{basePage:void 0}],activityCjhdPageXCRW:[function(e,t){"use strict";cc._RF.push(t,"1ed2dz3o75JWaYl+6qBqs9G","activityCjhdPageXCRW");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=e("basePage"),o=cc._decorator,s=o.ccclass,p=o.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_btnHelp=null,t.p_nodeItemContent=null,t.p_nodeItem=null,t.p_labTime=null,t.p_arrNodeMenu=[],t.p_arrNodeClicked=[],t.m_data=[],t.m_index=0,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){var e=this;a.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.p_btnHelp.node.on("click",function(){app.playSound("click"),app.pages.windowspagetipshelp.showPage("1015")}),this.p_arrNodeMenu.forEach(function(t,a){t.on("touchend",function(){app.playSound("click"),e.clickMenu(a)})}),this.schedule(this.refreshTime,1)},t.prototype.setParam=function(e){this.m_index=e.param||0,this.setData(),this.clickMenu(this.m_index)},t.prototype.refreshUI=function(){this.refreshRed();for(var e=this.m_data[this.m_index],t=0;t<e.length;t++){var a=e[t],i=this.p_nodeItemContent.children[t];i||((i=cc.instantiate(this.p_nodeItem)).parent=this.p_nodeItemContent),i.active=!0,i.getComponent("xcrwItem").refreshUI(a,this)}for(t=e.length;t<this.p_nodeItemContent.children.length;t++)this.p_nodeItemContent.children[t].active=!1;this.refreshTime()},t.prototype.refreshTime=function(){var e=app.player.getServerTime(),t=gUtils.getActivityArrTime("XCRW")[1]||0,a=t-e;(!t||a<0)&&(a=0),this.p_labTime.string=0!=a?gUtils.getCountDownStr(a):"00:00:00"},t.prototype.refreshRed=function(){var e=this.p_arrNodeMenu[0].getChildByName("rednotice"),t=this.p_arrNodeMenu[1].getChildByName("rednotice");e.active=!1,t.active=!1;for(var a=0;a<this.m_data[0].length;a++)0==this.m_data[0][a].STATUS&&(e.active=!0);for(a=0;a<this.m_data[1].length;a++)0==this.m_data[1][a].STATUS&&(t.active=!0)},t.prototype.setData=function(){for(var e=app.db.dbXCRW,t=0;t<e.length;t++){var a=e[t];app.player.getCount(a.RMARK)>0?a.STATUS=2:app.player.getCount(a.MARK)>=a.NUM?a.STATUS=0:a.STATUS=1}var i=[],n=[];for(t=0;t<e.length;t++)"day"==e[t].TYPE?i.push(e[t]):n.push(e[t]);i.sort(function(e,t){if(e.STATUS<t.STATUS)return-1}),n.sort(function(e,t){if(e.STATUS<t.STATUS)return-1}),this.m_data=[i,n]},t.prototype.clickMenu=function(e){this.m_index=e,this.p_arrNodeClicked.forEach(function(t,a){t.active=e==a}),this.refreshUI()},t.prefabPath="activityCjhdPageXCRW",t.pageParent="activitycfhdpage",n([p(cc.Button)],t.prototype,"p_btnHelp",void 0),n([p(cc.Node)],t.prototype,"p_nodeItemContent",void 0),n([p(cc.Node)],t.prototype,"p_nodeItem",void 0),n([p(cc.Label)],t.prototype,"p_labTime",void 0),n([p(cc.Node)],t.prototype,"p_arrNodeMenu",void 0),n([p(cc.Node)],t.prototype,"p_arrNodeClicked",void 0),a=n([s],t)}(r);c.refreshRed=function(e){var t=!1,a=app.getRedInfoByObj(["act","xcrw"],null);return null!=a&&(t=a>0),e&&(e.active=t),t},t.exports=c,cc._RF.pop()},{basePage:void 0}],activityDbqbPageDbrw:[function(e,t){"use strict";cc._RF.push(t,"14fe69T95NHwIZYIpcUtyWp","activityDbqbPageDbrw");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=e("../lang/langMgr"),o=cc._decorator,s=o.ccclass,p=o.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_btnHelp=null,t.p_btnTotalMap=null,t.p_nodeItemContent=null,t.p_nodeItem=null,t.p_labTime=null,t.p_arrNodeMenu=[],t.p_arrNodeClicked=[],t.p_arrNodeShadow=[],t.p_labMapCount=null,t.p_numMapCount=null,t.p_SkeletonMap=null,t.p_SkeletonMapChip=[],t.m_data=[],t.m_mapChipCount=0,t.m_index=0,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){var e=this;a.instance=this,this.stopBgNodeEvent(),this.creatMask(),this.fitTopMenu(),this.p_btnHelp.node.on("click",function(){app.playSound("click")}),this.m_mapChipCount=app.player.getCount(30096),this.p_arrNodeMenu.forEach(function(t,a){t.on("touchend",function(){app.playSound("click"),e.clickMenu(a)})}),this.p_btnTotalMap.node.on("click",function(){app.player.getCount(30096)>8?(app.playSound("click"),app.player.sfExchange("pchip_30095",1,0,function(t){app.player.sfPlayerByParam(["others","vip","hide","props"],function(){var a={showtype:1,reward:t};e.refreshUI(e.m_index),eventMgr.emit(eventStr.commonEvent.RefershActivityZhdCoinUi,"DBRW"),app.pages.windowspagereward.showPage(a)})})):app.showNotice(r.getString("activityDbqbPageDbrw",1))}),this.schedule(this.refreshTime,1)},t.prototype.onEnable=function(){this.setParam()},t.prototype.setParam=function(){var e=this;app.player.sfGetDbrwList("dbrw",function(t,a){t||(e.setData(a),e.clickMenu(e.m_index))})},t.prototype.refreshUI=function(e){this.refreshRed();for(var t=this.m_data[e],a=0;a<t.length;a++){var i=t[a],n=this.p_nodeItemContent.children[a];n||((n=cc.instantiate(this.p_nodeItem)).parent=this.p_nodeItemContent),n.active=!0,n.getComponent("dbrwItem").refreshUI(i,this)}this.refreshMap(),this.refreshTime()},t.prototype.refreshMap=function(){for(var e=0;e<this.p_arrNodeShadow.length;e++)this.p_arrNodeShadow[e].active=!(e+1<=app.player.getCount(30096));if(app.player.getCount(30096)>this.m_mapChipCount){for(e=this.m_mapChipCount;e<app.player.getCount(30096);e++)this.p_SkeletonMapChip[e]&&this.p_SkeletonMapChip[e].setAnimation(0,"3",!1);this.m_mapChipCount=app.player.getCount(30096)}null==app.player.getCount(30096)?this.p_numMapCount.string="0":app.player.getCount(30096)<9?(this.p_labMapCount.string=r.getString("activityDbqbPageDbrw",0,"  "),this.p_numMapCount.node.active=!0,this.p_numMapCount.string=app.player.getCount(30096).toString()):(this.p_labMapCount.string=r.getString("activityDbqbPageDbrw",0,app.player.getCount(30096)),this.p_numMapCount.node.active=!1),app.player.getCount(30096)>8?(this.p_SkeletonMap.node.active=!0,this.p_SkeletonMap.setAnimation(0,"2",!0)):this.p_SkeletonMap.node.active=!1},t.prototype.refreshTime=function(){var e=app.player.getServerTime(),t=gUtils.getActivityArrTime("DBRW")[1]||0,a=t-e;(!t||a<0)&&(a=0),this.p_labTime.string=0!=a?gUtils.getCountDownStr(a):"00:00:00"},t.prototype.refreshRed=function(){var e=this.p_arrNodeMenu[0].getChildByName("rednotice"),t=this.p_arrNodeMenu[1].getChildByName("rednotice");e.active=!1,t.active=!1;for(var a=0;a<this.m_data[0].length;a++)0==this.m_data[0][a].status&&(e.active=!0);for(a=0;a<this.m_data[1].length;a++)0==this.m_data[1][a].status&&(t.active=!0)},t.prototype.setData=function(e){if(gUtils.activityIsOpen("DBRW",!0)){for(var t=[],a=[],i=0;i<e.length;i++)"day"==e[i].type?t.push(e[i]):a.push(e[i]);t.sort(function(e,t){if(e.status<t.status)return-1}),a.sort(function(e,t){if(e.status<t.status)return-1}),this.m_data=[t,a]}},t.prototype.clickMenu=function(e){this.m_index=e,this.p_arrNodeClicked.forEach(function(t,a){t.active=e==a}),this.refreshUI(e)},t.prefabPath="activitydbqbpagedbrw",t.pageParent="activitydbqbpage",n([p(cc.Button)],t.prototype,"p_btnHelp",void 0),n([p(cc.Button)],t.prototype,"p_btnTotalMap",void 0),n([p(cc.Node)],t.prototype,"p_nodeItemContent",void 0),n([p(cc.Node)],t.prototype,"p_nodeItem",void 0),n([p(cc.Label)],t.prototype,"p_labTime",void 0),n([p(cc.Node)],t.prototype,"p_arrNodeMenu",void 0),n([p(cc.Node)],t.prototype,"p_arrNodeClicked",void 0),n([p(cc.Node)],t.prototype,"p_arrNodeShadow",void 0),n([p(cc.Label)],t.prototype,"p_labMapCount",void 0),n([p(cc.Label)],t.prototype,"p_numMapCount",void 0),n([p(sp.Skeleton)],t.prototype,"p_SkeletonMap",void 0),n([p(sp.Skeleton)],t.prototype,"p_SkeletonMapChip",void 0),a=n([s],t)}(e("basePage"));c.refreshRed=function(e){var t=!1,a=app.getRedInfoByObj(["act","dbrw"],null);return null!=a&&(t=a>0),e&&(e.active=t),t},t.exports=c,cc._RF.pop()},{"../lang/langMgr":void 0,basePage:void 0}],activityDbqbPageDbsd:[function(e,t){"use strict";cc._RF.push(t,"4b317l10E9CnL7odfXdkmx2","activityDbqbPageDbsd");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=cc._decorator,o=r.ccclass,s=r.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_labTime=null,t.p_btnHelp=null,t.p_arrNodeItem=[],t.m_data=null,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(),this.fitTopMenu(),this.p_btnHelp.node.on("click",function(){app.playSound("click")}),this.schedule(this.refreshTime,1)},t.prototype.onEnable=function(){},t.prototype.setParam=function(){this.setData()},t.prototype.refreshUI=function(){this.refreshTime();for(var e=0;e<this.p_arrNodeItem.length;e++){var t=this.m_data[e];t?this.p_arrNodeItem[e].getComponent("dbsdItem").refreshUI(t,this):this.p_arrNodeItem[e].active=!1}},t.prototype.refreshTime=function(){var e=app.player.getServerTime(),t=gUtils.getActivityArrTime("DBSD")[1]||0,a=t-e;(!t||a<0)&&(a=0),this.p_labTime.string=0!=a?gUtils.getCountDownStr(a):"00:00:00"},t.prototype.setData=function(){var e=this,t=app.db.dbFreeGift.dbsd;app.player.sfGetDbsdList(function(a,i){if(!a){for(var n=0,r=0;r<i.length;r++)(s=i[r]).index=r,r>0&&s.id==i[r-1].id?s.sprIndex=i[r-1].sprIndex:(s.sprIndex=n,n++);var o=[];for(r=0;r<i.length;r++){var s=i[r];o.length&&o[o.length-1].id==s.id?o[o.length-1].buytime||(o[o.length-1]=s):o.push(s)}e.m_data=o;var p={buytime:1-app.player.getCount(t.MARK),items:t.ITEMS,limit:1,mark:t.MARK,sprIndex:0,refresh:1};o.unshift(p);var c=[],h=[];for(r=0;r<o.length;r++)o[r].buytime?c.push(o[r]):h.push(o[r]);e.m_data=c.concat(h),console.log(e.m_data),e.refreshUI()}})},t.prefabPath="activitydbqbpagedbsd",t.pageParent="activitydbqbpage",n([s(cc.Label)],t.prototype,"p_labTime",void 0),n([s(cc.Button)],t.prototype,"p_btnHelp",void 0),n([s(cc.Node)],t.prototype,"p_arrNodeItem",void 0),a=n([o],t)}(e("basePage"));p.refreshRed=function(e){var t=!1,a=app.getRedInfoByObj(["act","dbsd"],null);return null!=a&&(t=a>0),e&&(e.active=t),t},t.exports=p,cc._RF.pop()},{basePage:void 0}],activityDbqbPageJgkl:[function(e,t){"use strict";cc._RF.push(t,"743c0zen1xEArHeelnHvFoR","activityDbqbPageJgkl");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=cc._decorator,o=r.ccclass,s=r.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_btnHelp=null,t.p_nodeItemContent=null,t.p_nodeItem=null,t.p_labTime=null,t.p_nodeRareItem=null,t.p_nodeSelect=null,t.p_btnDrawOne=null,t.p_btnDrawMore=null,t.p_btnChanage=null,t.p_spMuNiu=null,t.p_nodeMask=null,t.m_item={},t.m_data=[],t.m_cost=[],t.m_selectIndex=-1,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){var e=this;a.instance=this,this.stopBgNodeEvent(),this.creatMask(),this.fitTopMenu(),this.p_btnHelp.node.on("click",function(){app.playSound("click"),app.pages.windowspagetipshelp.showPage("1104")}),this.p_btnDrawOne.node.on("click",function(){app.playSound("click"),e.onClickDraw(1,e.m_cost[0])}),this.p_btnDrawMore.node.on("click",function(){app.playSound("click"),e.onClickDraw(5,e.m_cost[1])}),this.p_btnChanage.node.on("click",function(){app.playSound("click"),app.pages.windowsPageJgklSelect.showPage({data:e.m_data[0],index:e.m_selectIndex,target:e})}),this.p_nodeSelect.on("touchend",function(){app.playSound("click"),app.pages.windowsPageJgklSelect.showPage({data:e.m_data[0],index:e.m_selectIndex,target:e})});var t=app.db.dbJGKL;this.m_data.push(t.TYPE1),this.m_data.push(t.TYPE0),this.m_cost=t.COST,this.schedule(this.refreshTime,1)},t.prototype.onEnable=function(){},t.prototype.setParam=function(){if(this.p_nodeMask.active=!1,app.player.jgkl)for(var e=0;e<this.m_data[0].length;e++)if(app.player.jgkl.gsid==this.m_data[0][e].GSID){this.m_selectIndex=e;break}this.refreshUI(),this.refreshRareReward(),this.p_spMuNiu.setAnimation(0,"Standby",!0)},t.prototype.refreshUI=function(){for(var e=this.m_data[1],t=0;t<e.length;t++){var a=this.p_nodeItemContent.children[t];a||((a=cc.instantiate(this.p_nodeItem)).parent=this.p_nodeItemContent),a.active=!0,a.getComponent("propItem").initForBag(e[t]),a.getComponent("propItem").setClick(!0)}for(t=e.length;t<this.p_nodeItemContent.children.length;t++)this.p_nodeItemContent.children[t].active=!1;this.refreshTime()},t.prototype.refreshTime=function(){var e=app.player.getServerTime(),t=gUtils.getActivityArrTime("JGKL")[1]||0,a=t-e;(!t||a<0)&&(a=0),this.p_labTime.string=0!=a?gUtils.getCountDownStr(a):"00:00:00"},t.prototype.refreshRareReward=function(){this.m_selectIndex<0?(this.p_nodeSelect.active=!0,this.p_nodeRareItem.active=!1):(this.p_nodeSelect.active=!1,this.p_nodeRareItem.active=!0,this.p_nodeRareItem.getComponent("propItem").initForBag(this.m_data[0][this.m_selectIndex]),this.p_nodeRareItem.getComponent("propItem").setClick(!0))},t.prototype.onClickDraw=function(e,t){var a=this;if(!app.player.jgkl&&this.m_selectIndex<0)app.showNotice(window.langMgr.getString("activityDbqbPageJgkl",0));else if(app.player.getCount(t.GSID)<t.COUNT){var i=app.db.getPropsName(t.GSID);app.showNotice(window.langMgr.getString("playerData",0,i))}else this.p_nodeMask.active=!0,app.playSound("jgkl"),this.p_spMuNiu.setAnimation(0,"open",!1),this.scheduleOnce(function(){app.player.sfJgklDraw(e,function(e,t){if(a.p_nodeMask.active=!1,e)a.p_spMuNiu.setAnimation(0,"Standby",!0);else{var i={showtype:1,reward:t,confirmcb:function(){a.p_spMuNiu.setAnimation(0,"Standby",!0),app.player.sfPlayerByParam(["others","hide","props"],function(){eventMgr.emit(eventStr.commonEvent.RefershActivityZhdCoinUi,"JGKL")})},target:a};app.pages.windowspagereward.showPage(i)}})},2)},t.prefabPath="activitydbqbpagejgkl",t.pageParent="activitydbqbpage",n([s(cc.Button)],t.prototype,"p_btnHelp",void 0),n([s(cc.Node)],t.prototype,"p_nodeItemContent",void 0),n([s(cc.Node)],t.prototype,"p_nodeItem",void 0),n([s(cc.Label)],t.prototype,"p_labTime",void 0),n([s(cc.Node)],t.prototype,"p_nodeRareItem",void 0),n([s(cc.Node)],t.prototype,"p_nodeSelect",void 0),n([s(cc.Button)],t.prototype,"p_btnDrawOne",void 0),n([s(cc.Button)],t.prototype,"p_btnDrawMore",void 0),n([s(cc.Button)],t.prototype,"p_btnChanage",void 0),n([s(sp.Skeleton)],t.prototype,"p_spMuNiu",void 0),n([s(cc.Node)],t.prototype,"p_nodeMask",void 0),a=n([o],t)}(e("basePage"));p.refreshRed=function(e){var t=!1,a=app.getRedInfoByObj(["act","jgkl"],null);return null!=a&&(t=a>0),e&&(e.active=t),t},t.exports=p,cc._RF.pop()},{basePage:void 0}],activityDbqbPage:[function(e,t){"use strict";cc._RF.push(t,"d51b3eE2FhOi5HFt9igGklP","activityDbqbPage");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=cc._decorator,o=r.ccclass,s=(r.property,e("activityPageModel")),p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,e.prototype.onLoad.call(this)},t.prototype.setParam=function(t){e.prototype.setParam.call(this,"dbqb",t)},t.prefabPath="activitydbqbpage",a=n([o],t)}(s);p.getEndTime=function(){return gUtils.getActivityArrTime("CJG1")[1]||0},p.refreshRed=function(e){return s.refreshRed(e,"dbqb")},p.isOpen=function(){return s.isOpen("dbqb")},t.exports=p,cc._RF.pop()},{activityPageModel:"activityPageModel"}],activityDlhlPage:[function(e,t){"use strict";cc._RF.push(t,"13c47N0VJ1He4yhP1ms36Tn","activityDlhlPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activitydlhlpage",pageType:1},properties:{p_arrItem:[cc.Node],p_labTime:cc.Label,p_btnLingqu:cc.Button,p_nodeRed:cc.Node,p_sprGeneral:cc.Sprite,p_spGeneral:sp.Skeleton,p_animGeneral:cc.Animation,p_nodeGeneral:cc.Node,p_nodeGInfo:cc.Node,p_nodePInfo:cc.Node,p_sprCamp:cc.Sprite,p_sprOCCU:cc.Sprite,p_sprOccu2:cc.Sprite,p_sprName:cc.Sprite,p_nodeStar:cc.Node,p_sprStar:[cc.Sprite],p_generalQuality:cc.Node,p_pfbQualityItem:cc.Prefab,p_btnReview:cc.Button,p_btnGoto:cc.Button},onLoad:function(){var e=this;a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.p_btnLingqu.node.on("click",function(){if(e.m_arrData){if(e.m_numDay>=6&&app.player.gnum+1>app.player.bagspace){var t={content:langMgr.getString("activityQiriPage",8),confirmcb:function(){app.goToPage(1018)},target:e};return void app.pages.windowspagetipsmsg.showPage(t)}var i=e.m_arrData.rewards[e.m_numDay];!i||i&&1!=i.status||app.player.sfLjdlReward(e.m_numDay+1,a.SUOXIE.toLowerCase(),function(t){if(t)app.showNotice(t);else{var n={showtype:1,reward:i.items};app.pages.windowspagereward.showPage(n),app.player.sfPlayerByParam(["others","vip","hide","props"],function(){i.status=2,e.refreshUI(),app.getRedInfoByObj(["act",a.SUOXIE.toLowerCase()],0)>=1&&(app.redDataServer.act[a.SUOXIE.toLowerCase()]-=1),app.mainScene&&app.mainScene.refreshTopUI()})}})}}),this.p_btnReview.node.on("click",function(){if(app.playSound("click"),e.m_arrData){var t={GSID:e.m_arrData.general_gsid,COUNT:1};app.showPropTips(t)}}),this.p_btnGoto.node.on("click",function(){app.playSound("click"),app.goToPage(1072)}),this.p_arrItem.forEach(function(t,a){t.on("touchend",function(){e.m_arrData&&app.showPropTips({GSID:e.m_arrData.rewards[a].items[0].gsid,COUNT:e.m_arrData.rewards[a].items[0].count})})})},onEnable:function(){this._super(),eventMgr.on(eventStr.commonEvent.RefreshTime,this.refreshTime,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.commonEvent.RefreshTime,this.refreshTime,this)},setParam:function(e){var t=this;if(a.SUOXIE=null!=e?e.type:"DLHL",!gUtils.activityIsOpen(a.SUOXIE,!0))return app.mainScene&&app.mainScene.refreshLeftButton(),void this.onClose();app.player.sfLjdlInfo(a.SUOXIE.toLowerCase(),function(e,a){e?t.onClose():(t.m_arrData=a,t.refreshUI())})},refreshUI:function(){this.m_arrData&&(this.refreshGeneral(this.m_arrData.general_gsid),this.refreshTime(),this.refreshArrItem(),eventMgr.emit(eventStr.redEvent.RefreshActivityRed))},refreshArrItem:function(){var e=this;this.m_numDay=-1;var t=this.m_arrData.rewards;this.p_arrItem.forEach(function(a,i){var n=t[i].items[0],r=a.getChildByName("ylq"),o=a.getChildByName("icon").getComponent(cc.Sprite),s=a.getChildByName("num").getComponent(cc.Label),p=a.getChildByName("light"),c=t[i].status;if(r.active=2==c,1==c&&-1==e.m_numDay&&(e.m_numDay=i),p.active=1==c,a.active=!!n,a.active){var h=app.db.getPropsIconPath(n.gsid);app.loadTexture(h,o,e.prefabPath),s.string="x"+n.count}}),this.p_btnLingqu.node.active=-1!=this.m_numDay,this.p_btnGoto.node.active=!this.p_btnLingqu.node.active,this.p_nodeRed.active=-1!=this.m_numDay},refreshGeneral:function(e){var t=this,a=app.db.getPropsInfoByGsid(e);console.log(a),app.loadGeneral(e,this.p_sprGeneral,this.p_spGeneral,this.p_animGeneral,null,this.prefabPath);var i=app.db.getGNamePathVByGsid(e);app.loadTexture(i,this.p_sprName,this.prefabPath);var n=gConfig.getIconGCampPath(a.CAMP-1);app.loadTexture(n,this.p_sprCamp,this.prefabPath);var r=gConfig.getIconGOccuPath(a.OCCU-1);app.loadTexture(r,this.p_sprOCCU,this.prefabPath),a.OCCU2?(this.p_sprOccu2.node.active=!0,r=gConfig.getIconGOccuPath(a.OCCU2-1),app.loadTexture(r,this.p_sprOccu2,this.prefabPath)):this.p_sprOccu2.node.active=!1;var o=a.STAR;if(this.p_nodeStar.opacity=o<10?255:0,o<10){var s=(o-1)%5,p=gConfig.getIconGBigStarPath(a.STAR);this.p_sprStar.forEach(function(e,a){e.node.active=s>=a,app.loadTexture(p,e,t.prefabPath)})}this.p_generalQuality.opacity=Boolean(a.TGRADE)?255:0,a.TGRADE&&(cc.isValid(this._gQualityItem)||(this._gQualityItem=cc.instantiate(this.p_pfbQualityItem),this.p_generalQuality.addChild(this._gQualityItem),this._gQualityItem.setPosition(cc.Vec2.ZERO)),this._gQualityItem.getComponent("GeneralQualityItem").init(a.TGRADE))},refreshTime:function(){var e=app.player.getServerTime(),t=gUtils.getActivityArrTime(a.SUOXIE)[1]||0,i=t-e;(!t||i<0)&&(i=0),this.p_labTime.string=0!=i?gUtils.getCountDownStr(i):"00:00:00"}});a.SUOXIE="DLHL",a.refreshRed=function(e,t){var a=!1;t=t||"DLHL";var i=app.getRedInfoByObj(["act",t.toLowerCase()],null);return null!=i&&(a=i>0),e&&(e.active=a),a},a.isOpen=function(e){return e=e||"DLHL",gUtils.activityIsOpen(e)},cc._RF.pop()},{basePage:void 0}],activityDwhdPageMjbgAccess:[function(e,t){"use strict";cc._RF.push(t,"98ce6OWVl5PBbRdeQZMNo8F","activityDwhdPageMjbgAccess");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activitydwhdpagemjbgaccess",pageType:1},properties:{p_scrView:cc.ScrollView,p_nodeItem:cc.Node},onLoad:function(){this.handleUI(),a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0)},setParam:function(e){this.m_data=e,this.refreshUI()},refreshUI:function(){this.refreshTView(this.m_data)},refreshTView:function(e){this.m_arrItems||(this.m_arrItems=[],this.m_arrItems.push(this.p_nodeItem));for(var t=0;t<e.length;++t){var a=this.m_arrItems[t];a||((a=cc.instantiate(this.p_nodeItem)).parent=this.p_scrView.content,this.m_arrItems.push(a)),a.active=!0,a.getComponent("mjbgItem").refreshUI(e[t],t)}for(var i=e.length;i<this.m_arrItems.length;++i)this.m_arrItems[i].active=!1}});cc._RF.pop()},{basePage:void 0}],activityDwhdPageMjbgChosemb:[function(e,t){"use strict";cc._RF.push(t,"b5ad70xAq9NaqTarr0dkYo/","activityDwhdPageMjbgChosemb");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activitydwhdpagemjbgchosemb",pageType:1},properties:{p_tabvView:cc.Node,p_btnPrice:cc.Button,p_nodeReward:cc.Node},onLoad:function(){var e=this;this._super(),a.instance=this,this.stopBgNodeEvent(),this.creatMask(),this.p_btnPrice.node.on("click",function(){gUtils.activityIsOpen("MJBG",!0)&&(null!=e.m_idx&&null!=e.m_itemIndex?app.player.sfMjbgChange(e.m_idx,e.m_itemIndex,function(t,a){t?app.showNotice(langMgr.getString("activityDwhdPageMjbgChosemb",1)):(e.onClose(),e.m_confunc&&e.m_confunc.call(e.m_target,a))}):app.showNotice(langMgr.getString("activityDwhdPageMjbgChosemb",0)))}),this.m_menu=this.node.getComponent("menu"),this.m_menu.init(this),this.p_tabvView.on("scroll-ended",function(){cc.log("content pos",e.p_tabvView.getComponent("tableView").content.y)})},setParam:function(e){e||this.onClose(),cc.log(e),this.m_data=e.array,this.m_arrFinalIndex=e.finalindex,this.m_showPutData=[],this.m_showFinalData=[];for(var t=0;t<this.m_data.length;t++){var a={};a.level=t,a.items=this.m_data[t],-1!=this.m_arrFinalIndex.indexOf(t)?this.m_showFinalData.push(a):this.m_showPutData.push(a)}this.m_index=e.index,this.m_confunc=e.confunc,this.m_target=e.target,this.m_arrChooseIndex=[],this.m_idx=null,this.m_itemIndex=null,this.p_nodeReward.active=!1;var i=-1!=this.m_arrFinalIndex.indexOf(this.m_index)?1:0;this.m_menu.setMenuIndex(i)},menuHandler:function(e){return this.m_menuIndex!=e&&(this.m_menuIndex=e,this.m_showData=0==this.m_menuIndex?this.m_showPutData:this.m_showFinalData,this.refreshUI(),!0)},refreshUI:function(){this.refreshRewardView(this.m_index,this.m_menuIndex)},refreshRewardView:function(e,t){var a=this,i=this.m_showData.length;this.p_tabvView.getComponent("tableView").initTableView(i,{array:this.m_showData,target:this});for(var n=0,r=0,o=0;o<this.m_arrFinalIndex.length;++o){var s=this.m_arrFinalIndex[o];if(e<s){r=o,n=e-o;break}if(e==s){r=o,n=e-o;break}e>this.m_arrFinalIndex[this.m_arrFinalIndex.length-1]&&(r=o,n=e-o-1)}var p=1==t?r:n;cc.log(e,p,this.m_arrFinalIndex),this.scheduleOnce(function(){p=Math.max(p,0);var e=a.p_tabvView.getComponent("tableView"),t=e.cell.data.height;cc.log(e,t,p);var i=t*p;e.scrollToOffset(cc.Vec2(0,i))},.1)},itemPorpClick:function(e,t,a,i){return a==this.m_strNowPickGsid?(this.m_chooseItem=i,!0):(this.m_idx=e,this.m_itemIndex=t,this.m_chooseItem&&(cc.log("handle choose item"),this.m_chooseItem.selected(!1,this.m_strNowPickGsid)),this.m_chooseItem=i,this.m_strNowPickGsid=a,this.p_nodeReward.active||(this.p_nodeReward.active=!0),this.p_nodeReward.getComponent("propItem").initForGsid(this.m_strNowPickGsid),this.p_nodeReward.getComponent("propItem").setClick(!0),!0)}});cc._RF.pop()},{basePage:void 0}],activityDwhdPageMjbgPreview:[function(e,t){"use strict";cc._RF.push(t,"9ef25B3KcFPho0PG+FbNZI/","activityDwhdPageMjbgPreview");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activitydwhdpagemjbgpreview",pageType:1},properties:{p_scrView:cc.ScrollView,p_nodeItem:cc.Node},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0)},setParam:function(e){cc.log("preview dwhd data is",e),e||this.onClose();var t,a=e.items;this.m_data=[];for(var i=0;i<a.length;i++){var n=a[i];if(n){for(var r=!1,o=0;o<this.m_data.length;o++)if(this.m_data[o]&&n&&this.m_data[o].gsid==n.gsid&&this.m_data[o].count==n.count){var s=this.m_data[o];s.num+=n.num,s.maxNum++,r=!0}if(!r){var p={};p.gsid=n.gsid,p.count=n.count,p.num=0,p.num+=n.num||0,p.maxNum=1,e.final&&n.gsid==e.final.gsid&&n.count==e.final.count?t=p:this.m_data.push(p)}}}t&&this.m_data.unshift(t),this.refreshUI()},refreshUI:function(){cc.log(this.m_data),this.refreshTView(this.m_data)},refreshTView:function(e){this.m_arrItems||(this.m_arrItems=[],this.m_arrItems.push(this.p_nodeItem));for(var t=0;t<e.length;t++){var a=this.m_arrItems[t];a||((a=cc.instantiate(this.p_nodeItem)).parent=this.p_scrView.content,this.m_arrItems.push(a)),a.active=!0;var i=a.getChildByName("porp_item").getComponent("propItem");a.getChildByName("lab_rand").getComponent(cc.Label).string=e[t].maxNum-e[t].num+"/"+e[t].maxNum,i.initForBag(e[t]),i.setClick(!0)}for(var n=e.length;n<this.m_arrItems.length;++n)this.m_arrItems[n].active=!1}});cc._RF.pop()},{basePage:void 0}],activityDwhdPageMjbg:[function(e,t){"use strict";cc._RF.push(t,"80f8dIe9utE4IV5qJceMc4h","activityDwhdPageMjbg");var a=cc.Class({extends:e("basePage"),properties:{p_labTime:cc.Label,p_btnHelp:cc.Button,p_boxParentNode:cc.Node,p_boxNode:cc.Node,p_btnPrevie:cc.Button,p_btnReplace:cc.Button,p_nodeAdd:cc.Node,p_btnAdd:cc.Button,p_labNum:cc.Label,p_sprIcon:cc.Sprite,p_nodeReward:cc.Node,p_sprLayer:cc.Node,p_sprWabao:sp.Skeleton,p_btnNext:cc.Button,p_btnAuto:cc.Button},onLoad:function(){a.instance=this,this.schedule(this.refreshTime,1),this.stopBgNodeEvent(),this.creatMask(),this.addBoxList(),this.p_sprWabao.node.zIndex=1e3,this.handleUI()},statics:{prefabPath:"activitydwhdpagemjbg",pageParent:"activitydwhdpage"},handleUI:function(){var e=this;this._super(),this.p_btnHelp.node.on("click",function(){app.pages.windowspagetipshelp.showPage(1045)}),this.m_boxNodeList.forEach(function(t,a){t.on("touchend",function(){gUtils.activityIsOpen("MJBG",!0)&&e.onClickBox(a)})}),this.p_btnAdd.node.on("click",function(){e.m_data&&app.pages.windowspagesource.showPage(e.m_data.djgsid)}),this.p_btnPrevie.node.on("click",function(){e.m_data&&app.pages.activitydwhdpagemjbgpreview.showPage(e.m_data)}),this.p_nodeAdd.on("touchend",function(){gUtils.activityIsOpen("MJBG",!0)&&e.onClcikZjReward()}),this.p_btnReplace.node.on("click",function(){gUtils.activityIsOpen("MJBG",!0)&&e.onClcikZjReward()}),this.p_btnNext.node.on("click",function(){gUtils.activityIsOpen("MJBG",!0)&&e.onClickNext()}),this.p_sprWabao.setCompleteListener(function(){e.p_sprWabao.node.active=!1,e.onSpaneEnd()}),this.p_btnAuto.node.on("click",function(){app.playSound("click");var t=app.db.getPropsName(e.m_data.djgsid);if(app.player.getCount(e.m_data.djgsid)<=0)app.showNotice(langMgr.getString("activityDwhdPageMjbg",13,t));else if(e.m_data.final)if(-1!=e.m_data.strbox.indexOf("0")){var a={content:e.m_data.final.num>0?langMgr.getString("activityDwhdPageMjbg",16):langMgr.getString("activityDwhdPageMjbg",14),confirmcb:function(){app.player.sfMjbgAuto(function(t,a){t||(e.m_data.strbox=a.strbox,e.onClickBtnAuto(a))})},target:e};app.pages.windowspagetipsmsg.showPage(a)}else e.m_data.index+1>=e.m_data.finallist.length?app.showNotice(langMgr.getString("activityDwhdPageMjbg",5)):app.showNotice(langMgr.getString("activityDwhdPageMjbg",7));else app.showNotice(langMgr.getString("activityDwhdPageMjbg",15))})},onClickBtnAuto:function(e){var t=this;app.mainScene.p_nodeWait.show({isShow:!1});for(var a=0,i=function(i){var n=e.reward[i],r=n.INDEX||0,o=t.m_boxNodeList[r].getChildByName("porp_item"),s=t.m_boxNodeList[r].getChildByName("spr_bg"),p=cc.sequence(cc.delayTime(.1+.1*i),cc.callFunc(function(){var i=cc.instantiate(t.p_sprWabao.node);i.parent=o.parent,i.setPosition(cc.Vec2.ZERO),i.getComponent(sp.Skeleton).setCompleteListener(function(){if(i.active=!1,o.active=!0,s.active=!0,a++,i.destroy(),t.showBoxFinalEff(o,n),a>=e.reward.length){app.mainScene.p_nodeWait.hide();var r={};r.GSID=e.reward[e.reward.length-1].GSID,r.COUNT=e.reward[e.reward.length-1].COUNT,r.GSID==t.m_data.final.gsid&&r.COUNT==t.m_data.final.count&&(e.reward[e.reward.length-1].GSID=e.reward[0].GSID,e.reward[e.reward.length-1].COUNT=e.reward[0].COUNT,e.reward[0].GSID=r.GSID,e.reward[0].COUNT=r.COUNT);var p={showtype:1,reward:e.reward||[],confirmcb:function(){app.player.sfMjbgInfo(function(e,a){e||(t.m_data=a,t.m_data.final&&(t.m_data.items[34]=t.m_data.final),r.GSID!=t.m_data.final.gsid||r.COUNT!=t.m_data.final.count)||(t.m_index+1<=t.m_data.finallist.length-1?t.refreshRightReward(function(){app.player.sfMjbgNext(function(e){e||t.setParam()})},langMgr.getString("activityDwhdPageMjbg",12)):t.refreshRightReward(null,langMgr.getString("activityDwhdPageMjbg",11)))})},target:t};app.pages.windowspagereward.showPage(p)}}),i.active=!0,i.getComponent(sp.Skeleton).setAnimation(0,"1",!1)}));o.parent.runAction(p),o.getComponent("propItem").initForBag(n),o.getComponent("propItem").setClick(!0)},n=0;n<e.reward.length;n++)i(n);app.player.addItem(e.reward),app.player.reduceItem({gsid:this.m_data.djgsid,count:this.m_data.djcount*e.reward.length}),eventMgr.emit(eventStr.commonEvent.RefershActivityZhdCoinUi),this.refreshProp()},onClcikZjReward:function(){var e=this;if(this.m_data)if(this.getMaxLayer())app.showNotice(langMgr.getString("activityDwhdPageMjbg",5));else if(this.getIsHaveFinal())app.showNotice(langMgr.getString("activityDwhdPageMjbg",6));else{var t={array:this.m_data.finallist,finalindex:this.m_data.finalindex,index:this.m_data.index,target:this,confunc:function(t){e.m_data.final||e.playBeginAct(),e.m_data.final=t,e.m_data.items[34]=e.m_data.final,e.refreshReward()}};this.m_data&&app.pages.activitydwhdpagemjbgchosemb.showPage(t)}},onSpaneEnd:function(){var e=this;app.mainScene.p_nodeWait.hide();var t=this.m_boxNodeList[this.m_itemIndex].getChildByName("porp_item");this.m_boxNodeList[this.m_itemIndex].getChildByName("spr_bg").active=!0,t.active=!0,t.getComponent("propItem").initForBag(this.m_objReward),t.getComponent("propItem").setClick(!0),this.showBoxFinalEff(t,this.m_objReward);var a={showtype:1,reward:[this.m_objReward],confirmcb:function(){app.player.sfMjbgInfo(function(t,a){if(!t){if(e.m_data=a,e.m_data.final&&(e.m_data.items[34]=e.m_data.final),e.m_index+1<=e.m_data.finallist.length-1){if(e.m_index<e.m_data.index)return e.m_index=e.m_data.index,app.showNotice(langMgr.getString("activityDwhdPageMjbg",7)),void e.setParam();e.m_objReward.gsid==e.m_data.final.gsid&&e.m_objReward.count==e.m_data.final.count&&(e.m_isHaveFinal=!0,e.refreshRightReward(function(){app.player.sfMjbgNext(function(t){t||e.setParam()})},langMgr.getString("activityDwhdPageMjbg",12)))}else e.m_objReward.gsid==e.m_data.final.gsid&&e.m_objReward.count==e.m_data.final.count&&e.refreshRightReward(null,langMgr.getString("activityDwhdPageMjbg",11));e.m_index=e.m_data.index,e.getMaxLayer()&&e.refreshUI()}})},target:this};app.pages.windowspagereward.showPage(a)},refreshRightReward:function(e,t){this.refreshBtnNext(),this.refreshBtnAdd(),this.refreshReward();var a={type:"comfirm",content:t||langMgr.getString("activityDwhdPageMjbg",11),confirmcb:e,target:this};app.pages.windowspagetipsmsg.showPage(a)},getMaxLayer:function(){return!!this.m_data&&this.m_data.index+1>=this.m_data.finallist.length&&-1==this.m_data.strbox.indexOf("0")},isMaxLayer:function(){return!!this.m_data&&this.m_data.index+1>=this.m_data.finallist.length},onClickNext:function(){var e=this;gUtils.activityIsOpen("MJBG",!0)&&this.m_data&&this.m_data.final&&(this.m_data.final.num?this.isMaxLayer()?app.showNotice(langMgr.getString("activityDwhdPageMjbg",9)):app.player.sfMjbgNext(function(t){t||e.setParam()}):app.showNotice(langMgr.getString("activityDwhdPageMjbg",8)))},addBoxList:function(){this.m_boxNodeList=[this.p_boxNode];for(var e=0;e<5;e++)for(var t=0;t<7;t++)if(0!=e||0!=t){var a=cc.instantiate(this.p_boxNode);a.parent=this.p_boxParentNode,a.x=105.3*t-316,a.y=215+-106*e,this.m_boxNodeList.push(a)}},showBoxFinalEff:function(e,t){var a=t.GSID||t.gsid,i=t.COUNT||t.count;a==this.m_data.final.gsid&&i==this.m_data.final.count?e.parent.getChildByName("FlashAnim").opacity=255:e.parent.getChildByName("FlashAnim").opacity=0},onClickBox:function(e){var t=this;gUtils.activityIsOpen("MJBG",!0)&&null!=e&&this.m_data.items[e]&&this.m_data.final&&app.player.checkCount(this.m_data.djgsid,this.m_data.djcount)&&(app.mainScene.p_nodeWait.show({isShow:!1}),app.player.sfMjbgReward(e,function(a,i){if(app.mainScene.p_nodeWait.show({isShow:!1}),a)return app.mainScene.p_nodeWait.hide(),void app.showNotice(a);t.p_sprWabao.node.active=!0,t.m_itemIndex=e,t.p_sprWabao.node.x=t.m_boxNodeList[e].x,t.p_sprWabao.node.y=t.m_boxNodeList[e].y,t.p_sprWabao.setAnimation(0,"1",!1),t.m_objReward=i,app.player.addItem(t.m_objReward),app.player.reduceItem({gsid:t.m_data.djgsid,count:t.m_data.djcount}),eventMgr.emit(eventStr.commonEvent.RefershActivityZhdCoinUi),t.refreshProp()}))},setParam:function(){var e=this;gUtils.activityIsOpen("MJBG",!0)&&app.player.sfMjbgInfo(function(t,a){t||(app.act_mjbgData=a,e.m_data=a,e.m_index=a.index,e.refreshUI())})},refreshUI:function(){this.refreshTime(),this.refreshBoxList(),this.refreshProp(),this.refreshReward(),this.refreshNumLayer(),this.refreshBtnNext(),this.refreshBtnAdd()},refreshBtnAdd:function(){if(this.m_data){var e=this.m_data.final&&this.m_data.final.num>0;this.p_btnReplace.node.active=!e}},getIsHaveFinal:function(){return!!this.m_data&&!!this.m_data.final&&!!this.m_data.final.num},refreshBtnNext:function(){gUtils.activityIsOpen("MJBG",!0)&&this.m_data&&(this.m_data.final?this.isMaxLayer()?this.p_btnNext.node.active=!1:this.p_btnNext.node.active=!!this.m_data.final.num:this.p_btnNext.node.active=!1)},refreshBoxList:function(){if(this.m_data)if(this.m_data.final){this.m_data.items[34]=this.m_data.final;for(var e=0;e<this.m_boxNodeList.length;e++){var t=this.m_boxNodeList[e].getChildByName("porp_item");this.m_boxNodeList[e].getChildByName("spr_bg").active=!!Number(this.m_data.strbox[e]),t.active=!1,this.m_boxNodeList[e].getChildByName("FlashAnim").opacity=0}}else{for(var a=0;a<this.m_boxNodeList.length;a++){var i=this.m_boxNodeList[a].getChildByName("porp_item"),n=this.m_data.items[a];this.m_boxNodeList[a].getChildByName("FlashAnim").opacity=0,n&&(i.getComponent("propItem").initForBag(n),i.getComponent("propItem").setClick(!0),i.active=!0,this.m_boxNodeList[a].getChildByName("spr_bg").active=!1)}this.m_boxNodeList[17].getChildByName("porp_item").active=!1;var r=this.m_data.items[17];this.m_boxNodeList[34].getChildByName("spr_bg").active=!1,this.m_boxNodeList[34].getChildByName("porp_item").active=!0,this.m_boxNodeList[34].getChildByName("porp_item").getComponent("propItem").initForBag(r),this.m_boxNodeList[34].getChildByName("porp_item").getComponent("propItem").setClick(!0)}},playBeginAct:function(){var e=this;app.mainScene.p_nodeWait.show({isShow:!1});for(var t=[[0,7,14,21,28],[1,8,15,22,29],[2,9,16,23,30],[3,10,17,24,31],[4,11,18,25,32],[5,12,19,26,33],[6,13,20,27,34]],a=0;a<t.length;a++)for(var i=t[a],n=function(t){var n=e.m_boxNodeList[i[t]].getChildByName("porp_item"),r=cc.sequence(cc.delayTime(.3+.3*a),cc.callFunc(function(){n.active=!1}));n.runAction(r)},r=0;r<i.length;r++)n(r);var o=cc.sequence(cc.delayTime(2),cc.callFunc(function(){app.mainScene.p_nodeWait.hide()}));this.node.runAction(o)},refreshProp:function(){this.m_data&&this.m_data.djgsid&&(app.loadTexture(app.db.getPropsIconPath(this.m_data.djgsid),this.p_sprIcon,this.prefabPath),this.p_labNum.string=app.player.getCount(this.m_data.djgsid))},refreshReward:function(){if(this.m_data&&(this.p_nodeReward.active=!!this.m_data.final,this.m_data.final)){this.p_nodeReward.getComponent("propItem").initForBag(this.m_data.final);var e=this.getMaxLayer();this.p_nodeReward.getComponent("propItem").setGray(e),this.p_nodeReward.getComponent("propItem").setClick(!e)}},refreshNumLayer:function(){this.m_data&&this.p_sprLayer.getComponent("num").init(this.m_data.index+1,!0)},refreshLabCunmsn:function(){if(this.m_data&&this.m_data.djgsid){var e=app.db.getPropsName(this.m_data.djgsid);this.p_labXunbao.string=langMgr.getString("activityDwhdPageMjbg",10,[this.m_data.djcount,e])}},refreshTime:function(){var e=app.player.getServerTime(),t=gUtils.getActivityArrTime("MJBG")[1]||0,a=t-e;(!t||a<0)&&(a=0),this.p_labTime.string=0!=a?gUtils.getCountDownStr(a):"00:00:00"}});a.refreshRed=function(e){if(app.act_mjbgData){var t=a.getIsRed();return e&&(e.active=t),t}var i=!1,n=app.getRedInfoByObj(["zhd","mjbg"],0);return null!=n&&(i=n>0),e&&(e.active=i),i},a.getIsRed=function(){if(!app.act_mjbgData)return!1;var e=-1;if(app.act_mjbgData.final)for(var t=0;t<app.act_mjbgData.items.length;t++)app.act_mjbgData.items[t].gsid==app.act_mjbgData.final.gsid&&app.act_mjbgData.items[t].count==app.act_mjbgData.final.count&&(e=t);return!(app.act_mjbgData.index+1>=app.act_mjbgData.finallist.length&&1==app.act_mjbgData.strbox[e]||app.player.getCount(app.act_mjbgData.djgsid)<app.act_mjbgData.djcount)},cc._RF.pop()},{basePage:void 0}],activityDwhdPageRlwj:[function(e,t){"use strict";cc._RF.push(t,"72720zXvR5ERKCljd+pnjiu","activityDwhdPageRlwj");var a=cc.Class({extends:e("basePage"),properties:{p_labTime:cc.Label,p_btnHelp:cc.Button,p_progLiveness:cc.ProgressBar,p_arrNodeRewards:[cc.Node],p_sprLiveness:cc.Sprite,p_labLiveness:cc.Label,p_scrView:cc.ScrollView,p_nodeItem:cc.Node},statics:{prefabPath:"activitydwhdpagerlwj",pageParent:"activitydwhdpage"},onLoad:function(){var e=this;a.instance=this,this.schedule(this.refreshTime,1),this.stopBgNodeEvent(),this.creatMask(!0),this.p_btnHelp.node.on("click",function(){app.pages.windowspagetipshelp.showPage(1043)}),this.p_arrNodeRewards.forEach(function(t,a){t.getChildByName("icon_normal").on("touchend",function(){e.onClcikBox(a)})})},setParam:function(){var e=this;app.player.sfRlwjInfo(function(t,a){t||(e.m_data=a,e.refreshUI())})},refreshUI:function(){this.refreshTime(),this.refreshSprLiveness(),this.refreshProgLive(),this.refreshArrRewards(),this.refreshSView()},refreshSprLiveness:function(){var e=this;app.loadTexture(app.db.getPropsIconPath(this.m_data.mark),this.p_sprLiveness,this.prefabPath),this.p_sprLiveness.node.on("touchend",function(){app.showPropTips({gsid:e.m_data.mark})})},refreshProgLive:function(){var e=app.player.getCount(this.m_data.mark);this.p_labLiveness.string=e;var t=this.m_data.totals.length,a=this.m_data.totals[t-1].score;this.p_progLiveness.progress=e/a},refreshArrRewards:function(){var e=this;if(this.m_data&&this.m_data.totals){var t=this.m_data.totals[this.m_data.totals.length-1].score,a=this.p_progLiveness.totalLength-80;this.p_arrNodeRewards.forEach(function(i,n){var r=e.m_data.totals[n];if(r){var o=i.getChildByName("icon_normal"),s=i.getChildByName("icon_check");switch(i.getChildByName("lab_liveness").getComponent(cc.Label).string=r.score,r.status){case 0:o.active=!0,app.setSpriteState(o.getComponent(cc.Sprite),!0),s.active=!1;break;case 1:o.active=!0,app.setSpriteState(o.getComponent(cc.Sprite),!1),s.active=!1;break;case 2:o.active=!1,s.active=!0}var p=r.score/t;i.x=p*a-277}})}},refreshSView:function(){if(this.m_data&&this.m_data.items){for(var e=[],t=[],a=0;a<this.m_data.items.length;a++){var i=this.m_data.items[a];2==i.status?t.push(i):e.push(i)}var n=e.concat(t);this.m_arrItems||(this.m_arrItems=[],this.m_arrItems.push(this.p_nodeItem));for(var r=0;r<n.length;++r){var o=this.m_arrItems[r];o||((o=cc.instantiate(this.p_nodeItem)).parent=this.p_scrView.content,this.m_arrItems.push(o)),o.active=!0,o.getComponent("activityRlwjItem").refreshUI(n[r],r,this,this.getNewData)}for(var s=n.length;s<this.m_arrItems.length;++s)this.m_arrItems[s].active=!1}},onClcikBox:function(e){var t=this;if(this.m_data&&this.m_data.totals){var a=this.m_data.totals[e];a&&1==a.status&&app.player.sfRlwjScore(e,function(a,i){if(!a){t.m_data.totals[e].status=2,t.getNewData();var n={showtype:1,reward:i,confirmcb:function(){app.player.addItem(i),t.refreshArrRewards()},target:t};app.pages.windowspagereward.showPage(n)}})}},refreshTime:function(){var e=app.player.getServerTime(),t=gUtils.getActivityArrTime("RLWJ")[1]||0,a=t-e;(!t||a<0)&&(a=0),this.p_labTime.string=0!=a?gUtils.getCountDownStr(a):"00:00:00"}});a.refreshRed=function(){return!1},cc._RF.pop()},{basePage:void 0}],activityDwhdPageTgsl:[function(e,t){"use strict";cc._RF.push(t,"ece0es+yIdO37mclzuYRjL7","activityDwhdPageTgsl");var a=cc.Class({extends:e("basePage"),properties:{p_labTime:cc.Label,p_btnHelp:cc.Button,p_btnChangle:cc.Button,p_btnExchange:cc.Button,p_arrSkill:[cc.Node],p_arrReward:[cc.Node],p_labName:cc.Label,p_labBuytime:cc.Label,p_sprGeneral:cc.Sprite,p_spGeneral:sp.Skeleton,p_animGeneral:cc.Animation},statics:{prefabPath:"activitydwhdpagetgsl",pageParent:"activitydwhdpage"},onLoad:function(){a.instance=this,this.schedule(this.refreshTime,1),this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){var e=this;this._super(),this.p_btnHelp.node.on("click",function(){app.pages.windowspagetipshelp.showPage(1044)}),this.p_btnChangle.node.on("click",function(){app.goToBossBattle("tgslboss",e.m_data)}),this.p_btnExchange.node.on("click",function(){e.onClose(),app.pages.activitydwhdpagemjbg.showPage()}),this.p_arrSkill.forEach(function(t,a){t.on("touchend",function(){e.onClickSkill(a)})})},setParam:function(){var e=this;app.player.sfTgslInfo(function(t,a){t||(e.m_data=a,e.refreshUI())})},refreshUI:function(){this.refreshTime(),this.refreshBoss(),this.refreshLabBuytime(),this.refreshArrSkll(),this.refreshArrReward()},afterBattleFresh:function(){this.refreshLabBuytime()},refreshBoss:function(){this.m_data&&this.m_data.gsid&&(app.loadGeneral(this.m_data.gsid,this.p_sprGeneral,this.p_spGeneral,this.p_animGeneral,null,this.prefabPath),this.p_labName.string=this.m_data.name)},refreshLabBuytime:function(){if(this.m_data){var e=app.player.getCount(this.m_data.mark)||0,t=Math.max(1-e,0);this.p_labBuytime.string=langMgr.getString("activityDwhdPageTgsl",0,t),this.p_btnChangle.interactable=t>0,this.p_btnChangle.node.getChildByName("rednotice").active=a.refreshRed()}},refreshArrSkll:function(){var e=this;this.m_data&&this.m_data.skill&&this.p_arrSkill.forEach(function(t,a){var i=e.m_data.skill[a];t.active=!!i,i&&t.getComponent("skillItem").initForGSkill(i,!1,e)})},refreshArrReward:function(){var e=this;this.m_data&&this.m_data.challrewards&&this.p_arrReward.forEach(function(t,a){var i=e.m_data.challrewards[a];t.active=!!i,i&&(t.getComponent("propItem").initForGsid(i),t.getComponent("propItem").setClick(!0))})},onClickSkill:function(e){if(this.m_data&&this.m_data.skill){var t={type:"general",gsid:this.m_data.skill[e],index:e};app.pages.windowspagetipsskill.showPage(t)}},refreshTime:function(){var e=app.player.getServerTime(),t=gUtils.getActivityArrTime("TGSL")[1]||0,a=t-e;(!t||a<0)&&(a=0),this.p_labTime.string=0!=a?gUtils.getCountDownStr(a):"00:00:00"}});a.refreshRed=function(e){var t=0==app.player.getCount(90398);return e&&(e.active=t),t},cc._RF.pop()},{basePage:void 0}],activityDwhdPageZmfl:[function(e,t){"use strict";cc._RF.push(t,"6a0893BWflPLIUrdhmX7xBc","activityDwhdPageZmfl");var a=cc.Class({extends:e("basePage"),properties:{p_labTime:cc.Label,p_btnHelp:cc.Button,p_arrNode:[cc.Node]},statics:{prefabPath:"activitydwhdpagezmfl",pageParent:"activitydwhdpage"},onLoad:function(){var e=this;a.instance=this,this.schedule(this.refreshTime,1),this.stopBgNodeEvent(),this.creatMask(!0),this.p_btnHelp.node.on("click",function(){app.pages.windowspagetipshelp.showPage(1061)}),this.p_arrNode.forEach(function(t,a){t.getChildByName("btn_rev").on("click",function(){e.onClickRev(a)})})},setParam:function(){var e=this;app.player.sfZmflInfo(function(t,a){t||(e.m_data=a,e.refreshUI())})},refreshUI:function(){this.refreshArrNode(),this.refreshTime()},onClickRev:function(e){var t=this;this.m_data&&this.m_data[e]&&app.player.sfZmflReward(e,function(a){if(!a){var i={showtype:1,reward:t.m_data[e].rewards,target:t};app.pages.windowspagereward.showPage(i),app.player.addItem(t.m_data[e].rewards),t.m_data[e].status=1,t.refreshArrNode()}})},getIsRed:function(){if(!this.m_data)return!1;for(var e=0;e<this.m_data.length;e++){var t=this.m_data[e];if(1==t.istime&&0==t.status)return!0}return!1},refreshArrNode:function(){var e=this;this.m_data&&this.p_arrNode.forEach(function(t,a){var i=e.m_data[a];if(i){var n=t.getChildByName("layout_rewards").children,r=t.getChildByName("spr_tx_yilingqu"),o=t.getChildByName("spr_tx_yiguoqi"),s=t.getChildByName("btn_rev"),p=i.time.split("-");parseInt(p[1]),parseInt(p[2]),r.active=1==i.status,o.active=2==i.istime&&0==i.status,s.active=1==i.istime&&0==i.status,n.forEach(function(e,t){var a=i.rewards[t];e.active=!!a,e.active&&(e.getComponent("propItem").initForBag(a),e.getComponent("propItem").setClick(!0))})}})},refreshTime:function(){var e=app.player.getServerTime(),t=gUtils.getActivityArrTime("ZMFL")[1]||0,a=t-e;(!t||a<0)&&(a=0),this.p_labTime.string=0!=a?gUtils.getCountDownStr(a):"00:00:00"}});a.refreshRed=function(e){return e&&(e.active=!1),!1},cc._RF.pop()},{basePage:void 0}],activityDwhdPage:[function(e,t){"use strict";cc._RF.push(t,"959c5+FHHtCdr8EgzzOoZO0","activityDwhdPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activitydwhdpage"},properties:{p_nodeBg:cc.Node,p_scrView:cc.ScrollView,p_nodeItem:cc.Node,p_labNoActivity:cc.Node},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(),this.fitTopMenu(),this.handleUI(),this.m_menu=this.node.getComponent("menu"),this.m_arrZhdData=gUtils.deepClone(app.db.dbMWelfare.dwhd),this.m_menu.init(this)},onEnable:function(){this._super(),eventMgr.on(eventStr.redEvent.RefreshActivityRed,this.refreshRed,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.redEvent.RefreshActivityRed,this.refreshRed,this)},handleUI:function(){this._super()},menuHandler:function(e){if(this.m_arrShowPage[e]){var t=this.m_arrShowPage[e].SUOXIE;return!!gUtils.activityIsOpen(t,!0)&&(this.m_index=e,this.openShopPage(e),!0)}},setParam:function(e){this.m_arrShowPage=[];for(var t=0;t<this.m_arrZhdData.length;t++){var a=this.m_arrZhdData[t],i=!0,n=!1;a.FUNCTION_ID&&(i=app.db.checkFuncUnLock(a.FUNCTION_ID));var r=gUtils.getActivityArrTime(a.SUOXIE),o=app.player.getServerTime();r[0]<=o&&o<=r[1]&&(n=!0),n&&i&&this.m_arrShowPage.push(a)}this.m_arrShowPage.length<=0&&(this.p_labNoActivity.active=!0,app.mainScene&&app.mainScene.refreshLeftButton()),this.setMenuIndex(e)},setMenuIndex:function(e){var t=this,a=0;if(e)for(var i=0;i<this.m_arrShowPage.length;i++)if(e==this.m_arrShowPage[i].SUOXIE){a=i;break}this.m_arrShowPage[a]||(a=0),this.m_index!=a&&(this.m_index=a,app.player.sfPlayerByParam(["others"],function(){t.refreshSView(t.m_arrShowPage,a),t.m_menu.setMenuIndex(a)}))},openShopPage:function(e){var t=this,a=this.m_arrShowPage[e].PAGE,i=app.pages[a],n=function(){i.showPage({type:t.m_arrShowPage[e].NAME},t.p_nodeBg,function(){t.m_showPage=i.instance,t.m_showPage.node.opacity=0,t.m_showPage.node.runAction(cc.fadeIn(.1)),t.refreshCoinUI(t.m_arrShowPage[e].SUOXIE)})};this.m_showPage?(this.m_showPage.node.active=!0,this.m_showPage.node.runAction(cc.sequence(cc.fadeOut(.1),cc.callFunc(function(){t.m_showPage.onClose(),t.m_showPage=null,n()})))):n(),this.refreshRed()},refreshSView:function(e,t){var a=this;if(e){this.m_arrItems||(this.m_arrItems=[],this.m_arrItems.push(this.p_nodeItem));for(var i=function(e){var t=a.m_arrItems[e];t||((t=cc.instantiate(a.p_nodeItem)).parent=a.p_scrView.content,a.m_menu.p_arrBtnMenu.push(t),t.on("click",function(){app.playSound("click"),a.m_menu._onClickMenu(e)}),a.m_arrItems.push(t)),t.active=!0},n=0;n<e.length;++n)i(n);for(var r=0;r<e.length;++r)this.m_arrItems[r].getComponent("activityZhdGameItem").refreshUI(e[r],r,this);for(var o=e.length;o<this.m_arrItems.length;++o)this.m_arrItems[o].active=!1;this.scheduleOnce(function(){if(e.length<=4)a.p_scrView.content.x=(4-e.length)*a.p_nodeItem.width-300+10;else{t=Math.max(t-1,0);var i=a.p_nodeItem.width*t;a.p_scrView.scrollToOffset(cc.Vec2(i,0))}},.1)}},refreshCoinUI:function(){},openShopPageByArr:function(e){var t=this,a=e;e instanceof Array&&(a=e.shift()),this.m_menu.p_arrBtnMenu.forEach(function(e,t){e.getComponent("menuBtnItem")&&e.getComponent("menuBtnItem").select(t==a)});var i=this.m_arrShowPage[a].PFBNAME.replace(/_/g,"");this.m_menu.m_numMenuIndex=a;var n=app.pages[i],r=function(){var a=null;e instanceof Array&&(a=e.shift()),n.showPage(a,t.p_nodeBg,function(){t.m_showPage=n.instance,t.m_showPage.node.opacity=0,t.m_showPage.node.runAction(cc.fadeIn(.1))})};this.m_showPage?(this.m_showPage.node.active=!0,this.m_showPage.node.runAction(cc.sequence(cc.fadeOut(.1),cc.callFunc(function(){t.m_showPage.onClose(),t.m_showPage=null,r()})))):r()},refreshMenuRed:function(e){var t=this.m_arrShowPage[e].PFBNAME.replace(/_/g,"");if(app.pages[t])return app.pages[t].refreshRed();console.log(t+"is error")},refreshRed:function(){this.m_menu.refreshRed()},onClose:function(){this.m_showPage&&cc.isValid(this.m_showPage.node)&&this.m_showPage.onClose(),this._super()}});a.refreshRed=function(e){for(var t=!1,a=0;a<app.db.dbMWelfare.dwhd.length;a++){var i,n=app.db.dbMWelfare.dwhd[a],r=!0;n.FUNCTION_ID&&(r=app.db.checkFuncUnLock(n.FUNCTION_ID)),t=(i=gUtils.activityIsOpen(n.SUOXIE))&&r;var o=n.PFBNAME.replace(/_/g,"");if(t=r&&i&&app.pages[o].refreshRed())break}return e&&(e.active=t),t},a.isOpen=function(){for(var e=!1,t=0;t<app.db.dbMWelfare.dwhd.length;t++){var a=app.db.dbMWelfare.dwhd[t],i=!0;a.FUNCTION_ID&&(i=app.db.checkFuncUnLock(a.FUNCTION_ID));var n=!1,r=gUtils.getActivityArrTime(a.SUOXIE),o=app.player.getServerTime();if(r[0]<=o&&o<=r[1]&&(n=!0),e=n&&i)break}return e},cc._RF.pop()},{basePage:void 0}],activityDyrpfListPage:[function(e,t){"use strict";cc._RF.push(t,"f1792SzhZhLnokNOtUfPyWO","activityDyrpfListPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activitydyrpflistpage",pageType:1,createShot:!1},properties:{p_nodeContent:cc.Node,p_nodeItem:cc.Node},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},setParam:function(e){var t=e.target;this.m_arrItems||(this.m_arrItems=[],this.m_arrItems.push(this.p_nodeItem));for(var a=0;a<t.length;++a){var i=this.m_arrItems[a];i||((i=cc.instantiate(this.p_nodeItem)).parent=this.p_nodeContent,this.m_arrItems.push(i)),i.active=!0}for(var n=0;n<t.length;++n)this.m_arrItems[n].getComponent("activityDyrpfListItem").refreshUI(n,t[n])}});cc._RF.pop()},{basePage:void 0}],activityDyrpfPage:[function(e,t){"use strict";cc._RF.push(t,"1f7ab8TyKhA7Lw7bxDc3fps","activityDyrpfPage");var a=[104,105,101,103,102,106],i=[-2,-1,0,1,2,3],n=[-700,-350,0,350,700,1050],r=cc.Class({extends:e("basePage"),statics:{prefabPath:"activitydyrpfpage",pageType:1},properties:{p_btnFightPreview:cc.Button,p_btnQ:cc.Button,p_pfItem:cc.Prefab,p_nodeContent:cc.Node,p_btnReward:cc.Button,p_nodeMore:cc.Node,p_labTime:cc.Label,p_labIntro_1:cc.Label,p_labIntro_2:cc.Label,p_labIntro_3:cc.Label,p_sprGeneral:cc.Sprite,p_spGeneral:sp.Skeleton,p_animGeneral:cc.Animation,p_nodeTouch:cc.Node,p_nodeMove:cc.Node,p_arrBanner:[cc.Node],p_sprTitle:cc.Sprite,p_arrSprFTitle:[cc.SpriteFrame],p_nodeChoose:cc.Node,p_btnSkinPreview:cc.Button},onLoad:function(){r.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.m_labIntro3Color=this.p_labIntro_3.node.color},handleUI:function(){var e=this;this._super(),this.p_btnFightPreview.node.on("click",function(){app.playSound("click"),app.pages.playvideopage.showPage(e.m_objNowShow.target[0].url)}),this.p_btnSkinPreview.node.on("click",function(){app.playSound("click"),app.pages.activityDyrpfPreview.showPage(e.m_objNowShow.id)}),this.p_btnQ.node.on("click",function(){app.playSound("click"),app.pages.windowspagetipshelp.showPage(1097)}),this.p_btnReward.node.on("click",function(){app.playSound("click"),e.onClickRewardBtn()}),this.p_nodeMore.on("touchend",function(){app.playSound("click"),app.pages.activitydyrpflistpage.showPage(e.m_objNowShow)});var t=function(t){if(!e._bLoad){var a=t.getStartLocation(),i=t.getLocation(),n=a.sub(i);n.mag()<10||(e.m_numMoveDir=n.x<0?1:-1,e.pickBanner())}};this.p_nodeTouch.on("touchend",t),this.p_nodeTouch.on("touchcancel",t),this.p_arrBanner.forEach(function(t){t.on("touchend",function(){e._bLoad||(app.playSound("click"),0!=t.touchTag&&(e.m_numMoveDir=t.touchTag>0?-1:1,e.pickBanner()))})})},setParam:function(){var e=this;app.player.sfSmanSkinInfo(function(t,a){if(t)return"not open"==t&&(t="\u6d3b\u52a8\u5df2\u7ed3\u675f"),app.showNotice(t),eventMgr.emit(eventStr.redEvent.RefreshMainSceneDyrhd),void e.onClose();e.m_arrData=a,e.refreshUI()})},_getRewardState:function(e){if(!e)return 2;for(var t=0;t<e.length;++t)if(0==e[t].status||1==e[t].status)return e[t].status;return 2},refreshUI:function(){var e=this,t=[],r=[],o=[],s=[],p=[],c=[],h=2;this.m_skinIndex=0,this.p_sprTitle.spriteFrame=this.p_arrSprFTitle[0];for(var l=0;l<this.p_arrBanner.length;++l)this.p_arrBanner[l].objData=this.m_arrData[l]||{},0==(h=this._getRewardState(this.p_arrBanner[l].objData.target))?(o.push(this.p_arrBanner[l]),c.push(this.p_arrSprFTitle[l])):1==h?(t.push(this.p_arrBanner[l]),s.push(this.p_arrSprFTitle[l])):(r.push(this.p_arrBanner[l]),p.push(this.p_arrSprFTitle[l]));this.p_arrBanner=t.concat(o,r),this.p_arrSprFTitle=s.concat(c,p),this.m_numShowIndex=2,this.p_arrBanner.forEach(function(t,r){t.moveTag=e.m_numShowIndex+r,t.moveTag>a.length-1&&(t.moveTag-=a.length),t.x=n[t.moveTag],t.touchTag=i[t.moveTag],0==t.touchTag&&(e.m_objNowShow=t.objData,e.p_sprTitle.spriteFrame=e.p_arrSprFTitle[r],e.m_skinIndex=r)}),this.schedule(this.refreshTime,1),this.refreshByShowIndex()},refreshByShowIndex:function(){if(this.m_objNowShow){this.m_numShow=this.m_objNowShow.target.length-1;for(var e=0;e<this.m_objNowShow.target.length;++e)if(0==this.m_objNowShow.target[e].status||1==this.m_objNowShow.target[e].status){this.m_numShow=e;break}var t=this.m_objNowShow.target[this.m_numShow];if(t){var a=app.db.getGBaseByGsid(t.gsid);this.p_labIntro_1.string=langMgr.getString("activityDyrpfPage",0,["\u2160","\u2161","\u2162","\u2163","\u2164","\u2165","\u2166","\u2167","\u2168"][this.m_numShow]),this.p_labIntro_2.string=langMgr.getString("activityDyrpfPage",1,[a.STAR,a.NAME]),this.p_labIntro_3.string=0==t.status?0:1,this.p_labIntro_3.node.color=0==t.status?cc.Color.RED:this.m_labIntro3Color;for(var i=0;i<t.reward.length;i++){var n=this.p_nodeContent.children[i];n||((n=cc.instantiate(this.p_pfItem)).scale=.7,n.parent=this.p_nodeContent),n.active=!0,n.getComponent("propItem").initForBag(t.reward[i]),n.getComponent("propItem").setClick(!0),n.getComponent("propItem").setGray(2==t.status)}for(var r=t.reward.length;r<this.p_nodeContent.children.length;r++)this.p_nodeContent.children[r].active=!1;app.setSpriteState(this.p_btnReward.node.getComponent(cc.Sprite),1!=t.status),this.p_btnReward.node.getChildByName("tx_yilingqu").active=2==t.status,this.p_btnReward.node.getChildByName("tx_lingqujiangli").active=0==t.status||1==t.status,this.refreshShowGeneral()}}},refreshShowGeneral:function(){var e=this,t=this.m_objNowShow.target[this.m_objNowShow.target.length-1];this._bLoad=!0,app.loadGeneral(t.gsid,this.p_sprGeneral,this.p_spGeneral,this.p_animGeneral,function(){cc.isValid(e)&&(e._bLoad=!1)},this.prefabPath,t.skinid)},refreshTime:function(){var e=app.player.getServerTime(),t=app.player.sman_skin_time[1];this.p_labTime.string=gUtils.getCountDownStr(t-e)},onClickRewardBtn:function(){var e=this,t=this.m_objNowShow.target[this.m_numShow];t&&(0!=t.status?2!=t.status?app.player.sfSmanSkinReward(this.m_objNowShow.id,this.m_numShow,function(a,i){if(a)app.showNotice(a);else{app.player.addItem(i);var n={showtype:1,reward:i,target:e};app.pages.windowspagereward.showPage(n),t.status=2,app.getRedInfoByObj(["act","smanskin"],0)>=1&&(app.redDataServer.act.smanskin-=1),eventMgr.emit(eventStr.redEvent.RefreshMainSceneDyrhd),e.refreshByShowIndex()}}):app.showNotice(langMgr.getString("activityDyrpfPage",3)):app.showNotice(langMgr.getString("activityDyrpfPage",2)))},pickBanner:function(){var e=this;if(!this.m_boolMoveAction){this.m_boolMoveAction=!0,this.m_numShowIndex+=this.m_numMoveDir,this.m_numShowIndex>=a.length&&(this.m_numShowIndex=0),this.m_numShowIndex<a.length&&(this.m_numShowIndex=a.length-1),console.log("\u5f53\u524d\u663e\u793a\u7684numshowindex"),console.log(this.m_numShowIndex);var t=350*this.m_numMoveDir,i=cc.moveBy(.3,cc.v2(t,0)),n=cc.callFunc(function(){e.m_boolMoveAction=!1,e.refreshByShowIndex()});this.setBannerTag(),this.p_nodeMove.runAction(cc.sequence(i,n))}},setBannerTag:function(){var e=this,t=a.length;this.p_arrBanner.forEach(function(a,n){a.moveTag=a.moveTag+e.m_numMoveDir,a.moveTag<0?a.moveTag=t-1:a.moveTag>=t&&(a.moveTag=0),a.touchTag=i[a.moveTag],0==a.touchTag&&(e.m_objNowShow=a.objData,e.p_nodeChoose.x=a.x,e.p_sprTitle.spriteFrame=e.p_arrSprFTitle[n],e.m_skinIndex=n)}),this.p_arrBanner.forEach(function(a){e.m_numMoveDir<0&&a.moveTag===t-1?a.x=e.getMoveTagNode(t-2).x+350:e.m_numMoveDir>0&&0===a.moveTag&&(a.x=e.getMoveTagNode(1).x-350)})},getMoveTagNode:function(e){for(var t=0;t<this.p_arrBanner.length;++t)if(this.p_arrBanner[t].moveTag==e)return this.p_arrBanner[t]}});r.isOpen=function(){var e=app.player.getServerTime();return e>app.player.sman_skin_time[0]&&e<app.player.sman_skin_time[1]&&app.db.checkFuncUnLock("ACTIVITY_DYRPF")},r.refreshRed=function(e){var t=app.getRedInfoByObj(["act","smanskin"],0)>0;return e&&(e.active=t),t},cc._RF.pop()},{basePage:void 0}],activityDyrpfPreview:[function(e,t){"use strict";cc._RF.push(t,"bac0cCSa5RKG6UseTFjNZpr","activityDyrpfPreview");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=cc._decorator,o=r.ccclass,s=r.property,p=e("basePage"),c={101:0,201:1,301:2,401:3,501:4,601:5},h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_sprPreview=null,t.p_arrSprf=[],t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0)},t.prototype.setParam=function(e){this.p_sprPreview.spriteFrame=this.p_arrSprf[c[e]||0]},t.prefabPath="activityDyrpfPreview",t.pageType=1,t.createShot=!1,n([s(cc.Sprite)],t.prototype,"p_sprPreview",void 0),n([s(cc.SpriteFrame)],t.prototype,"p_arrSprf",void 0),a=n([o],t)}(p);t.exports=h,cc._RF.pop()},{basePage:void 0}],activityGcflPage:[function(e,t){"use strict";cc._RF.push(t,"d307bZ1nBZBC4M0MIjWd5Jl","activityGcflPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activitygcflpage",pageType:1},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},setParam:function(e){"citypage"==e&&(a.boolFirstOpenByCityPage=!0)}});a.isOpen=function(){var e=app.player.level>=30&&app.player.level<=60;if(e){var t=app.player.getServerTime(),a=gUtils.getActivityArrTime("GCFL");e=t>a[0]&&t<a[1]&&t<=gUtils.getTimeByDay(app.player.create,3)}return e},a.isNeedAutoOpen=function(){return a.isOpen()},a.isNeedAutoOpenByCityPage=function(){return a.isOpen()&&!a.boolFirstOpenByCityPage},cc._RF.pop()},{basePage:void 0}],activityGelbPage:[function(e,t){"use strict";cc._RF.push(t,"c5d22o8/rJEU4VJ9CdUZOSO","activityGelbPage");var a=["GELB","GELB1"],i=cc.Class({extends:e("basePage"),statics:{prefabPath:"activitygelbpage",pageType:1},properties:{p_arrNodeBg:[cc.Node]},onLoad:function(){i.instance=this,this.stopBgNodeEvent(),this.creatMask(!0)},setParam:function(e){if(this.m_numIndex=e,!gUtils.activityIsOpen(a[e]||a[0],!0))return app.mainScene&&app.mainScene.refreshLeftButton(),void this.onClose();this.p_arrNodeBg.forEach(function(t,a){t.active=e==a})},onClose:function(){this._super(),gUtils.activityIsOpen(a[this.m_numIndex]||a[0])||app.mainScene&&app.mainScene.refreshLeftButton()}});i.isOpen=function(e){var t=gUtils.activityIsOpen(a[e]||a[0]),i=app.db.checkFuncUnLock("ACTIVITY_ZHD")&&app.db.checkChannelShow("ACTIVITY_ZHD");return t&&i},i.isCanPop=function(e){var t,n=a[e]||a[0];if(t=gUtils.activityIsOpen(n)&&!localDataUtils.GetValue("ACTIVITY_"+n,null)){var r=gUtils.getActivityArrTime(n);r[1]&&localDataUtils.SetValue("ACTIVITY_"+n,1,r[1]),i.showPage(e)}return t},cc._RF.pop()},{basePage:void 0}],activityGiftGStarPage:[function(e,t){"use strict";cc._RF.push(t,"a37a0Sl3/NJTbGGuYJ8O8ZA","activityGiftGStarPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activitygiftgstarpage",pageType:1},properties:{p_sprImage:cc.Sprite,p_labTime:cc.Label,p_pfbItem:cc.Prefab,p_nodeParent:cc.Node,p_btnBuy:cc.Button,p_labPrice:cc.Label,p_btnLeft:cc.Button,p_btnRight:cc.Button,p_nodeDotList:cc.Node,p_nodeBtnParent:cc.Node,p_nodeBtn:cc.Node},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.m_menu=this.node.getComponent("menu"),this.m_menu.init(this),this.schedule(this.refreshTime,1)},handleUI:function(){var e=this;this._super(),this.p_btnBuy.node.on("click",function(){app.playSound("click"),e.onClickBuy()}),this.p_btnLeft.node.on("click",function(){e.m_nIndex<=0||(e.refreshUI(e.m_nIndex-1),e.refreshArrow(e.m_nIndex-1),e.p_nodeDotList.getComponent("dotListItem").flipLeft())}),this.p_btnRight.node.on("click",function(){e.m_nIndex>=app.gradegift.length-1||(e.refreshUI(e.m_nIndex+1),e.refreshArrow(e.m_nIndex+1),e.p_nodeDotList.getComponent("dotListItem").flipRight())}),this.p_btnLeft.node.active=!1,this.p_btnRight.node.active=!1},start:function(){},setParam:function(e){cc.log(app.gradegift),e&&e.gstar?this.m_nowShowGstar=e.gstar:this.m_nowShowGstar=0;for(var t=0;t<app.gradegift.length;t++){var a=app.gradegift[t];app.player.getServerTime()>=a.expireAt&&app.gradegift.splice(t,1)}if(app.gradegift.length<=0)return app.mainScene.refreshTopButton(),void this.onClose();this.concatArrData(app.gradegift);var i=this.getShowIndex(this.m_nowShowGstar);if(this.m_menu.setMenuIndex(i),this.p_nodeDotList.getComponent("dotListItem").initUI(app.gradegift.length,i),null==localDataUtils.GetValue("xiangoured",null)){var n=app.player.getServerTime(),r=gUtils.getSecondDayTime(n);localDataUtils.SetValue("xiangoured",1,r)}this.setData(),this.refreshBtn()},setData:function(){app.gradegift.sort(function(e,t){var a=e.type.split("C"),i=t.type.split("C");if(Number(a[1])<Number(i[1]))return-1}),cc.log(app.gradegift)},menuHandler:function(e){this.m_nowMenuIndex=e,this.refreshUI(e)},getShowIndex:function(e){for(var t=0;t<app.gradegift.length;++t)if(app.gradegift[t].gstar==e)return t;return 0},refreshBtn:function(){var e=this;if(app.gradegift.length<2)this.p_nodeBtnParent.active=!1;else{this.p_nodeBtnParent.active=!0;for(var t=function(t){var a=e.p_nodeBtnParent.children[t];a||((a=cc.instantiate(e.p_nodeBtnParent.children[0])).parent=e.p_nodeBtnParent,e.m_menu.p_arrBtnMenu.push(a),a.on("click",function(){app.playSound("click"),e.m_menu._onClickMenu(t)}));var i=app.db.dbRecommendGift[app.gradegift[t].type],n=a.getComponent(cc.Sprite),r=a.getChildByName("btn_pick").getComponent(cc.Sprite),o=a.getChildByName("spr_name").getComponent(cc.Sprite),s=gConfig.rootPath.uiicontjlb+i.ICON,p=gConfig.rootPath.uiicontjlb+i.ICONLIGHT,c=gConfig.rootPath.uiicontjlb+i.TXTNAME;app.loadTexture(s,n,e.prefabPath),app.loadTexture(p,r,e.prefabPath),app.loadTexture(c,o,e.prefabPath),a.active=!0},a=0;a<app.gradegift.length;a++)t(a);for(var i=app.gradegift.length;i<this.p_nodeBtnParent.children.length;i++)this.p_nodeBtnParent.children[i].active=!1}},concatArrData:function(e){e&&e.sort(function(e,t){return t.gstar-e.gstar})},refreshUI:function(e){if(!(!app.gradegift||app.gradegift.length<=0||e>=app.gradegift)){var t=app.gradegift[e];this.m_objGift=t;var a=t.rewards||[],i="gift/image_czhd_wjzl"+this.m_objGift.gstar+"_lang";app.loadTexture(gConfig.getUiActivityPath(i),this.p_sprImage,this.prefabPath),this.m_numEndTime=t.expireAt||0,this.refreshTime(),this.p_arrReward=this.p_arrReward||[];for(var n=0;n<a.length;n++){var r=this.p_arrReward[n];r||((r=cc.instantiate(this.p_pfbItem)).parent=this.p_nodeParent,r.scale=.8,this.p_arrReward.push(r)),r.active=!0,r.getComponent("propItem").initForBag(a[n]),r.getComponent("propItem").setClick(!0)}for(var o=a.length;o<this.p_arrReward.length;++o)this.p_arrReward[o].active=!1;this.p_labPrice.string="\xa5"+t.price}},refreshArrow:function(e){this.m_nIndex=e;var t=app.gradegift.length;this.p_btnLeft.node.opacity=t>=2&&e>=1?255:0,this.p_btnRight.node.opacity=t>=2&&e<t-1?255:0},refreshTime:function(){var e=app.player.getServerTime(),t=this.m_numEndTime||0,a=t-e;(!t||a<0)&&(a=0),this.p_labTime.string=langMgr.getString("activityGiftGStarPage",2,gUtils.getCountDownStr(a))},onClickBuy:function(){var e=this;app.player.getServerTime()>this.m_numEndTime?app.showNotice(langMgr.getString("activityGiftGStarPage",1)):app.player.payRecommendGift(this.m_objGift.type,this.m_objGift.price,function(){e._payRefreshEnd=!1;var t={showtype:1,reward:e.m_objGift.rewards,confirmcb:function(){app.reduceGradeGift(e.m_objGift.type),app.mainScene.refreshTopUI(),e.onClose()},target:e};app.pages.windowspagereward.showPage(t),e.payRefresh(),e.schedule(e.payRefresh,1,3)},function(){cc.log("\u7b49\u7ea7\u793c\u5305\u8d2d\u4e70\u53d6\u6d88\u6216\u5931\u8d25")})},payRefresh:function(){var e=this;this._payRefreshEnd||app.player.sfPlayerData(function(){e.refreshBtn(),e.refreshUI(0),e._payRefreshEnd=!0})},onClose:function(){app.recommendnewgift=[],this._super()}});a.getEndTime=function(){var e=0;if(!app.gradegift||"Array"!=gUtils.getType(app.gradegift))return e;for(var t=0;t<app.gradegift.length;++t){var a=app.gradegift[t].expireAt;a&&(0==e||a<e)&&a>app.player.getServerTime()&&(e=a)}return e},a.refreshRed=function(e){var t=!1;return t||null==localDataUtils.GetValue("xiangoured",null)&&(t=!0),e&&(e.active=t),t},cc._RF.pop()},{basePage:void 0}],activityGiftLevelPage:[function(e,t){"use strict";cc._RF.push(t,"e2b3bSHhaFBW4Mivvvmp4w8","activityGiftLevelPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activitygiftlevelpage",pageType:1},properties:{p_rtxIntro:cc.RichText,p_pfbItem:cc.Prefab,p_nodeParent:cc.Node,p_labTime:cc.Label,p_btnBuy:cc.Button,p_labPrice:cc.Label,p_btnLeft:cc.Button,p_btnRight:cc.Button,p_nodeDotList:cc.Node,p_nodeBtnParent:cc.Node,p_nodeBtn:cc.Node},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.schedule(this.refreshTime,1),this.m_menu=this.node.getComponent("menu"),this.m_menu.init(this)},handleUI:function(){var e=this;this._super(),this.p_btnBuy.node.on("click",function(){app.player.payRecommendGift(e.m_objShowData.type||0,e.m_objShowData.price,function(){e._payRefreshEnd=!1;var t={reward:e.m_objShowData.rewards,showtype:1};app.pages.windowspagereward.showPage(t),e.payRefresh(),e.schedule(e.payRefresh,1,3)},function(){app.showNotice(langMgr.getString("giftRecommendPage",0))})}),this.p_btnLeft.node.on("click",function(){e.m_nIndex<=0||(e.m_objShowData=e.m_arrData[e.m_nIndex-1],e.refreshUI(),e.refreshArrow(e.m_nIndex-1),e.p_nodeDotList.getComponent("dotListItem").flipLeft())}),this.p_btnRight.node.on("click",function(){e.m_nIndex>=e.m_arrData.length-1||(e.m_objShowData=e.m_arrData[e.m_nIndex+1],e.refreshUI(),e.refreshArrow(e.m_nIndex+1),e.p_nodeDotList.getComponent("dotListItem").flipRight())}),this.p_btnLeft.node.active=!1,this.p_btnRight.node.active=!1},setParam:function(e){cc.log("show gift recommend page"),cc.log(e),app.arrRed.djlb=!0,this.m_objData=e,"Array"==gUtils.getType(e.data)?e.data.length>0?this.m_arrData=this.m_objData.data:this.onClose():this.m_arrData=[e.data],this.setData(),this.refreshBtn(),this.m_menu.setMenuIndex(0)},setData:function(){this.m_arrData.sort(function(e,t){var a=e.type.split("V"),i=t.type.split("V");if(Number(a[1])<Number(i[1]))return-1})},menuHandler:function(e){this.m_nowMenuIndex=e,this.m_objShowData=this.m_arrData[e],this.refreshUI()},refreshBtn:function(){var e=this;if(this.m_arrData.length<2)this.p_nodeBtnParent.active=!1;else{this.p_nodeBtnParent.active=!0;for(var t=function(t){var a=e.p_nodeBtnParent.children[t];a||((a=cc.instantiate(e.p_nodeBtnParent.children[0])).parent=e.p_nodeBtnParent,e.m_menu.p_arrBtnMenu.push(a),a.on("click",function(){app.playSound("click"),e.m_menu._onClickMenu(t)}));var i=app.db.dbRecommendGift[e.m_arrData[t].type],n=a.getComponent(cc.Sprite),r=a.getChildByName("btn_pick").getComponent(cc.Sprite),o=a.getChildByName("spr_name").getComponent(cc.Sprite),s=gConfig.rootPath.uiicontjlb+i.ICON,p=gConfig.rootPath.uiicontjlb+i.ICONLIGHT,c=gConfig.rootPath.uiicontjlb+i.TXTNAME;app.loadTexture(s,n,e.prefabPath),app.loadTexture(p,r,e.prefabPath),app.loadTexture(c,o,e.prefabPath),a.active=!0},a=0;a<this.m_arrData.length;a++)t(a);for(var i=this.m_arrData.length;i<this.p_nodeBtnParent.children.length;i++)this.p_nodeBtnParent.children[i].active=!1}},payRefresh:function(){var e=this;this._payRefreshEnd||app.player.sfPlayerData(function(){e._payRefreshEnd=!0,app.reduceLevelGift(e.m_objShowData.type),app.mainScene&&app.mainScene.refreshTopUI(),e.onClose()})},refreshUI:function(){var e=app.db.dbRecommendGift[this.m_objShowData.type],t="";e&&e.INTRO&&(t=e.INTRO),this.p_rtxIntro.string=t;var a=gUtils.deepClone(this.m_objShowData.rewards);a.push({gsid:38003,count:this.m_objShowData.exp||10*this.m_objShowData.price}),this.refreshRewards(a),this.refreshBtnBuy(),this.refreshTime()},refreshRewards:function(e){this.m_arrItems||(this.m_arrItems=[]);for(var t=0;t<e.length;++t){var a=this.m_arrItems[t];a||((a=cc.instantiate(this.p_pfbItem)).parent=this.p_nodeParent,a.scale=.9,this.m_arrItems.push(a)),a.getComponent("propItem").initForBag(e[t]),a.getComponent("propItem").setClick(!0),a.active=!0}for(var i=e.length;i<this.m_arrItems.length;++i)this.m_arrItems[i].active=!1},refreshBtnBuy:function(){this.p_labPrice.string="\xa5"+this.m_objShowData.price},refreshTime:function(){var e=app.player.getServerTime(),t=this.m_objShowData.expireAt,a=t-e;(!t||a<0)&&(a=0),this.p_labTime.string=gUtils.getCountDownStr(a)+langMgr.getString("giftRecommendPage",1)},refreshArrow:function(e){this.m_nIndex=e;var t=this.m_arrData.length;this.p_btnLeft.node.opacity=t>=2&&e>=1?255:0,this.p_btnRight.node.opacity=t>=2&&e<t-1?255:0},onClose:function(){app.recommendnewgift=[],this._super()}});a.getEndTime=function(){var e=0;if(!app.levelgift||"Array"!=gUtils.getType(app.levelgift))return e;for(var t=0;t<app.levelgift.length;++t){var a=app.levelgift[t].expireAt;a&&(0==e||a<e)&&(e=a)}return e},a.refreshRed=function(e){return e&&(e.active=!app.arrRed.djlb),!app.arrRed.djlb},cc._RF.pop()},{basePage:void 0}],activityJchdPageGrowup:[function(e,t){"use strict";cc._RF.push(t,"e7c106jVh9DA4iGG4X3+ZNK","activityJchdPageGrowup"),cc.Class({extends:e("activityJchdPageItem"),properties:{p_scrView:cc.ScrollView,p_nodeItem:cc.Node,p_labYb:cc.Label,p_btnBuy:cc.Button,p_sprValue:cc.Sprite,p_sprYiBuy:cc.Node},onLoad:function(){var e=this;this.p_btnBuy.node.on("click",function(){e.onClickBtnBuy()})},onClickBtnBuy:function(){var e=this;app.player.pay("specialcz",function(){e._payRefreshEnd=!1,e.payRefresh(),e.schedule(e.payRefresh,1,3)},function(){console.log("\u652f\u4ed8\u53d6\u6d88or\u5931\u8d25")})},payRefresh:function(){var e=this;this._payRefreshEnd||app.player.sfPlayerData(function(){e.refreshUI(),e._payRefreshEnd=!0})},getNewData:function(e){this.m_target=e.target,app.arrRed.czjj&&(app.arrRed.czjj=0,gUtils.saveHdRed()),app.pages.activityjchdpage.instance&&app.pages.activityjchdpage.instance.p_activityMenu.refreshRed(),this.m_numBuyPrice=app.db.dbRecharge.specialcz.PRICE,this.m_arrGpData=app.db.dbMActivityGp,app.loadTexture(gConfig.getPriceImg(this.m_numBuyPrice),this.p_sprValue,app.getPrefabPathFrom(this.m_target)),this.refreshUI()},refreshUI:function(){app.player.special.specialcz?(this.p_btnBuy.interactable=!1,this.p_sprValue.node.active=!1,this.p_sprYiBuy.active=!0):(this.p_sprYiBuy.active=!1,this.p_sprValue.node.active=!0,this.p_btnBuy.interactable=!0);for(var e=[],t=[],a=0;a<this.m_arrGpData.length;++a){var i=this.m_arrGpData[a];app.player.special.specialcz&&app.player.level>=i.LEVEL?t.push(i):e.push(i)}this.m_arrGpData=e.concat(t),this.refreshSView(this.m_arrGpData),this.upLabYb()},upLabYb:function(){for(var e=0,t=0;t<this.m_arrGpData.length;t++)e+=this.m_arrGpData[t].YBNUM;this.p_labYb.string=e},refreshSView:function(e){this.m_arrItems||(this.m_arrItems=[],this.m_arrItems.push(this.p_nodeItem));for(var t=0;t<e.length;++t){var a=this.m_arrItems[t];a||((a=cc.instantiate(this.p_nodeItem)).parent=this.p_scrView.content,this.m_arrItems.push(a)),a.active=!0,a.getComponent("activeGrowupItem").refreshUI(e[t],this.m_target)}for(var i=e.length;i<this.m_arrItems.length;++i)this.m_arrItems[i].active=!1}}),cc._RF.pop()},{activityJchdPageItem:"activityJchdPageItem"}],activityJchdPageItem:[function(e,t){"use strict";cc._RF.push(t,"74d30ImtYRHgL4ebnqP/iIy","activityJchdPageItem"),cc.Class({extends:cc.Component,properties:{},setDeps:function(e){this._prefabroot=e},getNewData:function(){}}),cc._RF.pop()},{}],activityJchdPageMrqd:[function(e,t){"use strict";cc._RF.push(t,"11621cCiNFBXJc/3vK+kewA","activityJchdPageMrqd");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activityjchdpagemrqd",pageParent:"activitypagefreewelfare"},properties:{p_labTime:cc.Label,p_srcView:cc.ScrollView,p_pfbSignItem:cc.Prefab,p_btnGet:cc.Button,p_btnHlep:cc.Button,p_nodeMrlq:cc.Node,p_nodeLq:cc.Node},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.m_arrItem=[]},handleUI:function(){var e=this;this._super(),this.p_btnGet.node.on("click",function(){var t=app.player.getCount(90221);app.player.getCount(90518)>0?app.showNotice(langMgr.getString("activityJchdPageMrqd",2)):e._bGet||t?app.player.activityDaySign(function(t,a){t?app.showNotice(t):(app.player.addItem(a),app.player.sfPlayerByParam(["others","hide","firstcharge"],function(){var t={showtype:1,reward:a};app.pages.windowspagereward.showPage(t),app.pages.activitypagefreewelfare.instance.refreshCoinUI(),e.refreshUI()}))}):app.showNotice(langMgr.getString("activityJchdPageMrqd",2))}),this.p_btnHlep.node.on("click",function(){app.pages.windowspagetipshelp.showPage("1067")})},setParam:function(){app.isTodayFirstLogin(),this.refreshUI()},refreshUI:function(){var e=this,t=app.player.getCount(90485),a=Math.floor(t/30)%12,i=app.player.getCount(90484),n=t%30;t%30==0&&t&&(n=i==t?30:t%30),this.p_labTime.string=langMgr.getString("activityJchdPageMrqd",3,n);var r=i-30*a-1,o=a;i%30==0&&t==i&&(o=a>0?a-1:a);for(var s=30*o,p=0;s<30*o+30;++s,++p){var c=this.m_arrItem[p];c||((c=cc.instantiate(this.p_pfbSignItem)).parent=this.p_srcView.content,this.m_arrItem.push(c)),c.active=!0,c.getComponent("signItem").refreshUI(s,r,this)}this._bGet=t<i,this.p_btnGet.node.getChildByName("rednotice").active=this._bGet||app.player.getCount(90221)>0&&app.player.getCount(90518)<1,this.p_btnGet.interactable=this._bGet||app.player.getCount(90221)>0&&app.player.getCount(90518)<1,this.p_nodeLq.active=this.p_btnGet.interactable,this.p_nodeMrlq.active=!this.p_btnGet.interactable;var h=Math.floor((t-30*a)/5);this.scheduleOnce(function(){e.p_srcView.scrollToOffset(cc.v2(0,h>=2?96*(h-1):0),0)},.1)},update:function(){}});a.refreshRed=function(){return app.player.getCount(90485)<app.player.getCount(90484)||app.player.getCount(90221)>0&&app.player.getCount(90518)<1},cc._RF.pop()},{basePage:void 0}],activityJchdPageMylb:[function(e,t){"use strict";cc._RF.push(t,"bacb1d1YqFICq2zMwXAAZxw","activityJchdPageMylb"),cc.Class({extends:e("activityJchdPageItem"),properties:{p_labTime:cc.Label,p_scrView:cc.ScrollView,p_nodeItem:cc.Node},onLoad:function(){this.schedule(this.refreshTime,1)},getNewData:function(e){var t=this;this.m_target=e.target,this.m_objData&&this.m_objData.end>app.player.getServerTime()?this.refreshUI():app.player.sfGetMylbList(function(e,a){t.m_objData=a,t.refreshUI()})},refreshUI:function(){var e=this.m_objData;this.m_numEndTime=e.end,this.refreshTime(),this.refreshSView(e.items),this.p_scrView.scrollToTop(.5)},refreshSView:function(e){this.m_arrItems||(this.m_arrItems=[],this.m_arrItems.push(this.p_nodeItem));for(var t=0;t<e.length;++t){var a=this.m_arrItems[t];a||((a=cc.instantiate(this.p_nodeItem)).parent=this.p_scrView.content,this.m_arrItems.push(a)),a.active=!0,a.getComponent("giftItem").refreshUI(e[t],t,"mylb",this.m_target)}for(var i=e.length;i<this.m_arrItems.length;++i)this.m_arrItems[i].active=!1},refreshTime:function(){var e=app.player.getServerTime(),t=this.m_numEndTime,a=t-e;(!t||a<0)&&(a=0),this.p_labTime.string=gUtils.getCountDownStr(a)}}),cc._RF.pop()},{activityJchdPageItem:"activityJchdPageItem"}],activityJchdPageMzlb:[function(e,t){"use strict";cc._RF.push(t,"991e7Pf3F1LNJy7VsU4P2Ap","activityJchdPageMzlb"),cc.Class({extends:e("activityJchdPageItem"),properties:{p_labTime:cc.Label,p_scrView:cc.ScrollView,p_nodeItem:cc.Node},onLoad:function(){this.schedule(this.refreshTime,1)},getNewData:function(e){var t=this;this.m_target=e.target,this.m_objData&&this.m_objData.end>app.player.getServerTime()?this.refreshUI():app.player.sfGetMzlbList(function(e,a){t.m_objData=a,t.refreshUI()})},refreshUI:function(){var e=this.m_objData;this.m_numEndTime=e.end,this.refreshTime(),this.refreshSView(e.items),this.p_scrView.scrollToTop(.5)},refreshSView:function(e){this.m_arrItems||(this.m_arrItems=[],this.m_arrItems.push(this.p_nodeItem));for(var t=0;t<e.length;++t){var a=this.m_arrItems[t];a||((a=cc.instantiate(this.p_nodeItem)).parent=this.p_scrView.content,this.m_arrItems.push(a)),a.active=!0,a.getComponent("giftItem").refreshUI(e[t],t,"mzlb",this.m_target)}for(var i=e.length;i<this.m_arrItems.length;++i)this.m_arrItems[i].active=!1},refreshTime:function(){var e=app.player.getServerTime(),t=this.m_numEndTime,a=t-e;(!t||a<0)&&(a=0),this.p_labTime.string=gUtils.getCountDownStr(a)}}),cc._RF.pop()},{activityJchdPageItem:"activityJchdPageItem"}],activityJchdPageNoble:[function(e,t){"use strict";cc._RF.push(t,"d5037pYAZxD3Y+zKhsYPxST","activityJchdPageNoble"),cc.Class({extends:e("activityJchdPageItem"),properties:{p_btnBuy:cc.Button,p_labYb:cc.Label,p_sprNowValue:cc.Sprite,p_sprOldValue:cc.Sprite,p_nodeItem:cc.Node,p_layout:cc.Layout,p_labSurplus:cc.Label,p_labSurpBg:cc.Label,p_btnEwaiRew:cc.Button,p_labType:1},onLoad:function(){this.handleUI()},handleUI:function(){var e=this;this.p_btnBuy.node.on("click",function(){app.playSound("click"),e.onClickBtnBuy()}),this.p_btnEwaiRew&&this.p_btnEwaiRew.node.on("click",function(){app.playSound("click"),app.goToPage("rechargepage1")})},onClickBtnBuy:function(){var e=this,t="specialgz",a=!1;1==this.p_labType?(t="specialgz",a=0==app.player.getCount(90271)):2==this.p_labType&&(t="specialzz",a=0==app.player.getCount(90272)),app.player.pay(t,function(){e._payRefreshEnd=!1,e.payRefresh(),e.schedule(e.payRefresh,1,3)},function(){console.log("\u652f\u4ed8\u53d6\u6d88or\u5931\u8d25")},a)},payRefresh:function(){var e=this;this._payRefreshEnd||app.player.sfPlayerByParam(["others","hide","bagspace","props"],function(){e.receiveReward(),e._payRefreshEnd=!0})},receiveReward:function(){for(var e=[],t=this.m_dbMCard.ARRACT,a=0;a<t.length;a++){var i={gsid:t[a].ACTGSID,count:t[a].ACTCOUNT};e.push(i)}var n={showtype:1,reward:e,target:this,confirmcb:this.refreshUI};app.pages.windowspagereward.showPage(n)},getNewData:function(e){this.m_target=e.target,1==this.p_labType?(app.arrRed.gzyk&&(app.arrRed.gzyk=0,gUtils.saveHdRed()),this.m_dbMCard=app.db.dbMCard[0]):2==this.p_labType&&(app.arrRed.zzyk&&(app.arrRed.zzyk=0,gUtils.saveHdRed()),this.m_dbMCard=app.db.dbMCard[1]),app.pages.activityjchdpage.instance&&app.pages.activityjchdpage.instance.p_activityMenu.refreshRed(),this.refreshUI()},refreshUI:function(){this.m_dbMCard&&(this.upLabYb(),this.upActLayout(),this.upLabSurp(),this.upValue())},upLabSurp:function(){1==this.p_labType?this.p_labSurplus.string=langMgr.getString("activityJchdPageNoble",0,app.player.special.specialgz||0):2==this.p_labType&&(this.p_labSurplus.string=langMgr.getString("activityJchdPageNoble",0,app.player.special.specialzz||0))},upActLayout:function(){var e=this.m_dbMCard.ARRACT;if(null!=e){this.m_arrItems||(this.m_arrItems=[],this.m_arrItems.push(this.p_nodeItem));for(var t=0;t<e.length;++t){var a=this.m_arrItems[t];a||((a=cc.instantiate(this.p_nodeItem)).parent=this.p_layout.node,this.m_arrItems.push(a)),a.active=!0,a.getComponent("propItem").initForBag({gsid:e[t].ACTGSID,count:e[t].ACTCOUNT}),a.getComponent("propItem").setClick(!0)}for(var i=e.length;i<this.m_arrItems.length;++i)this.m_arrItems[i].active=!1}},upValue:function(){if(1==this.p_labType){var e=app.player.getCount(90271);0==e?(this.p_sprOldValue.node.active=!0,app.loadTexture(gConfig.getPriceImg(app.db.dbRecharge.specialgz.PRICE),this.p_sprOldValue,app.getPrefabPathFrom(this.m_target)),app.loadTexture(gConfig.getPriceImg(app.db.dbRecharge.specialgz.FIRST),this.p_sprNowValue,app.getPrefabPathFrom(this.m_target))):e>0&&(this.p_sprOldValue.node.active=!1,app.loadTexture(gConfig.getPriceImg(app.db.dbRecharge.specialgz.PRICE),this.p_sprNowValue,app.getPrefabPathFrom(this.m_target)))}else if(2==this.p_labType){var t=app.player.getCount(90272);0==t?(this.p_sprOldValue.node.active=!0,app.loadTexture(gConfig.getPriceImg(app.db.dbRecharge.specialzz.PRICE),this.p_sprOldValue,app.getPrefabPathFrom(this.m_target)),app.loadTexture(gConfig.getPriceImg(app.db.dbRecharge.specialzz.FIRST),this.p_sprNowValue,app.getPrefabPathFrom(this.m_target))):t>0&&(this.p_sprOldValue.node.active=!1,app.loadTexture(gConfig.getPriceImg(app.db.dbRecharge.specialzz.PRICE),this.p_sprNowValue,app.getPrefabPathFrom(this.m_target)))}},upLabYb:function(){var e=this.m_dbMCard.ARRREW[0].REWCOUNT;e&&(this.p_labYb.string=e)}}),cc._RF.pop()},{activityJchdPageItem:"activityJchdPageItem"}],activityJchdPageVipclub:[function(e,t){"use strict";cc._RF.push(t,"cbdd4rjYoFDkIx0VSpzKmdi","activityJchdPageVipclub");var a=cc.Class({extends:e("activityJchdPageItem"),properties:{prefabPath:"activityjchdpage"},onLoad:function(){a.instance=this},getNewData:function(){}});cc._RF.pop()},{activityJchdPageItem:"activityJchdPageItem"}],activityJchdPage:[function(e,t){"use strict";cc._RF.push(t,"5a49fZkpvFEMaf/u/nOQXcb","activityJchdPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activityjchdpage",pageType:1},properties:{p_activityMenu:e("activityMenu")},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(),this.handleUI(),this.m_idx=0,this.m_arrData=app.db.dbMWelfare["\u798f\u5229"],this.p_activityMenu.initData(this,this.m_arrData)},handleUI:function(){this._super()},start:function(){},setParam:function(e){if(e)for(var t=0;t<this.m_arrData.length;t++)e==this.m_arrData[t].NAME&&app.player.level>=this.m_arrData[t].LEVEL&&(this.m_idx=t);this.refreshUI()},refreshUI:function(){this.p_activityMenu.setMenuIndex(this.m_idx),this.p_activityMenu.refreshRed()},refreshMenuRed:function(e){return!(!this.m_arrData||!this.m_arrData[e])&&a.getRed(this.m_arrData[e].NAME)},menuHandler:function(){cc.log(this.p_activityMenu.m_numMenuIndex)},onClose:function(){this._super()}});a.refreshRed=function(e){for(var t=!1,i=["\u6bcf\u65e5\u7b7e\u5230","\u6210\u957f\u57fa\u91d1","\u8d35\u65cf\u6708\u5361","\u81f3\u5c0a\u6708\u5361"],n=0;n<i.length;n++)a.getRed(i[n])&&(t=!0);e.active=t},a.getRed=function(e){var t=!1;switch(e){case"\u6bcf\u65e5\u7b7e\u5230":t=app.player.getCount(90223)<app.player.getCount(90215);break;case"\u6210\u957f\u57fa\u91d1":t=!app.player.special.specialcz&&!!app.arrRed.czjj;break;case"\u8d35\u65cf\u6708\u5361":t=!app.player.special.specialgz&&!!app.arrRed.gzyk;break;case"\u81f3\u5c0a\u6708\u5361":t=!app.player.special.specialzz&&!!app.arrRed.zzyk}return t},cc._RF.pop()},{activityMenu:void 0,basePage:void 0}],activityJrhdPage2Sub:[function(e,t){"use strict";cc._RF.push(t,"e4be2r6BJdLjbMjDK/ngoyR","activityJrhdPage2Sub");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activityjrhdpage2sub",pageType:1},properties:{p_sprBg:cc.Sprite,p_pfbItem:cc.Prefab,p_nodeParent1:cc.Node,p_nodeParent2:cc.Node,p_btnBuy:cc.Button,p_nodeNum:cc.Node,p_labLimit:cc.Label,p_labTime:cc.Label},onLoad:function(){a.instance=this,this.schedule(this.refreshTime,1),this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.p_arrRewards=[];for(var e=0;e<3;e++){var t=cc.instantiate(this.p_pfbItem);t.scale=.8,t.parent=this.p_nodeParent1,this.p_arrRewards.push(t)}for(var i=0;i<2;i++){var n=cc.instantiate(this.p_pfbItem);n.scale=.8,n.parent=this.p_nodeParent2,this.p_arrRewards.push(n)}},handleUI:function(){var e=this;this._super(),this.p_btnBuy.node.on("click",function(){e.clickBuyBtn()})},setParam:function(){var e=this;gUtils.activityIsOpen("CJXG3",!0)&&(localDataUtils.SetValue("jrhd2sub",1,gUtils.getSecondDayTime(app.player.getServerTime())),this.m_index=1,app.arrZhdData.CJXG3?(this.m_data=app.arrZhdData.CJXG3,this.refreshUI()):app.player.sfGetCjxg3(function(t,a){t?app.showNotice(t):(app.arrZhdData.CJXG3=a,e.m_data=app.arrZhdData.CJXG3,e.m_data[0].items.push({gsid:38003,count:10*e.m_data[0].price}),e.m_data[1].items.push({gsid:38003,count:10*e.m_data[1].price}),e.refreshUI())}))},payRefresh:function(){var e=this;this._payRefreshEnd||app.player.sfPlayerByParam(["props","hide","others","bagspace","vip","cjxg3"],function(){e._payRefreshEnd=!0,e.refreshUI()})},clickBuyBtn:function(){var e=this,t=this.m_index;gUtils.activityIsOpen("CJXG3",!0)&&app.player.payCjxg3(t,this.m_data[t].price,function(){e._payRefreshEnd=!1;var a={reward:e.setReward(t),showtype:1};app.pages.windowspagereward.showPage(a),e.m_data[t].buytime-=1,e.payRefresh(),e.schedule(e.payRefresh,1,3)},function(){app.showNotice(langMgr.getString("activityJrhdPage",2))})},setReward:function(){for(var e=this.m_index,t=[],a=this.m_data[e].items||[],i=this.m_data[e].special||[],n=0;n<a.length;++n)t.push(a[n]);for(var r=0;r<i.length;++r)t.push(i[r]);return t},refershRewards:function(){for(var e=this.m_index,t=this.m_data[e].items.concat(this.m_data[e].special),a=0;a<this.p_arrRewards.length;a++){var i=this.p_arrRewards[a],n=t[a];i.active=!!n,i.active&&(i.getComponent("propItem").initForBag(n),i.getComponent("propItem").setClick(!0))}},refreshBtn:function(){this.p_btnBuy.interactable=this.m_data[this.m_index].buytime>0},refreshBuytime:function(){this.p_labLimit.string=langMgr.getString("activityJrhdPage2",3,this.m_data[this.m_index].buytime)},refreshBuyNum:function(){this.p_nodeNum.getComponent("price_num_item").init(this.m_data[this.m_index].price,1,2)},refreshUI:function(){this.refreshBuytime(),this.refreshBtn(),this.refreshTime(),this.refershRewards(),this.refreshBuyNum()},refreshTime:function(){var e=app.player.getServerTime(),t=gUtils.getActivityArrTime("CJXG3")||0,a=t-e;(!t||a<0)&&(a=0),this.p_labTime.string=gUtils.getCountDownStr(a)+langMgr.getString("public",10)},onClose:function(){this._super(),app.mainScene.refreshLeftButton()}});a.getEndTime=function(){return gUtils.getActivityArrTime("CJXG3")[1]||0},a.refreshRed=function(e){var t=!localDataUtils.GetValue("jrhd2sub",null);return e&&(e.active=t),t},cc._RF.pop()},{basePage:void 0}],activityJrhdPage2:[function(e,t){"use strict";cc._RF.push(t,"dfe0fhDGV1Nl65fiFm0LjlN","activityJrhdPage2");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activityjrhdpage2",pageType:1},properties:{p_sprBg:cc.Sprite,p_pfbItem:cc.Prefab,p_nodeParent1:cc.Node,p_nodeParent2:cc.Node,p_btnBuy:cc.Button,p_nodeNum:cc.Node,p_labLimit:cc.Label,p_labTime:cc.Label},onLoad:function(){a.instance=this,this.schedule(this.refreshTime,1),this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.p_arrRewards=[];for(var e=0;e<3;e++){var t=cc.instantiate(this.p_pfbItem);t.scale=.8,t.parent=this.p_nodeParent1,this.p_arrRewards.push(t)}for(var i=0;i<2;i++){var n=cc.instantiate(this.p_pfbItem);n.scale=.8,n.parent=this.p_nodeParent2,this.p_arrRewards.push(n)}},handleUI:function(){var e=this;this._super(),this.p_btnBuy.node.on("click",function(){e.clickBuyBtn()})},setParam:function(){var e=this;gUtils.activityIsOpen("CJXG3",!0)&&(localDataUtils.SetValue("jrhd2",1,gUtils.getSecondDayTime(app.player.getServerTime())),this.m_index=0,app.arrZhdData.CJXG3?(this.m_data=app.arrZhdData.CJXG3,this.refreshUI()):app.player.sfGetCjxg3(function(t,a){t?app.showNotice(t):(app.arrZhdData.CJXG3=a,e.m_data=app.arrZhdData.CJXG3,e.m_data[0].items.push({gsid:38003,count:e.m_data[0].exp}),e.m_data[1].items.push({gsid:38003,count:e.m_data[1].exp}),e.refreshUI())}))},payRefresh:function(){var e=this;this._payRefreshEnd||app.player.sfPlayerByParam(["props","hide","others","bagspace","vip","cjxg3"],function(){e._payRefreshEnd=!0,e.refreshUI()})},clickBuyBtn:function(){var e=this,t=this.m_index;gUtils.activityIsOpen("CJXG3",!0)&&app.player.payCjxg3(t,this.m_data[t].price,function(){e._payRefreshEnd=!1;var a={reward:e.setReward(t),showtype:1};app.pages.windowspagereward.showPage(a),e.m_data[t].buytime-=1,e.payRefresh(),e.schedule(e.payRefresh,1,3)},function(){app.showNotice(langMgr.getString("activityJrhdPage",2))})},setReward:function(){for(var e=this.m_index,t=[],a=this.m_data[e].items||[],i=this.m_data[e].special||[],n=0;n<a.length;++n)t.push(a[n]);for(var r=0;r<i.length;++r)t.push(i[r]);return t},refershRewards:function(){for(var e=this.m_index,t=this.m_data[e].items.concat(this.m_data[e].special),a=0;a<this.p_arrRewards.length;a++){var i=this.p_arrRewards[a],n=t[a];i.active=!!n,i.active&&(i.getComponent("propItem").initForBag(n),i.getComponent("propItem").setClick(!0))}},refreshBtn:function(){this.p_btnBuy.interactable=this.m_data[this.m_index].buytime>0},refreshBuytime:function(){this.p_labLimit.string=langMgr.getString("activityJrhdPage2",3,this.m_data[this.m_index].buytime)},refreshBuyNum:function(){this.p_nodeNum.getComponent("price_num_item").init(this.m_data[this.m_index].price,1,2)},refreshUI:function(){this.refreshBuytime(),this.refreshBtn(),this.refreshTime(),this.refershRewards(),this.refreshBuyNum()},refreshTime:function(){var e=app.player.getServerTime(),t=gUtils.getActivityArrTime("CJXG3")[1]||0,a=t-e;(!t||a<0)&&(a=0),this.p_labTime.string=gUtils.getCountDownStr(a)+langMgr.getString("public",10)},onClose:function(){this._super(),app.mainScene.refreshLeftButton()}});a.getEndTime=function(){return gUtils.getActivityArrTime("CJXG3")[1]||0},a.refreshRed=function(e){var t=!localDataUtils.GetValue("jrhd2",null);return e&&(e.active=t),t},cc._RF.pop()},{basePage:void 0}],activityJrhdPageSub:[function(e,t){"use strict";cc._RF.push(t,"c427dCWLTNCmpJ25SMaSoMS","activityJrhdPageSub");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activityjrhdpagesub",pageType:1},properties:{p_sprBg:cc.Sprite,p_pfbItem:cc.Prefab,p_nodeParent1:cc.Node,p_nodeParent2:cc.Node,p_btnBuy:cc.Button,p_labNum:cc.Label,p_labLimit:cc.Label,p_labTime:cc.Label},onLoad:function(){a.instance=this,this.schedule(this.refreshTime,1),this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.p_arrRewards=[];for(var e=0;e<3;e++){var t=cc.instantiate(this.p_pfbItem);t.scale=.8,t.parent=this.p_nodeParent1,this.p_arrRewards.push(t)}for(var i=0;i<2;i++){var n=cc.instantiate(this.p_pfbItem);n.scale=.8,n.parent=this.p_nodeParent2,this.p_arrRewards.push(n)}},handleUI:function(){var e=this;this._super(),this.p_btnBuy.node.on("click",function(){e.clickBuyBtn()})},setParam:function(){var e=this;gUtils.activityIsOpen("CJXG2",!0)&&(localDataUtils.SetValue("jrhdsub",1,gUtils.getSecondDayTime(app.player.getServerTime())),this.m_index=1,app.arrZhdData.CJXG2?(this.m_data=app.arrZhdData.CJXG2,this.refreshUI()):app.player.sfGetCjxg2(function(t,a){t?app.showNotice(t):(app.arrZhdData.CJXG2=a,e.m_data=app.arrZhdData.CJXG2,e.m_data[0].items.push({gsid:38003,count:e.m_data[0].exp}),e.m_data[1].items.push({gsid:38003,count:e.m_data[1].exp}),e.refreshUI())}))},payRefresh:function(){var e=this;this._payRefreshEnd||app.player.sfPlayerByParam(["props","hide","others","bagspace","vip","cjxg2"],function(){e._payRefreshEnd=!0,e.refreshUI()})},clickBuyBtn:function(){var e=this,t=this.m_index;gUtils.activityIsOpen("CJXG2",!0)&&app.player.payCjxg2(t,this.m_data[t].price,function(){e._payRefreshEnd=!1;var a={reward:e.setReward(t),showtype:1};app.pages.windowspagereward.showPage(a),e.m_data[t].buytime-=1,e.payRefresh(),e.schedule(e.payRefresh,1,3)},function(){app.showNotice(langMgr.getString("activityJrhdPage",2))})},setReward:function(){for(var e=this.m_index,t=[],a=this.m_data[e].items||[],i=this.m_data[e].special||[],n=0;n<a.length;++n)t.push(a[n]);for(var r=0;r<i.length;++r)t.push(i[r]);return t},refershRewards:function(){for(var e=this.m_index,t=this.m_data[e].items.concat(this.m_data[e].special),a=0;a<this.p_arrRewards.length;a++){var i=this.p_arrRewards[a],n=t[a];i.active=!!n,i.active&&(i.getComponent("propItem").initForBag(n),i.getComponent("propItem").setClick(!0))}},refreshBtn:function(){this.p_btnBuy.interactable=this.m_data[this.m_index].buytime>0},refreshBuytime:function(){this.p_labLimit.string=langMgr.getString("activityJrhdPage",3,this.m_data[this.m_index].buytime)},refreshBuyNum:function(){this.p_labNum.string="\xa5"+this.m_data[this.m_index].price},refreshUI:function(){this.refreshBuytime(),this.refreshBtn(),this.refreshTime(),this.refershRewards(),this.refreshBuyNum()},refreshTime:function(){var e=app.player.getServerTime(),t=gUtils.getActivityArrTime("CJXG2")[1]||0,a=t-e;(!t||a<0)&&(a=0),this.p_labTime.string=gUtils.getCountDownStr(a)+langMgr.getString("public",10)},onClose:function(){this._super(),app.mainScene.refreshLeftButton()}});a.getEndTime=function(){return gUtils.getActivityArrTime("CJXG2")[1]||0},a.refreshRed=function(e){var t=!localDataUtils.GetValue("jrhdsub",null);return e&&(e.active=t),t},cc._RF.pop()},{basePage:void 0}],activityJrhdPage:[function(e,t){"use strict";cc._RF.push(t,"39207TSxlhLu5wzhw4M9/dn","activityJrhdPage"),e("../utils/gameConfig").tutorType;var a={CJXG2:{getInfo:"sfGetCjxg2",buy:"payCjxg2",id:"cjxg2"},CJXG3:{getInfo:"sfGetCjxg3",buy:"payCjxg3",id:"cjxg3"}},i=cc.Class({extends:e("basePage"),statics:{prefabPath:"activityjrhdpage",pageType:1},properties:{p_arrNodeTitle:[cc.Node],p_nodeBannerCzjx:cc.Node,p_labValue:cc.Label,p_nodeBannerCzsj:cc.Node,p_nodeBannerCzsjNew:cc.Node,p_sprGeneral:cc.Sprite,p_spGeneral:sp.Skeleton,p_animGeneral:cc.Animation,p_nodeGeneral:cc.Node,p_nodeGInfo:cc.Node,p_nodePInfo:cc.Node,p_sprCamp:cc.Sprite,p_sprOCCU:cc.Sprite,p_sprOccu2:cc.Sprite,p_sprName:cc.Sprite,p_nodeStar:cc.Node,p_sprStar:[cc.Sprite],p_generalQuality:cc.Node,p_pfbQualityItem:cc.Prefab,_gQualityItem:null,p_btnReview:cc.Button,p_btnChange:cc.Button,p_nodePick:cc.Node,p_labTime:cc.Label,p_labLimit:cc.Label,p_nodeCZSJ:cc.Node,p_ndoeCZJX:cc.Node,p_nodeReward:cc.Node,p_pfbItem:cc.Prefab,p_btnBuy:cc.Button,p_labPrice:cc.Label},onLoad:function(){i.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.m_menu=this.node.getComponent("menu"),this.m_menu.init(this),this.schedule(this.refreshTime,1)},handleUI:function(){var e=this;this._super(),this.p_btnBuy.node.on("click",function(){app.playSound("click");var t=null;0==e.m_nowMenuIndex&&(t=e.m_selectIndex),e.clickBuyBtn(e.m_nowMenuIndex,t)}),this.p_nodePick.on("touchend",function(){app.playSound("click"),e.clickPickGenreal()}),this.p_btnChange.node.on("click",function(){app.playSound("click"),e.clickPickGenreal()}),this.p_btnReview.node.on("click",function(){app.playSound("click");var t={GSID:e.m_nowShowGsid,COUNT:1};app.showPropTips(t)})},setParam:function(e){var t,i=this;if(null!=e&&e.id){var n=e.id,r=null!=(t=e.index)?t:0;a[n]&&(this.m_activityId=n,this.m_objAPI=a[n],gUtils.activityIsOpen(n,!0)&&(localDataUtils.SetValue("jrhd",1,gUtils.getSecondDayTime(app.player.getServerTime())),app.arrZhdData[n]?(this.m_data=app.arrZhdData[n],this.setDefMenu(r)):app.player[this.m_objAPI.getInfo](function(e,t){if(e)return app.showNotice(e);app.arrZhdData[n]=t,i.m_data=app.arrZhdData[n],i.setDefMenu(r)})))}},setDefMenu:function(e){this.m_menu.setMenuIndex(e)},refreshMenu:function(){var e=this,t=[];return this.m_menu.p_arrBtnMenu.forEach(function(a,i){var n=e.m_data[i];a.active=Boolean(n.buytime>0),a.active&&t.push(i)}),t},menuHandler:function(e){switch(this.m_nowMenuIndex=e,e){case 0:this.refreshCzsjUI();break;case 1:this.refreshCzjxUI()}this.refershTitle(e),this.refershBanner(e),this.refreshBuytime(e),this.refreshBtnBuy(e),this.refreshTime(e),this.refershRewards(e)},refreshCzsjUI:function(){var e=this.m_data[0],t=e.items;if(e.selectitems){var a=this.getSavePickItem(e.selectitems);if(a){var i=this.tranPropToGeneral(a);this.refreshGeneral(i)}else this.refreshGeneral();this.p_btnChange.node.active=Boolean(e.buytime>0)}else{var n=this.getRewardGeneralGsid(t)[0];this.refreshGeneral(n),this.p_btnChange.node.active=!1}},refreshCzjxUI:function(){this.refreshGeneral(16381,!1)},payRefresh:function(){var e=this;this._payRefreshEnd||app.player.sfPlayerByParam(["props","hide","others","bagspace","vip",this.m_objAPI.id],function(){e._payRefreshEnd=!0,e.refreshBuytime(e.m_nowMenuIndex),e.refreshBtnBuy(e.m_nowMenuIndex),0==e.m_nowMenuIndex&&e.refreshCzsjUI()})},clickBuyBtn:function(e,t){var a=this;if(gUtils.activityIsOpen(this.m_activityId,!0))if(!this.m_data[e].selectitems||t||0==t){var i=this.m_data[e].price;app.player[this.m_objAPI.buy](e,i,t,function(){a._payRefreshEnd=!1;var t={reward:a.setReward(e,!0),showtype:1};app.pages.windowspagereward.showPage(t),a.m_data[e].buytime-=1,a.payRefresh(),a.schedule(a.payRefresh,1,3)},function(){app.showNotice(langMgr.getString("activityJrhdPage",2))})}else app.showNotice(langMgr.getString("activityJrhdPage",4))},clickPickGenreal:function(){var e=this,t={type:1,select:this.m_data[0].selectitems,confirmcb:function(t){cc.log("now pick selectIndex is",t);var a,i=e.m_data[0].selectitems[t];i&&(a=e.tranPropToGeneral(i)),app.arrZhdData[e.m_activityId].pickSelectItem=i,e.refreshGeneral(a),e.refershRewards(0)},target:this};app.pages.windowspagerewardpick.showPage(t)},getShowReward:function(){},setReward:function(e,t){var a=[],i=this.m_data[e].items||[],n=this.m_data[e].special||[],r=this.m_data[e].selectitems;if(r)if(t){var o=this.getSavePickItem(r);o&&a.push(o)}else a.push({GSID:"select",arrselect:r});for(var s=0;s<i.length;++s)a.push(i[s]);this.m_data[e].exp&&a.push({GSID:38003,COUNT:this.m_data[e].exp});for(var p=0;p<n.length;++p)a.push(n[p]);return a},refershTitle:function(e){this.p_arrNodeTitle.forEach(function(t,a){t.active=Boolean(a==e)})},refershBanner:function(e){this.p_nodeBannerCzjx.active=Boolean(1==e),this.p_labValue.node.active=Boolean(1==e),1==e&&(this.p_labValue.string=this.m_data[e].value+"%"),this.p_nodeBannerCzsj.active=Boolean(0==e&&!this.isNewWeek()),this.p_nodeBannerCzsjNew.active=Boolean(0==e&&this.isNewWeek())},refreshGInfo:function(e){var t=this,a=app.db.getGBaseByGsid(e);if(a){var i=app.db.getGNamePathVByGsid(e);app.loadTexture(i,this.p_sprName,this.prefabPath);var n=gConfig.getIconGCampPath(a.CAMP-1);app.loadTexture(n,this.p_sprCamp,this.prefabPath);var r=gConfig.getIconGOccuPath(a.OCCU-1);app.loadTexture(r,this.p_sprOCCU,this.prefabPath),a.OCCU2?(this.p_sprOccu2.node.active=!0,r=gConfig.getIconGOccuPath(a.OCCU2-1),app.loadTexture(r,this.p_sprOccu2,this.prefabPath)):this.p_sprOccu2.node.active=!1;var o=a.STAR;if(this.p_nodeStar.opacity=o<10?255:0,o<10){var s=(o-1)%5,p=gConfig.getIconGBigStarPath(a.STAR);this.p_sprStar.forEach(function(e,a){e.node.active=s>=a,app.loadTexture(p,e,t.prefabPath)})}this.p_generalQuality.opacity=Boolean(a.TGRADE)?255:0,a.TGRADE&&(cc.isValid(this._gQualityItem)||(this._gQualityItem=cc.instantiate(this.p_pfbQualityItem),this.p_generalQuality.addChild(this._gQualityItem),this._gQualityItem.setPosition(cc.Vec2.ZERO)),this._gQualityItem.getComponent("GeneralQualityItem").init(a.TGRADE))}},refreshGeneral:function(e,t){void 0===t&&(t=!0),e?(this.m_nowShowGsid=e,this.p_nodePInfo.active=!1,this.p_nodeGeneral.active=!0,app.loadGeneral(e,this.p_sprGeneral,this.p_spGeneral,this.p_animGeneral,null,this.prefabPath),t?(this.refreshGInfo(e),this.p_nodeGInfo.active=!0):this.p_nodeGInfo.active=!1):(this.p_nodeGeneral.active=!1,this.p_nodeGInfo.active=!1,this.p_nodePInfo.active=!0)},refershRewards:function(e){this.m_arrItems||(this.m_arrItems=[]);for(var t=this.setReward(e),a=0;a<t.length;a++){var i=this.m_arrItems[a];i||((i=cc.instantiate(this.p_pfbItem)).parent=this.p_nodeReward,i.scale=.8,this.m_arrItems.push(i)),i.active=!0;var n=t[a];if("select"==n.GSID){var r=n.arrselect,o=this.getSavePickItem(r);o?(i.getComponent("propItem").initForBag(o),i.getComponent("propItem").setClick(!0)):i.getComponent("propItem").initForSelect({GSID:"DEF",select:n.arrselect})}else i.getComponent("propItem").initForBag(n),i.getComponent("propItem").setClick(!0)}},refreshBtnBuy:function(e){this.p_btnBuy.interactable=Boolean(this.m_data[e].buytime>0),this.p_labPrice.string="\xa5"+this.m_data[e].price},refreshBuytime:function(e){this.p_labLimit.string=langMgr.getString("activityJrhdPage",3,this.m_data[e].buytime)},refreshTime:function(){var e=app.player.getServerTime(),t=gUtils.getActivityArrTime(this.m_activityId)[1]||0,a=t-e;(!t||a<0)&&(a=0),this.p_labTime.string=gUtils.getCountDownStr(a)+langMgr.getString("public",10)},getRewardGeneralGsid:function(e){for(var t=[],a=0;a<e.length;++a){var i=e[a],n=this.tranPropToGeneral(i);n&&t.push(n)}return t},tranPropToGeneral:function(e){var t;if(e){var a=null,i=null!=(t=e.GSID)?t:e.gsid;switch(app.db.getTypeByGsid(i)){case"general":a=i;break;case"generalchip":a=i-1e4}return a}},getSavePickItem:function(e){var t=null,a=this.getRewardGeneralGsid(e),i=app.arrZhdData[this.m_activityId].pickSelectItem;if(i){var n=this.tranPropToGeneral(i),r=a.indexOf(n);return r>=0&&(t=i,this.m_selectIndex=r),t}},isNewWeek:function(){var e=app.arrZhdTime[this.m_activityId];if(!e||!e.type)return!1;var t=e.type;return Boolean(t.indexOf("XS_")>=0)},onClose:function(){this._super(),app.mainScene.refreshLeftButton()}});i.getEndTime=function(){var e="CJXG3";return gUtils.activityIsOpen("CJXG2")&&app.db.checkFuncUnLock("HERO_COME")&&app.db.checkChannelShow("HERO_COME")&&(e="CJXG2"),gUtils.getActivityArrTime(e)[1]||0},i.refreshRed=function(e){var t=!localDataUtils.GetValue("jrhd",null);return e&&(e.active=t),t},cc._RF.pop()},{"../utils/gameConfig":void 0,basePage:void 0}],activityLdjlPageHtzhExit:[function(e,t){"use strict";cc._RF.push(t,"43b67KCkSdK1r29ULnpVMlC","activityLdjlPageHtzhExit");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activityldjlpagehtzhexit",pageType:1},properties:{p_nodeItem:cc.Node,p_scrView:cc.ScrollView,p_labPrice:cc.Label,p_sprIcon:cc.Sprite},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.creatMask(!0)},handleUI:function(){this._super()},onEnable:function(){this._super(),eventMgr.on(eventStr.zhdPage.HTZH_REFRESH_INFO,this.initData,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.zhdPage.HTZH_REFRESH_INFO,this.initData,this)},initData:function(e){this.m_objData=e,this.refreshUI()},setParam:function(){var e=this;app.player.sfHtzhShopInfo(function(t,a){if(t)return"not open"==t&&(t="\u6d3b\u52a8\u5df2\u7ed3\u675f"),app.showNotice(t),void e.onClose();eventMgr.emit(eventStr.zhdPage.HTZH_REFRESH_INFO,a)})},refreshUI:function(){if(this.m_objData){this.refreshSView(this.m_objData);var e=this.m_objData[0]&&this.m_objData[0].cost&&this.m_objData[0].cost[0].GSID||30085;this.p_labPrice.string=gUtils.showCoinNum(app.player.getCount(e)),app.loadTexture(gConfig.getCurrencyIconPath(e),this.p_sprIcon)}},refreshSView:function(e){this.m_arrItems||(this.m_arrItems=[],this.m_arrItems.push(this.p_nodeItem));for(var t=0;t<e.length;++t){var a=this.m_arrItems[t];a||((a=cc.instantiate(this.p_nodeItem)).parent=this.p_scrView.content,this.m_arrItems.push(a)),a.active=!0}for(var i=0;i<e.length;++i)this.m_arrItems[i].getComponent("activeHtzhExitItem").initData(e[i],i,this,this.refreshUI);for(var n=e.length;n<this.m_arrItems.length;++n)this.m_arrItems[n].active=!1}});cc._RF.pop()},{basePage:void 0}],activityLdjlPageHtzh:[function(e,t){"use strict";cc._RF.push(t,"9677dr13GNBso/4v1JThNUS","activityLdjlPageHtzh");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activityldjlpagehtzh",pageParent:"activityldjlpage"},properties:{p_labTime:cc.Label,p_btnHelp:cc.Button,p_sprDaoju:cc.Sprite,p_labNum:cc.Label,p_btnAdd:cc.Button,p_btnOne:cc.Button,p_sprIconOne:cc.Sprite,p_labOne:cc.Label,p_nodeSq:cc.Node,p_sprFree:cc.Sprite,p_btnTen:cc.Button,p_sprIconTen:cc.Sprite,p_labTen:cc.Label,p_sprGeneral:cc.Sprite,p_spGeneral:sp.Skeleton,p_animGeneral:cc.Animation,p_scrView:cc.ScrollView,p_nodeItem:cc.Node,p_btnExchange:cc.Button},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(),this.handleUI()},onEnable:function(){this._super(),eventMgr.on(eventStr.commonEvent.RefreshTime,this.refreshTime,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.commonEvent.RefreshTime,this.refreshTime,this)},handleUI:function(){var e=this;this._super(),this.p_btnHelp.node.on("click",function(){app.pages.windowspagetipshelp.showPage(1111)}),this.p_btnAdd.node.on("click",function(){app.pages.activityldjlpage.instance&&app.pages.activityldjlpage.instance.setMenuIndex("SWLB")}),this.p_btnOne.node.on("click",function(){e.extract(1)}),this.p_btnTen.node.on("click",function(){e.extract(10)}),this.p_btnExchange.node.on("click",function(){app.pages.activityldjlpagehtzhexit.showPage()})},extract:function(e){var t=this;gUtils.activityIsOpen(a.SUOXIE,!0)&&(app.player.getCount(this.m_data.gsid)<e&&(0!=app.player.getCount(90593)||1!=e)?app.showNotice(langMgr.getString("activityLdjlPageYhzh",0,app.db.getPropsName(this.m_data.gsid))):app.player.sfHtzhRoll(e,function(a,i){if(a)""==a&&(a="");else{i.global_gifts&&app.setNewRecommendGift(i.global_gifts),0==app.player.getCount(90593)&&1==e?app.player.addItem({gsid:90593,count:1}):app.player.reduceItem({gsid:t.m_data.gsid,count:e}),app.player.addItem(i.reward),app.player.addItem({gsid:90478,count:e}),t.m_data.timenum=i.timenum;var n={showtype:0,reward:i.reward,target:t,againname:e,againcb:t.extract,againparm:[e]};app.pages.windowspagereward.showPage(n),t.refreshIcon(),t.refreshBtnIcon(),eventMgr.emit(eventStr.redEvent.RefreshActivityRed)}}))},setParam:function(e){var t=this;a.SUOXIE=null!=e?e.SUOXIE:"HTZH",this.m_actIndex="HTZH"==a.SUOXIE?0:1,gUtils.activityIsOpen(a.SUOXIE,!0)&&app.player.sfHtzhInfo(function(e,a){e||(t.m_data=a,t.refreshUI())})},refreshUI:function(){this.m_data&&(app.loadGeneral(this.m_data.s_gsid||this.m_data.grid,this.p_sprGeneral,this.p_spGeneral,this.p_animGeneral,null,this.prefabPath),this.refreshTime(),this.refreshIcon(),this.refreshBtnIcon(),this.refreshSView(this.m_data.s_reward))},refreshIcon:function(){var e=app.db.getPropsIconPath(this.m_data.gsid);app.loadTexture(e,this.p_sprDaoju,this.prefabPath),this.p_labNum.string=app.player.getCount(this.m_data.gsid)},refreshSView:function(e){this.m_arrItems||(this.m_arrItems=[],this.m_arrItems.push(this.p_nodeItem));for(var t=0;t<e.length;++t){var a=this.m_arrItems[t];a||((a=cc.instantiate(this.p_nodeItem)).parent=this.p_scrView.content,this.m_arrItems.push(a)),a.getComponent("propItem").initForBag(e[t]),a.getComponent("propItem").setClick(!0),a.active=!0}for(var i=e.length;i<this.m_arrItems.length;++i)this.m_arrItems[i].active=!1},refreshBtnIcon:function(){if(app.player.getCount(90593)>0){this.p_sprFree.node.active=!1,this.p_nodeSq.active=!0;var e=app.db.getPropsIconPath(this.m_data.items[0].item.gsid);app.loadTexture(e,this.p_sprIconOne,this.prefabPath),this.p_labOne.string=this.m_data.items[0].item.count}else this.p_sprFree.node.active=!0,this.p_nodeSq.active=!1;var t=app.db.getPropsIconPath(this.m_data.items[1].item.gsid);app.loadTexture(t,this.p_sprIconTen,this.prefabPath),this.p_labTen.string=this.m_data.items[1].item.count},refreshTime:function(){var e=app.player.getServerTime(),t=gUtils.getActivityArrTime(a.SUOXIE)[1]||0,i=t-e;(!t||i<0)&&(i=0),this.p_labTime.string=0!=i?gUtils.getCountDownStr(i):"00:00:00"}});a.SUOXIE="HTZH",a.refreshRed=function(e){var t;return t=app.player.getCount(30097)>0||app.player.getCount(90593)<=0,e&&(e.active=t),t},cc._RF.pop()},{basePage:void 0}],activityLdjlPageHyhl:[function(e,t){"use strict";cc._RF.push(t,"f3fc960+uVFP4wV+Bdt+nQR","activityLdjlPageHyhl");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activityldjlpagehyhl",pageParent:"activityldjlpage"},properties:{p_scrView:cc.ScrollView,p_nodeItem:cc.Node,p_labTime:cc.Label,p_btnHelp:cc.Button,p_sprBanner:cc.Sprite,p_arrSprBanner:[cc.SpriteFrame]},onLoad:function(){a.instance=this,this.schedule(this.refreshTime,1),this.stopBgNodeEvent(),this.creatMask(),this.p_btnHelp.node.on("click",function(){app.pages.windowspagetipshelp.showPage(1076)})},setParam:function(e){var t=this;a.SUOXIE=null!=e?e.SUOXIE:"HYHL",this.m_actIndex="HYHL"==a.SUOXIE?0:1,gUtils.activityIsOpen(a.SUOXIE,!0)&&app.player.sfHyhlInfo(this.m_actIndex,function(e,a){e||(t.m_total=a.total,t.m_arrData=a.item,t.refreshUI())})},refreshUI:function(){this.m_arrData&&(this.refreshSView(this.m_arrData),this.refreshTime(),this.refreshSprBanner(),eventMgr.emit(eventStr.redEvent.RefreshActivityRed))},refreshSprBanner:function(){this.p_sprBanner.spriteFrame=this.p_arrSprBanner[this.m_actIndex]},refreshTime:function(){var e=app.player.getServerTime(),t=gUtils.getActivityArrTime(a.SUOXIE)[1]||0,i=t-e;(!t||i<0)&&(i=0),this.p_labTime.string=0!=i?gUtils.getCountDownStr(i):"00:00:00"},refreshSView:function(e){this.m_arrItems||(this.m_arrItems=[],this.m_arrItems.push(this.p_nodeItem));for(var t=0;t<e.length;++t){e[t].total=this.m_total;var a=this.m_arrItems[t];a||((a=cc.instantiate(this.p_nodeItem)).parent=this.p_scrView.content,this.m_arrItems.push(a)),a.active=!0}for(var i=0;i<e.length;++i)this.m_arrItems[i].getComponent("activityLdjlHyhlItem").refreshUI(this.m_actIndex,e[i],i,this);for(var n=e.length;n<this.m_arrItems.length;++n)this.m_arrItems[n].active=!1}});a.SUOXIE="HYHL",a.refreshRed=function(e,t){var a=!1,i=app.getRedInfoByObj(["act",t.toLowerCase()],null);return null!=i&&(a=i>0),e&&(e.active=a),a},cc._RF.pop()},{basePage:void 0}],activityLdjlPageJhlb:[function(e,t){"use strict";cc._RF.push(t,"14f683KmPhLX4hl436tRvmt","activityLdjlPageJhlb");var a=cc.Class({extends:e("basePage"),properties:{p_btnUp:cc.Button,p_btnDown:cc.Button,p_sprUpIcon:cc.Sprite,p_labUpPrice:cc.Label,p_sprDownIcon:cc.Sprite,p_labDownPrice:cc.Label,p_timesUp:cc.Label,p_timesDown:cc.Label,p_nodeUpOver:cc.Node,p_nodeDownOver:cc.Node,p_nodeUpPrice:cc.Node,p_nodeDownPrice:cc.Node,p_labTime:cc.Label,p_btnHelp:cc.Button,p_arrBox:[cc.Node],p_labUpdata:cc.Label,p_pfItem:cc.Prefab,p_nodeUpContent:cc.Node,p_nodeDownContent:cc.Node},statics:{prefabPath:"activityldjlpagejhlb",pageParent:"activityldjlpage"},onEnable:function(){this._super(),eventMgr.on(eventStr.commonEvent.RefreshTime,this.refreshTime,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.commonEvent.RefreshTime,this.refreshTime,this)},onLoad:function(){var e=this;a.instance=this,this.stopBgNodeEvent(),this.p_btnHelp.node.on("click",function(){app.pages.windowspagetipshelp.showPage(1078)}),this.p_btnDown.node.on("click",function(){var t={rewards:e.m_showData[0].items,title:langMgr.getString("activityLdjlPageJhlb",2),limitNum:e.m_showData[0].buytime,buycb:function(){e.onClickBuy(0)},cancelcb:function(){},target:e};app.pages.windowspagerechargebuy.showPage(t)}),this.p_btnUp.node.on("click",function(){var t={rewards:e.m_showData[1].items,title:langMgr.getString("activityLdjlPageJhlb",2),limitNum:e.m_showData[1].buytime,buycb:function(){e.onClickBuy(1)},cancelcb:function(){},target:e};app.pages.windowspagerechargebuy.showPage(t)}),this.p_arrBox.forEach(function(t,a){t.on("touchend",function(){app.pages.windowspagetipsrewards.showPage(e.m_showData[a].items)})})},setParam:function(e){var t=this;app.arrRed.jhlb=!0,a.SUOXIE=null!=e?e.SUOXIE:"JHLB",this.m_actIndex="JHLB"==a.SUOXIE?0:1,app.player.sfJhlbList(this.m_actIndex,function(e,a){if(!e){t.m_data=a,t.m_showData=[];for(var i=0;i<t.m_data.length;i++)t.m_data[i].index=i,1==t.m_data[i].isshow&&t.m_showData.push(t.m_data[i]);t.refreshUI()}})},refreshArrIcon:function(){for(var e=0;e<this.m_showData[0].items.length;e++){var t=this.m_showData[0].items[e],a=this.p_nodeDownContent.children[e];a||((a=cc.instantiate(this.p_pfItem)).scale=.8,a.parent=this.p_nodeDownContent),a.active=!0,a.getComponent("propItem").initForBag(t),a.getComponent("propItem").setClick(!0)}for(var i=this.m_showData[0].items.length;i<this.p_nodeDownContent.children.length;i++)this.p_nodeDownContent.children[i].active=!1;for(var n=0;n<this.m_showData[1].items.length;n++){var r=this.m_showData[1].items[n],o=this.p_nodeUpContent.children[n];o||((o=cc.instantiate(this.p_pfItem)).scale=.8,o.parent=this.p_nodeUpContent),o.active=!0,o.getComponent("propItem").initForBag(r),o.getComponent("propItem").setClick(!0)}for(var s=this.m_showData[1].items.length;s<this.p_nodeUpContent.children.length;s++)this.p_nodeUpContent.children[s].active=!1},refreshUI:function(){if(this.p_btnUp.interactable=this.m_showData[1].buytime>0,this.p_nodeUpOver.active=!(this.m_showData[1].buytime>0),this.p_nodeUpPrice.active=this.m_showData[1].buytime>0,this.p_timesUp.node.active=this.m_showData[1].buytime>0,this.p_btnDown.interactable=this.m_showData[0].buytime>0,this.p_nodeDownPrice.active=this.m_showData[0].buytime>0,this.p_nodeDownOver.active=!(this.m_showData[0].buytime>0),this.p_timesDown.node.active=this.m_showData[0].buytime>0,this.p_timesDown.string=langMgr.getString("activityLdjlPageJhlb",1,this.m_showData[0].buytime),this.p_timesUp.string=langMgr.getString("activityLdjlPageJhlb",1,this.m_showData[1].buytime),this.m_showData[0].price)this.p_labDownPrice.string="\xa5"+this.m_showData[0].price,this.p_sprDownIcon.node.active=!1;else{this.p_sprDownIcon.node.active=!0;var e=app.db.getPropsIconPath(this.m_showData[0].cost[0].GSID);app.loadTexture(e,this.p_sprDownIcon,this.prefabPath),this.p_labDownPrice.string=this.m_showData[0].cost[0].COUNT}if(this.m_showData[1].price)this.p_labUpPrice.string="\xa5"+this.m_showData[1].price,this.p_sprUpIcon.node.active=!1;else{this.p_sprUpIcon.node.active=!0;var t=app.db.getPropsIconPath(this.m_showData[1].cost[0].GSID);app.loadTexture(t,this.p_sprUpIcon,this.prefabPath),this.p_labUpPrice.string=this.m_showData[1].cost[0].COUNT}this.refreshArrIcon(),this.refreshTime()},refreshTime:function(){var e=app.player.getServerTime(),t=gUtils.getActivityArrTime(a.SUOXIE)[1]||0,i=t-e;(!t||i<0)&&(i=0),this.p_labTime.string=0==i?"00:00:00":gUtils.getCountDownStr(i);var n=gUtils.getTimeByDay(app.player.getServerTime(),1)-e;n<0&&(n=0),this.p_labUpdata.string=0!=n?gUtils.getCountDownStr(n):"00:00:00"},onClickBuy:function(e){var t=this;if(this.m_showData[e].price)app.player.payJhlb(this.m_actIndex,this.m_showData[e].index,this.m_showData[e].price,function(){t._payRefreshEnd=!1;var i={showtype:1,reward:t.m_showData[e].items,target:t};app.pages.windowspagereward.showPage(i),t.m_showData[e].buytime-=1,app.getRedInfoByObj(["act",a.SUOXIE.toLowerCase()],0)>=1&&(app.redDataServer.act[a.SUOXIE.toLowerCase()]-=1),eventMgr.emit(eventStr.commonEvent.RefershActivityZhdCoinUi),t.payRefresh(),t.schedule(t.payRefresh,1,3)},function(){app.showNotice(langMgr.getString("activityLdjlPageJhlb",0))});else{if(!app.player.checkCount(this.m_showData[e].cost[0].GSID,this.m_showData[e].cost[0].COUNT))return;app.player.sfJhlbybbuy(this.m_actIndex,this.m_showData[e].index,function(i){if(t._payRefreshEnd=!1,!i){var n={showtype:1,reward:t.m_showData[e].items,target:t};app.pages.windowspagereward.showPage(n),t.m_showData[e].buytime-=1,eventMgr.emit(eventStr.commonEvent.RefershActivityZhdCoinUi),app.getRedInfoByObj(["act",a.SUOXIE.toLowerCase()],0)>=1&&(app.redDataServer.act[a.SUOXIE.toLowerCase()]-=1),t.payRefresh(),t.schedule(t.payRefresh,1,3)}})}},payRefresh:function(){var e=this;this._payRefreshEnd||app.player.sfPlayerByParam(["others","vip","hide","bagspace","props"],function(){e._payRefreshEnd=!0,eventMgr.emit(eventStr.commonEvent.RefershActivityZhdCoinUi),e.refreshUI()})}});a.SUOXIE="JHLB",a.refreshRed=function(){return!1},cc._RF.pop()},{basePage:void 0}],activityLdjlPageJthl:[function(e,t){"use strict";cc._RF.push(t,"169dd/1xgpPyb8Dc4K9QB8f","activityLdjlPageJthl");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activityldjlpagejthl",pageParent:"activityldjlpage"},properties:{p_scrView:cc.ScrollView,p_nodeItem:cc.Node,p_labTime:cc.Label,p_btnHelp:cc.Button},onLoad:function(){a.instance=this,this.schedule(this.refreshTime,1),this.stopBgNodeEvent(),this.creatMask(),this.p_btnHelp.node.on("click",function(){app.pages.windowspagetipshelp.showPage(1075)})},setParam:function(){var e=this;app.player.sfJthlInfo(function(t,a){t||(e.m_arrData=a,e.refreshUI())})},refreshUI:function(){this.m_arrData&&(this.refreshSView(this.m_arrData),this.refreshTime(),eventMgr.emit(eventStr.redEvent.RefreshActivityRed))},refreshTime:function(){var e=app.player.getServerTime(),t=gUtils.getActivityArrTime("JTHL")[1]||0,a=t-e;(!t||a<0)&&(a=0),this.p_labTime.string=0!=a?gUtils.getCountDownStr(a):"00:00:00"},refreshSView:function(e){this.m_arrItems||(this.m_arrItems=[],this.m_arrItems.push(this.p_nodeItem));for(var t=0;t<e.length;++t){var a=this.m_arrItems[t];a||((a=cc.instantiate(this.p_nodeItem)).parent=this.p_scrView.content,this.m_arrItems.push(a)),a.active=!0}for(var i=0;i<e.length;++i)this.m_arrItems[i].getComponent("activityLdjlJthlItem").refreshUI(e[i],i,this);for(var n=e.length;n<this.m_arrItems.length;++n)this.m_arrItems[n].active=!1}});a.refreshRed=function(e){var t=!1,a=app.getRedInfoByObj(["act","jthl"],null);return null!=a&&(t=a>0),e&&(e.active=t),t},cc._RF.pop()},{basePage:void 0}],activityLdjlPageLdcf:[function(e,t){"use strict";cc._RF.push(t,"42dc2vQYb9Ob4s8czrhpZhc","activityLdjlPageLdcf");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activityldjlpageldcf"},properties:{p_btnGoto:cc.Button,p_btnBuy:cc.Button,p_nodeItem:cc.Node,p_layout:cc.Layout,p_btnHelp:cc.Button,p_labTime:cc.Label,p_sprHeroZy:cc.Sprite,p_sprHeroXj:cc.Sprite},onLoad:function(){a.instance=this,this.schedule(this.refreshTime,1),this.stopBgNodeEvent(),this.creatMask(),this.handleUI()},handleUI:function(){this.p_btnGoto.node.on("click",function(){app.playSound("click"),app.goToPage(1005)}),this.p_btnBuy.node.on("click",function(){app.playSound("click"),gUtils.activityIsOpen("LDCF",!0)&&app.player.sfLdcfReward(function(){})}),this.p_btnHelp.node.on("click",function(){})},setParam:function(){var e=this;gUtils.activityIsOpen("LDCF",!0)&&app.player.sfLdcfInfo(function(t,a){t||(e.m_data=a,e.refreshUI())})},refreshUI:function(){this.m_data&&(this.upActLayout(),this.refreshTime(),this.refreshHero())},refreshHero:function(){var e=app.db.getGBaseByGsid(this.m_data.gsid);if(e){var t=gConfig.getIconGStarPath(e.STAR-1);app.loadTexture(t,this.p_sprHeroXj,this.prefabPath);var a=gConfig.getIconGOccuPath(e.OCCU-1);app.loadTexture(a,this.p_sprHeroZy,this.prefabPath)}else cc.error("activityZhdPageZmzf refreshHero error gsid")},upActLayout:function(){var e=this.m_data.items;if(null!=e){this.m_arrItems||(this.m_arrItems=[],this.m_arrItems.push(this.p_nodeItem));for(var t=0;t<e.length;++t){var a=this.m_arrItems[t];a||((a=cc.instantiate(this.p_nodeItem)).parent=this.p_layout.node,this.m_arrItems.push(a)),a.active=!0,a.getComponent("propItem").initForBag(e[t]),a.getComponent("propItem").setClick(!0)}for(var i=e.length;i<this.m_arrItems.length;++i)this.m_arrItems[i].active=!1}},refreshTime:function(){var e=app.player.getServerTime(),t=gUtils.getActivityArrTime("LDCF")[1]||0,a=t-e;(!t||a<0)&&(a=0),this.p_labTime.string=0!=a?gUtils.getCountDownStr(a):"00:00:00"}});a.refreshRed=function(){return!1},cc._RF.pop()},{basePage:void 0}],activityLdjlPageLdzh:[function(e,t){"use strict";cc._RF.push(t,"f0359Ocor5NSIgy/cp/JLep","activityLdjlPageLdzh");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activityldjlpageldzh",pageParent:"activityldjlpage"},properties:{p_labTime:cc.Label,p_btnHelp:cc.Button,p_sprDaoju:cc.Sprite,p_labNum:cc.Label,p_btnAdd:cc.Button,p_sprBg:cc.Sprite,p_arrSprBg:[cc.SpriteFrame],p_sprName:cc.Sprite,p_arrSprName:[cc.SpriteFrame],p_sprTalk:cc.Sprite,p_arrSprTalk:[cc.SpriteFrame],p_btnOne:cc.Button,p_sprIconOne:cc.Sprite,p_labOne:cc.Label,p_nodeSq:cc.Node,p_sprFree:cc.Sprite,p_btnTen:cc.Button,p_sprIconTen:cc.Sprite,p_labTen:cc.Label,p_nodeProp:cc.Node,p_labBuyTime:cc.Label,p_sprGeneral:cc.Sprite,p_spGeneral:sp.Skeleton,p_animGeneral:cc.Animation},onLoad:function(){a.instance=this,this.schedule(this.refreshTime,1),this.stopBgNodeEvent(),this.dismissAssemble=[],this.creatMask(),this.handleUI()},handleUI:function(){var e=this;this._super(),this.p_btnHelp.node.on("click",function(){app.pages.windowspagetipshelp.showPage("1063")}),this.p_btnAdd.node.on("click",function(){app.pages.activityldjlpage.instance&&app.pages.activityldjlpage.instance.setMenuIndex("SWLB")}),this.p_btnOne.node.on("click",function(){e.extract(1)}),this.p_btnTen.node.on("click",function(){e.extract(10)})},extract:function(e){var t=this;if(gUtils.activityIsOpen(a.SUOXIE,!0))if(app.player.getCount(this.m_data.gsid)<e&&(0!=app.player.getCount(90481)||1!=e))app.showNotice(langMgr.getString("activityLdjlPageLdzh",0,app.db.getPropsName(this.m_data.gsid)));else if(app.player.gnum+e>app.player.bagspace){var i={content:langMgr.getString("activityLdjlPageLdzh",1),confirmcb:function(){app.goToPage(1018)},target:this};app.pages.windowspagetipsmsg.showPage(i)}else app.player.sfAtyzmRecruit(e,function(a,i){if(a)""==a&&(a="");else{var n=[];i.global_gifts&&app.setNewRecommendGift(i.global_gifts);for(var r=0;r<i.generals.length;r++)i.generals[r],n.push({GSID:i.generals[r].gsid,COUNT:1});app.player.sfPlayerByParam(["others"],function(){var a={showtype:0,reward:n,target:t,againname:e,againcb:t.extract,againparm:[e]};app.pages.windowspagereward.showPage(a),t.m_data.timenum=t.m_data.timenum-e,t.m_data.timenum<=0&&(t.m_data.timenum=0,t.setParam());for(var i=0;i<n.length;i++)if(n[i].GSID==t.m_data.grid){t.setParam();break}t.refreshIcon(),t.refreshBtnIcon(),eventMgr.emit(eventStr.redEvent.RefreshActivityRed)}),t.dismissAssemble=[]}})},setParam:function(e){var t=this;a.SUOXIE=null!=e?e.SUOXIE:"ATYZM",this.m_actIndex="ATYZM"==a.SUOXIE?0:1,gUtils.activityIsOpen(a.SUOXIE,!0)&&app.player.sfAtyzmInfo(this.m_actIndex,function(e,a){e||(t.m_data=a,t.refreshUI())})},refreshUI:function(){this.m_data&&(app.loadGeneral(this.m_data.s_gsid||this.m_data.grid,this.p_sprGeneral,this.p_spGeneral,this.p_animGeneral,null,this.prefabPath),this.p_sprBg.spriteFrame=this.p_arrSprBg[this.m_actIndex],this.p_sprName.spriteFrame=this.p_arrSprName[this.m_actIndex],this.p_sprTalk.spriteFrame=this.p_arrSprTalk[this.m_actIndex],this.refreshTime(),this.refreshIcon(),this.refreshBtnIcon())},refreshIcon:function(){var e=app.db.getPropsIconPath(this.m_data.gsid);app.loadTexture(e,this.p_sprDaoju,this.prefabPath),this.p_labNum.string=app.player.getCount(this.m_data.gsid),this.p_nodeProp.getComponent("propItem").initForGsid(this.m_data.grid),this.p_labBuyTime.string=this.m_data.timenum},refreshBtnIcon:function(){if(app.player.getCount(90481)>0){this.p_sprFree.node.active=!1,this.p_nodeSq.active=!0;var e=app.db.getPropsIconPath(this.m_data.items[0].item.gsid);app.loadTexture(e,this.p_sprIconOne,this.prefabPath),this.p_labOne.string=this.m_data.items[0].item.count}else this.p_sprFree.node.active=!0,this.p_nodeSq.active=!1;var t=app.db.getPropsIconPath(this.m_data.items[1].item.gsid);app.loadTexture(t,this.p_sprIconTen,this.prefabPath),this.p_labTen.string=this.m_data.items[1].item.count},refreshTime:function(){var e=app.player.getServerTime(),t=gUtils.getActivityArrTime(a.SUOXIE)[1]||0,i=t-e;(!t||i<0)&&(i=0),this.p_labTime.string=0!=i?gUtils.getCountDownStr(i):"00:00:00"}});a.SUOXIE="ATYZM",a.refreshRed=function(e){var t;return t=app.player.getCount(30045)>0||app.player.getCount(90481)<=0,e&&(e.active=t),t},cc._RF.pop()},{basePage:void 0}],activityLdjlPageLjcz:[function(e,t){"use strict";cc._RF.push(t,"16fd5TrYEFPZqaR7exAGR3F","activityLdjlPageLjcz");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activityldjlpageljcz",pageParent:"activityldjlpage"},properties:{p_scrView:cc.ScrollView,p_nodeItem:cc.Node,p_labTime:cc.Label,p_btnHelp:cc.Button},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(),this.p_btnHelp.node.on("click",function(){app.pages.windowspagetipshelp.showPage(1065)})},onEnable:function(){this._super(),eventMgr.on(eventStr.commonEvent.RefreshTime,this.refreshTime,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.commonEvent.RefreshTime,this.refreshTime,this)},setParam:function(e){var t=this;this.m_strActivitySign||(e=e||{},this.m_strActivitySign=e.type||"LJCZ"),gUtils.activityIsOpen(this.m_strActivitySign,!0)&&("LJCZ"==this.m_strActivitySign?this.m_actIndex=0:"LJCZ1"==this.m_strActivitySign?this.m_actIndex=1:this.m_actIndex=2,app.player.sfLjczInfo(this.m_actIndex,function(e,a){if(!e){t.m_arrData=a,console.log(t.m_arrData),app.actLjcz=a,t.canGetNum=0;for(var i=0;i<t.m_arrData.length;i++)1==t.m_arrData[i].status&&t.canGetNum++;var n=t.m_strActivitySign.toLowerCase();app.redDataServer.act&&(app.redDataServer.act[n]=t.canGetNum),t.refreshUI()}}))},refreshUI:function(){this.m_arrData&&(this.refreshSView(this.m_arrData),this.refreshTime(),eventMgr.emit(eventStr.redEvent.RefreshActivityRed))},refreshTime:function(){var e=app.player.getServerTime(),t=gUtils.getActivityArrTime(this.m_strActivitySign)[1]||0,a=t-e;(!t||a<0)&&(a=0),this.p_labTime.string=0!=a?gUtils.getCountDownStr(a):"00:00:00"},refreshSView:function(e){this.m_arrItems||(this.m_arrItems=[],this.m_arrItems.push(this.p_nodeItem));for(var t=0;t<e.length;++t){var a=this.m_arrItems[t];a||((a=cc.instantiate(this.p_nodeItem)).parent=this.p_scrView.content,this.m_arrItems.push(a)),a.active=!0}for(var i=0;i<e.length;++i)this.m_arrItems[i].getComponent("activityLdjlLjczItem").refreshUI(e[i],i,this,this.setParam,this.m_strActivitySign,this.m_actIndex);for(var n=e.length;n<this.m_arrItems.length;++n)this.m_arrItems[n].active=!1}});a.isOpen=function(){return!!(gUtils.activityIsOpen("LJCZ")||gUtils.activityIsOpen("LJCZ1")||gUtils.activityIsOpen("LJCZ2"))&&!!app.db.checkFuncUnLock("ACTIVITY_ZHD")},a.refreshRed=function(e){var t=!1,a="ljcz";gUtils.activityIsOpen("LJCZ1")?a="ljcz1":gUtils.activityIsOpen("LJCZ2")&&(a="ljcz2");var i=app.getRedInfoByObj(["act",a],null);return null!=i&&(t=i>0),e&&(e.active=t),t},cc._RF.pop()},{basePage:void 0}],activityLdjlPageLjdl:[function(e,t){"use strict";cc._RF.push(t,"0dae56uqVxPK7M1kQILOQEn","activityLdjlPageLjdl");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activityldjlpageljdl",pageParent:"activityldjlpage"},properties:{p_scrView:cc.ScrollView,p_nodeItem:cc.Node,p_labTime:cc.Label},onLoad:function(){a.instance=this,this.schedule(this.refreshTime,1),this.stopBgNodeEvent(),this.creatMask()},setParam:function(){var e=this;gUtils.activityIsOpen("LJDL",!0)&&app.player.sfLjdlInfo("ljdl",function(t,a){if(!t){e.m_arrData=a,e.canGetNum=0;for(var i=0;i<e.m_arrData.length;i++)1==e.m_arrData[i].status&&e.canGetNum++;app.redDataServer.act&&(app.redDataServer.act.ljdl=e.canGetNum),e.refreshUI()}})},refreshUI:function(){this.m_arrData&&(this.refreshSView(this.m_arrData),this.refreshTime(),eventMgr.emit(eventStr.redEvent.RefreshActivityRed))},refreshTime:function(){var e=app.player.getServerTime(),t=gUtils.getActivityArrTime("LJDL")[1]||0,a=t-e;(!t||a<0)&&(a=0),this.p_labTime.string=0!=a?gUtils.getCountDownStr(a):"00:00:00"},refreshSView:function(e){this.m_arrItems||(this.m_arrItems=[],this.m_arrItems.push(this.p_nodeItem));for(var t=0;t<e.length;++t){var a=this.m_arrItems[t];a||((a=cc.instantiate(this.p_nodeItem)).parent=this.p_scrView.content,this.m_arrItems.push(a)),a.active=!0}for(var i=0;i<e.length;++i)this.m_arrItems[i].getComponent("activityLdjlLjdlItem").refreshUI(e[i],i,this,this.setParam);for(var n=e.length;n<this.m_arrItems.length;++n)this.m_arrItems[n].active=!1}});a.refreshRed=function(e){var t=!1,a=app.getRedInfoByObj(["act","ljdl"],null);return null!=a&&(t=a>0),e&&(e.active=t),t},cc._RF.pop()},{basePage:void 0}],activityLdjlPageSslx:[function(e,t){"use strict";cc._RF.push(t,"5c5b8I8J7RBk4GxswdFFZNF","activityLdjlPageSslx");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activityldjlpagesslx",pageParent:"activityldjlpage"},properties:{p_btnSource:cc.Button,p_labScore:cc.Label,p_btnHelp:cc.Button,p_labTime:cc.Label,p_sprYs:cc.Sprite,p_progBar:cc.ProgressBar,p_nodeQilin:cc.Node,p_arrBoss:[cc.Node],p_arrBossSmall:[cc.Node],p_arrLabTalk:[cc.Label],p_labProgTitle_0:cc.Label,p_progLy_0:cc.ProgressBar,p_labProgNum_0:cc.Label,p_labProgTitle_1:cc.Label,p_progLy_1:cc.ProgressBar,p_labProgNum_1:cc.Label,p_btnGoto:cc.Button},onLoad:function(){a.instance=this,this.schedule(this.refreshTime,1),this.handleUI()},handleUI:function(){var e=this;this.p_arrBoss.forEach(function(t,a){t.on("touchend",function(){e.onClickBoss(a)})}),this.p_nodeQilin.on("touchend",function(){e.onClickBoss(4)}),this.p_btnHelp.node.on("click",function(){app.playSound("click"),app.pages.windowspagetipshelp.showPage(1064)}),this.p_btnSource.node.on("click",function(){a.isOpen(!0)&&(app.playSound("click"),app.pages.windowspageactivesource.showPage({title:langMgr.getString("activityLdjlPageSslx",7),event:e.m_eventData}))}),this.p_sprYs.node.on("touchend",function(){app.playSound("click"),app.showPropTips({gsid:90478,type:"tips"})}),this.p_btnGoto.node.on("click",function(){app.playSound("click"),app.pages.activityldjlpage.instance&&app.pages.activityldjlpage.instance.setMenuIndex("YHZH")})},setParam:function(){var e=this;a.isOpen(!0)&&(app.ldjltx="sslx",app.player.sfGetTnqwInfo(function(t,a){t||(e.m_bossData=a.bosslist,e.m_eventData=a.event,e.refreshUI())}))},refreshUI:function(){this.m_bossData&&this.m_eventData&&(this.m_numTotalScore=this.getTotalScore(),this.p_labScore.string=this.m_numTotalScore,this.m_numMaxScore=this.getMaxScore(),this.refreshTime(),this.refreshArrBoss(),this.refreshArrBossSamll(),this.refreshArrLabTalk(),this.refreshYsProg(),this.refreshArrLy())},refreshArrLy:function(){for(var e=0;e<this.m_eventData.length;e++){var t=this.m_eventData[e];this["p_labProgTitle_"+e].string=t.intro;var a=app.player.getCount(t.mark);a=Math.min(a,t.limit),this["p_progLy_"+e].progress=a/t.limit,this["p_labProgNum_"+e].string=a+"/"+t.limit}},refreshArrBoss:function(){var e=this;this.p_arrBoss.forEach(function(t,a){var i=e.m_bossData[a],n=t.getChildByName("spr_shackles"),r=t.getChildByName("shengshotex");n&&(n.active=2!=i.status),r&&(r.active=2==i.status);var o=t.getChildByName("spr_bg_01"),s=t.getChildByName("spr_icon"),p=t.getChildByName("spr_lock"),c=t.getChildByName("progHp"),h=t.getChildByName("bar"),l=t.getChildByName("spr_bg_02"),g=t.getChildByName("lab_num_ys"),d=t.getChildByName("spr_jisha");switch(i.status){case 0:app.setSpriteState(o.getComponent(cc.Sprite),!0),app.setSpriteState(s.getComponent(cc.Sprite),!0),c.active=!1,h.active=!1,p.active=!0,l&&(l.active=!0),g&&(g.active=!0),g&&(g.getComponent(cc.Label).string=langMgr.getString("activityLdjlPageSslx",6,i.actscore)),d.active=!1;break;case 1:app.setSpriteState(o.getComponent(cc.Sprite),!1),app.setSpriteState(s.getComponent(cc.Sprite),!1),c.active=!0,h.active=!0;var u=i.nowhp&&i.maxhp?i.nowhp/i.maxhp:1;c.getComponent(cc.ProgressBar).progress=u,p.active=!1,l&&(l.active=!0),g&&(g.active=!0),g&&(g.getComponent(cc.Label).string=langMgr.getString("activityLdjlPageSslx",4)),d.active=!1;break;case 2:app.setSpriteState(o.getComponent(cc.Sprite),!1),app.setSpriteState(s.getComponent(cc.Sprite),!0),c.active=!0,h.active=!0,c.getComponent(cc.ProgressBar).progress=0,p.active=!1,l&&(l.active=!1),g&&(g.active=!1),d.active=!0}})},refreshArrBossSamll:function(){var e=this;this.p_arrBossSmall.forEach(function(t,a){var i=e.m_bossData[a];app.setSpriteState(t.getComponent(cc.Sprite),0==i.status)})},refreshArrLabTalk:function(){var e=this;this.p_arrLabTalk.forEach(function(t,a){var i=e.m_bossData[a];switch(i.status){case 0:t.string=e.m_numTotalScore+"/"+i.actscore;break;case 1:t.string=langMgr.getString("activityLdjlPageSslx",4);break;case 2:t.string=langMgr.getString("activityLdjlPageSslx",5)}})},refreshYsProg:function(){this.p_progBar&&(this.p_progBar.progress=this.m_numTotalScore/this.m_numMaxScore)},refreshTime:function(){var e=app.player.getServerTime(),t=gUtils.getActivityArrTime("SSLX")[1]||0,a=t-e;(!t||a<0)&&(a=0),this.p_labTime.string=0!=a?gUtils.getCountDownStr(a):"00:00:00"},onClickBoss:function(e){var t=this;if(a.isOpen(!0)&&this.m_bossData&&this.m_bossData[e])switch(this.m_bossData[e].status){case 0:app.pages.windowspagetipsrewards.showPage(this.m_bossData[e].rewardgsids);break;case 1:app.player.sfGetTnqwBossInfo(e,function(a,i){if(a)"fn freeze"==a&&app.showNotice(langMgr.getString("activityLdjlPageSslx",1));else{i.rewards=i.killrewards;var n={boss:i,index:e,type:4,target:t,confirmcb:t.getNewData};app.pages.bigbattlebossinfopage.showPage(n)}});break;case 2:app.showNotice(langMgr.getString("activityLdjlPageSslx",2))}},getTotalScore:function(){for(var e=0,t=0;t<this.m_eventData.length;++t){var a=this.m_eventData[t],i=app.player.getCount(a.mark);e+=i=Math.min(i,a.limit)}return e},getMaxScore:function(){for(var e=0,t=0;t<this.m_eventData.length;++t)e+=this.m_eventData[t].limit;return e}});a.refreshRed=function(e){var t=!1,a=app.getRedInfoByObj(["act","sslx"],null);return null!=a&&(t=a>0),e&&(e.active=t),t},a.isOpen=function(e){var t=gUtils.getActivityArrTime("SSLX");return!(app.player.getServerTime()>t[1]&&(e&&app.showNotice(langMgr.getString("activityLdjlPageSslx",3)),1))},cc._RF.pop()},{basePage:void 0}],activityLdjlPageSwlb:[function(e,t){"use strict";cc._RF.push(t,"9abaewsUB1MMparwR2XePbA","activityLdjlPageSwlb");var a=cc.Class({extends:e("basePage"),properties:{p_scrView:cc.ScrollView,p_nodeItem:cc.Node,p_btnHelp:cc.Button,p_labTime:cc.Label},statics:{prefabPath:"activityldjlpageswlb",pageParent:"activityldjlpage"},onLoad:function(){a.instance=this,this.stopBgNodeEvent()},onEnable:function(){this._super(),eventMgr.on(eventStr.commonEvent.RefreshTime,this.refreshTime,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.commonEvent.RefreshTime,this.refreshTime,this)},setParam:function(e){var t=this;a.SUOXIE=null!=e?e.SUOXIE:"SWLB",this.m_actIndex="SWLB"==a.SUOXIE?0:1,app.arrRed.swlb=!0,app.player.sfSwlbList(this.m_actIndex,function(e,a){e||(t.m_data=a,t.refreshUI())})},refreshUI:function(){if(this.m_data){for(var e=[],t=[],a=0;a<this.m_data.length;++a){var i=this.m_data[a];i.index=a,i.buytime>0?e.push(i):t.push(i)}e=e.concat(t),this.refreshSView(e),this.refreshTime()}},refreshSprBanner:function(){},refreshSView:function(e){this.m_arrItems||(this.m_arrItems=[],this.m_arrItems.push(this.p_nodeItem));for(var t=0;t<e.length;++t){var a=this.m_arrItems[t];a||((a=cc.instantiate(this.p_nodeItem)).parent=this.p_scrView.content,this.m_arrItems.push(a)),a.active=!0;var i={data:e[t],target:this,canfram:this.refreshUI,actIndex:this.m_actIndex};a.getComponent("activityLdjlSwlbItem").refreshUI(i)}for(var n=e.length;n<this.m_arrItems.length;++n)this.m_arrItems[n].active=!1},refreshTime:function(){var e=app.player.getServerTime(),t=gUtils.getActivityArrTime(a.SUOXIE)[1]||0,i=t-e;(!t||i<0)&&(i=0),this.p_labTime.string=0!=i?gUtils.getCountDownStr(i):"00:00:00"}});a.SUOXIE="SWLB",a.refreshRed=function(){return!1},cc._RF.pop()},{basePage:void 0}],activityLdjlPageYhsh:[function(e,t){"use strict";cc._RF.push(t,"c5f7c47Z1xDrpHU6dYrQDgK","activityLdjlPageYhsh");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activityldjlpageyhsh",pageParent:"activityldjlpage"},properties:{p_scrView:cc.ScrollView,p_nodeItem:cc.Node,p_labTime:cc.Label,p_btnHelp:cc.Button},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(),this.p_btnHelp.node.on("click",function(){app.pages.windowspagetipshelp.showPage(1079)})},onEnable:function(){this._super(),eventMgr.on(eventStr.commonEvent.RefreshTime,this.refreshTime,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.commonEvent.RefreshTime,this.refreshTime,this)},setParam:function(e){var t=this;a.SUOXIE=null!=e?e.SUOXIE:"YHSH",this.m_actIndex="YHSH"==a.SUOXIE?0:1,app.player.sfYhshInfo(this.m_actIndex,function(e,i){if(!e){t.m_arrData=i,t.canGetNum=0;for(var n=0;n<t.m_arrData.length;n++)1==t.m_arrData[n].status&&t.canGetNum++;app.redDataServer.act[a.SUOXIE.toLowerCase()]=t.canGetNum,t.refreshUI()}})},refreshUI:function(){this.m_arrData&&(this.refreshSView(this.m_arrData),this.refreshTime(),eventMgr.emit(eventStr.redEvent.RefreshActivityRed))},refreshTime:function(){var e=app.player.getServerTime(),t=gUtils.getActivityArrTime(a.SUOXIE)[1]||0,i=t-e;(!t||i<0)&&(i=0),this.p_labTime.string=0!=i?gUtils.getCountDownStr(i):"00:00:00"},refreshSView:function(e){this.m_arrItems||(this.m_arrItems=[],this.m_arrItems.push(this.p_nodeItem));for(var t=0;t<e.length;++t){var a=this.m_arrItems[t];a||((a=cc.instantiate(this.p_nodeItem)).parent=this.p_scrView.content,this.m_arrItems.push(a)),a.active=!0}for(var i=0;i<e.length;++i)this.m_arrItems[i].getComponent("activityLdjlYhshItem").refreshUI(this.m_actIndex,e[i],i,this,this.setParam);for(var n=e.length;n<this.m_arrItems.length;++n)this.m_arrItems[n].active=!1}});a.SUOXIE="YHSH",a.refreshRed=function(e,t){var a=!1;t=t&&t.toLowerCase()||"yhsh";var i=app.getRedInfoByObj(["act",t.toLowerCase()],null);return null!=i&&(a=i>0),e&&(e.active=a),a},cc._RF.pop()},{basePage:void 0}],activityLdjlPageYhzh:[function(e,t){"use strict";cc._RF.push(t,"ec5cb8CSktHS6Ga8jA3D3Gw","activityLdjlPageYhzh");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activityldjlpageyhzh",pageParent:"activityldjlpage"},properties:{p_labTime:cc.Label,p_btnHelp:cc.Button,p_sprDaoju:cc.Sprite,p_labNum:cc.Label,p_btnAdd:cc.Button,p_btnPreview:cc.Button,p_sprBg:cc.Sprite,p_sprTalk:cc.Sprite,p_btnOne:cc.Button,p_sprIconOne:cc.Sprite,p_labOne:cc.Label,p_nodeSq:cc.Node,p_sprFree:cc.Sprite,p_btnTen:cc.Button,p_sprIconTen:cc.Sprite,p_labTen:cc.Label,p_nodeHelp:cc.Node,p_labBuyTime:cc.Label,p_sprGeneral:cc.Sprite,p_spGeneral:sp.Skeleton,p_animGeneral:cc.Animation,p_scrView:cc.ScrollView,p_pfbItem:cc.Prefab,p_nodeStar:cc.Node,p_sprStar:[cc.Sprite],p_sprCamp:cc.Sprite,p_sprName:cc.Sprite,p_sprOccu:cc.Sprite,p_sprOccu2:cc.Sprite,p_generalQuality:cc.Node,p_pfbQualityItem:cc.Prefab,p_arrNodeSkill:[cc.Node],p_arrSprCostIcon:[cc.Sprite]},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(),this.handleUI(),this.p_nodeProp=cc.instantiate(this.p_pfbItem),this.p_nodeProp.scale=.5,this.p_nodeProp.x=-170,this.p_nodeProp.parent=this.p_nodeHelp},onEnable:function(){this._super(),eventMgr.on(eventStr.commonEvent.RefreshTime,this.refreshTime,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.commonEvent.RefreshTime,this.refreshTime,this)},handleUI:function(){var e=this;this._super(),this.p_btnHelp.node.on("click",function(){0==e.m_actIndex?app.pages.windowspagetipshelp.showPage(1077):app.pages.windowspagetipshelp.showPage(1117)}),this.p_btnAdd.node.on("click",function(){gUtils.activityIsOpen("SWLB")&&app.pages.activityldjlpage.instance&&app.pages.activityldjlpage.instance.setMenuIndex("SWLB"),gUtils.activityIsOpen("SWLB1")&&app.pages.activityldjlpage.instance&&app.pages.activityldjlpage.instance.setMenuIndex("SWLB1")}),this.p_btnPreview.node.on("click",function(){app.playSound("click");var t={GSID:e.m_data.s_gsid,COUNT:1};app.showPropTips(t)}),this.p_btnOne.node.on("click",function(){e.extract(1)}),this.p_btnTen.node.on("click",function(){e.extract(10)}),this.p_arrNodeSkill.forEach(function(t,a){t.on("touchend",function(){e.onClickSkill(a)})})},extract:function(e){var t=this;gUtils.activityIsOpen(a.SUOXIE,!0)&&(app.player.getCount(this.m_data.gsid)<e&&(0!=app.player.getCount(90492)||1!=e)?app.showNotice(langMgr.getString("activityLdjlPageYhzh",0,app.db.getPropsName(this.m_data.gsid))):app.player.sfYhzhRoll(e,this.m_actIndex,function(a,i){if(a)""==a&&(a="");else{i.global_gifts&&app.setNewRecommendGift(i.global_gifts),0==app.player.getCount(90492)&&1==e?app.player.addItem({gsid:90492,count:1}):app.player.reduceItem({gsid:t.m_data.gsid,count:e}),app.player.addItem(i.reward),app.player.addItem({gsid:90478,count:e}),t.m_data.timenum=i.timenum;var n={showtype:0,reward:i.reward,target:t,againname:e,againcb:t.extract,againparm:[e]};app.pages.windowspagereward.showPage(n),t.refreshIcon(),t.refreshBtnIcon(),eventMgr.emit(eventStr.redEvent.RefreshActivityRed),eventMgr.emit(eventStr.commonEvent.RefershActivityZhdCoinUi)}}))},setParam:function(e){var t=this;a.SUOXIE=null!=e?e.SUOXIE:"YHZH",this.m_actIndex="YHZH"==a.SUOXIE?0:1,gUtils.activityIsOpen(a.SUOXIE,!0)&&app.player.sfYhzhInfo(this.m_actIndex,function(e,a){e||(t.m_data=a,t.refreshUI())})},refreshUI:function(){if(this.m_data){for(var e=app.db.getPropsIconPath(30111),t=0;t<this.p_arrSprCostIcon.length;t++)app.loadTexture(e,this.p_arrSprCostIcon[t],this.prefabPath);this.refreshTime(),this.refreshIcon(),this.refreshBtnIcon(),this.refreshSView(this.m_data.s_reward),this.refreshGeneral(this.m_data.s_gsid||this.m_data.grid)}},refreshGeneral:function(e){var t=this,a=app.db.getPropsInfoByGsid(e);console.log(a),app.loadGeneral(e,this.p_sprGeneral,this.p_spGeneral,this.p_animGeneral,null,this.prefabPath);var i=app.db.getGNamePathHByGsid(e);app.loadTexture(i,this.p_sprName,this.prefabPath);var n=gConfig.getIconGCampPath(a.CAMP-1);app.loadTexture(n,this.p_sprCamp,this.prefabPath);var r=gConfig.getIconGOccuPath(a.OCCU-1);app.loadTexture(r,this.p_sprOccu,this.prefabPath),a.OCCU2?(this.p_sprOccu2.node.active=!0,r=gConfig.getIconGOccuPath(a.OCCU2-1),app.loadTexture(r,this.p_sprOccu2,this.prefabPath)):this.p_sprOccu2.node.active=!1;var o=a.STAR;if(this.p_nodeStar.opacity=o<10?255:0,o<10){var s=(o-1)%5,p=gConfig.getIconGBigStarPath(a.STAR);this.p_sprStar.forEach(function(e,a){e.node.active=s>=a,app.loadTexture(p,e,t.prefabPath)})}this.p_generalQuality.opacity=Boolean(a.TGRADE)?255:0,a.TGRADE&&(cc.isValid(this._gQualityItem)||(this._gQualityItem=cc.instantiate(this.p_pfbQualityItem),this.p_generalQuality.addChild(this._gQualityItem),this._gQualityItem.setPosition(cc.Vec2.ZERO)),this._gQualityItem.getComponent("GeneralQualityItem").init(a.TGRADE));for(var c=0;c<4;++c){var h=a.SKILL[c];h?(this.p_arrNodeSkill[c].active=!0,this.p_arrNodeSkill[c].getComponent("skillItem").initForGSkill(h,!1,this.prefabPath)):this.p_arrNodeSkill[c].active=!1}},refreshIcon:function(){var e=app.db.getPropsIconPath(this.m_data.gsid);app.loadTexture(e,this.p_sprDaoju,this.prefabPath),this.p_labNum.string=app.player.getCount(this.m_data.gsid),this.p_nodeProp.getComponent("propItem").initForGsid(this.m_data.grid),this.p_labBuyTime.string=this.m_data.timenum},refreshSView:function(e){this.m_arrItems||(this.m_arrItems=[]);for(var t=0;t<e.length;++t){var a=this.m_arrItems[t];a||((a=cc.instantiate(this.p_pfbItem)).scale=.75,a.parent=this.p_scrView.content,this.m_arrItems.push(a)),a.getComponent("propItem").initForBag(e[t]),a.getComponent("propItem").setClick(!0),a.active=!0}for(var i=e.length;i<this.m_arrItems.length;++i)this.m_arrItems[i].active=!1},refreshBtnIcon:function(){if(app.player.getCount(90492)>0){this.p_sprFree.node.active=!1,this.p_nodeSq.active=!0;var e=app.db.getPropsIconPath(this.m_data.items[0].item.gsid);app.loadTexture(e,this.p_sprIconOne,this.prefabPath),this.p_labOne.string=this.m_data.items[0].item.count}else this.p_sprFree.node.active=!0,this.p_nodeSq.active=!1;var t=app.db.getPropsIconPath(this.m_data.items[1].item.gsid);app.loadTexture(t,this.p_sprIconTen,this.prefabPath),this.p_labTen.string=this.m_data.items[1].item.count},refreshTime:function(){var e=app.player.getServerTime(),t=gUtils.getActivityArrTime(a.SUOXIE)[1]||0,i=t-e;(!t||i<0)&&(i=0),this.p_labTime.string=0!=i?gUtils.getCountDownStr(i):"00:00:00"},onClickSkill:function(e){var t=this.p_arrNodeSkill[e],a=app.db.getGBaseByGsid(this.m_data.s_gsid||this.m_data.grid);if(a){var i=a.SKILL[e];if(i){var n={type:"general",gsid:i,index:e,lock:t.getComponent("skillItem").isLock()};app.pages.windowspagetipsskill.showPage(n)}}}});a.SUOXIE="YHZH",a.refreshRed=function(e){var t;return t=app.player.getCount(30111)>0||app.player.getCount(90492)<=0,e&&(e.active=t),t},cc._RF.pop()},{basePage:void 0}],activityLdjlPage:[function(e,t){"use strict";cc._RF.push(t,"d4cd84+Z99AcoP6GiAXleUV","activityLdjlPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activityldjlpage"},properties:{p_nodeBg:cc.Node,p_scrView:cc.ScrollView,p_nodeItem:cc.Node,p_labNoActivity:cc.Node,p_nodeTop:cc.Node},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(),this.fitTopMenu(),this.handleUI(),this.m_menu=this.node.getComponent("menu"),this.m_arrZhdData=gUtils.deepClone(app.db.dbMWelfare.ldjl),this.m_menu.init(this)},onEnable:function(){this._super(),eventMgr.on(eventStr.redEvent.RefreshActivityRed,this.refreshRed,this),eventMgr.on(eventStr.commonEvent.RefershActivityZhdCoinUi,this.refreshCoinUI,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.redEvent.RefreshActivityRed,this.refreshRed,this),eventMgr.off(eventStr.commonEvent.RefershActivityZhdCoinUi,this.refreshCoinUI,this)},handleUI:function(){this._super()},menuHandler:function(e){if(this.m_arrShowPage[e]){var t=this.m_arrShowPage[e].SUOXIE;return!!gUtils.activityIsOpen(t,!0)&&(this.m_index=e,this.openShopPage(e),!0)}},setParam:function(e){this.m_arrShowPage=[];for(var t=0;t<this.m_arrZhdData.length;t++){var a=this.m_arrZhdData[t],i=!0,n=!1;a.FUNCTION_ID&&(i=app.db.checkFuncUnLock(a.FUNCTION_ID));var r=gUtils.getActivityArrTime(a.SUOXIE),o=app.player.getServerTime();r[0]<=o&&o<=r[1]&&(n=!0),n&&i&&this.m_arrShowPage.push(a)}this.m_arrShowPage.length<=0&&(this.p_labNoActivity.active=!0,app.mainScene&&app.mainScene.refreshLeftButton()),this.setMenuIndex(e),this.refreshCoinUI()},refreshCoinUI:function(){this.p_nodeTop&&this.p_nodeTop.getComponent("currency").refreshCoin([{type:"gold",gsid:38006},{type:"",gsid:38005},{type:"",gsid:30111}])},setMenuIndex:function(e){var t=this,a=0;if(e)for(var i=0;i<this.m_arrShowPage.length;i++)if(e==this.m_arrShowPage[i].SUOXIE){a=i;break}this.m_arrShowPage[a]||(a=0),this.m_index!=a&&(this.m_index=a,app.player.sfPlayerByParam(["others"],function(){t.refreshSView(t.m_arrShowPage,a),t.m_menu.setMenuIndex(a)}))},openShopPage:function(e){var t=this,a=this.m_arrShowPage[e].PAGE,i=app.pages[a],n=function(){i.showPage({type:t.m_arrShowPage[e].NAME,SUOXIE:t.m_arrShowPage[e].SUOXIE},t.p_nodeBg,function(){t.m_showPage=i.instance,t.m_showPage.node.opacity=0,t.m_showPage.node.runAction(cc.fadeIn(.1)),t.refreshCoinUI(t.m_arrShowPage[e].SUOXIE)})};this.m_showPage?(this.m_showPage.node.active=!0,this.m_showPage.node.runAction(cc.sequence(cc.fadeOut(.1),cc.callFunc(function(){t.m_showPage.onClose(),t.m_showPage=null,n()})))):n(),this.refreshRed()},refreshSView:function(e,t){var a=this;if(e){this.m_arrItems||(this.m_arrItems=[],this.m_arrItems.push(this.p_nodeItem));for(var i=function(e){var t=a.m_arrItems[e];t||((t=cc.instantiate(a.p_nodeItem)).parent=a.p_scrView.content,a.m_menu.p_arrBtnMenu.push(t),t.on("click",function(){app.playSound("click"),a.m_menu._onClickMenu(e)}),a.m_arrItems.push(t)),t.active=!0},n=0;n<e.length;++n)i(n);for(var r=0;r<e.length;++r)this.m_arrItems[r].getComponent("activityZhdGameItem").refreshUI(e[r],r,this);for(var o=e.length;o<this.m_arrItems.length;++o)this.m_arrItems[o].active=!1;this.scheduleOnce(function(){if(e.length<=4)a.p_scrView.content.x=(4-e.length)*a.p_nodeItem.width-300+10;else{t=Math.max(t-1,0);var i=a.p_nodeItem.width*t;a.p_scrView.scrollToOffset(cc.Vec2(i,0))}},.1)}},openShopPageByArr:function(e){var t=this,a=e;e instanceof Array&&(a=e.shift()),this.m_menu.p_arrBtnMenu.forEach(function(e,t){e.getComponent("menuBtnItem")&&e.getComponent("menuBtnItem").select(t==a)});var i=this.m_arrShowPage[a].PFBNAME.replace(/_/g,"");this.m_menu.m_numMenuIndex=a;var n=app.pages[i],r=function(){var a=null;e instanceof Array&&(a=e.shift()),n.showPage(a,t.p_nodeBg,function(){t.m_showPage=n.instance,t.m_showPage.node.opacity=0,t.m_showPage.node.runAction(cc.fadeIn(.1))})};this.m_showPage?(this.m_showPage.node.active=!0,this.m_showPage.node.runAction(cc.sequence(cc.fadeOut(.1),cc.callFunc(function(){t.m_showPage.onClose(),t.m_showPage=null,r()})))):r()},refreshMenuRed:function(e){if(!this.m_arrShowPage[e])return!1;var t=this.m_arrShowPage[e].PFBNAME.replace(/_/g,"");if(app.pages[t])return app.pages[t].refreshRed(null,this.m_arrShowPage[e].SUOXIE);console.log(t+"is error")},refreshRed:function(){this.m_menu.refreshRed()},onClose:function(){this.m_showPage&&cc.isValid(this.m_showPage.node)&&this.m_showPage.onClose(),this._super()}});a.refreshRed=function(e){for(var t=!1,a=0;a<app.db.dbMWelfare.ldjl.length;a++){var i,n=app.db.dbMWelfare.ldjl[a],r=!0;n.FUNCTION_ID&&(r=app.db.checkFuncUnLock(n.FUNCTION_ID)),t=(i=gUtils.activityIsOpen(n.SUOXIE))&&r;var o=n.PFBNAME.replace(/_/g,"");if(t=r&&i&&app.pages[o].refreshRed(null,n.SUOXIE))break}return e&&(e.active=t),t},a.isOpen=function(){for(var e=!1,t=0;t<app.db.dbMWelfare.ldjl.length;t++){var a=app.db.dbMWelfare.ldjl[t],i=!0;a.FUNCTION_ID&&(i=app.db.checkFuncUnLock(a.FUNCTION_ID));var n=!1,r=gUtils.getActivityArrTime(a.SUOXIE),o=app.player.getServerTime();if(r[0]<=o&&o<=r[1]&&(n=!0),e=n&&i)break}return e},cc._RF.pop()},{basePage:void 0}],activityMRSCPage:[function(e,t){"use strict";function a(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(a)return(a=a.call(e)).next.bind(a);if(Array.isArray(e)||(a=i(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function i(e,t){if(e){if("string"==typeof e)return n(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?n(e,t):void 0}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,i=new Array(t);a<t;a++)i[a]=e[a];return i}cc._RF.push(t,"cc0f0N1PcVCTrHJZB+QQsab","activityMRSCPage");var r=cc.Class({extends:e("basePage"),statics:{prefabPath:"activitymrscpage",pageType:1},properties:{p_arrBtnMenu:[cc.Node],p_btnGet:cc.Button,p_rewardContent:cc.Node,p_pfbItem:cc.Prefab,p_labPrice:cc.Label,p_nodeGoto:cc.Node,p_nodeGet:cc.Node,p_nodeYlq:cc.Node},onLoad:function(){r.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),localDataUtils.SetValue("meirishouchongred",1,gUtils.getSecondDayTime(app.player.getServerTime())),"JP"===gSetting.getLangName()&&(this.p_labPrice.ndoe.scale=.75,this.p_labPrice.node.x=-81);for(var e=0;e<5;e++){var t=cc.instantiate(this.p_pfbItem);t.scale=.75,t.parent=this.p_rewardContent}},handleUI:function(){var e=this;this._super(),this.p_btnGet.node.on("click",function(){app.playSound("click"),e.onClickGet()}),this.p_arrBtnMenu.forEach(function(t,a){t.on("click",function(){e.onClick(a)})})},setParam:function(e){void 0===e&&(e=0),this.m_dayIndex=0;var t=new Date(app.player.create);t.setHours(0,0,0,0),t.valueOf()+6048e5<app.player.getServerTime()&&(this.m_dayIndex=1),this.m_carrIndex=0,e<this.p_arrBtnMenu.length&&(this.m_carrIndex=e),app.player.getCount(app.db.dbDailyRecharge[this.m_dayIndex][0].MARK)<1?this.onClick(this.m_carrIndex):(this.m_carrIndex=1,this.onClick(this.m_carrIndex)),app.arrRed.mrsc=!0},refreshUI:function(){var e=this.m_carrIndex;this.m_arrData=app.db.dbDailyRecharge[this.m_dayIndex][e];var t=app.player.getCount(90221);this.m_isSucc=t>=this.m_arrData.PRICE,this.refreshReward(this.m_arrData.REWARD),this.p_btnGet.node.getChildByName("goto").active=!this.m_isSucc,this.p_btnGet.node.getChildByName("get").active=this.m_isSucc,this.p_nodeGoto.active=!this.m_isSucc;var a=app.player.getCount(this.m_arrData.MARK);this.p_nodeGet.active=this.m_isSucc&&a<1,this.p_btnGet.interactable=a<1,this.p_nodeYlq.active=a,this.p_btnGet.node.getChildByName("redpoint").active=this.m_isSucc&&a<1;var i=Math.max(this.m_arrData.PRICE-t,0);this.p_labPrice.string=i},onClick:function(e){(this.m_carrIndex||0==this.m_carrIndex)&&(this.p_arrBtnMenu[this.m_carrIndex].getChildByName("light").active=!1),this.m_carrIndex=e,this.p_arrBtnMenu[e].getChildByName("light").active=!0,this.refreshUI()},refreshReward:function(e){for(var t=0;t<e.length;t++){var a=this.p_rewardContent.children[t];a||(a=cc.instantiate(this.p_rewardContent.children[0]),this.p_rewardContent.addChild(a)),a.active=!0,a.getComponent("propItem").initForBag(e[t]),a.getComponent("propItem").setClick(!0)}for(var i=e.length;i<this.p_rewardContent.childrenCount;i++)this.p_rewardContent.children[i].active=!1},onClickGet:function(){var e=this;this.m_isSucc?app.player.sfExchange(this.m_arrData.EXID,1,null,function(t){for(var i,n=[],r=a(t);!(i=r()).done;){var o=i.value;(o.gsid||o.GSID)!=e.m_arrData.MARK&&n.push(o)}e.refreshUI();var s={showtype:1,reward:n,confirmcb:function(){},target:e};app.pages.windowspagereward.showPage(s)}):app.goToPage(1042)}});r.isOpen=function(){var e=!0,t=0,a=new Date(app.player.create);a.setHours(0,0,0,0),a.valueOf()+6048e5<app.player.getServerTime()&&(t=1);var i=app.player.getCount(app.db.dbDailyRecharge[t][0].MARK)<1,n=app.player.getCount(app.db.dbDailyRecharge[t][1].MARK)<1;return i||n||(e=!1),e},r.refreshRed=function(e){var t=!1,a=0,i=new Date(app.player.create);i.setHours(0,0,0,0),i.valueOf()+6048e5<app.player.getServerTime()&&(a=1);var n=app.player.getCount(90221),r=app.db.dbDailyRecharge[a][0].PRICE,o=app.db.dbDailyRecharge[a][1].PRICE;localDataUtils.GetValue("meirishouchongred",null)||(t=!0);var s=app.player.getCount(app.db.dbDailyRecharge[a][0].MARK)<1,p=app.player.getCount(app.db.dbDailyRecharge[a][1].MARK)<1;return(n>=r&&s||n>=o&&p)&&(t=!0),e&&(e.active=t),t},cc._RF.pop()},{basePage:void 0}],activityNewVersionPage:[function(e,t){"use strict";cc._RF.push(t,"c81eeib0tROEbrvGv38hcE6","activityNewVersionPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activitynewversionpage",pageType:1},properties:{p_btnGoto:[cc.Button],p_spPage:[cc.SpriteFrame],p_bgPage:cc.Sprite},onLoad:function(){a.instance=this,this.m_currentPage=0,this.stopBgNodeEvent(),this.handleUI(),this.fitTopMenu(),this.creatMask(!0)},handleUI:function(){var e=this;this._super(),this.p_btnGoto[0].node.on("click",function(){app.playSound("click"),e.changePage(-1)}),this.p_btnGoto[1].node.on("click",function(){app.playSound("click"),e.changePage(1)})},onEnable:function(){this._super()},onDisable:function(){this._super()},setParam:function(){},changePage:function(e){this.m_currentPage+=e,this.m_currentPage>3?this.m_currentPage=0:this.m_currentPage<0&&(this.m_currentPage=3),this.p_bgPage.spriteFrame=this.p_spPage[this.m_currentPage],console.log(this.m_currentPage)}});a.isTan=function(){return!(localDataUtils.GetValue("newversion"+app.player.uid,0)||!app.db.checkFuncUnLock("NEW_VERSION")||!app.db.checkChannelShow("NEW_VERSION")||(localDataUtils.SetValue("newversion"+app.player.uid,1),0))},a.refreshRed=function(e){return e&&(e.active=!1),!1},cc._RF.pop()},{basePage:void 0}],activityNhdPage:[function(e,t){"use strict";cc._RF.push(t,"1a781peURtMHYB9JtOzLg5g","activityNhdPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activitynhdpage"},properties:{p_nodeBg:cc.Node,p_scrView:cc.ScrollView,p_labNoActivity:cc.Node,p_nodeItem:cc.Node,p_nodeTop:cc.Node},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(),this.fitTopMenu(),this.handleUI(),this.m_menu=this.node.getComponent("menu"),this.m_arrZhdData=gUtils.deepClone(app.db.dbMWelfare.nhd),this.m_menu.init(this)},onEnable:function(){this._super(),eventMgr.on(eventStr.nhdPage.REFRESH_BTN_RED,this.refreshRed,this),eventMgr.on(eventStr.nhdPage.REFRESH_COIN,this.refreshCoinUI,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.nhdPage.REFRESH_BTN_RED,this.refreshRed,this),eventMgr.off(eventStr.nhdPage.REFRESH_COIN,this.refreshCoinUI,this)},handleUI:function(){this._super()},menuHandler:function(e){if(this.m_index=e,this.m_arrShowPage[e]){var t=this.m_arrShowPage[e].SUOXIE;return!!gUtils.activityIsOpen(t,!0)&&(this.m_index=e,this.openShopPage(e),!0)}},setParam:function(e){this.m_arrShowPage=[];for(var t=0;t<this.m_arrZhdData.length;t++){var a=this.m_arrZhdData[t],i=!0,n=!1;a.FUNCTION_ID&&(i=app.db.checkFuncUnLock(a.FUNCTION_ID));var r=gUtils.getActivityArrTime(a.SUOXIE),o=app.player.getServerTime();r[0]<=o&&o<=r[1]&&(n=!0),n&&i&&this.m_arrShowPage.push(a)}this.m_arrShowPage.length<=0&&(this.p_labNoActivity.active=!0,app.mainScene&&app.mainScene.refreshLeftButton()),this.setMenuIndex(e)},setMenuIndex:function(e){var t=this,a=0;if(e){if(e.indexOf("XCRW")>=0){this.m_xcrwParam=0;var i=e.split("_");i[1]&&(this.m_xcrwParam=i[1]),e="XCRW"}for(var n=0;n<this.m_arrShowPage.length;n++)if(e==this.m_arrShowPage[n].SUOXIE){a=n;break}}this.m_arrShowPage[a]||(a=0),this.m_index!=a&&(this.m_index=a,app.player.sfPlayerByParam(["others"],function(){t.refreshSView(t.m_arrShowPage,t.m_index),t.m_menu.setMenuIndex(t.m_index)}))},openShopPage:function(e){var t=this,a=this.m_arrShowPage[e].PAGE,i=app.pages[a],n=function(){i.showPage({type:t.m_arrShowPage[e].SUOXIE,param:t.m_xcrwParam},t.p_nodeBg,function(){t.m_showPage=i.instance,t.m_showPage.node.opacity=0,t.m_showPage.node.runAction(cc.fadeIn(.1)),t.refreshCoinUI(t.m_arrShowPage[e].SUOXIE)})};this.m_showPage?(this.m_showPage.node.active=!0,this.m_showPage.node.runAction(cc.sequence(cc.fadeOut(.1),cc.callFunc(function(){t.m_showPage.onClose(),t.m_showPage=null,n()})))):n(),this.refreshRed()},refreshSView:function(e,t){var a=this;if(e){this.m_arrItems||(this.m_arrItems=[],this.m_arrItems.push(this.p_nodeItem));for(var i=function(e){var t=a.m_arrItems[e];t||((t=cc.instantiate(a.p_nodeItem)).parent=a.p_scrView.content,a.m_menu.p_arrBtnMenu.push(t),t.on("click",function(){app.playSound("click"),a.m_menu._onClickMenu(e)}),a.m_arrItems.push(t)),t.active=!0},n=0;n<e.length;++n)i(n);for(var r=0;r<e.length;++r)this.m_arrItems[r].getComponent("activityZhdGameItem").refreshUI(e[r],r,this);for(var o=e.length;o<this.m_arrItems.length;++o)this.m_arrItems[o].active=!1;this.scheduleOnce(function(){if(e.length<=4)a.p_scrView.content.x=(4-e.length)*a.p_nodeItem.width-320;else{t=Math.max(t-1,0);var i=a.p_nodeItem.width*t;a.p_scrView.scrollToOffset(cc.Vec2(i,0))}},.1)}},refreshCoinUI:function(e){if(this.m_arrShowPage&&this.m_arrShowPage[this.m_index]){var t=[{type:"gold",gsid:38006},{type:"",gsid:38005}];switch(e||this.m_arrShowPage[this.m_index].SUOXIE){case"XYSH":case"JNXL":case"XCRW":t.push({type:"",gsid:30087})}this.p_nodeTop&&this.p_nodeTop.getComponent("currency").refreshCoin(t)}},refreshMenuRed:function(e){var t=this.m_arrShowPage[e].PAGE;return app.pages[t].refreshRed()},refreshRed:function(){this.m_menu.refreshRed()},onClose:function(){this.m_showPage&&cc.isValid(this.m_showPage.node)&&this.m_showPage.onClose(),app.mainScene&&app.mainScene.refreshLeftButton(),this._super()}});a.refreshRed=function(e){for(var t=!1,a=0;a<app.db.dbMWelfare.nhd.length;a++){var i=app.db.dbMWelfare.nhd[a],n=!0;i.FUNCTION_ID&&(n=app.db.checkFuncUnLock(i.FUNCTION_ID));var r=gUtils.activityIsOpen(i.SUOXIE),o=i.PAGE,s=app.pages[o]&&app.pages[o].refreshRed();if(t=n&&r&&s)break}return e&&(e.active=t),t},a.isOpen=function(){for(var e=!1,t=0;t<app.db.dbMWelfare.nhd.length;t++){var a=app.db.dbMWelfare.nhd[t],i=!0;a.FUNCTION_ID&&(i=app.db.checkFuncUnLock(a.FUNCTION_ID));var n=!1,r=gUtils.getActivityArrTime(a.SUOXIE),o=app.player.getServerTime();if(r[0]<=o&&o<=r[1]&&(n=!0),e=n&&i)break}return e},cc._RF.pop()},{basePage:void 0}],activityNovicePage:[function(e,t){"use strict";cc._RF.push(t,"c8989Fi+d9MwrIg3v0J6rbi","activityNovicePage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activitynovicepage",pageParent:"activitypagefreewelfare"},properties:{p_giftView:cc.ScrollView,p_nodeItem:cc.Node},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.m_arrItems=[],this.m_arrItems.push(this.p_nodeItem)},handleUI:function(){this._super()},setParam:function(){this.refreshData()},refreshData:function(){for(var e=app.db.dbNoviceTrain.RONGYAO,t=[],a=0;a<e.length;++a){var i=app.player.getMissionState(e[a],!0);t.push({info:e[a],state:i,target:this})}t.sort(function(e,t){return e.state.state<t.state.state?1:e.state.state==t.state.state&&e.info.GETMARK>t.info.GETMARK?1:-1}),this.refreshUI(t)},refreshUI:function(e){for(var t=0;t<e.length;++t){var a=this.m_arrItems[t];a||((a=cc.instantiate(this.p_nodeItem)).parent=this.p_giftView.content,this.m_arrItems.push(a)),a.y=a.height*-t,a.active=!0,cc.log(e[t]),a.getComponent("monthMissionItem").refreshUI(e[t],"RONGYAO",!0)}this.p_giftView.content.height=20+this.p_nodeItem.height*e.length;for(var i=e.length;i<this.m_arrItems.length;++i)this.m_arrItems[i].active=!1},refreshMenuRed:function(){return a.refreshRedByIndex()},onClose:function(){this._super()}});a.isOver=function(){if(!app.db.checkFuncUnLock("ACTIVITY_NEWBCK"))return!0;var e=app.db.dbNoviceTrain.RONGYAO;if(!e)return!0;for(var t=0;t<e.length;++t)if(app.player.getCount(e[t].GETMARK)>0)return!1;return!0},a.refreshRed=function(e){var t=!1;return a.refreshRedByIndex()&&(t=!0),e&&(e.active=t),t},a.refreshRedByIndex=function(){for(var e=app.db.dbNoviceTrain.RONGYAO,t=0;t<e.length;++t)if(3==app.player.getMissionState(e[t],!0).state)return!0;return!1},cc._RF.pop()},{basePage:void 0}],activityOnlinePage:[function(e,t){"use strict";cc._RF.push(t,"2bf38jruxhK7qiETHLm4t0E","activityOnlinePage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activityonlinepage",pageType:1,createShot:!0},properties:{p_labTime:cc.Label,p_nodeItem:cc.Node,p_nodeParent:cc.Node,p_pfbItem:cc.Prefab},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.m_arrItem=[this.p_nodeItem];var e=cc.instantiate(this.p_pfbItem);e.parent=this.p_nodeParent,e.scale=.9,this.refreshLabel(),this._time=0},setParam:function(e){e.target&&(this.m_target=e.target),this.refreshUI()},refreshLabel:function(){if(app.player.getServerTime()>=app.player.online)this.p_labTime&&(this.p_labTime.string=langMgr.getString("activityOnlinePage",0)),this._bPick=!0;else{var e=app.player.online-app.player.getServerTime();9999999999999==app.player.online&&(e=0),this.p_labTime&&(this.p_labTime.string=gUtils.getHourMinSecTime(e/1e3)),this._bPick=!1}},refreshUI:function(){for(var e=this,t=app.db.dbOnlineGift.REWARD,a=app.player.getCount(app.db.dbOnlineGift.GIVE_SIGN),i=function(i){var n=e.m_arrItem[i];n||((n=cc.instantiate(e.p_nodeItem)).parent=e.p_nodeItem.parent,e.m_arrItem.push(n)),n.getChildByName("nodeItem").getChildByName("porp_item").getComponent("propItem").initForBag(t[i].REWARD[0]),n.getChildByName("nodeItem").getChildByName("porp_item").getComponent("propItem").setClick(!0),app.setNodeState(n.getChildByName("nodeItem").getChildByName("porp_item"),a>i),n.getChildByName("picked").active=a>i,n.getChildByName("nodeItem").getChildByName("porp_item").getComponent("propItem").setReceive(a>i),n.getChildByName("nodeItem").getChildByName("porp_item").getComponent("propItem").setSpine(!1),a==i&&e._bPick&&(n.getChildByName("nodeItem").getChildByName("porp_item").getComponent("propItem").setSpine(!0,"square_animation/squareanimation","animation",1.2),n.getChildByName("nodeItem").getChildByName("porp_item").getComponent("propItem").setClick(!1)),n.hasEventListener("touchend")||n.on("touchend",function(){if(e._bPick){if("general"==app.db.getTypeByGsid(t[i].REWARD[0].GSID)&&app.player.gnum+t[i].REWARD[0].COUNT>app.player.bagspace){var a={content:langMgr.getString("activityOnlinePage",1),confirmcb:function(){app.goToPage(1018)},cancelcb:function(){},target:e};return void app.pages.windowspagetipsmsg.showPage(a)}app.player.sfOnlineGift(function(t){app.player.sfPlayerData(function(){var a={showtype:1,reward:t.reward};app.pages.windowspagereward.showPage(a),e.m_target.refreshUI(),e.m_target.refreshReward(),e.refreshLabel(),e.refreshUI()})})}})},n=0;n<t.length;++n)i(n)},update:function(e){this._bPick||(this._time+=e,this._time>1&&(this._time=0,this.refreshLabel()))}});cc._RF.pop()},{basePage:void 0}],activityPageCode:[function(e,t){"use strict";cc._RF.push(t,"c616ddymtNAGJnIP7krcG9r","activityPageCode");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activitypagecode",pageParent:"activitypagefreewelfare"},properties:{p_editCode:cc.EditBox,p_btnExCode:cc.Button},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(),this.handleUI()},handleUI:function(){var e=this;this._super(),this.p_btnExCode.node.on("click",function(){var t=e.p_editCode.string;if(t.length<=0)app.showNotice(langMgr.getString("activityPageCode",0));else{for(var a=0;a<t.length;a++){var i=t.substr(a,1);if(!(i>="A"&&i<="Z")&&!(i>="a"&&i<="z")&&isNaN(i))return void app.showNotice(langMgr.getString("activityPageCode",1))}var n=e;app.player.sfCDKey(t,function(e,t){if(e)n.showError(e),n.refreshUI();else{n.m_data=t;var a={showtype:1,reward:t,target:n};app.pages.windowspagereward.showPage(a),n._payRefreshEnd=!1,n.payRefresh(),n.schedule(n.payRefresh,1,3),app.pages.activitypagefreewelfare.instance.refreshCoinUI()}})}})},setParam:function(){this.refreshUI()},payRefresh:function(){var e=this;this._payRefreshEnd||app.player.sfPlayerData(function(){e._payRefreshEnd=!0,app.showNotice(langMgr.getString("activityPageCode",2)),app.pages.activitypagefreewelfare.instance.refreshCoinUI(),e.refreshUI()})},showError:function(e){var t=e;switch(e){case"cdkey nexist":t=langMgr.getString("activityPageCode",3);break;case"cdkey pause":t=langMgr.getString("activityPageCode",4);break;case"before start":t=langMgr.getString("activityPageCode",5);break;case"after expire":t=langMgr.getString("activityPageCode",6);break;case"cdkey runout":t=langMgr.getString("activityPageCode",7);break;case"channel forbit":t=langMgr.getString("activityPageCode",8);break;case"server forbit":t=langMgr.getString("activityPageCode",9);break;case"level forbit":t=langMgr.getString("activityPageCode",10);break;case"no more":t=langMgr.getString("activityPageCode",11)}app.showNotice(t)},refreshUI:function(){this.p_editCode.string=""}});cc._RF.pop()},{basePage:void 0}],activityPageDbqb:[function(e,t){"use strict";cc._RF.push(t,"e8917M1p9JHa6S6pg1mXwcp","activityPageDbqb");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=cc._decorator,o=r.ccclass,s=(r.property,e("activityPageModel")),p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,this._super()},t.prototype.setParam=function(e){this._super("dbqb",e)},t.prefabPath="activitydbqbpage",a=n([o],t)}(s);p.getEndTime=function(){return gUtils.getActivityArrTime("DBSD")[1]||0},p.refreshRed=function(e){return s.refreshRed(e,"dbqb")},p.isOpen=function(){return s.isOpen("dbqb")},t.exports=p,cc._RF.pop()},{activityPageModel:"activityPageModel"}],activityPageFreeWelfare:[function(e,t){"use strict";cc._RF.push(t,"433beIE+k1OCZMscnANwF4Z","activityPageFreeWelfare");var a=[{page:"activityjchdpagemrqd",pageParam:null,coin:[38005,38006],funcId:"SIGN_DAY"},{page:"activitynovicepage",pageParam:null,coin:[38005,38006],checkFun:function(){return!app.pages.activitynovicepage.isOver()}},{page:"activitypagefreezmfl",pageParam:null,coin:[38005,38006],funcId:"SIGN_WEEKEND"},{page:"activitypagecode",pageParam:null,coin:[38005,38006],funcId:"CODE"}],i=cc.Class({extends:e("basePage"),statics:{prefabPath:"activitypagefreewelfare"},properties:{p_nodeBg:cc.Node,p_top:cc.Node},onLoad:function(){i.instance=this,this.stopBgNodeEvent(),this.fitTopMenu(),this.handleUI(),this.m_menu=this.node.getComponent("menu"),this.m_menu.init(this),this.schedule(this.refreshTime,1)},onEnable:function(){this._super(),eventMgr.on(eventStr.redEvent.RefreshActivityRed,this.refreshRed,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.redEvent.RefreshActivityRed,this.refreshRed,this)},menuHandler:function(e){this.m_menuIndex=e,this.currentPageData=a[e],this.openShopPage()},setParam:function(e){var t=e||0;this.m_menu.refreshMenuState(),this.m_menu.setMenuIndex(t),this.getZmflList()},getZmflList:function(){var e=this;app.player.sfZmflTime(function(t,a){t?e.m_menu.p_arrBtnMenu[2].active=!1:(e.m_zmflEtime=a.endtime,e.m_menu.p_arrBtnMenu[2].active=!0)})},refreshTime:function(){var e=this.m_zmflEtime,t=app.player.getServerTime();(!e||e-t<0)&&(this.m_menu.p_arrBtnMenu[2].active=!1)},refreshCoinUI:function(){this.p_top.getComponent("currency").refreshCoin(this.currentPageData.coin),this.m_menu.refreshRed()},openShopPage:function(){var e=this;if(this.currentPageData&&this.currentPageData.page){this.canSelectMenu=!1;var t=app.pages[this.currentPageData.page],a=function(){t.showPage(e.currentPageData.pageParam,e.p_nodeBg,function(a){a?e.canSelectMenu=!0:(e.m_showPage=t.instance,t.instance.p_bgNode?(e.m_showPageNode=e.m_showPage.p_bgNode,e.m_showPageNode.opacity=0,e.m_showPageNode.runAction(cc.sequence(cc.fadeIn(.15),cc.callFunc(function(){e.canSelectMenu=!0})))):e.canSelectMenu=!0)})};if(this.m_showPage){if(this.m_showPage.node.active=!0,this.m_showPageNode=this.m_showPage.p_bgNode,!this.m_showPageNode)return this.m_showPage.onClose(),this.m_showPage=null,void a();this.m_showPageNode.runAction(cc.sequence(cc.fadeOut(.1),cc.callFunc(function(){e.m_showPage.onClose(),e.m_showPage=null,a()})))}else a();this.refreshCoinUI()}},onClose:function(){app.pages[this.currentPageData.page].instance&&cc.isValid(app.pages[this.currentPageData.page].instance.node)&&app.pages[this.currentPageData.page].instance.onClose(),this._super()},refreshMenuRed:function(e){var t=a[e];return!!(t&&t.page&&app.pages[t.page]&&app.pages[t.page].refreshRed)&&app.pages[t.page].refreshRed()},refreshRed:function(){this.m_menu.refreshRed()},refreshMenuState:function(e){var t=a[e],i=t.checkFun?t.checkFun():app.db.checkFuncUnLock(t.funcId),n=app.db.checkChannelShow(t.funcId);this.m_menu.p_arrBtnMenu[e].active=i&&n}});i.refreshRed=function(e){var t=app.player.getCount(90485)<app.player.getCount(90484)||app.player.getCount(90221)>0&&app.player.getCount(90518)<1;return t?(e&&(e.active=t),t):(t=app.pages.activitypagefreezmfl.refreshRed(),e&&(e.active=t),t)},cc._RF.pop()},{basePage:void 0}],activityPageFreeZmfl:[function(e,t){"use strict";cc._RF.push(t,"6e786kspPxBmpZh4UuBxVlR","activityPageFreeZmfl");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activitypagefreezmfl",pageParent:"activitypagefreewelfare"},properties:{p_labTime:cc.Label,p_content:cc.Node,p_itemNode:cc.Node},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.schedule(this.refreshTime,1)},start:function(){},setParam:function(){var e=this;app.arrFreeWelfare.ZMFL?this.refreshUI():app.player.sfZmflInfo(function(t,a){t||(app.arrFreeWelfare.ZMFL=a,e.refreshUI())})},refreshUI:function(){for(var e=0;e<app.arrFreeWelfare.ZMFL.length;e++){var t=this.p_content.children[e];t||(t=cc.instantiate(this.p_itemNode),this.p_content.addChild(t)),t.active=!0,t.getComponent("activityZmflItem").refreshUI(e,app.arrFreeWelfare.ZMFL[e])}this.refreshTime()},refreshTime:function(){var e=app.pages.activitypagefreewelfare.instance.m_zmflEtime,t=app.player.getServerTime();this.lastTime=e-t,(!e||this.lastTime<0)&&(this.lastTime=0),0!=this.lastTime?this.p_labTime.string=gUtils.getCountDownStr(this.lastTime):this.p_labTime.string="00:00:00"}});a.refreshRed=function(e){var t=!1,a=app.getRedInfoByObj(["act","zmfl"],null);return null!=a&&(t=a>0),e&&(e.active=t),t},cc._RF.pop()},{basePage:void 0}],activityPageModel:[function(e,t){"use strict";cc._RF.push(t,"4a9ccxEwtdDRpz7p/uIG9Lk","activityPageModel");var a=cc.Class({extends:e("basePage"),properties:{p_nodeBg:cc.Node,p_scrView:cc.ScrollView,p_nodeItem:cc.Node,p_labNoActivity:cc.Node,p_nodeTop:cc.Node,p_nodeMask:cc.Node},onLoad:function(){this.stopBgNodeEvent(),this.creatMask(),this.fitTopMenu(),this.handleUI(),this.m_menu=this.node.getComponent("menu"),this.m_menu.init(this)},onEnable:function(){this._super(),eventMgr.on(eventStr.redEvent.RefreshActivityRed,this.refreshRed,this),eventMgr.on(eventStr.commonEvent.RefershActivityZhdCoinUi,this.refreshCoinUI,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.redEvent.RefreshActivityRed,this.refreshRed,this),eventMgr.off(eventStr.commonEvent.RefershActivityZhdCoinUi,this.refreshCoinUI,this)},handleUI:function(){this._super()},menuHandler:function(e){if(this.m_arrShowPage[e]){var t=this.m_arrShowPage[e].SUOXIE;return!!gUtils.activityIsOpen(t,!0)&&(this.m_index=e,this.openShopPage(e),!0)}},setParam:function(e,t){this.m_arrShowPage=[],this.m_arrZhdData=gUtils.deepClone(app.db.dbMWelfare[e]);for(var a=0;a<this.m_arrZhdData.length;a++){var i=this.m_arrZhdData[a],n=!0,r=!1;i.FUNCTION_ID&&(n=app.db.checkFuncUnLock(i.FUNCTION_ID));var o=gUtils.getActivityArrTime(i.SUOXIE),s=app.player.getServerTime();o[0]<=s&&s<=o[1]&&(r=!0),r&&n&&this.m_arrShowPage.push(i)}this.m_arrShowPage.length<=0&&(this.p_labNoActivity.active=!0,app.mainScene&&app.mainScene.refreshLeftButton()),this.setMenuIndex(t)},setMenuIndex:function(e){var t=this,a=0;if(e)for(var i=0;i<this.m_arrShowPage.length;i++)if(e==this.m_arrShowPage[i].SUOXIE){a=i;break}this.m_arrShowPage[a]||(a=0),this.m_index!=a&&(this.m_index=a,app.player.sfPlayerByParam(["others"],function(){t.refreshSView(t.m_arrShowPage,t.m_index),t.m_menu.setMenuIndex(t.m_index)}))},openShopPage:function(e){var t=this,a=this.m_arrShowPage[e].PAGE,i=app.pages[a],n=function(){i.showPage({type:t.m_arrShowPage[e].SUOXIE},t.p_nodeBg,function(){t.m_showPage=i.instance,t.m_showPage.node.opacity=0,t.m_showPage.node.runAction(cc.fadeIn(.1)),t.refreshCoinUI(t.m_arrShowPage[e].SUOXIE)})};this.m_showPage?(this.m_showPage.node.active=!0,this.m_showPage.node.runAction(cc.sequence(cc.fadeOut(.1),cc.callFunc(function(){t.m_showPage.onClose(),t.m_showPage=null,n()})))):n(),this.refreshRed()},refreshSView:function(e,t){var a=this;if(e){this.m_arrItems||(this.m_arrItems=[],this.m_arrItems.push(this.p_nodeItem));for(var i=function(e){var t=a.m_arrItems[e];t||((t=cc.instantiate(a.p_nodeItem)).parent=a.p_scrView.content,a.m_menu.p_arrBtnMenu.push(t),t.on("click",function(){app.playSound("click"),a.m_menu._onClickMenu(e)}),a.m_arrItems.push(t)),t.active=!0},n=0;n<e.length;++n)i(n);for(var r=0;r<e.length;++r)this.m_arrItems[r].getComponent("activityZhdGameItem").refreshUI(e[r],r,this);for(var o=e.length;o<this.m_arrItems.length;++o)this.m_arrItems[o].active=!1;this.scheduleOnce(function(){if(e.length<=4)a.p_scrView.content.x=(4-e.length)*a.p_nodeItem.width-320;else{t=Math.max(t-1,0);var i=a.p_nodeItem.width*t;a.p_scrView.scrollToOffset(cc.Vec2(i,0))}},.1)}},refreshCoinUI:function(e){if(this.m_arrShowPage&&this.m_arrShowPage[this.m_index]){var t=[{type:"gold",gsid:38006},{type:"",gsid:38005}];switch(e||this.m_arrShowPage[this.m_index].SUOXIE){case"XSDH":t.push({type:"qxt",gsid:30014});break;case"GJDL":t.push({type:"shzl",gsid:30063});break;case"QXSY":t.push({type:"xgfw",gsid:30084});break;case"DBSD":case"JGKL":t.push({type:"xgfw",gsid:30083});break;case"DBRW":t.push({type:"xgfw",gsid:30096});case"XYBZ":t.push({type:"",gsid:30095})}this.p_nodeTop&&this.p_nodeTop.getComponent("currency").refreshCoin(t)}},refreshMenuRed:function(e){var t=this.m_arrShowPage[e].PAGE;return app.pages[t].refreshRed()},refreshRed:function(){this.m_menu.refreshRed()},onClose:function(){this.m_showPage&&cc.isValid(this.m_showPage.node)&&this.m_showPage.onClose(),this.m_arrShowPage.length<=0&&app.mainScene&&app.mainScene.refreshLeftButton(),this._super()}});a.refreshRed=function(e,t){for(var a=!1,i=0;i<app.db.dbMWelfare[t].length;i++){var n=app.db.dbMWelfare[t][i],r=!0;n.FUNCTION_ID&&(r=app.db.checkFuncUnLock(n.FUNCTION_ID));var o=gUtils.activityIsOpen(n.SUOXIE),s=n.PAGE,p=app.pages[s]&&app.pages[s].refreshRed(null,n.SUOXIE);if(a=r&&o&&p)break}return e&&(e.active=a),a},a.isOpen=function(e){if(!e||!app.db.dbMWelfare[e])return!1;for(var t=!1,a=0;a<app.db.dbMWelfare[e].length;a++){var i=app.db.dbMWelfare[e][a],n=!0;i.FUNCTION_ID&&(n=app.db.checkFuncUnLock(i.FUNCTION_ID));var r=!1,o=gUtils.getActivityArrTime(i.SUOXIE),s=app.player.getServerTime();if(o[0]<=s&&s<=o[1]&&(r=!0),t=r&&n)break}return t},cc._RF.pop()},{basePage:void 0}],activityPageXYBZBossInfo:[function(e,t){"use strict";cc._RF.push(t,"9a37591pChM87dhSgHcyJDp","activityPageXYBZBossInfo");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=cc._decorator,o=r.ccclass,s=r.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_spBoss=null,t.p_proHp=null,t.p_labHp=null,t.p_btnFight=null,t.p_btnMop=null,t.m_data=null,t.m_bossDie=!1,t.m_target=null,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){var e=this;a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.p_btnFight.node.on("click",function(){e.onFight()}),this.p_btnMop.node.on("click",function(){e.onConfirmMop()})},t.prototype.onEnable=function(){e.prototype.onEnable.call(this),eventMgr.on(eventStr.xybz.refreshBattle,this.refreshBattleResult,this)},t.prototype.onDisable=function(){e.prototype.onDisable.call(this),eventMgr.off(eventStr.xybz.refreshBattle,this.refreshBattleResult,this)},t.prototype.setParam=function(e){this.m_data=e.data,this.m_target=e.target,this.refreshUI()},t.prototype.refreshUI=function(){this.p_btnMop.node.active=this.m_data.lastDamage,this.m_bossDie=this.m_data.bossHP<this.m_data.totalDamage;var e=Math.max(this.m_data.bossHP-this.m_data.totalDamage,0);this.p_proHp.progress=e/this.m_data.bossHP,this.p_labHp.string=e+"/"+this.m_data.bossHP},t.prototype.onFight=function(){if(app.player.getServerTime()>=(gUtils.getActivityArrTime("XYBZ")[1]||0))app.showNotice(window.langMgr.getString("ActivityZHDPageSoul",3));else if(!this.m_bossDie)if(app.player.getCount(30024)<1){var e=app.db.getPropsName(30024);app.showNotice(window.langMgr.getString("playerData",0,e))}else app.goToBossBattle("xybzboss",this.m_data)},t.prototype.onConfirmMop=function(){if(app.player.getServerTime()>=(gUtils.getActivityArrTime("XYBZ")[1]||0))app.showNotice(window.langMgr.getString("ActivityZHDPageSoul",3));else if(!this.m_bossDie)if(app.player.getCount(30024)<=0){var e=app.db.getPropsName(30024);app.showNotice(window.langMgr.getString("playerData",0,e))}else{var t=this.m_data.bossHP-this.m_data.totalDamage,a=Math.ceil(t/this.m_data.lastDamage),i={gsid:30024,maxcount:Math.min(a,app.player.getCount(30024)),type:"nums",tips:window.langMgr.getString("bigBattleBossInfoPage",14),coin:30024,confirmcb:this.onMop,target:this};app.pages.windowspagesetnum.showPage(i)}},t.prototype.onMop=function(e){var t={content:window.langMgr.getString("windowsPageZhanYiBoss",2,[this.m_data.lastDamage,e]),confirmcb:function(){var t=this;app.player.sfXybzGodFarm(e,function(a,i){a?"not open"==a&&app.showNotice(window.langMgr.getString("ActivityZHDPageSoul",3)):(app.showNotice(window.langMgr.getString("activityPageXYBZBossInfo",1)),app.player.reduceItem({GSID:30024,COUNT:e}),t.refreshBattleResult(i))})},target:this};app.pages.windowspagetipsmsg.showPage(t)},t.prototype.refreshBattleResult=function(e){e.totalDamage&&(this.m_data.totalDamage=e.totalDamage),e.damge&&(this.m_data.lastDamage=e.damge),this.refreshUI(),this.m_data.totalDamage>=this.m_data.bossHP&&(app.showNotice(window.langMgr.getString("activityPageXYBZBossInfo",0)),eventMgr.emit(eventStr.xybz.bossDieAnim,e),this.onClose())},t.prefabPath="activityPageXYBZBossInfo",t.pageType=1,n([s(sp.Skeleton)],t.prototype,"p_spBoss",void 0),n([s(cc.ProgressBar)],t.prototype,"p_proHp",void 0),n([s(cc.Label)],t.prototype,"p_labHp",void 0),n([s(cc.Button)],t.prototype,"p_btnFight",void 0),n([s(cc.Button)],t.prototype,"p_btnMop",void 0),a=n([o],t)}(e("basePage"));t.exports=p,cc._RF.pop()},{basePage:void 0}],activityPageXYBZGuard:[function(e,t){"use strict";cc._RF.push(t,"3fa75XZUIVP/YbH16RzFObw","activityPageXYBZGuard");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=cc._decorator,o=r.ccclass,s=r.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_nodeItemContent=null,t.p_nodeItem=null,t.p_btnFight=null,t.m_data=null,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){var e=this;a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.p_btnFight.node.on("click",function(){app.playSound("click"),e.onFight()})},t.prototype.setParam=function(e){this.m_data=e,this.refreshUI()},t.prototype.refreshUI=function(){var e=this.m_data.bset,t=[];for(var a in e)t.push(e[a]);for(var i=0;i<t.length;i++){var n=this.p_nodeItemContent.children[i];n||((n=cc.instantiate(this.p_nodeItem)).parent=this.p_nodeItemContent,n.scale=.8),n.active=!0;var r=app.db.getGBaseByGsid(t[i].gsid);n.getComponent("generalPortraitItem").initReport(r,t[i])}},t.prototype.onFight=function(){app.battleParam={row:this.m_data.index,col:this.m_data.sub},app.battleConfig=gUtils.deepClone(this.m_data.bset);var e=[];for(var t in this.m_data.bufflist)e.push({key:this.m_data.bufflist[t]});app.xiyuSpecialbuff=e,app.battleType="xiyubz",app.goToNormBattle(),this.onClose()},t.prefabPath="activityPageXYBZGuard",t.pageType=1,n([s(cc.Node)],t.prototype,"p_nodeItemContent",void 0),n([s(cc.Prefab)],t.prototype,"p_nodeItem",void 0),n([s(cc.Button)],t.prototype,"p_btnFight",void 0),a=n([o],t)}(e("basePage"));t.exports=p,cc._RF.pop()},{basePage:void 0}],activityPageXYBZMap:[function(e,t){"use strict";cc._RF.push(t,"58b60D+sJRLRp/5nsVkumn8","activityPageXYBZMap");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=cc._decorator,o=r.ccclass,s=r.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_nodeNormal=null,t.p_nodeItemContent=null,t.p_nodeItem=null,t.p_nodeBoss=null,t.p_nodeBossRewardContent=null,t.p_nodeRewardItem=null,t.p_btnBack=null,t.p_sprTitle=null,t.p_sprFTitle=[],t.p_nodeBuffContent=null,t.p_nodeBuffItem=null,t.p_nodeBossSp=null,t.p_spAnim=null,t.p_nodeBag=null,t.p_sprAnimIcon=null,t.p_labBossTalk=null,t.m_data=null,t.m_showNode=[],t.m_bossDie=!1,t.m_arrBuff=[],t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){var e=this;a.instance=this,this.stopBgNodeEvent(),this.fitTopMenu(),this.handleUI(),this.p_btnBack.node.on("click",function(){app.playSound("click"),e.onClickClose()}),this.p_nodeBossSp.on("touchend",function(){app.playSound("click"),app.pages.activityPageXYBZBossInfo.showPage({data:e.m_data,target:e})}),this.p_nodeBuffItem.on("touchend",function(){e.showBuff(0)}),this.p_spAnim.setCompleteListener(function(){e.p_spAnim.node.active=!1,e.refreshBoss()});var t=Math.floor(3*Math.random());this.p_labBossTalk.string=window.langMgr.getString("activityPageXYBZBossInfo",[2,3,4][t])},t.prototype.onEnable=function(){e.prototype.onEnable.call(this),eventMgr.on(eventStr.xybz.refreshEvent,this.refreshEvent,this),eventMgr.on(eventStr.xybz.refreshBattle,this.refreshBattleResult,this),eventMgr.on(eventStr.xybz.bossDieAnim,this.playBossDieAnim,this)},t.prototype.onDisable=function(){e.prototype.onDisable.call(this),eventMgr.off(eventStr.xybz.refreshEvent,this.refreshEvent,this),eventMgr.off(eventStr.xybz.refreshBattle,this.refreshBattleResult,this),eventMgr.off(eventStr.xybz.bossDieAnim,this.playBossDieAnim,this)},t.prototype.setParam=function(e){this.m_data=e,"boss"==this.m_data.type?this.refreshBoss():this.refreshNormal()},t.prototype.playBossDieAnim=function(e){e.totalDamage&&(this.m_data.totalDamage=e.totalDamage),app.playSound("xybzboss"),this.p_spAnim.node.active=!0},t.prototype.refreshBoss=function(){this.p_nodeBoss.active=!0,this.p_nodeNormal.active=!1,this.p_sprTitle.spriteFrame=this.p_sprFTitle[1],this.m_bossDie=this.m_data.totalDamage>=this.m_data.bossHP,this.p_nodeBossSp.active=!this.m_bossDie;for(var e=this.m_data.bossReward,t=0;t<e.length;t++){var a=this.p_nodeBossRewardContent.children[t];a||((a=cc.instantiate(this.p_nodeRewardItem)).parent=this.p_nodeBossRewardContent),a.active=!0,a.getComponent("xybzBossReward").refreshUI({data:e[t],index:t,target:this,open:this.m_bossDie})}for(t=e.length;t<this.p_nodeBossRewardContent.children.length;t++)this.p_nodeBossRewardContent.children[t].active=!1},t.prototype.refreshNormal=function(){app.xybzClick=!0,this.p_nodeBoss.active=!1,this.p_nodeNormal.active=!0,this.p_sprTitle.spriteFrame=this.p_sprFTitle[0],this.m_showNode=[],this.m_arrBuff=this.m_data.buff,this.refreshFloor(),this.refreshBuff()},t.prototype.refreshFloor=function(){for(var e=this.setStatus(this.m_data.map),t=0,a=0;a<e.length;a++){for(var i=[],n=0;n<e[a].length;n++){var r=this.p_nodeItemContent.children[t];r||((r=cc.instantiate(this.p_nodeItem)).parent=this.p_nodeItemContent),r.active=!0,r.getComponent("xybzMapItem").refreshUI({index:a,sub:n,data:e[a][n],mapID:this.m_data.mapID,target:this}),i.push(r),t++}this.m_showNode.push(i)}for(a=t;a<this.p_nodeItemContent.children.length;a++)this.p_nodeItemContent.children[a].active=!1},t.prototype.setStatus=function(e){for(var t=[],a=0;a<e.length;a++)for(var i=0;i<e[a].length;i++)"guard"==(r=e[a][i]).event&&r.open&&!r.finish&&t.push([a,i]);var n=[];if(t)for(a=0;a<t.length;a++){var r;(r=t[a])[0]>0&&n.push([r[0]-1,r[1]]),r[1]>0&&n.push([r[0],r[1]-1]),r[0]>0&&r[1]>0&&n.push([r[0]-1,r[1]-1]),r[0]<5&&n.push([r[0]+1,r[1]]),r[1]<4&&n.push([r[0],r[1]+1]),r[0]<5&&r[1]<4&&n.push([r[0]+1,r[1]+1]),r[0]>0&&r[1]<4&&n.push([r[0]-1,r[1]+1]),r[0]<5&&r[1]>0&&n.push([r[0]+1,r[1]-1])}for(a=0;a<e.length;a++)for(i=0;i<e[a].length;i++)for(var o=0;o<n.length;o++)n[o][0]==a&&n[o][1]==i&&e[a][i].lock&&(e[a][i].x=!0);return e},t.prototype.refreshEvent=function(e){var t=this;app.player.sfXybzSearch(null,function(e,a){e?"not open"==e&&app.showNotice(window.langMgr.getString("ActivityZHDPageSoul",3)):t.setParam(a)}),e.gsid&&this.playRewardAnim(e)},t.prototype.playRewardAnim=function(e){var t=this;this.p_nodeBag.opacity=255,this.p_nodeBag.stopAllActions(),this.p_sprAnimIcon.node.stopAllActions(),this.p_sprAnimIcon.node.opacity=0;var a=app.db.getPropsIconPath(e.gsid);app.loadTexture(a,this.p_sprAnimIcon,this.prefabPath,function(){t.p_sprAnimIcon.node.opacity=255,t.p_sprAnimIcon.node.position=e.pos;var a=cc.v2(t.p_nodeBag.x,t.p_nodeBag.y),i=cc.fadeOut(0);t.p_sprAnimIcon.node.runAction(cc.sequence(cc.moveTo(.5,a),i)),t.scheduleOnce(function(){t.p_nodeBag.runAction(cc.fadeOut(1))},.5)})},t.prototype.checkReward=function(){if("boss"==this.m_data.type){for(var e=this.m_data.bossReward,t=0;t<e.length;t++)if(!e[t].open)return!0;return!1}var a=this.m_data.map;for(t=0;t<a.length;t++)for(var i=0;i<a[t].length;i++)if(("nreward"==a[t][i].event||"hreward"==a[t][i].event)&&!a[t][i].finish)return!0;return!1},t.prototype.onClickClose=function(){var e=this,t=this.getReward(),a=function(){var a=this;app.player.sfXybzEnd(function(i){if(!i){if(eventMgr.emit(eventStr.commonEvent.RefershActivityZhdCoinUi),eventMgr.emit(eventStr.xybz.refreshStatus),t&&t.length){var n={showtype:1,reward:t,confirmcb:function(){},target:a};app.pages.windowspagereward.showPage(n)}e.onClose()}})};if(this.checkReward()){var i={endFun:a,backFun:function(){eventMgr.emit(eventStr.commonEvent.RefershActivityZhdCoinUi),eventMgr.emit(eventStr.xybz.refreshStatus),e.onClose()},target:this};app.pages.windowsPageXybzMsg.showPage(i)}else a()},t.prototype.getReward=function(){var e=[];if("boss"==this.m_data.type)for(var t=0;t<this.m_data.bossReward.length;t++)this.m_data.bossReward[t].open&&e.push(this.m_data.bossReward[t].reward[0]);else{var a={},i=this.m_data.map;for(t=0;t<i.length;t++)for(var n=0;n<i[t].length;n++)if(("nreward"==i[t][n].event||"hreward"==i[t][n].event)&&i[t][n].finish){var r=i[t][n].reward[0];a[r.GSID]?a[r.GSID]+=r.COUNT:a[r.GSID]=r.COUNT}for(var o in a)e.push({GSID:o,COUNT:a[o]})}return console.log(e),e},t.prototype.refreshBattleResult=function(e){var t=this;"win"==e.result.ret&&"boss"!=this.m_data.type&&app.player.sfXybzSearch(null,function(e,a){e?"not open"==e&&app.showNotice(window.langMgr.getString("ActivityZHDPageSoul",3)):t.setParam(a)})},t.prototype.refreshBuff=function(){for(var e=this,t=function(t){var i=a.p_nodeBuffContent.children[t];i||((i=cc.instantiate(a.p_nodeBuffItem)).parent=a.p_nodeBuffContent,i.on("touchend",function(){e.showBuff(t)})),i.active=!0;var n=i.getComponent(cc.Sprite),r=app.db.getDungeonBuffInfo(a.m_arrBuff[t].ID||a.m_arrBuff[t].id),o=gConfig.getDungeonBuffPath(r.BPATH);app.loadTexture(o,n,a.prefabPath)},a=this,i=0;i<this.m_arrBuff.length;i++)t(i);for(i=this.m_arrBuff.length;i<this.p_nodeBuffContent.children.length;i++)this.p_nodeBuffContent.children[i].active=!1},t.prototype.showBuff=function(e){var t=this.m_arrBuff[e];app.pages.windowsPageXYBZTipsSkill.showPage({data:t,target:this})},t.prefabPath="activityPageXYBZMap",n([s(cc.Node)],t.prototype,"p_nodeNormal",void 0),n([s(cc.Node)],t.prototype,"p_nodeItemContent",void 0),n([s(cc.Node)],t.prototype,"p_nodeItem",void 0),n([s(cc.Node)],t.prototype,"p_nodeBoss",void 0),n([s(cc.Node)],t.prototype,"p_nodeBossRewardContent",void 0),n([s(cc.Node)],t.prototype,"p_nodeRewardItem",void 0),n([s(cc.Button)],t.prototype,"p_btnBack",void 0),n([s(cc.Sprite)],t.prototype,"p_sprTitle",void 0),n([s(cc.SpriteFrame)],t.prototype,"p_sprFTitle",void 0),n([s(cc.Node)],t.prototype,"p_nodeBuffContent",void 0),n([s(cc.Node)],t.prototype,"p_nodeBuffItem",void 0),n([s(cc.Node)],t.prototype,"p_nodeBossSp",void 0),n([s(sp.Skeleton)],t.prototype,"p_spAnim",void 0),n([s(cc.Node)],t.prototype,"p_nodeBag",void 0),n([s(cc.Sprite)],t.prototype,"p_sprAnimIcon",void 0),n([s(cc.Label)],t.prototype,"p_labBossTalk",void 0),a=n([o],t)}(e("basePage"));t.exports=p,cc._RF.pop()},{basePage:void 0}],activityPageXYBZ:[function(e,t){"use strict";cc._RF.push(t,"3e55cHllENHBqzhhHsWtwXf","activityPageXYBZ");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=cc._decorator,o=r.ccclass,s=r.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_labTime=null,t.p_nodeItemContent=null,t.p_nodeItem=null,t.p_btnNormal=null,t.p_btnHigh=null,t.p_btnAgain=null,t.p_btnHelp=null,t.p_sprNormalCost=null,t.p_labNormalCost=null,t.p_sprHighCost=null,t.p_labHighCost=null,t.p_sprExtraCost=null,t.p_labExtreCost=null,t.p_spAnim=null,t.m_data=null,t.m_mapData=null,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){var e=this;a.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.p_btnNormal.node.on("click",function(){app.playSound("click"),e.startTreasure("normal")}),this.p_btnHigh.node.on("click",function(){app.playSound("click"),e.startTreasure("high")}),this.p_btnAgain.node.on("click",function(){app.playSound("click"),e.startTreasure()}),this.p_btnHelp.node.on("click",function(){app.playSound("click"),app.pages.windowspagetipshelp.showPage(1116)}),this.schedule(this.refreshTime,1),this.p_spAnim.node.active=!1,this.p_spAnim.setCompleteListener(function(){e.p_spAnim.node.active=!1,app.pages.activityPageXYBZMap.showPage(e.m_mapData)})},t.prototype.onEnable=function(){e.prototype.onEnable.call(this),eventMgr.on(eventStr.xybz.refreshStatus,this.getData,this),this.getData()},t.prototype.onDisable=function(){e.prototype.onDisable.call(this),eventMgr.off(eventStr.xybz.refreshStatus,this.getData,this)},t.prototype.getData=function(){var e=this;app.player.sfXybzInfo(function(t,a){t?"not open"==t&&app.showNotice(window.langMgr.getString("ActivityZHDPageSoul",3)):(e.m_data=a,e.refreshUI())})},t.prototype.start=function(){},t.prototype.refreshUI=function(){this.p_btnNormal.node.active=!this.m_data.status,this.p_btnHigh.node.active=!this.m_data.status&&2==this.m_data.setting.length,this.p_btnAgain.node.active=this.m_data.status;for(var e=this.m_data.reward,t=0;t<e.length;t++){var a=this.p_nodeItemContent.children[t];a||((a=cc.instantiate(this.p_nodeItem)).parent=this.p_nodeItemContent),a.active=!0,a.getComponent("xybzRewadItem").refreshUI(e[t])}for(t=e.length;t<this.p_nodeItemContent.children.length;t++)this.p_nodeItemContent.children[t].active=!1;if(!this.m_data.status)for(t=0;t<this.m_data.setting.length;t++)this.refreshCost(this.m_data.setting[t]);this.refreshTime()},t.prototype.refreshTime=function(){var e=app.player.getServerTime(),t=gUtils.getActivityArrTime("XYBZ")[1]||0,a=t-e;(!t||a<0)&&(a=0),this.p_labTime.string=0!=a?gUtils.getCountDownStr(a):"00:00:00"},t.prototype.refreshCost=function(e){if("normal"==e.id){var t=e.cost[0],a=app.db.getPropsIconPath(t.GSID);app.loadTexture(a,this.p_sprNormalCost,this.prefabPath),this.p_labNormalCost.string=t.COUNT}else{t=e.cost[0],a=app.db.getPropsIconPath(t.GSID),app.loadTexture(a,this.p_sprHighCost,this.prefabPath),this.p_labHighCost.string=t.COUNT;var i=e.cost[1],n=app.db.getPropsIconPath(i.GSID);app.loadTexture(n,this.p_sprExtraCost,this.prefabPath),this.p_labExtreCost.string=i.COUNT}},t.prototype.startTreasure=function(e){if(void 0===e&&(e=null),!this.checkCost(e)){var t=this,a=function(){app.player.sfXybzSearch(e,function(a,i){a?"not open"==a&&app.showNotice(window.langMgr.getString("ActivityZHDPageSoul",3)):(t.m_mapData=i,e?(app.playSound("xybzopen"),t.p_spAnim.node.active=!0):app.pages.activityPageXYBZMap.showPage(t.m_mapData),app.player.sfPlayerByParam(["others","props","hide"],function(){}))})};if("high"==e){var i={content:window.langMgr.getString("activityPageXYBZ",0),confirmcb:function(){a()},target:this};app.pages.windowspagetipsmsg.showPage(i)}else a()}},t.prototype.checkCost=function(e){for(var t=0;t<this.m_data.setting.length;t++)if(this.m_data.setting[t].id==e)for(var a=this.m_data.setting[t].cost,i=0;i<a.length;i++)if(app.player.getCount(a[i].GSID)<a[i].COUNT){var n=app.db.getPropsInfoByGsid(a[i].GSID);return app.showNotice(window.langMgr.getString("playerData",0,n.NAME)),!0}return!1},t.prefabPath="activityPageXYBZ",t.pageType=1,n([s(cc.Label)],t.prototype,"p_labTime",void 0),n([s(cc.Node)],t.prototype,"p_nodeItemContent",void 0),n([s(cc.Node)],t.prototype,"p_nodeItem",void 0),n([s(cc.Button)],t.prototype,"p_btnNormal",void 0),n([s(cc.Button)],t.prototype,"p_btnHigh",void 0),n([s(cc.Button)],t.prototype,"p_btnAgain",void 0),n([s(cc.Button)],t.prototype,"p_btnHelp",void 0),n([s(cc.Sprite)],t.prototype,"p_sprNormalCost",void 0),n([s(cc.Label)],t.prototype,"p_labNormalCost",void 0),n([s(cc.Sprite)],t.prototype,"p_sprHighCost",void 0),n([s(cc.Label)],t.prototype,"p_labHighCost",void 0),n([s(cc.Sprite)],t.prototype,"p_sprExtraCost",void 0),n([s(cc.Label)],t.prototype,"p_labExtreCost",void 0),n([s(sp.Skeleton)],t.prototype,"p_spAnim",void 0),a=n([o],t)}(e("basePage"));p.refreshRed=function(){return!1},t.exports=p,cc._RF.pop()},{basePage:void 0}],activityPageXfzhRw:[function(e,t){"use strict";cc._RF.push(t,"27186V0rJ9Ez6J7XtlOpR1i","activityPageXfzhRw");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activitypagexfzhrw",pageParent:"activitypagexfzh"},properties:{p_scrView:cc.ScrollView,p_nodeItem:cc.Node,p_btnHelp:cc.Button,p_labTime:cc.Label},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.fitTopMenu(),this.p_btnHelp.node.on("click",function(){app.pages.windowspagetipshelp.showPage("1036")})},setParam:function(){this.m_arrData=this.getData(app.db.dbVanguard),this.refreshUI()},onEnable:function(){this._super(),eventMgr.on(eventStr.commonEvent.RefreshTime,this.refreshTime,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.commonEvent.RefreshTime,this.refreshTime,this)},getData:function(e){var t=[];if(!e||e.length<=0)return t;for(var a=0;a<e.length;a++){var i=e[a],n={};n.level=i.LEVEL,n.items=i.COST,n.exit=i.EXIT,app.player.level>=i.LEVEL?app.player.getCount(i.MARK)<=0?n.status=1:n.status=2:n.status=0,t.push(n)}return t},refreshUI:function(){if(this.m_arrData){for(var e=[],t=[],a=[],i=0;i<this.m_arrData.length;++i){var n=this.m_arrData[i];switch(n.index=i,n.status){case 0:t.push(n);break;case 1:e.push(n);break;case 2:a.push(n)}}e=(e=e.concat(t)).concat(a),this.refreshSView(e)}},refreshTime:function(){var e=app.player.getServerTime(),t=gUtils.getActivityArrTime("DJJF")[1]||0,a=t-e;(!t||a<0)&&(a=0),this.p_labTime.string=0!=a?gUtils.getCountDownStr(a):"00:00:00"},refreshSView:function(e){this.m_arrItems||(this.m_arrItems=[],this.m_arrItems.push(this.p_nodeItem));for(var t=0;t<e.length;++t){var a=this.m_arrItems[t];a||((a=cc.instantiate(this.p_nodeItem)).parent=this.p_scrView.content,this.m_arrItems.push(a)),a.active=!0}for(var i=0;i<e.length;++i){var n={data:e[i],target:this,confrom:this.refreshUI};this.m_arrItems[i].getComponent("activityXfzhRwItem").refreshUI(n)}for(var r=e.length;r<this.m_arrItems.length;++r)this.m_arrItems[r].active=!1}});a.refreshRed=function(e){var t=app.db.dbVanguard.some(function(e){return app.player.level>=e.LEVEL&&app.player.getCount(e.MARK)<=0});return e&&(e.active=t),t},cc._RF.pop()},{basePage:void 0}],activityPageXfzhToChange:[function(e,t){"use strict";cc._RF.push(t,"6595beJZDZPmoPgOXYl9t/o","activityPageXfzhToChange");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activityxfzhtochange",pageParent:"activitypagexfzhto"},properties:{p_scrView:cc.ScrollView,p_pfbItem:cc.Prefab},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},setParam:function(){var e=this;this.m_data?this.refreshUI():app.player.sfVanguardGeneral(function(t,a){t||(e.m_data=e.getData(a),e.refreshUI())})},onEnable:function(){this._super()},onDisable:function(){this._super()},getData:function(e){for(var t=[],a=[],i=0;i<e.length;i++){var n=e[i],r=app.db.getGBaseByGsid(n.GSID);a[r.TGRADE]=a[r.TGRADE]||[],a[r.TGRADE].push(n)}for(var o=a.length-1;o>=0;o--)a[o]&&t.push({tgrade:o,array:a[o]});return t},refreshUI:function(){this.refreshSView(this.m_data)},refreshSView:function(e){this.m_arrItems||(this.m_arrItems=[]);for(var t=0;t<e.length;++t){var a=this.m_arrItems[t];a||((a=cc.instantiate(this.p_pfbItem)).parent=this.p_scrView.content,this.m_arrItems.push(a)),a.getComponent("activityXfzhToChItem").refreshUI(e[t]),a.active=!0}for(var i=e.length;i<this.m_arrItems.length;++i)this.m_arrItems[i].active=!1}});a.refreshRed=function(){return!1},cc._RF.pop()},{basePage:void 0}],activityPageXfzhTo:[function(e,t){"use strict";cc._RF.push(t,"a493f9aXg9MQp+cNao6DRJE","activityPageXfzhTo");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activitypagexfzhto",pageType:1},properties:{p_labTime:cc.Label,p_btnHelp:cc.Button,p_btnChan:cc.Button,p_btnOne:cc.Button,p_sprIconOne:cc.Sprite,p_labOne:cc.Label,p_btnTen:cc.Button,p_sprIconTen:cc.Sprite,p_labTen:cc.Label,p_labGuaranteed:cc.Label,p_checkbox:cc.Toggle,p_btnTake:cc.Button},_isNetWorking:!1,onLoad:function(){this.handleUI(),this.creatMask(!0),a.instance=this,this.stopBgNodeEvent()},onEnable:function(){this._super()},onDisable:function(){this._super()},handleUI:function(){var e=this;this._super(),this.p_btnTake.node.on("click",function(){app.pages.activitypagexfzh.showPage(1),e.onClose()})},setParam:function(){this.m_data=[{GSID:30108,COUNT:1},{GSID:30108,COUNT:10}],this.refresh()},refresh:function(){},checkboxClickHandle:function(e){localDataUtils.SetValue(DRAW_CARD_SHOW_ANIM,e.isChecked?"0":"1")},refreshBtnIcon:function(){var e=app.db.getPropsIconPath(this.m_data[0].GSID);app.loadTexture(e,this.p_sprIconOne,this.prefabPath),this.p_labOne.string="x"+this.m_data[0].COUNT;var t=app.db.getPropsIconPath(this.m_data[1].GSID);app.loadTexture(t,this.p_sprIconTen,this.prefabPath),this.p_labTen.string="x"+this.m_data[1].COUNT},refreshGeneral:function(){},refreshTime:function(){var e=app.player.getServerTime(),t=app.player.vanguard.end||0,a=t-e;(!t||a<0)&&(a=0),this.p_labTime.string=0!=a?gUtils.getCountDownStr(a):"00:00:00"},onClose:function(){this._super()}});a.refreshRed=function(){return!1},cc._RF.pop()},{basePage:void 0}],activityPageXfzh:[function(e,t){"use strict";cc._RF.push(t,"a50444x/6JNYKxg/q2gj67a","activityPageXfzh");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activitypagexfzh"},properties:{p_nodeBg:cc.Node,p_top:cc.Node},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.fitTopMenu()},onEnable:function(){this._super()},onDisable:function(){this._super()},setParam:function(e){this.showCardrec(e,e.force||0)},againcb:function(){var e=this;app.player.sfVanguardPreview(1,function(t,a){e.showCardrec(a,1)})},showCardrec:function(e,t){for(var a=[],i=0===t,n=0;n<e.length;n++){var r=e[n];a.push({gsid:r,count:1})}var o={reward:a,isDraw:!0,force:1===t?1:0,againcb:this.againcb,target:this,againparm:[],quickshowcard:i};app.pages.cardrecruitingpage.showPage(o)}});a.refreshRed=function(e){return e&&(e.active=!1),!1},a.isOpen=function(){return app.player.getServerTime()<=(app.player.vanguard.end||0)},a.showPage=function(t){var a=this;void 0===t&&(t=0),app.player.sfVanguardPreview(t,function(i,n){if(i)return app.showNotice(i);n.force=t,e("basePage").showPage.call(a,n)})},cc._RF.pop()},{basePage:void 0}],activityPage:[function(e,t){"use strict";cc._RF.push(t,"642f5wQHPlPk4KEp/aLF+/S","activityPage");var a=[{page:"activityydhdpage"},{page:"activityzhdpage"},{page:"activitynovicepage"}],i=cc.Class({extends:e("basePage"),statics:{prefabPath:"activitypage"},properties:{p_nodeBg:cc.Node},onLoad:function(){i.instance=this,this.stopBgNodeEvent(),this.creatMask(),this.handleUI(),this.m_menu=this.node.getComponent("menu"),this.m_menu.init(this)},onEnable:function(){this._super(),eventMgr.on(eventStr.redEvent.RefreshActivityRed,this.refreshRed,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.redEvent.RefreshActivityRed,this.refreshRed,this)},handleUI:function(){this._super()},menuHandler:function(e){a[e]&&this.openShopPage(e)},setParam:function(e){void 0===e&&(e=1);var t=e;this.m_menu.p_arrBtnMenu[2].active=!app.pages.activitynovicepage.isOver(),this.m_menu.p_arrBtnMenu[1].active=app.db.checkFuncUnLock("ACTIVITY_ZHD"),app.arrZhdTime&&0==app.arrZhdTime.GJDL.state&&(this.m_menu.p_arrBtnMenu[1].active=!1),this.m_menu.p_arrBtnMenu[0].active=app.db.checkFuncUnLock("ACTIVITY_YDDH"),this.m_menu.p_arrBtnMenu[t].active||(t=0),this.m_menu.p_arrBtnMenu[t].active||(t=1),this.m_menu.p_arrBtnMenu[t].active||(t=2),this.m_menu.setMenuIndex(t)},openShopPage:function(e){var t=this,i=app.pages[a[e].page],n=function(){i.showPage(null,t.p_nodeBg,function(){t.m_showPage=i.instance,t.m_showPage.node.opacity=0,t.m_showPage.node.runAction(cc.fadeIn(.1))})};this.m_showPage?(this.m_showPage.node.active=!0,this.m_showPage.node.runAction(cc.sequence(cc.fadeOut(.1),cc.callFunc(function(){t.m_showPage.onClose(),t.m_showPage=null,n()})))):n(),this.refreshRed()},openShopPageByArr:function(e){var t=this,i=e;e instanceof Array&&(i=e.shift()),this.m_menu.p_arrBtnMenu.forEach(function(e,t){e.getComponent("menuBtnItem")&&e.getComponent("menuBtnItem").select(t==i)}),this.m_menu.m_numMenuIndex=i;var n=app.pages[a[i].page],r=function(){var a=null;e instanceof Array&&(a=e.shift()),n.showPage(a,t.p_nodeBg,function(){t.m_showPage=n.instance,t.m_showPage.node.opacity=0,t.m_showPage.node.runAction(cc.fadeIn(.1))})};this.m_showPage?(this.m_showPage.node.active=!0,this.m_showPage.node.runAction(cc.sequence(cc.fadeOut(.1),cc.callFunc(function(){t.m_showPage.onClose(),t.m_showPage=null,r()})))):r()},refreshMenuRed:function(e){var t=a[e];return app.pages[t.page].refreshRed()},refreshRed:function(){this.m_menu.refreshRed()},onClose:function(){this.m_showPage&&cc.isValid(this.m_showPage.node)&&this.m_showPage.onClose(),this._super()}});i.refreshRed=function(e){for(var t=!1,i=0;i<a.length;i++){var n=a[i];if(t=app.pages[n.page].refreshRed())break}return e&&(e.active=t),t},cc._RF.pop()},{basePage:void 0}],activityQiriChoisePage:[function(e,t){"use strict";cc._RF.push(t,"a1ac85gW5VOMq/aghQsf8Y9","activityQiriChoisePage");var a=[[10001,12081,14141],[10222,12202,14262]],i=e("dbCampaignHelp").THREECHOOSEONE,n=cc.Class({extends:e("basePage"),statics:{prefabPath:"activityqirichoisepage"},properties:{p_arrHero:[cc.Node],p_arrType:[cc.Node],p_arrBtn:[cc.Button],p_btnFight:cc.Button},onLoad:function(){n.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){var e=this;this._super();for(var t=function(t){e.p_arrHero[t].on("touchend",function(){var i={type:2,gsid:a[e.m_type][t]};app.pages.generalpage.showPage(i,e.bgNode)}),e.p_arrBtn[t].node.on("click",function(){app.playSound("click"),e.onClickGet(t)})},i=0;i<this.p_arrHero.length;++i)t(i);this.p_btnFight.node.on("click",function(){app.playSound("click"),e.onClose(),e.m_isGoto()})},setParam:function(e){this.m_type=e.type,this.m_confirmcb=e.confirmcb,this.m_isLock=e.isLock,this.m_isGoto=e.Goto,this.refreshUI()},refreshUI:function(){var e=this;switch(this.p_arrType.forEach(function(t,a){t.active=a==e.m_type}),this.p_arrBtn.forEach(function(t){t.interactable=!e.m_isLock}),this.m_type){case 0:break;case 1:this.refreshThreeChooseOne()}},refreshThreeChooseOne:function(){var e=app.player.maxmapid,t=i[0].MINMAP;this.p_btnFight.interactable=e<=t},onClickGet:function(e){this.m_confirmcb&&this.m_confirmcb(e),this.onClose()}});cc._RF.pop()},{basePage:void 0,dbCampaignHelp:void 0}],activityQiriPage:[function(e,t){"use strict";cc._RF.push(t,"f1ba0gaeOlCZIRmqmSu00So","activityQiriPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activityqiripage",pageType:1},properties:{p_arrShow:[cc.Node],p_pfbProp:cc.Prefab,p_arrDayItem:[cc.Node],p_nodeRewardList:cc.Node,p_labDayPick:cc.Label,p_btnGet:cc.Button,p_nodeRed:cc.Node,p_nodeMrlq:cc.Node,p_nodeLq:cc.Node},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},onEnable:function(){eventMgr.on(eventStr.activityQiriPage.RefreshReward,this.onClickDayItem,this)},onDisable:function(){eventMgr.off(eventStr.activityQiriPage.RefreshReward,this.onClickDayItem,this)},handleUI:function(){var e=this;this._super(),this.p_arrDayItem.forEach(function(t,a){t.on("touchend",function(){e.onClickDayItem(a)})}),this.p_btnGet.node.on("click",function(){var t=e.m_arrData[e.m_pickedIndex].REWARD[0];if("general"==app.db.getTypeByGsid(t.GSID)&&app.player.gnum+1>app.player.bagspace){var a={content:langMgr.getString("activityQiriPage",8),confirmcb:function(){app.goToPage(1018)},target:e};app.pages.windowspagetipsmsg.showPage(a)}else e.getReward(e.m_arrData[e.m_pickedIndex].EXID)})},getReward:function(e){var t=this;app.player.sfExchange(e,1,0,function(e){app.player.sfPlayerByParam(["others","vip","hide","props","general","firstcharge","warorder_time"],function(){var a={showtype:1,reward:e,target:t,confirmcb:function(){app.player.getCount(app.db.dbFourteenLogin.SEVENOVER)>0&&app.mainScene&&app.mainScene.refreshTopButton(),app.pages.activitywlzlpage.isOpen()&&eventMgr.emit(eventStr.wlzl.WLZL_SHOW)}};app.pages.windowspagereward.showPage(a),t.refreshUI(),t.refreshBtn(t.m_pickedIndex)})})},setParam:function(){var e=this;this.m_type=app.player.getCount(app.db.dbFourteenLogin.SEVENOVER)>0?1:0,this.p_arrShow.forEach(function(t,a){t.active=Boolean(a==e.m_type)}),0==this.m_type?this.m_showData=gUtils.deepClone(app.db.dbSevenLogin):this.m_showData=gUtils.deepClone(app.db.dbFourteenLogin),this.m_arrData=this.m_showData.REWARD,cc.log("7/14 day reward is",this.m_arrData),this.refreshUI(),this.setDefaultPick()},refreshUI:function(){var e=this,t=app.player.getCount(this.m_showData.LOGINSIGN);this.p_arrDayItem.forEach(function(a,i){a.getComponent("activeQiRiItem").refreshUI(e.m_showData.REWARD[i],i,t,e.m_type)})},refreshBtn:function(e){var t=this.m_arrData[e],a=app.player.getCount(t.GETSIGN),i=app.player.getCount(this.m_showData.LOGINSIGN);this.p_nodeLq.active=!0,this.p_nodeMrlq.active=!1,i>=e+1&&a>0?(this.p_btnGet.interactable=!0,this.p_nodeRed.active=!0):(this.p_btnGet.interactable=!1,this.p_nodeRed.active=!1,this.p_nodeLq.active=!1,this.p_nodeMrlq.active=!0)},refreshReward:function(e){var t=this,a=this.m_type?e+8:e+1;this.p_labDayPick.string="\u7b2c\n"+a+"\n\u5929";var i=this.m_arrData[e].REWARD;this.m_arrRewardsItem||(this.m_arrRewardsItem=[]);var n=this.m_arrData[e],r=app.player.getCount(n.GETSIGN),o=app.player.getCount(this.m_showData.LOGINSIGN),s=!1;o>=e+1&&r>0&&(s=!0),i.forEach(function(e,a){var i=t.m_arrRewardsItem[a];i||((i=cc.instantiate(t.p_pfbProp)).parent=t.p_nodeRewardList,i.y=0,t.m_arrRewardsItem.push(i),i.getComponent("propItem").setClick(!0)),i.getComponent("propItem").initForGsid(e.GSID,e.COUNT),i.getComponent("propItem").setSpine(s,"reward_get_animation/rewardreceivingtips","animation",1.2),i.active=!0});for(var p=i.length;p<this.m_arrRewardsItem.length;++p)this.m_arrRewardsItem[p].active=!1},onClickDayItem:function(e){if(e!=this.m_pickedIndex){this.m_pickedNode&&this.m_pickedNode.getComponent("activeQiRiItem").setPick(!1);var t=this.p_arrDayItem[e];t.getComponent("activeQiRiItem").setPick(!0),this.m_pickedNode=t,this.m_pickedIndex=e,this.refreshBtn(e),this.refreshReward(e)}},setDefaultPick:function(){for(var e=app.player.getCount(this.m_showData.LOGINSIGN),t=Math.max(e-1,0),a=0;a<this.m_showData.REWARD.length;++a){var i=this.m_showData.REWARD[a];app.player.getCount(i.GETSIGN)>0&&e>=a+1&&(t=a)}this.onClickDayItem(t)},onClose:function(){this._super()}});a.isOver=function(e){var t=app.player.getCount(app.db.dbFourteenLogin.SEVENOVER),a="game_ui/04_page/mainscene/active_icon/btn_hd_qrdl_lang",i=app.db.dbSevenLogin.REWARD;t>0&&(a="game_ui/04_page/mainscene/active_icon/btn_hd_ssrdl_lang",i=app.db.dbFourteenLogin.REWARD),e&&app.loadTexture(a,e,assetMsg.cacheNoReleaseKey.MainScene);for(var n=0;n<i.length;++n)if(app.player.getCount(i[n].GETSIGN)>0)return!1;return!0},a.getRed=function(){var e=!1,t=app.player.getCount(app.db.dbFourteenLogin.SEVENOVER),a=app.player.getCount(app.db.dbSevenLogin.LOGINSIGN),i=app.db.dbSevenLogin.REWARD;t>0&&(a=app.player.getCount(app.db.dbFourteenLogin.LOGINSIGN),i=app.db.dbFourteenLogin.REWARD);for(var n=0;n<i.length;++n)if(app.player.getCount(i[n].GETSIGN)>0&&a>n){e=!0;break}return e},a.refreshRed=function(e){var t=a.getRed();return e&&(e.active=t),t},cc._RF.pop()},{basePage:void 0}],activityQrqdPage:[function(e,t){"use strict";cc._RF.push(t,"181caopjEZI3LhSDQjCGESM","activityQrqdPage");var a=[{GSID:38005,COUNT:888,NAME:"888\u5143\u5b9d"},{GSID:30006,COUNT:10,NAME:"\u9ad8\u7ea7\u62db\u52df\u4ee4*10"}],i=cc.Class({extends:e("basePage"),statics:{prefabPath:"activityqrqdpage",pageType:1},properties:{p_arrNodeProp:[cc.Node]},onLoad:function(){var e=app.player.getServerTime(),t=gUtils.getSecondDayTime(e);localDataUtils.SetValue("QRQD_TODAY_OPENED",1,t),i.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},setParam:function(){this.refreshUI()},refreshUI:function(){for(var e=0;e<this.p_arrNodeProp.length;++e)this.p_arrNodeProp[e].getComponent("propItem").initForBag(a[e]),this.p_arrNodeProp[e].getComponent("propItem").setClick(!0),app.db.getPropsInfoByGsid(a[e].GSID),this.p_arrNodeProp[e].getChildByName("name_label").getComponent(cc.Label).string=a[e].NAME,this.p_arrNodeProp[e].active=!0}});i.isOpen=function(){var e=app.db.checkFuncUnLock("ACTIVITY_QRQD");if(e){var t=gUtils.getActivityArrTime("QRQD"),a=app.player.getServerTime();e=a>t[0]&&a<t[1]}return e},i.isNeedAutoOpen=function(){return i.isOpen()&&!localDataUtils.GetValue("QRQD_TODAY_OPENED",null)},cc._RF.pop()},{basePage:void 0}],activitySgyPage:[function(e,t){"use strict";cc._RF.push(t,"d8e9d6RcNlFpJdKrC68h1bj","activitySgyPage");var a=93311,i=1,n=100,r=cc.Class({extends:e("basePage"),statics:{prefabPath:"activitysgypage",pageType:1},properties:{p_nodeSix:cc.Node,p_nodeHundred:cc.Node,m_arrItem:[cc.Node],p_pfbItem:cc.Prefab,p_nodeParent:cc.Node,p_btnGet:cc.Button,p_nodeGet:cc.Node,p_nodeGo:cc.Node,p_labCharge:cc.Label,p_nodeLq:cc.Node,p_nodeYlq:cc.Node,p_btnGeneral:cc.Node},onLoad:function(){r.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),"JP"===gSetting.getLangName()&&(i=1,n=1880);var e=[56,155,278,376,494,592];this.m_arrItem=[];for(var t=0;t<6;t++){var a=cc.instantiate(this.p_pfbItem);a.parent=this.p_nodeParent,a.scale=.78,a.x=e[t],this.m_arrItem.push(a)}},handleUI:function(){var e=this;this._super();for(var t=0;t<this.m_arrItem.length;++t)this.m_arrItem[t].getComponent("propMaskItem").setClick(!0);this.p_btnGet.node.on("click",function(){app.playSound("click"),e.onClickGet()}),this.p_nodeSix.on("touchend",function(){app.playSound("click"),e.refreshBottom(0)}),this.p_nodeHundred.on("touchend",function(){app.playSound("click"),e.refreshBottom(1)}),this.p_btnGeneral.on("touchend",function(){app.pages.generalpage.showPage({gsid:12047,isShowMode:!0})});for(var a=0;a<this.m_arrItem.length;++a)this.m_arrItem[a].getChildByName("picked").active=!1},setParam:function(){var e=this,t=app.player.getCount(a);if(app.player.getCount(93312),this._allcharge=app.player.getCount(90222),this._allcharge&&!app.player.firstcharge?app.player.sfPlayerByParam(["firstcharge"],function(){e._openday=app.player.firstcharge?app.player.getDayByCreate(app.player.firstcharge):0,e.newMaskGet=app.player.getCount(93313)>0,e.refreshUI(),e.refreshBottom((t>=3||e._openday<=t)&&e._allcharge>=i?1:0)}):(this._openday=app.player.firstcharge?app.player.getDayByCreate(app.player.firstcharge):0,this.newMaskGet=app.player.getCount(93313)>0,this.refreshUI(),this.refreshBottom((t>=3||this._openday<=t)&&this._allcharge>=i?1:0)),null==localDataUtils.GetValue("shouchongred",null)){var n=app.player.getServerTime(),r=gUtils.getSecondDayTime(n);localDataUtils.SetValue("shouchongred",1,r)}},refreshUI:function(){this.p_labCharge.string=langMgr.getString("activitySgyPage",0,this._allcharge)},refreshBottom:function(e){this.m_nIndex=e;for(var t=0;t<this.m_arrItem.length;++t)this.m_arrItem[t].getChildByName("picked").active=!1,this.m_arrItem[t].getComponent("propMaskItem").setGray(!1),this.m_arrItem[t].getComponent("propMaskItem").setClick(!0),this.m_arrItem[t].getComponent("propMaskItem").setRed(!1);var o=app.db.dbFirstCharge[e];if(o&&o.length){this.p_nodeSix.getChildByName("pick").active=0==e,this.p_nodeHundred.getChildByName("pick").active=1==e,this._needcharge=0==e?i:n;var s=0;this._pro=app.player.getCount(0==e?a:93312),this._exid=o[Math.min(2,this._pro)].EXID;for(var p=!0,c=!1,h=0;h<o.length;++h)for(var l=0;l<o[h].ITEMS.length&&!(s>=this.m_arrItem.length);++l){if(this.m_arrItem[s].getComponent("propMaskItem").initForBag(o[h].ITEMS[l]),this.m_arrItem[s].getComponent("propMaskItem").m_porpItem.getComponent("propItem").setSpine(!1),p&&(p=this._pro>h||0==e&&this.newMaskGet),this._pro>h||0==e&&this.newMaskGet)this.m_arrItem[s].getChildByName("picked").active=!0,this.m_arrItem[s].getComponent("propMaskItem").setGray(!0),this.m_arrItem[s].getComponent("propMaskItem").setClick(!1),this.m_arrItem[h].getComponent("propMaskItem").setRed(!1);else if(this._openday>this._pro){var g=this._allcharge>=this._needcharge&&h==this._pro;this.m_arrItem[s].getComponent("propMaskItem").setRed(g),this.m_arrItem[s].getComponent("propMaskItem").m_porpItem.getComponent("propItem").setSpine(g,"square_animation/squareanimation","animation",1.2),c=!0}s++}this.p_btnGeneral.active=0==this.m_nIndex,this._allcharge<this._needcharge?(this.p_nodeGet.active=!1,this.p_nodeGo.active=!0,this.p_btnGet.interactable=!0):(this.p_nodeGet.active=!0,app.setSpriteState(this.p_nodeGet.getComponent(cc.Sprite),!c),this.p_nodeGet.getChildByName("rednotice").active=c,this.p_nodeLq.active=c,this.p_nodeYlq.active=!c,this.p_btnGet.interactable=c,this.p_nodeGo.active=!1),this.p_nodeSix.getChildByName("rednotice").active=r.isCanGet(a),this.p_nodeHundred.getChildByName("rednotice").active=r.isCanGet(93312)}},onClickGet:function(){var e=this;if(!(this._pro>=3||0==this.m_nIndex&&this.newMaskGet))return this._allcharge<this._needcharge?(this.onClose(!1),void app.goToPage(1042)):void(this._openday<=this._pro?app.showNotice(langMgr.getString("activitySgyPage",2)):app.player.sfExchange(this._exid,1,0,function(t){app.player.sfPlayerData(function(){var a={showtype:1,reward:t};e.refreshBottom(e.m_nIndex),app.pages.windowspagereward.showPage(a)})}));app.showNotice(langMgr.getString("activitySgyPage",1))},onClose:function(e){void 0===e&&(e=!0),this._super()}});r.refreshRed=function(e){var t=!1;return t||r.isOver()||(t=r.isCanGet())||null==localDataUtils.GetValue("shouchongred",null)&&(t=!0),e&&(e.active=t),t},r.isOver=function(){for(var e=[a,93312],t=!0,i=app.player.getCount(93313)>0,n=0;n<e.length;n++)for(var r=app.db.dbFirstCharge[n],o=app.player.getCount(e[n]),s=0;s<r.length;++s)for(var p=0;p<r[n].ITEMS.length;++p)t&&(t=o>s||0==n&&i);return t},r.isTan=function(){var e=!0;return app.player.getCount(90222)>0&&(e=!1),e},r.isCanGet=function(e){for(var t=[a,93312],n=[i,100],r=!1,o=app.player.getCount(93313)>0,s=0;s<t.length;s++)if((e!=a||0==s)&&(93312!=e||1==s)&&app.player.getCount(90222)>=n[s])for(var p=app.db.dbFirstCharge[s],c=app.player.getCount(t[s]),h=app.player.firstcharge?app.player.getDayByCreate(app.player.firstcharge):0,l=0;l<p.length;++l)for(var g=0;g<p[s].ITEMS.length;++g)c>l||0==s&&o||r||(r=h>c);return r},cc._RF.pop()},{basePage:void 0}],activityShouchongPage:[function(e,t){"use strict";cc._RF.push(t,"fb719L+rFVIB7knNMlBK2e4","activityShouchongPage");var a=[12041,14021,10121],i=6,n=100,r=cc.Class({extends:e("basePage"),statics:{prefabPath:"activityshouchongpage"},properties:{p_arrHero:[cc.Node],p_arrBtnHero:[cc.Button],p_nodeSix:cc.Node,p_nodeHundred:cc.Node,p_arrItem:[cc.Node],p_btnGet:cc.Button,p_nodeGet:cc.Node,p_nodeGo:cc.Node,p_labCharge:cc.Label,p_anim_flow:cc.Animation,p_anim_btn_l:cc.Animation},onLoad:function(){r.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),app.arrRed.shouchong&&(app.arrRed.shouchong=0,gUtils.saveHdRed()),"JP"===gSetting.getLangName()&&(i=1,n=1880)},handleUI:function(){var e=this;this._super(),app.loadEff("yellow_flow",this.p_anim_flow,2,1,1,14),app.loadEff("btn_yellow",this.p_anim_btn_l,2,1.3,1.3);for(var t=0;t<this.p_arrItem.length;++t)this.p_arrItem[t].getComponent("propItem").setClick(!0);for(var n=function(t){e.p_arrHero[t].on("touchend",function(){var i={type:2,gsid:a[t]};app.pages.generalpage.showPage(i,e.bgNode)})},r=0;r<this.p_arrHero.length;++r)n(r);for(var o=function(t){e.p_arrBtnHero[t].node.on("click",function(){var a=app.player.getCount(93310);e._allcharge<i?app.showNotice(langMgr.getString("activityShouchongPage",0)):a>=1?app.showNotice(langMgr.getString("activityShouchongPage",1)):app.player.sfExchange("firstcharge_0_"+(t+1),1,0,function(t){app.player.sfPlayerData(function(){var a={showtype:1,reward:t};e.refreshTop(),app.pages.windowspagereward.showPage(a)})})})},s=0;s<this.p_arrBtnHero.length;++s)o(s);this.p_btnGet.node.on("click",function(){e.onClickGet()}),this.p_nodeSix.on("touchend",function(){e.refreshBottom(0)}),this.p_nodeHundred.on("touchend",function(){e.refreshBottom(1)});for(var p=0;p<this.p_arrItem.length;++p)this.p_arrItem[p].getChildByName("picked").active=!1},setParam:function(){var e=app.player.getCount(93311);app.player.getCount(93312),this._openday=app.player.firstcharge?app.player.getDayByCreate(app.player.firstcharge):0,this.refreshUI(),this.refreshBottom((e>=3||this._openday<=e)&&this._allcharge>=i?1:0)},refreshUI:function(){this._allcharge=app.player.getCount(90222),this.p_labCharge.string=this._allcharge,this.refreshTop()},refreshTop:function(){for(var e=app.player.getCount(93310),t=0;t<this.p_arrBtnHero.length;++t)this.p_arrBtnHero[t].node.getChildByName("btn_black").active=e>=1||this._allcharge<i},refreshBottom:function(e){this.m_nIndex=e;for(var t=0;t<this.p_arrItem.length;++t){this.p_arrItem[t].getChildByName("picked").active=!1;var a=cc.find("scale_icon/icon",this.p_arrItem[t]);app.setSpriteState(a.getComponent(cc.Sprite),!1)}var r=app.db.dbFirstCharge[e];if(r&&r.length){this.p_nodeSix.getChildByName("pick").active=0==e,this.p_nodeHundred.getChildByName("pick").active=1==e,this._needcharge=0==e?i:n;var o=0;this._pro=app.player.getCount(0==e?93311:93312),this._exid=r[Math.min(2,this._pro)].EXID;for(var s=0;s<r.length;++s)for(var p=0;p<r[s].ITEMS.length&&!(o>=this.p_arrItem.length);++p){if(this.p_arrItem[o].getComponent("propItem").initForBag(r[s].ITEMS[p]),this._pro>s){this.p_arrItem[o].getChildByName("picked").active=!0;var c=cc.find("scale_icon/icon",this.p_arrItem[o]);app.setSpriteState(c.getComponent(cc.Sprite),!0)}else this._openday,this._pro;o++}this._allcharge<this._needcharge?(this.p_btnGet.node.getChildByName("btn_yellow").active=!0,this.p_nodeGet.active=!1,this.p_nodeGo.active=!0):(this.p_nodeGet.active=!0,this.p_nodeGo.active=!1,this.p_btnGet.node.getChildByName("btn_yellow").active=this._openday>this._pro&&this._pro<3)}},onClickGet:function(){var e=this;if(!(this._pro>=3))return this._allcharge<this._needcharge?(this.onClose(),void app.pages.rechargepage.showPage(null,app.mainScene.p_nodeBg)):void(this._openday<=this._pro?app.showNotice(langMgr.getString("activityShouchongPage",3)):app.player.sfExchange(this._exid,1,0,function(t){app.player.sfPlayerData(function(){var a={showtype:1,reward:t};e.refreshBottom(e.m_nIndex),app.pages.windowspagereward.showPage(a)})}));app.showNotice(langMgr.getString("activityShouchongPage",2))},onClose:function(){this._super()}});r.refreshRed=function(e){e.active=!!app.arrRed.shouchong},cc._RF.pop()},{basePage:void 0}],activitySrlbPage:[function(e,t){"use strict";cc._RF.push(t,"29403ZN0+VBIY52fEkFjNfJ","activitySrlbPage");var a="red_srlb_day_cache",i=cc.Class({extends:e("basePage"),statics:{prefabPath:"activitysrlbpage",pageType:1},properties:{p_nodeProp:cc.Node,p_btnReward:cc.Button,p_nodeGot:cc.Node,p_pickedIcon:cc.Node,p_timeLimitBtn:cc.Node},onLoad:function(){i.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),0==localDataUtils.GetValue(a,0)&&localDataUtils.SetValue(a,1,gUtils.getSecondDayTime(app.player.getServerTime()))},handleUI:function(){var e=this;this._super(),this.p_btnReward.node.on("click",function(){app.playSound("click"),e.onClickReward()})},setParam:function(){var e=this;app.objActivityCache=app.objActivityCache||{},app.objActivityCache.activitySrlbPageDataCache?this.refreshUI():app.player.sfFirstDayGiftInfo(function(t,a){t?app.showNotice(t):(app.objActivityCache.activitySrlbPageDataCache=a,e.refreshUI())})},refreshUI:function(){var e=app.objActivityCache.activitySrlbPageDataCache;this.p_nodeProp.getComponent("propItem").initForBag(e.reward[0]),this.p_nodeProp.getComponent("propItem").setClick(!0),this.p_nodeProp.active=!0,this.refreshBtnState()&&this.schedule(this.refreshBtnState,30)},onClickReward:function(){var e=this,t=app.objActivityCache.activitySrlbPageDataCache,a=app.player.getServerTime();a<app.player.fdaypack_time[1][0]||a>app.player.fdaypack_time[1][1]||app.player.sfFirstDayGiftReward(function(a,i){if(a)app.showNotice(a);else{t.status=1,app.player.addItem(i);var n={showtype:1,reward:i,target:e};app.pages.windowspagereward.showPage(n),e.refreshBtnState(),e.unschedule(e.refreshBtnState)}})},refreshBtnState:function(){var e=app.objActivityCache.activitySrlbPageDataCache;this.p_pickedIcon.active=1==e.status,this.p_nodeGot.active=1==e.status,this.p_btnReward.node.active=1!=e.status;var t=app.player.getServerTime(),a=t>=app.player.fdaypack_time[1][0]&&t<=app.player.fdaypack_time[1][1];return this.p_timeLimitBtn.active=!a,1!=e.status}});i.isOpen=function(){var e=app.db.checkFuncUnLock("ACTIVITY_SRXSLB")&&app.db.checkChannelShow("ACTIVITY_SRXSLB");try{var t=app.player.getServerTime();e=e&&t<=app.player.fdaypack_time[0]}catch(a){e=!1}return e},i.refreshRed=function(e){var t=localDataUtils.GetValue(a,0);return e&&(e.active=!t),!t},cc._RF.pop()},{basePage:void 0}],activityThjj1Page:[function(e,t){"use strict";cc._RF.push(t,"8769319Ub9N/YUvA45Zb9Wx","activityThjj1Page");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activitythjj1page",pageType:1},properties:{p_nodeGz:cc.Node,p_nodeZz:cc.Node,p_nodeYesGz:cc.Node,p_nodeNoGz:cc.Node,p_nodeYesZz:cc.Node,p_nodeNoZz:cc.Node,p_labTime:cc.Label,p_nodeItem:cc.Node,p_nodeContent:cc.Node,p_btnGet:cc.Button},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),localDataUtils.SetValue("ACTIVITY_THJJ1",1,gUtils.getSecondDayTime(app.player.getServerTime())),eventMgr.emit(eventStr.redEvent.RefreshMainSceneRed)},handleUI:function(){var e=this;this._super(),this.p_btnGet.node.on("click",function(){app.playSound("click"),e.onClickBtnGet()}),this.p_nodeGz.on("touchend",function(){app.playSound("click"),app.goToPage(1036)}),this.p_nodeZz.on("touchend",function(){app.playSound("click"),app.goToPage(1036)})},setParam:function(){var e=this;this.m_objData=null,app.player.sfThjjInfo(1,function(t,a){t&&(app.showNotice(t),e.onClose()),e.m_objData=a,e.refreshUI()})},refreshUI:function(){this.m_objData&&(this.refreshInitUI(),this.refreshChangeUI())},refreshInitUI:function(){var e=gUtils.getActivityArrTime("THJJ1");this.p_labTime.string=langMgr.getString("activityThjj1Page",0,[gUtils.dateFormatter("MM\u6708DD\u65e5",e[0]),gUtils.dateFormatter("MM\u6708DD\u65e5",e[1])]),this.m_objData.cond=this.m_objData.cond||[0,0],this.p_nodeYesGz.active=1==this.m_objData.cond[0],this.p_nodeNoGz.active=0==this.m_objData.cond[0],this.p_nodeYesZz.active=1==this.m_objData.cond[1],this.p_nodeNoZz.active=0==this.m_objData.cond[1],1==this.m_objData.cond[0]&&this.playSpecialEff("icon_shenjiang",this.p_nodeYesGz,1,0,30,255),1==this.m_objData.cond[1]&&this.playSpecialEff("icon_shenjiang",this.p_nodeYesZz,1,0,30,255)},playSpecialEff:function(e,t,a,i,n,r){if(t.isEff!=e){t.effNode&&t.effNode.destroy();var o=new cc.Node,s=o.addComponent(cc.Sprite);s.sizeMode=cc.Sprite.SizeMode.RAW,s.dstBlendFactor=cc.macro.BlendFactor.ONE,s.trim=!1,o.parent=t,o.setPosition(i||0,n||0),o.opacity=r||255,a=a||1,t.isEff=e,t.effNode=o;var p=o.addComponent(cc.Animation);app.loadEff(e,p,2,a,a)}},refreshChangeUI:function(){this.p_btnGet.node.getChildByName("price_num_item").active=1!=this.m_objData.isbuy,this.p_btnGet.node.getChildByName("lingqu").active=1==this.m_objData.isbuy,this.p_btnGet.node.getChildByName("rednotice").active=1==this.m_objData.isbuy&&this.m_objData.num<this.m_objData.day&&this.m_objData.num<this.m_objData.items.length,1!=this.m_objData.isbuy?(this.p_btnGet.node.getChildByName("price_num_item").getComponent("price_num_item").init(this.m_objData.price,1,2),app.setSpriteState(this.p_btnGet.node.getComponent(cc.Sprite),!(this.m_objData.cond&&1==this.m_objData.cond[0]&&1==this.m_objData.cond[1]))):app.setSpriteState(this.p_btnGet.node.getComponent(cc.Sprite),this.m_objData.num>=this.m_objData.items.length),this.refreshContent()},refreshContent:function(){if(this.m_objData){this.m_arrItemReward=this.m_arrItemReward||[this.p_nodeItem];for(var e=this.m_objData.items,t=0;t<e.length;++t){var a=this.m_arrItemReward[t];a||((a=cc.instantiate(this.p_nodeItem)).parent=this.p_nodeContent,this.m_arrItemReward.push(a)),a.active=!0,a.getComponent("activityThjjItem").initUI(this.m_objData,t,1)}}},onBuy:function(){var e=this;if(this.m_objData.cond&&1==this.m_objData.cond[0]&&1==this.m_objData.cond[1])app.player.sfPayThjj(this.m_objData.price,1,function(t){cc.log(t);var a={reward:e.m_objData.reward,showtype:1,target:e};app.pages.windowspagereward.showPage(a),app.player.sfPlayerByParam(["others","vip","hide","props","firstcharge"],function(){app.mainScene&&app.mainScene.refreshTopUI(),e.m_objData.isbuy=1,e.refreshChangeUI(),app.redDataServer.act.thjj1=1,eventMgr.emit(eventStr.redEvent.RefreshMainSceneRed)})},function(){app.showNotice(langMgr.getString("activityThjj1Page",2))});else{var t={content:langMgr.getString("activityThjj1Page",1),confirmcb:function(){app.goToPage(1036)}};app.pages.windowspagetipsmsg.showPage(t)}},onReward:function(){var e=this;this.m_objData.num>=this.m_objData.items.length?app.showNotice(langMgr.getString("activityThjj1Page",3)):this.m_objData.num>=this.m_objData.day?app.showNotice(langMgr.getString("activityThjj1Page",4)):app.player.sfThjjReward(1,function(t,a){if(t)app.showNotice(t);else{var i={showtype:1,reward:a};app.pages.windowspagereward.showPage(i),app.player.sfPlayerByParam(["others","hide","props"],function(){app.mainScene&&app.mainScene.refreshTopUI(),e.m_objData.num=Math.min(e.m_objData.day,e.m_objData.items.length),e.refreshChangeUI(),app.redDataServer.act.thjj1=0,eventMgr.emit(eventStr.redEvent.RefreshMainSceneRed)})}})},onClickBtnGet:function(){1!=this.m_objData.isbuy?this.onBuy():this.onReward()}});a.refreshRed=function(e){var t=!1;return t=!localDataUtils.GetValue("ACTIVITY_THJJ1",null)||app.getRedInfoByObj(["act","thjj1"],0)>0,e&&(e.active=t),t},a.isOpen=function(){return!!gUtils.activityIsOpen("THJJ1")&&!!app.db.checkFuncUnLock("ACTIVITY_THJJ1")},cc._RF.pop()},{basePage:void 0}],activityThjjPage:[function(e,t){"use strict";cc._RF.push(t,"f39d2Hd97VC5rXJI6NR8Zz5","activityThjjPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activitythjjpage",pageType:1},properties:{p_nodeGz:cc.Node,p_nodeZz:cc.Node,p_nodeYesGz:cc.Node,p_nodeNoGz:cc.Node,p_nodeYesZz:cc.Node,p_nodeNoZz:cc.Node,p_labTime:cc.Label,p_nodeItem:cc.Node,p_nodeContent:cc.Node,p_btnGet:cc.Button},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),localDataUtils.SetValue("ACTIVITY_THJJ",1,gUtils.getSecondDayTime(app.player.getServerTime())),eventMgr.emit(eventStr.redEvent.RefreshMainSceneRed)},onEnable:function(){eventMgr.on(eventStr.cbgPage.RefreshThjjStatus,this.refreshStatus,this)},onDisable:function(){eventMgr.off(eventStr.cbgPage.RefreshThjjStatus,this.refreshStatus,this)},handleUI:function(){var e=this;this._super(),this.p_btnGet.node.on("click",function(){app.playSound("click"),e.onClickBtnGet()}),this.p_nodeGz.on("touchend",function(){app.playSound("click"),app.goToPage(1036)}),this.p_nodeZz.on("touchend",function(){app.playSound("click"),app.goToPage(1036)})},setParam:function(){var e=this;this.m_objData=null,app.player.sfThjjInfo(0,function(t,a){t&&(app.showNotice(t),e.onClose()),e.m_objData=a,e.refreshUI()})},refreshStatus:function(e){e&&(this.m_objData.num+=e),this.refreshChangeUI(),this.m_objData.num>=this.m_objData.day&&(app.redDataServer.act.thjj=0,eventMgr.emit(eventStr.redEvent.RefreshMainSceneRed))},refreshUI:function(){this.m_objData&&(this.refreshInitUI(),this.refreshChangeUI())},refreshInitUI:function(){var e=gUtils.getActivityArrTime("THJJ");this.p_labTime.string=langMgr.getString("activityThjjPage",0,[gUtils.dateFormatter("MM\u6708DD\u65e5",e[0]),gUtils.dateFormatter("MM\u6708DD\u65e5",e[1])]),this.m_objData.cond=this.m_objData.cond||[0,0],this.p_nodeYesGz.active=1==this.m_objData.cond[0],this.p_nodeNoGz.active=0==this.m_objData.cond[0],this.p_nodeYesZz.active=1==this.m_objData.cond[1],this.p_nodeNoZz.active=0==this.m_objData.cond[1],1==this.m_objData.cond[0]&&this.playSpecialEff("icon_shenjiang",this.p_nodeYesGz,1,0,30,255),1==this.m_objData.cond[1]&&this.playSpecialEff("icon_shenjiang",this.p_nodeYesZz,1,0,30,255)},playSpecialEff:function(e,t,a,i,n,r){if(t.isEff!=e){t.effNode&&t.effNode.destroy();var o=new cc.Node,s=o.addComponent(cc.Sprite);s.sizeMode=cc.Sprite.SizeMode.RAW,s.dstBlendFactor=cc.macro.BlendFactor.ONE,s.trim=!1,o.parent=t,o.setPosition(i||0,n||0),o.opacity=r||255,a=a||1,t.isEff=e,t.effNode=o;var p=o.addComponent(cc.Animation);app.loadEff(e,p,2,a,a)}},refreshChangeUI:function(){this.p_btnGet.node.getChildByName("price_num_item").active=1!=this.m_objData.isbuy,this.p_btnGet.node.getChildByName("lingqu").active=1==this.m_objData.isbuy,this.p_btnGet.node.getChildByName("rednotice").active=1==this.m_objData.isbuy&&this.m_objData.num<this.m_objData.day&&this.m_objData.num<this.m_objData.items.length,1!=this.m_objData.isbuy?(this.p_btnGet.node.getChildByName("price_num_item").getComponent(cc.Label).string="\xa5"+this.m_objData.price,app.setSpriteState(this.p_btnGet.node.getComponent(cc.Sprite),!(this.m_objData.cond&&1==this.m_objData.cond[0]&&1==this.m_objData.cond[1]))):app.setSpriteState(this.p_btnGet.node.getComponent(cc.Sprite),this.m_objData.num>=this.m_objData.items.length),this.refreshContent()},refreshContent:function(){if(this.m_objData){this.m_arrItemReward=this.m_arrItemReward||[this.p_nodeItem];for(var e=this.m_objData.items,t=0;t<e.length;++t){var a=this.m_arrItemReward[t];a||(this.p_nodeItem.getChildByName("title").getComponent(cc.Label).string="\u7b2c"+(t+1)+"\u5929",(a=cc.instantiate(this.p_nodeItem)).parent=this.p_nodeContent,this.m_arrItemReward.push(a)),a.active=!0,a.getComponent("activityThjjItem").initUI(this.m_objData,t,0),this.p_nodeItem.getChildByName("title").getComponent(cc.Label).string="\u7b2c1\u5929"}}},onBuy:function(){var e=this;if(this.m_objData.cond&&1==this.m_objData.cond[0]&&1==this.m_objData.cond[1])app.player.sfPayThjj(this.m_objData.price,0,function(t){cc.log(t);var a={reward:e.m_objData.reward,showtype:1,target:e};app.pages.windowspagereward.showPage(a),app.player.sfPlayerByParam(["others","vip","hide","props","firstcharge"],function(){app.mainScene&&app.mainScene.refreshTopUI(),e.m_objData.isbuy=1,e.refreshChangeUI(),app.redDataServer.act.thjj=1,eventMgr.emit(eventStr.redEvent.RefreshMainSceneRed)})},function(){app.showNotice(langMgr.getString("activityThjjPage",2))});else{var t={content:langMgr.getString("activityThjjPage",1),confirmcb:function(){app.goToPage(1036)}};app.pages.windowspagetipsmsg.showPage(t)}},onReward:function(){if(this.m_objData.num>=this.m_objData.items.length)app.showNotice(langMgr.getString("activityThjjPage",3));else if(this.m_objData.items[this.m_objData.num].length>1){var e=Math.min(this.m_objData.num,this.m_objData.items.length-1);app.pages.activityThjjRewardSelectPage.showPage({data:this.m_objData.items[e],get:1})}else this.m_objData.num>=this.m_objData.day?app.showNotice(langMgr.getString("activityThjjPage",4)):app.player.sfThjjReward({actIndex:0},function(e,t){if(e)app.showNotice(e);else{var a={showtype:1,reward:t};app.pages.windowspagereward.showPage(a),app.player.sfPlayerByParam(["others","hide","props"],function(){app.mainScene&&app.mainScene.refreshTopUI(),eventMgr.emit(eventStr.cbgPage.RefreshThjjStatus,t.length)})}})},onClickBtnGet:function(){1!=this.m_objData.isbuy?this.onBuy():this.onReward()}});a.refreshRed=function(e){var t=!1;return t=!localDataUtils.GetValue("ACTIVITY_THJJ",null)||app.getRedInfoByObj(["act","thjj"],0)>0,e&&(e.active=t),t},a.isOpen=function(){return!!gUtils.activityIsOpen("THJJ")&&!!app.db.checkFuncUnLock("ACTIVITY_THJJ")},cc._RF.pop()},{basePage:void 0}],activityThjjRewardSelectPage:[function(e,t){"use strict";cc._RF.push(t,"19466EmdfVERbfy2DcQf+8n","activityThjjRewardSelectPage");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=cc._decorator,o=r.ccclass,s=r.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_nodeItem=null,t.p_labIntro=null,t.p_nodeContent=null,t.p_nodeRewardItem=null,t.p_nodeLab=null,t.p_nodeBtn=null,t.p_btnGet=null,t.p_btnCancel=null,t.m_data=null,t.m_selectIndex=-1,t.m_get=0,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){var e=this;a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.p_btnGet.node.on("click",function(){app.playSound("click"),e.onClickGet()}),this.p_btnCancel.node.on("click",function(){app.playSound("click"),e.onClose()})},t.prototype.setParam=function(e){this.m_get=e.get,this.m_data=e.data,this.refreshSelect(this.m_selectIndex)},t.prototype.refreshUI=function(){this.p_nodeBtn.active=1==this.m_get,this.p_nodeLab.active=0==this.m_get;for(var e=0;e<this.m_data.length;e++){var t=this.p_nodeContent.children[e];t||((t=cc.instantiate(this.p_nodeRewardItem)).parent=this.p_nodeContent),t.active=!0;var a={target:this,index:e,selectIndex:this.m_selectIndex,item:this.m_data[e]};t.getComponent("thjjRewardItem").refreshUI(a)}},t.prototype.refreshSelect=function(e){if(this.m_selectIndex=e,this.p_btnGet.interactable=e>-1,e>-1){this.p_nodeItem.active=!0,this.p_nodeItem.getComponent("propItem").initForBag(this.m_data[e]);var t=app.db.getPropsInfoByGsid(this.m_data[e].GSID);this.p_labIntro.string=t.INTRO}else this.p_nodeItem.active=!1,this.p_labIntro.string="";this.refreshUI()},t.prototype.onClickGet=function(){var e=this;app.player.sfThjjReward({actIndex:0,index:this.m_data.index,sub:this.m_selectIndex},function(t,a){if(!t){var i={showtype:1,reward:a};app.pages.windowspagereward.showPage(i),app.player.sfPlayerByParam(["others","hide","props"],function(){app.mainScene&&app.mainScene.refreshTopUI(),eventMgr.emit(eventStr.cbgPage.RefreshThjjStatus,1),e.onClose()})}})},t.prototype.onClickCancel=function(){this.onClose()},t.prefabPath="activityThjjRewardSelectPage",t.pageType=1,n([s(cc.Node)],t.prototype,"p_nodeItem",void 0),n([s(cc.Label)],t.prototype,"p_labIntro",void 0),n([s(cc.Node)],t.prototype,"p_nodeContent",void 0),n([s(cc.Node)],t.prototype,"p_nodeRewardItem",void 0),n([s(cc.Node)],t.prototype,"p_nodeLab",void 0),n([s(cc.Node)],t.prototype,"p_nodeBtn",void 0),n([s(cc.Button)],t.prototype,"p_btnGet",void 0),n([s(cc.Button)],t.prototype,"p_btnCancel",void 0),a=n([o],t)}(e("basePage"));t.exports=p,cc._RF.pop()},{basePage:void 0}],activityTjfxPage:[function(e,t){"use strict";cc._RF.push(t,"a78b2SRsktFhbTyg85qzPzA","activityTjfxPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activitytjfxpage",pageType:1},properties:{p_nodeScale:cc.Node,p_nodeCount:cc.Node,p_labTime:cc.Label,p_btnGoto:cc.Button,p_nodeRed:cc.Node},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.p_btnGoto.node.on("click",function(){app.goToPage(1042)})},onEnable:function(){this._super(),eventMgr.on(eventStr.commonEvent.RefreshTime,this.refreshTime,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.commonEvent.RefreshTime,this.refreshTime,this)},setParam:function(){var e=this;gUtils.activityIsOpen("TJFX",!0)&&(this.p_nodeRed.active=app.getRedInfoByObj(["act","tjfx"],null)>0,app.getRedInfoByObj(["act","tjfx"],0)>=1&&(app.redDataServer.act.tjfx-=1),app.player.sfEventInfo("tjfx",function(t,a){t||(e.m_data=a,e.refreshUI())}))},refreshUI:function(){this.m_data&&(this.refreshTime(),null!=this.m_data.scale&&this.p_nodeScale.getComponent("num").init(this.m_data.scale+"%"),null!=this.m_data.limit&&this.p_nodeCount.getComponent("num").init(this.m_data.limit,!0))},refreshTime:function(){var e=app.player.getServerTime(),t=gUtils.getActivityArrTime("TJFX")[1]||0,a=t-e;(!t||a<0)&&(a=0),this.p_labTime.string=0!=a?gUtils.getCountDownStr(a):"00:00:00"}});a.refreshRed=function(e){var t=!1,a=app.getRedInfoByObj(["act","tjfx"],null);return null!=a&&(t=a>0),e&&(e.active=t),t},a.isOpen=function(){return gUtils.activityIsOpen("TJFX")},cc._RF.pop()},{basePage:void 0}],activityWeekTargetPage:[function(e,t){"use strict";cc._RF.push(t,"62bf3VLHUNAMZ+TAOxMikXp","activityWeekTargetPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activityweektargetpage",pageType:1},properties:{p_progBox:cc.ProgressBar,p_arrBox:[cc.Node],p_taskNum:cc.Label,p_labTime:cc.Label,p_pfbItem:cc.Prefab,p_arrPropItem:[cc.Node],p_nodeMenu:cc.Node,p_scollew:cc.ScrollView,p_pfbMItem:cc.Prefab,p_btnLclb:cc.Button,p_LcBar:cc.ProgressBar,p_labLcBar:cc.Label,p_labCanGetTips:cc.Label,p_labTips:cc.Label},onLoad:function(){var e=this;a.instance=this,this.stopBgNodeEvent(),this.schedule(this.refreshTime,1),this.creatMask(!0),this.fitTopMenu(),this.m_arrDayRewardItem=[],this.p_arrPropItem.forEach(function(t){var a=cc.instantiate(e.p_pfbItem);a.parent=t,e.m_arrDayRewardItem.push(a)}),this.handleUI()},onEnable:function(){this._super(),eventMgr.on(eventStr.redEvent.RefreshWeektargetRed,this.refreshRed,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.redEvent.RefreshWeektargetRed,this.refreshRed,this)},handleUI:function(){var e=this;this._super(),this.p_btnLclb.node.on("click",function(){app.playSound("click"),app.pages.windowsPageWeektargetLclb.showPage(e.m_lclbInfo)})},sfExchange:function(e,t){var a=this;app.player.sfExchange(e,1,0,function(e){app.player.sfPlayerByParam(["others","vip","hide","props","firstcharge"],function(){var i={showtype:1,reward:e};a.refreshUI(),t&&t(),app.pages.windowspagereward.showPage(i),a.refreshRedByIndex(a.m_nIndex,a.p_arrTitle[a.m_nIndex])})})},setParam:function(){var e=this;this.m_weekTargetExtra=gUtils.deepClone(app.db.getWeekTargetExtra()),this.m_weekTarget=gUtils.deepClone(app.db.getWeekTarget()),this.m_lclbInfo=[],this.m_weekTarget&&this.m_weekTarget.forEach(function(t,a){e.m_lclbInfo.push(e.m_weekTarget[a][3])}),console.log(this.m_lclbInfo),this.m_arrItems=[],this.refreshArrDay(),this.m_menu=this.p_nodeMenu.getComponent("menu"),this.m_menu.init(this),this.p_labTips.string=langMgr.getString("activityWeekTargetPage",8),app.player.sfPlayerByParam(["others"],function(){return[app.player.sfWeektargetInfo(function(t,a){if(!t){for(var i=0;i<a.giftpack.length;i++){var n=a.giftpack[i];n.index=i,e.m_weekTarget[n.date][n.tag].ITEMS||(e.m_weekTarget[n.date][n.tag].ITEMS=[]),e.m_weekTarget[n.date][n.tag].ITEMS.push(n)}for(var r=0;r<a.welfare.length;r++){var o=a.welfare[r];o.index=r,e.m_weekTarget[o.date][o.tag].ITEMS||(e.m_weekTarget[o.date][o.tag].ITEMS=[]),e.m_weekTarget[o.date][o.tag].ITEMS.push(o)}e.sortData(),app.activityweekdata=a,e.refreshDayByIndex(0),e.refreshUI()}})]})},sortData:function(){for(var e=0;e<this.m_weekTarget.length;e++)for(var t=0;t<this.m_weekTarget[e].length;t++){for(var a=this.m_weekTarget[e][t].ITEMS,i=!1,n=[],r=[],o=[],s=0;s<a.length;s++){var p=a[s];if(!p.MARK){i=!0;break}var c=app.player.getCount(p.PMARK)>0,h=app.player.getCount(p.MARK)>=p.NUM;h&&!c?n.push(p):h&&c?o.push(p):r.push(p)}i||(n=(n=n.concat(r)).concat(o),this.m_weekTarget[e][t].ITEMS=n)}},refreshUI:function(){this.refreshTime(),this.refreshBoxList(),this.refreshRed()},refreshBox_scollew:function(){this.refreshBoxList(),this.refreshScollew(),this.refreshRed()},refreshBoxList:function(){for(var e=this,t=app.player.getCount(this.m_weekTargetExtra[0].MARK),a=0,i=0;i<this.m_weekTargetExtra.length&&t>=this.m_weekTargetExtra[i].NUM;i++)a++;var n=0;a?(n=a/this.m_weekTargetExtra.length,a<this.m_weekTargetExtra.length&&(n+=(t-this.m_weekTargetExtra[a-1].NUM)/(this.m_weekTargetExtra[a].NUM-this.m_weekTargetExtra[a-1].NUM)/(this.m_weekTargetExtra.length-1))):n+=t/this.m_weekTargetExtra[0].NUM/this.m_weekTargetExtra.length,this.p_progBox.progress=n,this.p_taskNum.string=t,this.p_arrBox.forEach(function(t,a){var i=e.m_weekTargetExtra[a];t.active=!!i,t.active&&t.getComponent("activityQrmbBoxItem").refreshUI(i,e,e.refershBoxRed)})},menuHandler:function(e){this.m_menIndex=e||0,this.refreshScollew()},refershBoxRed:function(){var e=this;this.m_menu.refreshRed(),this.p_arrBox.forEach(function(t,a){var i=e.m_weekTargetExtra[a];t.active=!!i,t.active&&t.getComponent("activityQrmbBoxItem").refreshRed()})},refreshRed:function(){this.refershBoxRed(),this.m_arrDayRewardItem.forEach(function(e,t){app.player.getServerTime()<gUtils.getTimeByDay(app.player.create,t)||e.getComponent("propItem").setRed(a.checkRedDay(t,app.activityweekdata))}),this.m_menu.refreshRed()},refreshMenuRed:function(e){var t=this.m_dIndex;if(0==e){var i=null;return app.activityweekdata&&(i=a.setData(app.activityweekdata.welfare)),a.checkFuLiRed(t,i)}return 3==e?a.checkChongzhiRed(t,null):a.checkMenuRed(e,t,null)},refreshScollew:function(){this.m_menIndex=this.m_menIndex||0;for(var e=this.m_dayData[this.m_menIndex].ITEMS,t=0;t<e.length;t++){var a=e[t],i=this.m_arrItems[t];i||((i=cc.instantiate(this.p_pfbMItem)).parent=this.p_scollew.content,this.m_arrItems.push(i)),i.getComponent("activeQrmbItem").refreshUI(a,t,this,this.refreshBox_scollew),i.active=!0}for(var n=e.length;n<this.m_arrItems.length;++n)this.m_arrItems[n].active=!1;if(0==this.m_menIndex){var r=this.m_dayData[3].ITEMS,o=this.m_arrItems[e.length];o||((o=cc.instantiate(this.p_pfbMItem)).parent=this.p_scollew.content,o.setSiblingIndex(0),this.m_arrItems.push(o)),o.getComponent("activeQrmbItem").refreshUI(r[1],0,this,this.refreshBox_scollew),o.active=!0}},refreshArrDay:function(){var e=this;this.m_arrDayRewardItem.forEach(function(t,a){var i=e.m_weekTarget[a],n=gUtils.getTimeByDay(app.player.create,a),r=app.player.getServerTime()>=n;t.getComponent("propItem").initForGsid(i[0].GSID),t.getComponent("propItem").setSpine(),app.setNodeState(t,!r),t.on("touchend",function(){r?e.refreshDayByIndex(a):app.showNotice(langMgr.getString("activityWeekTargetPage",a,i[0].RNAME))})}),this.refreshLclbTips()},refreshLclbTips:function(){if(this.m_lclbInfo){this.p_labLcBar.node.active=!0,this.p_labCanGetTips.node.active=!1;for(var e=app.player.getCount(this.m_lclbInfo[0].ITEMS[0].MARK),t=0,a=this.m_lclbInfo[this.m_lclbInfo.length-1].ITEMS[0].NUM,i=0;i<this.m_lclbInfo.length;i++){this.m_lclbInfo[i].ITEMS[0].MARK;var n=app.player.getCount(this.m_lclbInfo[i].ITEMS[0].MARK)>=this.m_lclbInfo[i].ITEMS[0].NUM,r=app.player.getCount(this.m_lclbInfo[i].ITEMS[0].PMARK)>=1;n&&!r&&(this.p_labLcBar.node.active=!1,this.p_labCanGetTips.node.active=!0);var o=this.m_lclbInfo[i].ITEMS[0].NUM;0==t&&o>=e&&(t=this.m_lclbInfo[i].ITEMS[0].NUM)}this.p_LcBar.progress=e/a,this.p_labLcBar.string=langMgr.getString("activityWeekTargetPage",7,[e,a])}},refreshDayByIndex:function(e){var t=this;this.m_dIndex!=e&&(this.m_dIndex=e,this.m_menu.refreshRed(),this.m_arrDayRewardItem.forEach(function(e,a){var i=Boolean(t.m_dIndex==a);e.getComponent("propItem").setSpine(i,"square_animation/squareanimation","animation",1.2)}),this.refreshMenu(),this.m_menu.setMenuIndex(0))},refreshMenu:function(){var e=this;this.m_dayData=this.m_weekTarget[this.m_dIndex],this.m_menu.p_arrBtnMenu.forEach(function(t,a){var i=e.m_dayData[a];t.active=!!i;var n=gConfig.rootPath.uiweektargettitle+i.T1,r=gConfig.rootPath.uiweektargettitle+i.T2;t.getComponent("menuBtnItemQrmb").refreshTitle(n,r)})},refreshTime:function(){var e=app.player.getServerTime(),t=gUtils.getTimeByDay(app.player.create,app.player.weekt_day),a=t-e;(!t||a<0)&&(a=0),this.p_labTime.string=0!=a?gUtils.getCountDownStr(a):"00:00:00"},onClose:function(){this._super()}});a.isOpen=function(){if(app.player.create<app.player.weekt_start)return!1;var e=gUtils.getTimeByDay(app.player.create,0),t=gUtils.getTimeByDay(app.player.create,app.player.weekt_day),a=app.player.getServerTime();return e<a&&a<t},a.refreshRed=function(e){for(var t=!1,i=app.db.getWeekTargetExtra(),n=0;n<i.length;n++){var r=i[n];if(app.player.getCount(r.MARK)>=r.NUM&&app.player.getCount(r.PMARK)<1){t=!0;break}}for(var o=app.db.getWeekTarget(),s=0;s<o.length;s++){var p=o[s][3].ITEMS[0].MARK,c=o[s][3].ITEMS[0].NUM,h=o[s][3].ITEMS[0].PMARK,l=app.player.getCount(p)>=c,g=app.player.getCount(h)>=1;if(l&&!g){t=!0;break}}if(t)return e&&(e.active=t),t;if(app.activityweekdata)for(var d=0;d<7&&!(app.player.getServerTime()<gUtils.getTimeByDay(app.player.create,d))&&!(t=a.checkRedDay(d,app.activityweekdata));d++);else{var u=app.getRedInfoByObj(["weektarget"],null);null!=u&&(t=u>0)}return e&&(e.active=t),t},a.setData=function(e){for(var t={},a=0;a<e.length;a++){var i=e[a];t&&t[i.date]||(t[i.date]=[]),t[i.date].push(i)}return t},a.checkRedDay=function(e,t){var i=null;return t&&(a.setData(t.giftpack),i=a.setData(t.welfare)),a.checkFuLiRed(e,i)||a.checkMenuRed(1,e,null)||a.checkMenuRed(2,e,null)},a.checkFuLiRed=function(e,t){var a=!1;if(!a&&t)for(var i=t[e],n=0;n<i.length&&(!i[n].cost||!i[n].cost[0]||0!=i[n].cost[0].count&&0!=i[n].cost[0].COUNT||!(a=i[n].buynum>0));n++);return a},a.checkMenuRed=function(e,t){var a=!1;if(!a)for(var i=gUtils.deepClone(app.db.getWeekTarget())[t][e],n=0;n<i.ITEMS.length;n++){var r=i.ITEMS[n];if(app.player.getCount(r.PMARK)<=0&&app.player.getCount(r.MARK)>=r.NUM){a=!0;break}}return a},a.checkChongzhiRed=function(e){var t=!1;if(!t)for(var a=gUtils.deepClone(app.db.getWeekTarget())[e][3],i=0;i<a.ITEMS.length;i++){var n=a.ITEMS[i];if(app.player.getCount(n.PMARK)<=0&&app.player.getCount(n.MARK)>=n.NUM){t=!0;break}}return t},cc._RF.pop()},{basePage:void 0}],activityWlklbPage2:[function(e,t){"use strict";cc._RF.push(t,"d1fd5IVHCxDy4rODI44ReU/","activityWlklbPage2");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=cc._decorator,o=r.ccclass,s=r.property;(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_nodeScrView=null,t.p_nodeItem=null,t.p_labTime=null,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,this.stopBgNodeEvent(),this.fitTopMenu(),this.creatMask(!0),this.schedule(this.refreshTime,1),this.m_arrItems=[],this.m_scrView=this.p_nodeScrView.getComponent(cc.ScrollView)},t.prototype.setParam=function(){var e=this;app.arrRed.wlklb2=!0,gUtils.activityIsOpen("KFLB2",!0)?app.player.sfActInfo("kflb2",function(t,a){t?e.onClose():(e.m_data=a,e.refreshUI())}):app.mainScene&&app.mainScene.refreshLeftButton()},t.prototype.refreshUI=function(){this.m_data&&(this.refreshSView(this.m_data.params.sppack),this.refreshTime())},t.prototype.refreshSView=function(e){var t=this;this.m_arrItems.map(function(e){return e.active=!1}),Object.keys(e).forEach(function(a,i){var n=t.m_arrItems[i];n||((n=cc.instantiate(t.p_nodeItem)).parent=t.m_scrView.content,t.m_arrItems[i]=n),n.active=!0,n.getComponent("activityWlklbItem").refreshUI(e[a],a,t.m_data.info,t,"kflb2")})},t.prototype.refreshTime=function(){var e=app.player.getServerTime(),t=gUtils.getActivityArrTime("KFLB2")[1]||0,a=t-e;(!t||a<0)&&(a=0),this.p_labTime.string=0!=a?gUtils.getCountDownStr(a):"00:00:00"},t.prototype.onClose=function(){e.prototype.onClose.call(this),gUtils.activityIsOpen("KFLB")||app.mainScene&&app.mainScene.refreshLeftButton()},t.prefabPath="activitywlklbpage2",t.pageType=1,n([s(cc.Node)],t.prototype,"p_nodeScrView",void 0),n([s(cc.Node)],t.prototype,"p_nodeItem",void 0),n([s(cc.Label)],t.prototype,"p_labTime",void 0),a=n([o],t)}(e("basePage"))).refreshRed=function(e){var t=!app.arrRed.wlklb2;return e&&(e.active=t),t},cc._RF.pop()},{basePage:void 0}],activityWlklbPage:[function(e,t){"use strict";cc._RF.push(t,"679447/MWpH8rq4rYAItHuT","activityWlklbPage");var a=cc.Class({extends:e("basePage"),properties:{p_scrView:cc.ScrollView,p_nodeItem:cc.Node,p_labTime:cc.Label},statics:{prefabPath:"activitywlklbpage",createShot:!0},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.fitTopMenu(),this.creatMask(!0),this.schedule(this.refreshTime,1),this.m_arrItems=[]},setParam:function(){var e=this;app.arrRed.wlklb=!0,gUtils.activityIsOpen("KFLB",!0)?app.player.sfActInfo("kflb",function(t,a){t?e.onClose():(e.m_data=a,e.refreshUI())}):app.mainScene&&app.mainScene.refreshLeftButton()},refreshUI:function(){this.m_data&&(this.refreshSView(this.m_data.params.sppack),this.refreshTime())},refreshSView:function(e){var t=this;this.m_arrItems.map(function(e){return e.active=!1}),Object.keys(e).forEach(function(a,i){var n=t.m_arrItems[i];n||((n=cc.instantiate(t.p_nodeItem)).parent=t.p_scrView.content,t.m_arrItems[i]=n),n.active=!0,n.getComponent("activityWlklbItem").refreshUI(e[a],a,t.m_data.info,t)})},refreshTime:function(){var e=app.player.getServerTime(),t=gUtils.getActivityArrTime("KFLB")[1]||0,a=t-e;(!t||a<0)&&(a=0),this.p_labTime.string=0!=a?gUtils.getCountDownStr(a):"00:00:00"},onClose:function(){this._super(),gUtils.activityIsOpen("KFLB")||app.mainScene&&app.mainScene.refreshLeftButton()}});a.refreshRed=function(e){var t=!app.arrRed.wlklb;return e&&(e.active=t),t},cc._RF.pop()},{basePage:void 0}],activityWlzlBuylvPage:[function(e,t){"use strict";cc._RF.push(t,"644ecwItYBF6qmgG1tSsyPh","activityWlzlBuylvPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activitywlzlbuylvpage",pageType:1},properties:{p_nodeContent:cc.Node,p_pfbItem:cc.Prefab,p_sprCost:cc.Sprite,p_labNumCost:cc.Label,p_btnBuy:cc.Button,p_labNowUp:cc.Label,p_btnMax:cc.Button,p_btnMin:cc.Button,p_btnAdd:cc.Button,p_btnReduce:cc.Button,p_labTopLv:cc.Label,p_labTopReward:cc.Label,p_labBottomLvBuy:cc.Label,p_labBottomToLv:cc.Label},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.m_colorCostLabel=this.p_labNumCost.node.color},handleUI:function(){var e=this;this._super(),this.p_btnBuy.node.on("click",function(){app.playSound("click"),e.m_objData&&e.onLevelUp()}),this.p_btnMax.node.on("click",function(){app.playSound("click"),e.m_objData&&(e.m_numUpLv=e.m_numMaxLv-e.m_objData.level,e.refreshUI())}),this.p_btnMin.node.on("click",function(){if(app.playSound("click"),e.m_objData){if(e.m_numUpLv-10<=1)return e.m_numUpLv=1,void e.refreshUI();e.m_numUpLv=e.m_numUpLv-10,e.refreshUI()}}),this.p_btnAdd.node.on("touchstart",function(){e.m_numChange=1,e.onClickChange()}),this.p_btnAdd.node.on("touchend",function(){e.unschedule(e.refreshChange)}),this.p_btnReduce.node.on("touchstart",function(){e.m_numChange=-1,e.onClickChange()}),this.p_btnReduce.node.on("touchend",function(){e.unschedule(e.refreshChange)})},setParam:function(e){this.m_objData=e,this.m_numUpLv=1,app.loadTexture(app.db.getPropsIconPath(this.m_objData.levelbuy.cost[0].GSID),this.p_sprCost,this.prefabPath),this.refreshUI()},refreshUI:function(){if(this.m_objData){this.m_numMaxLv=this.m_objData.wdlevel.length;for(var e,t=this.m_objData.level+this.m_numUpLv,a={},i=this.m_objData.level;i<t&&(e=this.m_objData.wdlevel[i]);++i)e.nrw.forEach(function(e){a[e.GSID]?a[e.GSID]+=e.COUNT:a[e.GSID]=e.COUNT}),this.m_objData.charge.buytime>0&&e.hrw.forEach(function(e){a[e.GSID]?a[e.GSID]+=e.COUNT:a[e.GSID]=e.COUNT});var n=0;for(var r in this.m_arrPropItem=this.m_arrPropItem||[],a){var o=this.m_arrPropItem[n];o||((o=cc.instantiate(this.p_pfbItem)).scale=.75,o.parent=this.p_nodeContent,this.m_arrPropItem.push(o)),o.active=!0,o.getComponent("propItem").initForBag({GSID:r,COUNT:a[r]}),o.getComponent("propItem").setClick(!0),++n}for(var s=n;s<this.m_arrPropItem.length;++s)this.m_arrPropItem[s].active=!1;this.p_labTopLv.string=t,this.p_labTopReward.string=n,this.p_labBottomLvBuy.string=this.m_numUpLv,this.p_labBottomToLv.string=t,this.p_labNowUp.string=this.m_numUpLv;var p=this.m_objData.levelbuy.cost[0].COUNT*this.m_numUpLv;this.p_labNumCost.string=p,this.p_labNumCost.node.color=app.player.getCount(this.m_objData.levelbuy.cost[0].GSID)>=p?this.m_colorCostLabel:cc.Color.RED}},onLevelUp:function(){var e=this,t=this.m_objData.levelbuy.cost;app.player.getCount(t[0].GSID)<t[0].COUNT*this.m_numUpLv?app.showNotice(app.db.getPropsName(t[0].GSID)+"\u4e0d\u8db3"):app.player.sfWlzlBuyLv(this.m_numUpLv,function(t,a){if(t)app.showNotice(t);else{var i={showtype:1,reward:a,target:e,confirmcb:function(){e.onClose()}};app.pages.windowspagereward.showPage(i),app.player.sfPlayerByParam(["others","vip","hide","props","firstcharge"],function(){app.mainScene&&app.mainScene.refreshTopUI(),eventMgr.emit(eventStr.wlzl.WLZL_REFRESH)})}})},onClickChange:function(){this.refreshChange(),this.schedule(this.refreshChange,.2,NaN,1)},refreshChange:function(){this.m_objData.level+this.m_numUpLv+this.m_numChange>this.m_numMaxLv||this.m_numUpLv+this.m_numChange<1?this.unschedule(this.refreshChange):(this.m_numUpLv+=this.m_numChange,this.refreshUI())}});cc._RF.pop()},{basePage:void 0}],activityWlzlJjzlPage:[function(e,t){"use strict";cc._RF.push(t,"7b09aeUZS5DHZNG71P2BKUA","activityWlzlJjzlPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activitywlzljjzlpage",pageType:1},properties:{p_nodeNowReward:cc.Node,p_nodeGradeReward:cc.Node,p_pfbItem:cc.Prefab,p_btnBuy:cc.Button,p_labPrice:cc.Label,p_labUpLv:cc.Label,p_nodeTips:cc.Node,p_btnQ:cc.Button},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.p_nodeTips.active=!1,this.handleUI()},handleUI:function(){var e=this;this._super(),this.p_btnBuy.node.on("click",function(){app.playSound("click"),e.buyGrade()}),this.p_btnQ.node.on("click",function(){app.playSound("click"),e.p_nodeTips.active=!0}),this.p_nodeTips.on("touchstart",function(){e.p_nodeTips.active=!1})},setParam:function(e){if(this.m_objData=e,this.m_objData){this.m_numPrice=e.charge.price,this.p_labPrice.string="\xa5"+this.m_numPrice,this.m_arrItemNow=this.m_arrItemNow||[];for(var t=this.m_objData.charge.reward,a=0;a<t.length;++a){var i=this.m_arrItemNow[a];i||((i=cc.instantiate(this.p_pfbItem)).scale=.75,i.parent=this.p_nodeNowReward,this.m_arrItemNow.push(i)),i.active=!0,i.getComponent("propItem").initForBag(t[a]),i.getComponent("propItem").setClick(!0)}for(var n=t.length;n<this.m_arrItemNow.length;++n)this.m_arrItemNow[n].active=!1;for(var r={},o=0;o<this.m_objData.wdlevel.length;++o)this.m_objData.wdlevel[o].hrw.forEach(function(e){r[e.GSID]?r[e.GSID]+=e.COUNT:r[e.GSID]=e.COUNT});var s=0;for(var p in this.m_arrItemGrade=this.m_arrItemGrade||[],r){var c=this.m_arrItemGrade[s];c||((c=cc.instantiate(this.p_pfbItem)).parent=this.p_nodeGradeReward,this.m_arrItemGrade.push(c)),c.active=!0,c.getComponent("propItem").initForBag({GSID:p,COUNT:r[p]}),c.getComponent("propItem").setClick(!0),++s}for(var h=s;h<this.m_arrItemGrade.length;++h)this.m_arrItemGrade[h].active=!1;for(var l=0,g=0;g<this.m_objData.charge.reward.length;++g)if(90560==this.m_objData.charge.reward[g].GSID){l=this.m_objData.charge.reward[g].COUNT;break}this.p_labUpLv.string=Math.floor(l/this.m_objData.levelbuy.get)}},buyGrade:function(){var e=this;app.player.payWlzl(this.m_numPrice,function(t){cc.log(t);var a={reward:e.m_objData.charge.reward,showtype:1,target:e,confirmcb:function(){e.onClose()}};app.pages.windowspagereward.showPage(a),app.player.sfPlayerByParam(["others","vip","hide","props","firstcharge"],function(){app.mainScene&&app.mainScene.refreshTopUI(),eventMgr.emit(eventStr.wlzl.WLZL_REFRESH)})},function(){app.showNotice("\u8d2d\u4e70\u5931\u8d25")})}});cc._RF.pop()},{basePage:void 0}],activityWlzlPage:[function(e,t){"use strict";cc._RF.push(t,"847c3xvOC9FDqrvCvvfVvf3","activityWlzlPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activitywlzlpage",pageType:1},properties:{p_btnQ:cc.Button,p_btnWlzl:cc.Button,p_btnDailyTask:cc.Button,p_btnWeekTask:cc.Button,p_btnUltimateTask:cc.Button,p_btnBuyLv:cc.Button,p_barLv:cc.ProgressBar,p_labExp:cc.Label,p_btnBuyZl:cc.Button,p_labTime:cc.Label,p_nodeWlzlView:cc.Node,p_nodeWlzlContent:cc.Node,p_nodeItemWlzl:cc.Prefab,p_nodeTaskView:cc.Node,p_nodeTaskContent:cc.Node,p_nodeItemTask:cc.Node,p_labNum:cc.Label},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.schedule(this.refreshTime,1),this.m_numNowShowType=0},handleUI:function(){var e=this;this._super(),this.p_btnBuyLv.node.on("click",function(){app.playSound("click"),e.m_objData&&(e.m_objData.level>=e.m_objData.wdlevel.length||app.pages.activitywlzlbuylvpage.showPage(e.m_objData))}),this.p_btnBuyZl.node.on("click",function(){app.playSound("click"),e.m_objData&&(e.m_objData.charge.buytime>0?app.showNotice("\u5df2\u8d2d\u4e70"):app.pages.activitywlzljjzlpage.showPage(e.m_objData))}),this.p_btnWlzl.node.on("click",function(){app.playSound("click"),e.refreshContentUIByShowType(0)}),this.p_btnDailyTask.node.on("click",function(){app.playSound("click"),e.refreshContentUIByShowType(1)}),this.p_btnUltimateTask.node.on("click",function(){app.playSound("click"),e.refreshContentUIByShowType(2)}),this.p_btnWeekTask.node.on("click",function(){app.playSound("click"),e.refreshContentUIByShowType(3)}),this.p_btnQ.node.on("click",function(){app.playSound("click"),app.pages.windowspagetipshelp.showPage(1099)})},setParam:function(){var e=this;this.m_objData=null,app.cacheActivityWlzl=!0,eventMgr.emit(eventStr.redEvent.RefreshMainSceneRed),app.player.sfWlzlInfo(function(t,a){t&&(app.showNotice(t),e.onClose()),e.m_objData=a,e.refreshUI()})},onEnable:function(){eventMgr.on(eventStr.wlzl.WLZL_REFRESH,this.setParam,this),eventMgr.on(eventStr.wlzl.WLZL_RED,this.refreshBtnRed,this)},onDisable:function(){eventMgr.off(eventStr.wlzl.WLZL_REFRESH,this.setParam,this),eventMgr.off(eventStr.wlzl.WLZL_RED,this.refreshBtnRed,this)},refreshUI:function(){if(cc.log(this.m_objData),this.m_objData){this.refreshLvNum(this.m_objData.level);var e=1,t="\u5df2\u6ee1\u7ea7",a=this.m_objData.wdlevel.length;if(this.p_btnBuyLv.node.active=this.m_objData.level<a,this.m_objData.level<a){var i=this.m_objData.levelbuy.get,n=this.m_objData.wdexp-i*(this.m_objData.level-1);e=n/i,e=Math.min(1,e),e=Math.max(0,e),t=n+"/"+i}this.p_barLv.progress=e,this.p_labExp.string=t;var r=this.m_objData.charge.buytime>0;app.setSpriteState(this.p_btnBuyZl.node.getComponent(cc.Sprite),r),this.p_btnBuyZl.node.getChildByName("jjzl").active=!r,this.p_btnBuyZl.node.getChildByName("yjj").active=r,this.refreshContentUI()}},refreshContentUI:function(){var e=this,t=this.m_objData.tasks;this.m_arrDailyTask=[],this.m_arrWeekTask=[],this.m_arrUltimateTask=[],t.forEach(function(t){1==t.type?e.m_arrDailyTask.push(t):2==t.type?e.m_arrUltimateTask.push(t):3==t.type&&e.m_arrWeekTask.push(t)}),this.m_arrDailyTask.sort(function(e,t){return 0==e.status&&1==t.status?1:0==e.status&&2==t.status?-1:1==e.status&&1!=t.status?-1:2==e.status&&2!=t.status?1:0}),this.m_arrUltimateTask.sort(function(e,t){return 0==e.status&&1==t.status?1:0==e.status&&2==t.status?-1:1==e.status&&1!=t.status?-1:2==e.status&&2!=t.status?1:0}),this.m_arrWeekTask.sort(function(e,t){return 0==e.status&&1==t.status?1:0==e.status&&2==t.status?-1:1==e.status&&1!=t.status?-1:2==e.status&&2!=t.status?1:0}),this.p_btnDailyTask.node.active=this.m_arrDailyTask.length>0,this.p_btnWeekTask.node.active=this.m_arrWeekTask.length>0,this.p_btnUltimateTask.node.active=this.m_arrUltimateTask.length>0,this.refreshContentUIByShowType()},refreshContentUIByShowType:function(e){this.m_numNowShowType!=e&&((e||0==e)&&(this.m_numNowShowType=e),this.p_btnWlzl.node.getChildByName("choose").active=0==this.m_numNowShowType,this.p_btnDailyTask.node.getChildByName("choose").active=1==this.m_numNowShowType,this.p_btnWeekTask.node.getChildByName("choose").active=3==this.m_numNowShowType,this.p_btnUltimateTask.node.getChildByName("choose").active=2==this.m_numNowShowType,this.p_nodeWlzlView.active=0==this.m_numNowShowType,this.p_nodeTaskView.active=0!=this.m_numNowShowType,this.refreshContentItem(),this.refreshBtnRed())},refreshContentItem:function(){this._refreshWlzlContentItem(),this._refreshTaskContentItem()},refreshBtnRed:function(){for(var e=!1,t=this.m_objData.wdlevel,a=0;a<t.length;++a)if(1==t[a].hget||1==t[a].nget){e=!0;break}this.p_btnWlzl.node.getChildByName("rednotice").active=e,this.p_btnDailyTask.node.getChildByName("rednotice").active=this._getNeedShowRed(this.m_arrDailyTask),this.p_btnUltimateTask.node.getChildByName("rednotice").active=this._getNeedShowRed(this.m_arrUltimateTask),this.p_btnWeekTask.node.getChildByName("rednotice").active=this._getNeedShowRed(this.m_arrWeekTask)},_getNeedShowRed:function(e){for(var t=0;t<e.length;++t)if(1==e[t].status)return!0;return!1},_refreshWlzlContentItem:function(){var e=this;if(this.m_arrWlzlItem=this.m_arrWlzlItem||[],0==this.m_numNowShowType){for(var t=-1,a=this.m_objData.wdlevel,i=0;i<a.length;++i){var n=this.m_arrWlzlItem[i];n||((n=cc.instantiate(this.p_nodeItemWlzl)).parent=this.p_nodeWlzlContent,this.m_arrWlzlItem.push(n)),n.active=!0,n.getComponent("activityWlzlItem").initUI(a[i],this.m_objData);var r=a[i];-1!=t||1!=r.nget&&1!=r.hget||(t=i)}for(var o=a.length;o<this.m_arrWlzlItem.length;++o)this.m_arrWlzlItem[o].active=!1;this.scheduleOnce(function(){var a=e.p_nodeItemWlzl.data.height*Math.max(t-1,0);e.p_nodeWlzlView.getComponent(cc.ScrollView).scrollToOffset(cc.Vec2(0,a))},.1)}else this.m_arrWlzlItem.forEach(function(e){e.active=!1})},_refreshTaskContentItem:function(){if(this.m_arrTaskItem=this.m_arrTaskItem||[this.p_nodeItemTask],0!=this.m_numNowShowType){var e=[];1==this.m_numNowShowType?e=this.m_arrDailyTask:2==this.m_numNowShowType?e=this.m_arrUltimateTask:3==this.m_numNowShowType&&(e=this.m_arrWeekTask);for(var t=0;t<e.length;++t){var a=this.m_arrTaskItem[t];a||((a=cc.instantiate(this.p_nodeItemTask)).parent=this.p_nodeTaskContent,this.m_arrTaskItem.push(a)),a.active=!0,a.getComponent("activityWlzlTaskItem").refreshUI(e[t])}for(var i=e.length;i<this.m_arrTaskItem.length;++i)this.m_arrTaskItem[i].active=!1}else this.m_arrTaskItem.forEach(function(e){e.active=!1})},refreshLvNum:function(e){this.p_labNum.string=e},refreshTime:function(){var e=app.player.getServerTime(),t=app.player.warorder_time[1];this.p_labTime.string=gUtils.getCountDownStr(t-e)},onClose:function(){this._super(),a.instance=null,eventMgr.off(eventStr.wlzl.WLZL_REFRESH,this.setParam,this)}});a.refreshRed=function(e){var t=!1;return t=!app.cacheActivityWlzl||app.getRedInfoByObj(["act","warorder"],0)>0,e&&(e.active=t),t},a.isOpen=function(){var e=app.player.getServerTime();return app.player.warorder_time&&e>=app.player.warorder_time[0]&&e<=app.player.warorder_time[1]},cc._RF.pop()},{basePage:void 0}],activityWorthFundPage:[function(e,t){"use strict";cc._RF.push(t,"2e7faZ+tIhApp1kD3Ky9Huc","activityWorthFundPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activityworthfundpage",pageType:1},properties:{p_btnReward:cc.Button,p_btnRev:cc.Button,p_labNum:cc.Label,p_labFanli:cc.RichText,p_nodeTxNum:cc.Node,p_sprTxValue:cc.Sprite,p_sprIconValue:cc.Sprite,p_arrTxValue:[cc.SpriteFrame],p_sprTxNum:cc.Sprite,p_sprTxIcon:cc.Sprite,p_arrTxNum:[cc.SpriteFrame],p_sprIcon:cc.Sprite,p_arrIcon:[cc.SpriteFrame],p_sprValue:cc.Sprite,p_arrValue:[cc.SpriteFrame],p_arrReward:[cc.Node],p_arrLab:[cc.Label],p_pfbItem:cc.Prefab},onLoad:function(){var e=this;a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.m_menu=this.node.getComponent("menu"),this.m_menu.init(this),this.m_arrItem=[],this.p_arrReward.forEach(function(t){var a=cc.instantiate(e.p_pfbItem);a.parent=t,a.scale=.8,a.y=12,e.m_arrItem.push(a)}),localDataUtils.SetValue("activityWorthFundRed",1,gUtils.getSecondDayTime(app.player.getServerTime()))},handleUI:function(){var e=this;this._super(),this.p_btnReward.node.on("click",function(){e.m_showData&&e.m_showData.arrItems&&app.pages.windowspagetipsrewards.showPage(e.m_showData.arrItems)}),this.p_btnRev.node.on("click",function(){e.clickBuyBtn()})},setParam:function(){var e=this;app.getRedInfoByObj(["worthfund"],0)>=1&&(app.redDataServer.worthfund-=1),app.arrRed.worthfund=!0,app.player.sfWorthfundlist(function(t,a){e.m_data=a,e.refreshArrItems(),e.m_menu.setMenuIndex(0)})},refreshArrItems:function(){if(!this.m_data||this.m_data.length<=0)app.showNotice(langMgr.getString("activityWorthFundPage",0));else for(var e=0;e<this.m_data.length;e++){this.m_data[e].arrShowItems=[],this.m_data[e].arrItems=[];for(var t=0;t<this.m_data[e].items.length;t++){var a=this.m_data[e].items[t],i={gsid:a.reward[0].GSID,count:a.reward[0].COUNT,day:t+1,have:this.m_data[e].daynum>t&&1==this.m_data[e].status};this.m_data[e].arrItems.push(i),1==a.type&&this.m_data[e].arrShowItems.push({num:t+1,reward:a.reward[0]})}}},payRefresh:function(){var e=this;this._payRefreshEnd||app.player.sfPlayerByParam(["props","hide","others","bagspace","vip","wfund_end","wfund_bought","firstcharge"],function(){e._payRefreshEnd=!0,app.mainScene&&app.mainScene.refreshLastTime(),e.refreshUI()})},menuHandler:function(e){if(a.isOpen()){if(this.m_menuIndex!=e){this.m_menuIndex=e,this.m_showData=this.m_data[this.m_menuIndex],this.p_sprTxValue.spriteFrame=this.p_arrTxValue[this.m_menuIndex],this.p_sprIcon.spriteFrame=this.p_arrIcon[this.m_menuIndex],this.p_sprValue.spriteFrame=this.p_arrValue[this.m_menuIndex],this.p_sprTxNum.spriteFrame=this.p_arrTxNum[this.m_menuIndex];var t=app.db.getPropsIconPath(38005);app.loadTexture(t,this.p_sprTxIcon,this.prefabPath),app.loadTexture(t,this.p_sprIconValue,this.prefabPath),this.refreshUI()}}else app.showNotice(langMgr.getString("activityWorthFundPage",0))},clickBuyBtn:function(){var e=this;a.isOpen()?app.player.sfWorthfundbuy(this.m_menuIndex,this.m_showData.price,function(){e._payRefreshEnd=!1;var t={reward:e.m_showData.sprice,showtype:1};app.pages.windowspagereward.showPage(t),e.m_showData.status=1,0==e.m_showData.daynum&&(e.m_showData.daynum=1),e.refreshArrItems(),e.refreshLabDay(),e.payRefresh(),e.schedule(e.payRefresh,1,3)},function(){app.showNotice(langMgr.getString("activityWorthFundPage",1))}):app.showNotice(langMgr.getString("activityWorthFundPage",0))},setReward:function(e){for(var t=[],a=this.m_data[e].items||[],i=this.m_data[e].sprice||[],n=0;n<a.length;++n)t.push(a[n]);for(var r=0;r<i.length;++r)t.push(i[r]);return t},refershRewards:function(){var e=this;this.p_arrReward.forEach(function(t,a){var i=e.m_showData.arrShowItems[a];if(t.active=!!i,t.active){var n=e.m_arrItem[a].getComponent("propItem");n.initForBag(i.reward),n.setClick(!0),e.p_arrLab[a].string=langMgr.getString("activityWorthFundPage",3,i.num)}})},refreshUI:function(){this.refershRewards(),this.refreshLabDay(),this.refreshBtn()},refreshBtn:function(){this.p_btnRev.node.active=1!=this.m_showData.status,this.p_btnRev.node.active&&(this.p_labNum.string="\xa5"+this.m_showData.price)},refreshLabDay:function(){this.p_nodeTxNum.active=1!=this.m_showData.status,this.p_labFanli.node.active=1==this.m_showData.status,1==this.p_labFanli.node.active&&(this.p_labFanli.string=langMgr.getString("activityWorthFundPage",3,[this.m_showData.daynum,this.m_showData.maxdaynum-this.m_showData.daynum]))},onClose:function(){this._super()}});a.getEndTime=function(){var e=app.player.wfund_end&&app.player.wfund_end[1]||0;return app.player.getServerTime()<=app.player.wfund_bought&&(e=-1),e},a.isOpen=function(){var e=app.player.getServerTime();return app.player.wfund_end&&e>=app.player.wfund_end[0]&&e<=app.player.wfund_end[1]},a.refreshRed=function(e){var t=!1,a=app.getRedInfoByObj(["worthfund"],null);return null!=a&&(t=a>0&&!localDataUtils.GetValue("activityWorthFundRed",null)),e&&(e.active=t),t},cc._RF.pop()},{basePage:void 0}],activityWstzPageBoss:[function(e,t){"use strict";function a(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(a)return(a=a.call(e)).next.bind(a);if(Array.isArray(e)||(a=i(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function i(e,t){if(e){if("string"==typeof e)return n(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?n(e,t):void 0}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,i=new Array(t);a<t;a++)i[a]=e[a];return i}cc._RF.push(t,"b316fpgxJxLILR/cCCqWJHY","activityWstzPageBoss");var r=cc.Class({extends:e("basePage"),statics:{prefabPath:"activitywstzpageboss",pageParent:"basepage"},properties:{p_labTime:cc.Label,p_btnHelp:cc.Button,p_btnReward:cc.Button,p_btnRank:cc.Button,p_btnChallege:cc.Button,p_btnFree:cc.Button,p_sprGeneral:cc.Sprite,p_spGeneral:sp.Skeleton,p_animGeneral:cc.Animation,p_scrView:cc.ScrollView,p_nodeItem:cc.Node,p_labLimit:cc.Label,p_labLimitNum:cc.Label,p_nodeProp:cc.Node,p_labPropNum:cc.Label,p_labDamage:cc.Label,p_labBossName:cc.Label,p_labMaxDamage:cc.Label,p_labMyRank:cc.Label,p_arrReward:[cc.Node],p_nodeRecReward:cc.Node},onLoad:function(){r.instance=this,this.stopBgNodeEvent(),this.creatMask(),this.handleUI()},onEnable:function(){eventMgr.on(eventStr.commonEvent.RefreshTime,this.refreshTime,this),eventMgr.on(eventStr.wstzPage.WSTZ_REFRESH_INFO,this.initData,this),eventMgr.on(eventStr.redEvent.RefreshWstzRed,this.refreshRed,this)},onDisable:function(){eventMgr.off(eventStr.commonEvent.RefreshTime,this.refreshTime,this),eventMgr.off(eventStr.wstzPage.WSTZ_REFRESH_INFO,this.initData,this),eventMgr.off(eventStr.redEvent.RefreshWstzRed,this.refreshRed,this)},handleUI:function(){var e=this;this._super(),this.p_btnHelp.node.on("click",function(){app.pages.windowspagetipshelp.showPage(1108)}),this.p_btnRank.node.on("click",function(){app.playSound("click"),app.pages.activitywstzpagerank.showPage({bossid:e.m_showData.id})}),this.p_btnReward.node.on("click",function(){app.playSound("click"),app.pages.activitywstzpagetask.showPage(e.m_showData)});var t=function(){app.bossId=e.m_showData.id,app.leftCards=e.m_showData.buff,app.goToBossBattle("wstzboss",e.m_showData)};this.p_btnFree.node.on("click",function(){app.playSound("click"),t()}),this.p_btnChallege.node.on("click",function(){app.playSound("click"),app.player.checkCount(e.m_showData.cost[0].GSID,e.m_showData.cost[0].COUNT)&&t()}),this.p_nodeRecReward.on("click",function(){app.player.sfWstzRecReward(e.m_rindex,e.m_showData.id,function(t,i){if(!t){for(var n,r=[],o=a(i);!(n=o()).done;){var s=n.value,p=s.gsid||s.GSID;"none"!=app.db.getTypeByGsid(p)&&r.push(s)}var c={showtype:1,reward:r,target:e};app.pages.windowspagereward.showPage(c),app.player.addItem(r),e.m_showData.myreward[e.m_rindex].status=2,app.player.sfWstzInfo(),e.refreshReward(),e.refreshUI()}})})},refreshReward:function(){if(this.m_showData&&this.m_showData.myreward){this.m_myReward=[],this.m_rindex=0,this.m_rStatus=0,this.m_numDamage=0;for(var e=0,t=0;t<this.m_showData.myreward.length;t++){var a=this.m_showData.myreward[t];if(0==a.status){this.m_myReward=a.reward,this.m_rindex=t-1,this.m_rStatus=0,this.m_numDamage=a.damage;break}if(1==a.status){this.m_myReward=a.reward,this.m_rindex=t,this.m_rStatus=1,this.m_numDamage=a.damage;break}2==a.status&&e++}e>=this.m_showData.myreward.length&&(this.m_rindex=this.m_showData.myreward.length-1,this.m_myReward=this.m_showData.myreward[this.m_rindex].reward,this.m_numDamage=this.m_showData.myreward[this.m_rindex].damage,this.m_rStatus=2)}},initData:function(e){var t=this;if(e&&!(e.length<=0)){for(var a=0;a<e.length;a++)if(app.wstzBossId==e[a].id){this.m_showData=e[a],this.refreshReward();break}app.player.sfPlayerByParam(["others","props"],function(){t.refreshUI()})}},setParam:function(e){if(!gUtils.activityIsOpen("WSTZ",!0))return this.onClose(),void(app.mainScene&&app.mainScene.refreshLeftButton());this.m_showData=e,app.wstzBossId=this.m_showData.id,this.refreshReward(),this.refreshUI()},refreshUI:function(){this.m_showData&&(app.loadGeneral(this.m_showData.gsid||this.m_showData.grid,this.p_sprGeneral,this.p_spGeneral,this.p_animGeneral,null,this.prefabPath),this.refreshTime(),this.p_labBossName.string=this.m_showData.name,this.p_labMaxDamage.string=gUtils.showCoinNum(this.m_showData.maxdamage)||"\u6682\u65e0\u4f24\u5bb3",this.p_labMyRank.string=this.m_showData.myrank&&"\u7b2c"+this.m_showData.myrank+"\u540d"||"\u6682\u65e0\u6392\u540d",this.p_labLimitNum.string=this.m_showData.remain+"/"+this.m_showData.limit,this.p_labDamage.string=gUtils.showCoinNum(this.m_showData.dailydamage)+"/"+gUtils.showCoinNum(this.m_numDamage),this.p_nodeProp.getComponent("propItem").initForBag(this.m_showData.cost[0]),this.p_labPropNum.string="("+app.player.getCount(this.m_showData.cost[0].GSID)+"/"+this.m_showData.cost[0].COUNT+")",this.refreshCount(),this.refreshRed(),this.refreshSView(this.m_showData.buff),this.refreshBtnUI(),this.refreshArrReward())},refreshRed:function(){this.p_btnReward.node.getChildByName("common_redpoint").active=1==this.m_rStatus,this.p_nodeRecReward.active=1==this.m_rStatus},refreshCount:function(){this.m_showData.remain<=0&&app.player.getCount(this.m_showData.cost[0].GSID)<this.m_showData.cost[0].COUNT?this.p_labPropNum.node.color=new cc.color(255,0,0,255):this.p_labPropNum.node.color=new cc.color(255,219,161,255)},refreshBtnUI:function(){if(this.m_showData){var e=this.m_showData.remain>0;this.p_btnFree.node.active=e,this.p_labLimitNum.node.active=e,this.p_labLimit.node.active=e,this.p_btnChallege.node.active=!e,this.p_nodeProp.active=!e,this.p_labPropNum.node.active=!e}},refreshSView:function(e){this.m_arrItems||(this.m_arrItems=[],this.m_arrItems.push(this.p_nodeItem));for(var t=0;t<e.length;++t){var a=e[t],i=this.m_arrItems[t];i||((i=cc.instantiate(this.p_nodeItem)).parent=this.p_scrView.content,this.m_arrItems.push(i)),i.getComponent("expeditionCardItem").refreshUI(a.id,this),i.getComponent("expeditionCardItem").setClick(!0),i.getComponent("expeditionCardItem").setCountry(!1),i.active=!0}for(var n=e.length;n<this.m_arrItems.length;++n)this.m_arrItems[n].active=!1},refreshArrReward:function(){for(var e=0;e<this.p_arrReward.length;e++){var t=this.p_arrReward[e];t.active=!!this.m_myReward[e],t.active&&(t.getChildByName("ui_eff_anim_light").active=1==this.m_rStatus,t.getChildByName("reward_icon_gouxuan").active=2==this.m_rStatus,t.getComponent("propItem").initForBag(this.m_myReward[e]),t.getComponent("propItem").setClick(1!=this.m_rStatus),1==this.m_rStatus&&app.loadEff("prop_light_01",t.getChildByName("ui_eff_anim_light").getComponent(cc.Animation),2,1.5,1.5,15))}},refreshTime:function(){var e=app.player.getServerTime(),t=gUtils.getActivityArrTime("WSTZ")[1]||0,a=t-e;(!t||a<0)&&(a=0),this.p_labTime.string=0!=a?gUtils.getCountDownStr(a):"00:00:00"},onClose:function(){this._super(),eventMgr.emit(eventStr.redEvent.RefreshWstzRed)}});r.refreshRed=function(e){return e&&(e.active=!1),!1},r.isOpen=function(){return!!gUtils.activityIsOpen("WSTZ")&&!!app.db.checkFuncUnLock("ACTIVITY_ZHD")},cc._RF.pop()},{basePage:void 0}],activityWstzPageRank:[function(e,t){"use strict";cc._RF.push(t,"a1dfc7FigZBAblq9IzGU+YS","activityWstzPageRank");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activitywstzpagerank",pageType:1},properties:{p_nodeView:cc.Node,p_nodeSelf:cc.Node},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!1),this.fitTopMenu(),this.handleUI()},handleUI:function(){this._super()},setParam:function(e){var t=this;app.player.sfWstzBossRank(e.bossid,function(e,a){e?app.showNotice(e):(t.m_data=a,t.m_arrData=t.m_data.rank||[],t.m_myRank=t.m_data.myRank||{name:app.player.rname,servid:app.player.servid},t.refreshUI())})},refreshUI:function(){this.p_nodeView.getComponent("tableView").initTableView(this.m_arrData.length,{array:this.m_arrData,target:this}),this.p_nodeSelf.getComponent("activityWstzRanktabvItem").refreshUI(this.m_myRank.rank,this.m_myRank)},onClose:function(){this._super(),eventMgr.emit(eventStr.redEvent.RefreshWstzRed)}});cc._RF.pop()},{basePage:void 0}],activityWstzPageTask:[function(e,t){"use strict";cc._RF.push(t,"e3762ZFpdRI0oSWsDS7P8PO","activityWstzPageTask");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activitywstzpagetask",pageType:1},properties:{p_nodeBgDaily:cc.Node,p_tabvDaily:cc.tableView,p_nodeBgAchieve:cc.Node,p_tabvAchieve:cc.tableView,p_nodeSelf:cc.Node},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.m_menu=this.node.getComponent("menu"),this.m_menu.init(this)},handleUI:function(){this._super()},setParam:function(e){var t=this;this.m_strShowType="achieve",this.m_bossid=e.id,this.m_myrank=e.myrank||0,this.m_myReward=[],this.m_index=1,app.player.sfWstzRewardInfo(this.m_bossid,function(e,a){if(!e){t.m_data=a;for(var i=0;i<t.m_data.dayreward.length;i++)if(2!=t.m_data.dayreward[i].status){t.m_strShowType="daily",t.m_index=0;break}t.m_menu.setMenuIndex(t.m_index),t.refreshUI()}})},refreshUI:function(){"daily"==this.m_strShowType?(this.p_nodeBgDaily.active=!0,this.p_nodeBgAchieve.active=!1):(this.p_nodeBgDaily.active=!1,this.p_nodeBgAchieve.active=!0),this.refreshView()},refreshMenuRed:function(){return!1},refreshView:function(){if(this.m_arrShowData){var e=this.m_arrShowData.length;if(this.m_tabvShowView.getComponent("tableView").initTableView(e,{array:this.m_arrShowData,bossid:this.m_bossid,target:this}),"daily"!=this.m_strShowType){for(var t=0;t<this.m_arrShowData.length;t++){var a=this.m_arrShowData[t].rank;a[1]&&a[0]<=this.m_myrank&&this.m_myrank<=a[1]?this.m_myReward=this.m_arrShowData[t].reward:a[0]==this.m_myrank&&(this.m_myReward=this.m_arrShowData[t].reward)}var i={rank:[this.m_myrank],reward:this.m_myReward};this.p_nodeSelf.getComponent("wstzTaskItem").setData(i)}this.refreshRed()}},reloadView:function(){this.m_arrShowData&&(this.m_arrShowData="daily"==this.m_strShowType?this.m_data.dayreward:this.m_data.rankreward,this.m_tabvShowView.getComponent("tableView").reload({array:this.m_arrShowData,bossid:this.m_bossid,target:this}),this.refreshRed())},refreshRed:function(){this.m_menu.refreshRed()},menuHandler:function(e){switch(e){case 0:this.m_strShowType="daily",this.m_arrShowData=this.m_data.dayreward,this.m_tabvShowView=this.p_tabvDaily;break;case 1:this.m_strShowType="achieve",this.m_arrShowData=this.m_data.rankreward,this.m_tabvShowView=this.p_tabvAchieve}this.refreshUI()},getNumDailyEnd:function(){var e=0;if(this.m_arrShowData){for(var t=0;t<this.m_arrShowData.length;++t){var a=this.m_arrShowData[t];app.player.getCount(a.GETMARK)>0&&++e}return e}},onClose:function(){this._super(),eventMgr.emit(eventStr.redEvent.RefreshWstzRed)}});a.showPage=function(t){var a=this;app.player.sfPlayerByParam(["others"],function(){e("basePage").showPage.call(a,t)})},a.refreshRed=function(e){return e.active=!1,!1},cc._RF.pop()},{basePage:void 0}],activityWstzPage:[function(e,t){"use strict";cc._RF.push(t,"34ad8StdzVA5L9GjM7B6TRl","activityWstzPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activitywstzpage",pageType:1},properties:{p_labTime:cc.Label,p_btnHelp:cc.Button,p_nodeBossList:[cc.Node],p_arrLabLimit:[cc.Label]},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){var e=this;this._super(),this.p_btnHelp.node.on("click",function(){app.pages.windowspagetipshelp.showPage(1108)});for(var t=function(t){e.p_nodeBossList[t].on("click",function(){gUtils.activityIsOpen("WSTZ",!0)&&app.pages.activitywstzpageboss.showPage(e.m_arrData[t])})},a=0;a<this.p_nodeBossList.length;a++)t(a)},onEnable:function(){eventMgr.on(eventStr.commonEvent.RefreshTime,this.refreshTime,this),eventMgr.on(eventStr.wstzPage.WSTZ_REFRESH_INFO,this.initData,this),eventMgr.on(eventStr.redEvent.RefreshWstzRed,this.refreshRed,this)},onDisable:function(){eventMgr.off(eventStr.commonEvent.RefreshTime,this.refreshTime,this),eventMgr.off(eventStr.wstzPage.WSTZ_REFRESH_INFO,this.initData,this),eventMgr.off(eventStr.redEvent.RefreshWstzRed,this.refreshRed,this)},setParam:function(){if(!gUtils.activityIsOpen("WSTZ",!0))return this.onClose(),void(app.mainScene&&app.mainScene.refreshLeftButton());app.player.sfWstzInfo()},initData:function(e){this.m_arrData=e,this.refreshUI()},refreshBossRed:function(e){if(null!=e&&this.m_arrData[e]){for(var t=!1,a=0;a<this.m_arrData[e].myreward.length;a++)if(1==this.m_arrData[e].myreward[a].status){t=!0;break}return t}},refreshUI:function(){if(this.m_arrData)for(var e=0;e<this.p_nodeBossList.length;e++){var t=this.p_nodeBossList[e];t&&(t.getChildByName("common_redpoint").active=this.m_arrData[e].remain>0||this.refreshBossRed(e),this.p_arrLabLimit[e].string=this.m_arrData[e].remain)}},refreshTime:function(){var e=app.player.getServerTime(),t=gUtils.getActivityArrTime("WSTZ")[1]||0,a=t-e;(!t||a<0)&&(a=0),this.p_labTime.string=0!=a?gUtils.getCountDownStr(a):"00:00:00"},refreshRed:function(){this.refreshUI()}});a.refreshRed=function(e){var t=!1,a=app.getRedInfoByObj(["act","wstz"],null);return null!=a&&(t=a>0),e&&(e.active=t),t},a.isOpen=function(){return!!gUtils.activityIsOpen("WSTZ")&&!!app.db.checkFuncUnLock("ACTIVITY_ZHD")},cc._RF.pop()},{basePage:void 0}],activityWzqdPage:[function(e,t){"use strict";cc._RF.push(t,"f8530hRJDxMzYNey5bdHc2N","activityWzqdPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activitywzqdpage",pageType:1},properties:{p_btnMobai:cc.Button,p_wzqdAllItem:cc.Node,p_labTime:cc.Label},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.fitTopMenu(),this.creatMask(!0),this.schedule(this.refreshTime,1),this.m_idx=0},onEnable:function(){this._super(),eventMgr.on(eventStr.redEvent.RefreshActivityWzqdRed,this.refreshUI,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.redEvent.RefreshActivityWzqdRed,this.refreshUI,this)},handleUI:function(){var e=this;this.p_btnMobai.node.on("click",function(){gUtils.activityIsOpen("WZQD",!0)&&app.player.sfWzqdReward(function(t){e.m_data.nowcount++,t.rewards.push({gsid:e.m_data.mark,count:1}),app.player.addItem(t.rewards);var a={showtype:1,reward:t.rewards,confirmcb:function(){e.setParam()},target:e};app.pages.windowspagereward.showPage(a)})})},start:function(){},setParam:function(){var e=this;gUtils.activityIsOpen("WZQD",!0)&&app.player.sfWzqdInfo(function(t){e.m_data=t,app.arrZhdData.WZQD=e.m_data.boxlist,e.refreshUI()})},refreshUI:function(){this.refreshTime(),this.p_wzqdAllItem.getComponent("wzqdAllItem").refreshUI(this.m_data),this.p_btnMobai.interactable=0==app.player.getCount(this.m_data.mark),this.p_btnMobai.node.getChildByName("rednotice").active=0==app.player.getCount(this.m_data.mark)},refreshTime:function(){var e=app.player.getServerTime(),t=gUtils.getActivityArrTime("WZQD")[1]||0,a=t-e;(!t||a<0)&&(a=0),this.p_labTime.string=0!=a?gUtils.getCountDownStr(a):"00:00:00"},onClose:function(){this._super(),gUtils.activityIsOpen("WZQD")||app.mainScene&&app.mainScene.refreshLeftButton()}});a.refreshRed=function(e){var t=app.player.getServerTime(),a=gUtils.getActivityArrTime("WZQD"),i=a[0]||0,n=a[1]||0;if(t<i||t>n)return e&&(e.active=!1),!1;var r=!1;if(app.arrZhdData.WZQD){for(var o=0;o<app.arrZhdData.WZQD.length;o++)if(1==app.arrZhdData.WZQD[o].status){r=!0;break}0==app.player.getCount(90472)&&(r=!0)}else{var s=app.getRedInfoByObj(["zhd","wzqd"],null);null!=s&&(r=s>0)}return e&&(e.active=r),r},cc._RF.pop()},{basePage:void 0}],activityXgSmallPage:[function(e,t){"use strict";cc._RF.push(t,"83b426mpUBN/ZJgcUfuVf4l","activityXgSmallPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activityxgsmallpage"},properties:{p_labTime:cc.Label,p_arrReward:[cc.Node],p_nodeNum:cc.Node,p_labNum:cc.Label,p_sprBg:cc.Sprite,p_btnBuy:cc.Button,p_sprPrice:cc.Sprite,p_labBuytime:cc.Label},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.schedule(this.refreshTime,1)},handleUI:function(){var e=this;this._super(),this.p_btnBuy.node.on("click",function(){app.playSound("click"),e.onClickBuy()})},start:function(){},setParam:function(e){var t=this;if(e){if(e.level)app.player.sfLevelGiftList(function(a,i){if(a);else{app.arrLevelData=i;for(var n=0;n<app.arrLevelData.length;n++)if(e.level==app.arrLevelData[n].level){t.m_objGift=app.arrLevelData[n],t.refreshUI();break}}});else if(e.gstar)for(var a=0;a<app.arrStarData.length;a++)if(e.gstar==app.arrStarData[a].gstar){this.m_objGift=app.arrStarData[a],this.refreshUI();break}}else cc.log("no objData, no refreshUI")},refreshUI:function(){var e=this,t=this.getGiftTpye(this.m_objGift);this.m_nowType=t;var a=this.m_objGift.items;if("level"==t){var i="activity_xglb/"+app.db.dbSpPackLevel[this.m_objGift.level].TCBG;app.loadTexture(gConfig.getActivePath(i),this.p_sprBg,this.prefabPath,function(){e.node.active=!0})}else if("star"==t){var n="activity_xglb/"+app.db.dbSpPackStar[this.m_objGift.gstar].TCBG;app.loadTexture(gConfig.getActivePath(n),this.p_sprBg,this.prefabPath,function(){e.node.active=!0})}this.m_numEndTime=this.m_objGift.end||0,this.refreshTime(),this.p_arrReward.forEach(function(t,i){var n=a[i];if(n){t.getComponent("propItem").initForBag(n);var r=e.m_objGift.buytime<=0;t.getComponent("propItem").setGray(r),t.getComponent("propItem").setClick(!0),t.getChildByName("picked").active=r,t.active=!0}else t.active=!1}),this.p_nodeNum.active="star"==t,this.p_labNum.string=this.m_objGift.buytime,"star"==t&&(this.p_labBuytime.string=langMgr.getString("activityXgSmallPage",0,app.db.dbSpPackStar[this.m_objGift.gstar].LIMIT)),app.loadTexture(gConfig.getPriceImg(this.m_objGift.price),this.p_sprPrice,this.prefabPath);var r=this.m_objGift.buytime>0;this.p_btnBuy.interactable=r},menuHandler:function(e){this.m_numNowIndex=e;var t=this.m_arrGift[e];this.refreshUI(t)},refreshTime:function(){var e=app.player.getServerTime(),t=this.m_numEndTime||0,a=(t-e)/1e3;(!t||a<0)&&(a=0,this.onClose()),this.p_labTime.string=gUtils.getHourMinSecTime(a)},onClickBuy:function(){var e=this;"level"==this.m_nowType?app.player.payLevelGift(this.m_objGift.level,this.m_objGift.price,function(){e._payRefreshEnd=!1;var t={showtype:1,reward:e.m_objGift.items,target:e};app.pages.windowspagereward.showPage(t),e.payRefresh(),e.schedule(e.payRefresh,1,3)},function(){cc.log("\u7b49\u7ea7\u793c\u5305\u8d2d\u4e70\u53d6\u6d88\u6216\u5931\u8d25")}):"star"==this.m_nowType&&app.player.payStarGift(this.m_objGift.gstar,this.m_objGift.price,function(){var t={showtype:1,reward:e.m_objGift.items,target:e};app.pages.windowspagereward.showPage(t),e._payRefreshEnd=!1,e.payRefresh(),e.schedule(e.payRefresh,1,3)},function(){cc.log("\u661f\u7ea7\u793c\u5305\u8d2d\u4e70\u53d6\u6d88\u6216\u5931\u8d25")})},getGiftTpye:function(e){var t="";return!!e.gstar&&(t="star"),!!e.level&&(t="level"),t},payRefresh:function(){var e=this;this._payRefreshEnd||app.player.sfPlayerData(function(){--e.m_objGift.buytime,e.refreshUI(e.m_objGift),e._payRefreshEnd=!0})},onClose:function(){this.node.active=!1,this._super()}});cc._RF.pop()},{basePage:void 0}],activityXiangouPage:[function(e,t){"use strict";cc._RF.push(t,"e2f28Pah4lJlajJi36rC5zp","activityXiangouPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activityxiangoupage"},properties:{p_menu:e("menu"),p_labTime:cc.Label,p_nodeLv:cc.Node,p_arrCoinNode:[cc.Node],p_arrReward:[cc.Node],p_scrView:cc.ScrollView,p_nodeItem:cc.Node,p_btnBuy:cc.Button,p_sprPrice:cc.Sprite},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(),this.fitTopMenu(),this.handleUI(),this.p_menu.init(this),this.m_menuItem=this.p_menu.p_arrBtnMenu[0],this.schedule(this.refreshTime,1)},handleUI:function(){var e=this;this._super(),this.p_btnBuy.node.on("click",function(){app.playSound("click"),e.onClickBuy()})},start:function(){},setParam:function(e){e?(this.m_level=e.level,this.m_gstar=e.gstar):(this.m_level=null,this.m_gstar=null),cc.log(app.gradegift);for(var t=0;t<app.gradegift.length;t++){var a=app.gradegift[t];app.player.getServerTime()>=a.expireAt&&app.gradegift.splice(t,1)}if(app.gradegift.length<=0)return app.mainScene.refreshTopButton(),void this.onClose();if(this.concatArrData(app.gradegift),this.getNewData(),null==localDataUtils.GetValue("xiangoured",null)){var i=app.player.getServerTime(),n=gUtils.getSecondDayTime(i);localDataUtils.SetValue("xiangoured",1,n)}},getNewData:function(){this.refreshMenu(),this.joinParam()},refreshCoinUI:function(){this.m_arrCoin=[38005,38006];for(var e=0;e<this.m_arrCoin.length;++e){var t=this.m_arrCoin[e],a=this.p_arrCoinNode[e];a.active=!0;var i=a.getChildByName("spr_prop_item").getComponent(cc.Sprite),n=a.getChildByName("lab_prop_num").getComponent(cc.Label),r=app.db.getPropsIconPath(t);app.loadTexture(r,i,this.prefabPath),n.string=gUtils.showNum(app.player.getCount(t))}for(var o=this.m_arrCoin.length;o<this.p_arrCoinNode.length;++o)this.p_arrCoinNode[o].active=!1},joinParam:function(){var e=0;if(this.m_level){for(var t=0;t<app.gradegift.length;t++)if(this.m_level==app.gradegift[t].level){e=t;break}}else if(this.m_gstar)for(t=0;t<app.gradegift.length;t++)if(this.m_gstar==app.gradegift[t].gstar){e=t;break}this.p_menu.setMenuIndex(e)},concatArrData:function(e){e&&(e.sort(function(e,t){return t.level-e.level}),e.sort(function(e,t){return t.gstar-e.gstar}))},refreshUI:function(e){if(e){var t=e;this.m_objGift=t;var a=this.getGiftTpye(t);this.m_nowType=a;var i=t.rewards||[],n="activity_xglb/";if("level"==a){if(!(r=app.db.dbSpPackLevel[this.m_objGift.level]))return this.onClose(),void app.showNotice(langMgr.getString("activityXiangouPage",0));n+=r.BG_PATH}else if("star"==a){var r;if(!(r=app.db.dbSpPackStar[this.m_objGift.gstar]))return this.onClose(),void app.showNotice(langMgr.getString("activityXiangouPage",0));n+=r.BG_PATH}app.loadTexture(gConfig.getActivePath(n),this.p_nodeLv.getComponent(cc.Sprite),this.prefabPath),this.m_numEndTime=t.expireAt||0,this.refreshTime(),this.p_arrReward.forEach(function(e,t){var a=i[t];a?(e.getComponent("propItem").initForBag(a),e.getComponent("propItem").setClick(!0),e.active=!0):e.active=!1}),app.loadTexture(gConfig.getPriceImg(t.price),this.p_sprPrice,this.prefabPath),this.refreshCoinUI()}else cc.log("no objGift, no refreshUI")},refreshMenu:function(){for(var e=this,t=function(t){var a=e.p_menu.p_arrBtnMenu[t];a||(a=cc.instantiate(e.m_menuItem),e.p_menu.p_arrBtnMenu.push(a),a.on("click",function(){app.playSound("click"),e.p_menu._onClickMenu(t)}),a.parent=e.p_menu.node),a.active=!0;var i=app.gradegift[t],n=e.getGiftTpye(i);a.getComponent("menuBtnXgItem").refreshUI(n,i,e)},a=0;a<app.gradegift.length;++a)t(a);for(var i=app.gradegift.length;i<this.p_menu.p_arrBtnMenu.length;++i)this.p_menu.p_arrBtnMenu[i].active=!1;this.scheduleOnce(function(){app.gradegift.length<=4&&(e.p_scrView.content.x+=(4-app.gradegift.length)*e.p_nodeItem.width+30)},.1),this.p_menu.refreshRed()},refreshMenuRed:function(){return!1},menuHandler:function(e){this.m_numNowIndex=e;var t=app.gradegift[e];this.refreshUI(t)},refreshTime:function(){var e=app.player.getServerTime(),t=this.m_numEndTime||0,a=t-e;(!t||a<0)&&(a=0),this.p_labTime.string=gUtils.getCountDownStr(a)},onClickBuy:function(){var e=this;app.player.getServerTime()>this.m_numEndTime?app.showNotice(langMgr.getString("activityXiangouPage",1)):app.player.payRecommendGift(this.m_objGift.type,this.m_objGift.price,function(){e._payRefreshEnd=!1;var t={showtype:1,reward:e.m_objGift.rewards,confirmcb:function(){app.reduceGradeGift(e.m_objGift.type),app.mainScene.refreshTopUI(),e.onClose()},target:e};app.pages.windowspagereward.showPage(t),e.payRefresh(),e.schedule(e.payRefresh,1,3)},function(){cc.log("\u7b49\u7ea7\u793c\u5305\u8d2d\u4e70\u53d6\u6d88\u6216\u5931\u8d25")})},getGiftTpye:function(e){var t="";return!!e.gstar&&(t="star"),!!e.level&&(t="level"),t},payRefresh:function(){var e=this;this._payRefreshEnd||app.player.sfPlayerData(function(){--e.m_objGift.buytime,e.refreshUI(e.m_objGift),e._payRefreshEnd=!0})},onClose:function(){this._super()}});a.refreshRed=function(e){var t=!1;return t||null==localDataUtils.GetValue("xiangoured",null)&&(t=!0),e&&(e.active=t),t},a.getLevel=function(e){var t=app.db.dbSpPackLevel,a=0;for(var i in e>=10&&(a=10),t)e>=t[i].LEVEL&&(a=t[i].LEVEL);return a},a.checkLvIsLb=function(e){if(!app.arrLevelData)return!1;for(var t=!1,a=0;a<app.arrLevelData.length;a++)e==app.arrLevelData[a].level&&app.arrLevelData[a].end&&app.arrLevelData[a].end>app.player.getServerTime()&&app.arrLevelData[a].buytime>0&&(t=!0);return t},a.checkLevelTan=function(e){var t=a.getLevel(e);return t&&a.checkLvIsLb(t)&&(t=0),t},a.checkStarTan=function(e){if(!(GodGuide._task||!app.arrStarData||app.guideProgress<24||gSetting.funofhide)){for(var t=!0,a=0;a<app.arrStarData.length;a++)e==app.arrStarData[a].gstar&&app.arrStarData[a].end&&app.arrStarData[a].end>app.player.getServerTime()&&(t=!1);t&&app.player.sfStarGiftList(function(t,a){if(t);else{app.arrStarData=a;for(var i=0;i<app.arrStarData.length;i++)e==app.arrStarData[i].gstar&&app.arrStarData[i].end&&app.arrStarData[i].end>app.player.getServerTime()&&app.arrStarData[i].buytime>0&&app.pages.activityxgsmallpage.showPage({gstar:e},app.mainScene.p_nodeBg)}})}},a.levelTips=function(e){GodGuide._task||gSetting.funofhide||app.guideProgress<24||(10==e?app.goToPage("activityyylbpage"):app.pages.activityxgsmallpage.showPage({level:e},app.mainScene.p_nodeBg))},cc._RF.pop()},{basePage:void 0,menu:void 0}],activityYblbPage:[function(e,t){"use strict";cc._RF.push(t,"4e3a732AZRDFpGi89A+8SPs","activityYblbPage");var a=["legion","nation","north"],i=cc.Class({extends:e("basePage"),properties:{p_scrView:cc.ScrollView,p_nodeItem:cc.Node,p_btnHelp:cc.Button,p_labTime:cc.Label,p_mainBg:cc.Sprite},statics:{prefabPath:"activityyblbpage",pageType:1},onLoad:function(){i.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.p_btnHelp.node.on("click",function(){app.pages.windowspagetipshelp.showPage(1046)})},onEnable:function(){this._super(),eventMgr.on(eventStr.commonEvent.RefreshTime,this.refreshTime,this),eventMgr.on(eventStr.zhdPage.YBLB_REFRESH_INFO,this.initData,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.commonEvent.RefreshTime,this.refreshTime,this),eventMgr.off(eventStr.zhdPage.YBLB_REFRESH_INFO,this.initData,this)},setParam:function(e){app.pages.activityyblbpage.isTan(),this.m_type=e||"legion",app.player.sfAuctionPackInfo(this.m_type)},initData:function(e){this.m_arrData=e,this.refreshUI()},refreshUI:function(){this.refreshSView(this.m_arrData),this.refreshTime(),app.loadTexture(gConfig.getActivePath("activity_yblb/package/yblb_bg_"+this.m_type),this.p_mainBg)},refreshSView:function(e){var t=this;this.m_arrItems||(this.m_arrItems=[],this.m_arrItems.push(this.p_nodeItem));for(var a=0;a<e.length;++a){var i=this.m_arrItems[a];i||((i=cc.instantiate(this.p_nodeItem)).parent=this.p_scrView.content,this.m_arrItems.push(i)),i.active=!0;var n={data:e[a],index:a,target:this,type:this.m_type,confrom:function(){app.redDataServer.auctionpack={legion:[0,0],nation:[0,0],north:[0,0]},t.onClose()}};i.getComponent("activityYblbItem").refreshUI(n)}for(var r=e.length;r<this.m_arrItems.length;++r)this.m_arrItems[r].active=!1},refreshTime:function(){var e=app.player.getServerTime(),t=app.redDataServer.auctionpack[this.m_type]&&app.redDataServer.auctionpack[this.m_type][1]||0,a=t-e;if((!t||a<0)&&(a=0),0==a)return this.p_labTime.string="00:00:00",app.redDataServer.auctionpack={legion:[0,0],nation:[0,0],north:[0,0]},void this.onClose();this.p_labTime.string=gUtils.getCountDownStr(a)}});i.refreshRed=function(e){return e&&(e.active=!1),!1},i.isTan=function(){if(!app.db.checkFuncUnLock("ACTIVITY_YBLB"))return!1;for(var e=0;e<a.length;++e){var t=app.redDataServer.auctionpack[a[e]]&&app.redDataServer.auctionpack[a[e]][0]||0,i=app.redDataServer.auctionpack[a[e]]&&app.redDataServer.auctionpack[a[e]][1]||0;if(0==t)return!1;var n=app.player.getServerTime();if(n>i)return!1;var r=localDataUtils.GetValue(app.player.uid+"yblbtime",0);if(n>=t&&n<=i&&!(r>=t&&r<=i))return localDataUtils.SetValue(app.player.uid+"yblbtime",n),!0}return!1},i.isOpen=function(){if(!app.db.checkFuncUnLock("ACTIVITY_YBLB"))return!1;for(var e=0;e<a.length;++e){var t=app.redDataServer.auctionpack[a[e]]&&app.redDataServer.auctionpack[a[e]][0]||0,i=app.redDataServer.auctionpack[a[e]]&&app.redDataServer.auctionpack[a[e]][1]||0;if(0==t)return!1;var n=app.player.getServerTime();if(n>t&&n<i)return!0}return!1},i.getEndTime=function(){var e=0;if(app.redDataServer.auctionpack)for(var t=0;t<a.length;++t){var i=app.redDataServer.auctionpack[a[t]]&&app.redDataServer.auctionpack[a[t]][0]||0,n=app.redDataServer.auctionpack[a[t]]&&app.redDataServer.auctionpack[a[t]][1]||0,r=app.player.getServerTime();r>i&&r<n&&(e=app.redDataServer.auctionpack[a[t]]&&app.redDataServer.auctionpack[a[t]][1]||0)}return app.player.getServerTime()>e?-1:e},cc._RF.pop()},{basePage:void 0}],activityYdhdPageKh:[function(e,t){"use strict";cc._RF.push(t,"91402K/m5FEY5i2pMNZvYfV","activityYdhdPageKh"),cc.Class({extends:cc.Component,properties:{p_labTime:cc.Label,p_scrView:cc.ScrollView,p_nodeItem:cc.Node,p_btnBuy:cc.Button,p_nodeQ:cc.Node},onLoad:function(){var e=this;this.schedule(this.refreshTime,1),this.p_btnBuy&&this.p_btnBuy.node.on("click",function(){e.onClickBtnBuy()}),this.p_nodeQ&&this.p_nodeQ.on("touchend",function(){app.pages.windowspageydright.showPage()})},refreshUI:function(e,t){this.m_objData=e,this.m_strType=t,this.refreshTime(),this.refreshSView(e,t),this.p_scrView.scrollToTop(.5),this.p_btnBuy&&(this.p_btnBuy.interactable=!app.player.special.specialyd)},refreshSView:function(e,t){this.m_arrItems||(this.m_arrItems=[],this.m_arrItems.push(this.p_nodeItem));for(var a=0;a<e.length;++a){var i=this.m_arrItems[a];i||((i=cc.instantiate(this.p_nodeItem)).parent=this.p_scrView.content,this.m_arrItems.push(i)),i.active=!0,i.getComponent("monthMissionItem").refreshUI(e[a],t)}for(var n=e.length;n<this.m_arrItems.length;++n)this.m_arrItems[n].active=!1},onClickBtnBuy:function(){var e=this;app.player.pay("specialyd",function(){e.payRefresh(),e.schedule(e.payRefresh,3,3)},function(){console.log("\u652f\u4ed8\u53d6\u6d88or\u5931\u8d25")})},payRefresh:function(){var e=this;app.player.sfPlayerData(function(){e.refreshUI(e.m_objData,e.m_strType)})},refreshTime:function(){var e=app.player.getServerTime(),t=app.player.ydend,a=t-e;(!t||a<0)&&(a=0),this.p_labTime.string=gUtils.getCountDownStr(a)}}),cc._RF.pop()},{}],activityYdhdPage:[function(e,t){"use strict";cc._RF.push(t,"5b69cmfDaNLeq6Sw2nxUNhz","activityYdhdPage");var a=[{name:"final",strTips:-1},{name:"pvp",strTips:0,goto:1022},{name:"gstar",strTips:1,goto:1016},{name:"affairs",strTips:2,goto:1027},{name:"exped",strTips:3,goto:1024}],i=cc.Class({extends:e("basePage"),statics:{prefabPath:"activityydhdpage"},properties:{p_arrGiftNode:[cc.Node],p_giftView:cc.ScrollView,p_nodeItem:cc.Node,p_btnBuy:cc.Button,p_nodeNum:cc.Node,p_labTimes:cc.Label,p_nodeTips:cc.Node,p_labTips:cc.Label,p_btnGoto:cc.Button},onLoad:function(){i.instance=this,this.stopBgNodeEvent(),this.creatMask(),this.fitTopMenu(),this.handleUI(),this.m_menu=this.node.getComponent("menu"),this.m_menu.init(this),this.m_arrItems=[],this.m_arrItems.push(this.p_nodeItem)},handleUI:function(){var e=this;this._super(),this.p_btnBuy.node.on("click",function(){if(!e.buyIng){e.buyIng=!0;var t={rewards:e.setRewards(),title:langMgr.getString("activityydhdpage",4),limitNum:0,buycb:function(){e.onClickBtnBuy()},cancelcb:function(){e.buyIng=!1},target:e};app.pages.windowspagerechargebuy.showPage(t)}}),this.p_btnGoto.node.on("click",function(){a[e.m_menuIndex]&&a[e.m_menuIndex].goto&&app.goToPage(a[e.m_menuIndex].goto)})},menuHandler:function(e){this.m_menuIndex=e,this.p_arrGiftNode.forEach(function(t,a){t.active=a==e}),this.refreshTips(),this.refreshData()},setParam:function(e){var t=e||0;this.time=0,this.isRTime=!0,this.buyIng=!1,this.refreshTime(),this.m_arrGiftData={},this.m_menu.setMenuIndex(t),localDataUtils.SetValue("ydhdRed",1,app.player.ydend)},refreshData:function(){if(this.m_menu.refreshRed(),this.m_arrGiftData&&this.m_arrGiftData.length>0&&this.m_arrGiftData[a[this.m_menuIndex].name].length>0){var e=this.m_arrGiftData[a[this.m_menuIndex].name];if(!(app.player.ydend<=app.player.getServerTime()))return void this.refreshUI(e)}var t="setData_"+a[this.m_menuIndex].name;this[t]&&this[t]()},setData_pvp:function(){this.m_arrGiftData[a[this.m_menuIndex].name]=app.db.dbMActivityPvp,this.refreshUI(this.m_arrGiftData[a[this.m_menuIndex].name])},setData_gstar:function(){this.m_arrGiftData[a[this.m_menuIndex].name]=app.db.dbMActivityGstar,this.refreshUI(this.m_arrGiftData[a[this.m_menuIndex].name])},setData_affairs:function(){this.m_arrGiftData[a[this.m_menuIndex].name]=app.db.dbMActivityAffairs,this.refreshUI(this.m_arrGiftData[a[this.m_menuIndex].name])},setData_exped:function(){this.m_arrGiftData[a[this.m_menuIndex].name]=app.db.dbMActivityExped,this.refreshUI(this.m_arrGiftData[a[this.m_menuIndex].name])},setData_final:function(){this.m_arrGiftData[a[this.m_menuIndex].name]=app.db.dbMActivityFinal,this.refreshUI(this.m_arrGiftData[a[this.m_menuIndex].name])},refreshCoin:function(){this.m_nowShowCoinData||(this.m_nowShowCoinData=[{type:"yb",gsid:38005},{type:"gold",gsid:38006}]);var e=this.m_nowShowCoinData;this.node.getComponent("currency").refreshCoin(e)},refreshUI:function(e){this.refreshCoin();for(var t=0;t<e.length;++t){var i=this.m_arrItems[t];i||((i=cc.instantiate(this.p_nodeItem)).parent=this.p_giftView.content,this.m_arrItems.push(i)),i.y=i.height*-t,i.active=!0,cc.log(e[t])}for(var n=0;n<e.length;++n)this.m_arrItems[n].getComponent("monthMissionItem").refreshUI(e[n],a[this.m_menuIndex].name);this.p_giftView.content.height=20+this.p_nodeItem.height*e.length;for(var r=e.length;r<this.m_arrItems.length;++r)this.m_arrItems[r].active=!1;this.time=1,this.p_btnBuy.node.active="final"==a[this.m_menuIndex].name&&!app.player.special.specialyd,this.p_nodeNum.getComponent("price_num_item").init(app.db.dbRecharge.specialyd.PRICE,1,2),this.p_btnBuy.interactable=!app.player.special.specialyd,this.p_btnBuy.node.active?this.p_giftView.node.getComponent(cc.Widget).bottom=250:this.p_giftView.node.getComponent(cc.Widget).bottom=140,this.p_giftView.node.getComponent(cc.Widget).updateAlignment()},refreshTips:function(){var e=a[this.m_menuIndex];e&&(this.p_nodeTips.active=e.strTips>=0,this.p_labTips.node.active=e.strTips>=0,e.strTips>=0&&(this.p_labTips.string=langMgr.getString("activityydhdpage",e.strTips)))},onClickBtnBuy:function(){var e=this;app.player.pay("specialyd",function(){e.payRefresh(),e.buyIng=!1,e.schedule(e.payRefresh,3,3)},function(){e.buyIng=!1})},payRefresh:function(){var e=this;app.player.sfPlayerData(function(){e.refreshData()})},setRewards:function(){for(var e={},t=0;t<app.db.dbMActivityFinal.length;t++)for(var a=app.db.dbMActivityFinal[t],i=0;i<a.ITEMS.S.length;++i){var n=a.ITEMS.S[i];e[n.GSID]?e[n.GSID]+=n.COUNT:e[n.GSID]=n.COUNT}var r=[];for(var o in e)r.push({GSID:o,COUNT:e[o]});return r},refreshTime:function(){var e=app.player.getServerTime(),t=app.player.ydend,a=t-e;(!t||a<0)&&(a=0),this.p_labTimes.string=gUtils.getCountDownStr(a)},update:function(e){this.isRTime&&(this.time>1?(this.time=0,this.refreshTime()):this.time+=e)},refreshMenuRed:function(){return!1},onClose:function(){this.isRTime=!1,this._super()}});i.refreshRed=function(e){var t=!1;return app.db.checkFuncUnLock("ACTIVITY_YDDH",!1)&&null==localDataUtils.GetValue("ydhdRed",null)&&(t=!0),e&&(e.active=t),t},cc._RF.pop()},{basePage:void 0}],activityYyhdPage:[function(e,t){"use strict";cc._RF.push(t,"3d7eaCwwAJHH4OlFOJh4Ok/","activityYyhdPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activityyyhdpage",pageType:1},properties:{p_labTime:cc.Label,p_btnGet:cc.Button,p_arrRewardItem:[cc.Node],p_preorderNum:cc.Label},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){var e=this;this.p_btnGet.node.on("click",function(){app.playSound("click"),e.onClickBtn()})},setParam:function(){var e=this;app.objActivityCache=app.objActivityCache||{},app.objActivityCache.activityYyhdPageDataCache?(this.m_objData=app.objActivityCache.activityYyhdPageDataCache,this.refreshUI()):app.player.sfGetYYHDInfo(function(t,a){t?app.showNotice(t):(app.objActivityCache.activityYyhdPageDataCache=a,e.m_objData=a,e.refreshUI())})},refreshUI:function(){this.p_preorderNum.string=this.m_objData.total,this.p_btnGet.node.getChildByName("tx_yilingqu").active=1==this.m_objData.status,this.p_btnGet.node.getChildByName("spr_lingqu").active=0==this.m_objData.status,this.p_btnGet.node.getChildByName("rednotice").active=0==this.m_objData.status,this.p_btnGet.interactable=0==this.m_objData.status,app.setSpriteState(this.p_btnGet.node.getComponent(cc.Sprite),1==this.m_objData.status)},refreshTime:function(){var e=app.player.getServerTime(),t=app.player.ga_time[1];this.p_labTime.string=gUtils.getCountDownStr(t-e)},onClickBtn:function(){var e=this;1!=this.m_objData.status?app.player.sfGetYYHDReward(function(t,a){if(t)return"nmore bag"==t&&(t=langMgr.getString("playerData",40)),void app.showNotice(t);localDataUtils.SetValue("YYHD_OVER",app.player.getServerTime(),0);var i={showtype:1,reward:a,target:e};app.pages.windowspagereward.showPage(i),app.getRedInfoByObj(["act","gappointment"],0)>=1&&(app.redDataServer.act.gappointment-=1),eventMgr.emit(eventStr.redEvent.RefreshMainSceneYyhd),e.m_objData.status=1,e.refreshUI(),app.player.sfPlayerData(function(){})}):app.showNotice("\u8be5\u5956\u52b1\u5df2\u9886\u53d6")}});a.isOpen=function(){var e=app.player.getServerTime(),t=e>app.player.ga_time[0]&&e<app.player.ga_time[1]&&app.db.checkFuncUnLock("ACTIVITY_YYHD"),a=localDataUtils.GetValue("YYHD_OVER",null);return a&&(t=t&&e<a),t},a.refreshRed=function(e){var t=app.getRedInfoByObj(["act","gappointment"],0)>0;return e&&(e.active=t),t},cc._RF.pop()},{basePage:void 0}],activityYylbPage:[function(e,t){"use strict";cc._RF.push(t,"23be7aAv31Mt5EanC/pBVuA","activityYylbPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activityyylbpage"},properties:{p_lyItems:cc.Layout,p_nodeItem:cc.Node,p_labTime:cc.Label,p_btnBuy:cc.Button},onLoad:function(){a.instance=this,this.schedule(this.refreshTime,1),this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){var e=this;this._super(),this.p_btnBuy.node.on("click",function(){app.player.payLevelGift(e.m_arrData.level,e.m_arrData.price,function(){e._payRefreshEnd=!1;var t={showtype:1,reward:e.m_arrData.items,target:e,confirmcb:function(){--e.m_arrData.buytime,e.refreshUI(),e.m_arrData.buytime<=0&&e.onClose()}};app.mainScene.city.refreshBtn(),app.pages.windowspagereward.showPage(t),e.payRefresh(),e.schedule(e.payRefresh,1,3)},function(){cc.log("\u7b49\u7ea7\u793c\u5305\u8d2d\u4e70\u53d6\u6d88\u6216\u5931\u8d25")})})},setParam:function(){var e=this;app.arrRed.yylb&&(app.arrRed.yylb=0,gUtils.saveHdRed()),app.player.sfLevelGiftList(function(t,a){if(t);else for(var i=0;i<a.length;i++)10==a[i].level&&(a[i].end>app.player.getServerTime()?(e.m_end=a[i].end,e.m_arrData=a[i],e.refreshUI()):e.onClose())})},refreshUI:function(){this.refreshTime(),this.m_numIndex=0,this.m_price=this.m_arrData.price,this.refreshBtnBuy(),this.refreshRewards(this.m_arrData.items)},payRefresh:function(){var e=this;this._payRefreshEnd||app.player.sfPlayerData(function(){e.refreshUI(),e._payRefreshEnd=!0})},refreshBtnBuy:function(){this.m_arrData.buytime<=0?this.p_btnBuy.interactable=!1:this.p_btnBuy.interactable=!0},refreshRewards:function(e){this.m_arrItems||(this.m_arrItems=[],this.m_arrItems.push(this.p_nodeItem));for(var t=0;t<e.length;++t){var a=this.m_arrItems[t];a||((a=cc.instantiate(this.p_nodeItem)).parent=this.p_lyItems.node,this.m_arrItems.push(a)),a.active=!0,a.getComponent("propItem").initForBag(e[t]),a.getComponent("propItem").setClick(!0)}for(var i=e.length;i<this.m_arrItems.length;++i)this.m_arrItems[i].active=!1},refreshTime:function(){var e=app.player.getServerTime(),t=this.m_end||0,a=t-e;if(!t||a<0)return a=0,void this.onClose();this.p_labTime.string=langMgr.getString("activityYylbPage",0,gUtils.getCountDownStr(a))},onClose:function(){this._super()}});a.refreshRed=function(e){e.active=!!app.arrRed.yylb},cc._RF.pop()},{basePage:void 0}],activityZhanshenlvbuPage:[function(e,t){"use strict";var a;cc._RF.push(t,"22974tUSDZJT4S/e6HCEHYS","activityZhanshenlvbuPage");var i=cc.Class(((a={extends:e("basePage"),statics:{prefabPath:"activityzhanshenlvbupage",pageType:1},properties:{p_nodeGeneral:cc.Node,p_sprGeneral:cc.Sprite,p_spGeneral:sp.Skeleton,p_animGeneral:cc.Animation,p_pfbQuality:cc.Prefab,p_nodeQuality:cc.Node,p_btnLook:cc.Button,p_btnGet:cc.Button,p_arrBtnName:[cc.Node],p_getRedNode:cc.Node,p_pfbItem:cc.Prefab,p_arrNode:[cc.Node],p_arrLab:[cc.Label],p_labPro:cc.Label,p_labTime:cc.Label},onLoad:function(){var e=this;i.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.m_arrItem=[],this.p_arrNode.forEach(function(t,a){var i=cc.instantiate(e.p_pfbItem);i.parent=t,e.m_arrItem.push(i),i.on("touchend",function(){e.onClickItemGet(a)})}),this.m_nodeQuality=cc.instantiate(this.p_pfbQuality),this.m_nodeQuality.parent=this.p_nodeQuality},onEnable:function(){this._super(),eventMgr.on(eventStr.commonEvent.RefreshTime,this.refreshTime,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.commonEvent.RefreshTime,this.refreshTime,this)},handleUI:function(){var e=this;this._super(),this.p_btnLook.node.on("click",function(){app.playSound("click");var t={isShowMode:!0};t.gsid=e.m_data.params.reward.items[0].GSID,t.tips="general",t.target=e,app.pages.generalpage.showPage(t)}),this.p_btnGet.node.on("click",function(){e.onClickGet()})}}).onEnable=function(){this.m_COMPLETE=[app.player.maxmapid,app.player.getCount(93302)]},a.setParam=function(){var e=this;if(!i.isOpen())return app.showNotice(langMgr.getString("activityZhdCxryVowPage",1)),void(app.mainScene&&app.mainScene.refreshLeftButton());this.m_arrState=[],app.player.sfGetZSLBInfo(function(t,a){if(t){if("finished"===t||"not start"===t)return;app.showNotice(t)}else console.log("ZSLB data is",a),e.m_data=a,e.refreshUI()});var t=app.player.getServerTime();if(null==localDataUtils.GetValue("lvbured",null)){var a=gUtils.getSecondDayTime(t);localDataUtils.SetValue("lvbured",1,a)}},a.start=function(){app.arrRed.zslb=!0},a.refreshUI=function(){var e=this,t=this.m_data.params.reward.items[0].GSID;app.loadGeneral(t,this.p_sprGeneral,this.p_spGeneral,this.p_animGeneral,function(){cc.isValid(e)},this.prefabPath);var a=app.db.getGBaseByGsid(t),i=a&&a.TGRADE?a.TGRADE:0;this.m_nodeQuality.getComponent("GeneralQualityItem").init(i),this.p_arrNode.forEach(function(t,a){e.p_arrLab[a].string=app.db.dbMslb[a].TARGET;var i=e.m_arrItem[a].getComponent("propItem"),n=e.m_data.params.reward["proitem"+(a+1)];cc.log("now proitem data is ",a,n),i.initForBag(n.items[0]);var r=n.require,o=n.limit;e.m_data.info&&e.m_data.info["proitem"+(a+1)]&&e.m_data.info["proitem"+(a+1)].times&&(o-=e.m_data.info["proitem"+(a+1)].times);var s=0;switch(1==r&&o>0&&(s=1),1==r&&o<=0&&(s=2),e.m_arrState.push(s),s){case 0:i.setClick(!0),i.setRed(!1),i.setGray(!1),i.setReceive(!1);break;case 1:i.setClick(!1),i.setRed(!0),i.setGray(!1),i.setReceive(!1);break;case 2:i.setClick(!1),i.setRed(!1),i.setGray(!0),i.setReceive(!0)}});for(var n=0,r=0;r<this.m_arrState.length;r++)2==this.m_arrState[r]&&n++;this.p_labPro.string=langMgr.getString("activityZhanshenlvbuPage",0,n),this.p_getRedNode.active=n>=3&&this.m_data.params.reward.limit-(this.m_data.info&&this.m_data.info.times||0)>0;var o=0;n>=3&&!this.m_data.params.reward.fulllimit&&(o=1),n>=3&&this.m_data.params.reward.fulllimit&&(o=2),n<3&&(o=0),this.isGet=Boolean(n>=3&&!this.m_data.params.reward.fulllimit),this.p_arrBtnName.forEach(function(e,t){e.active=Boolean(t==o)}),this.p_btnGet.interactable=this.isGet,this.refreshTime()},a.refreshTime=function(){var e=app.player.getServerTime(),t=gUtils.getActivityArrTime("ZSLB")[1]||0,a=t-e;(!t||a<0)&&(a=0),this.p_labTime.string=gUtils.getCountDownStr(a)},a.onClickItemGet=function(e){var t=this;if(i.isOpen()){var a=this.m_arrState[e];0!=a&&2!=a&&app.player.sfGetZSLBReward("proitem"+(e+1),function(e,a){if(e)return"finished"===e&&(e=langMgr.getString("activityZhanshenlvbuPage",3)),void app.showNotice(e);app.getRedInfoByObj(["act","zslb"],0)>=1&&(app.redDataServer.act.zslb-=1);var i={showtype:1,reward:a.items,confirmcb:function(){t.setParam()},target:t};app.pages.windowspagereward.showPage(i),app.player.addItem(a.items)})}else app.showNotice(langMgr.getString("activityZhanshenlvbuPage",1))},a.onClickGet=function(){var e=this,t=app.player.getServerTime(),a=gUtils.getActivityArrTime("ZSLB");if(t>a[1]||t<a[0])app.showNotice(langMgr.getString("activityZhanshenlvbuPage",1));else if(this.isGet)if(app.player.gnum>=app.player.bagspace){var i={content:langMgr.getString("activityZhanshenlvbuPage",4),confirmcb:function(){app.goToPage(1018)},cancelcb:function(){},target:this};app.pages.windowspagetipsmsg.showPage(i)}else app.player.sfGetZSLBReward("",function(t,a){if(t)return"finished"===t&&(t=langMgr.getString("activityZhanshenlvbuPage",3)),void app.showNotice(t);e.p_btnGet.interactable=!1,e.p_getRedNode.active=!1,e.p_arrBtnName.forEach(function(e,t){e.active=Boolean(2==t)}),app.player.addGeneral(a.general),app.getRedInfoByObj(["act","zslb"],0)>=1&&(app.redDataServer.act.zslb-=1);var i={showtype:1,reward:a.items,confirmcb:function(){app.player.sfPlayerByParam(["act"]),app.mainScene.m_btnCrscc.node.active=!1},target:e};app.pages.windowspagereward.showPage(i)});else app.showNotice(langMgr.getString("activityZhanshenlvbuPage",2))},a.onClickGoto=function(e){GOTO[e]?app.goToPage(GOTO[e]):app.showNotice(langMgr.getString("activityZhanshenlvbuPage",5))},a.onClose=function(){this._super(),i.isOpen()||app.mainScene&&app.mainScene.refreshLeftButton()},a));i.isOpen=function(){var e=gUtils.getActivityArrTime("ZSLB"),t=!1,a=app.player.getServerTime();return a>e[0]&&a<e[1]&&(t=!0),app.db.checkFuncUnLock("LVBU")||(t=!1),app.player.act&&app.player.act.ZSLB&&app.player.act.ZSLB.times>=1&&(t=!1),t},i.refreshRed=function(e){var t=!1,a=app.getRedInfoByObj(["act","zslb"],null);return null!=a&&a>0&&(t=!0),e&&(e.active=t),t},cc._RF.pop()},{basePage:void 0}],activityZhdCxryVowPage:[function(e,t){"use strict";cc._RF.push(t,"8b4db0um+FADb0HnsXuYk/B","activityZhdCxryVowPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activityzhdcxryvowpage",pageType:1},properties:{p_menu:cc.Node,p_tabViewGeners:cc.Node,p_nodeBg:cc.Node,p_pfbItem:cc.Prefab,p_layoutBg:cc.Layout,p_labNumChose:cc.Label,p_btnSave:cc.Button},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.p_menu.getComponent("menu").init(this)},handleUI:function(){var e=this;this._super(),this.p_btnSave.node.on("click",function(){e.onClickSave()})},setParam:function(e){var t=this;this.m_numCount=e.num||3,this.m_confunc=e.confunc,this.m_target=e.target;var a=function(){t.m_arrGeneralData||(t.m_arrGeneralData=t.refreshTableViewData()),t.upCxryLayout(),t.p_menu.getComponent("menu").setMenuIndex(0),t.refreshUI()};this.m_generals?a():app.player.sfGetCxryGenerList(function(e,i){e||(t.m_generals=i.generallist,a())})},initData:function(){this.m_gsids=[],this.m_tabListIndex=0,this.upActLayout(),this.upLabNumChose()},refreshUI:function(){this.initData()},menuHandler:function(e){this.m_arrShowData=this.m_arrGeneralData[e],this.m_arrChooseIndex&&(this.m_arrChooseIndex=[]),this.refreshHandbookView(),this.initData()},upCxryLayout:function(){this.m_arrItems||(this.m_arrItems=[],this.p_nodeBg.active=!0,this.m_arrItems.push(this.p_nodeBg),cc.instantiate(this.p_pfbItem).parent=this.p_nodeBg);for(var e=0;e<this.m_numCount;++e){var t=this.m_arrItems[e];t||((t=cc.instantiate(this.p_nodeBg)).parent=this.p_layoutBg.node,this.m_arrItems.push(t)),t.active=!0}for(var a=this.m_numCount;a<this.m_arrItems.length;++a)this.m_arrItems[a].active=!1},upActLayout:function(){for(var e=0;e<this.m_arrItems.length;e++){var t=this.m_arrItems[e].getChildByName("porp_item");this.m_gsids[e]?(t.active=!0,t.getComponent("propItem").initForGsid(this.m_gsids[e]),t.getComponent("propItem").setClick(!0)):t.active=!1}},upLabNumChose:function(){this.p_labNumChose.string=this.m_gsids.length+"/"+this.m_numCount},refreshHandbookView:function(){var e=this.m_arrShowData.length;this.p_tabViewGeners.getComponent("tableView").initTableView(e,{array:this.m_arrShowData,pickmax:this.m_numCount,target:this})},itemPorpClick:function(e){for(var t=this.m_arrShowData[e].GSID,a=-1,i=0;i<this.m_gsids.length;i++)this.m_gsids[i]==t&&(a=i);return-1==a?this.m_gsids.length<this.m_numCount?(this.m_gsids[this.m_tabListIndex]=t,this.m_tabListIndex++,this.upActLayout(),this.upLabNumChose(),!0):(app.showNotice(langMgr.getString("activityZhdCxryVowPage",0)),!1):-1!=a?(this.m_gsids.splice(a,1),this.m_tabListIndex--,this.m_tabListIndex<0&&(this.m_tabListIndex=0),this.upActLayout(),this.upLabNumChose(),!1):void 0},refreshTableViewData:function(){for(var e=[[],[],[],[],[],[]],t=0;t<this.m_generals.length;t++){var a=app.db.getGBaseByGsid(this.m_generals[t]);a&&5==a.STAR&&(e[a.OCCU-1].push(a),a.OCCU2&&a.OCCU2<=6&&e[a.OCCU2-1].push(a))}for(var i=0;i<e.length;++i)e[i].sort(function(e,t){if(e.TGRADE>t.TGRADE)return-1;if(e.TGRADE<t.TGRADE)return 1;if(e.TGRADE==t.TGRADE){if(e.GSID>t.GSID)return 1;if(e.GSID<t.GSID)return-1}return 0});return e},onClickSave:function(){var e=this;if(gUtils.activityIsOpen("ZMQY",!0))if(this.m_gsids.length<this.m_numCount)app.showNotice(langMgr.getString("activityZhdCxryVowPage",1));else{var t={content:langMgr.getString("activityZhdCxryVowPage",3),confirmcb:function(){app.player.sfSetCxryGenerals(e.m_gsids,function(t){if(t)app.showNotice(langMgr.getString("activityZhdCxryVowPage",2));else{app.getRedInfoByObj(["act","zmqy"],0)>=1&&(app.redDataServer.act.zmqy-=1);for(var a=0;a<e.m_gsids.length;a++)app.player.zmqy.gsidlist||(app.player.zmqy.gsidlist=[]),app.player.zmqy.gsidlist[a]={},app.player.zmqy.gsidlist[a].gsid=e.m_gsids[a];e.m_confunc&&e.m_confunc.call(e.m_target,e.m_gsids),e.onClose()}})},target:this};app.pages.windowspagetipsmsg.showPage(t)}},onClose:function(){this._super()}});cc._RF.pop()},{basePage:void 0}],activityZhdPage2:[function(e,t){"use strict";cc._RF.push(t,"15849V05LRF8IGXtiFAZhvR","activityZhdPage2");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activityzhdpage2"},properties:{p_nodeBg:cc.Node,p_scrView:cc.ScrollView,p_nodeItem:cc.Node,p_labNoActivity:cc.Node,p_nodeTop:cc.Node,p_nodeMask:cc.Node},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(),this.fitTopMenu(),this.handleUI(),this.m_menu=this.node.getComponent("menu"),this.m_arrZhdData=gUtils.deepClone(app.db.dbMWelfare.zhd2),this.m_menu.init(this)},onEnable:function(){this._super(),eventMgr.on(eventStr.redEvent.RefreshActivityRed,this.refreshRed,this),eventMgr.on(eventStr.commonEvent.RefershActivityZhdCoinUi,this.refreshCoinUI,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.redEvent.RefreshActivityRed,this.refreshRed,this),eventMgr.off(eventStr.commonEvent.RefershActivityZhdCoinUi,this.refreshCoinUI,this)},handleUI:function(){this._super()},menuHandler:function(e){if(this.m_index=e,this.m_arrShowPage[e]){var t=this.m_arrShowPage[e].SUOXIE;return!!gUtils.activityIsOpen(t,!0)&&(this.m_index=e,this.openShopPage(e),!0)}},setParam:function(e){this.m_arrShowPage=[];for(var t=0;t<this.m_arrZhdData.length;t++){var a=this.m_arrZhdData[t],i=!0,n=!1;a.FUNCTION_ID&&(i=app.db.checkFuncUnLock(a.FUNCTION_ID));var r=gUtils.getActivityArrTime(a.SUOXIE),o=app.player.getServerTime();r[0]<=o&&o<=r[1]&&(n=!0),n&&i&&this.m_arrShowPage.push(a)}this.m_arrShowPage.length<=0&&(this.p_labNoActivity.active=!0,app.mainScene&&app.mainScene.refreshLeftButton()),this.setMenuIndex(e)},setMenuIndex:function(e){var t=this,a=0;if(e)for(var i=0;i<this.m_arrShowPage.length;i++)if(e==this.m_arrShowPage[i].SUOXIE){a=i;break}this.m_arrShowPage[a]||(a=0),this.m_index!=a&&(this.m_index=a,app.player.sfPlayerByParam(["others"],function(){t.refreshSView(t.m_arrShowPage,a),t.m_menu.setMenuIndex(a)}))},openShopPage:function(e){var t=this,a=this.m_arrShowPage[e].PAGE,i=app.pages[a],n=function(){i.showPage({type:t.m_arrShowPage[e].SUOXIE},t.p_nodeBg,function(){t.m_showPage=i.instance,t.m_showPage.node.opacity=0,t.m_showPage.node.runAction(cc.fadeIn(.1)),t.refreshCoinUI(t.m_arrShowPage[e].SUOXIE)})};this.m_showPage?(this.m_showPage.node.active=!0,this.m_showPage.node.runAction(cc.sequence(cc.fadeOut(.1),cc.callFunc(function(){t.m_showPage.onClose(),t.m_showPage=null,n()})))):n(),this.refreshRed()},refreshSView:function(e,t){var a=this;if(e){this.m_arrItems||(this.m_arrItems=[],this.m_arrItems.push(this.p_nodeItem));for(var i=function(e){var t=a.m_arrItems[e];t||((t=cc.instantiate(a.p_nodeItem)).parent=a.p_scrView.content,a.m_menu.p_arrBtnMenu.push(t),t.on("click",function(){app.playSound("click"),a.m_menu._onClickMenu(e)}),a.m_arrItems.push(t)),t.active=!0},n=0;n<e.length;++n)i(n);for(var r=0;r<e.length;++r)this.m_arrItems[r].getComponent("activityZhdGameItem").refreshUI(e[r],r,this);for(var o=e.length;o<this.m_arrItems.length;++o)this.m_arrItems[o].active=!1;this.scheduleOnce(function(){if(e.length<=4)a.p_scrView.content.x=(4-e.length)*a.p_nodeItem.width-320;else{t=Math.max(t-1,0);var i=a.p_nodeItem.width*t;a.p_scrView.scrollToOffset(cc.Vec2(i,0))}},.1)}},refreshCoinUI:function(e){if(this.m_arrShowPage&&this.m_arrShowPage[this.m_index]){var t=[{type:"gold",gsid:38006},{type:"",gsid:38005}];switch(e||this.m_arrShowPage[this.m_index].SUOXIE){case"XSDH":t.push({type:"qxt",gsid:30014});break;case"GJDL":t.push({type:"shzl",gsid:30060})}this.p_nodeTop&&this.p_nodeTop.getComponent("currency").refreshCoin(t)}},refreshMenuRed:function(e){var t=this.m_arrShowPage[e].PAGE;return app.pages[t].refreshRed()},refreshRed:function(){this.m_menu.refreshRed()},onClose:function(){this.m_showPage&&cc.isValid(this.m_showPage.node)&&this.m_showPage.onClose(),this._super()}});a.refreshRed=function(e){for(var t=!1,a=0;a<app.db.dbMWelfare.zhd2.length;a++){var i=app.db.dbMWelfare.zhd2[a],n=!0;i.FUNCTION_ID&&(n=app.db.checkFuncUnLock(i.FUNCTION_ID));var r=gUtils.activityIsOpen(i.SUOXIE),o=i.PAGE,s=app.pages[o]&&app.pages[o].refreshRed();if(t=n&&r&&s)break}return e&&(e.active=t),t},a.isOpen=function(){for(var e=!1,t=0;t<app.db.dbMWelfare.zhd2.length;t++){var a=app.db.dbMWelfare.zhd2[t],i=!0;a.FUNCTION_ID&&(i=app.db.checkFuncUnLock(a.FUNCTION_ID));var n=!1,r=gUtils.getActivityArrTime(a.SUOXIE),o=app.player.getServerTime();if(r[0]<=o&&o<=r[1]&&(n=!0),e=n&&i)break}return e},cc._RF.pop()},{basePage:void 0}],activityZhdPageCjxg:[function(e,t){"use strict";cc._RF.push(t,"d8c0fZpJcNFYbP2FqEhoOhr","activityZhdPageCjxg");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activityzhdpagecjxg",pageParent:"activityzhdpage"},properties:{p_scrView:cc.ScrollView,p_nodeItem:cc.Node,p_sprBanner:cc.Sprite,p_btnHelp:cc.Button,p_labTime:cc.Label},onLoad:function(){a.instance=this,0!=app.OBJACTIVITYFIRSTOPENCACHE.ZhdPageCjxgBfo&&(app.OBJACTIVITYFIRSTOPENCACHE.ZhdPageCjxgBfo=!1,eventMgr.emit(eventStr.redEvent.RefreshActivityRed)),this.schedule(this.refreshTime,1),this.p_btnHelp.node.on("click",function(){app.pages.windowspagetipshelp.showPage("1051")}),this.canGetNum=0},setParam:function(){var e=this;if(app.arrZhdData.CJXG1?this.refreshUI():app.player.sfGetCjxg1(function(t,a){if(t)app.showNotice(t);else{if(!cc.isValid(e.node))return;app.arrZhdData.CJXG1=a,e.refreshUI()}}),null==localDataUtils.GetValue("activityzhdpagecjxgred",null)){var t=app.player.getServerTime(),a=gUtils.getSecondDayTime(t);localDataUtils.SetValue("activityzhdpagecjxgred",1,a)}},refreshUI:function(){if(app.arrZhdData.CJXG1){for(var e=[],t=[],a=0;a<app.arrZhdData.CJXG1.length;++a){var i=app.arrZhdData.CJXG1[a];i.index=a,i.buytime>0?e.push(i):t.push(i)}e=e.concat(t),this.refreshSView(e),this.refreshTime()}},refreshSView:function(e){this.m_arrItems||(this.m_arrItems=[],this.m_arrItems.push(this.p_nodeItem));for(var t=0;t<e.length;++t){var a=this.m_arrItems[t];a||((a=cc.instantiate(this.p_nodeItem)).parent=this.p_scrView.content,this.m_arrItems.push(a)),a.active=!0,a.getComponent("activityZhdCjxgItem").refreshUI(e[t],this,this.refreshUI)}for(var i=e.length;i<this.m_arrItems.length;++i)this.m_arrItems[i].active=!1},refreshTime:function(){var e=app.player.getServerTime(),t=gUtils.getActivityArrTime("CJXG1")[1]||0,a=t-e;(!t||a<0)&&(a=0),this.p_labTime.string=0!=a?gUtils.getCountDownStr(a):"00:00:00"}});a.refreshRed=function(e){return e&&(e.active=!1),!1},cc._RF.pop()},{basePage:void 0}],activityZhdPageCxry:[function(e,t){"use strict";cc._RF.push(t,"b5782qq28FDxZ6z/Fkx7GQg","activityZhdPageCxry");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activityzhdpagecxry",pageParent:"activityzhdpage"},properties:{p_btnVow:cc.Button,p_btnHelp:cc.Button,p_labTime:cc.Label,p_progBar:cc.ProgressBar,p_labSpeed:cc.Label,p_btnJiuguan:cc.Button,p_arrCard:[cc.Node],p_nodeCard:cc.Node,p_nodeHero:cc.Node,p_sprGeneral:cc.Sprite,p_spGeneral:sp.Skeleton,p_animGeneral:cc.Animation},onLoad:function(){a.instance=this,this.schedule(this.refreshTime,1),this.stopBgNodeEvent(),this.handleUI()},handleUI:function(){var e=this;this.p_btnVow.node.on("click",function(){app.playSound("click"),e.onClickVow()}),this.p_btnHelp.node.on("click",function(){app.pages.windowspagetipshelp.showPage("1068")}),this.p_btnJiuguan.node.on("click",function(){app.goToPage(1005)})},setParam:function(){var e=this;app.player.sfGetCxryInfo(function(t,a){t||cc.isValid(e.node)&&(e.m_data=a,e.refreshUI())})},refreshUI:function(){this.upBtnActive(),this.upLabSpeed(),this.upProgBar(),this.upArrCard(),this.refreshTime()},upArrCard:function(){var e=this,t=this.m_data.savegenerals||[];t.length<=0||this.p_arrCard.forEach(function(a,i){a.active=!!t[i];var n=a.getChildByName("card").getComponent(cc.Sprite);if(app.loadTexture(app.db.getGCardPathByGsid(e.m_data.savegenerals[i].gsid),n),t[i]){var r=a.getChildByName("spr_card_bg").getComponent(cc.Sprite);app.setSpriteState(n,!!t[i].isget),app.setSpriteState(r,!!t[i].isget),a.getChildByName("spr_yihuode").active=!!t[i].isget}})},upLabSpeed:function(){this.m_data&&(this.p_labSpeed.string=langMgr.getString("activityZhdPageCxry",0,[this.m_data.zf.cur,this.m_data.zf.max]))},upProgBar:function(){if(this.m_data){var e=this.m_data.zf.cur;0!=e&&(e/=this.m_data.zf.max),this.p_progBar.progress=e}},upLabNum:function(){this.m_data&&this.p_labNum.init(this.m_data.zf.prob/10+"%")},upBtnActive:function(){var e=this.m_data.savegenerals&&this.m_data.savegenerals.length>0;this.p_nodeHero.active=!e,this.p_nodeCard.active=e,this.p_btnVow.node.active=!e,this.p_btnJiuguan.node.active=e},upShowActive:function(){var e=!1;if(this.m_data.savegenerals&&this.m_data.savegenerals.length>0)for(var t=0;t<this.m_data.savegenerals.length;t++)0==this.m_data.savegenerals[t].isget&&(e=!0);else e=!0;e||(this.p_progBar.progress=1),this.p_nodeLv.active=e,this.p_labTitle.node.active=e,this.p_labYiHuoDe.node.active=!e},onClickVow:function(){var e=this;if(gUtils.activityIsOpen("ZMQY",!0)){var t={num:this.m_data.gnummax,confunc:function(t){e.m_data.savegenerals=[];for(var a=0;a<t.length;a++)e.m_data.savegenerals.push({gsid:t[a],isget:0});e.upBtnActive(),e.upArrCard()},target:this};app.pages.activityzhdcxryvowpage.showPage(t)}},refreshTime:function(){var e=app.player.getServerTime(),t=gUtils.getActivityArrTime("ZMQY")[1]||0,a=t-e;(!t||a<0)&&(a=0),this.p_labTime.string=0!=a?gUtils.getCountDownStr(a):"00:00:00"}});a.isSaveGenerals=function(){return!!gUtils.activityIsOpen("ZMQY")&&!!(a.refreshRed()&&app.db.checkFuncUnLock("ACTIVITY_ZHD")&&(app.guideProgress>=app.maxGuideProgress||app.player.getCount(90213)||app.player.level>=30))},a.isOpen=function(){return!!gUtils.activityIsOpen("ZMQY")&&!(!app.db.checkFuncUnLock("ACTIVITY_ZHD")||!(app.guideProgress>=app.maxGuideProgress||app.player.getCount(90213)||app.player.level>=30))},a.refreshRed=function(e){var t=!1,a=app.getRedInfoByObj(["act","zmqy"],null);return null!=a&&(t=a>0),e&&(e.active=t),t},cc._RF.pop()},{basePage:void 0}],activityZhdPageCzlb:[function(e,t){"use strict";cc._RF.push(t,"417f9eKf5NNWIslSJGA5bxJ","activityZhdPageCzlb");var a="CZLB",n=cc.Class({extends:e("basePage"),properties:{p_scrView:cc.ScrollView,p_pfbItem:cc.Prefab,p_sprBanner:cc.Sprite,p_btnHelp:cc.Button,p_labTime:cc.Label},statics:{prefabPath:"activityzhdpageczlb",pageParent:"activityzhdpage"},onLoad:function(){n.instance=this,this.stopBgNodeEvent(),this.m_strName="sfCzlbList",this.schedule(this.refreshTime,1),this.p_btnHelp.node.on("click",function(){app.pages.windowspagetipshelp.showPage(1046)}),localDataUtils.SetValue("czlbred",1,gUtils.getSecondDayTime(app.player.getServerTime()))},setParam:function(e){var t=this;switch(a=e&&e.type||"CZLB",this.m_strType="\u70b9\u5c06\u8d85\u503c\u793c\u5305",this.m_bannerPath="image_qxzb_zmlb_lang",a){case"CZLB":this.m_strName="sfCzlbList",this.m_bannerPath="czlb/image_qxzb_djlb_lang",this.m_strType="\u70b9\u5c06\u8d85\u503c\u793c\u5305";break;case"GXLB":this.m_strName="sfGxCzlbList",this.m_bannerPath="czlb/image_gz_gxlb_lang",this.m_strType="\u89c2\u661f\u8d85\u503c\u793c\u5305";break;case"GJLB":this.m_strName="sfGjCzlbList",this.m_bannerPath="czlb/image_qxzb_zmlb_lang",this.m_strType="\u6302\u673a\u8d85\u503c\u793c\u5305";break;case"GZLB":this.m_strName="sfGzCzlbList",this.m_bannerPath="czlb/image_fyzq_zmlb_lang",this.m_strType="\u9ad8\u62db\u8d85\u503c\u793c\u5305"}app.player[this.m_strName](function(e,a){if(e)app.showNotice(e);else{if(!cc.isValid(t.node))return;t.m_arrData=a,t.refreshUI()}})},refreshUI:function(){if(this.m_arrData){for(var e=[],t=[],a=0;a<this.m_arrData.length;++a){var i=this.m_arrData[a];i.index=a,i.buytime>0?e.push(i):t.push(i)}e=e.concat(t),app.loadTexture(gConfig.getZhdIconPath(this.m_bannerPath),this.p_sprBanner,this.prefabPath),this.refreshSView(e),this.refreshTime()}},refreshSView:function(e){this.m_arrItems||(this.m_arrItems=[]);for(var t=0;t<e.length;++t){var a=this.m_arrItems[t];a||((a=cc.instantiate(this.p_pfbItem)).parent=this.p_scrView.content,this.m_arrItems.push(a)),a.active=!0;var n={data:e[t],type:this.m_strType,target:this,confrom:this.refreshUI};a.getComponent("activityZhdCzlbItem").refreshUI(n)}for(var r=e.length;r<this.m_arrItems.length;++r)this.m_arrItems[i].active=!1},refreshTime:function(){var e=app.player.getServerTime(),t=gUtils.getActivityArrTime(a)[1]||0,i=t-e;(!t||i<0)&&(i=0),this.p_labTime.string=0!=i?gUtils.getCountDownStr(i):"00:00:00"}});n.refreshRed=function(e){var t=!localDataUtils.GetValue("czlbred",null);return e&&(e.active=t),t},cc._RF.pop()},{basePage:void 0}],activityZhdPageDcdy:[function(e,t){"use strict";cc._RF.push(t,"1f285UsOsdO2LecqQSkTgRU","activityZhdPageDcdy");var a=[32108,32109];cc.Class({extends:e("activityJchdPageItem"),properties:{p_sprIcon0:cc.Sprite,p_sprIcon1:cc.Sprite,p_labCount0:cc.Label,p_labCount1:cc.Label,p_btnBuy0:cc.Button,p_btnBuy1:cc.Button,p_btnHelp:cc.Button,p_labTime:cc.Label},onLoad:function(){this.schedule(this.refreshTime,1),this.handleUI()},handleUI:function(){var e=this;this.p_btnHelp.node.on("click",function(){app.pages.windowspagetipshelp.showPage("\u653e\u98de\u7eb8\u9e22",app.mainScene.p_nodeBg)}),this.p_sprIcon0.node.on("touchend",function(){app.pages.windowspagetipsrewards.showPage(e.m_arrData[0].ITEMS,app.mainScene.p_nodeBg)}),this.p_sprIcon1.node.on("touchend",function(){app.pages.windowspagetipsrewards.showPage(e.m_arrData[1].ITEMS,app.mainScene.p_nodeBg)});var t=gUtils.getActivityArrTime("DCDY");this.p_btnBuy0.node.on("click",function(){app.player.getServerTime()>(t[1]||0)?app.showNotice(langMgr.getString("activityZhdPageDcdy",1)):app.player.getCount(a[0])<=0?app.showNotice(langMgr.getString("activityZhdPageDcdy",2)):e.clickBtn(0)}),this.p_btnBuy1.node.on("click",function(){if(app.player.getServerTime()>(t[1]||0))app.showNotice(langMgr.getString("activityZhdPageDcdy",1));else if(app.player.getCount(a[1])<=0){var i={content:langMgr.getString("activityZhdPageDcdy",4),confirmcb:function(){app.pages.activityzhdpage.instance&&app.pages.activityzhdpage.instance.setJump("\u6302\u673a\u8d85\u503c\u793c\u5305")},target:e};app.pages.windowspagetipsmsg.showPage(i)}else e.clickBtn(1)})},clickBtn:function(e){var t=this,i=app.player.getCount(a[e]),n={gsid:a[e],maxcount:i,type:"box",coin:a[e],price:1,confirmcb:function(a){app.player.sfExchange(t.m_arrData[e].EXID,a,null,function(e){app.player.sfPlayerData(function(){var a={showtype:1,reward:e,target:t};app.pages.windowspagereward.showPage(a),t.upBtnStart()})})},target:this};app.pages.windowspagesetnum.showPage(n)},getNewData:function(e){this.m_target=e.target,this.m_arrData=[];for(var t=0;t<2;t++)this.m_arrData.push(app.db.getPropsInfoByGsid(a[t]));this.refreshUI()},refreshTime:function(){var e=app.player.getServerTime(),t=gUtils.getActivityArrTime("DCDY")[1]||0,a=t-e;(!t||a<0)&&(a=0),this.p_labTime.string=0!=a?gUtils.getCountDownStr(a):"00:00:00"},upBtnStart:function(){for(var e=0;e<2;e++){var t=app.player.getCount(a[e])||0;this["p_labCount"+e].string=langMgr.getString("activityZhdPageDcdy",0,t)}},refreshUI:function(){this.m_arrData&&(this.upBtnStart(),this.refreshTime())}}),cc._RF.pop()},{activityJchdPageItem:"activityJchdPageItem"}],activityZhdPageDjjf:[function(e,t){"use strict";cc._RF.push(t,"440d5Z//HVJc5rbyvDShM6S","activityZhdPageDjjf");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activityzhdpagedjjf",pageParent:"activityzhdpage"},properties:{p_scrView:cc.ScrollView,p_nodeItem:cc.Node,p_btnHelp:cc.Button,p_labTime:cc.Label,p_labLoop:cc.Label},onLoad:function(){a.instance=this,this.schedule(this.refreshTime,1),this.stopBgNodeEvent(),this.p_btnHelp.node.on("click",function(){app.pages.windowspagetipshelp.showPage("1036")})},setParam:function(){var e=this;gUtils.activityIsOpen("DJJF",!0)&&app.player.sfdjjfInfo(function(t,a){t||cc.isValid(e.node)&&(app.arrZhdData.djjf=a,e.m_arrData=a.missions,e.m_maxNum=0,e.m_numLoop=a.looplimit,e.m_nowLoop=a.currentloop,e.refreshUI())})},refreshUI:function(){if(this.m_arrData){var e=[],t=[],a=[];this.p_labLoop.string=langMgr.getString("activityZhdPageDjjf",0,[this.m_nowLoop,this.m_numLoop]);for(var i=0;i<this.m_arrData.length;++i){var n=this.m_arrData[i];switch(n.index=i,n.status){case 0:t.push(n);break;case 1:e.push(n);break;case 2:a.push(n)}}a.length>=this.m_arrData.length&&this.m_nowLoop<this.m_numLoop?this.setParam():(e=(e=e.concat(t)).concat(a),this.refreshSView(e),this.refreshTime(),eventMgr.emit(eventStr.redEvent.RefreshActivityRed))}},refreshTime:function(){var e=app.player.getServerTime(),t=gUtils.getActivityArrTime("DJJF")[1]||0,a=t-e;(!t||a<0)&&(a=0),this.p_labTime.string=0!=a?gUtils.getCountDownStr(a):"00:00:00"},refreshSView:function(e){this.m_arrItems||(this.m_arrItems=[],this.m_arrItems.push(this.p_nodeItem));for(var t=0;t<e.length;++t){var a=this.m_arrItems[t];a||((a=cc.instantiate(this.p_nodeItem)).parent=this.p_scrView.content,this.m_arrItems.push(a)),a.active=!0}for(var i=0;i<e.length;++i){var n={data:e[i],target:this,confrom:this.refreshUI};this.m_arrItems[i].getComponent("activityZhdDjjfItem").refreshUI(n)}for(var r=e.length;r<this.m_arrItems.length;++r)this.m_arrItems[r].active=!1}});a.refreshRed=function(e){var t=!1,a=app.getRedInfoByObj(["jchd","djjf"],null)||app.getRedInfoByObj(["jchd","xs_djjf"],null);return null!=a&&(t=a>0),e&&(e.active=t),t},cc._RF.pop()},{basePage:void 0}],activityZhdPageDjrw:[function(e,t){"use strict";cc._RF.push(t,"f066acDCE5MaaOLtmr09T6C","activityZhdPageDjrw");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activityzhdpagedjrw",pageParent:"activityzhdpage"},properties:{p_scrView:cc.ScrollView,p_nodeItem:cc.Node,p_labTime:cc.Label,p_btnHelp:cc.Button},onEnable:function(){this._super(),eventMgr.on(eventStr.commonEvent.RefreshTime,this.refreshTime,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.commonEvent.RefreshTime,this.refreshTime,this)},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.p_btnHelp.node.on("click",function(){app.pages.windowspagetipshelp.showPage("1037")})},setParam:function(){var e=this;gUtils.activityIsOpen("DJRW",!0)&&app.player.sfdjrwInfo(function(t,a){t||(e.m_arrData=a,cc.isValid(e.node)&&e.refreshUI())})},refreshUI:function(){if(this.m_arrData){for(var e=[],t=[],a=[],i=0;i<this.m_arrData.length;++i){var n=this.m_arrData[i];switch(n.index=i,n.status){case 0:t.push(n);break;case 1:e.push(n);break;case 2:a.push(n)}}e=(e=e.concat(t)).concat(a),this.refreshSView(e),this.refreshTime(),eventMgr.emit(eventStr.redEvent.RefreshActivityRed)}},refreshTime:function(){var e=app.player.getServerTime(),t=gUtils.getActivityArrTime("DJRW")[1]||0,a=t-e;(!t||a<0)&&(a=0),this.p_labTime.string=0!=a?gUtils.getCountDownStr(a):"00:00:00"},refreshSView:function(e){this.m_arrItems||(this.m_arrItems=[],this.m_arrItems.push(this.p_nodeItem));for(var t=0;t<e.length;++t){var a=this.m_arrItems[t];a||((a=cc.instantiate(this.p_nodeItem)).parent=this.p_scrView.content,this.m_arrItems.push(a)),a.active=!0}for(var i=0;i<e.length;++i)this.m_arrItems[i].getComponent("activityZhdDjrwItem").refreshUI(e[i],e[i].index,this,this.setParam);for(var n=e.length;n<this.m_arrItems.length;++n)this.m_arrItems[n].active=!1}});a.refreshRed=function(e){var t=!1,a=app.getRedInfoByObj(["jchd","djrw"],null);return null!=a&&(t=a>0),e&&(e.active=t),t},cc._RF.pop()},{basePage:void 0}],activityZhdPageGjdl2:[function(e,t){"use strict";cc._RF.push(t,"96859Bc5u5OtYLPDek4hJcH","activityZhdPageGjdl2");var a="GJDL",i=cc.Class({extends:e("basePage"),properties:{p_scrView:cc.ScrollView,p_sprBg:cc.Sprite,p_arrSprFrame:[cc.SpriteFrame],p_nodeItem:cc.Node,p_btnHelp:cc.Button,p_labTime:cc.Label},statics:{prefabPath:"activityzhdpagegjdl2",pageParent:"activityzhdpage"},onLoad:function(){i.instance=this,this.schedule(this.refreshTime,1),this.stopBgNodeEvent(),this.p_btnHelp.node.on("click",function(){var e=1040;"HQSD"==a&&(e=1088),app.pages.windowspagetipshelp.showPage(e)})},setParam:function(e){var t=this;this.m_strType="gjdl",a="GJDL";var i=0;e&&"HQSD"==e.type&&(this.m_strType="hqsd",a="HQSD",i=1),this.p_sprBg.spriteFrame=this.p_arrSprFrame[i],app.player.sfGetGjdl(this.m_strType,function(e,i){if(e)app.showNotice(e);else{if(!cc.isValid(t.node))return;t.m_data=i,app.arrZhdData[a]=t.m_data,t.refreshUI()}})},refreshUI:function(){if(this.m_data){for(var e=[],t=[],a=Math.ceil(this.m_data.length/4),i=0;i<a;i++){for(var n=1;n<=4;n++)t.push(this.m_data[4*i+(n-1)]);e.push(t),t=[]}this.refreshSView(e),this.refreshTime()}},refreshTime:function(){var e=app.player.getServerTime(),t=gUtils.getActivityArrTime(a)[1]||0,i=t-e;(!t||i<0)&&(i=0),this.p_labTime.string=0!=i?gUtils.getCountDownStr(i):"00:00:00"},refreshSView:function(e){this.m_arrItems||(this.m_arrItems=[],this.m_arrItems.push(this.p_nodeItem));for(var t=0;t<e.length;++t){var a=this.m_arrItems[t];a||((a=cc.instantiate(this.p_nodeItem)).parent=this.p_scrView.content,this.m_arrItems.push(a)),a.active=!0}for(var i=0;i<e.length;++i){var n={target:this,data:e[i],index:i,mode:this.m_strType};this.m_arrItems[i].getComponent("activityZhdGjdlItem2").refreshUI(n)}for(var r=e.length;r<this.m_arrItems.length;++r)this.m_arrItems[r].active=!1}});i.refreshRed=function(e){var t=!1;if(app.arrZhdData[a])app.arrZhdData[a][0]&&app.arrZhdData[a][0].consume[0]&&app.arrZhdData[a][0].consume[0].GSID&&app.player.getCount(app.arrZhdData[a][0].consume[0].GSID)>0&&(t=!0);else{var i="gjdl";"HQSD"==a&&(i="hqsd");var n=app.getRedInfoByObj(["act",i],null);null!=n&&(t=n>0)}return e&&(e.active=t),t},cc._RF.pop()},{basePage:void 0}],activityZhdPageGjdl:[function(e,t){"use strict";cc._RF.push(t,"c0389Q/rl5CxblM4UkrI9X9","activityZhdPageGjdl");var a=cc.Class({extends:e("basePage"),properties:{p_scrView:cc.ScrollView,p_nodeItem:cc.Node,p_btnHelp:cc.Button,p_labTime:cc.Label,p_labPrice:cc.Label,p_btnAddBp:cc.Button,p_sprHd:cc.Sprite,p_btnJiuguan:cc.Button},statics:{prefabPath:"activityzhdpagegjdl",pageParent:"activityzhdpage"},onLoad:function(){var e=this;a.instance=this,this.schedule(this.refreshTime,1),this.stopBgNodeEvent(),this.creatMask(!0),this.p_btnHelp.node.on("click",function(){app.pages.windowspagetipshelp.showPage("1040")}),this.p_btnAddBp.node.on("click",function(){app.goToPage(1001)}),this.p_sprHd.node.on("touchend",function(){app.showPropTips({gsid:e.m_data[0].consume[0].GSID})}),this.p_btnJiuguan.node.on("click",function(){app.goToPage(1001)})},setParam:function(){var e=this;this.m_strType="gjdl",app.player.sfGetGjdl(this.m_strType,function(t,a){if(t)app.showNotice(t);else{if(!cc.isValid(e.node))return;e.m_data=a,e.refreshUI()}})},refreshUI:function(){if(this.m_data){for(var e=[],t=[],a=Math.ceil(this.m_data.length/3),i=0;i<a;i++){for(var n=1;n<=3;n++)t.push(this.m_data[3*i+(n-1)]);e.push(t),t=[]}this.refreshSView(e),this.upLabPrice(),this.refreshTime()}},upLabPrice:function(){this.m_data&&this.m_data[0]&&this.m_data[0].consume&&this.m_data[0].consume[0]&&this.m_data[0].consume[0].GSID&&(this.p_labPrice.string=app.player.getCount(this.m_data[0].consume[0].GSID));var e=app.db.getPropsIconPath(this.m_data[0].consume[0].GSID);app.loadTexture(e,this.p_sprHd,this.prefabPath)},refreshTime:function(){var e=app.player.getServerTime(),t=app.arrZhdTime.GJDL.refresh||0,a=t-e;(!t||a<0)&&(a=0),this.p_labTime.string=0!=a?gUtils.getCountDownStr(a):"00:00:00"},refreshSView:function(e){this.m_arrItems||(this.m_arrItems=[],this.m_arrItems.push(this.p_nodeItem));for(var t=0;t<e.length;++t){var a=this.m_arrItems[t];a||((a=cc.instantiate(this.p_nodeItem)).parent=this.p_scrView.content,this.m_arrItems.push(a)),a.active=!0}for(var i=0;i<e.length;++i){var n={target:this,confirmcb:this.upLabPrice,data:e[i],index:i,mode:this.m_strType};this.m_arrItems[i].getComponent("activityZhdGjdlItem").refreshUI(n)}for(var r=e.length;r<this.m_arrItems.length;++r)this.m_arrItems[r].active=!1}});a.refreshRed=function(e){var t=!1,a=app.getRedInfoByObj(["jchd","gjdl"],null);return null!=a&&(t=a>0),e&&(e.active=t),t},cc._RF.pop()},{basePage:void 0}],activityZhdPageGxdb:[function(e,t){"use strict";cc._RF.push(t,"7a8359T/5tIIo6Wyp00XgIL","activityZhdPageGxdb");var a=cc.Class({extends:e("basePage"),properties:{p_scrView:cc.ScrollView,p_nodeItem:cc.Node,p_btnHelp:cc.Button,p_labTime:cc.Label,p_labLoop:cc.Label},statics:{prefabPath:"activityzhdpagegxdb",pageParent:"activityzhdpage"},onLoad:function(){a.instance=this,this.schedule(this.refreshTime,1),this.stopBgNodeEvent(),this.p_btnHelp.node.on("click",function(){app.pages.windowspagetipshelp.showPage("1038")})},setParam:function(){var e=this;gUtils.activityIsOpen("GXDB",!0)&&app.player.sfgxdbInfo(function(t,a){if(!t&&cc.isValid(e.node)){app.arrZhdData.gxdb=a,e.m_arrData=a.missions,e.m_maxNum=0,e.canGetNum=0;for(var i=0;i<e.m_arrData.length;i++)e.m_arrData[i].cnum>e.m_maxNum&&(e.m_maxNum=e.m_arrData[i].cnum),1==e.m_arrData[i].status&&e.canGetNum++;app.redDataServer.jchd.gxdb=e.canGetNum,e.m_numLoop=a.looplimit,e.m_nowLoop=a.currentloop,e.refreshUI()}})},refreshUI:function(){if(this.m_arrData){var e=[],t=[],a=[];this.p_labLoop.string=langMgr.getString("activityZhdPageGxdb",0,[this.m_nowLoop||0,this.m_numLoop]);for(var i=0;i<this.m_arrData.length;++i){var n=this.m_arrData[i];switch(n.index=i,n.status){case 0:t.push(n);break;case 1:e.push(n);break;case 2:a.push(n)}}a.length>=this.m_arrData.length&&this.m_nowLoop<this.m_numLoop?this.setParam():(e=(e=e.concat(t)).concat(a),this.refreshSView(e),this.refreshTime(),eventMgr.emit(eventStr.redEvent.RefreshActivityRed))}},refreshTime:function(){var e=app.player.getServerTime(),t=gUtils.getActivityArrTime("GXDB")[1]||0,a=t-e;(!t||a<0)&&(a=0),this.p_labTime.string=0!=a?gUtils.getCountDownStr(a):"00:00:00"},refreshSView:function(e){this.m_arrItems||(this.m_arrItems=[],this.m_arrItems.push(this.p_nodeItem));for(var t=0;t<e.length;++t){var a=this.m_arrItems[t];a||((a=cc.instantiate(this.p_nodeItem)).parent=this.p_scrView.content,this.m_arrItems.push(a)),a.active=!0}for(var i=0;i<e.length;++i){var n={data:e[i],count:this.m_count,target:this,confrom:this.refreshUI};this.m_arrItems[i].getComponent("activityZhdGxdbItem").refreshUI(n)}for(var r=e.length;r<this.m_arrItems.length;++r)this.m_arrItems[r].active=!1}});a.refreshRed=function(e){var t=!1,a=app.getRedInfoByObj(["jchd","gxdb"],null);return null!=a&&(t=a>0),e&&(e.active=t),t},cc._RF.pop()},{basePage:void 0}],activityZhdPageHhyyPreview:[function(e,t){"use strict";cc._RF.push(t,"e8c727VwBdC/oWeBpRTDmHu","activityZhdPageHhyyPreview");var a=cc.Class({extends:e("basePage"),properties:{p_scrView:cc.ScrollView,p_nodeItem:cc.Node},statics:{prefabPath:"activityzhdpagehhyypreview",pageType:1},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},setParam:function(e){this.m_arrData=e||[],this.refreshUI()},refreshUI:function(){this.m_arrItems=this.m_arrItems||[this.p_nodeItem];for(var e=0;e<this.m_arrData.length;++e){var t=this.m_arrItems[e];t||((t=cc.instantiate(this.p_nodeItem)).parent=this.p_scrView.content,this.m_arrItems.push(t)),t.getComponent("activityZhdHhyyPreviewItem").refreshUI(this.m_arrData[e],e),t.active=!0}for(var a=this.m_arrData.length;a<this.m_arrItems.length;++a)this.m_arrItems[a].active=!1}});cc._RF.pop()},{basePage:void 0}],activityZhdPageHhyyResult:[function(e,t){"use strict";cc._RF.push(t,"f22f8p4PBpAiZ0Vt5jZBOAV","activityZhdPageHhyyResult");var a=cc.Class({extends:e("basePage"),properties:{p_nodeTview:cc.Node},statics:{prefabPath:"activityzhdpagehhyyresult",pageType:1},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},setParam:function(e){this.m_arrData=e,this.refreshUI()},refreshUI:function(){this.m_arrItems=this.m_arrItems||[this.p_nodeItem],this.p_nodeTview.getComponent("tableView").initTableView(this.m_arrData.length,{array:this.m_arrData,target:this})}});cc._RF.pop()},{basePage:void 0}],activityZhdPageHhyy:[function(e,t){"use strict";cc._RF.push(t,"cf0f9WN/LRGD5rLue5t/OUn","activityZhdPageHhyy");var a=cc.Class({extends:e("basePage"),properties:{p_labTime:cc.Label,p_btnHelp:cc.Button,p_arrItems:[cc.Node],p_arrSprframe:[cc.SpriteFrame],p_labTaskTime:cc.Label,p_btnPreview:cc.Button,p_btnResult:cc.Button,p_btnQiFu:cc.Button,p_nodeZj:cc.Node,p_nodeWzj:cc.Node,p_labNum:cc.Label,p_nodeResultTime:cc.Node,p_labResultTime:cc.Label},statics:{prefabPath:"activityzhdpagehhyy",pageParent:"activityzhdpage"},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.schedule(this.refreshTime,1),this.schedule(this.changeState,20)},handleUI:function(){var e=this;this._super(),this.p_btnHelp.node.on("click",function(){app.playSound("click"),app.pages.windowspagetipshelp.showPage(1087)}),this.p_btnPreview.node.on("click",function(){app.playSound("click"),app.pages.activityzhdpagehhyypreview.showPage(e.m_objData.info)}),this.p_btnResult.node.on("click",function(){app.playSound("click"),app.pages.activityzhdpagehhyyresult.showPage(e.m_objData.prize)}),this.p_btnQiFu.node.on("click",function(){app.playSound("click"),e.onClickQiFu()})},setParam:function(){var e=this;gUtils.activityIsOpen("HHYY",!0)&&app.player.sfHhyyInfo(function(t,a){t?e.onClose():cc.isValid(e.node)&&(e.m_objData=a,e.refreshUI())})},refreshUI:function(){var e=this;if(this.m_objData&&this.m_objData.info){var t=this.m_objData.info[this.m_objData.curperoid]||this.m_objData.info[this.m_objData.info.length-1];if(t){this.p_labTaskTime.string=gUtils.dateFormatter(langMgr.getString("activityZhdPageHhyy",3),t.start)+"-"+gUtils.dateFormatter(langMgr.getString("activityZhdPageHhyy",3),t.end),this.refreshTime(),this.p_btnQiFu.node.active=3!=this.m_objData.status,3!=this.m_objData.status&&(this.p_btnQiFu.node.getChildByName("tx_yiqifu").active=2==this.m_objData.status,this.p_btnQiFu.node.getChildByName("tx_qifu").active=2!=this.m_objData.status,this.p_btnQiFu.node.getChildByName("red").active=1==this.m_objData.status,app.setSpriteState(this.p_btnQiFu.node.getComponent(cc.Sprite),1!=this.m_objData.status)),this.p_nodeResultTime.active=3!=this.m_objData.status,this.p_nodeZj.active=3==this.m_objData.status&&this.m_objData.arrreward&&this.m_objData.arrreward.length>0,this.p_nodeWzj.active=3==this.m_objData.status&&(!this.m_objData.arrreward||this.m_objData.arrreward.length<=0);var a,i=this.p_arrSprframe[0];i=0==this.m_objData.status?this.p_arrSprframe[0]:1==this.m_objData.status||2==this.m_objData.status?this.p_arrSprframe[1]:this.p_arrSprframe[2],this.p_arrItems.forEach(function(n,r){n.getComponent("propItem").initForBag(t.items[r].reward[0]),a=i,e.m_objData.arrreward&&-1!=e.m_objData.arrreward.indexOf(r)&&(a=e.p_arrSprframe[3]),n.getChildByName("hhyy_tx").getComponent(cc.Sprite).spriteFrame=a,n.getComponent("propItem").setClick(!0)}),this.m_objData.curperson=this.m_objData.curperson||0,this.p_labNum.string=this.m_objData.curperson,this.p_btnResult.node.getChildByName("common_redpoint").active=!1,app.redDataServer.act.hhyy=1==this.m_objData.status?1:0,eventMgr.emit(eventStr.nhdPage.REFRESH_BTN_RED)}}},onClickReward:function(e){if(this.m_objData&&this.m_objData.info){var t=this.m_objData.info[this.m_objData.curperoid]||this.m_objData.info[this.m_objData.info.length-1];if(t)try{var a=t.items[e].reward[0];app.showPropTips({gsid:a.GSID,count:a.COUNT,tips:"tips"})}catch(i){cc.log(i)}}},onClickQiFu:function(){var e=this;2!=this.m_objData.status?0!=this.m_objData.status?app.player.sfHhyyWish(function(t,a){if(!t){app.showNotice(langMgr.getString("activityZhdPageHhyy",6)),e.m_objData.status=2,e.m_objData.curperson+=1,e.refreshUI(),app.getRedInfoByObj(["act","hhyy"],0)>=1&&(app.redDataServer.act.hhyy-=1),app.player.addItem(a);var i={showtype:1,reward:a};app.pages.windowspagereward.showPage(i),eventMgr.emit(eventStr.nhdPage.REFRESH_BTN_RED),eventMgr.emit(eventStr.nhdPage.REFRESH_COIN)}}):app.showNotice(langMgr.getString("activityZhdPageHhyy",5)):app.showNotice(langMgr.getString("activityZhdPageHhyy",4))},refreshTime:function(){var e=app.player.getServerTime(),t=gUtils.getActivityArrTime("HHYY")[1]||0;if(this.p_labTime.string=gUtils.getCountDownStr(t-e),this.m_objData&&this.m_objData.info){var a=this.m_objData.info[this.m_objData.curperoid]||this.m_objData.info[this.m_objData.info.length-1];a&&a.end&&this.p_nodeResultTime.active&&(this.p_labResultTime.string=gUtils.getCountDownStr(Date.parse(a.end)-e))}},changeState:function(){if(this.m_objData&&this.m_objData.info){var e=this.m_objData.info[this.m_objData.curperoid];if(e){var t=app.player.getServerTime();if(0==this.m_objData.status&&t>Date.parse(e.start)+3e4)return this.m_objData.status=1,void this.refreshUI();if((1==this.m_objData.status||2==this.m_objData.status)&&t>Date.parse(e.start)+3e4)this.setParam();else{var a=this.m_objData.info[this.m_objData.curperoid+1];3==this.m_objData.status&&a&&t>Date.parse(a.refresh)+3e4&&this.setParam()}}}}});a.refreshRed=function(e){var t=!1,a=app.getRedInfoByObj(["act","hhyy"],null);return null!=a&&(t=a>0),e&&(e.active=t),t},cc._RF.pop()},{basePage:void 0}],activityZhdPageHjyt:[function(e,t){"use strict";cc._RF.push(t,"11982M4CeRDfb29MMjJZHgn","activityZhdPageHjyt");var a=cc.Class({extends:e("basePage"),properties:{p_nodeParant:cc.Node,p_nodeItem:cc.Node,p_nodeBgParent:cc.Node,p_nodeBg:cc.Node,p_arrSprFrame:[cc.SpriteFrame],p_arrCheckFrame:[cc.SpriteFrame],p_nodeCheckParent:cc.Node,p_nodeCheck:cc.Node,p_nodeGreeCheckParent:cc.Node,p_nodeGreeCheck:cc.Node,p_labTime:cc.Label,p_btnHelp:cc.Button,p_btnOne:cc.Button,p_btnFive:cc.Button,p_labScore:cc.Label,p_nodeHjmd:cc.Node,p_progBox:cc.ProgressBar,p_arrBox:[cc.Node],p_arrShaizi:[sp.Skeleton],p_nodeSkip:cc.Node,dismissFrames:[cc.SpriteFrame]},statics:{prefabPath:"activityzhdpagehjyt",pageParent:"activityzhdpage"},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.p_btnHelp.node.on("click",function(){app.pages.windowspagetipshelp.showPage(1086)}),this.addNodeItem(),this.handleUI()},handleUI:function(){var e=this;this._super(),this.p_btnOne.node.on("click",function(){e.extract(1)}),this.p_btnFive.node.on("click",function(){e.extract(5)}),this.p_nodeSkip.on("click",function(){1==e.m_skip?e.m_skip=2:e.m_skip=1,localDataUtils.SetValue("skip",e.m_skip,0),e.refreshBtnSkip()})},playShaizi:function(e,t){var a=this;if(e&&!(e.length<1)){var i=!1;console.log("\u64ad\u653e\u9ab0\u5b50"),this.refreshArrCheck(),this.p_nodeHjmd.active=!1,this.p_arrShaizi.forEach(function(t,a){t.node.active=null!=e[a]}),app.mainScene.p_nodeWait.show({isShow:!1}),e.length>1?(this.playArrShaiziNoStop(),this.m_arrZj=[],this.playShaiziZi(e,0,e.length-1,function(){i||(i=!0,a.overShaizi(),app.mainScene.p_nodeWait.hide(),a.p_nodeHjmd.active=!0,t&&t())})):this.playShaiziByIndex(0,e[0],function(){i||(i=!0,a.playArrCheck(e,function(){a.overShaizi(),app.mainScene.p_nodeWait.hide(),a.p_nodeHjmd.active=!0,t&&t()}))})}},overShaizi:function(){this.p_arrShaizi.forEach(function(e){e.clearTracks(),e.setToSetupPose(),e.setCompleteListener(null),e.node.active=!1})},playArrShaiziNoStop:function(){this.p_arrShaizi.forEach(function(e){e.setAnimation(0,"yao",!0)})},playShaiziByIndex:function(e,t,a){var i=this.p_arrShaizi[e];i.clearTracks(),i.setToSetupPose(),i.setAnimation(0,"yao",!1),i.setCompleteListener(function(){i.setAnimation(0,t,!1),i.setCompleteListener(a)})},refreshNodeCheck:function(){this.p_nodeCheck.x=this.m_arrItems[this.m_data.spot].x,this.p_nodeCheck.y=this.m_arrItems[this.m_data.spot].y},playShaiziZi:function(e,t,a,i){var n=this;this.playShaiziByIndex(t,e[t],function(){n.playCheck(e[t],function(){n.m_arrZj.push(n.m_data.spot),n.refreshArrCheck(n.m_arrZj),t<a?n.playShaiziZi(e,t+1,a,i):n.node.runAction(cc.sequence(cc.delayTime(.5),cc.callFunc(function(){i&&i()})))})})},playArrCheck:function(e,t){var a=this,i=e.length-1;this.playIndex(e,0,i,function(){a.node.runAction(cc.sequence(cc.delayTime(.5),cc.callFunc(function(){t&&t()})))})},playIndex:function(e,t,a,i){var n=this;this.playCheck(e[t],function(){t<a?n.playIndex(e,t+1,a,i):i&&i()})},playCheck:function(e,t){var a=this,i=this.m_data.spot,n=this.m_data.spot+e;this.m_data.spot=n%this.m_arrItems.length;var r=n-(this.m_arrItems.length-1);r>0?this.playSpr(i,this.m_arrItems.length-1,function(){a.node.runAction(cc.sequence(cc.delayTime(.1),cc.callFunc(function(){a.p_nodeCheck.x=a.m_arrItems[0].x,a.p_nodeCheck.y=a.m_arrItems[0].y,a.m_data.circle++,a.refreshBoxList(),a.playSpr(0,r-1,t)})))}):this.playSpr(i,n,t)},playSpr:function(e,t,a){var i=this;this.node.runAction(cc.sequence(cc.delayTime(.1),cc.callFunc(function(){i.p_nodeCheck.x=i.m_arrItems[e].x,i.p_nodeCheck.y=i.m_arrItems[e].y,e<t?i.playSpr(e+1,t,a):(i.p_nodeCheck.getComponent(cc.Sprite).spriteFrame=i.p_arrCheckFrame[1],i.p_nodeCheck.runAction(cc.sequence(cc.fadeTo(.1,0),cc.fadeTo(.1,255),cc.fadeTo(.1,0),cc.fadeTo(.1,255),cc.callFunc(function(){i.p_nodeCheck.getComponent(cc.Sprite).spriteFrame=i.p_arrCheckFrame[0]}))),a&&a())})))},extract:function(e){var t=this;gUtils.activityIsOpen("HJYT",!0)&&app.player.checkCount(this.m_costData[0].item.GSID,e*this.m_costData[0].item.COUNT)&&(app.mainScene.p_nodeWait.show({isShow:!1}),app.player.sfHjytRoll(e,function(a,i){if(a)return app.showNotice(a),void(t.isSpin=!1);t.p_arrShaizi[0].node.x=e>=5?-120:0,app.player.sfPlayerByParam(["others","vip","hide","props","firstcharge"],function(){eventMgr.emit(eventStr.commonEvent.RefershActivityZhdCoinUi);var a=function(){var a={showtype:2,reward:i.items,confirmcb:function(){t.isAgain=!1,t.isSpin=!1,t.refreshUI()},againname:e,againcb:function(e){t.isAgain=!0,cc.log("again look star"),t.isSpin=!1,t.refreshUI(function(){t.extract(e)})},againparm:[e],target:t};app.pages.windowspagereward.showPage(a)};if(1==t.m_skip)t.playShaizi(i.pos,a);else{t.m_arrZj=[];for(var n=0;n<i.pos.length;n++)t.m_data.spot+i.pos[n]>=t.m_arrItems.length&&(t.m_data.circle++,t.refreshBoxList()),t.m_data.spot=(t.m_data.spot+i.pos[n])%t.m_arrItems.length,t.m_arrZj.push(t.m_data.spot);t.refreshArrCheck(t.m_arrZj),t.refreshNodeCheck(),a()}t.isSpin=!0})}))},addNodeItem:function(){this.m_arrItems=[this.p_nodeItem],this.m_arrNodeBg=[this.p_nodeBg];for(var e=1;e<=6;e++){var t=cc.instantiate(this.p_nodeItem);t.parent=this.p_nodeParant,t.x=93*e-279,t.y=211,this.m_arrItems.push(t);var a=cc.instantiate(this.p_nodeBg);a.parent=this.p_nodeBgParent,a.x=t.x,a.y=t.y,this.m_arrNodeBg.push(a)}for(var i=1;i<=6;i++){var n=cc.instantiate(this.p_nodeItem);n.parent=this.p_nodeParant,n.x=279,n.y=211+-93*i,this.m_arrItems.push(n);var r=cc.instantiate(this.p_nodeBg);r.parent=this.p_nodeBgParent,r.x=n.x,r.y=n.y,this.m_arrNodeBg.push(r)}for(var o=1;o<=6;o++){var s=cc.instantiate(this.p_nodeItem);s.parent=this.p_nodeParant,s.x=93*(6-o)-279,s.y=-347,this.m_arrItems.push(s);var p=cc.instantiate(this.p_nodeBg);p.parent=this.p_nodeBgParent,p.x=s.x,p.y=s.y,this.m_arrNodeBg.push(p)}for(var c=1;c<=5;c++){var h=cc.instantiate(this.p_nodeItem);h.parent=this.p_nodeParant,h.x=-279,h.y=211+-93*(6-c),this.m_arrItems.push(h);var l=cc.instantiate(this.p_nodeBg);l.parent=this.p_nodeBgParent,l.x=h.x,l.y=h.y,this.m_arrNodeBg.push(l)}},onEnable:function(){this._super(),eventMgr.on(eventStr.commonEvent.RefreshTime,this.refreshTime,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.commonEvent.RefreshTime,this.refreshTime,this)},setParam:function(){var e=this;gUtils.activityIsOpen("HJYT",!0)&&app.player.sfHjytInfo(function(t,a){t||(app.arrZhdData.HJYT=a,e.m_data=app.arrZhdData.HJYT,e.m_costData=e.m_data.cost,e.p_nodeHjmd.active=!0,e.m_skip=localDataUtils.GetValue("skip",1),e.refreshUI(),e.refreshArrCheck())})},refreshUI:function(e){this.refreshTime(),this.refreshArrItem(),this.refreshBtn(),this.refreshBoxList(),this.refreshNodeCheck(),this.refreshBtnSkip(),this.p_nodeHjmd.getComponent("hjmdList").refreshUI(this.m_data.prize),e&&e()},pushPrize:function(e){this.m_data&&this.m_data.prize&&(this.m_data.prize.length>=30?this.m_data.prize[29]=e||{}:this.m_data.prize.push(e),this.p_nodeHjmd.getComponent("hjmdList").refreshUI(this.m_data.prize))},refreshBtnSkip:function(){var e=this.p_nodeSkip.getComponent(cc.Sprite),t=this.dismissFrames[this.m_skip-1];e.spriteFrame=t},refreshArrCheck:function(e){var t=e||[];this.m_arrNodeCheck||(this.m_arrNodeCheck=[this.p_nodeGreeCheck]);for(var a=0;a<t.length;a++){var i=t[a],n=this.m_arrNodeCheck[a];n||((n=cc.instantiate(this.p_nodeGreeCheck)).parent=this.p_nodeGreeCheckParent,this.m_arrNodeCheck.push(n)),n.active=!0,n.x=this.m_arrItems[i].x,n.y=this.m_arrItems[i].y}for(var r=t.length;r<this.m_arrNodeCheck.length;r++)this.m_arrNodeCheck[r].active=!1},refreshBoxList:function(){var e=this,t=this.m_data.circle,a=this.m_data.boxlist[this.m_data.boxlist.length-1].num;this.p_progBox.progress=t/a,this.p_labScore.string=t,this.p_arrBox.forEach(function(t,a){var i=e.m_data.boxlist[a];i.index=a,i.circle=e.m_data.circle,t.active=!!i,i.target=e,t.active&&t.getComponent("activityZhdHjytBoxItem").refreshUI(i)})},refreshBtn:function(){this.p_btnOne.node.getChildByName("lab_num").getComponent(cc.Label).string=this.m_costData[0].item.COUNT,this.p_btnFive.node.getChildByName("lab_num").getComponent(cc.Label).string=this.m_costData[1].item.COUNT,app.loadTexture(app.db.getPropsIconPath(this.m_costData[0].item.GSID),this.p_btnOne.node.getChildByName("spr_icon").getComponent(cc.Sprite),this.prefabPath),app.loadTexture(app.db.getPropsIconPath(this.m_costData[1].item.GSID),this.p_btnFive.node.getChildByName("spr_icon").getComponent(cc.Sprite),this.prefabPath)},refreshArrItem:function(){var e=this;this.m_arrItems.forEach(function(t,a){var i=e.m_data.spotitems[a];e.m_arrNodeBg[a].getComponent(cc.Sprite).spriteFrame=e.p_arrSprFrame[i.RARE],t.getComponent("propItem").initForBag(i),t.getComponent("propItem").setClick(!0)})},refreshTime:function(){var e=app.player.getServerTime(),t=gUtils.getActivityArrTime("HJYT")[1]||0,a=t-e;(!t||a<0)&&(a=0),this.p_labTime.string=0==a?"00:00:00":gUtils.getCountDownStr(a)}});a.refreshRed=function(e){var t=!1;if(app.arrZhdData.HJYT){for(var a=app.arrZhdData.HJYT.cost[0].item.GSID,i=app.player.getCount(a)>0,n=!1,r=app.arrZhdData.HJYT.boxlist,o=0;o<r.length;o++)1==r[o].status&&(n=!0);t=i||n}else{var s=app.getRedInfoByObj(["act","hjyt"],null);null!=s&&(t=s>0)}return e&&(e.active=t),t},cc._RF.pop()},{basePage:void 0}],activityZhdPageJfbx:[function(e,t){"use strict";cc._RF.push(t,"41b9ag0TAVMsJKZldNsIzyd","activityZhdPageJfbx");var a=0,i=cc.Class({extends:e("basePage"),statics:{prefabPath:"activityzhdpagejfbx",pageParent:"activityzhdpage"},properties:{p_scroView:cc.ScrollView,p_pfbItem:cc.Prefab,p_btnHelp:cc.Button,p_labTime:cc.Label,p_merBar:cc.ProgressBar,p_barItem:cc.Node,p_labScore:cc.Label,p_btnSource:cc.Button},onEnable:function(){this._super(),eventMgr.on(eventStr.commonEvent.RefreshTime,this.refreshTime,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.commonEvent.RefreshTime,this.refreshTime,this)},onLoad:function(){var e=this;i.instance=this,this.p_btnHelp.node.on("click",function(){app.playSound("click"),app.pages.windowspagetipshelp.showPage("1072")}),this.m_startContentY=this.p_scroView.content.y,this.m_startBarY=this.p_merBar.node.y,this.p_scroView.content.on("position-changed",function(){var t=e.p_scroView.content.y-e.m_startContentY;e.p_merBar.node.y=e.m_startBarY+t}),this.p_btnSource.node.on("click",function(){app.playSound("click"),app.pages.windowspageactivesource.showPage({title:"\u5b9d\u7bb1\u79ef\u5206\u83b7\u5f97\u65b9\u5f0f",event:e.m_data.event})}),a=-this.p_pfbItem.data.height},setParam:function(){var e=this;gUtils.activityIsOpen("JFBX",!0)&&app.player.sfGetJfbx(function(t,a){if(t)app.showNotice(t);else{if(!cc.isValid(e.node))return;e.m_data=a,e.refreshUI()}})},refreshUI:function(){this.m_data&&(this.m_numTotalScore=this.getTotalScore(),this.p_labScore.string=langMgr.getString("activityZhdPageJfbx",0,this.m_numTotalScore),this.refreshTime(),this.refreshSView(this.m_data.box),this.refreshProgBar(this.m_data.box))},refreshProgBar:function(e){if(this.m_arrBarItems||(this.m_arrBarItems=[this.p_barItem]),this.p_merBar.node.active=e&&e.length>0,e&&e.length>0){for(var t=0,i=e[0].score,n=0;n<e.length;++n){var r=this.m_arrBarItems[n];r||((r=cc.instantiate(this.p_barItem)).parent=this.p_merBar.node,this.m_arrBarItems.push(r)),r.y=n*a,r.getChildByName("pick").active=this.m_numTotalScore>=e[n].score,r.getComponentInChildren(cc.Label).string=e[n].score,t=e[n].score,this.m_maxScore=t,r.active=!0}var o=(e.length-1)*Math.abs(a);this.p_merBar.node.height=o,this.p_merBar.totalLength=o;for(var s=-1,p=0;p<e.length;p++){if(!(this.m_numTotalScore>=e[p].score)){s<0&&(s=0);break}s++}var c=0;s?(c=s/(e.length-1),s<e.length-1&&(c+=(this.m_numTotalScore-e[s].score)/(e[s+1].score-e[s].score)/(e.length-1))):c=0,this.p_merBar.progress=c,cc.log(o,this.m_numTotalScore,i,t);for(var h=e.length;h<this.m_arrBarItems.length;++h)this.m_arrBarItems[h].active=!1}},refreshSView:function(e){this.m_arrItems||(this.m_arrItems=[]);for(var t=0;t<e.length;++t){var a=this.m_arrItems[t];a||((a=cc.instantiate(this.p_pfbItem)).parent=this.p_scroView.content,this.m_arrItems.push(a)),a.getComponent("activityZhdJfbxItem").init(e[t],t,this),a.active=!0}for(var i=e.length;i<this.m_arrItems.length;++i)this.m_arrItems[i].active=!1},refreshTime:function(){var e=app.player.getServerTime(),t=gUtils.getActivityArrTime("JFBX")[1]||0,a=t-e;(!t||a<0)&&(a=0),this.p_labTime.string=0!=a?gUtils.getCountDownStr(a):"00:00:00"},getTotalScore:function(){for(var e=0,t=0;t<this.m_data.event.length;++t){var a=this.m_data.event[t],i=app.player.getCount(a.mark);e+=i=Math.min(i,a.limit)}return e}});i.refreshRed=function(e){var t=!1,a=app.getRedInfoByObj(["act","jfbx"],null);return null!=a&&(t=a>0),e&&(e.active=t),t},cc._RF.pop()},{basePage:void 0}],activityZhdPageJrlb:[function(e,t){"use strict";cc._RF.push(t,"e77277G7gZAjqGQtQF1Im62","activityZhdPageJrlb"),cc.Class({extends:e("activityJchdPageItem"),properties:{p_scrView:cc.ScrollView,p_nodeItem:cc.Node,p_sprBanner:cc.Sprite,p_btnHelp:cc.Button,p_labTime:cc.Label},onLoad:function(){this.schedule(this.refreshTime,1),this.p_btnHelp.node.on("click",function(){app.pages.windowspagetipshelp.showPage("\u8282\u65e5\u793c\u5305",app.mainScene.p_nodeBg)})},getNewData:function(e){var t=this;this.m_target=e.target,app.arrZhdData.CJXG1?this.refreshUI():app.player.sfGetCjxg1(function(e,a){if(e)app.showNotice(e);else{if(!cc.isValid(t.node))return;app.arrZhdData.CJXG1=a,t.refreshUI()}})},refreshUI:function(){app.arrZhdData.CJXG1&&(this.refreshSView(app.arrZhdData.CJXG1),this.refreshTime())},refreshSView:function(e){this.m_arrItems||(this.m_arrItems=[],this.m_arrItems.push(this.p_nodeItem));for(var t=0;t<e.length;++t){var a=this.m_arrItems[t];a||((a=cc.instantiate(this.p_nodeItem)).parent=this.p_scrView.content,this.m_arrItems.push(a)),a.active=!0,a.getComponent("activityZhdJrlbItem").refreshUI(e[t],t,this.m_target)}for(var i=e.length;i<this.m_arrItems.length;++i)this.m_arrItems[i].active=!1},refreshTime:function(){var e=app.player.getServerTime(),t=gUtils.getActivityArrTime("JRLB1")[1]||0,a=t-e;(!t||a<0)&&(a=0),this.p_labTime.string=0!=a?gUtils.getCountDownStr(a):"00:00:00"}}),cc._RF.pop()},{activityJchdPageItem:"activityJchdPageItem"}],activityZhdPagePflb:[function(e,t){"use strict";cc._RF.push(t,"488f36ng9VA5ZNgJGONPl9P","activityZhdPagePflb");var a=cc.Class({extends:e("basePage"),properties:{p_sprGeneral:cc.Sprite,p_spGeneral:sp.Skeleton,p_animGeneral:cc.Animation,p_arrLabelP:[cc.Label],p_btnPreview:cc.Button,p_labTime:cc.Label,p_arrNodeItem:[cc.Node],p_nodePrice:cc.Node,p_btnBuy:cc.Button},statics:{prefabPath:"activityzhdpagepflb",pageParent:"activityzhdpage"},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.schedule(this.refreshTime,1),this.handleUI()},handleUI:function(){var e=this;this._super(),this.p_btnBuy.node.on("click",function(){if(e.m_arrData&&(app.playSound("click"),!(e.m_arrData[0].buytime<=0))){var t={rewards:e.m_arrData[0].items,title:"\u70bc\u72f1\u725b\u9b54\u793c\u5305",limitNum:0,buycb:function(){e.onClickBuy()},cancelcb:function(){e.buyIng=!1},target:e};app.pages.windowspagerechargebuy.showPage(t)}}),this.p_btnPreview.node.on("click",function(){app.playSound("click"),app.pages.playvideopage.showPage("pflb")})},setParam:function(){var e=this;if(app.cacheActivityPflb)return this.m_arrData=app.cacheActivityPflb,void this.refreshUI();app.player.sfPflbInfo(function(t,a){t?app.showNotice(t):cc.isValid(e.node)&&(app.cacheActivityPflb=a,e.m_arrData=a,e.refreshUI())})},refreshUI:function(){var e=this;if(this.m_arrData){app.loadGeneral(10446,this.p_sprGeneral,this.p_spGeneral,this.p_animGeneral,function(){cc.isValid(e)},this.prefabPath,10442),this.p_nodePrice.getComponent("price_num_item").init(this.m_arrData[0].price,1,3);for(var t=app.db.getSkinConfigBySkinId(10442),a=0;a<this.p_arrLabelP.length;a++)if(this.p_arrLabelP[a].node.active=!!t.ARRATT[a],t.ARRATT[a]){var i=app.db.getPropertyIdByCn(t.ARRATT[a].ATT),n=t.ARRATT[a].COUNT/10;this.p_arrLabelP[a].string=i+"+"+n+"%"}for(var r=this.m_arrData[0].items,o=0;o<this.p_arrNodeItem.length;++o)this.p_arrNodeItem[o].active=!!r[o],r[o]&&(this.p_arrNodeItem[o].getComponent("propItem").initForBag(r[o]),this.p_arrNodeItem[o].getComponent("propItem").setClick(!0));this.refreshBtnState()}},refreshBtnState:function(){app.setSpriteState(this.p_btnBuy.node.getComponent(cc.Sprite),this.m_arrData[0].buytime<=0)},refreshTime:function(){var e=gUtils.getActivityArrTime("PFLB");this.p_labTime.string=gUtils.getCountDownStr((e[1]||0)-app.player.getServerTime())},onClickBuy:function(){var e=this;app.player.sfPayPflb(this.m_arrData[0].price,0,function(){var t={reward:e.m_arrData[0].items,showtype:1};app.pages.windowspagereward.showPage(t),e.m_arrData[0].buytime-=1,e.refreshBtnState(),app.player.sfPlayerByParam(["others","vip","hide","props","firstcharge"],function(){app.mainScene&&app.mainScene.refreshTopUI(),eventMgr.emit(eventStr.commonEvent.RefershActivityZhdCoinUi)})},function(){app.showNotice("\u8d2d\u4e70\u5931\u8d25")})}});a.refreshRed=function(e){return e&&(e.active=!1),!1},cc._RF.pop()},{basePage:void 0}],activityZhdPageQxsy:[function(e,t){"use strict";cc._RF.push(t,"35009dhsdZJiq9C0ElymfXN","activityZhdPageQxsy");var a=cc.Class({extends:e("basePage"),properties:{p_btnLight:cc.Button,p_labCost:cc.Label,p_sprCost:cc.Sprite,p_btnHelp:cc.Button,p_labTime:cc.Label,p_arrNode:[cc.Node],p_arrLine:[cc.Node]},statics:{prefabPath:"activityzhdpageqxsy",pageParent:"activityzhdpage"},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.schedule(this.refreshTime,1),this.handleUI()},handleUI:function(){var e=this;this._super(),this.p_btnLight.node.on("click",function(){e.m_boolPlayAni||e.onClickReward()}),this.p_arrNode.forEach(function(t,a){t.on("touchend",function(){e.m_boolPlayAni||(e.m_arrData[a].finishState=app.player.getCount(90580)>a,app.pages.windowspagetipsqxsy.showPage(e.m_arrData[a]))}),t.getChildByName("sp").getComponent(sp.Skeleton).setCompleteListener(function(t){"2"==t.animation.name&&e.showReward()})}),this.p_btnHelp.node.on("click",function(){app.playSound("click"),app.pages.windowspagetipshelp.showPage(1100)})},setParam:function(){var e=this;if(app.cacheActivityQxsy)return this.m_arrData=app.cacheActivityQxsy,void this.refreshUI();app.player.sfQxsyInfo(function(t,a){t?app.showNotice(t):cc.isValid(e.node)&&e.doData(a)})},doData:function(e){if(e&&e.params.reward){for(var t,a=JSON.parse(e.expand),i=[],n=1;n<=7;++n)(t=e.params.reward["proitem"+n]).str="proitem"+n,a&&a.TITLE&&a.TITLE[t.str]&&(t.TITLE=a.TITLE[t.str]),i.push(t);app.cacheActivityQxsy=i,this.m_arrData=i,this.refreshUI()}},refreshUI:function(e){var t=app.player.getCount(90580);this.p_btnLight.node.active=t<7;var a=app.db.getPropsIconPath(30084);if(app.loadTexture(a,this.p_sprCost,this.prefabPath),t<7){for(var i=this.m_arrData[t].consume,n=!0,r=0;r<i.length;++r)if(app.player.getCount(i[r].GSID)<i[r].COUNT){n=!1;break}this.p_btnLight.node.getChildByName("rednotice").active=n,this.p_labCost.string=i[0].COUNT}this.p_arrLine.forEach(function(e,a){e.active=t>a+1}),this.p_arrNode.forEach(function(a,i){var n=null;t==i?n="1":t>i&&(n="0"),n&&!e&&a.getChildByName("sp").getComponent(sp.Skeleton).setAnimation(0,n,!0),a.getChildByName("icon").active=t>i})},refreshTime:function(){var e=gUtils.getActivityArrTime("QXSY");this.p_labTime.string=gUtils.getCountDownStr((e[1]||0)-app.player.getServerTime())},onClickReward:function(){var e=this;if(this.m_arrData){var t=app.player.getCount(90580);if(t>=7)app.showNotice("\u5956\u52b1\u5df2\u9886\u53d6\u5b8c");else{for(var a=this.m_arrData[t],i=a.consume,n=0;n<i.length;++n)if(app.player.getCount(i[n].GSID)<i[n].COUNT)return app.showNotice(app.db.getPropsName(i[n].GSID)+"\u4e0d\u8db3"),void app.pages.windowspagesource.showPage(i[n].GSID);app.player.sfQxsyReward(a.str,function(a,i){cc.log(a,i),a?app.showNotice(a):(app.playSound("qxsy"),e.m_arrReward=i.items,e.p_arrNode[t]&&(e.p_arrNode[t].getChildByName("sp").getComponent(sp.Skeleton).setAnimation(0,"2",!1),e.p_arrNode[t].getChildByName("sp").getComponent(sp.Skeleton).addAnimation(0,"0",!0)),e.p_arrNode[t+1]&&e.p_arrNode[t+1].getChildByName("sp").getComponent(sp.Skeleton).setAnimation(0,"1",!0),e.m_boolPlayAni=!0,app.player.sfPlayerByParam(["others","hide","props"],function(){app.mainScene&&app.mainScene.refreshTopUI(),eventMgr.emit(eventStr.commonEvent.RefershActivityZhdCoinUi),e.refreshUI(!0)}))})}}},showReward:function(){var e={showtype:1,reward:this.m_arrReward||[]};app.pages.windowspagereward.showPage(e),this.m_boolPlayAni=!1}});a.refreshRed=function(e){var t=!1,a=app.player.getCount(90580);if(app.cacheActivityQxsy){if(app.cacheActivityQxsy&&app.cacheActivityQxsy[a]){var i=app.cacheActivityQxsy[a].consume;t=app.player.getCount(i[0].GSID)>=i[0].COUNT}}else t=a<7;return e&&(e.active=t),t},cc._RF.pop()},{basePage:void 0}],activityZhdPageSbjlInfo:[function(e,t){"use strict";cc._RF.push(t,"06676bNWedFUpBcFmY2vTKG","activityZhdPageSbjlInfo");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activityzhdpagesbjlinfo",pageType:1},properties:{p_arrRewardItem:[cc.Node],p_arrNeedItem:[cc.Node],p_nodeCost:cc.Node,p_sprCostIcon:cc.Sprite,p_labCostNum:cc.Label,p_btnEx:cc.Button},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){var e=this;this._super(),this.p_arrNeedItem.forEach(function(t,a){t.on("touchend",function(){e.onClickCond(a)})}),this.p_btnEx.node.on("click",function(){app.playSound("click"),e.onClickEx()})},setParam:function(e){this.m_numIndex=e.index,this.m_objExData=e.data,this.m_arrRewardData=e.data.items,this.m_arrConsData=e.data.cons,this.m_arrCostData=e.data.cost,this.m_target=e.target,this.m_arrCondGData=this.setCondGData(e.data.cons),this.refreshUI()},refreshUI:function(){var e=this;this.p_arrRewardItem.forEach(function(t,a){var i=e.m_arrRewardData[a];i?(t.getComponent("propItem").initForBag(i),t.getComponent("propItem").setClick(!0),t.active=!0):t.active=!1});var t=this.m_arrCostData[0];if(t){var a=gUtils.showCoinNum(app.player.getCount(t.GSID)),i=t.COUNT+"/"+a;this.p_labCostNum.string=i;var n=app.db.getPropsIconPath(t.GSID);app.loadTexture(n,this.p_sprCostIcon,this.prefabPath),this.p_nodeCost.active=!0}else this.p_nodeCost.active=!1;this.refreshComp()},refreshComp:function(){var e=this;this.p_arrNeedItem.forEach(function(t,a){e.m_arrCondGData[a]?(t.getComponent("generalPortraitItem").initForAwake(a,e.m_arrCondGData),t.active=!0):t.active=!1})},onClickCond:function(e){var t={};t.index=e,t.arrcond=this.m_arrCondGData,t.cb=this.refreshComp,t.target=this,t.noplus=!0,app.pages.windowspagelistgeneral.showPage(t)},onClickEx:function(){var t=this,a=[],i=[];if(e("generalPageCompound").checkComp(this.m_arrCondGData)){var n=this.m_arrCostData[0];if(!n||app.player.checkCount(n.GSID,n.COUNT)){for(var r=0;r<this.m_arrCondGData.length;++r)if(this.m_arrCondGData[r]){a.push(this.m_arrCondGData[r].picked);for(var o=0;o<this.m_arrCondGData[r].picked.length;++o)i.push(this.m_arrCondGData[r].picked[o])}cc.log("now zhd sbjl ex data",this.m_numIndex,a,i),app.player.exSbjl(this.m_numIndex,a,function(e,a){if(e)app.showNotice(e);else{t.onClose(),app.player.reduceGeneral(i),--t.m_objExData.buytime,t.m_target.refreshUI(t.m_numIndex,t.m_objExData);var n={showtype:1,reward:a.reward};app.pages.windowspagereward.showPage(n)}})}}else app.showNotice(langMgr.getString("activityZhdPageSbjlInfo",0))},setCondGData:function(e){for(var t=[],a=0;a<e.length;++a){var i={};i.cond=e[a].COND,i.need=e[a].COUNT,i.picked=[],t.push(i)}return cc.log("now condGData is",t),t}});cc._RF.pop()},{basePage:void 0,generalPageCompound:"generalPageCompound"}],activityZhdPageSbjl:[function(e,t){"use strict";cc._RF.push(t,"02160CT9iZHhrCP60cQB0Te","activityZhdPageSbjl");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activityzhdpagesbjl",pageParent:"activityzhdpage"},properties:{p_labTime:cc.Label,p_nodeGeneral:cc.Node,p_menuItems:[cc.Node],p_menuLight:cc.Node,p_nodeBg:cc.Node,p_btnHelp:cc.Button,p_btnEx:cc.Button,p_labBuyTime:cc.Label,p_nodeCost:cc.Node,p_pfbGeneral:cc.Prefab,p_layoutGeneral:cc.Node,p_pfbPropItem:cc.Prefab,p_layoutPropItem:cc.Node},onLoad:function(){a.instance=this,this.schedule(this.refreshTime,1),this.stopBgNodeEvent(),this.handleUI(),this.selectGeneralIndex=0,this.p_nodeGeneral.getComponent("activityZhdSbjlItem").setTarget(this)},handleUI:function(){var e=this;this._super(),this.p_btnEx.node.on("click",function(){app.playSound("click"),e.onClickEx()}),this.p_btnHelp.node.on("click",function(){app.pages.windowspagetipshelp.showPage("1054")});for(var t=function(t){e.p_menuItems[t].on("click",function(){e.selectGeneralIndex=t,e.refreshUI()})},a=0;a<this.p_menuItems.length;a++)t(a)},setParam:function(){var e=this;gUtils.activityIsOpen("SBJL",!0)&&app.player.getSbjl(function(t,a){if(t)app.showNotice(t);else{if(!cc.isValid(e.node))return;e.m_arrData=a,e.refreshUI()}})},onClickCond:function(e){var t={};t.index=e,t.arrcond=this.m_arrCondGData,t.cb=this.refreshComp,t.target=this,t.noplus=!0,t.main="5f5f5f5f5f550000",app.pages.windowspagelistgeneral.showPage(t)},refreshUI:function(){this.refreshGeneralList(this.selectGeneralIndex),this.refreshTime()},refreshReward:function(e){this.m_arrPropItems||(this.m_arrPropItems=[]);for(var t=0;t<e.length;t++){var a=this.m_arrPropItems[t];a||((a=cc.instantiate(this.p_pfbPropItem)).parent=this.p_layoutPropItem,this.m_arrPropItems.push(a)),a.active=!0,a.scale=.9,a.getComponent("propItem").initForBag(e[t]),a.getComponent("propItem").setClick(!0)}for(i=e.length;i<this.m_arrPropItems.length;i++)this.m_arrPropItems.active=!1},refreshBuyTime:function(){this.p_labBuyTime.string=this.m_arrData[this.m_numIndex].buytime,this.p_btnEx.interactable=this.m_arrData[this.m_numIndex].buytime>0},refreshGeneralList:function(e){var t=this,a=this.m_arrData;a[e]||(e=0),this.p_nodeGeneral.getComponent("activityZhdSbjlItem").refreshUI(e,a[e]),this.m_numIndex=e,this.refreshReward(a[e].items),this.m_arrCondGData=this.setCondGData(a[e].cons),this.m_arrCostData=a[e].cost,this.refreshBuyTime(),this.refreshComp(),this.p_menuItems.forEach(function(i,n){var r=n==e,o=a[n].buytime>0;i.getChildByName("icon_chossen").active=!o,i.getChildByName("icon_bg").opacity=r?255:130,r&&(o?(t.p_menuLight.active=!0,t.scheduleOnce(function(){t.p_menuLight.position=t.node.convertToNodeSpaceAR(i.parent.convertToWorldSpaceAR(i.position))},0)):t.p_menuLight.active=!1)})},refreshRedNotice:function(e){for(var t=!0,a=0;a<e.length;++a)e[a]&&(this.judgeConditions(a,e)||(t=!1));return t},refreshComp:function(){var e=this;this.m_arrGeneral||(this.m_arrGeneral=[]);for(var t=function(t){var a=e.m_arrGeneral[t];a||((a=cc.instantiate(e.p_pfbGeneral)).parent=e.p_layoutGeneral,a.on("touchend",function(){e.onClickCond(t)}),e.m_arrGeneral.push(a)),a.active=!0,a.scale=.9,a.getComponent("generalPortraitItem").initForAwake(t,e.m_arrCondGData)},a=0;a<this.m_arrCondGData.length;a++)t(a);for(i=this.m_arrCondGData.length;i<this.m_arrGeneral.length;i++)this.m_arrGeneral[i].active=!1;this.refreshYb()},refreshYb:function(){this.p_nodeCost.active=!!this.m_arrCostData[0],this.p_nodeCost.active&&(this.p_nodeCost.getComponent("propItem").initForBag(this.m_arrCostData[0]),this.p_nodeCost.getComponent("propItem").setClick(!0))},setCondGData:function(e){for(var t=[],a=0;a<e.length;++a){var i={};i.cond=e[a].COND,i.need=e[a].COUNT,i.picked=[],t.push(i)}return cc.log("now condGData is",t),t},judgeConditions:function(e,t){for(var a=t[e],i=a.cond,n={},r=[],o=0;o<t.length;++o)for(var s=t[o].picked,p=0;p<s.length;++p)r.push(s[p]);if("Array"!=gUtils.getType(i)&&(this.p_labName.string=app.db.getGNameByGsid(i),n={GSID:i,COUNT:a.need,HAVE:0}),"Array"==gUtils.getType(i)){for(var c={},h=0;h<i.length;++h)c=app.db.checkGeneralCond(0,i[h],c);c.HEADICON=gConfig.defaultSet.gHeadIcon,(n=c).COUNT=a.need,n.HAVE=0}for(var l in app.player.general){var g=app.player.general[l];r.indexOf(l)>=0||app.player.checkIsInLimitTeam(l)||n.GSID&&n.GSID!=g.gsid||n.STAR&&n.STAR!=g.star||n.OCCU&&n.OCCU!=g.occu||n.CAMP&&n.CAMP!=g.camp||(n.HAVE+=1)}return n.HAVE>=n.COUNT&&!(a.picked.length>=a.need)},onClickEx:function(){var t=this,a=[],i=[];if(e("generalPageCompound").checkComp(this.m_arrCondGData)){var n=this.m_arrCostData[0];if(!n||app.player.checkCount(n.GSID,n.COUNT)){for(var r=0;r<this.m_arrCondGData.length;++r)if(this.m_arrCondGData[r]){a.push(this.m_arrCondGData[r].picked);for(var o=0;o<this.m_arrCondGData[r].picked.length;++o)i.push(this.m_arrCondGData[r].picked[o])}cc.log("now zhd sbjl ex data",this.m_numIndex,a,i),app.player.exSbjl(this.m_numIndex,a,function(e,a){if(e)app.showNotice(e);else{for(var n=[],r=0;r<i.length;r++)n.push({guid:i[r]});app.player.reduceGeneral(n),eventMgr.emit(eventStr.commonEvent.RefershActivityZhdCoinUi),app.getRedInfoByObj(["act","sbjl"],0)>=1&&(app.redDataServer.act.sbjl-=1),t.m_arrData[t.m_numIndex].buytime-=1,t.refreshUI();var o=function(){for(var e=[],t=0;t<a.items.length;t++){for(var i=!1,n=0;n<e.length;n++)a.items[t].GSID==e[n].GSID&&(e[n].COUNT+=a.items[t].COUNT,i=!0);i||e.push(a.items[t])}var r={showtype:1,reward:e,confirmcb:null};app.pages.windowspagereward.showPage(r)},s={showtype:1,reward:a.reward,confirmcb:function(){a.items&&a.items.length>0&&t.schedule(o,.1,1)},target:t};app.pages.windowspagereward.showPage(s)}})}}else app.showNotice(langMgr.getString("activityZhdPageSbjl",0))},refreshTime:function(){var e=app.player.getServerTime(),t=gUtils.getActivityArrTime("SBJL")[1]||0,a=t-e;(!t||a<0)&&(a=0),this.p_labTime.string=0!=a?gUtils.getCountDownStr(a):"00:00:00"}});a.refreshRed=function(e){var t=!1,a=app.getRedInfoByObj(["act","sbjl"],null);return null!=a&&(t=a>0),e&&(e.active=t),t},cc._RF.pop()},{basePage:void 0,generalPageCompound:"generalPageCompound"}],activityZhdPageSmbx:[function(e,t){"use strict";cc._RF.push(t,"72063L8V9JBFa2oJMUvzAF7","activityZhdPageSmbx");var a="ACTIVITY_ZHD_SMBX",i=cc.Class({extends:e("basePage"),statics:{prefabPath:"activityzhdpagesmbx",pageParent:"activityzhdpage"},properties:{p_scrView:cc.ScrollView,p_nodeItem:cc.Node,p_sprBanner:cc.Sprite,p_btnHelp:cc.Button,p_labTime:cc.Label},onLoad:function(){i.instance=this,this.schedule(this.refreshTime,1),this.stopBgNodeEvent(),this.p_btnHelp.node.on("click",function(){app.pages.windowspagetipshelp.showPage(1071)}),localDataUtils.GetValue(a,null)||(localDataUtils.SetValue(a,1,gUtils.getSecondDayTime(app.player.getServerTime())),eventMgr.emit(eventStr.redEvent.RefreshActivityRed))},setParam:function(){var e=this;app.arrZhdData.SMBX?this.refreshUI():app.player.sfGetSmbx(function(t,a){if(t)app.showNotice(t);else{if(!cc.isValid(e.node))return;app.arrZhdData.SMBX=a,e.refreshUI()}})},refreshUI:function(){app.arrZhdData.SMBX&&(this.refreshSView(app.arrZhdData.SMBX),this.refreshTime())},refreshTime:function(){var e=app.player.getServerTime(),t=gUtils.getActivityArrTime("SMBX")[1]||0,a=t-e;(!t||a<0)&&(a=0),this.p_labTime.string=0!=a?gUtils.getCountDownStr(a):"00:00:00"},refreshSView:function(e){this.m_arrItems||(this.m_arrItems=[],this.m_arrItems.push(this.p_nodeItem));for(var t=0;t<e.length;++t){var a=this.m_arrItems[t];a||((a=cc.instantiate(this.p_nodeItem)).parent=this.p_scrView.content,this.m_arrItems.push(a)),a.active=!0}for(var i=0;i<e.length;++i)this.m_arrItems[i].getComponent("activityZhdSmbxItem").refreshUI(e[i],i,this);for(var n=e.length;n<this.m_arrItems.length;++n)this.m_arrItems[n].active=!1}});i.refreshRed=function(e){var t;return t=!localDataUtils.GetValue(a,null),e&&(e.active=t),t},cc._RF.pop()},{basePage:void 0}],activityZhdPageSzhc:[function(e,t){"use strict";cc._RF.push(t,"9948fJ74sVACJuowKqrtbhr","activityZhdPageSzhc");var a="ACTIVITY_ZHD_SZHC",i=cc.Class({extends:e("basePage"),statics:{prefabPath:"activityzhdpageszhc",pageParent:"activityzhdpage"},properties:{p_scrView:cc.ScrollView,p_nodeItem:cc.Node,p_sprBanner:cc.Sprite,p_btnHelp:cc.Button,p_labTime:cc.Label},onLoad:function(){i.instance=this,localDataUtils.GetValue(a,null)||(localDataUtils.SetValue(a,1,gUtils.getSecondDayTime(app.player.getServerTime())),eventMgr.emit(eventStr.redEvent.RefreshActivityRed)),this.schedule(this.refreshTime,1),this.p_btnHelp.node.on("click",function(){app.playSound("click"),app.pages.windowspagetipshelp.showPage("1050")},this)},setParam:function(){var e=this;app.arrZhdData.SZHC?this.refreshUI():app.player.sfGetSzhc(function(t,a){if(t)app.showNotice(t);else{if(!cc.isValid(e.node))return;app.arrZhdData.SZHC=a,e.refreshUI()}})},refreshUI:function(){if(app.arrZhdData.SZHC){for(var e=[],t=[],a=0;a<app.arrZhdData.SZHC.length;++a){var i=app.arrZhdData.SZHC[a];i.index=a,i.buytime>0?e.push(i):t.push(i)}e=e.concat(t),this.refreshSView(e),this.refreshTime()}},refreshTime:function(){var e=app.player.getServerTime(),t=gUtils.getActivityArrTime("SZHC")[1]||0,a=t-e;(!t||a<0)&&(a=0),this.p_labTime.string=0!=a?gUtils.getCountDownStr(a):"00:00:00"},refreshSView:function(e){this.m_arrItems||(this.m_arrItems=[],this.m_arrItems.push(this.p_nodeItem));for(var t=0;t<e.length;++t){var a=this.m_arrItems[t];a||((a=cc.instantiate(this.p_nodeItem)).parent=this.p_scrView.content,this.m_arrItems.push(a)),a.active=!0}for(var i=0;i<e.length;++i){var n={data:e[i],traget:this,confunc:this.refreshUI};this.m_arrItems[i].getComponent("activityZhdSzhcItem").setPaerm(n)}for(var r=e.length;r<this.m_arrItems.length;++r)this.m_arrItems[r].active=!1},refreshItem:function(e){null!=e&&this.m_arrItems&&this.m_arrItems[e+1]&&this.m_arrItems[e+1].getComponent("activityZhdSzhcItem").refreshUI()}});i.isOpen=function(){return!!gUtils.activityIsOpen("SZHC")&&!!app.db.checkFuncUnLock("ACTIVITY_ZHD")},i.refreshRed=function(e){var t;return t=!localDataUtils.GetValue(a,null),cc.isValid(e)&&cc.Node.isNode(e)&&(e.active=t),t},cc._RF.pop()},{basePage:void 0}],activityZhdPageThlb:[function(e,t){"use strict";cc._RF.push(t,"334d9/cqw5JurHm7UxCx6h6","activityZhdPageThlb"),cc.Class({extends:e("activityJchdPageItem"),properties:{p_scrView:cc.ScrollView,p_nodeItem:cc.Node,p_sprBanner:cc.Sprite,p_btnHelp:cc.Button,p_labTime:cc.Label},onLoad:function(){this.schedule(this.refreshTime,1),this.p_btnHelp.node.on("click",function(){app.pages.windowspagetipshelp.showPage("\u7279\u60e0\u793c\u5305",app.mainScene.p_nodeBg)})},getNewData:function(e){var t=this;this.m_target=e.target,app.player.sfGetThlbInfo(function(e,a){e?app.showNotice(e):(t.m_arrData=a,t.refreshUI())})},refreshUI:function(){for(var e=[],t=[],a=0;a<this.m_arrData.length;++a){var i=this.m_arrData[a];i.buytime>0?e.push(i):t.push(i)}this.m_arrData=e.concat(t),this.refreshSView(this.m_arrData),this.refreshTime()},refreshSView:function(e){this.m_arrItems||(this.m_arrItems=[],this.m_arrItems.push(this.p_nodeItem));for(var t=0;t<e.length;++t){var a=this.m_arrItems[t];a||((a=cc.instantiate(this.p_nodeItem)).parent=this.p_scrView.content,this.m_arrItems.push(a)),a.active=!0,a.getComponent("activityZhdThlbItem").refreshUI(e[t],this.m_target)}for(var i=e.length;i<this.m_arrItems.length;++i)this.m_arrItems[i].active=!1},refreshTime:function(){var e=app.player.getServerTime(),t=gUtils.getActivityArrTime("THLB")[1]||0,a=t-e;(!t||a<0)&&(a=0),this.p_labTime.string=0!=a?gUtils.getCountDownStr(a):"00:00:00"}}),cc._RF.pop()},{activityJchdPageItem:"activityJchdPageItem"}],activityZhdPageTnqw:[function(e,t){"use strict";cc._RF.push(t,"faf33LtMGpLmIx5CIM7rOLQ","activityZhdPageTnqw");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activityzhdpagetnqw",pageParent:"activityzhdpage"},properties:{p_btnHelp:cc.Button,p_labTime:cc.Label,p_arrBoss:[cc.Node]},onLoad:function(){a.instance=this,app.OBJACTIVITYFIRSTOPENCACHE.ZhdPageTnqwBfo=!1,eventMgr.emit(eventStr.redEvent.RefreshActivityRed),this.schedule(this.refreshTime,1),this.handleUI()},handleUI:function(){var e=this;this.p_arrBoss.forEach(function(t,a){t.on("touchend",function(){e.onClickBoss(a)})}),this.p_btnHelp.node.on("click",function(){app.playSound("click"),app.pages.windowspagetipshelp.showPage("1069")})},setParam:function(){var e=this;app.ldjltx="tnqw",a.isOpen(!0)&&app.player.sfGetTnqwInfo(function(t,a){t||cc.isValid(e.node)&&(e.m_bossData=a.bosslist,console.log(a),e.refreshUI())})},refreshUI:function(){this.m_bossData&&(this.refreshTime(),this.refreshArrBoss())},refreshArrBoss:function(){var e=this;this.p_arrBoss.forEach(function(t,a){var i=e.m_bossData[a],n=t.getChildByName("spr_shackles"),r=t.getChildByName("shengshotex");n&&(n.active=2!=i.status),r&&(r.active=2==i.status);var o=t.getChildByName("spr_bg_01"),s=t.getChildByName("spr_icon"),p=t.getChildByName("spr_lock"),c=t.getChildByName("progHp"),h=t.getChildByName("bar"),l=t.getChildByName("spr_bg_02"),g=t.getChildByName("lab_num_ys"),d=t.getChildByName("spr_jisha");switch(i.status){case 0:app.setSpriteState(o.getComponent(cc.Sprite),!0),app.setSpriteState(s.getComponent(cc.Sprite),!0),c.active=!1,h.active=!1,p.active=!0,g&&(g.getComponent(cc.Label).string=langMgr.getString("activityZhdPageTnqw",0,i.actscore)),d.active=!1;break;case 1:app.setSpriteState(o.getComponent(cc.Sprite),!1),app.setSpriteState(s.getComponent(cc.Sprite),!1),c.active=!0,h.active=!0;var u=i.nowhp&&i.maxhp?i.nowhp/i.maxhp:1;c.getComponent(cc.ProgressBar).progress=u,p.active=!1,l&&(l.active=!0),g&&(g.active=!0),g&&(g.getComponent(cc.Label).string=langMgr.getString("activityZhdPageTnqw",1)),d.active=!1;break;case 2:app.setSpriteState(o.getComponent(cc.Sprite),!1),app.setSpriteState(s.getComponent(cc.Sprite),!0),c.active=!0,h.active=!0,c.getComponent(cc.ProgressBar).progress=0,p.active=!1,l&&(l.active=!1),g&&(g.active=!1),d.active=!0}})},refreshTime:function(){var e=app.player.getServerTime(),t=gUtils.getActivityArrTime("TNQW")[1]||0,a=t-e;(!t||a<0)&&(a=0),this.p_labTime.string=0!=a?gUtils.getCountDownStr(a):"00:00:00"},onClickBoss:function(e){var t=this;if(a.isOpen(!0)&&this.m_bossData&&this.m_bossData[e])switch(this.m_bossData[e].status){case 0:app.pages.windowspagetipsrewards.showPage(this.m_bossData[e].rewardgsids);break;case 1:app.player.sfGetTnqwBossInfo(e,function(a,i){if(a)"fn freeze"==a&&app.showNotice(langMgr.getString("activityZhdPageTnqw",4));else{i.rewards=i.killrewards;var n={boss:i,index:e,type:4,target:t,confirmcb:t.getNewData};app.pages.bigbattlebossinfopage.showPage(n)}});break;case 2:app.showNotice(langMgr.getString("activityZhdPageTnqw",5))}}});a.refreshRed=function(e){var t=!1;if(0!=app.OBJACTIVITYFIRSTOPENCACHE.ZhdPageTnqwBfo){var a=app.getRedInfoByObj(["act","tnqw"],null);null!=a&&(t=a>0)}return e&&(e.active=t),t},a.isOpen=function(e){var t=gUtils.getActivityArrTime("TNQW");return!(app.player.getServerTime()>t[1]&&(e&&app.showNotice(langMgr.getString("activityZhdPageTnqw",4)),1))},cc._RF.pop()},{basePage:void 0}],activityZhdPageWjcs:[function(e,t){"use strict";cc._RF.push(t,"ee6240j9eVFTKMGUlKUJjKr","activityZhdPageWjcs"),cc.Class({extends:e("activityJchdPageItem"),properties:{p_nodeName:cc.Node,p_sprCamp:cc.Sprite,p_sprName:cc.Sprite,p_stars:[cc.Sprite],p_nodePlus:cc.Node,p_nodeGeneral:cc.Node,p_sprGeneral:cc.Sprite,p_spGeneral:sp.Skeleton,p_animGeneral:cc.Animation,p_labIntro:cc.Label,p_btnRelive:cc.Button,p_btnHelp:cc.Button,p_labTime:cc.Label},onLoad:function(){var e=this;this.schedule(this.refreshTime,1),this.p_btnHelp.node.on("click",function(){app.playSound("click"),app.pages.windowspagetipshelp.showPage("\u6b66\u5c06\u91cd\u751f",app.mainScene.p_nodeBg)}),this.p_nodePlus.on("touchend",function(){app.playSound("click"),e.onClickPlus()}),this.p_nodeGeneral.on("touchend",function(){app.playSound("click"),e.onClickPlus()}),this.p_btnRelive.node.on("click",function(){app.playSound("click"),e.onClickRelive()})},getNewData:function(e){var t=this;this.m_target=e.target,app.arrZhdData.WJCS?this.refreshUI():app.player.sfGetWjcs(function(e,a){e?app.showNotice(e):(app.arrZhdData.WJCS=a,t.refreshUI())})},refreshUI:function(){if(app.arrZhdData.WJCS){this.m_arrCondGData=this.setCondGData(app.arrZhdData.WJCS,1),this.p_nodePlus.active=!0,this.p_nodeGeneral.active=!1,this.p_nodeName.active=!1;for(var e=this.setName(app.arrZhdData.WJCS),t=langMgr.getString("activityZhdPageWjcs",4),a="\u3001",i=0;i<e.length;++i)i==e.length-1&&(a=""),t+=e[i]+a;this.p_labIntro.string=t,this.refreshTime()}},refreshGeneral:function(){var e=this;if(this.m_arrCondGData&&this.m_arrCondGData[0]&&this.m_arrCondGData[0].picked&&this.m_arrCondGData[0].picked[0]){var t=this.m_arrCondGData[0].picked[0],a=app.player.general[t],i=app.db.getGBaseByGsid(a.gsid),n=app.db.getGNamePathHByGsid(a.gsid);app.loadTexture(n,this.p_sprName,app.getPrefabPathFrom(this.m_target));var r=gConfig.getIconGCampPath(i.CAMP-1);app.loadTexture(r,this.p_sprCamp,app.getPrefabPathFrom(this.m_target));var o=i.STAR,s=(o-1)%5;10==o&&(s=o%5);var p=gConfig.getIconGBigStarPath(i.STAR);this.p_stars.forEach(function(t,a){t.node.active=s>=a,app.loadTexture(p,t,app.getPrefabPathFrom(e.m_target))}),this.m_numPickIndex=this.getIndex(a.gsid),this.m_strPickGuid=t,app.loadGeneral(a.gsid,this.p_sprGeneral,this.p_spGeneral,this.p_animGeneral,null,app.getPrefabPathFrom(this.m_target)),this.p_nodeGeneral.active=!0,this.p_nodeName.active=!0,this.p_nodePlus.active=!1}else this.p_nodeGeneral.active=!1,this.p_nodeName.active=!1,this.p_nodePlus.active=!0},onClickPlus:function(){if(this.m_arrCondGData){var e={index:0};e.arrcond=this.m_arrCondGData,e.notips=!0,e.noplus=!0,e.cb=this.refreshGeneral,e.target=this,e.noplus=!0,app.pages.windowspagelistgeneral.showPage(e)}else app.showNotice(langMgr.getString("activityZhdPageWjcs",0))},onClickRelive:function(){var e=this;this.p_nodeGeneral.active?app.player.sfReviewWjcs(this.m_numPickIndex,this.m_strPickGuid,function(t,a){if(t)app.showNotice(t);else{var i={title:langMgr.getString("activityZhdPageWjcs",3),content:langMgr.getString("activityZhdPageWjcs",2),props:e.setReviewData(a),confirmname:langMgr.getString("activityZhdPageWjcs",1),confirmcb:e.confirmRelive,target:e};app.pages.windowspagepreview.showPage(i)}}):app.showNotice(langMgr.getString("activityZhdPageWjcs",1))},confirmRelive:function(){var e=this;if(app.player.gnum+this.m_numGetGeneral>app.player.bagspace){var t={content:langMgr.getString("activityZhdPageWjcs",0),confirmcb:function(){app.goToPage("generalrelivepage")},target:this};app.pages.windowspagetipsmsg.showPage(t)}else app.player.sfConfirmWjcs(this.m_numPickIndex,this.m_strPickGuid,function(t,a){t?app.showNotice(t):app.player.sfPlayerData(function(){var t={showtype:1,reward:e.setConfirmData(a.items)};app.pages.windowspagereward.showPage(t),--app.arrZhdData.WJCS[e.m_numPickIndex].relivetimes,e.refreshUI()})})},refreshTime:function(){var e=app.player.getServerTime(),t=gUtils.getActivityArrTime("WJCS")[1]||0,a=t-e;(!t||a<0)&&(a=0),this.p_labTime.string=0!=a?gUtils.getCountDownStr(a):"00:00:00"},setCondGData:function(e,t){var a=[],i={},n=[];i.cond=[],i.need=t,i.picked=[];for(var r=0;r<e.length;++r)e[r].relivetimes<=0||n.push(e[r].gsid);return i.cond.push(n),a.push(i),cc.log("now condGData is",a),a},setName:function(e){for(var t=[],a=0;a<e.length;++a){var i=app.db.getGNameByGsid(e[a].gsid);t.indexOf(i)<0&&t.push(i)}return t},getIndex:function(e){for(var t=0,a=0;a<app.arrZhdData.WJCS.length;++a)if(app.arrZhdData.WJCS[a].gsid==e){t=a;break}return t},setReviewData:function(e){var t=[],a=0;if(e.items)for(var i=0;i<e.items.length;++i)t.push(e.items[i]);if(e.general)for(var n=0;n<e.general.length;++n){var r={};for(var o in e.general[n])r[o.toUpperCase()]=e.general[n][o];a+=r.COUNT,t.push(r)}return this.m_numGetGeneral=a,t},setConfirmData:function(e){for(var t=[],a={},i=[],n=0;n<e.length;++n){var r=e[n].gsid||e[n].GSID;"general"==app.db.getTypeByGsid(r)?(a[r]||(a[r]=0),++a[r]):t.push(e[n])}for(var o in a)i.push({gsid:o,count:a[o]});i.sort(function(e,t){var a=e.gsid||e.GSID,i=t.gsid||t.GSID,n=app.db.getGBaseByGsid(a),r=app.db.getGBaseByGsid(i);return n.STAR<r.STAR?1:n.STAR==r.STAR&&a>i?1:-1});for(var s=0;s<i.length;++s)t.push(i[s]);return cc.log(t),t}}),cc._RF.pop()},{activityJchdPageItem:"activityJchdPageItem"}],activityZhdPageWjzh:[function(e,t){"use strict";cc._RF.push(t,"146dfRnDk9J4IWcyCf0qz2o","activityZhdPageWjzh"),cc.Class({extends:e("activityJchdPageItem"),properties:{p_scrView:cc.ScrollView,p_nodeItem:cc.Node,p_btnHelp:cc.Button,p_labTime:cc.Label},onLoad:function(){this.schedule(this.refreshTime,1),this.p_btnHelp.node.on("click",function(){app.pages.windowspagetipshelp.showPage("\u6b66\u5c06\u7ec4\u5408",app.mainScene.p_nodeBg)})},getNewData:function(e){var t=this;this.m_target=e.target,app.arrZhdData.WJZH?this.refreshUI():app.player.sfGetWjzh(function(e,a){e?app.showNotice(e):(app.arrZhdData.WJZH=a,t.refreshUI())})},refreshUI:function(){app.arrZhdData.WJZH&&(this.refreshSView(app.arrZhdData.WJZH),this.refreshTime())},refreshSView:function(e){this.m_arrItems||(this.m_arrItems=[],this.m_arrItems.push(this.p_nodeItem));for(var t=0;t<e.length;++t){var a=this.m_arrItems[t];a||((a=cc.instantiate(this.p_nodeItem)).parent=this.p_scrView.content,this.m_arrItems.push(a)),a.active=!0,a.getComponent("activityZhdWjzhItem").refreshUI(e[t],t,this.m_target)}for(var i=e.length;i<this.m_arrItems.length;++i)this.m_arrItems[i].active=!1},refreshTime:function(){var e=app.player.getServerTime(),t=gUtils.getActivityArrTime("WJZH")[1]||0,a=t-e;(!t||a<0)&&(a=0),this.p_labTime.string=0!=a?gUtils.getCountDownStr(a):"00:00:00"}}),cc._RF.pop()},{activityJchdPageItem:"activityJchdPageItem"}],activityZhdPageXsdh:[function(e,t){"use strict";cc._RF.push(t,"0c409UfMOxOJZ46T4InT0w5","activityZhdPageXsdh");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activityzhdpagexsdh",pageParent:"activityzhdpage"},properties:{p_sprCamp:cc.Sprite,p_sprOCCU:cc.Sprite,p_sprOccu2:cc.Sprite,p_sprName:cc.Sprite,p_starContainer:cc.Node,p_highStarIcon:cc.Sprite,p_sprStar:[cc.Sprite],p_sprGeneral:cc.Sprite,p_spGeneral:sp.Skeleton,p_animGeneral:cc.Animation,p_generalQuality:cc.Node,p_pfbQualityItem:cc.Prefab,_gQualityItem:null,p_nodeCampPick:cc.Node,p_btnExec:cc.Button,p_sprCost:cc.Sprite,p_labCost:cc.Label,p_labLastTimes:cc.Label,p_labTime:cc.Label},onLoad:function(){a.instance=this,0!=app.OBJACTIVITYFIRSTOPENCACHE.ZhdPageXsdhBfo&&(app.OBJACTIVITYFIRSTOPENCACHE.ZhdPageXsdhBfo=!1,eventMgr.emit(eventStr.redEvent.RefreshActivityRed)),this.m_menu=this.p_nodeCampPick.getComponent("menu"),this.m_menu.init(this),this.refreshTime(),this.schedule(this.refreshTime,1),this.stopBgNodeEvent(),this.fitTopMenu(),this.handleUI()},handleUI:function(){var e=this;this.p_btnExec.node.on("click",function(){app.playSound("click"),e.clickBtnExec(e.m_nowPickIndex)})},clickBtnExec:function(e){var t,a,i=this,n=null!=(t=null==(a=app.arrZhdTime.XSDH)?void 0:a.time[1])?t:0,r=app.arrZhdData.XSDH[e].buytime,o=app.arrZhdData.XSDH[e].consume[0].GSID,s=app.arrZhdData.XSDH[e].consume[0].COUNT,p=app.player.getCount(o);if(app.player.getServerTime()>n)app.showNotice(langMgr.getString("activityZhdPageXsdh",0));else if(r<=0)app.showNotice(langMgr.getString("activityZhdPageXsdh",3));else if(p<s)app.pages.windowspagesource.showPage(o);else{var c={content:langMgr.getString("activityZhdPageXsdh",1),confirmcb:function(){app.player.sfXsdhDh(e,function(t){if(t);else{app.arrZhdData.XSDH[e].buytime-=1,i.refreshLastTimes(app.arrZhdData.XSDH[e].buytime),app.player.reduceItem(app.arrZhdData.XSDH[e].consume),app.player.addItem(app.arrZhdData.XSDH[e].grch);var a={showtype:1,reward:app.arrZhdData.XSDH[e].grch,target:i};app.pages.windowspagereward.showPage(a),eventMgr.emit(eventStr.commonEvent.RefershActivityZhdCoinUi),app.getRedInfoByObj(["act","xsdh"],0)>=1&&(app.redDataServer.act.xsdh-=1),eventMgr.emit(eventStr.redEvent.RefreshActivityZhdRed),eventMgr.emit(eventStr.redEvent.RefreshActivityRed)}})},target:this};app.pages.windowspagetipsmsg.showPage(c)}},setParam:function(){var e=this;app.arrZhdData.XSDH?this.refreshUI():app.player.sfXsdhList(function(t,a){if(t)app.showNotice(t);else{if(!cc.isValid(e.node))return;app.arrZhdData.XSDH=a,e.refreshUI()}})},refreshTime:function(){var e=app.player.getServerTime(),t=gUtils.getActivityArrTime("XSDH")[1]||0,a=t-e;(!t||a<0)&&(a=0),this.p_labTime.string=0!=a?gUtils.getCountDownStr(a):"00:00:00"},refreshUI:function(){if(app.arrZhdData.XSDH){for(var e=0,t=0;t<app.arrZhdData.XSDH.length;t++){var a=app.arrZhdData.XSDH[t];e<=0&&a.buytime>0&&app.player.getCount(a.consume[0].GSID)>=a.consume[0].COUNT&&e++}e!=app.getRedInfoByObj(["act","xsdh"],0)&&(app.redDataServer.act.xsdh=e),eventMgr.emit(eventStr.redEvent.RefreshActivityZhdRed),eventMgr.emit(eventStr.redEvent.RefreshActivityRed),this.m_menu.setMenuIndex(0)}},menuHandler:function(e){var t=app.arrZhdData.XSDH[e];if(!t)return app.showNotice("\u672a\u914d\u7f6e\u5956\u52b1"),!1;this.m_nowPickIndex=e,this.refreshGeneral(t.grid),this.refreshCost(t.consume),this.refreshLastTimes(t.buytime)},refreshCost:function(e){(!e||e.length<=0)&&(e=[[]]);var t=app.db.getPropsIconPath(e[0].GSID);app.loadTexture(t,this.p_sprCost,this.prefabPath),this.p_labCost.string=e[0].COUNT},refreshLastTimes:function(e){this.p_labLastTimes.string=langMgr.getString("activityZhdPageXsdh",2,[e]),this.p_btnExec.interactable=e},refreshGeneral:function(e){var t=this,a=app.db.getGBaseByGsid(e);a||(a={GSID:0,NAME:"\u672a\u77e5\u6b66\u5c06",CAMP:1,STAR:1});var i=app.db.getGNamePathHByGsid(e);app.loadTexture(i,this.p_sprName,this.prefabPath);var n=gConfig.getIconGCampPath(a.CAMP-1);app.loadTexture(n,this.p_sprCamp,this.prefabPath);var r=gConfig.getIconGOccuPath(a.OCCU-1);app.loadTexture(r,this.p_sprOCCU,this.prefabPath),a.OCCU2&&(this.p_sprOccu2.node.active=!0,r=gConfig.getIconGOccuPath(a.OCCU2-1),app.loadTexture(r,this.p_sprOccu2,this.prefabPath));var o=a.STAR;if(this.p_starContainer.opacity=o<10?255:0,this.p_highStarIcon.node.active=o>=10?255:0,o>=10){var s=gConfig.getIconGStarPath(o-1);app.loadTexture(s,this.p_highStarIcon,this.prefabPath)}else{var p=(o-1)%5,c=gConfig.getIconGBigStarPath(a.STAR);this.p_sprStar.forEach(function(e,a){e.node.active=p>=a,app.loadTexture(c,e,t.prefabPath)})}app.loadGeneral(a.GSID,this.p_sprGeneral,this.p_spGeneral,this.p_animGeneral,null,this.prefabPath),this.p_generalQuality.opacity=Boolean(a.TGRADE)?255:0,a.TGRADE&&(cc.isValid(this._gQualityItem)||(this._gQualityItem=cc.instantiate(this.p_pfbQualityItem),this.p_generalQuality.addChild(this._gQualityItem),this._gQualityItem.setPosition(cc.Vec2.ZERO)),this._gQualityItem.getComponent("GeneralQualityItem").init(a.TGRADE))}});a.refreshRed=function(e){var t=!1,a=app.getRedInfoByObj(["act","xsdh"],null);return null!=a&&(t=a>0),0!=app.OBJACTIVITYFIRSTOPENCACHE.ZhdPageXsdhBfo&&(t=!0),e&&(e.active=t),t},cc._RF.pop()},{basePage:void 0}],activityZhdPageXygx:[function(e,t){"use strict";cc._RF.push(t,"e9fb3pF2GlDqrROjbkLEU4q","activityZhdPageXygx");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activityzhdpagexygx",pageParent:"activityzhdpage"},properties:{p_btnGoto:cc.Button,p_btnHelp:cc.Button,p_labTime:cc.Label,p_nodeContent:cc.Node,p_propItem:cc.Node,p_pfbItem:cc.Prefab},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.handleUI()},handleUI:function(){this._super(),this.p_btnHelp.node.on("click",function(){app.playSound("click"),app.pages.windowspagetipshelp.showPage("1019")}),this.p_btnGoto.node.on("click",function(){app.playSound("click"),app.goToPage(1003)})},onEnable:function(){this._super(),eventMgr.on(eventStr.commonEvent.RefreshTime,this.refreshTime,this),eventMgr.on(eventStr.zhdPage.XYGX_REFRESH_INFO,this.initData,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.commonEvent.RefreshTime,this.refreshTime,this),eventMgr.off(eventStr.zhdPage.XYGX_REFRESH_INFO,this.initData,this)},setParam:function(){if(!this.m_arrItems){this.m_arrItems=[];var e=cc.instantiate(this.p_pfbItem);e.scale=.9,e.parent=this.p_propItem.getChildByName("propItem"),this.m_arrItems.push(this.p_propItem)}app.arrZhdData.XYGX?(this.m_arrData=app.arrZhdData.XYGX,this.refreshUI()):app.player.sfXygxInfo(),this.refreshTime(),this.schedule(this.refreshTime,1)},initData:function(e){this.m_arrData=e,this.refreshUI()},refreshUI:function(){for(var e=this.m_arrData.FRONTEND.PREMIUM,t=0;t<e.length;++t){var a=this.m_arrItems[t];a||((a=cc.instantiate(this.p_propItem)).parent=this.p_nodeContent,this.m_arrItems.push(a)),a.active=!0,a.getChildByName("propItem").getChildByName("porp_item").getComponent("propItem").initForGsid(e[t].GSID),a.getChildByName("propItem").getChildByName("porp_item").getComponent("propItem").setClick(!0)}for(var i=e.length;i<this.m_arrItems.length;++i)this.m_arrItems[i].active=!1},refreshTime:function(){var e=gUtils.getActivityArrTime("XYGX");this.p_labTime.string=gUtils.getCountDownStr((e[1]||0)-app.player.getServerTime())}});a.refreshRed=function(){return!1},cc._RF.pop()},{basePage:void 0}],activityZhdPageXylp:[function(e,t){"use strict";cc._RF.push(t,"7b092Zv0ctMQY/XpfliDSqV","activityZhdPageXylp");var a=cc.Class({extends:e("basePage"),properties:{p_labTime:cc.Label,p_btnHelp:cc.Button,p_btnOne:cc.Button,p_btnTen:cc.Button,p_nodeSpin:cc.Node,p_lookstar_eff:cc.Animation,p_nodeHjmd:cc.Node,p_arrNodeReward:[cc.Node]},statics:{prefabPath:"activityzhdpagexylp",pageParent:"activityzhdpage"},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.p_btnHelp.node.on("click",function(){app.pages.windowspagetipshelp.showPage(1089)}),this.handleUI(),this.playAnimSpin()},handleUI:function(){var e=this;this._super(),this.p_btnOne.node.on("click",function(){e.onClickDarw(1)}),this.p_btnTen.node.on("click",function(){e.onClickDarw(10)})},onClickDarw:function(e){var t=this;gUtils.activityIsOpen("XYLP",!0)&&app.player.checkCount(this.m_costData[0].item.GSID,e*this.m_costData[0].item.COUNT)&&app.player.sfXylpRoll(e,function(a,i){if(a)return app.showNotice(a),t.isSpin=!1,void app.mainScene.p_nodeWait.hide();app.mainScene.p_nodeWait.show({isShow:!1});var n={reward:i.items,confirmcb:function(){t.isAgain=!1,t.isSpin=!1,t.playAnimSpin(),t.refreshUI()},againname:e,againcb:function(e){t.isAgain=!0,cc.log("again look star"),t.isSpin=!1,t.playAnimSpin(),t.onClickDarw(e)},againparm:[e],target:t};t.p_nodeSpin.stopAllActions();var r=t.p_nodeSpin.angle%360,o=45*-i.pos-r;t.isSpin=!0,app.loadEff("guanxing",t.p_lookstar_eff,2,2.1),cc.tween(t.p_nodeSpin).by(3,{angle:1800+o+10},{easing:"cubicInOut"}).by(1,{angle:-10},{easing:"cubicOut"}).call(function(){app.player.sfPlayerByParam(["others","safe","vip","hide","props","firstcharge"],function(){app.pages.windowspagereward.showPage(n,null,function(){eventMgr.emit(eventStr.commonEvent.RefershActivityZhdCoinUi),t.m_data.prize=i.prize,t.p_nodeHjmd.getComponent("hjmdList").refreshUI(t.m_data.prize),app.mainScene.p_nodeWait.hide()})}),t.p_lookstar_eff.node.active=!1}).start()})},extract:function(e){var t=this;app.player.sfHjytRoll(e,function(a,i){a||(t.playArrCheck(i.pos,function(){var a={showtype:0,reward:i.items,target:t,againname:e,againcb:t.extract,againparm:[e]};app.pages.windowspagereward.showPage(a)}),app.player.addItem(i.items),app.player.reduceItem([{gsid:t.m_costData[0].item.GSID,count:e*t.m_costData[0].item.COUNT}]))})},playAnimSpin:function(){cc.tween(this.p_nodeSpin).by(1,{angle:-5}).repeatForever().start()},onEnable:function(){this._super(),eventMgr.on(eventStr.commonEvent.RefreshTime,this.refreshTime,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.commonEvent.RefreshTime,this.refreshTime,this)},setParam:function(){var e=this;gUtils.activityIsOpen("XYLP",!0)&&app.player.sfXylpInfo(function(t,a){t||cc.isValid(e.node)&&(app.arrZhdData.XYLP=a,e.m_data=app.arrZhdData.XYLP,e.m_costData=e.m_data.cost,e.refreshUI())})},refreshUI:function(){this.refreshTime(),this.refreshBtn(),this.refreshArrReward(),this.p_nodeHjmd.getComponent("hjmdList").refreshUI(this.m_data.prize)},refreshBtn:function(){this.p_btnOne.node.getChildByName("lab_num").getComponent(cc.Label).string=this.m_costData[0].item.COUNT,this.p_btnTen.node.getChildByName("lab_num").getComponent(cc.Label).string=this.m_costData[1].item.COUNT,app.loadTexture(app.db.getPropsIconPath(this.m_costData[0].item.GSID),this.p_btnOne.node.getChildByName("spr_icon").getComponent(cc.Sprite),this.prefabPath),app.loadTexture(app.db.getPropsIconPath(this.m_costData[1].item.GSID),this.p_btnTen.node.getChildByName("spr_icon").getComponent(cc.Sprite),this.prefabPath)},refreshTime:function(){var e=app.player.getServerTime(),t=app.arrZhdTime.XYLP&&app.arrZhdTime.XYLP[1]||0,a=t-e;(!t||a<0)&&(a=0),this.p_labTime.string=0==a?"00:00:00":gUtils.getCountDownStr(a)},refreshArrReward:function(){var e=this;this.p_arrNodeReward.forEach(function(t,a){var i=e.m_data.items[a];t.getComponent("propItem").initForBag(i),t.getComponent("propItem").setClick(!0)})}});a.refreshRed=function(e){var t=!1;if(app.arrZhdData.XYLP){var a=app.arrZhdData.XYLP.cost[0].item.GSID;t=app.player.getCount(a)>0}else{var i=app.getRedInfoByObj(["act","xylp"],null);null!=i&&(t=i>0)}return e&&(e.active=t),t},cc._RF.pop()},{basePage:void 0}],activityZhdPageZmjf:[function(e,t){"use strict";cc._RF.push(t,"5c091wYZg1JT4A2FzpESQ6u","activityZhdPageZmjf");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activityzhdpagezmjf",pageParent:"activityzhdpage"},properties:{p_scrView:cc.ScrollView,p_nodeItem:cc.Node,p_btnHelp:cc.Button,p_labTime:cc.Label,p_labLoop:cc.Label},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.schedule(this.refreshTime,1),this.p_btnHelp.node.on("click",function(){app.pages.windowspagetipshelp.showPage("1035")})},setParam:function(){var e=this;app.player.sfZmjfInfo(function(t,a){if(!t&&cc.isValid(e.node)){app.arrZhdData.zmjf=a,e.m_arrData=a.missions,e.m_maxNum=0,e.canGetNum=0;for(var i=0;i<e.m_arrData.length;i++)e.m_arrData[i].cnum>e.m_maxNum&&(e.m_maxNum=e.m_arrData[i].cnum),1==e.m_arrData[i].status&&e.canGetNum++;app.redDataServer.jchd&&(app.redDataServer.jchd.zmjf=e.canGetNum),e.m_numLoop=a.looplimit,e.m_nowLoop=a.currentloop,e.refreshUI()}})},refreshUI:function(){if(this.m_arrData){var e=[],t=[],a=[];app.player.getCount(90276),this.p_labLoop.string=langMgr.getString("activityZhdPageZmjf",0,[this.m_nowLoop,this.m_numLoop]);for(var i=0;i<this.m_arrData.length;++i){var n=this.m_arrData[i];switch(n.index=i,n.status){case 0:t.push(n);break;case 1:e.push(n);break;case 2:a.push(n)}}a.length>=this.m_arrData.length&&this.m_nowLoop<this.m_numLoop?this.setParam():(e=(e=e.concat(t)).concat(a),this.refreshSView(e),this.refreshTime(),eventMgr.emit(eventStr.redEvent.RefreshActivityRed))}},refreshTime:function(){var e=app.player.getServerTime(),t=gUtils.getActivityArrTime("ZMJF")[1]||0,a=t-e;(!t||a<0)&&(a=0),this.p_labTime.string=0!=a?gUtils.getCountDownStr(a):"00:00:00"},refreshSView:function(e){this.m_arrItems||(this.m_arrItems=[],this.m_arrItems.push(this.p_nodeItem));for(var t=0;t<e.length;++t){var a=this.m_arrItems[t];a||((a=cc.instantiate(this.p_nodeItem)).parent=this.p_scrView.content,this.m_arrItems.push(a)),a.active=!0}for(var i=0;i<e.length;++i){var n={data:e[i],target:this,confrom:this.refreshUI};this.m_arrItems[i].getComponent("activityZhdZmjfItem").refreshUI(n)}for(var r=e.length;r<this.m_arrItems.length;++r)this.m_arrItems[r].active=!1}});a.refreshRed=function(e){var t=!1,a=app.getRedInfoByObj(["jchd","zmjf"],null);return null!=a&&(t=a>0),e&&(e.active=t),t},cc._RF.pop()},{basePage:void 0}],activityZhdPageZmzf:[function(e,t){"use strict";cc._RF.push(t,"84c8a/GxrhDeLuK8/OMO5t9","activityZhdPageZmzf");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activityzhdpagezmzf",pageParent:"activityzhdpage"},properties:{p_btnGoTo:cc.Button,p_btnGetReward:cc.Button,p_pfbItem:cc.Prefab,p_layout:cc.Layout,p_btnHelp:cc.Button,p_labTime:cc.Label,p_buyTime:cc.Label,p_sprGeneral:cc.Sprite,p_spGeneral:sp.Skeleton,p_animGeneral:cc.Animation,p_sprName:cc.Sprite,p_sprOccu:cc.Sprite,p_sprOccu2:cc.Sprite,p_sprStar:[cc.Sprite],p_generalQuality:cc.Node,p_pfbQualityItem:cc.Prefab},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.schedule(this.refreshTime,1),this.handleUI(),this.mCurTime=0,this.mTotalTime=0,this.mCanGetTime=0},handleUI:function(){var e=this;this.p_btnGoTo.node.on("click",function(){app.playSound("click"),app.goToPage(1005)}),this.p_btnHelp.node.on("click",function(){app.playSound("click"),app.pages.windowspagetipshelp.showPage("1047")},this),this.p_btnGetReward.node.on("click",function(){e.mCanGetTime<=0&&e.mCurTime>=e.mTotalTime||app.player.sfLdcfReward(function(t,a){if(t)app.showNotice(t);else{e.mCurTime+=e.mCanGetTime,e.mCanGetTime=a.buytime;try{app.getRedInfoByObj(["act","ldcf"],0)>0&&(app.redDataServer.act.ldcf=0)}catch(i){cc.error(i)}e.refreshGetTime(),e.refreshBtns(),app.player.addItem(a.items),eventMgr.emit(eventStr.commonEvent.RefershActivityZhdCoinUi),eventMgr.emit(eventStr.redEvent.RefreshActivityRed),app.pages.windowspagereward.showPage({showtype:1,reward:a.items,target:e})}})},this)},setParam:function(){var e=this;app.player.sfLdcfInfo(function(t,a){if(t)return cc.error(t);cc.isValid(e.node)&&(e.m_actZmzf={GRID:a.grid,ITEMS:a.items},e.mCanGetTime=a.buytime,e.mCurTime=a.count,e.mTotalTime=a.limit,e.refreshUI())})},refreshMain:function(e){var t=this;if(e){var a=app.db.getGBaseByGsid(e);a||(a={GSID:0,NAME:"\u672a\u77e5\u6b66\u5c06",CAMP:1,STAR:1});var i=app.db.getGNamePathHByGsid(a.GSID);if(app.loadTexture(i,this.p_sprName,this.prefabPath),gConfig.getNameGOccu(a.OCCU-1)){var n=gConfig.getIconGOccuPath(a.OCCU-1);app.loadTexture(n,this.p_sprOccu,this.prefabPath),this.p_sprOccu.node.active=!0,this.m_occu1=a.OCCU}else this.p_sprOccu.node.active=!1;if(a.OCCU2&&gConfig.getNameGOccu(a.OCCU2-1)){var r=gConfig.getIconGOccuPath(a.OCCU2-1);app.loadTexture(r,this.p_sprOccu2,this.prefabPath),this.p_sprOccu2.node.active=!0,this.m_occu2=a.OCCU2}else this.p_sprOccu2.node.active=!1;this._bLoad=!0,app.loadGeneral(a.GSID,this.p_sprGeneral,this.p_spGeneral,this.p_animGeneral,function(){t._bLoad=!1},this.prefabPath);var o=a.STAR,s=(o-1)%5;o>=10&&(s=0);var p=gConfig.getIconGBigStarPath(a.STAR);this.p_sprStar.forEach(function(e,a){e.node.active=s>=a,app.loadTexture(p,e,t.prefabPath)})}},refreshBtns:function(){var e=this.mCanGetTime>0||this.mCurTime>=this.mTotalTime,t=e&&this.mCurTime<this.mTotalTime;this.p_btnGoTo.node.active=!e,this.p_btnGetReward.node.active=e,e&&(this.p_btnGetReward.node.getChildByName("label_times").getComponent(cc.Label).string=this.mCanGetTime,app.setSpriteState(this.p_btnGetReward.node.getComponent(cc.Sprite),!t),this.p_btnGetReward.node.getChildByName("label_times").active=t,this.p_btnGetReward.node.getChildByName("red").active=t)},refreshUI:function(){this.m_actZmzf&&(this.upActLayout(),this.refreshTime(),this.refreshHero(),this.refreshBtns(),this.refreshGetTime(),this.refreshMain(this.m_actZmzf.GRID))},refreshGetTime:function(){this.p_buyTime.string=langMgr.getString("activityZhdPageZmzf",1,[this.mCurTime,this.mTotalTime])},refreshHero:function(){var e=app.db.getGBaseByGsid(this.m_actZmzf.GRID);if(e){var t=gConfig.getIconGStarPath(e.STAR-1);app.loadTexture(t,this.p_sprHeroXj,this.prefabPath);var a=gConfig.getIconGOccuPath(e.OCCU-1);app.loadTexture(a,this.p_sprHeroZy,this.prefabPath),this.p_generalQuality.opacity=Boolean(e.TGRADE)?255:0,e.TGRADE&&(cc.isValid(this._gQualityItem)||(this._gQualityItem=cc.instantiate(this.p_pfbQualityItem),this.p_generalQuality.addChild(this._gQualityItem),this._gQualityItem.setPosition(cc.Vec2.ZERO)),this._gQualityItem.getComponent("GeneralQualityItem").init(e.TGRADE))}else cc.error("activityZhdPageZmzf refreshHero error gsid")},upActLayout:function(){var e=this.m_actZmzf.ITEMS;if(null!=e){this.m_arrItems||(this.m_arrItems=[]);for(var t=0;t<e.length;++t){var a=this.m_arrItems[t];a||((a=cc.instantiate(this.p_pfbItem)).parent=this.p_layout.node,a.scale=.7,this.m_arrItems.push(a)),a.active=!0,a.getComponent("propItem").initForBag(e[t]),a.getComponent("propItem").setClick(!0)}for(var i=e.length;i<this.m_arrItems.length;++i)this.m_arrItems[i].active=!1}},refreshTime:function(){var e=app.player.getServerTime(),t=app.arrZhdTime.LDCF&&app.arrZhdTime.LDCF[1]||0,a=t-e;(!t||a<0)&&(a=0),this.p_labTime.string=0!=a?gUtils.getCountDownStr(a):"00:00:00"}});a.refreshRed=function(e){var t=!1,a=app.getRedInfoByObj(["act","ldcf"],0);return null!=a&&(t=Boolean(a>0)),cc.isValid(e)&&cc.Node.isNode(e)&&(e.active=t),t},cc._RF.pop()},{basePage:void 0}],activityZhdPageZsthChose:[function(e,t){"use strict";cc._RF.push(t,"2cf44Ydu/dHD7wLtE3PMf1M","activityZhdPageZsthChose");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activityzhdpagezsthchose",pageType:1},properties:{p_tabPropBag:cc.Node,p_arrChoseItem:[cc.Node],p_arrChoseItemTips:[cc.Node],p_btnYes:cc.Button,p_btnNo:cc.Button,p_labTitle:cc.Label,p_labText:cc.Label,p_labNotSet:cc.Label},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(),this.handleUI(),this.p_labTitle.node.active=!1,this.p_labText.node.active=!1,this.p_labNotSet.node.active=!0},handleUI:function(){var e=this;this._super(),this.p_arrChoseItem.forEach(function(t,a){t.on("touchend",function(){e.choseItem(a)})}),this.p_btnYes.node.on("click",function(){for(var t=!1,a=0;a<e.m_arrIndex.length;a++)e.m_arrIndex[a]||0==e.m_arrIndex[a]||(t=!0);e.m_arrIndex.length<e.m_objData.array.length||t?app.showNotice(langMgr.getString("rechargeFixtimePageCzlbChose",0)):(e.m_cancelcb&&e.m_cancelcb.call(e.m_tarage,gUtils.deepClone(e.m_choseData),gUtils.deepClone(e.m_arrIndex)),e.onClose())}),this.p_btnNo.node.on("click",function(){e.onClose()})},setParam:function(e){this.m_objData=e,this.m_rgroupData=e.rgroup,this.m_arrIndex=gUtils.deepClone(this.m_objData.arrIndex)||[],this.m_choseData=gUtils.deepClone(this.m_objData.choseData)||[],this.m_tarage=this.m_objData.target,this.m_cancelcb=this.m_objData.cancelcb,e.index&&(this.m_oriIndex=e.index),this.refreshUI()},refreshUI:function(){this.m_objData?(this.refreshArrChoseItem(),this.m_oriIndex?this.choseItem(this.m_oriIndex):this.choseItem(0),this.refreshPropBagView()):this.onClose()},choseItem:function(e){var t=this;if(this.m_index!=e){for(var a=0;a<this.p_arrChoseItemTips.length;++a)this.p_arrChoseItemTips[a].active=a==e;if(this.m_index=e,this.p_arrChoseItem.forEach(function(e,a){e.active&&(e.getChildByName("spr_green").active=t.m_index==a)}),this.m_choseData[e]){this.p_labTitle.node.active=!0,this.p_labText.node.active=!0,this.p_labNotSet.node.active=!1,this.p_labTitle.string=app.db.getPropsName(this.m_choseData[e].GSID),this.p_labTitle.string+="X"+gUtils.showNum(this.m_choseData[e].COUNT);var i=app.db.getPropsInfoByGsid(this.m_choseData[e].GSID);this.p_labText.string=i.INTRO}else this.p_labTitle.node.active=!1,this.p_labText.node.active=!1,this.p_labNotSet.node.active=!0;var n=this.m_objData.array[e];this.m_showData=this.m_rgroupData[n],this.refreshPropBagView()}},refreshArrChoseItem:function(){var e=this;this.m_objData&&this.m_objData.array&&this.p_arrChoseItem.forEach(function(t,a){var i=e.m_objData.array[a];if(t.active=!!i,t.active){var n=e.m_choseData[a],r=t.getChildByName("porp_item");r.active=!!n,n&&r.getComponent("propItem").initForBag(n)}})},refreshPropBagView:function(){this.m_arrChooseIndex=[];var e=this.m_showData.length;this.p_tabPropBag.getComponent("tableView").initTableView(e,{array:this.m_showData,pickmax:1,scale:1,target:this})},itemPorpClick:function(e,t){if(e==this.m_itemIndex)return this.m_chooseItem=t,!0;this.m_chooseItem&&(cc.log("handle choose item"),this.m_chooseItem.selected(!1,this.m_itemIndex)),this.m_chooseItem=t,this.p_labTitle.node.active=!0,this.p_labText.node.active=!0,this.p_labNotSet.node.active=!1,this.p_labTitle.string=app.db.getPropsName(this.m_chooseItem.m_objItem.GSID),this.p_labTitle.string+="X"+gUtils.showNum(this.m_chooseItem.m_objItem.COUNT);var a=app.db.getPropsInfoByGsid(this.m_chooseItem.m_objItem.GSID);this.p_labText.string=a.INTRO,this.m_arrIndex[this.m_index]=e;var i=this.m_objData.array[this.m_index];return this.m_choseData[this.m_index]=this.m_rgroupData[i][e],this.refreshArrChoseItem(),!0},onClose:function(){this._super()}});cc._RF.pop()},{basePage:void 0}],activityZhdPageZsthrmb:[function(e,t){"use strict";cc._RF.push(t,"1cea77eB8RFmqwDurEmoeSM","activityZhdPageZsthrmb");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activityzhdpagezsthrmb",pageParent:"activityzhdpage"},properties:{p_labTime:cc.Label,p_scrView:cc.ScrollView,p_btnHelp:cc.Button,p_nodeItem:cc.Node},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.m_arrItems||(this.m_arrItems=[],this.m_arrItems.push(this.p_nodeItem))},handleUI:function(){this._super(),this.p_btnHelp.node.on("click",function(){app.playSound("click"),app.pages.windowspagetipshelp.showPage("1081")},this)},setParam:function(){var e=this;if(gUtils.activityIsOpen("DZLBRMB",!0)&&(this.time=0,this.isRTime=!1,this.m_data?this.refreshUI():app.player.sfZxlbList(function(t,a){if(t)app.showNotice(t);else if(cc.isValid(e.node)){e.m_data=a;for(var i=0;i<e.m_data.items.length;i++)e.m_data.items[i].arrIndex=[],e.m_data.items[i].choseData=[];e.refreshUI()}}),null==localDataUtils.GetValue("activityzhdpagezsthRED",null))){var t=app.player.getServerTime(),a=gUtils.getSecondDayTime(t);localDataUtils.SetValue("activityzhdpagezsthRED",1,a),eventMgr.emit(eventStr.redEvent.RefreshActivityZhdRed),eventMgr.emit(eventStr.redEvent.RefreshActivityRed)}},refreshUI:function(){if(this.m_data){for(var e=[],t=[],a=0;a<this.m_data.items.length;++a){var i=this.m_data.items[a];i.index=a,i.limit>0?e.push(i):t.push(i)}e=e.concat(t),this.refreshSView(e),this.isRTime=!0,this.time=1}},refreshSView:function(e){this.m_arrItems||(this.m_arrItems=[],this.m_arrItems.push(this.p_nodeItem));for(var t=0;t<e.length;++t){var a=this.m_arrItems[t];a||((a=cc.instantiate(this.p_nodeItem)).parent=this.p_scrView.content,this.m_arrItems.push(a)),a.active=!0}for(var i=0;i<e.length;++i){var n={data:e[i],rgroup:this.m_data.rgroup,target:this,confrom:this.refreshUI};this.m_arrItems[i].getComponent("rechargeFixtimeItemRmb").refreshUI(n,!this.isRTime)}for(var r=e.length;r<this.m_arrItems.length;++r)this.m_arrItems[r].active=!1},refreshTime:function(){var e=app.player.getServerTime(),t=app.arrZhdTime.DZLBRMB&&app.arrZhdTime.DZLBRMB[1]||0,a=t-e;(!t||a<0)&&(a=0),this.p_labTime.string=0!=a?gUtils.getCountDownStr(a):"00:00:00"},update:function(e){this.isRTime&&(this.time>1?(this.time=0,this.refreshTime()):this.time+=e)},onClose:function(){this._super()}});a.refreshRed=function(){return!1},cc._RF.pop()},{basePage:void 0}],activityZhdPageZsth:[function(e,t){"use strict";cc._RF.push(t,"c833cgt6YtBJb8vmvuaOn08","activityZhdPageZsth");var a="activityzhdpagezsthRED",i=cc.Class({extends:e("basePage"),statics:{prefabPath:"activityzhdpagezsth",pageParent:"activityzhdpage"},properties:{p_labTime:cc.Label,p_scrView:cc.ScrollView,p_btnHelp:cc.Button,p_nodeItem:cc.Node},onLoad:function(){i.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.m_arrItems||(this.m_arrItems=[],this.m_arrItems.push(this.p_nodeItem))},handleUI:function(){this._super(),this.p_btnHelp.node.on("click",function(){app.playSound("click"),app.pages.windowspagetipshelp.showPage("1081")},this)},setParam:function(){var e=this;if(gUtils.activityIsOpen("DZLB",!0)&&(this.time=0,this.isRTime=!1,this.m_data?this.refreshUI():app.player.sfDzlbList(function(t,a){if(t)app.showNotice(t);else if(cc.isValid(e.node)){e.m_data=a;for(var i=0;i<e.m_data.items.length;i++)e.m_data.items[i].arrIndex=[],e.m_data.items[i].choseData=[];e.refreshUI()}}),null==localDataUtils.GetValue(a,null))){var t=app.player.getServerTime(),i=gUtils.getSecondDayTime(t);localDataUtils.SetValue(a,1,i),eventMgr.emit(eventStr.redEvent.RefreshActivityZhdRed),eventMgr.emit(eventStr.redEvent.RefreshActivityRed)}},refreshUI:function(){if(this.m_data){for(var e=[],t=[],a=0;a<this.m_data.items.length;++a){var i=this.m_data.items[a];i.index=a,i.limit>0?e.push(i):t.push(i)}e=e.concat(t),this.refreshSView(e),this.isRTime=!0,this.time=1}},refreshSView:function(e){this.m_arrItems||(this.m_arrItems=[],this.m_arrItems.push(this.p_nodeItem));for(var t=0;t<e.length;++t){var a=this.m_arrItems[t];a||((a=cc.instantiate(this.p_nodeItem)).parent=this.p_scrView.content,this.m_arrItems.push(a)),a.active=!0}for(var i=0;i<e.length;++i){var n={data:e[i],rgroup:this.m_data.rgroup,target:this,confrom:this.refreshUI};this.m_arrItems[i].getComponent("rechargeFixtimeItem").refreshUI(n,!this.isRTime)}for(var r=e.length;r<this.m_arrItems.length;++r)this.m_arrItems[r].active=!1},refreshTime:function(){var e=app.player.getServerTime(),t=app.arrZhdTime.DZLB&&app.arrZhdTime.DZLB[1]||0,a=t-e;(!t||a<0)&&(a=0),this.p_labTime.string=0!=a?gUtils.getCountDownStr(a):"00:00:00"},update:function(e){this.isRTime&&(this.time>1?(this.time=0,this.refreshTime()):this.time+=e)},onClose:function(){this._super()}});i.refreshRed=function(e){var t=!1;return t||null==localDataUtils.GetValue(a,null)&&app.getRedInfoByObj(["act","dzlb"],null)>0&&(t=!0),e&&(e.active=t),t},cc._RF.pop()},{basePage:void 0}],activityZhdPageZtlb:[function(e,t){"use strict";cc._RF.push(t,"c61d3EpNptME582ZTMs08E8","activityZhdPageZtlb");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=e("../lang/langMgr"),o=cc._decorator,s=o.ccclass,p=o.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_labDayIntro=null,t.p_labJJIntro=null,t.p_nodeDayItemContent=null,t.p_pfbItem=null,t.p_btnDayGet=null,t.p_nodeJJItemContent=null,t.p_labCount=null,t.p_nodePrice=null,t.p_sprCostIcon=null,t.p_btnBuy=null,t.p_btnHelp=null,t.p_labTime=null,t.p_sprIcon=null,t.p_arrSprF=[],t._payRefreshEnd=!0,t.m_type="",t.m_id="",t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){var e=this;a.instance=this,this.stopBgNodeEvent(),this.refreshTime(),this.schedule(this.refreshTime,1),this.p_btnBuy.node.on("click",function(){app.playSound("click"),e.onClickBuy()}),this.p_btnDayGet.node.on("click",function(){app.playSound("click"),e.onClickDayGet()}),this.p_btnHelp.node.on("click",function(){app.playSound("click")})},t.prototype.setParam=function(){this.checkType(),this.getData()},t.prototype.getData=function(){var e=this;app.player.zztlbInfo(this.m_type,function(t,a){t?app.showNotice(t):cc.isValid(e.node)&&(app.arrZhdData.ztlb=a,e.refreshUI())})},t.prototype.checkType=function(){var e=app.player.getServerTime(),t=app.arrZhdTime&&app.arrZhdTime.ZZTJJ_GZ&&app.arrZhdTime.ZZTJJ_GZ.time||[0,0],a=app.arrZhdTime&&app.arrZhdTime.ZZTJJ_GX&&app.arrZhdTime.ZZTJJ_GX.time||[0,0],i=app.arrZhdTime&&app.arrZhdTime.ZZTJJ_GJ&&app.arrZhdTime.ZZTJJ_GJ.time||[0,0],n=app.arrZhdTime&&app.arrZhdTime.ZZTJJ_DJ&&app.arrZhdTime.ZZTJJ_DJ.time||[0,0];t[0]<=e&&t[1]>e?(this.m_free="gz",this.m_type="gz",this.m_id="zztjj_gz"):a[0]<=e&&a[1]>e?(this.m_free="gx",this.m_type="gx",this.m_id="zztjj_gx"):i[0]<=e&&i[1]>e?(this.m_free="gj",this.m_type="gj",this.m_id="zztjj_gj"):n[0]<=e&&n[1]>e&&((app.arrZhdTime.ZZTJJ_DJ.type="XS_ZZTJJ_DJ")?(this.m_free="xs",this.m_type="dj",this.m_id="zztjj_dj"):(this.m_free="dj",this.m_type="dj",this.m_id="zztjj_dj"))},t.prototype.refreshUI=function(){this.m_freeData=app.db.dbFreeGift[this.m_free];for(var e=0;e<this.m_freeData.ITEMS.length;e++)(a=this.p_nodeDayItemContent.children[e])||((a=cc.instantiate(this.p_pfbItem)).parent=this.p_nodeDayItemContent),a.active=!0,a.getComponent("propItem").initForBag(this.m_freeData.ITEMS[e]),a.getComponent("propItem").setClick(!0);for(e=this.m_freeData.ITEMS.length;e<this.p_nodeDayItemContent.children.length;e++)this.p_nodeDayItemContent.children[e].active=!1;this.p_btnDayGet.interactable=!app.player.getCount(this.m_freeData.MARK),this.p_btnDayGet.node.getChildByName("redpoint").active=this.p_btnDayGet.interactable;var t=app.arrZhdData.ztlb;for(e=0;e<t.config[0].items.length;e++){var a;(a=this.p_nodeJJItemContent.children[e])||((a=cc.instantiate(this.p_pfbItem)).parent=this.p_nodeJJItemContent),a.active=!0,a.getComponent("propItem").initForBag(t.config[0].items[e]),a.getComponent("propItem").setClick(!0)}for(e=t.config[0].items.length;e<this.p_nodeJJItemContent.children.length;e++)this.p_nodeJJItemContent.children[e].active=!1;if(t.config[0].num,!t.ispay){this.p_nodePrice.getComponent(cc.Label).string=t.config[0].yb;var i=app.db.getPropsIconPath("38005");app.loadTexture(i,this.p_sprCostIcon,this.prefabPath)}this.p_btnBuy.interactable=t.config[0].num,app.setNodeState(this.p_btnBuy.node,!t.config[0].num),this.p_labCount.string="\u9650\u8d2d\u6b21\u6570\uff1a"+t.config[0].num},t.prototype.refreshTime=function(){var e=app.player.getServerTime(),t=app.arrZhdTime&&app.arrZhdTime.ZZTJJ_GZ&&app.arrZhdTime.ZZTJJ_GZ.time||0,a=app.arrZhdTime&&app.arrZhdTime.ZZTJJ_GX&&app.arrZhdTime.ZZTJJ_GX.time||0,i=app.arrZhdTime&&app.arrZhdTime.ZZTJJ_GJ&&app.arrZhdTime.ZZTJJ_GJ.time||0,n=app.arrZhdTime&&app.arrZhdTime.ZZTJJ_DJ&&app.arrZhdTime.ZZTJJ_DJ.time||0,r=t||a||i||n||0;t[1]>e&&t[0]<=e&&(r=t[1]),a[1]>e&&a[0]<=e&&(r=a[1]),i[1]>e&&i[0]<=e&&(r=i[1]),n[1]>e&&n[0]<=e&&(r=n[1]),this.m_lastTime=r-e,(!r||this.m_lastTime<0)&&(this.m_lastTime=0),0!=this.m_lastTime?this.p_labTime.string=gUtils.getCountDownStr(this.m_lastTime):this.p_labTime.string="00:00:00"},t.prototype.payRefresh=function(){var e=this;this._payRefreshEnd||app.player.sfPlayerByParam(["others","vip","hide","bagspace","props"],function(){e.getData(),eventMgr.emit(eventStr.commonEvent.RefershActivityZhdCoinUi,"ZZTJJ"),eventMgr.emit(eventStr.commonEvent.RefreshActivityRed),e._payRefreshEnd=!0})},t.prototype.onClickBuy=function(){var e=this;if(app.player.getCount(38005)<app.arrZhdData.ztlb.config[0].yb){var t=app.db.getPropsName(38005);app.showNotice(r.getString("playerData",0,t))}else app.player.buyZztlb(this.m_type,0,function(t,a){if(e.getData(),a){var i=[{gsid:38005,count:app.arrZhdData.ztlb.config[0].yb}];app.player.reduceItem(i);var n={showtype:1,reward:a.items};app.pages.windowspagereward.showPage(n)}eventMgr.emit(eventStr.commonEvent.RefershActivityZhdCoinUi,"ZZTJJ"),eventMgr.emit(eventStr.commonEvent.RefreshActivityRed)})},t.prototype.onClickJJGet=function(){var e=this;if(this.m_lastTime<=0)app.showNotice("\u6d3b\u52a8\u5df2\u7ed3\u675f");else{var t=this.m_id;app.player.zztlbReward(this.m_type,function(a,i){if(a)app.showNotice(a);else{app.redDataServer&&app.redDataServer.act&&app.redDataServer.act[t]&&app.redDataServer.act[t]--;var n={showtype:1,reward:i.items,confirmcb:function(){eventMgr.emit(eventStr.commonEvent.RefreshActivityRed),eventMgr.emit(eventStr.commonEvent.RefershActivityZhdCoinUi,"ZZTJJ"),e.getData()},target:e};app.pages.windowspagereward.showPage(n)}})}},t.prototype.onClickDayGet=function(){var e=this,t="freegift_reward_"+this.m_freeData.MARK;app.player.sfExchange(t,1,0,function(t){var a={showtype:1,reward:t,confirmcb:function(){eventMgr.emit(eventStr.commonEvent.RefreshActivityRed),eventMgr.emit(eventStr.commonEvent.RefershActivityZhdCoinUi,"ZZTJJ"),e.p_btnDayGet.interactable=!1,e.p_btnDayGet.node.getChildByName("redpoint").active=!1},target:e};app.pages.windowspagereward.showPage(a)})},t.prefabPath="activityZhdPageZtlb",t.pageParent="activityzhdpage",n([p(cc.Label)],t.prototype,"p_labDayIntro",void 0),n([p(cc.Label)],t.prototype,"p_labJJIntro",void 0),n([p(cc.Node)],t.prototype,"p_nodeDayItemContent",void 0),n([p(cc.Prefab)],t.prototype,"p_pfbItem",void 0),n([p(cc.Button)],t.prototype,"p_btnDayGet",void 0),n([p(cc.Node)],t.prototype,"p_nodeJJItemContent",void 0),n([p(cc.Label)],t.prototype,"p_labCount",void 0),n([p(cc.Node)],t.prototype,"p_nodePrice",void 0),n([p(cc.Sprite)],t.prototype,"p_sprCostIcon",void 0),n([p(cc.Button)],t.prototype,"p_btnBuy",void 0),n([p(cc.Button)],t.prototype,"p_btnHelp",void 0),n([p(cc.Label)],t.prototype,"p_labTime",void 0),n([p(cc.Sprite)],t.prototype,"p_sprIcon",void 0),n([p(cc.SpriteFrame)],t.prototype,"p_arrSprF",void 0),a=n([s],t)}(e("basePage"));c.refreshRed=function(e){var t,a,i=app.player.getServerTime(),n=app.arrZhdTime&&app.arrZhdTime.ZZTJJ_GZ&&app.arrZhdTime.ZZTJJ_GZ.time||[0,0],r=app.arrZhdTime&&app.arrZhdTime.ZZTJJ_GX&&app.arrZhdTime.ZZTJJ_GX.time||[0,0],o=app.arrZhdTime&&app.arrZhdTime.ZZTJJ_GJ&&app.arrZhdTime.ZZTJJ_GJ.time||[0,0],s=app.arrZhdTime&&app.arrZhdTime.ZZTJJ_DJ&&app.arrZhdTime.ZZTJJ_DJ.time||[0,0];n[1]>i&&n[0]<=i?(t="gz",a="zztjj_gz"):r[1]>i&&r[0]<=i?(t="gx",a="zztjj_gx"):o[1]>i&&o[0]<=i?(t="gj",a="zztjj_gj"):s[1]>i&&s[0]<=i&&(t=(app.arrZhdTime.ZZTJJ_DJ.type="XS_ZZTJJ_DJ")?"xs":"dj");var p=!1,c=0;if(a&&(c=app.getRedInfoByObj(["act",a],null)),null!=c&&(p=c>0),t){var h=app.db.dbFreeGift[t];h&&!app.player.getCount(h.MARK)&&(p=!0)}return e&&(e.active=p),p},t.exports=c,cc._RF.pop()},{"../lang/langMgr":void 0,basePage:void 0}],activityZhdPage:[function(e,t){"use strict";cc._RF.push(t,"1cffb6OgNBHjLK+9K6fV2py","activityZhdPage");var a=e("activityPageModel"),i=cc.Class({extends:e("activityPageModel"),statics:{prefabPath:"activityzhdpage"},onLoad:function(){i.instance=this,this._super()},properties:{},setParam:function(e){this._super("zhd",e)}});i.refreshRed=function(e){return a.refreshRed(e,"zhd")},i.isOpen=function(){return a.isOpen("zhd")&&app.db.checkPageUnLock("activityzhdpage")},cc._RF.pop()},{activityPageModel:"activityPageModel"}],activityZylbPage:[function(e,t){"use strict";cc._RF.push(t,"4af35URhb5OUL8302BXoUau","activityZylbPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"activityzylbpage",pageType:1},properties:{p_sprBg:cc.Sprite,p_sprTitle:cc.Sprite,p_sprName:cc.Sprite,p_sprCamp:cc.Sprite,p_sprOccu:cc.Sprite,p_arrRewards:[cc.Node],p_btnBuy:cc.Button,p_nodeNum:cc.Node,p_labLimit:cc.Label,p_labTime:cc.Label},onLoad:function(){a.instance=this,this.schedule(this.refreshTime,1),this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),localDataUtils.SetValue("activityZylbRed",1,gUtils.getSecondDayTime(app.player.getServerTime()))},handleUI:function(){var e=this;this._super(),this.p_btnBuy.node.on("click",function(){e.clickBuyBtn()})},setParam:function(){var e=this;app.zylb?(this.m_data=app.zylb,this.refreshUI()):app.player.sfZylbList(function(t,a){t?app.showNotice(t):(app.zylb=a[0],e.m_data=app.zylb,e.m_data.items.push({GSID:38003,COUNT:e.m_data.exp}),e.refreshUI())})},payRefresh:function(){var e=this;this._payRefreshEnd||app.player.sfPlayerByParam(["props","hide","bagspace","others","vip"],function(){e._payRefreshEnd=!0,e.refreshUI()})},clickBuyBtn:function(){var e=this;app.player.payZylb(0,this.m_data.price,function(){e._payRefreshEnd=!1;var t={reward:e.setReward(0),showtype:1};app.pages.windowspagereward.showPage(t),e.m_data.buytime-=1,e.payRefresh(),e.schedule(e.payRefresh,1,3)},function(){app.showNotice(langMgr.getString("activityJrhdPage",2))})},setReward:function(){for(var e=[],t=this.m_data.items||[],a=this.m_data.special||[],i=0;i<t.length;++i)e.push(t[i]);for(var n=0;n<a.length;++n)e.push(a[n]);return e},refershRewards:function(){for(var e=this.m_data.items.concat(this.m_data.special),t=0;t<this.p_arrRewards.length;t++){var a=this.p_arrRewards[t],i=e[t];a.active=!!i,a.active&&(a.getComponent("propItem").initForBag(i),a.getComponent("propItem").setClick(!0))}},refreshBtn:function(){this.p_btnBuy.interactable=this.m_data.buytime>0},refreshBuytime:function(){this.p_labLimit.string=langMgr.getString("activityJrhdPage",3,this.m_data.buytime)},refreshBuyNum:function(){this.p_nodeNum.getComponent("price_num_item").init(this.m_data.price,1,2)},refreshUI:function(){var e=gConfig.getZylbIcon(this.m_data.heroname),t=gConfig.getZylbIcon(this.m_data.txbig);app.loadTexture(e,this.p_sprName,this.prefabPath),app.loadTexture(t,this.p_sprTitle,this.prefabPath),this.refreshBuytime(),this.refreshBtn(),this.refreshTime(),this.refershRewards(),this.refreshBuyNum()},refreshTime:function(){var e=new Date(app.player.create);e.setHours(0,0,0,0);var t=app.player.getServerTime(),a=e.valueOf()+6048e5,i=a-t;(!a||i<0)&&(i=0),this.p_labTime.string=gUtils.getCountDownStr(i)+langMgr.getString("public",10)},onClose:function(){this._super()}});a.isOpen=function(){var e=new Date(app.player.create);return e.setHours(0,0,0,0),e.valueOf()+6048e5>app.player.getServerTime()},a.getEndTime=function(){var e=new Date(app.player.create);return e.setHours(0,0,0,0),e.valueOf()+6048e5},a.refreshRed=function(e){var t;return t=!localDataUtils.GetValue("activityZylbRed",null),e&&(e.active=t),t},cc._RF.pop()},{basePage:void 0}],advanceNoticePage:[function(e,t){"use strict";cc._RF.push(t,"b0ad0WNJThP14x1ar9w1EWA","advanceNoticePage");var a,i,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),r=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},o=this&&this.__awaiter||function(e,t,a,i){return new(a||(a=Promise))(function(n,r){function o(e){try{p(i.next(e))}catch(t){r(t)}}function s(e){try{p(i.throw(e))}catch(t){r(t)}}function p(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(o,s)}p((i=i.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var a,i,n,r,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(e){return function(t){return p([e,t])}}function p(r){if(a)throw new TypeError("Generator is already executing.");for(;o;)try{if(a=1,i&&(n=2&r[0]?i.return:r[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,r[1])).done)return n;switch(i=0,n&&(r=[2&r[0],n.value]),r[0]){case 0:case 1:n=r;break;case 4:return o.label++,{value:r[1],done:!1};case 5:o.label++,i=r[1],r=[0];continue;case 7:r=o.ops.pop(),o.trys.pop();continue;default:if(!(n=(n=o.trys).length>0&&n[n.length-1])&&(6===r[0]||2===r[0])){o=0;continue}if(3===r[0]&&(!n||r[1]>n[0]&&r[1]<n[3])){o.label=r[1];break}if(6===r[0]&&o.label<n[1]){o.label=n[1],n=r;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(r);break}n[2]&&o.ops.pop(),o.trys.pop();continue}r=t.call(e,o)}catch(s){r=[6,s],i=0}finally{a=n=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},p=cc._decorator,c=p.ccclass,h=p.property,l=e("basePage");(function(e){e[e.wangzheyanwu=0]="wangzheyanwu",e[e.wangzhan=1]="wangzhan"})(i||(i={}));var g=function(t){function a(){var e=null!==t&&t.apply(this,arguments)||this;return e.p_top=null,e.sprBg=null,e.sprName=null,e.sprTitle=null,e.sprGoTo=null,e.p_menu=null,e.p_richText=null,e.p_infoParent=null,e.p_playMode=null,e.p_playParent=null,e.p_propItem=null,e.p_labelTime=null,e.arrShopPage=[{name:i.wangzheyanwu,uiPatch:"advance_notice_page",iconPath:"btn_wj_wzyw01",iconPickPath:"btn_wj_wzyw02",labelPath:"txt_wj_wzyw_lang",sprBg:"bg_gnygwzyw750x1700",sprName:"txt_wzyw_zi_lang",sprTitle:"txt_wzyw_glts_lang",sprGoto:"txt_gnyg_qwywc_lang",sprGoUpLv:"txt_gnyg_tsdj_lang",goto:1022,coin:[38005,38006],infoLangIdx:[0,1,2],rewardProp:96001,exid:"advance_notice_0",playModeBtns:[{icon:"btn_gnyg_dwyl_lang",tip:"txt_gnygtcxx03_lang"},{icon:"btn_gnyg_ddzb_lang",tip:"txt_gnygtcxx08_lang"},{icon:"btn_gnyg_mzrw_lang",tip:"txt_gnygtcxx05_lang"},{icon:"btn_gnyg_sjjl_lang",tip:"txt_gnygtcxx04_lang"}]},{name:i.wangzhan,uiPatch:"advance_notice_page",iconPath:"btn_wj_wz01",iconPickPath:"btn_wj_wz02",labelPath:"txt_wj_wz_lang",sprBg:"bg_gnygwwzdz750x1700",sprName:"txt_wwzdz_zi_lang",sprTitle:"txt_wwzdz_glts_lang",sprGoto:"txt_gnyg_qwywc_lang",sprGoUpLv:"txt_gnyg_tsdj_lang",goto:1022,coin:[38005,38006],infoLangIdx:[3,4,5],rewardProp:96002,exid:"advance_notice_1",playModeBtns:[{icon:"btn_gnyg_eztx_lang",tip:"txt_gnygtcxx01_lang"},{icon:"btn_gnyg_lxtf_lang",tip:"txt_gnygtcxx02_lang"},{icon:"btn_gnyg_zzjc_lang",tip:"txt_gnygtcxx07_lang"},{icon:"btn_gnyg_syjc_lang",tip:"txt_gnygtcxx06_lang"}]}],e.m_menuIndex=0,e.curPageData=null,e.m_arrMenuData=[],e.m_info=[],e.m_playMode=[],e}var p;return n(a,t),p=a,a.prototype.onLoad=function(){p.instance=this,this.stopBgNodeEvent(),this.fitTopMenu(),this.handleUI(),this.m_menu=this.p_menu.getComponent("menuV2")},a.prototype.setParam=function(e){this.isRTime=!0,this.time=0,this.m_arrMenuData=this.getMenuData(),this.m_menu.init(this.m_arrMenuData.length,this.menuHandler,this.refreshMenuUI,this.refreshMenuRed,this),this.m_menu.refreshMenu(),this.setMenu(e),this.refreshTime()},a.prototype.update=function(e){this.isRTime&&(this.time>1?(this.time=0,this.refreshTime()):this.time+=e)},a.prototype.onClose=function(){this.isRTime=!1,t.prototype.onClose.call(this)},a.prototype.refreshTime=function(){var e;if(this.curPageData.name===i.wangzheyanwu)e=(t=app.pages.kingpvppage.getKingPvpState().totalTime)>0?t:0;else if(this.curPageData.name===i.wangzhan){var t;e=(t=app.wangPvpInfo.time-app.player.getServerTime())>0?t:0}this.p_labelTime.string=gUtils.getCountDownStr(e)},a.prototype.refreshMenuUI=function(e){return this.m_arrMenuData[e]},a.prototype.setMenu=function(e){var t;e=0===e||e?e:this.m_arrMenuData[0].name;for(var a=0;a<this.m_arrMenuData.length;a++)if(this.m_arrMenuData[a].name==e){t=a;break}t>=0&&this.m_menu.setMenuIndex(t)},a.prototype.refreshCoinUI=function(){this.p_top.getComponent("currency").refreshCoin(this.curPageData.coin),this.refreshRed()},a.prototype.refreshInfos=function(){return o(this,void 0,Promise,function(){var e,t,a,n,r=this;return s(this,function(o){switch(o.label){case 0:return this.curPageData&&this.curPageData.infoLangIdx.length?(this.m_info.map(function(e){return e.active=!1}),this.curPageData.name!==i.wangzheyanwu?[3,1]:(t=app.pages.kingpvppage.getKingPvpState().totalTime,a=app.db.getLevelByPage("kingpvppage"),e=[[gUtils.timestampToTime(t+app.player.getServerTime())],[a],[a>app.player.level?"\u4e0d\u53ef\u53c2\u4e0e":"\u53ef\u53c2\u4e0e",app.player.level]],[3,4])):[2];case 1:return this.curPageData.name!==i.wangzhan?[3,4]:app.PVPRANKDATA.pvp?[3,3]:[4,this.getPvpRankInfo()];case 2:o.sent(),o.label=3;case 3:app.PVPRANKDATA.pvp.selfrank||app.pages.pvppage.setData(),n=app.PVPRANKDATA.pvp.selfrank,e=[[gUtils.timestampToTime(app.wangPvpInfo.time)],[64],[n&&n<64?"\u53ef\u53c2\u4e0e":"\u4e0d\u53ef\u53c2\u4e0e",n]],o.label=4;case 4:return this.curPageData.infoLangIdx.forEach(function(t,a){var i=r.m_info[a];i||(i=cc.instantiate(r.p_richText),r.p_infoParent.addChild(i),r.m_info[a]=i),i.active=!0,i.getComponent(cc.RichText).string=langMgr.getString("advanceNotice",t,e[a])}),[2]}})})},a.prototype.refreshPlayMode=function(){var e=this;this.curPageData&&this.curPageData.playModeBtns.length&&(this.m_playMode.map(function(e){return e.active=!1}),this.curPageData.playModeBtns.forEach(function(t,a){var i=e.m_playMode[a];i||(i=cc.instantiate(e.p_playMode),e.p_playParent.addChild(i),e.m_playMode[a]=i,i.on("click",function(){return e.playClickHandle(i,t,a)})),i.active=!0;var n=gConfig.getMenuPatch(e.curPageData.uiPatch);app.loadTexture(n+"/"+t.icon,i.getComponent(cc.Sprite),e.prefabPath)}))},a.prototype.refreshReward=function(){var e=this.p_propItem.getComponent("propItem");e.initForBag({gsid:38005,count:50});var t=app.player.getCount(this.curPageData.rewardProp)>0;e.setMask(t),e.setSelect(t),e.setRed(!t),e.setAnim(!t,"prop_light_01",2,1.5,1.5,15),this.refreshRed()},a.prototype.getMenuData=function(){return this.arrShopPage.filter(function(e){switch(e.name){case i.wangzheyanwu:return p.kingpvpState();case i.wangzhan:return p.wangpvpState();default:return!1}})},a.prototype.refreshRed=function(){this.m_menu.refreshRed()},a.prototype.handleUI=function(){var e=this;t.prototype.handleUI.call(this),this.sprGoTo.on("click",function(){app.playSound("click"),app.goToPage(e.curPageData.goto)}),this.p_propItem.on("touchend",function(){app.playSound("click"),e.rewardClickHandle()}),this.p_bgNode.on("touchend",function(){e.m_playMode.map(function(e){return e.getChildByName("tip").active=!1})})},a.prototype.menuHandler=function(e){this.m_menuIndex=e,this.curPageData=this.m_arrMenuData[e],this.refreshTime(),this.openShopPage()},a.prototype.openShopPage=function(){if(this.curPageData){var e=gConfig.getMenuPatch(this.curPageData.uiPatch);app.loadTexture(e+"/"+this.curPageData.sprBg,this.sprBg,this.prefabPath),app.loadTexture(e+"/"+this.curPageData.sprName,this.sprName,this.prefabPath),app.loadTexture(e+"/"+this.curPageData.sprTitle,this.sprTitle,this.prefabPath),app.loadTexture(e+"/"+this.curPageData.sprGoto,this.sprGoTo.getComponent(cc.Sprite),this.prefabPath),this.m_playMode.map(function(e){return e.getChildByName("tip").active=!1}),this.refreshInfos(),this.refreshPlayMode(),this.refreshReward(),this.refreshCoinUI()}},a.prototype.refreshMenuRed=function(e){var t=this.m_arrMenuData[e];return 0===app.player.getCount(t.rewardProp)},a.prototype.playClickHandle=function(e,t,a){var i=this;this.m_playMode.map(function(e){return e.getChildByName("tip").active=!1});var n=e.getChildByName("tip"),r=n.getChildByName("bg"),o=n.getChildByName("tip_content");n.active=!0,n.opacity=0,n.runAction(cc.sequence(cc.show(),cc.fadeIn(.3)));var s=o.getComponent(cc.Sprite),p=gConfig.getMenuPatch(this.curPageData.uiPatch);app.loadTexture(p+"/"+t.tip,s,this.prefabPath,function(){var e=s.node.getContentSize();r.width=e.width+40,r.height=e.height+50,a>=Math.floor(i.curPageData.playModeBtns.length/2)?(r.x=30,o.x=-(e.width-10),r.scaleX=-1):(r.x=-30,r.scaleX=1,o.x=-10)})},a.prototype.rewardClickHandle=function(){var e=this;app.player.sfExchange(this.curPageData.exid,1,null,function(t){for(var a=[],i=0,n=t;i<n.length;i++){var r=n[i];a.push(r)}var o={showtype:1,reward:a,confirmcb:function(){e.refreshReward(),e.refreshCoinUI()},target:e};app.pages.windowspagereward.showPage(o)})},a.prototype.getPvpRankInfo=function(){return o(this,void 0,Promise,function(){return s(this,function(){return[2,new Promise(function(e,t){app.player.sfRankByType("pvp",function(a,i){a&&t(),app.PVPRANKDATA.pvp=i,i&&(app.PVPRANKDATA.pvp.time=Date.now()),e()})})]})})},a.kingpvpState=function(){var e=app.pages.kingpvppage.getKingPvpState(),t=e.state,a=e.totalTime,i=localDataUtils.GetValue("kingpvptime",0);return 0==t&&a>0&&app.player.level>=22&&(!i||i<app.player.getServerTime())},a.wangpvpState=function(){if(!app.wangPvpInfo)return!1;var e=localDataUtils.GetValue("wangpvptime",null);return app.player.level>=22&&!(app.wangPvpInfo&&app.wangPvpInfo.groupdata&&app.wangPvpInfo.groupdata.length>0)&&app.wangPvpInfo.time-app.player.getServerTime()>0&&(!e||e<app.player.getServerTime())},a.refreshKingRed=function(){return 0===app.player.getCount(96001)},a.refreshWangRed=function(){return 0===app.player.getCount(96002)},a.showPage=function(t,a,i){var n=this;app.PVPOPENTIME?e("basePage").showPage.call(this,t,a,i):app.player.sfPvpOpentime(function(r,o){app.PVPOPENTIME=o,e("basePage").showPage.call(n,t,a,i)})},a.prefabPath="advancenoticepage",r([h(cc.Node)],a.prototype,"p_top",void 0),r([h(cc.Sprite)],a.prototype,"sprBg",void 0),r([h(cc.Sprite)],a.prototype,"sprName",void 0),r([h(cc.Sprite)],a.prototype,"sprTitle",void 0),r([h(cc.Node)],a.prototype,"sprGoTo",void 0),r([h(cc.Node)],a.prototype,"p_menu",void 0),r([h(cc.Node)],a.prototype,"p_richText",void 0),r([h(cc.Node)],a.prototype,"p_infoParent",void 0),r([h(cc.Node)],a.prototype,"p_playMode",void 0),r([h(cc.Node)],a.prototype,"p_playParent",void 0),r([h(cc.Node)],a.prototype,"p_propItem",void 0),r([h(cc.Label)],a.prototype,"p_labelTime",void 0),p=r([c],a)}(l);t.exports=g,cc._RF.pop()},{basePage:void 0}],ancientFieldPage:[function(e,t){"use strict";cc._RF.push(t,"58770zJMUFNiazE9evL+zYs","ancientFieldPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"ancientfieldpage"},properties:{p_btnQ:cc.Button,p_btnShop:cc.Button,p_btnRank:cc.Button,p_labTime:cc.Label,p_arrNodeField:[cc.Node],p_labLv:cc.Label,p_nodeLvRewardContent:cc.Node,p_pfbReward:cc.Prefab,p_sprChoose:cc.Sprite,p_sprTxSt:cc.Sprite,p_spEff:sp.Skeleton},onLoad:function(){this._super(),a.instance=this,this.fitTopMenu(),this.p_btnShop.node.active=!1,this.schedule(this.refreshTime,1),this.m_arrNodeReward=[]},onEnable:function(){eventMgr.on(eventStr.ancient.FIELD_PAGE_LOGIC,this.doAfterBattle,this)},onDisable:function(){eventMgr.off(eventStr.ancient.FIELD_PAGE_LOGIC,this.doAfterBattle,this)},handleUI:function(){var e=this;this._super(),this.p_btnQ.node.on("click",function(){app.playSound("click"),app.pages.windowspagetipshelp.showPage(1109)}),this.p_btnRank.node.on("click",function(){app.playSound("click"),app.pages.ancientrankpage.showPage()}),this.p_arrNodeField.forEach(function(t,a){t.on("touchend",function(){app.playSound("click"),e.onClickField(a)}),t.getChildByName("open").on("touchend",function(t){e.onClickBox(a,!0),t.stopPropagation()}),t.getChildByName("close").on("touchend",function(t){e.onClickBox(a,!1),t.stopPropagation()})})},setParam:function(){app.cacheAncientFieldInfo&&app.cacheAncientFieldInfo.etime>Date.now()?this.refreshUI():this.sfAncientFieldInfo()},sfAncientFieldInfo:function(){var e=this;app.player.sfAncientInfo(function(t,a){cc.log(t,a),t?app.showNotice(t):a.subindex?(app.cacheAncientFieldInfo=a,app.cacheAncientFieldInfo.pass&&(app.cacheAncientFieldInfo.subindex+=1e3),app.cacheAncientFieldInfo.lv=Math.floor(app.cacheAncientFieldInfo.subindex/1e6),app.cacheAncientFieldInfo.fieldId=Math.floor(app.cacheAncientFieldInfo.subindex/1e3)%1e3,app.cacheAncientFieldInfo.mapId=app.cacheAncientFieldInfo.subindex%1e3,app.cacheAncientFieldInfo.maxindex=app.cacheAncientFieldInfo.maxindex||0,app.cacheAncientFieldInfo.maxLv=Math.floor(app.cacheAncientFieldInfo.maxindex/1e6),app.cacheAncientFieldInfo.maxFieldId=Math.floor(app.cacheAncientFieldInfo.maxindex/1e3)%1e3,app.cacheAncientFieldInfo.maxMapId=app.cacheAncientFieldInfo.maxindex%1e3,e.refreshUI()):app.showNotice("\u6570\u636e\u51fa\u9519\uff0c\u8bf7\u9000\u51fa\u91cd\u8bd5\uff5e")})},refreshUI:function(){localDataUtils.SetValue("ancientFieldRed",1,app.cacheAncientFieldInfo.etime),app.pages.ancientfirsttimespage.showPage(),this.refreshTime(),this.refreshRewardInfo(),this.refreshLvInfo(),this.refreshFieldInfo()},refreshTime:function(){if(app.cacheAncientFieldInfo){var e=app.player.getServerTime();this.p_labTime.string=gUtils.getCountDownStr(app.cacheAncientFieldInfo.etime-e)}},refreshRewardInfo:function(){for(var e=app.cacheAncientFieldInfo.lvreward||[],t=0;t<e.length;++t){var a=this.m_arrNodeReward[t];a||((a=cc.instantiate(this.p_pfbReward)).parent=this.p_nodeLvRewardContent,a.scale=.8,this.m_arrNodeReward.push(a)),a.active=!0,a.getComponent("propItem").initForBag(e[t]),a.getComponent("propItem").setClick(!0),a.getComponent("propItem").setFirstPass(!0),a.getComponent("propItem").setSelect(app.cacheAncientFieldInfo.fieldId>3||app.cacheAncientFieldInfo.maxLv==app.cacheAncientFieldInfo.lv&&app.cacheAncientFieldInfo.maxFieldId>=3&&app.cacheAncientFieldInfo.maxMapId>=8)}},refreshLvInfo:function(){this.p_labLv.string="\u5f53\u524d\u96be\u5ea6\uff1aLV "+app.cacheAncientFieldInfo.lv},refreshFieldInfo:function(){var e;this.p_spEff.node.active=!1;for(var t=0;t<this.p_arrNodeField.length;++t){e=this.p_arrNodeField[t];var a=t+1>app.cacheAncientFieldInfo.fieldId,i=t+1==app.cacheAncientFieldInfo.fieldId,n=t+1<app.cacheAncientFieldInfo.fieldId,r=0;app.cacheAncientFieldInfo.fieldinfo[1e3*app.cacheAncientFieldInfo.lv+t+1]&&(r=app.cacheAncientFieldInfo.fieldinfo[1e3*app.cacheAncientFieldInfo.lv+t+1].debuff[0].id),e.getChildByName("eff_intro").getComponent(cc.Label).string=app.db.dbCard[r]?app.db.dbCard[r].INTRO:"",e.getChildByName("lock").active=a;var o=t+1<app.cacheAncientFieldInfo.fieldId;if(o=o||app.cacheAncientFieldInfo.maxLv>=app.cacheAncientFieldInfo.lv&&(app.cacheAncientFieldInfo.maxFieldId>t+1||app.cacheAncientFieldInfo.maxFieldId==t+1&&app.cacheAncientFieldInfo.maxMapId>=8),e.getChildByName("open").active=o,e.getChildByName("close").active=!o,e.getChildByName("bg_title").active=!a,e.getChildByName("common_city_name").active=i,e.getChildByName("tx_yazhi").active=i,e.getChildByName("eff_intro").active=i,e.getChildByName("node_pass").active=n,e.getChildByName("open").active=i,e.getChildByName("close").active=i,app.setSpriteState(e.getChildByName("tx_hqzc").getComponent(cc.Sprite),a),app.cacheAncientFieldInfo.fieldId==t+1){var s=e.getChildByName("tx_hqzc").position;s.y+=50,this.p_spEff.node.position=this.p_spEff.node.parent.convertToNodeSpaceAR(e.convertToWorldSpaceAR(s)),this.p_spEff.node.active=!0}}},onClickField:function(e){app.cacheAncientFieldInfo&&(e+1>app.cacheAncientFieldInfo.fieldId?app.showNotice("\u8be5\u6218\u573a\u5c1a\u672a\u89e3\u9501"):e+1<app.cacheAncientFieldInfo.fieldId?app.showNotice("\u8be5\u6218\u573a\u5df2\u901a\u5173"):app.pages.ancientmappage.showPage())},onClickBox:function(e,t){var a=1e3*app.cacheAncientFieldInfo.lv+e+1;app.cacheAncientFieldInfo.fieldinfo[a]&&app.cacheAncientFieldInfo.fieldinfo[a].freward&&app.pages.ancientfieldrewardpage.showPage({boolDid:t,arrReward:app.cacheAncientFieldInfo.fieldinfo[a].freward,index:e})},doAfterBattle:function(){if(app.cacheAncientBattleResult){var e=app.cacheAncientFieldInfo.lv;app.cacheAncientFieldInfo=null,this.setParam(),app.cacheAncientBattleResult.lvreward&&app.pages.ancientlvwinpage.showPage({lv:e,arrReward:app.cacheAncientBattleResult.lvreward})}}});a.refreshRed=function(e){var t=!1;return app.db.checkFuncUnLock("ANCIENT_FIELD",!1)&&null==localDataUtils.GetValue("ancientFieldRed",null)&&(t=!0),e&&(e.active=t),t},cc._RF.pop()},{basePage:void 0}],ancientFieldRewardPage:[function(e,t){"use strict";cc._RF.push(t,"b647eWpCZRCYqijU1AMd4wu","ancientFieldRewardPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"ancientfieldrewardpage",pageType:1},properties:{p_sprTitle:cc.Sprite,p_arrSprTitle:[cc.SpriteFrame],p_nodeReward:cc.Prefab,p_nodeRewardContent:cc.Node,p_spWinTitle:sp.Skeleton},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.m_arrNodeReward=[]},setParam:function(e){for(var t=e.arrReward,a=0;a<t.length;++a){var i=this.m_arrNodeReward[a];i||((i=cc.instantiate(this.p_nodeReward)).parent=this.p_nodeRewardContent),i.active=!0,i.getComponent("propItem").initForBag(t[a]),i.getComponent("propItem").setClick(!0),i.getComponent("propItem").setSelect(e.boolDid)}app.playUpgradeAnim({spComp:this.p_spWinTitle,startName:"appear",endName:"loop",index:14,target:this})}});cc._RF.pop()},{basePage:void 0}],ancientFieldWinPage:[function(e,t){"use strict";cc._RF.push(t,"0cbacSfwMhL9bMttc9gAzRB","ancientFieldWinPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"ancientfieldwinpage",pageType:1},properties:{p_sprTitle:cc.Sprite,p_arrSprTitle:[cc.SpriteFrame],p_nodeContent:cc.Node,p_nodeReward:cc.Prefab,p_nodeRewardContent:cc.Node,p_btnSure:cc.Button,p_labLv:cc.Label,p_spWinTitle:sp.Skeleton},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.m_arrNodeReward=[]},handleUI:function(){var e=this;this._super(),this.labAnim(),this.p_btnSure.node.on("click",function(){if(e.m_boolEnableClose&&(e.onClose(),e.m_arrReward&&!(e.m_arrReward.length<=0))){var t={showtype:1,reward:e.m_arrReward};app.pages.windowspagereward.showPage(t)}})},creatMask:function(){var e=this,t=new cc.Node;this.maskNode=t;var a=t.addComponent(cc.Sprite);app.loadTexture(gConfig.getGlobalMaskPath(),a),t.parent=this.node,t.width=cc.winSize.width+100,t.height=cc.winSize.height+100,t.opacity=200,t.color=cc.color(0,0,0),a.sizeMode=cc.Sprite.SizeMode.CUSTOM,t.zIndex=-1,t.on("touchend",function(t){if(t.stopPropagation(),e.m_boolEnableClose&&(e.onClose(),e.m_arrReward&&!(e.m_arrReward.length<=0))){var a={showtype:1,reward:e.m_arrReward};app.pages.windowspagereward.showPage(a)}})},setParam:function(e){this.p_nodeContent.opacity=0,this.m_arrReward=e.arrReward;for(var t=0;t<this.m_arrReward.length;++t){var a=this.m_arrNodeReward[t];a||((a=cc.instantiate(this.p_nodeReward)).parent=this.p_nodeRewardContent),a.active=!0,a.getComponent("propItem").initForBag(this.m_arrReward[t]),a.getComponent("propItem").setClick(!0)}this.p_sprTitle.spriteFrame=this.p_arrSprTitle[e.numIndex-1],this.p_labLv.string="\u5f53\u524d\u96be\u5ea6\uff1aLV "+app.cacheAncientFieldInfo.lv,app.playUpgradeAnim({spComp:this.p_spWinTitle,startName:"appear",endName:"loop",index:4,target:this})},labAnim:function(){this.m_boolEnableClose=!0,this.p_nodeContent.runAction(cc.fadeIn(.7,255))}});cc._RF.pop()},{basePage:void 0}],ancientFirstTimesPage:[function(e,t){"use strict";cc._RF.push(t,"4f8e5F/u0BLZ6P76S0xCpEW","ancientFirstTimesPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"ancientfirsttimespage",pageType:1},properties:{p_labLv:cc.Label,p_btnEnter:cc.Button},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){var e=this;this._super(),this.p_btnEnter.node.on("click",function(){app.playSound("click"),e.onClose()})},setParam:function(){this.p_labLv.string="\u5f53\u524d\u96be\u5ea6\uff1aLv"+app.cacheAncientFieldInfo.lv}});a.showPage=function(){app.cacheAncientFieldInfo&&(localDataUtils.GetValue("OPENED_ANCIENT_PAGE",null)||(localDataUtils.SetValue("OPENED_ANCIENT_PAGE",1,app.cacheAncientFieldInfo.etime),e("basePage").showPage.call(this)))},cc._RF.pop()},{basePage:void 0}],ancientLvWinPage:[function(e,t){"use strict";cc._RF.push(t,"40445H1DghHxJERtklwcdqe","ancientLvWinPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"ancientlvwinpage",pageType:1},properties:{p_nodeContent:cc.Node,p_nodeReward:cc.Prefab,p_nodeRewardContent:cc.Node,p_btnSure:cc.Button,p_labLv:cc.Label,p_labNextLv:cc.Label,p_spWinTitle:sp.Skeleton},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.m_arrNodeReward=[]},handleUI:function(){var e=this;this._super(),this.labAnim(),this.p_btnSure.node.on("click",function(){if(e.m_arrReward&&!(e.m_arrReward.length<=0)){e.onClose();var t={showtype:1,reward:e.m_arrReward};app.pages.windowspagereward.showPage(t)}})},setParam:function(e){this.p_labLv.string="\u96be\u5ea6\uff1aLV"+e.lv,this.p_labNextLv.string="\u96be\u5ea6\uff1aLV"+(e.lv+1),this.m_arrReward=e.arrReward,this.p_nodeContent.opacity=0;for(var t=0;t<this.m_arrReward.length;++t){var a=this.m_arrNodeReward[t];a||((a=cc.instantiate(this.p_nodeReward)).parent=this.p_nodeRewardContent),a.active=!0,a.getComponent("propItem").initForBag(this.m_arrReward[t]),a.getComponent("propItem").setClick(!0)}app.playUpgradeAnim({spComp:this.p_spWinTitle,startName:"appear",endName:"loop",index:4,target:this})},labAnim:function(){this.m_boolEnableClose=!0,this.p_nodeContent.runAction(cc.fadeIn(.7,255))},onClose:function(){this._super()}});cc._RF.pop()},{basePage:void 0}],ancientMapInfoPage:[function(e,t){"use strict";cc._RF.push(t,"0769co+9CJMkZ5CzmrBSE6u","ancientMapInfoPage");var a=e("../db/dbUtils"),i=cc.Class({extends:e("basePage"),statics:{prefabPath:"ancientmapinfopage",pageType:1},properties:{p_labReward:cc.Label,p_nodeReward:cc.Node,p_nodeRewardContent:cc.Node,p_nodeGeneral:cc.Node,p_nodeGeneralContent:cc.Node,p_btnBattle:cc.Button,p_powerNode:cc.Node,p_powerPfb:cc.Prefab},onLoad:function(){i.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.creatMask(!0),this.m_powernode=null,this.m_arrRewardItem=[this.p_nodeReward],this.m_arrGeneralItem=[this.p_nodeGeneral],this.p_nodeReward.active=!1,this.p_nodeGeneral.active=!1},handleUI:function(){var e=this;this._super(),this.p_btnBattle.node.on("click",function(){app.playSound("click"),cc.log("\u6218\u6597\u6218\u6597\u6218\u6597"),app.battleType="ancient";var t=Math.floor(app.cacheAncientFieldInfo.subindex/1e3),a=app.cacheAncientFieldInfo.fieldinfo[t];app.rightCards=[],a&&a.debuff&&(app.rightCards=a.debuff),app.subIndex=app.cacheAncientFieldInfo.subindex,app.battleConfig=app.cacheAncientMapInfo.bset,e.onClose(),app.goToNormBattle()})},setParam:function(){var e=this;app.cacheAncientMapInfo&&app.cacheAncientMapInfo.index==app.cacheAncientFieldInfo.subindex?this.refreshUI():app.player.sfAncientMapInfo(app.cacheAncientFieldInfo.subindex,function(t,a){t?app.showNotice(t):(app.cacheAncientMapInfo=a,e.refreshUI())})},refreshUI:function(){if(app.cacheAncientMapInfo){var e=app.cacheAncientMapInfo;cc.log(e);var t=e.firstrewards,i="\u9996\u901a\u5956\u52b1";app.cacheAncientFieldInfo.subindex<=app.cacheAncientFieldInfo.maxindex&&(t=e.rewards,i="\u51fb\u8d25\u5956\u52b1"),this.p_labReward.string=i;for(var n=0;n<t.length;++n){var r=this.m_arrRewardItem[n];r||((r=cc.instantiate(this.p_nodeReward)).parent=this.p_nodeRewardContent),r.active=!0,r.getComponent("propItem").initForBag(t[n]),r.getComponent("propItem").setClick(!0)}var o=0;for(var s in e.bset){var p=this.m_arrGeneralItem[o];p||((p=cc.instantiate(this.p_nodeGeneral)).parent=this.p_nodeGeneralContent),p.active=!0,p.getComponent("generalPortraitItem").refreshForAncient(e.bset[s]),++o}this.m_powernode||(this.m_powernode=cc.instantiate(this.p_powerPfb),this.m_powernode.parent=this.p_powerNode,this.m_powernode.setPosition(cc.Vec2.ZERO)),this.m_powernode.getComponent("PowerDisplay").init({val:a.getPveProperInfo(e.bset).power})}}});cc._RF.pop()},{"../db/dbUtils":void 0,basePage:void 0}],ancientMapPage:[function(e,t){"use strict";cc._RF.push(t,"094a4frt59NkKYlEnJtnwG7","ancientMapPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"ancientmappage"},properties:{p_btnQ:cc.Button,p_labTime:cc.Label,p_labEff:cc.Label,p_nodeMap:cc.Node,p_prefab:cc.Prefab,p_content:cc.Node,p_nodeReward:cc.Node,p_nodeLvRewardContent:cc.Node,p_labLv:cc.Label},onLoad:function(){this._super(),a.instance=this,this.fitTopMenu(),this.schedule(this.refreshTime,1),this.m_arrItem=[]},handleUI:function(){var e=this;this._super(),this.p_btnQ.node.on("click",function(){app.playSound("click"),app.pages.windowspagetipshelp.showPage(1109)}),this.p_nodeMap.on("touchmove",function(t){e.moveMapByTouch(t),t.stopPropagation()}),this.p_nodeMap.on("touchend",function(t){e.m_boolMovIng=!1,t.stopPropagation()})},onEnable:function(){app.cacheAncientBattleResult=null,eventMgr.on(eventStr.ancient.MAP_PAGE_LOGIC,this.doAfterBattle,this)},onDisable:function(){eventMgr.off(eventStr.ancient.MAP_PAGE_LOGIC,this.doAfterBattle,this)},setParam:function(){var e=this;app.cacheAncientMapInfo&&app.cacheAncientMapInfo.index==app.cacheAncientFieldInfo.subindex?this.refreshUI():app.player.sfAncientMapInfo(app.cacheAncientFieldInfo.subindex,function(t,a){t?app.showNotice(t):(app.cacheAncientMapInfo=a,e.refreshUI())})},refreshUI:function(){this.refreshTime(),this.refreshMapInfo(),this.refreshLvInfo(),this.refreshRewardInfo()},refreshTime:function(){if(app.cacheAncientFieldInfo){var e=app.player.getServerTime();this.p_labTime.string=gUtils.getCountDownStr(app.cacheAncientFieldInfo.etime-e)}},moveMapByTouch:function(e){if(e.getLocation&&!(Math.abs(e.getLocation().y-e.getStartLocation().y)<=6)){this.m_boolMovIng=!0;var t=this.p_nodeMap.y,a=e.getDelta(),i=this.p_nodeMap.height/2-cc.winSize.height/2,n=-this.p_nodeMap.height/2+cc.winSize.height/2;t+=a.y,t=Math.min(i,t),t=Math.max(n,t),this.p_nodeMap.y=t}},refreshRewardInfo:function(){var e=Math.floor(app.cacheAncientFieldInfo.subindex/1e3),t=app.cacheAncientFieldInfo.fieldinfo[e];if(t){this.p_labEff.string=app.db.dbCard[t.debuff[0].id]?app.db.dbCard[t.debuff[0].id].INTRO:"";var a=t.freward||[];this.m_arrNodeReward=this.m_arrNodeReward||[this.p_nodeReward];for(var i=0;i<a.length;++i){var n=this.m_arrNodeReward[i];n||((n=cc.instantiate(this.p_nodeReward)).parent=this.p_nodeLvRewardContent,this.m_arrNodeReward.push(n)),n.active=!0,n.getComponent("propItem").initForBag(a[i]),n.getComponent("propItem").setClick(!0),n.getComponent("propItem").setFirstPass(!0);var r=app.cacheAncientFieldInfo.maxLv>=app.cacheAncientFieldInfo.lv;r=r&&(app.cacheAncientFieldInfo.maxFieldId==app.cacheAncientFieldInfo.fieldId&&app.cacheAncientFieldInfo.maxMapId>=8||app.cacheAncientFieldInfo.maxFieldId>app.cacheAncientFieldInfo.fieldId),n.getComponent("propItem").setSelect(app.cacheAncientFieldInfo.mapId>8||r)}}else cc.error("\u4fe1\u606f\u51fa\u95190001")},refreshMapInfo:function(){var e=this.p_nodeMap.height/2-cc.winSize.height/2,t=-this.p_nodeMap.height/2+cc.winSize.height/2;this.p_nodeMap.y=app.cacheAncientFieldInfo.mapId>4?t:e;for(var a=[{x:-140,y:-470},{x:150,y:-335},{x:-135,y:-185},{x:155,y:-20},{x:-140,y:95},{x:152,y:284},{x:-150,y:450},{x:135,y:560}],i=0;i<8;i++){var n=this.m_arrItem[i];n||((n=cc.instantiate(this.p_prefab)).parent=this.p_content,n.x=a[i].x,n.y=a[i].y,this.m_arrItem[i]=n),n.active=!0,n.getComponent("ancientMapItem").init(i)}},refreshLvInfo:function(){this.p_labLv.string="\u5f53\u524d\u96be\u5ea6\uff1aLV "+app.cacheAncientFieldInfo.lv},doAfterBattle:function(){if(app.cacheAncientBattleResult){app.cacheAncientMapInfo=null;var e=app.cacheAncientFieldInfo.fieldId;app.cacheAncientFieldInfo.subindex+=1,app.cacheAncientFieldInfo.mapId+=1,app.cacheAncientBattleResult.fieldreward?(this.refreshUI(),app.pages.ancientfieldwinpage.showPage({numIndex:e,arrReward:app.cacheAncientBattleResult.fieldreward})):this.setParam()}},onClose:function(){this._super(),app.cacheAncientBattleResult&&app.cacheAncientBattleResult.result&&"lose"!=app.cacheAncientBattleResult.result.ret&&eventMgr.emit(eventStr.ancient.FIELD_PAGE_LOGIC)}});cc._RF.pop()},{basePage:void 0}],ancientRankPage:[function(e,t){"use strict";cc._RF.push(t,"b024br+fBVAb6WGc4dDUcAC","ancientRankPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"ancientrankpage"},properties:{p_nodeView:cc.Node,p_nodeSelf:cc.Node},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!1),this.fitTopMenu(),this.handleUI()},setParam:function(){var e=this;app.player.sfRankByType("yuangu",function(t,a){cc.isValid(e.node)&&(t?app.showNotice(t):(e.m_objData=a,e.refreshUI()))})},refreshUI:function(){if(this.m_objData){var e=this.m_objData.list||[];this.p_nodeView.getComponent("tableView").initTableView(Math.min(100,e.length),{array:e,target:this});var t={rname:app.player.rname,power:app.player.power,iconid:app.player.iconid,headid:app.player.headid,frameid:app.player.frameid,score:this.m_objData.selfscore};this.p_nodeSelf.getComponent("ancientRanktabvItem").refreshUI(this.m_objData.selfrank,t)}}});cc._RF.pop()},{basePage:void 0}],autoBattleResultPage:[function(e,t){"use strict";cc._RF.push(t,"4bf76eBDSxLs4LnCVIeMSC6","autoBattleResultPage");var a=[38006,30001,38001],i=cc.Class({extends:e("basePage"),statics:{prefabPath:"autobattleresultpage",pageType:1,createShot:!0},properties:{p_labTime:cc.Label,p_nodeView:cc.Node,rewardLabels:[cc.Label],btnGet:cc.Node,p_spIconArr:[cc.Sprite]},onLoad:function(){var e=this;i.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.m_arrReward=[],app.playSound("reward"),this.p_spIconArr.forEach(function(t,i){app.loadTexture(gConfig.getCurrencyIconPath(a[i]),t,e.prefabPath)})},handleUI:function(){this._super()},setParam:function(e){var t=this;this._data=e.data,this._oldlv=e.oldlv,this._oldexp=e.oldexp,this._last=e.last,this._config=e.config,this.refreshUI(),this.btnGet.on("click",function(){app.playSound("click"),t.onClose()},this)},refreshUI:function(){var e=this,t=gUtils.getHourMinSecTime(this._last/1e3);this.p_labTime.string=t;var i=this._data.length;this._data.map(function(t,i){var n=a.indexOf(t.GSID);if("number"==typeof n&&e._data[n]){var r=[e._data[n],e._data[i]];e._data[i]=r[0],e._data[n]=r[1]}}),this.p_nodeView.getComponent("tableView").initTableView(i,{array:this._data,target:this});var n=["38006","30001","38001"];this.rewardLabels.forEach(function(t,a){t.string=langMgr.getString("autoBattleResultPage",0,e._config[n[a]])})},onClose:function(){this._super();var e=this._oldlv;e<app.player.level?setTimeout(function(){app.pages.windowspageplayerlvup.showPage(e)},1e3):(cc.director.dispatchEvent(new cc.Event.EventCustom("close_hang_reward",!0)),cc.director.emit("show_hang_reward_end")),app.playSound("campaigncollect");var t=app.mainScene.p_arrNodeCoin[0],a=app.mainScene.p_btnPropBag.node,i=app.mainScene.p_barLv.node;this.p_nodeView.getComponent("tableView").getCells(function(e){e.filter(function(e){return cc.Node.isNode(e)}).map(function(e){var n=e.getComponent("hangTabvItem");if(cc.isValid(n)){var r=n.m_arrData,o=n.m_numIndex;if(void 0!==r){var s,p,c;switch(r[o].GSID){case 38001:if(s=i,c=n.p_nodeItem.getComponent("propItem"),!cc.isValid(c)||!cc.isValid(c.p_sprIcon))return;p=c.p_sprIcon.node;break;case 38006:if(s=t,c=n.p_nodeItem.getComponent("propItem"),!cc.isValid(c)||!cc.isValid(c.p_sprIcon))return;p=c.p_sprIcon.node;break;default:s=a,p=e}var h=e.addComponent("nodeFlyToWallet"),l=p,g=s,d=s;h.init(p,l,g,d),h.playAnim(5,50)}}})})}});cc._RF.pop()},{basePage:void 0}],battleEnemyInfoPage:[function(e,t){"use strict";cc._RF.push(t,"64389zOwhhJMoedrwDUfRCo","battleEnemyInfoPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"battleenemyinfopage"},properties:{p_nodeSelfInfo:cc.Node,p_nodeEnemyInfo:cc.Node,p_arrSelfLineupBg:[cc.Node],p_arrSelfLineup:[cc.Node],p_arrEnemyLineup:[cc.Node],p_labTime:cc.Label,p_btnRematch:cc.Button,p_btnFight:cc.Button},onLoad:function(){var e=this;a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this._bSwap=!1,this._bSwaped=!1,this._swpLineupIndex=0,this.p_arrSelfLineupBg.forEach(function(t,a){t.lineupNode=e.p_arrSelfLineup[a],e.p_arrSelfLineup[a].teamorder=a+1}),this._rematchCd=9e5,this.rmCdCb=function(){this.refreshTime(),this._timeLeftSec<=0&&(this.unschedule(this.rmCdCb),this.p_labTime.node.active=!1,this.p_btnRematch.interactable=!0)}},handleUI:function(){var e=this;this._super(),this.p_btnRematch.node.on("click",function(){app.playSound("click"),e.m_isMove||(e._kingpvpPage.matchEnemy(1),e.onClose())}),this.p_btnFight.node.on("click",function(){if(app.playSound("click"),!e.m_isMove)if(e.checkLineupEmpty()){var t={content:langMgr.getString("battleEnemyInfoPage",2),confirmcb:function(){e.btnFightOnTouch()},target:e};app.pages.windowspagetipsmsg.showPage(t,e.node)}else e.btnFightOnTouch()}),this.p_arrSelfLineup.forEach(function(t,a){t.on("touchstart",function(t){e._moving&&e._moving!=a+1||(e._moving=a+1,t.stopPropagation())}),t.on("touchmove",function(i){e._moving&&e._moving!=a+1||(e.moveLineupByTouch(t,i),i.stopPropagation())}),t.on("touchend",function(i){e._moving&&e._moving!=a+1||(e.moveLineupEnd(t,i),e._moving=0,i.stopPropagation())}),t.on("touchcancel",function(i){e._moving&&e._moving!=a+1||(e.moveLineupEnd(t,i),e._moving=0,i.stopPropagation())})})},checkLineupEmpty:function(){for(var e=!1,t=0;t<this._selfLineupNum;++t)e=e||app.player.isLineupEmpty(app.kpResonanceLineup[gConfig.KPLINEUP[t]]);return e},btnFightOnTouch:function(){var e=this;app.player.getCount(30028)<2?app.showNotice(langMgr.getString("battleEnemyInfoPage",0)):app.player.getCount(90335)<=0?app.player.sfExchange("kingpvp_fight_cost",1,0,function(){e.startFight()}):this.startFight()},startFight:function(){var e=this;app.pages.quickbattleloadpage.showPage({type:"start"});var t={target:this._enemyInfo.rid};app.player.sfKpStart(t,function(t,a){if(t)return app.pages.quickbattleloadpage.instance.onClose(),void app.showNotice(t);app.player.sfPlayerByParam(["others"],function(){app.pages.quickbattleloadpage.instance.setOver(function(){var t={uid:app.player.uid,servid:app.player.servid};app.player.sfKpStageInfo(t,function(t,a){if(cc.isValid(e))if(t)app.showNotice(t);else{app.KPSTAGEINFO=a;var i=app.pages.kingpvppage.instance;i._myStageInfo=a,i.refreshMyRankInfo(),i.refreshUI();var n=app.pages.pvpentrancepage.instance,r=gConfig.PVPSYSTEM.indexOf("king");n.p_nodePvpSystem[r].getComponent("pvpEntranceItem").refreshUI(gConfig.PVPSYSTEM[r],a)}}),e.onClose(),app.kpMatchData=null,a.leftInfo=e._playerInfo,a.rightInfo=e._enemyInfo,a.pageFrom="fight",app.pages.kingpvpfightresultpage.showPage(a)})})})},moveLineupByTouch:function(e,t){if(t.getLocation&&!(Math.abs(t.getLocation().x-t.getStartLocation().x)<=6&&Math.abs(t.getLocation().y-t.getStartLocation().y)<=6)){if(!this.m_isMove){var a=e.convertToWorldSpaceAR(cc.Vec2.ZERO);e.setParent(cc.director.getScene()),e.setPosition(a);var i=e.getChildByName("choosen_bg_green");i.stopAllActions();var n=cc.sequence(cc.fadeOut(.8),cc.fadeIn(.8));i.runAction(cc.repeatForever(n))}this.m_isMove=!0;var r=t.getDelta();e.x+=r.x,e.y+=r.y,this.nodeOthers=[];for(var o=0;o<this._selfLineupNum;++o)e!=this.p_arrSelfLineupBg[o].lineupNode?this.p_arrSelfLineupBg[o].active&&this.nodeOthers.push(this.p_arrSelfLineupBg[o]):this._moveBaseParent=this.p_arrSelfLineupBg[o];this.checkInArea(e,this.nodeOthers),this._bSwap&&!this._bSwaped&&(this.p_arrSelfLineup[this._swpLineupIndex].setParent(this.p_arrSelfLineupBg[e.index]),this.swapLineup(this._swpLineupIndex,e.index),this._bSwaped=!0),!this._bSwap&&this._bSwaped&&(this.p_arrSelfLineup[this._swpLineupIndex].setParent(this.p_arrSelfLineupBg[this.p_arrSelfLineup[this._swpLineupIndex].index]),this.swapLineup(this._swpLineupIndex,e.index),this._bSwaped=!1)}},moveLineupEnd:function(e){var t=this;if(this.m_isMove){this.m_isMove=!1;var a=e.getChildByName("choosen_bg_green");a.stopAllActions(),a.opacity=255;var i=!1,n=null;this.nodeOthers.forEach(function(e){e.bSwap&&(i=!0,n=e),e.lineupNode.setParent(e.bSwap?t._moveBaseParent:e)}),i?(e.setParent(n),e.setPosition(cc.Vec2.ZERO)):(e.setParent(this._moveBaseParent),e.setPosition(cc.Vec2.ZERO)),this.p_arrSelfLineupBg.forEach(function(e){e.lineupNode=e.getChildByName("node_lineup")}),i&&this.swapOrder()}},checkInArea:function(e,t){for(var a=e.convertToWorldSpaceAR(cc.Vec2.ZERO),i=0;i<t.length;++i){var n=t[i].convertToWorldSpaceAR(cc.Vec2.ZERO),r=!1;Math.abs(n.x-a.x)<t[i].width/2&&Math.abs(n.y-a.y)<t[i].height/2&&(r=!0),this.swapNode(r,t[i])}},swapNode:function(e,t){!t.bSwap&&e&&(t.lineupNode.setParent(this._moveBaseParent),t.bSwap=!0),t.bSwap&&!e&&(t.lineupNode.setParent(t),t.bSwap=!1)},swapOrder:function(){for(var e=this,t=[],a=0;a<this._selfLineupNum;++a)this.p_arrSelfLineupBg[a].active&&t.push(this.p_arrSelfLineupBg[a].lineupNode.teamorder);var i={teamorder:t};app.player.sfKpSwitchOrder(i,function(a){if(a)app.showNotice(a);else{e.p_arrSelfLineupBg.forEach(function(t,a){t.lineupNode.teamorder=a+1,e.p_arrSelfLineup[a]=t.lineupNode});var i=[],n=[];t.forEach(function(e){i.push(app.kpResonanceLineup[gConfig.KPLINEUP[e-1]]),n.push(gUtils.deepClone(app.player.battlearr[gConfig.KPLINEUP[e-1]]))});for(var r=0;r<e._selfLineupNum;++r)e.p_arrSelfLineupBg[r].active&&(app.kpResonanceLineup[gConfig.KPLINEUP[r]]=i[r],app.player.battlearr[gConfig.KPLINEUP[r]]=n[r]);e._kingpvpPage.refreshMyRankInfo()}})},setParam:function(e){this._playerInfo=e.playerInfo,this._enemyInfo=e.enemyInfo,this._bPromotion=e.bPromotion,this._kingpvpPage=e.target,this.refreshUI()},refreshUI:function(){if(this._playerInfo&&this._enemyInfo){this.p_arrSelfLineupBg.forEach(function(e,t){e.active=!app.player.isLineupEmpty(app.kpResonanceLineup[gConfig.KPLINEUP[t]])}),this.p_nodeSelfInfo.getComponent("playerPortraitItem").refreshUI(this._playerInfo,this),this.p_nodeEnemyInfo.getComponent("playerPortraitItem").refreshUI(this._enemyInfo,this);var e=parseInt(String(this._playerInfo.stage).charAt(0));this._selfLineupNum=app.db.getKingLineupNum(e);for(var t=parseInt(String(this._enemyInfo.stage).charAt(0)),a=app.db.getKingLineupNum(t),i=0;i<this.p_arrSelfLineup.length;++i)this.p_arrSelfLineup[i].getComponent("battleLineupItem").refreshUI(app.kpResonanceLineup[gConfig.KPLINEUP[i]]?app.kpResonanceLineup[gConfig.KPLINEUP[i]].team:null,!1,i>=this._selfLineupNum,this);for(var n=0;n<this.p_arrEnemyLineup.length;++n)this.p_arrEnemyLineup[n].getComponent("battleLineupItem").refreshUI(this._enemyInfo.battleset[n]?this._enemyInfo.battleset[n].team:null,n==a-1&&a>1,n>=a,1==this._enemyInfo.hide,this);this._bPromotion?(this.p_labTime.node.active=!1,this.p_btnRematch.interactable=!1):(new Date(app.player.getServerTime()).getTime()-this._enemyInfo.time)/1e3/60>=15?(this.p_labTime.node.active=!1,this.p_btnRematch.interactable=!0):(this.p_labTime.node.active=!0,this.p_btnRematch.interactable=!1,this.schedule(this.rmCdCb,1),this.refreshTime())}else app.showNotice(langMgr.getString("battleEnemyInfoPage",1))},refreshTime:function(){var e=new Date(app.player.getServerTime());this._timeLeftSec=(this._rematchCd-(e.getTime()-this._enemyInfo.time))/1e3,this.p_labTime.string=gUtils.getHourMinSecTime(this._timeLeftSec)}});cc._RF.pop()},{basePage:void 0}],battleLoseNormPage:[function(e,t){"use strict";cc._RF.push(t,"22b55n8PNFMO5+CwxdzpSQN","battleLoseNormPage");var a=cc.Class({extends:e("baseBattleResult"),statics:{prefabPath:"battlelosenormpage"},properties:{p_arrNode_Special:[cc.Node],p_skeAnim:sp.Skeleton},onLoad:function(){var e=this;a.instance=this,this._super(),app.playMusic("battlelose",!1),this.refreshByPgts(),this.p_skeAnim.setCompleteListener(function(){e.p_skeAnim.setAnimation(0,"effect2",!0)}),this.p_skeAnim.setAnimation(0,"effect1",!1)},onClose:function(){var e=this;this._super(),this.refreshPlayerDataLoseByType(function(){e.refereshPageClose()},function(){e.refreshNormClose()},function(){e._close=!1}),app.showRecommendGift()},refreshByPgts:function(){this.p_arrNode_Special.forEach(function(e){e.active=gSetting.checkReviewServ()})}});cc._RF.pop()},{baseBattleResult:void 0}],battleLosePvpPage:[function(e,t){"use strict";var a;cc._RF.push(t,"657dapG3XJB4bfITqFUC4/X","battleLosePvpPage");var i=cc.Class({extends:e("baseBattleResult"),statics:{prefabPath:"battlelosepvppage"},properties:(a={p_sprUp:cc.Sprite,p_labUpName:cc.Label,p_labUpLevel:cc.Label,p_labUpScore:cc.Label},a.p_sprUp=cc.Sprite,a.p_labUpCscore=cc.Label,a.p_sprUpStar=cc.Sprite,a.p_sprUpBadge=cc.Sprite,a.p_sprDown=cc.Sprite,a.p_labDwName=cc.Label,a.p_labDwLevel=cc.Label,a.p_labDownSco=cc.Label,a.p_sprDown=cc.Sprite,a.p_labDownCsco=cc.Label,a.p_sprDownStar=cc.Sprite,a.p_sprDownBadge=cc.Sprite,a),onLoad:function(){i.instance=this,this._super(),app.playMusic("battlelose",!1)},setParam:function(e){this._super(e),this.refreshPvp(e.pinfo)},refreshPvp:function(e){var t=app.db.getGHeadIconByGsid(e.left.iconid);app.loadTexture(t,this.p_sprUp,this.prefabPath),this.p_labUpName.string=e.left.rname,this.p_labUpLevel.string=e.left.level,this.p_labUpScore.string=e.left.points,this.p_labUpCscore.string=e.left.cpoints,this.p_labUpScore.node.active=!!e.left.points,this.p_labUpCscore.node.active=!!e.left.cpoints,t=app.db.getGHeadIconByGsid(e.right.iconid),app.loadTexture(t,this.p_sprDown,this.prefabPath),this.p_labDwName.string=e.right.rname,this.p_labDwLevel.string=e.right.level,this.p_labDownSco.string=e.right.points,this.p_labDownCsco.string=e.right.cpoints,this.p_labDownSco.node.active=!!e.right.points,this.p_labDownCsco.node.active=!!e.right.cpoints,this.p_sprDownStar.node.active=!1},onClose:function(){var e=this;this._super(),this.refreshPlayerDataLoseByType(function(){e.refereshPageClose()},function(){e.refreshNormClose()},function(){e._close=!1}),app.showRecommendGift()}});cc._RF.pop()},{baseBattleResult:void 0}],battleReadyDetailPage:[function(e,t){"use strict";cc._RF.push(t,"78f04CO7YVAj57eskg2XM0c","battleReadyDetailPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"battlereadydetailpage"},properties:{p_srcView:cc.ScrollView,p_pfbItem:cc.Prefab,p_nodeItem:cc.Node,p_nodeSucc:cc.Node,p_arrIntro:[cc.Label],p_sprNow:cc.Sprite,p_labNum:cc.Label,p_labName:cc.Label},onLoad:function(){var e=this;a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0,180),this.handleUI(),this.m_arrItem=[],this.m_arrItem.push(this.p_nodeItem),this.p_nodeItem.on("touchend",function(){e.refreshIntro(e.p_nodeItem.nIndex)})},setParam:function(e){this._fetters=gUtils.deepClone(e),this.refreshUI()},refreshUI:function(){var e=this;this._fetters.sort(function(e,t){return t.level>e.level?1:t.level==e.level?0:-1});for(var t=function(t){var a=e.m_arrItem[t];a||((a=cc.instantiate(e.p_nodeItem)).parent=e.p_nodeItem.parent,a.on("touchend",function(){e.refreshIntro(a.nIndex)}),e.m_arrItem.push(a)),a.nIndex=t;var i=app.db.getFetterInfoById(e._fetters[t].fid);app.loadTexture(gConfig.rootPath.uiiconportrait+i.IMAGE,a.getChildByName("icon").getComponent(cc.Sprite),e.prefabPath),app.setSpriteState(a.getChildByName("icon").getComponent(cc.Sprite),e._fetters[t].level<=0)},a=0;a<this._fetters.length;++a)t(a);for(var i=this._fetters.length;i<this.m_arrItem.length;++i)this.m_arrItem[i].active=!1;this.refreshIntro(0)},refreshIntro:function(e){for(var t=0;t<this.m_arrItem.length;++t)this.m_arrItem[t].getChildByName("dizuo").active=t==e;var a=this._fetters[e],i=app.db.getFetterInfoById(a.fid);app.loadTexture(gConfig.rootPath.uiiconportrait+i.IMAGE,this.p_sprNow,this.prefabPath),this.p_nodeSucc.active=a.level>=1;var n=gConfig.FetterF[a.camp]||gConfig.FetterO[a.occu];this.p_labNum.string=a.num+"/"+a.need,this.p_labName.string=i.NAME,this.p_arrIntro.forEach(function(e){e.node.active=!1});for(var r=0;r<n.length;++r){r+1==a.level?this.p_arrIntro[r].node.color=cc.color(250,112,0):this.p_arrIntro[r].node.color=cc.color(144,133,126);var o=app.db.getFetterInfoById(n[r].sid);this.p_arrIntro[r].node.active=!0,this.p_arrIntro[r].string="("+n[r].need+")"+o.INTRO}}});cc._RF.pop()},{basePage:void 0}],battleReadyEnemyPage:[function(e,t){"use strict";cc._RF.push(t,"14459SOjxJMIYWTkXwpaTv1","battleReadyEnemyPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"battlereadyenemypage"},properties:{p_pfbItem:cc.Prefab},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){this._super()},setParam:function(e){this.refreshUI(e)},refreshUI:function(){}});cc._RF.pop()},{basePage:void 0}],battleReadyFormPage:[function(e,t){"use strict";cc._RF.push(t,"16eb6Jack1KZJn3MMzDxcSG","battleReadyFormPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"battlereadyformpage"},properties:{p_arrForm:[cc.Node],p_btnSure:cc.Button},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){var e=this;this._super(),this.p_btnSure.node.on("click",function(){app.playSound("click"),app.pages.battlereadypage.instance.quickForm(e.m_nIndex),e.onClose()});for(var t=function(t){e.p_arrForm[t].on("touchend",function(){t!=e.m_nIndex&&(e.m_nIndex>=0&&(e.p_arrForm[e.m_nIndex].getChildByName("picked").active=!1),e.m_nIndex=t,e.p_arrForm[t].getChildByName("picked").active=!0)})},a=0;a<this.p_arrForm.length;++a)t(a)},setParam:function(){this.m_nIndex=-1,this.refreshUI()},refreshUI:function(){for(var e=0;e<this.p_arrForm.length;++e)this.p_arrForm[e].getChildByName("picked").active=!1}});cc._RF.pop()},{basePage:void 0}],battleReadyPage:[function(e,t){"use strict";cc._RF.push(t,"c3b1fsFd3xFjqcz2+r6MMLB","battleReadyPage");var a=[1,2,3,4,5,6,9,10,11,12,13,14,17,18,19,20,21,22,25,26,27,28,29,30],i=[4,3,5,2,12,11,13,10,20,19],n=cc.Class({extends:e("basePage"),statics:{prefabPath:"battlereadypage"},properties:{p_nodeView:cc.Node,p_arrNation:[cc.Node],p_nodeCh:cc.Node,p_arrFetters:[cc.Node],p_btnDetail:cc.Button,p_labCount:cc.Label,p_labPower:cc.Label,p_arrForm:[cc.Node],p_btnGodCh:cc.Button,p_btnReco:cc.Button,p_btnCheck:cc.Button,p_btnBattle:cc.Button,p_btnSave:cc.Button,p_btnTest:cc.Button,p_pfbForm:cc.Prefab},onLoad:function(){n.instance=this,this.stopBgNodeEvent(),this.creatMask(!1,255),this.handleUI(),this.m_arrForm=[]},handleUI:function(){var e=this;this._super();for(var t=function(t){e.p_arrNation[t].getChildByName("choosed").active=!1,e.p_arrNation[t].on("touchend",function(){e.m_nIndex==t?(e.m_nIndex=-1,e.p_arrNation[t].getChildByName("choosed").active=!1,app.playSound("cancel")):(e.m_nIndex>=0&&(e.p_arrNation[e.m_nIndex].getChildByName("choosed").active=!1),e.m_nIndex=t,e.p_arrNation[t].getChildByName("choosed").active=!0,app.playSound("click")),e.refreshUI()})},a=0;a<this.p_arrNation.length;++a)t(a);this.p_btnDetail.node.on("click",function(){app.playSound("click"),app.pages.battlereadydetailpage.showPage(e._fetters)}),this.p_btnBattle.node.on("click",function(){app.playSound("click"),e.goBattle()}),this.p_btnTest.node.on("click",function(){app.playSound("click"),app.battleType="test",e.goTest()}),this.p_btnGodCh.node.on("click",function(){app.playSound("click"),app.pages.godbeastbattlepage.showPage(e.m_Gid)}),this.p_btnReco.node.on("click",function(){app.playSound("click"),app.pages.battlereadyformpage.showPage()}),this.p_btnCheck.node.on("click",function(){app.playSound("click"),app.pages.battlereadyenemypage.showPage()}),this.p_btnSave.node.on("click",function(){app.playSound("click"),e.onSave()})},onEnable:function(){},setParam:function(e){var t=gConfig.battleForm[e.battle];switch(app.player.battlearr[t]||(app.player.battlearr[t]={team:{}}),this.m_objTeam=gUtils.deepClone(app.player.battlearr[t].team),this.m_objInitTeam=gUtils.deepClone(app.player.battlearr[t].team),this.m_Gid=app.player.battlearr[t].mythic,this.m_initGid=app.player.battlearr[t].mythic,this.m_bType=e.battle,this.p_btnSave.node.active="pvpdef"==e.battle,e.battle){case"normal":case"tower":break;case"bigbattle":this.m_bid=e.bigid;break;case"pvpatt":this._index=e.index,app.pvpBattleInfo=e.rinfo,app.pvpEnemyInfo=e.einfo}this.m_arrIndex=[],this.refreshUI()},refreshUI:function(){this.refreshView(),this.refreshForm()},refreshView:function(){var e=[];for(var t in this.m_objTeam)e.push(this.m_objTeam[t]);var a=[];for(var i in app.player.general)this.m_nIndex>=0&&this.m_nIndex+1!=app.player.general[i].camp||(e.indexOf(i)>=0?a.push({guid:i,up:1}):a.push({guid:i,up:0}));a.sort(function(e,t){var a=app.player.general[e.guid],i=app.player.general[t.guid];return i.star>a.star?1:i.star==a.star?i.level>a.level?1:i.level==a.level&&i.gsid<a.gsid?1:-1:-1});var n=a.length;this.p_nodeView.getComponent("tableView").initTableView(n,{array:a,target:this})},refreshForm:function(){for(var e=0,t=0,i=0;i<this.p_arrForm.length;++i)if(this.p_arrForm[i].getChildByName("in_area").active=!1,this.m_objTeam[a[i]]){var n=app.player.general[this.m_objTeam[a[i]]];if(!n){delete this.m_objTeam[a[i]];continue}var r=this.m_arrForm[e];r||(r=cc.instantiate(this.p_pfbForm),this.m_arrForm.push(r)),r.parent=this.p_arrForm[i],r.active=!0,r.setPosition(0,0),r.getComponent("generalFormItem").initInfo(i,this.m_objTeam[a[i]],this),t+=n.power,e++}this.p_labCount.string=e+"/10",this.p_labPower.string=t;for(var o=e;o<this.m_arrForm.length;++o)this.m_arrForm[o].active=!1;this.refreshFetters()},setGid:function(e){this.m_Gid=e},refreshFetters:function(){var e=[];for(var t in this.m_objTeam){var a=app.player.general[this.m_objTeam[t]];e.push(a.gsid)}this._fetters=app.getFettersByGsidArr(e);for(var i=0;i<this._fetters.length;++i)this.p_arrFetters[i].active=!0,this.p_arrFetters[i].getComponent("fetterReadyItem").initUI(this._fetters[i]);for(var n=this._fetters.length;n<this.p_arrFetters.length;++n)this.p_arrFetters[n].active=!1},getAutoNodePos:function(){for(var e=0;e<24&&this.m_objTeam[a[e]];++e);return e},setOnePosGeneral:function(e,t){t&&(gUtils.getTableLength(this.m_objTeam)>=10?app.showNotice(langMgr.getString("battleReadyPage",0)):this.m_objTeam[a[e]]=t)},getPosHaveOne:function(e){return this.m_objTeam[a[e]]},deleteOneForm:function(e){for(var t in this.m_objTeam)if(this.m_objTeam[t]==e){delete this.m_objTeam[t];break}},setDownGeneral:function(e){this.deleteOneForm(e),this.refreshUI()},quickForm:function(e){if(!(e<0)){var t=[];for(var a in app.player.general){for(var n=app.player.general[a],r=0,o=t.length-1,s=r;r<Math.ceil(t.length/2)&&o>=Math.ceil(t.length/2);++r,--o){var p=app.player.general[t[r]],c=app.player.general[t[o]];if(n.power>p.power){s=r;break}if(n.power<c.power){s=o+1;break}}t.splice(s,0,a)}for(var h=[],l=0;l<t.length&&l<10;++l){for(var g=app.player.general[t[l]],d=0;d<h.length;++d){var u=app.player.general[h[d]];if(g.occu<u.occu)break}h.splice(d,0,t[l])}this.m_objTeam={};for(var f=0;f<h.length;++f)this.m_objTeam[i[e][f]]=h[f];this.refreshUI()}},checkInArea:function(e){for(var t=e.convertToWorldSpaceAR(cc.v2(0,0)),a=0;a<this.p_arrForm.length;++a){var i=this.p_arrForm[a].convertToWorldSpaceAR(cc.v2(0,0));gUtils.isInRect(t.x,t.y,i.x,i.y,this.p_arrForm[a].width,this.p_arrForm[a].height)?(this.p_arrForm[a].getChildByName("in_area").active=!0,e.getComponent("generalFormItem").setNowPos(a)):this.p_arrForm[a].getChildByName("in_area").active=!1}},goTest:function(){cc.director.loadScene("scenes_test")},checkSetIsOk:function(){return gUtils.getTableLength(this.m_objTeam)<=0?(app.showNotice(langMgr.getString("battleReadyPage",1)),!1):!(gUtils.getTableLength(this.m_objTeam)>10&&(app.showNotice(langMgr.getString("battleReadyPage",2)),1))},goBattle:function(){if(this.checkSetIsOk())switch(console.log(0x9a3298afb5ac7000,this.m_bType),this.m_bType){case"normal":this.normalBattle();break;case"tower":this.towerBattle();break;case"bigbattle":this.bigBattle();break;case"pvpatt":this.pvpBattle()}},normalBattle:function(){var e=this,t={team:this.m_objTeam};this.m_Gid&&(t.mythic=this.m_Gid),app.player.sfChapterFight(t,function(a){app.battleKey=a.key,app.battleSeed=a.seed,app.player.battlearr[gConfig.battleForm[e.m_bType]]=gUtils.deepClone(t),app.battleType=e.m_bType,cc.director.loadScene("scenes_battle")})},towerBattle:function(){var e=this,t={team:this.m_objTeam};this.m_Gid&&(t.mythic=this.m_Gid),app.player.sfTowerBattle(t,function(a){app.battleKey=a.key,app.battleSeed=a.seed,app.player.battlearr[gConfig.battleForm[e.m_bType]]=gUtils.deepClone(t),app.battleType=e.m_bType,cc.director.loadScene("scenes_battle")})},bigBattle:function(){var e=this,t={team:this.m_objTeam};this.m_Gid&&(t.mythic=this.m_Gid),app.player.sfBigBattleStart(this.m_bid,t,function(a){app.battleKey=a.key,app.battleSeed=a.seed,app.bigId=e.m_bid,app.player.battlearr[gConfig.battleForm[e.m_bType]]=gUtils.deepClone(t),app.battleType=e.m_bType,cc.director.loadScene("scenes_battle")})},pvpBattle:function(){var e=this,t={team:this.m_objTeam};this.m_Gid&&(t.mythic=this.m_Gid),app.player.sfPvpBattleStart(this._index,t,function(a){app.battleKey=a.key,app.battleSeed=a.seed,app.player.battlearr[gConfig.battleForm[e.m_bType]]=gUtils.deepClone(t),app.battleType=e.m_bType,cc.director.loadScene("scenes_battle")})},onSave:function(){if(this.checkSetIsOk())switch(this.m_bType){case"pvpdef":this.pvpdefSave()}},pvpdefSave:function(){var e=this,t={team:this.m_objTeam};this.m_Gid&&(t.mythic=this.m_Gid),app.player.sfPvpSaveDef(t,function(){app.player.battlearr[gConfig.battleForm[e.m_bType]]=gUtils.deepClone(t),app.showNotice(langMgr.getString("battleReadyPage",3))})}});cc._RF.pop()},{basePage:void 0}],battleReportPage:[function(e,t){"use strict";cc._RF.push(t,"3a2e63kkcdFPK560l/ohSU2","battleReportPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"battlereportpage",pageType:1},properties:{p_nodeLhead:cc.Node,p_nodeRhead:cc.Node,p_pfbHead:cc.Prefab,p_sprL:cc.Sprite,p_sprLDi:cc.Sprite,p_sprR:cc.Sprite,p_sprRDi:cc.Sprite,p_labLname:cc.Label,p_labRname:cc.Label,p_srcLeft:cc.ScrollView,p_srcRight:cc.ScrollView,p_pfbReport:cc.Prefab,p_btnPlay:cc.Button},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.createHeadNode(),this.getStartState()},handleUI:function(){var e=this;this._super(),this.p_btnPlay.node.on("click",function(){app.battleType="video",app.replayData=gUtils.deepClone(e._obj),e._obj.lcards&&(app.replayData.leftcards=e._obj.lcards),e._obj.rcards&&(app.replayData.rightcards=e._obj.rcards),e.onClose(),e._lastpage&&e._lastpage.onClose(),app.goToNormBattle()})},getStartState:function(){this.m_sprSheng=this.p_sprL.spriteFrame,this.m_sprBai=this.p_sprR.spriteFrame,this.m_sprShengDi=this.p_sprLDi.spriteFrame,this.m_sprBaiDi=this.p_sprRDi.spriteFrame,this.m_clrSheng=this.p_labLname.node.color,this.m_clrBai=this.p_labRname.node.color,this.m_clrShengOut=this.p_labLname.node.getComponent("cc.LabelOutline").color,this.m_clrBaiOut=this.p_labLname.node.getComponent("cc.LabelOutline").color},createHeadNode:function(){this.m_nodeLhead=cc.instantiate(this.p_pfbHead),this.p_nodeLhead.addChild(this.m_nodeLhead),this.m_nodeLhead.setPosition(0,0),this.m_nodeRhead=cc.instantiate(this.p_pfbHead),this.p_nodeRhead.addChild(this.m_nodeRhead),this.m_nodeRhead.setPosition(0,0)},setParam:function(e){cc.isValid(app.battleScene)&&app.battleScene.destroy(),this._obj=e.obj,this._lastpage=e.lastpage,this.refreshUI()},refreshUI:function(){var e="win"===this._obj.result;this.p_sprL.spriteFrame=e?this.m_sprSheng:this.m_sprBai,this.p_sprR.spriteFrame=e?this.m_sprBai:this.m_sprSheng,this.p_sprLDi.spriteFrame=e?this.m_sprShengDi:this.m_sprBaiDi,this.p_sprRDi.spriteFrame=e?this.m_sprBaiDi:this.m_sprShengDi,this.p_labLname.node.color=e?this.m_clrSheng:this.m_clrBai,this.p_labRname.node.color=e?this.m_clrBai:this.m_clrSheng,this.p_labLname.node.getComponent("cc.LabelOutline").color=e?this.m_clrShengOut:this.m_clrBaiOut,this.p_labRname.node.getComponent("cc.LabelOutline").color=e?this.m_clrBaiOut:this.m_clrShengOut,this._obj.left&&(this.m_nodeLhead.getComponent("headItem").init({iconid:this._obj.left.info.iconid,headid:this._obj.left.info.headid,frameid:this._obj.left.info.frameid,numLevel:this._obj.left.info.level,target:this}),this.p_labLname.string=this._obj.left.info.rname||langMgr.getString("battleReportPage",0)),this._obj.right&&(this.m_nodeRhead.getComponent("headItem").init({iconid:this._obj.right.info.iconid,headid:this._obj.right.info.headid,frameid:this._obj.right.info.frameid,numLevel:this._obj.right.info.level,target:this}),this.p_labRname.string=this._obj.right.info.rname||langMgr.getString("battleReportPage",0));var t=gUtils.deepClone(this._obj.report),a=this.getMaxNum();if("Array"==gUtils.isClass(t.left)){t.left.sort(function(e,t){return e.hurm<t.hurm?1:-1}),this.m_arrLeft||(this.m_arrLeft=[]);for(var i=0;i<t.left.length;++i){var n=this.m_arrLeft[i];n||((n=cc.instantiate(this.p_pfbReport)).parent=this.p_srcLeft.content,this.m_arrLeft.push(n)),n.active=!0,n.getComponent("generalReportItem").initUI(t.left[i],a,this)}}if("Array"==gUtils.isClass(t.right)){t.right.sort(function(){t.right.sort(function(e,t){return e.hurm<t.hurm?1:-1})}),this.m_arrRight||(this.m_arrRight=[]);for(var r=0;r<t.right.length;++r){var o=this.m_arrRight[r];o||((o=cc.instantiate(this.p_pfbReport)).parent=this.p_srcRight.content,this.m_arrRight.push(o)),o.active=!0,o.getComponent("generalReportItem").initUI(t.right[r],a,this)}}},getMaxNum:function(){for(var e=0,t=0,a=0,i=0;i<this._obj.report.left.length||i<this._obj.report.right.length;++i){var n=this._obj.report.left[i];n&&(n.hurm>e&&(e=n.hurm),n.heal>t&&(t=n.heal),n.def>a&&(a=n.def));var r=this._obj.report.right[i];r&&(r.hurm>e&&(e=r.hurm),r.heal>t&&(t=r.heal),r.def>a&&(a=r.def))}return{maxHurm:e,maxHeal:t,maxDef:a}}});cc._RF.pop()},{basePage:void 0}],battleResultMultipvpPage:[function(e,t){"use strict";cc._RF.push(t,"abc32muCD1KZaYwVJX6bkbU","battleResultMultipvpPage");var a=cc.Class({extends:e("baseBattleResult"),statics:{prefabPath:"battleresultmultipvppage"},properties:{p_nodeWin:cc.Node,p_nodeLose:cc.Node,p_nodeTp:cc.Node,p_labTotalScore:cc.Label,p_labCurScore:cc.Label,p_labChangeScore:cc.Label,p_nodeKp:cc.Node,p_sprLstage:cc.Sprite,p_sprLstar:cc.Sprite,p_sprRstage:cc.Sprite,p_sprRstar:cc.Sprite,p_nodeUpstar:cc.Node,p_nodeDownstar:cc.Node,p_nodeContent:cc.Node,p_nodePrefab:cc.Prefab,p_nodeWidgetTop:cc.Node,p_spWinAnim:sp.Skeleton,p_spLoseAnim:sp.Skeleton,p_spLiansheng:sp.Skeleton,p_nodeStar:cc.Node,p_arrNode_Special:[cc.Node],p_starArrLeft:[cc.Node],p_starArrRight:[cc.Node],p_nodeLeftLvBg:cc.Node,p_nodeRightLvBg:cc.Node,p_sprResultMvp:cc.Sprite},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.fitTopMenu(),this._arrItems=[],this._leftStarPos=this.p_nodeUpstar.position,this._rightStarPos=this.p_nodeDownstar.position},handleUI:function(){this._super()},setParam:function(e){app.battleScene&&app.battleScene.destroy(),this.numGoToPage=0,this.battleOverType=app.battleType,e.turn&&app.pages.windowspageturn.showPage(e.turn),this._result=e.result,this._totalScore=e.totalScore,this._arrVideo=e.arrVideo,"teampvp"==e.type?(this.p_nodeTp.active=!0,this.p_nodeKp.active=!1,this._curScore=e.curScore,this._changeScore=e.changeScore,this.refreshTp()):"kingpvp"==e.type?(this.p_nodeTp.active=!1,this.p_nodeKp.active=!0,this.refreshKp()):(this.p_nodeTp.active=!1,this.p_nodeKp.active=!1),this._selfResult=e.selfResult||"",this._allReport=[],this.refreshUI()},refreshTp:function(){this.p_labCurScore.node.active=!!this._curScore||0==this._curScore,this.p_labTotalScore.string=this._totalScore,this.p_labCurScore.string=langMgr.getString("battleResultMultipvpPage",0,this._curScore);var e=this._changeScore>=0?"+"+this._changeScore:this._changeScore;this.p_labChangeScore.string="("+e+")"},refreshKp:function(){this.p_labTotalScore.string=this._totalScore,app.KPSTAGEINFO.stage||(this.p_sprLstage.node.active=!1),app.kpvpStageInfo&&app.kpvpStageInfo.stageinfo&&app.kpvpStageInfo.stageinfo.schange>1?(this.p_spLiansheng.node.active=!0,this.p_spLiansheng.setAnimation(0,"lianshen",!1)):this.p_spLiansheng.node.active=!1,parseInt(String(app.KPSTAGEINFO.stage).charAt(2));var e=parseInt(String(app.KPSTAGEINFO.stage).charAt(0));if(this.p_starArrLeft.map(function(e){return e.active=!1}),this.p_starArrRight.map(function(e){return e.active=!1}),app.kpvpStageInfo.stageinfo&&app.kpvpStageInfo.stageinfo.star)for(var t=0;t<5;t++)this.p_starArrLeft[t].active=t+1<=app.kpvpStageInfo.stageinfo.star;if(app.kpvpStageInfo.stageinfo&&app.kpvpStageInfo.stageinfo.star)for(var a=0;a<5;a++)this.p_starArrLeft[a].active=a+1<=app.kpvpStageInfo.stageinfo.star;for(var i=parseInt(String(app.kpvpEnemyInfo.stage).charAt(0)),n=(parseInt(String(app.kpvpEnemyInfo.stage).charAt(2)),0);n<5;n++)this.p_starArrRight[n].active=n+1<=app.kpvpEnemyInfo.star;app.loadStageSpr(app.KPSTAGEINFO.stage,this.p_sprLstage,null,this.p_sprLstar),app.loadStageSpr(app.kpvpEnemyInfo.stage,this.p_sprRstage,null,this.p_sprRstar),this.p_nodeLeftLvBg&&(this.p_nodeLeftLvBg.active=e<=5),this.p_nodeRightLvBg&&(this.p_nodeRightLvBg.active=i<=5),"win"==this._result?(this.p_nodeUpstar.setPosition(this._leftStarPos),this.p_nodeDownstar.setPosition(this._rightStarPos),this.p_nodeUpstar.active=app.KPSTAGEINFO&&app.KPSTAGEINFO.stage,this.p_nodeDownstar.active=app.kpvpEnemyInfo&&app.kpvpEnemyInfo.stage):(this.p_nodeUpstar.setPosition(this._rightStarPos),this.p_nodeDownstar.setPosition(this._leftStarPos),this.p_nodeUpstar.active=app.kpvpEnemyInfo&&app.kpvpEnemyInfo.stage,this.p_nodeDownstar.active=app.KPSTAGEINFO&&app.KPSTAGEINFO.stage)},refreshUI:function(){var e=this._selfResult||this._result;this.p_nodeWin.active="win"==e,this.p_nodeLose.active="win"!=e,this.p_sprResultMvp.node.active="win"==e,this.p_nodeWidgetTop&&(this.p_nodeWidgetTop.active="win"==e),this.p_labCurScore.node.active=!!this._curScore||0==this._curScore,this.p_labTotalScore.string=this._totalScore,this.p_labCurScore.string="\u79ef\u5206\uff1a"+this._curScore;var t=this._changeScore>=0?"+"+this._changeScore:this._changeScore;this.p_labChangeScore.string="("+t+")";for(var a=0;a<this._arrVideo.length;++a){var i=this._arrItems[a];i||((i=cc.instantiate(this.p_nodePrefab)).setParent(this.p_nodeContent),this._arrItems.push(i)),i.active=!0,i.getComponent("battleResultMultipvpItem").refreshUI(this._arrVideo[a],a,this),"win"==this._result&&(this._allReport=this._allReport.concat(this._arrVideo[a].report.left))}for(var n=a;n<this._arrItems.length;++n)this._arrItems[n].active=!1;"win"==this._result&&this.refreshGeneral()},refreshGeneral:function(){if(this.p_sprGeneral){this._allReport.sort(function(e,t){return e.hurm<t.hurm?1:-1});var e=this._allReport[0].gsid,t=this._allReport[0].skin||null;this.m_totalHurm=0;for(var a=0;a<this._allReport.length;++a)this.m_totalHurm+=this._allReport[a].hurm||0;var i=app.db.getGBaseByGsid(e),n=i.HEADICON.split("_");if(this.p_sprName){var r=gConfig.getIconGNameVerticalPath(n[0]);app.loadTexture(r,this.p_sprName,this.prefabPath)}this.p_labMvpName&&(this.p_labMvpName.string=i.NAME),app.loadGeneral(e,this.p_sprGeneral,this.p_spGeneral,this.p_animGeneral,null,this.prefabPath,t)}},onClose:function(){var e=this;this._super(),this.refreshPlayerDataWinByType(function(){e.refereshPageClose()},function(){e.refreshNormClose()})},refreshByPgts:function(){this.p_arrNode_Special.forEach(function(e){e.active=gSetting.checkReviewServ()})}});cc._RF.pop()},{baseBattleResult:void 0}],battleResultPage:[function(e,t){"use strict";var a;cc._RF.push(t,"ba206ntip5OMqvweEZ8Q+sL","battleResultPage");var i=cc.Class({extends:e("basePage"),statics:{prefabPath:"battleresultpage"},properties:(a={p_nodeWin:cc.Node,p_sprGeneral:cc.Sprite,p_spGeneral:sp.Skeleton,p_animGeneral:cc.Animation,p_sprName:cc.Sprite,p_labMvpNum:cc.Label,p_nodeReward:cc.Node,p_pfbItem:cc.Prefab,p_btnWinSure:cc.Button,p_btnWinShare:cc.Button,p_nodeLose:cc.Node,p_btnLoseSure:cc.Button,p_btnLoseShare:cc.Button,p_btnData:cc.Button,p_btnFData:cc.Button,p_pfbReport:cc.Prefab,p_nodeWinNorm:cc.Node,p_nodeWinPvp:cc.Node,p_nodeWinReward:cc.Node,p_sprUp:cc.Sprite,p_labUpName:cc.Label,p_labUpLevel:cc.Label,p_labUpScore:cc.Label},a.p_sprUp=cc.Sprite,a.p_labUpCscore=cc.Label,a.p_sprUpStar=cc.Sprite,a.p_sprUpBadge=cc.Sprite,a.p_sprDown=cc.Sprite,a.p_labDwName=cc.Label,a.p_labDwLevel=cc.Label,a.p_labDownSco=cc.Label,a.p_sprDown=cc.Sprite,a.p_labDownCsco=cc.Label,a.p_sprDownStar=cc.Sprite,a.p_sprDownBadge=cc.Sprite,a.p_nodeLoseNorm=cc.Node,a.p_nodeLosePvp=cc.Node,a.p_nodeBossWin=cc.Node,a.p_labBossHurmWin=cc.Label,a.p_nodeBossKillWin=cc.Node,a.p_nodeBossLose=cc.Node,a.p_labBossHurmLose=cc.Label,a.p_nodeBossKillLose=cc.Node,a.p_animWin=cc.Animation,a.p_animWinPvp=cc.Animation,a.p_animLose=cc.Animation,a.p_animLosePvp=cc.Animation,a.p_btnGoSmithy=cc.Button,a.p_btnGoGeneral=cc.Button,a.p_btnGoPub=cc.Button,a.p_btnGoGod=cc.Button,a),onLoad:function(){i.instance=this,this._super(),this.m_arrReward=[],this.p_nodeBossWin.active=!1,this.p_nodeBossKillWin.active=!1,this.p_nodeBossLose.active=!1,this.p_nodeBossKillLose.active=!1},handleUI:function(){var e=this;this.p_btnWinSure.node.on("click",function(){app.playSound("click"),e.onClose()}),this.p_btnWinShare.node.on("click",function(){app.playSound("click"),e.shareVideoTo()}),this.p_btnLoseSure.node.on("click",function(){app.playSound("click"),e.onClose()}),this.p_btnLoseShare.node.on("click",function(){app.playSound("click"),e.shareVideoTo()}),this.p_btnData.node.on("click",function(){app.playSound("click"),app.pages.battlereportpage.showPage(e._report)}),this.p_btnFData.node.on("click",function(){app.playSound("click"),app.pages.battlereportpage.showPage(e._report)}),this.p_btnGoSmithy.node.on("click",function(){e.specialGoTo("fusionpage")}),this.p_btnGoGeneral.node.on("click",function(){e.specialGoTo("generalbaghandbookpage")}),this.p_btnGoPub.node.on("click",function(){e.specialGoTo("cardmanagepage")}),this.p_btnGoGod.node.on("click",function(){e.specialGoTo("godbeastchoosepage")})},setParam:function(e){this._result=e.result,this._reward=e.reward||[],this._report=e.report,this._videodata=e.videodata,e.turn&&app.pages.windowspageturn.showPage(e.turn),this.p_btnLoseShare.node.active=!!this._videodata,this.p_btnWinShare.node.active=!!this._videodata,this.p_nodeBossWin.active="win"==e.result&&e.bosshurm,this.p_labBossHurmWin.string="win"==e.result&&e.bosshurm?e.bosshurm:"",this.p_nodeBossKillWin.active="win"==e.result&&e.kill,this.p_nodeBossLose.active="lose"==e.result&&e.bosshurm,this.p_labBossHurmLose.string="lose"==e.result&&e.bosshurm?e.bosshurm:"",this.p_nodeBossKillLose.active="lose"==e.result&&e.kill,this._report.left.sort(function(e,t){return e.hurm<t.hurm?1:-1}),this.m_mvp=this._report.left[0].gsid,this.m_mvpHurm=this._report.left[0].hurm||0,this.m_totalHurm=0;for(var t=0;t<this._report.left.length;++t)this.m_totalHurm+=this._report.left[t].hurm||0;"win"==e.result?(this.p_nodeWin.active=!0,this.p_nodeLose.active=!1,app.playMusic("battlewin",!1),"pvpatt"==app.battleType||"kingpvp"==app.battleType?(this.p_nodeWinPvp.active=!0,this.p_nodeWinNorm.active=!1,this.refreshWinPvp(e.pinfo)):(this.p_nodeWinNorm.active=!0,this.p_nodeWinPvp.active=!1,app.loadEff("main_levelup",this.p_animWin,2,1))):(app.playMusic("battlelose",!1),this.p_nodeWin.active=!1,this.p_nodeLose.active=!0),this.refreshUI()},refreshUI:function(){app.db.getGBaseByGsid(this.m_mvp).HEADICON.split("_");var e=app.db.getGNamePathHByGsid(this.m_mvp);app.loadTexture(e,this.p_sprName,this.prefabPath),app.loadGeneral(this.m_mvp,this.p_sprGeneral,this.p_spGeneral,this.p_animGeneral,null,this.prefabPath),this.p_labMvpNum.string=this.m_mvpHurm+"("+Math.ceil(this.m_mvpHurm/this.m_totalHurm*100)+"%)",this.m_mvpHurm||this.m_totalHurm||(this.p_labMvpNum.string="0(0%)"),this.m_CountTime=5;for(var t=0;t<this._reward.length;++t){var a=this.m_arrReward[t];a||((a=cc.instantiate(this.p_pfbItem)).parent="pvpatt"==app.battleType||"kingpvp"==app.battleType?this.p_nodePvpReward:this.p_nodeReward,this.m_arrReward.push(a)),a.active=!0,a.getComponent("propItem").initForBag(this._reward[t]),a.getComponent("propItem").setClick(!0)}for(var i=this._reward.length;i<this.m_arrReward.length;++i)this.m_arrReward[i].active=!1},refreshWinPvp:function(e){var t=app.db.getGHeadIconByGsid(e.left.iconid);app.loadTexture(t,this.p_sprUp,this.prefabPath),this.p_labUpName.string=e.left.rname,this.p_labUpLevel.string=e.left.level,this.p_labUpScore.string=e.left.points,this.p_labUpCscore.string=e.left.cpoints,this.p_labUpScore.node.active=!!e.left.points,this.p_labUpCscore.node.active=!!e.left.cpoints,t=app.db.getGHeadIconByGsid(e.right.iconid),app.loadTexture(t,this.p_sprDown,this.prefabPath),this.p_labDwName.string=e.right.rname,this.p_labDwLevel.string=e.right.level,this.p_labDownSco.string=e.right.points,this.p_labDownCsco.string=e.right.cpoints,this.p_labDownSco.node.active=!!e.right.points,this.p_labDownCsco.node.active=!!e.right.cpoints},refreshLosePvp:function(){},shareVideoTo:function(){var e={type:4,data:this._videodata};app.pages.windowspagesharechat.showPage(e)},update:function(){},onClose:function(){var e=this;this._close||(this._close=!0,this.scheduleOnce(function(){e._close=!1},2),app.popPage(),app.player.sfPlayerData(function(){"expedition"==app.battleType?app.player.sfExpedInfo(function(e,t){app.expedinfo=t,app.quitBattleScene()}):app.quitBattleScene()}))},specialGoTo:function(e){var t=this;this._close||(this._close=!0,this.scheduleOnce(function(){t._close=!1},2),app.popPage(),app.battleSavePage=[{PAGE:"mainscenes"},{PAGE:e}],cc.director.loadScene("scenes_main"))}});cc._RF.pop()},{basePage:void 0}],battleWinNormalPage:[function(e,t){"use strict";function a(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(a)return(a=a.call(e)).next.bind(a);if(Array.isArray(e)||(a=i(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function i(e,t){if(e){if("string"==typeof e)return n(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?n(e,t):void 0}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,i=new Array(t);a<t;a++)i[a]=e[a];return i}cc._RF.push(t,"b31ddNUzNlOzKn8LzPPCTG9","battleWinNormalPage");var r=cc.Class({extends:e("baseBattleResult"),statics:{prefabPath:"battlewinnormalpage"},properties:{p_nodeBoss:cc.Node,p_labBossHurm:cc.Label,p_nodeBossKill:cc.Node,p_nodeHlep:cc.Node,p_nodeGou:cc.Node,p_arrRtx:[cc.RichText],p_skeAnima:sp.Skeleton},onLoad:function(){var t=this;r.instance=this,this._super(),this.p_skeAnima.setCompleteListener(function(){t.p_skeAnima.setAnimation(0,"effect2",!0)}),this.p_skeAnima.setAnimation(0,"effect1",!1),this.OnlineHelpItem=e("OnlineHelpItem").OnlineHelpItem},handleUI:function(){this._super()},setParam:function(e){this._super(e),this.handleUI()},refreshUI:function(){if(this._super(),cc.log("show battle win reward",this._reward),"normal"==this.battleOverType)if(this.OnlineHelpItem.isOver())this.p_nodeHlep.active=!1;else{var e=this.OnlineHelpItem.getRecentTarget(2);this.refreshTarget(e)}else this.p_nodeHlep.active=!1},refreshTarget:function(e){this.p_nodeHlep.active=!!e.length,this.p_nodeGou.active=!1,this.p_arrRtx.forEach(function(t,a){t.node.active=e.length>a,t.node.parent.active=e.length>a});for(var t=0;t<e.length;t++){var a,i=e[t],n=app.db.dbCampaignHelp[i];a="xfzh"==n.REWARD?langMgr.getString("battleWinNormalPage",2):'"'+app.db.getPropsInfoByGsid(n.REWARD[0].GSID).NAME+'"';var r=this.OnlineHelpItem.getNextNumByIndex(i)-1;r<=0?(this.p_nodeGou.active=!0,this.p_arrRtx[t].string=langMgr.getString("battleWinNormalPage",0,a)):this.p_arrRtx[t].string=langMgr.getString("battleWinNormalPage",1,[r,a])}},onClose:function(){var e=this;this._super(),app.objOldReapData=[];for(var t,i=a(app.player.reap_config);!(t=i()).done;){var n=t.value;app.objOldReapData.push(n)}this.refreshPlayerDataWinByType(function(){e.refereshPageClose(),app.mainScene.popUp(),"normal"!=app.battleType&&app.showRecommendGift(),GodGuide.battleWinEnd()},function(){e.refreshNormClose()},function(){e._close=!1})}});cc._RF.pop()},{OnlineHelpItem:void 0,baseBattleResult:void 0}],battleWinPvpPage:[function(e,t){"use strict";cc._RF.push(t,"1a557BLOWdI74MSM/CO3pMb","battleWinPvpPage");var a=cc.Class({extends:e("baseBattleResult"),statics:{prefabPath:"battlewinpvppage"},properties:{p_leftHead:cc.Node,p_rightHead:cc.Node,p_pfbHead:cc.Prefab,p_labLscore:cc.Label,p_labLCscore:cc.Label,p_labLname:cc.Label,p_labRscore:cc.Label,p_labRCscore:cc.Label,p_labRname:cc.Label,p_nodeContentLeft:cc.Node,p_nodeContentRight:cc.Node,p_pfbGeneral:cc.Prefab,p_arrNode_Special:[cc.Node]},onLoad:function(){a.instance=this,this._super(),this._arrItemsLeft=[],this._arrItemsRight=[],this.refreshByPgts()},handleUI:function(){this._super(),this.createHeadNode()},createHeadNode:function(){this.m_leftHead=cc.instantiate(this.p_pfbHead),this.p_leftHead.addChild(this.m_leftHead),this.m_leftHead.setPosition(0,0),this.m_rightHead=cc.instantiate(this.p_pfbHead),this.p_rightHead.addChild(this.m_rightHead),this.m_rightHead.setPosition(0,0)},initParam:function(){this._arrItemsLeft||(this._arrItemsLeft=[]),this._arrItemsRight||(this._arrItemsRight=[])},setParam:function(e){this._super(e),this.refreshWinPvp(e),this.handleUI()},refreshUI:function(){this._super()},refreshWinPvp:function(e){var t=e.pinfo;this.m_leftHead.getComponent("headItem").init({iconid:t.left.iconid,headid:t.left.headid,frameid:t.left.frameid,numLevel:t.left.level,target:this}),this.p_labLname.string=t.left.rname,this.p_labLscore.string=langMgr.getString("battleWinPvpPage",0,t.left.points),this.p_labLCscore.string="("+(t.left.cpoints>0?"+"+t.left.cpoints:t.left.cpoints)+")",this.m_rightHead.getComponent("headItem").init({iconid:t.right.iconid,headid:t.right.headid,frameid:t.right.frameid,numLevel:t.right.level,target:this}),this.p_labRname.string=t.right.rname,this.p_labRscore.string=langMgr.getString("battleWinPvpPage",0,t.right.points),this.p_labRCscore.string="("+(t.right.cpoints>0?"+"+t.right.cpoints:t.right.cpoints)+")";var a=e.report;this.refreshLeft(a.left),this.refreshRight(a.right)},refreshLeft:function(e){this.setLayoutItem(this.p_nodeContentLeft,this._arrItemsLeft,e,this.p_pfbGeneral,function(e,t){var a=app.db.getGBaseByGsid(t.gsid);app.setNodeState(e,t.hp<=0),e.getComponent("generalPortraitItem").initReport(a,t)})},refreshRight:function(e){this.setLayoutItem(this.p_nodeContentRight,this._arrItemsRight,e,this.p_pfbGeneral,function(e,t){var a=app.db.getGBaseByGsid(t.gsid);app.setNodeState(e,t.hp<=0),e.getComponent("generalPortraitItem").initReport(a,t)})},setLayoutItem:function(e,t,a,i,n){if(e&&t&&a&&i){t||(t=[]);for(var r=0;r<a.length;++r){var o=t[r];o||((o=cc.instantiate(i)).parent=e,t.push(o)),o.active=!0,n&&n(o,a[r])}for(var s=a.length;s<t.length;++s)t[s].active=!1}},onClose:function(){var e=this;this._super(),this.refreshPlayerDataWinByType(function(){e.refereshPageClose()},function(){e.refreshNormClose()},function(){e._close=!1}),app.showRecommendGift()},refreshByPgts:function(){this.p_arrNode_Special.forEach(function(e){e.active=gSetting.checkReviewServ()})}});cc._RF.pop()},{baseBattleResult:void 0}],beastsoulHandbookPage:[function(e,t){"use strict";cc._RF.push(t,"5b27063/pJBvrCHe7aUKGip","beastsoulHandbookPage");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=cc._decorator,o=r.ccclass,s=r.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_tableView=null,t.m_target=null,t.m_showArray=[],t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,this.creatMask(!0),this.handleUI()},t.prototype.setParam=function(e){this.m_target=e.target,this.node.getComponent("menu").init(this),this.node.getComponent("menu").setMenuIndex(0)},t.prototype.setData=function(e){var t=app.db.getGeneralPotArr();this.m_showArray=0===e?t:t.filter(function(t){return t.TYPE===e}),this.m_showArray=this.m_showArray.filter(function(e){return 5===e.STAR}),this.m_showArray.sort(function(e,t){var a="132".indexOf(e.STYPE),i="132".indexOf(t.STYPE);return a!==i?i-a:e.TYPE!==t.TYPE?e.TYPE-t.TYPE:t.STAR-e.STAR}),this.refreshUI()},t.prototype.refreshUI=function(){this.p_tableView.getComponent("tableView").initTableView(this.m_showArray.length,{array:this.m_showArray,target:this})},t.prototype.menuHandler=function(e){return this.setData(e),!0},t.prefabPath="beastsoulhandbookpage",t.pageType=1,n([s(cc.Node)],t.prototype,"p_tableView",void 0),a=n([o],t)}(e("basePage"));t.exports=p,cc._RF.pop()},{basePage:void 0}],beastsoulSkillDetailPage:[function(e,t){"use strict";cc._RF.push(t,"8405cW7aYhDrbZBlpm44y33","beastsoulSkillDetailPage");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=e("basePage"),o=cc._decorator,s=o.ccclass,p=o.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_sprSkillIcon=null,t.p_labSkillName=null,t.p_sprSkillName=null,t.p_arrNodeStoneTypes=[],t.p_nodeTableView=null,t.p_sfBeastSkillKuang=[],t.m_beastsoulId=null,t.m_target=null,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,this.creatMask(!0),this.handleUI()},t.prototype.setParam=function(e){this.m_beastsoulId=e.id,this.m_target=e.target,this.isTuJian=e.isTuJian,this.refreshUI()},t.prototype.refreshUI=function(){var e=app.db.getGeneralPotByID(this.m_beastsoulId),t=app.db.getPotSkillIntroByType(e.SKILLTYPE,e.STYPE);this.p_labSkillName.string=e.NAME,this.p_sprSkillIcon.node.getChildByName("spr_kuang").getComponent(cc.Sprite).spriteFrame=this.p_sfBeastSkillKuang[e.STYPE-1],app.loadTexture(gConfig.getBeastHeadByName(e.SKILLICON),this.p_sprSkillIcon,app.getPrefabPathFrom(this.m_target));var a=e.GROUP[0];this.p_arrNodeStoneTypes.forEach(function(e,t){e.getComponent("soulstoneNameItem").init(a[t])}),this.p_nodeTableView.getComponent("tableView").initTableView(t.length,{array:t,target:this,ownerId:this.isTuJian?0:this.m_beastsoulId})},t.prefabPath="beastsoulskilldetailpage",t.pageType=1,n([p(cc.Sprite)],t.prototype,"p_sprSkillIcon",void 0),n([p(cc.Label)],t.prototype,"p_labSkillName",void 0),n([p(cc.Sprite)],t.prototype,"p_sprSkillName",void 0),n([p(cc.Node)],t.prototype,"p_arrNodeStoneTypes",void 0),n([p(cc.Node)],t.prototype,"p_nodeTableView",void 0),n([p(cc.SpriteFrame)],t.prototype,"p_sfBeastSkillKuang",void 0),a=n([s],t)}(r);t.exports=c,cc._RF.pop()},{basePage:void 0}],bigBattleBossInfoPage:[function(e,t){"use strict";cc._RF.push(t,"59b71HUMqdIYL7Msj2dNf8l","bigBattleBossInfoPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"bigbattlebossinfopage",pageType:1},properties:{p_labName:cc.Label,p_sprIcon:cc.Sprite,p_sprGeneral:cc.Sprite,p_spGeneral:sp.Skeleton,p_animGeneral:cc.Animation,p_proHp:cc.ProgressBar,p_labHp:cc.Label,p_nodeContent:cc.Node,p_nodeItem:cc.Prefab,p_btnFight:cc.Button,p_btnMop:cc.Button,p_btnHelp:cc.Button,p_nodeHero:cc.Node,p_nodeNS:cc.Node},onLoad:function(){a.instance=this,this.m_settings=[langMgr.getString("bigBattleBossInfoPage",11),langMgr.getString("bigBattleBossInfoPage",12),langMgr.getString("bigBattleBossInfoPage",13)],this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.m_arrItems=[]},handleUI:function(){var e=this;this._super(),this.p_btnFight.node.on("click",function(){e.onFight()}),this.p_btnMop.node.on("click",function(){e.onConfirmMop()}),this.p_btnHelp&&this.p_btnHelp.node.on("click",function(){app.pages.windowspagetipshelp.showPage("\u5927\u6218\u5f79\uff08\u6708\u5ea6BOSS\uff09")})},setParam:function(e){this._index=e.index,this._boss=e.boss,this._type=e.type,this._target=e.target,this._confirmcb=e.confirmcb,this._confirmparm=e.confirmparm,this.refreshUI()},afterBattleFresh:function(){var e=this;switch(app.battleOverType){case"monthboss":app.player.sfMonthBossInfo(this._index,function(t,a){if("invalid chapter"==t)return e.onClose(),void(app.pages.bigbattlembosspage.instance&&app.pages.bigbattlembosspage.instance.onClose());e&&cc.isValid(e.node)&&(e._boss=a,e.refreshUI(),app.pages.bigbattlembosspage.instance&&(app.pages.bigbattlembosspage.instance._boss=a),app.pages.bigbattlembosspage.instance&&app.pages.bigbattlembosspage.instance.refreshUI())});break;case"dramaboss":app.player.sfDramaBossList(function(t){cc.log("boss\u5217\u8868",t),app.loginReset.dramaList=t.eventlist;for(var a=!1,i=0;i<t.length;++i)if(t[i].id==app.dBossId){e._boss.nowhp=t[i].nowhp,e._boss.lastdamge=t[i].damge,a=!0;break}a?e.refreshUI():e.onClose(),app.pages.newworldmappage.instance&&app.pages.newworldmappage.instance.refreshDramaBoss()});break;case"springboss":app.pages.newworldmappage.instance&&app.pages.newworldmappage.instance.refreshSpringBoss();break;case"tnqwboss":app.player.sfGetTnqwBossInfo(app.bossIndex,function(t,a){t?app.showNotice(langMgr.getString("bigBattleBossInfoPage",5)):(e._boss=a,e._boss.rewards=e._boss.killrewards,eventMgr.emit(eventStr.commonEvent.RefershActivityZhdCoinUi),app.pages.activityzhdpagetnqw.instance&&app.pages.activityzhdpagetnqw.instance.setParam(),app.pages.activityldjlpagesslx.instance&&app.pages.activityldjlpagesslx.instance.setParam(),a.nowhp<=0?(3!=app.bossIndex&&("sslx"==app.ldjltx?(app.getRedInfoByObj(["act","sslx"],0)>=1&&(app.redDataServer.act.sslx-=1),eventMgr.emit(eventStr.redEvent.RefreshActivityRed)):(app.getRedInfoByObj(["act","tnqw"],0)>=1&&(app.redDataServer.act.tnqw-=1),eventMgr.emit(eventStr.redEvent.RefreshActivityRed))),e.onClose()):e.refreshUI())})}},refreshUI:function(){for(var e=this,t=0;t<this._boss.rewards.length;++t){var a=this.m_arrItems[t];a||((a=cc.instantiate(this.p_nodeItem)).parent=this.p_nodeContent,this.m_arrItems.push(a)),a.active=!0,a.getComponent("propItem").initForBag(this._boss.rewards[t]),a.getComponent("propItem").setClick(!0)}for(var i=this._boss.rewards.length;i<this.m_arrItems.length;++i)this.m_arrItems[i].active=!1;this.p_btnMop.node.active=!!(this._boss.lastdamge>0);var n="",r="";switch(this._type){case 1:this.p_nodeHero.active=!0,this.p_nodeNS.active=!1,r=app.db.getGHeadIconByGsid(this._boss.general),app.loadGeneral(this._boss.general,this.p_sprGeneral,this.p_spGeneral,this.p_animGeneral,null,this.prefabPath),n=this.m_settings[this._index]+(this._boss.index+1);break;case 2:this.p_nodeHero.active=!0,this.p_nodeNS.active=!1,r=app.db.getGHeadIconByGsid(this._boss.general),app.loadGeneral(this._boss.general,this.p_sprGeneral,this.p_spGeneral,this.p_animGeneral,null,this.prefabPath),n=app.db.getGNameByGsid(this._boss.general);break;case 3:if(this._boss.general)this.p_nodeHero.active=!0,this.p_nodeNS.active=!1,r=app.db.getGHeadIconByGsid(this._boss.general),app.loadGeneral(this._boss.general,this.p_sprGeneral,this.p_spGeneral,this.p_animGeneral,null,this.prefabPath);else{var o=gConfig.rootPath.uinewspinegeneral;switch(r=gConfig.rootPath.uimapevent,this._boss.gname){case"\u5e74\u517d":o+="nianshou/niansho",r+="event_tips_act";break;case"\u6363\u4e71\u7684\u98de\u9e1f":o+="feiniao/skeleton",r+="event_icon_feiniao";break;case"\u8c03\u76ae\u7684\u71d5\u5b50":o+="yanzi/skeleton",r+="event_icon_yanzi"}app.loadSpine(o,this.p_nodeNS.getComponent(sp.Skeleton),function(){e.p_nodeNS.getComponent(sp.Skeleton).setAnimation(0,"animation",!0)},null,this.prefabPath),this.p_nodeHero.active=!1,this.p_nodeNS.active=!0}n=this._boss.gname;break;case 4:this.p_nodeHero.active=!0,this.p_nodeNS.active=!1,r=app.db.getGHeadIconByGsid(this._boss.gsid),app.loadGeneral(this._boss.gsid,this.p_sprGeneral,this.p_spGeneral,this.p_animGeneral,null,this.prefabPath),n=this._boss.name}this.p_sprIcon&&app.loadTexture(r,this.p_sprIcon,this.prefabPath),this.p_labName.string=n,this.refreshHp()},refreshHp:function(){var e=this._boss.nowhp||0==this._boss.nowhp?this._boss.nowhp/this._boss.maxhp:1;this.p_proHp.progress=e,this.p_labHp.string=e>=.01?Math.floor(100*e)+"%":e<.01&&e>=0?Math.ceil(100*e)+"%":"0%"},onFight:function(){if(app.player.getCount(30024)<=0)app.showNotice(langMgr.getString("bigBattleBossInfoPage",6));else switch(this._type){case 1:app.monthIndex=this._index,app.goToBossBattle("monthboss",this._boss);break;case 2:app.dBossId=this._boss.id,app.goToBossBattle("dramaboss",this._boss);break;case 3:app.sBossPos=this._boss.pos,app.sBossId=this._boss.id,app.goToBossBattle("springboss",this._boss);break;case 4:app.bossIndex=this._index,app.goToBossBattle("tnqwboss",this._boss)}},onConfirmMop:function(){if(app.player.getCount(30024)<=0)app.showNotice(langMgr.getString("bigBattleBossInfoPage",6));else{var e=Math.ceil(this._boss.nowhp/this._boss.lastdamge),t={gsid:30024,maxcount:Math.min(e,app.player.getCount(30024)),type:"nums",tips:langMgr.getString("bigBattleBossInfoPage",14),coin:30024,confirmcb:this.onMop,target:this};app.pages.windowspagesetnum.showPage(t)}},onMop:function(e){var t=this,a=null;1==this._type?a=function(){app.player.sfMonthBossFarm({index:t._index,times:e},function(a,i){if(!a){var n={showtype:1,reward:i.items,target:t,confirmcb:function(){app.showRecommendGift()}};app.player.addItem(i.items),app.pages.windowspagereward.showPage(n),app.player.reduceItem({gsid:30024,count:e}),i.global_gifts&&app.setNewRecommendGift(i.global_gifts),app.player.sfMonthBossInfo(t._index,function(e,a){if("invalid chapter"==e)return t.onClose(),void(app.pages.bigbattlembosspage.instance&&app.pages.bigbattlembosspage.instance.onClose());t._boss=a,t.refreshUI(),app.pages.bigbattlembosspage.instance&&(app.pages.bigbattlembosspage.instance._boss=a,app.pages.bigbattlembosspage.instance.refreshUI())})}})}:2==this._type?a=function(){var a=t._boss;app.player.sfDramaFarm({id:a.id,times:e},function(i){cc.log("\u5267\u60c5boss\u626b\u8361\u7ed3\u679c--------\x3e",i);var n={showtype:1,reward:i.rewards};if(app.player.addItem(i.rewards),app.pages.windowspagereward.showPage(n),app.player.reduceItem({gsid:30024,count:e}),i.info)t._boss.nowhp=i.info.nowhp,t._boss.maxhp=i.info.maxhp,t.refreshHp();else{t.onClose();var r=app.db.getDramaBossInfo(a.id);app.showNotice(langMgr.getString("bigBattleBossInfoPage",7,r.GNAME))}})}:3==this._type?a=function(){var a=t._boss;app.player.sfSpringBossBatch({id:a.id,times:e},function(i){var n=i.info,r=i.reward;app.player.reduceItem({gsid:30024,count:e}),app.player.addItem(r);var o={showtype:1,reward:r};if(app.pages.windowspagereward.showPage(o),!n){app.player.addItem({gsid:90330,count:1}),t.onClose();var s=app.db.getEventSpringData(a.id);return app.showNotice(langMgr.getString("bigBattleBossInfoPage",8,s.gname)),void app.mapEvent.refreshSpringEvent()}t._boss.nowhp=n.nowhp,t._boss.maxhp=n.maxhp,t.refreshHp()})}:4==this._type&&(a=function(){app.player.sfTnqwBossSweep(t._index,e,function(a,i){if(!a){var n={showtype:1,reward:i.reward};if(app.player.addItem(i.reward),app.pages.windowspagereward.showPage(n),app.player.reduceItem({gsid:30024,count:e}),eventMgr.emit(eventStr.commonEvent.RefershActivityZhdCoinUi),app.pages.activityzhdpagetnqw.instance&&app.pages.activityzhdpagetnqw.instance.setParam(),app.pages.activityldjlpagesslx.instance&&app.pages.activityldjlpagesslx.instance.setParam(),i.nowhp<=0)return app.showNotice(langMgr.getString("bigBattleBossInfoPage",9)),3!=t._index&&("sslx"==app.ldjltx?(app.getRedInfoByObj(["act","sslx"],0)>=1&&(app.redDataServer.act.sslx-=1),eventMgr.emit(eventStr.redEvent.RefreshActivityRed)):(app.getRedInfoByObj(["act","tnqw"],0)>=1&&(app.redDataServer.act.tnqw-=1),eventMgr.emit(eventStr.redEvent.RefreshActivityRed))),void t.onClose();t._boss.nowhp=i.nowhp,t.refreshHp()}})});var i={content:langMgr.getString("bigBattleBossInfoPage",10,[this._boss.lastdamge,e]),confirmcb:a,target:this};app.pages.windowspagetipsmsg.showPage(i)},onClose:function(){this._super(),this._confirmcb&&this._confirmcb.call(this._target,this._confirmparm)}});cc._RF.pop()},{basePage:void 0}],bigBattleChapterPage:[function(e,t){"use strict";cc._RF.push(t,"5c1c04ku9hP24R7QZ5uxoyg","bigBattleChapterPage");var a={1:{FREE:90021,COUNTLIMIT:2,COUNTGSID:90268},2:{FREE:90022,COUNTLIMIT:2,COUNTGSID:90269},3:{FREE:90023,COUNTLIMIT:2,COUNTGSID:90270}},i=["bg_dzy_jyfb750x242","bg_dzy_tqfb750x242","bg_dzy_wjfb750x242"],n=cc.Class({extends:e("basePage"),statics:{prefabPath:"bigbattlechapterpage"},properties:{p_pfbItem:cc.Prefab,p_arrNodeMenu:[cc.Node],p_srcView:cc.ScrollView,p_labTips:cc.Label,p_btnHelp:cc.Button,p_sprLogo:cc.Sprite,coinBtnFrames:[cc.SpriteFrame],expBtnFrames:[cc.SpriteFrame],heroBtnFrames:[cc.SpriteFrame],p_labGoldNum:cc.Label},onLoad:function(){n.instance=this,this._super(),this.stopBgNodeEvent(),this.stopNodeEvent(),this.creatMask(!0,255,"#21140b"),this.m_arrItems=[],this.fitTopMenu()},handleUI:function(){var e=this;this._super(),this.p_arrNodeMenu.forEach(function(t,a){t.on("touchend",function(){e.m_nIndex!=a&&(e.m_nIndex=a,e.refreshUI())})}),this.p_btnHelp.node.on("click",function(){app.pages.windowspagetipshelp.showPage("1017")}),this.p_srcView.node.on("scroll-ended",function(){cc.director.emit("bigbattle_list_scroll_end")})},setParam:function(e){this.m_nIndex=e,this.refreshUI()},afterBattleFresh:function(){this.refreshUI(),app.pages.bigbattlepage.instance&&cc.isValid(app.pages.bigbattlepage.instance.node)&&app.pages.bigbattlepage.instance.refreshUI()},refreshUI:function(){var e=this;this.p_arrNodeMenu.forEach(function(t,a){t.getChildByName("btn_switch_on").active=a==e.m_nIndex,app.loadTexture(gConfig.rootPath.uibbattlechapter+i[e.m_nIndex],e.p_sprLogo,e.prefabPath);var n=Boolean(a==e.m_nIndex),r=[e.coinBtnFrames,e.expBtnFrames,e.heroBtnFrames],o=t.getChildByName("tx");cc.isValid(o)&&(o.getComponent(cc.Sprite).spriteFrame=r[a][Number(n)])});var t=app.db.dbBigConfig[this.m_nIndex],r=app.player.getCount(t.PASSID);this.node.getComponent("currency").refreshCoin([{type:"yb",gsid:38005}]),this.p_labTips.string=langMgr.getString("bigBattleChapterPage",0,n.countLimit(t.TYPE));for(var o=0;o<t.MAP.length;++o){var s=this.m_arrItems[o];s||((s=cc.instantiate(this.p_pfbItem)).parent=this.p_srcView.content,s.x=0,this.m_arrItems.push(s)),s.active=!0,s.getComponent("bigChapterItem").refreshUI(t.MAP[o],a[t.TYPE].FREE,a[t.TYPE].COUNTLIMIT,this)}for(var p=t.MAP.length;p<this.m_arrItems.length;++p)this.m_arrItems[p].active=!1;this.scheduleOnce(function(){e.p_srcView.scrollToOffset(cc.v2(0,r>=3?120*(r-2):0),.3)},.1),this.refreshRed()},refreshRed:function(){var e=this;this.p_arrNodeMenu.forEach(function(t,a){n.refreshRed(e.p_arrNodeMenu[a].getChildByName("rednotice"),a+1)})}});n.refreshRed=function(e,t){for(var i=app.db.dbBigConfig[t-1],n=!1,r=!0,o=0;o<i.MAP.length;++o){var s=i.MAP[o],p=app.db.getBigChapterById(s),c=app.player.level<p.LOCK,h=app.player.getCount(p.PASSID)<p.PASSCOUNT-1;if(!(r=c||h))break}return r||app.player.getCount(a[t].FREE)<a[t].COUNTLIMIT&&(n=!0),e&&(e.active=n),n},n.countLimit=function(e){return(app.db.getVipNumByType("BIGBATTLE",app.player.vip)||2)-app.player.getCount(a[e].COUNTGSID)||0},cc._RF.pop()},{basePage:void 0}],bigBattleMbossPage:[function(e,t){"use strict";cc._RF.push(t,"9c458TubqJF9bkZtEjZEekK","bigBattleMbossPage");var a=[{RNAME:"chibi",LINE:{x:38,y:-113},INTRO:1,BG:"bg_dzy_hscb750x1700",TITLE:"txt_title_hscb01_lang"},{RNAME:"yilin",LINE:{x:0,y:-35},INTRO:2,BG:"bg_dzy_yxjz750x1700",TITLE:"txt_title_yxjz01_lang"},{RNAME:"hefei",LINE:{x:18,y:-9},INTRO:3,BG:"bg_dzy_xyj750x1700",TITLE:"txt_title_xyj01_lang"}],i=cc.Class({extends:e("basePage"),statics:{prefabPath:"bigbattlembosspage"},properties:{p_sprBg:cc.Sprite,p_labIntro:cc.Label,p_sprTitle:cc.Sprite,p_arrNodeMission:[cc.Node],p_sprLine:cc.Sprite,p_proHp:cc.ProgressBar,p_labTime:cc.Label,p_btnFight:cc.Button,p_btnFight2:cc.Button,p_btnMop:cc.Button,p_nodeAlready:cc.Node,p_labCount:cc.Label,p_arrSprCoin:[cc.Sprite],p_btnHelp:cc.Button,p_pfbGeneral:cc.Prefab,p_pfbHeadItem:cc.Prefab,p_process:cc.ProgressBar,p_layoutHeadContent:cc.Node,p_rewardLayout:cc.Node,p_pfbPropItem:cc.Prefab,p_sprName:cc.Sprite,p_sprGeneral:cc.Sprite,p_spGeneral:sp.Skeleton,p_animGeneral:cc.Animation,p_hpProcess:cc.Label},onLoad:function(){this.m_arrHeads=[],this.m_arrReward=[],i.instance=this,this.creatMask(!0,255,"#21140b"),this.fitTopMenu(),this._super(),this.initCoinSpr()},onEnable:function(){this._super(),eventMgr.on(eventStr.bigBattle.RefreshBoss,this.refreshBoss,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.bigBattle.RefreshBoss,this.refreshBoss,this)},handleUI:function(){var e=this;this._super(),this.p_btnFight.node.on("click",function(){e.onBoss()}),this.p_btnFight2.node.on("click",function(){e.onBoss()}),this.p_btnMop.node.on("click",function(){e.onConfirmMop()}),this.p_btnHelp.node.on("click",function(){app.pages.windowspagetipshelp.showPage("1018")})},initCoinSpr:function(){var e=gConfig.getCurrencyIconPath(30024);this.p_arrSprCoin.forEach(function(t){app.loadTexture(e,t,assetMsg.cacheNoReleaseKey.Public)})},setParam:function(e){this._index=e.index,this._boss=e.boss,this.refreshUI()},refreshBoss:function(){var e=this;app.player.sfMonthBossInfo(this._index,function(t,a){if(t)return"invalid chapter"==t?void e.onClose():void app.showNotice(langMgr.getString("bigBattleBossInfoPage",0));e._boss=a,e.refreshUI()})},refreshUI:function(){var e=a[this._index];if(e){this.refreshTime(),this.p_labIntro.string=langMgr.getString("bigBattleMbossPage",e.INTRO);var t=gConfig.rootPath.uiimagebigbattle+e.TITLE;app.loadTexture(t,this.p_sprTitle,this.prefabPath);var i=gConfig.rootPath.uiimagebigbattle+e.BG;app.loadTexture(i,this.p_sprBg,this.prefabPath),this.p_labCount.string=app.player.getCount(30024),this.p_nodeAlready.active=!!(this._boss.lastdamge>0),this.p_btnFight.node.active=!this.p_nodeAlready.active,this.refreshProgress(),this.refreshReward(),this.refreshGeneral(),this.refreshHp()}else this.onClose()},refreshTime:function(){var e=(app.player.getServerTime()-app.player.create)/1e3,t=Math.floor(e/2592e3);e=(app.player.create+2592e6*(t+1)-app.player.getServerTime())/1e3,this.p_labTime.string=langMgr.getString("bigBattleMbossPage",0,Math.ceil(e/86400))},refreshHp:function(){this.p_proHp.progress=this._boss.nowhp||0==this._boss.nowhp?this._boss.nowhp/this._boss.maxhp:1,this.p_hpProcess.string=(100*this.p_proHp.progress).toFixed(2)+"%"},refreshProgress:function(){for(var e=app.db.dbBigBattleMBoss[this._index+1],t=0;t<e.length;t++){var a=this.m_arrHeads[t];a||((a=cc.instantiate(this.p_pfbHeadItem)).parent=this.p_layoutHeadContent,this.m_arrHeads[t]=a),a.active=!0,a.getComponent("bigbattleMbossHeadCellItem").refreshUI(this._boss.index,t,e[t],this)}this.p_process.progress=this._boss.index/(e.length-1)>1?1:this._boss.index/(e.length-1)},refreshReward:function(){var e=this,t=this._boss.rewards;if(t.forEach(function(t,a){var i=e.m_arrReward[a];i||((i=cc.instantiate(e.p_pfbPropItem)).parent=e.p_rewardLayout,e.m_arrReward[a]=i),i.active=!0,i.getComponent("propItem").initForBag(t),i.getComponent("propItem").setClick(!0)}),this.m_arrReward.length>t.length)for(var a=t.length;a<this.m_arrReward.length;a++)this.m_arrReward[a].active=!1},refreshGeneral:function(){var e=app.db.getGNamePathHByGsid(this._boss.general);app.loadTexture(e,this.p_sprName,this.prefabPath),app.loadGeneral(this._boss.general,this.p_sprGeneral,this.p_spGeneral,this.p_animGeneral,null,this.prefabPath)},onBoss:function(){app.player.getCount(30024)<=0?app.showNotice(langMgr.getString("bigBattleBossInfoPage",6)):(app.monthIndex=this._index,app.goToBossBattle("monthboss",this._boss))},onConfirmMop:function(){if(app.player.getCount(30024)<=0)app.showNotice(langMgr.getString("bigBattleBossInfoPage",6));else{var e=Math.ceil(this._boss.nowhp/this._boss.lastdamge),t={gsid:30024,maxcount:Math.min(e,app.player.getCount(30024)),type:"nums",tips:langMgr.getString("bigBattleBossInfoPage",14),coin:30024,confirmcb:this.onMop,target:this};app.pages.windowspagesetnum.showPage(t)}},onMop:function(e){var t=this,a={content:langMgr.getString("bigBattleBossInfoPage",10,[this._boss.lastdamge,e]),confirmcb:function(){app.player.sfMonthBossFarm({index:t._index,times:e},function(a,i){if(!a){var n={showtype:1,reward:i.items,target:t,confirmcb:function(){app.showRecommendGift()}};app.player.addItem(i.items),app.pages.windowspagereward.showPage(n),app.player.reduceItem({gsid:30024,count:e}),i.global_gifts&&app.setNewRecommendGift(i.global_gifts),t.refreshBoss()}})},target:this};app.pages.windowspagetipsmsg.showPage(a)},createHead:function(){var e=this;this.p_nodeHead||(this.p_nodeHead=cc.instantiate(this.p_pfbGeneral),this.p_nodeHead.parent=this.p_sprBg.node,this.p_nodeHead.on("touchend",function(){e.onBoss()}))}});i.showPage=function(t,a,i){var n=this;app.player.sfMonthBossInfo(t,function(r,o){r||e("basePage").showPage.call(n,{index:t,boss:o},a,i)})},cc._RF.pop()},{basePage:void 0}],bigBattlePage:[function(e,t){"use strict";cc._RF.push(t,"7cfddncK4ZLRKkLco7vWAKU","bigBattlePage");var a=[[38006,30001,30015,36021],[38006,30001,30029,30068],[30026,30029,30072],[30016,30017,37007]],i=["BIGBATTLE_CB","BIGBATTLE_YL","BIGBATTLE_HF"],n=cc.Class({extends:e("basePage"),statics:{prefabPath:"bigbattlepage"},properties:{p_nodeDaily:cc.Node,p_arrMonthboss:[cc.Node],p_arrLabelTime:[cc.Label],p_btnHelp:cc.Button,p_itemPrefab:cc.Prefab,p_arrNode:[cc.Node],p_arrMaskLabel:[cc.Label]},onLoad:function(){n.instance=this,this._super(),this.fitTopMenu(),this.m_nTime=0,this.refreshTime(),this.refreshUI(),this.p_btnHelp.node.on("click",function(){app.pages.windowspagetipshelp.showPage("1017")})},handleUI:function(){this._super(),this.p_nodeDaily.on("touchend",function(){app.pages.bigbattlechapterpage.showPage(0)}),this.p_arrMonthboss.forEach(function(e,t){e.on("touchend",function(){app.db.checkFuncUnLock(i[t],!0)&&app.pages.bigbattlembosspage.showPage(t)})})},setParam:function(){var e=this;this.p_arrMonthboss.forEach(function(t,a){if(i[a]){var n=app.db.checkFuncUnLock(i[a]);if(app.setSpriteState(t.getComponent(cc.Sprite),!n),t.getChildByName("mask").active=!n,e.p_arrMaskLabel[a].node.active=!n,!n){var r=app.db.getFuncLockInfo(i[a]);e.p_arrMaskLabel[a].string=langMgr.getString("bigBattlePage",0,r.LEVEL)}}}),this.m_nTime=0,this.refreshTime(),this.refreshReward(),app.runUnlockGuide("BIGBATTLE")},refreshUI:function(){n.refreshRed(this.p_nodeDaily.getChildByName("rednotice"))},refreshTime:function(){var e=(app.player.getServerTime()-app.player.create)/1e3,t=Math.floor(e/2592e3);e=(app.player.create+2592e6*(t+1)-app.player.getServerTime())/1e3;var a,i=gUtils.getDayHourMinSecStruct(e);a=i.d>0?i.d+langMgr.getString("public",12)+(i.h>0?i.h+langMgr.getString("public",13):""):i.h>0?i.h+langMgr.getString("public",13)+(i.m>0?i.m+langMgr.getString("public",14):""):(i.m>0?i.m+langMgr.getString("public",14):"")+i.s+langMgr.getString("public",15),this.p_arrLabelTime.forEach(function(e){e.string=a})},refreshReward:function(){for(var e=0;e<a.length;e++)for(var t=a[e],i=this.p_arrNode[e],n=0;n<t.length;n++){var r=cc.instantiate(this.p_itemPrefab);r.parent=i,r.getComponent("propItem").initForGsid(t[n])}},onClose:function(){this._super()},update:function(e){this.m_nTime+=e,this.m_nTime>=1&&(this.m_nTime=0,this.refreshTime())}});n.refreshRed=function(e){var t=!1;return app.db.checkFuncUnLock("BIGBATTLE",!1)&&(t=app.pages.bigbattlechapterpage.refreshRed(null,1)||app.pages.bigbattlechapterpage.refreshRed(null,2)||app.pages.bigbattlechapterpage.refreshRed(null,3)||!1),e&&(e.active=t),t},cc._RF.pop()},{basePage:void 0}],bookAwakenPage:[function(e,t){"use strict";cc._RF.push(t,"0d898xM17VHDrFM2jjlO0DW","bookAwakenPage");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=cc._decorator,o=r.ccclass,s=r.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_arrNodeTitle=[],t.p_nodeAwaken=null,t.p_nodeReset=null,t.p_nodeAwakenItem=[],t.p_nodeAwakenProp=null,t.p_nodeAwakenMianProp=null,t.p_nodeAwakenIntro=null,t.p_nodeAwakenSuit=null,t.p_nodeResetItem=null,t.p_nodeResetProp=null,t.p_arrNodeRandProp=[],t.p_arrNodeAwakenProp=[],t.p_arrSprLock=[],t.p_arrLockSprF=[],t.p_arrNodeCost=[],t.p_btnHelp=null,t.p_btnAwaken=null,t.p_arrBtnAwakenPreview=[],t.p_btnResetPreview=null,t.p_nodeBtnTx=[],t.p_btnCancel=null,t.p_btnOk=null,t.m_propKey=[],t.m_lockKey=[],t.m_lockKeyIndex=[],t.m_lockaattr=0,t.m_isReset=!1,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){var e=this;a.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.fitTopMenu(),this.p_btnAwaken.node.on("click",function(){app.playSound("click"),e.m_reset?e.reset():e.awaken()}),this.p_btnCancel.node.on("click",function(){app.playSound("click"),e.resetConfirm(0)}),this.p_btnOk.node.on("click",function(){app.playSound("click"),e.resetConfirm(1)}),this.p_arrSprLock.forEach(function(t){t.spriteFrame=e.p_arrLockSprF[0]}),this.p_arrSprLock.forEach(function(t,a){t.node.on("touchend",function(){if(!e.m_isReset){var t=e.m_lockaattr?e.m_lockKey.length+1:e.m_lockKey.length;if(a<3){var i=e.m_lockKey.indexOf(e.m_propKey[a]);if(i>-1)e.p_arrSprLock[a].spriteFrame=e.p_arrLockSprF[0],e.m_lockKey.splice(i,1),e.m_lockKeyIndex.splice(i,1);else{if(t>=3)return void app.showNotice(window.langMgr.getString("bookAwakenPage",8));e.p_arrSprLock[a].spriteFrame=e.p_arrLockSprF[1],e.m_lockKey.push(e.m_propKey[a]),e.m_lockKeyIndex.push({key:e.m_propKey[a],index:a})}}else{if(t>=3&&!e.m_lockaattr)return void app.showNotice(window.langMgr.getString("bookAwakenPage",8));e.m_lockaattr=1==e.m_lockaattr?0:1;var n=1==e.m_lockaattr?1:0;e.p_arrSprLock[3].spriteFrame=e.p_arrLockSprF[n]}t=e.m_lockaattr?e.m_lockKey.length+1:e.m_lockKey.length,e.m_cost=app.db.getRestCostByLockNum(t),e.refreshCost(e.m_cost)}})}),this.p_arrBtnAwakenPreview.forEach(function(t,a){t.node.on("click",function(){app.playSound("click");var t=app.db.getBBaseByGsid(e.m_bookInfo.gsid),i={type:a,pos:t.POS};app.pages.windowsPageBookAwakenPreview.showPage(i)})}),this.p_btnResetPreview.node.on("click",function(){app.playSound("click");var t={pos:app.db.getBBaseByGsid(e.m_bookInfo.gsid).POS};app.pages.windowsPageBookRandomPreview.showPage(t)}),this.p_btnHelp.node.on("click",function(){app.playSound("click"),e.m_reset?app.pages.windowspagetipshelp.showPage(1115):app.pages.windowspagetipshelp.showPage(1114)})},t.prototype.setParam=function(e){if(cc.log("now star up treas is ",e.gsid),this.m_strGuid=e.guid,this.m_type=e.type,this.m_reset=e.reset,this.m_previewProp=e.prop,this.m_strBookGuid=e.bookGuid,this.m_closeCb=e.closecb,this.m_strGuid&&1==this.m_type)for(var t=app.player.general[this.m_strGuid].book,a=0;a<t.length;a++)t[a]&&t[a].guid==this.m_strBookGuid&&(this.m_bookInfo=t[a]);else this.m_bookInfo=app.player.books[this.m_strBookGuid];this.p_btnAwaken.node.active=!0,this.p_btnCancel.node.active=!1,this.p_btnOk.node.active=!1,this.p_nodeBtnTx[0].active=!this.m_reset,this.p_nodeBtnTx[1].active=!!this.m_reset,this.m_reset?this.refreshReset():this.refreshAwaken()},t.prototype.refreshAwaken=function(){this.p_arrNodeTitle[0].active=!0,this.p_arrNodeTitle[1].active=!1,this.p_nodeReset.active=!1,this.p_nodeResetProp.active=!1,this.p_nodeAwaken.active=!0,this.p_nodeAwakenProp.active=!0;var e=app.db.getBBaseByGsid(this.m_bookInfo.gsid);this.p_nodeAwakenItem[0].getComponent("bookItem").refreshUI({book:{gsid:this.m_bookInfo.gsid,level:this.m_bookInfo.level,click:!0}}),this.p_nodeAwakenItem[1].getComponent("bookItem").refreshUI({book:{gsid:e.AWAKENGSID,level:this.m_bookInfo.level,click:!0}});var t=this.p_nodeAwakenMianProp.getChildByName("name").getComponent(cc.Label),a=this.p_nodeAwakenMianProp.getChildByName("old").getComponent(cc.Label),i=this.p_nodeAwakenMianProp.getChildByName("new").getComponent(cc.Label),n=app.db.getPropertyCnByEn(this.m_bookInfo.main[0].key);t.string=n;var r=e.PROP[0].VAL+e.ADDVALUE*(this.m_bookInfo.level-1),o=app.db.getBBaseByGsid(e.AWAKENGSID),s=o.PROP[0].VAL+o.ADDVALUE*(this.m_bookInfo.level-1),p=app.db.getPropertyIdByEn(this.m_bookInfo.main[0].key);p&&2==app.db.dbProperty[p].NUMTYPE&&(r=r/10+"%",s=s/10+"%"),a.string=r,i.string=s;var c=app.db.getSuitBookById(o.SUITID,o.STAR),h=this.p_nodeAwakenSuit.getChildByName("icon").getComponent(cc.Sprite),l=app.db.getBookSuitIconPath(o.SUITID,o.STAR);app.loadTexture(l,h,this.prefabPath);var g=this.p_nodeAwakenSuit.getChildByName("name").getComponent(cc.Label),d=this.p_nodeAwakenSuit.getChildByName("lab_tips").getComponent(cc.Label),u=app.db.getSuitSkillInfoBySuitId(c.SKILL[0]);g.string=u.INTRO,d.string=window.langMgr.getString("bookAwakenPage",0),this.p_nodeAwakenIntro.string=window.langMgr.getString("bookAwakenPage",1),this.m_cost=app.db.getAwakenCostByPos(e.POS),this.refreshCost(this.m_cost)},t.prototype.refreshReset=function(){this.p_nodeResetItem.getComponent("bookItem").refreshUI({book:{gsid:this.m_bookInfo.gsid,level:this.m_bookInfo.level,click:!0}}),this.p_arrNodeTitle[0].active=!1,this.p_arrNodeTitle[1].active=!0,this.p_nodeReset.active=!0,this.p_nodeResetProp.active=!0,this.p_nodeAwaken.active=!1,this.p_nodeAwakenProp.active=!1;var e=this.m_lockaattr?this.m_lockKey.length+1:this.m_lockKey.length;this.m_cost=app.db.getRestCostByLockNum(e),this.refreshLeft(),this.refreshCost(this.m_cost),this.refreshRight(this.m_previewProp)},t.prototype.refreshCost=function(e){for(var t=0;t<e.length;t++){var a=e[t],i=this.p_arrNodeCost[t];if(cc.isValid(i)){var n=i.getChildByName("cost_icon").getComponent(cc.Sprite),r=i.getChildByName("cost_normal").getComponent(cc.Label),o=i.getChildByName("cost_red").getComponent(cc.Label),s=app.db.getPropsIconPath(a.GSID);app.loadTexture(s,n,this.prefabPath),r.string=app.player.getCount(a.GSID)+"/"+a.COUNT,o.string=app.player.getCount(a.GSID)+"/"+a.COUNT,r.node.active=app.player.getCount(a.GSID)>=a.COUNT,o.node.active=app.player.getCount(a.GSID)<a.COUNT}else cc.warn("\u914d\u7f6e\u7ed3\u6784\u53d1\u751f\u53d8\u5316\uff0c\u9700\u8981\u91cd\u6784\u6d88\u8017\u4ee3\u7801")}},t.prototype.awaken=function(){var e=this;if(this.checkCost()){var t=1==this.m_type?this.m_strGuid:null;app.player.sfBookAwaken(t,this.m_strBookGuid,function(t,a){if(!t){var i={gsid:e.m_bookInfo.gsid,book:a.book};app.player.sfPlayerByParam(["books","props"],function(){app.pages.windowsPageBookAwakenSucc.showPage(i),e.onClose()})}})}},t.prototype.checkCost=function(){for(var e=this.m_cost,t=0;t<e.length;t++){var a=app.player.getCount(e[t].GSID);if(e[t].COUNT>a)return app.showNotice(window.langMgr.getString("generalRelivePage",5)),!1}return!0},t.prototype.reset=function(){var e=this;if(this.checkCost()){var t=1==this.m_type?this.m_strGuid:null;app.player.sfBookResetPreview(t,this.m_strBookGuid,this.m_lockKey,this.m_lockaattr,function(t,a){t||(e.m_previewProp=a.book,e.refreshRight(e.m_previewProp))})}},t.prototype.resetConfirm=function(e){var t=this;app.player.sfBookResetConfirm(this.m_strGuid,this.m_strBookGuid,e,function(a){if(!a){t.m_isReset=!1,t.m_lockKey=[],t.m_lockKeyIndex=[],t.m_lockaattr=0;for(var i=0;i<t.p_arrSprLock.length;i++)t.p_arrSprLock[i].spriteFrame=t.p_arrLockSprF[0];e&&(t.m_bookInfo=t.m_previewProp,app.player.sfPlayerByParam(["books","props"],function(){})),t.m_previewProp=null,t.refreshReset()}})},t.prototype.refreshLeft=function(){var e=this.m_bookInfo.rand;this.m_propKey=[];for(var t=0;t<e.length;t++){var a=this.p_arrNodeRandProp[t],i=e[t],n=a.getChildByName("name").getComponent(cc.Label),r=a.getChildByName("add_old").getComponent(cc.Label);this.m_propKey.push(i.key);var o=i.val[0],s=i.val[1],p=app.db.getPropertyCnByEn(i.key),c=app.db.getPropertyIdByEn(i.key);c&&2==app.db.dbProperty[c].NUMTYPE&&(o=o/10+"%",s=s/10+"%"),n.string=p+"+"+o,r.string=window.langMgr.getString("bookAwakenPage",2,s)}var h=this.m_bookInfo.awake[0],l=gConfig.getBookAwakenPropPath(h.key);app.loadTexture(l,this.p_arrNodeAwakenProp[0].getComponent(cc.Sprite),this.prefabPath)},t.prototype.refreshRight=function(e){void 0===e&&(e=null),e?(this.m_isReset=!0,this.p_btnAwaken.node.active=!1,this.p_btnCancel.node.active=!0,this.p_btnOk.node.active=!0):(this.p_btnAwaken.node.active=!0,this.p_btnCancel.node.active=!1,this.p_btnOk.node.active=!1);var t=e?e.rand:[];this.m_lockKey&&this.m_lockKey.length>0&&t&&this.setRightProp(t);for(var a=0;a<this.p_arrNodeRandProp.length;a++){var i=this.p_arrNodeRandProp[a],n=t[a],r=i.getChildByName("new").getComponent(cc.Label),o=i.getChildByName("add_new").getComponent(cc.Label),s=i.getChildByName("intro").getComponent(cc.Label);if(n){s.node.active=!1,r.node.active=!0,o.node.active=!0;var p=n.val[0],c=n.val[1],h=app.db.getPropertyCnByEn(n.key),l=app.db.getPropertyIdByEn(n.key);l&&2==app.db.dbProperty[l].NUMTYPE&&(p=p/10+"%",c=c/10+"%"),r.string=h+"+"+p,o.string=window.langMgr.getString("bookAwakenPage",2,c)}else s.node.active=!0,s.string=window.langMgr.getString("bookAwakenPage",3),r.node.active=!1,o.node.active=!1}var g=e&&e.awake[0];if(g){var d=gConfig.getBookAwakenPropPath(g.key);app.loadTexture(d,this.p_arrNodeAwakenProp[1].getComponent(cc.Sprite),this.prefabPath),this.p_arrNodeAwakenProp[1].active=!0,this.p_arrNodeAwakenProp[2].active=!1}else this.p_arrNodeAwakenProp[1].active=!1,this.p_arrNodeAwakenProp[2].active=!0,this.p_arrNodeAwakenProp[2].getComponent(cc.Label).string=window.langMgr.getString("bookAwakenPage",4)},t.prototype.setRightProp=function(e){for(var t=0;t<this.m_lockKeyIndex.length;t++)for(var a=0;a<e.length;a++)if(this.m_lockKeyIndex[t].key==e[a].key){var i=this.m_lockKeyIndex[t].index;if(i!=a){var n=e[a];e[a]=e[i],e[i]=n}}},t.prototype.onClose=function(){this.m_isReset?app.showNotice(window.langMgr.getString("bookAwakenPage",5)):(eventMgr.emit(eventStr.generalPageBook.RefreshBook),eventMgr.emit(eventStr.generalPageBook.RefreshBookBag),e.prototype.onClose.call(this))},t.prefabPath="bookAwakenPage",n([s(cc.Node)],t.prototype,"p_arrNodeTitle",void 0),n([s(cc.Node)],t.prototype,"p_nodeAwaken",void 0),n([s(cc.Node)],t.prototype,"p_nodeReset",void 0),n([s(cc.Node)],t.prototype,"p_nodeAwakenItem",void 0),n([s(cc.Node)],t.prototype,"p_nodeAwakenProp",void 0),n([s(cc.Node)],t.prototype,"p_nodeAwakenMianProp",void 0),n([s(cc.Label)],t.prototype,"p_nodeAwakenIntro",void 0),n([s(cc.Node)],t.prototype,"p_nodeAwakenSuit",void 0),n([s(cc.Node)],t.prototype,"p_nodeResetItem",void 0),n([s(cc.Node)],t.prototype,"p_nodeResetProp",void 0),n([s(cc.Node)],t.prototype,"p_arrNodeRandProp",void 0),n([s(cc.Node)],t.prototype,"p_arrNodeAwakenProp",void 0),n([s(cc.Sprite)],t.prototype,"p_arrSprLock",void 0),n([s(cc.SpriteFrame)],t.prototype,"p_arrLockSprF",void 0),n([s(cc.Node)],t.prototype,"p_arrNodeCost",void 0),n([s(cc.Button)],t.prototype,"p_btnHelp",void 0),n([s(cc.Button)],t.prototype,"p_btnAwaken",void 0),n([s(cc.Button)],t.prototype,"p_arrBtnAwakenPreview",void 0),n([s(cc.Button)],t.prototype,"p_btnResetPreview",void 0),n([s(cc.Node)],t.prototype,"p_nodeBtnTx",void 0),n([s(cc.Button)],t.prototype,"p_btnCancel",void 0),n([s(cc.Button)],t.prototype,"p_btnOk",void 0),a=n([o],t)}(e("basePage"));t.exports=p,cc._RF.pop()},{basePage:void 0}],bookCompoundPage:[function(e,t){"use strict";cc._RF.push(t,"bb48bn36v9PVaus35E7fsMA","bookCompoundPage");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=cc._decorator,o=r.ccclass,s=r.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_labSelect=null,t.p_labHit=null,t.p_labLongClick=null,t.p_nodeMain=null,t.p_nodeSelect=null,t.p_arrNodeCostItem=[],t.p_tabView=null,t.p_btnChanage=null,t.p_btnSelect=null,t.p_btnCom=null,t.p_arrNodePos=[],t.p_arrNodePosLight=[],t.p_btnHelp=null,t.pfbPropItem=null,t.propContent=null,t.m_selectPos=0,t.m_selectStar=0,t.m_selectBookGsid=null,t.m_selectNode=null,t.m_selectData=[],t.m_arrShowData=null,t._nodeMainItem=null,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){var e=this;a.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.fitTopMenu(),this.p_btnSelect.node.on("click",function(){app.playSound("click"),e.onClickOneKey()}),this.p_btnCom.node.on("click",function(){app.playSound("click"),app.player.sfBookCom(e.m_selectBookGsid,e.m_selectData,function(t,a){if(!t){var i=[];e.m_selectStar=0,a.book.count=1,i.push(a.book);for(var n=0;n<a.items.length;n++)i.push(a.items[n]);var r={showtype:1,reward:i,confirmcb:function(){app.player.sfPlayerByParam(["books"],function(){e.init()})},target:e};app.pages.windowspagereward.showPage(r)}})}),this.p_arrNodePos.forEach(function(t,a){t.on("touchend",function(){app.playSound("click"),e.clickPos(a)})}),this.p_nodeMain.on("touchend",function(){app.playSound("click"),app.pages.bookPickPage.showPage({target:e,gsid:e.m_selectBookGsid})}),this.p_btnChanage.node.on("click",function(){app.playSound("click"),app.pages.bookPickPage.showPage({target:e,gsid:e.m_selectBookGsid})}),this.p_btnHelp.node.on("click",function(){app.playSound("click"),app.pages.windowspagetipshelp.showPage(1112)})},t.prototype.setParam=function(){this.init(),this.p_btnCom.interactable=!1},t.prototype.init=function(){this.p_labLongClick.string=langMgr.getString("bookCompoundPage",1),this.p_labSelect.string=langMgr.getString("bookCompoundPage",2),this.p_nodeMain.active=!0,this.p_nodeSelect.active=!1,this.p_btnSelect.node.active=!1,this.p_btnCom.node.active=!1,this.setData(),this.refreshView()},t.prototype.refreshSelectMain=function(){var e=this;this.p_nodeMain.active=!1,this.p_nodeSelect.active=!0,this.p_btnSelect.node.active=!0,this.p_btnCom.node.active=!0,cc.isValid(this._nodeMainItem)||(this._nodeMainItem=cc.instantiate(this.pfbPropItem),this.propContent.addChild(this._nodeMainItem),this._nodeMainItem.setPosition(cc.Vec2.ZERO),this._nodeMainItem.on(cc.Node.EventType.TOUCH_END,function(){app.playSound("click"),app.pages.windowsPageTipsBook.showPage({gsid:e.m_selectBookGsid,type:3})})),this._nodeMainItem.getComponent("propItem").initForGsid(this.m_selectBookGsid);var t=app.db.getBBaseByGsid(this.m_selectBookGsid);this.m_selectStar=t.STAR,this.m_selectData=[],this.setData(),this.refreshView(),this.refreshCostItem()},t.prototype.refreshCostItem=function(){for(var e=0;e<this.p_arrNodeCostItem.length;e++){var t=this.p_arrNodeCostItem[e];if(!t)return;var a=this.m_selectData[e];if(t.active=!!a,a){var i=app.player.books[a];t.getComponent("bookItem").refreshUI({book:i,type:3})}}this.p_btnCom.interactable=this.m_selectData&&this.m_selectData.length>=3},t.prototype.itemClickHandler=function(e,t){if("plus"==t)this.m_selectData.push(e.guid);else{var a=this.m_selectData.indexOf(e.guid);this.m_selectData.splice(a,1)}this.refreshCostItem()},t.prototype.clickPos=function(e){this.p_arrNodePosLight.forEach(function(t,a){t.active=a==e}),this.m_selectPos=e,this.setData(),this.refreshView()},t.prototype.setData=function(){var e=app.player.books,t=[];for(var a in e){for(var i=e[a].gsid,n=0,r=0;r<this.m_selectData.length;r++)a==this.m_selectData[r]&&(n=1);var o={gsid:i,guid:a,count:1,picked:n},s=app.db.getBBaseByGsid(i);this.m_selectStar==s.STAR&&(this.m_selectPos?s.POS==this.m_selectPos&&t.push(o):t.push(o))}t.sort(function(e,t){var a=app.db.getBBaseByGsid(e.gsid),i=app.db.getBBaseByGsid(t.gsid);return a.STAR>i.STAR?1:a.STAR==i.STAR&&e.gsid>t.gsid?1:-1}),this.m_arrShowData=t},t.prototype.refreshView=function(){var e=this.m_arrShowData.length;this.p_tabView.getComponent("tableView").initTableView(e,{array:this.m_arrShowData,target:this,len:3})},t.prototype.onClickOneKey=function(){for(var e=0;e<this.m_arrShowData.length&&this.m_selectData.length<3;++e){var t=this.m_arrShowData[e];t.picked||(t.picked=1,this.itemClickHandler({gsid:t.gsid,guid:t.guid,count:1},"plus"))}this.refreshView()},t.prototype.onClose=function(){eventMgr.emit(eventStr.generalPageBook.RefreshBook),eventMgr.emit(eventStr.generalPageBook.RefreshBookBag),e.prototype.onClose.call(this)},t.prefabPath="bookCompoundPage",n([s(cc.Label)],t.prototype,"p_labSelect",void 0),n([s(cc.Label)],t.prototype,"p_labHit",void 0),n([s(cc.Label)],t.prototype,"p_labLongClick",void 0),n([s(cc.Node)],t.prototype,"p_nodeMain",void 0),n([s(cc.Node)],t.prototype,"p_nodeSelect",void 0),n([s(cc.Node)],t.prototype,"p_arrNodeCostItem",void 0),n([s(cc.Node)],t.prototype,"p_tabView",void 0),n([s(cc.Button)],t.prototype,"p_btnChanage",void 0),n([s(cc.Button)],t.prototype,"p_btnSelect",void 0),n([s(cc.Button)],t.prototype,"p_btnCom",void 0),n([s(cc.Node)],t.prototype,"p_arrNodePos",void 0),n([s(cc.Node)],t.prototype,"p_arrNodePosLight",void 0),n([s(cc.Button)],t.prototype,"p_btnHelp",void 0),n([s(cc.Prefab)],t.prototype,"pfbPropItem",void 0),n([s(cc.Node)],t.prototype,"propContent",void 0),a=n([o],t)}(e("basePage"));t.exports=p,cc._RF.pop()},{basePage:void 0}],bookPickPage:[function(e,t){"use strict";cc._RF.push(t,"78c91mmeC9J6ZW/lcFf4L8p","bookPickPage");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=cc._decorator,o=r.ccclass,s=r.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_tabView=null,t.p_nodeSkill=null,t.p_sprSkillIcon=null,t.p_labSkillIntro=null,t.p_btnOk=null,t.p_nodeSelectStar=null,t.p_nodeMoreStar=null,t.p_arrNodeStar=[],t.p_labStar=null,t.m_selectStar=0,t.m_arrShowData=null,t.m_target=null,t.m_selectGsid=0,t.m_chooseIndex=-1,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){var e=this;a.instance=this,this.creatMask(!0),this.stopBgNodeEvent(),this.handleUI(),this.p_btnOk.node.on("click",function(){app.playSound("click"),e.m_target.m_selectBookGsid=e.m_selectGsid,e.m_target.refreshSelectMain(),e.onClose()}),this.p_nodeSelectStar.on("touchend",function(){app.playSound("click"),e.p_nodeMoreStar.active=!e.p_nodeMoreStar.active,e.p_nodeSelectStar.rotation=e.p_nodeMoreStar.active?180:0}),this.p_arrNodeStar.forEach(function(t,a){t.on("touchend",function(){app.playSound("click"),e.p_nodeMoreStar.active=!1,e.clickStar(a)})})},t.prototype.setParam=function(e){this.p_nodeSkill.active=!1,this.m_target=e.target,this.m_selectGsid=e.gsid,this.clickStar(0),this.setData(),this.m_selectGsid||(this.m_selectGsid=this.m_arrShowData[0]),this.refreshView(),this.itemClickHandler()},t.prototype.clickStar=function(e){var t;switch(this.m_selectStar=e,e){case 0:t=window.langMgr.getString("bookResolvePage",2);break;case 1:t=window.langMgr.getString("bookResolvePage",3);break;case 2:t=window.langMgr.getString("bookResolvePage",4);break;case 3:t=window.langMgr.getString("bookResolvePage",5);break;case 4:t=window.langMgr.getString("bookResolvePage",6);break;case 5:t=window.langMgr.getString("bookResolvePage",7)}this.p_labStar.string=t,this.setData(),this.refreshView()},t.prototype.itemClickHandler=function(){if(this.m_selectGsid){this.p_nodeSkill.active=!0;var e=app.db.getBBaseByGsid(this.m_selectGsid),t=app.db.getSuitBookById(e.SUITID,e.STAR),a=app.db.getBookSuitIconPath(e.SUITID,e.STAR),i=app.db.getSuitSkillInfoBySuitId(t.SKILL[0]);app.loadTexture(a,this.p_sprSkillIcon,this.prefabPath),this.p_labSkillIntro.string=i.INTRO}else this.p_nodeSkill.active=!1},t.prototype.setData=function(){var e=app.db.getBookList(),t=[];for(var a in e){var i=e[a].GSID,n=app.db.getBBaseByGsid(i);n.STAR>=6||(this.m_selectStar?n.STAR==this.m_selectStar&&t.push(i):t.push(i))}t.sort(function(e,t){var a=app.db.getBBaseByGsid(e),i=app.db.getBBaseByGsid(t);return a.STAR>i.STAR?1:a.STAR==i.STAR&&e>t?1:-1}),this.m_arrShowData=t},t.prototype.itemPorpClick=function(e,t){if(e==this.m_chooseIndex)return!0;this.m_chooseItem&&(cc.log("handle choose item"),this.m_chooseItem.selected(!1,this.m_chooseIndex)),this.m_chooseItem=t,this.m_chooseIndex=e,this.p_nodeSkill.active=!0,this.m_selectGsid=this.m_arrShowData[e];var a=app.db.getBBaseByGsid(this.m_selectGsid),i=app.db.getSuitBookById(a.SUITID,a.STAR),n=app.db.getBookSuitIconPath(a.SUITID,a.STAR),r=app.db.getSuitSkillInfoBySuitId(i.SKILL[0]);return app.loadTexture(n,this.p_sprSkillIcon,this.prefabPath),this.p_labSkillIntro.string=r.INTRO,!0},t.prototype.refreshView=function(){var e=this,t=this.m_arrShowData.indexOf(this.m_selectGsid),a=this.m_arrShowData.length;this.m_chooseIndex=null,this.m_chooseItem=null,this.m_arrChooseIndex=[],this.p_tabView.getComponent("tableView").initTableView(a,{array:this.m_arrShowData,maxpick:1,initfun:"initForBook",target:this,gsid:this.m_selectGsid,selectIndex:t},function(){e.scrollToPick(e.m_selectGsid),e.scheduleOnce(function(){eventMgr.emit(eventStr.propTabvItem.EVT_DEFAULT_SELECT)},.1)})},t.prototype.scrollToPick=function(e){var t=this.m_arrShowData.indexOf(e);if(!(t<0)){var a=this.p_tabView.getComponent("tableView"),i=a.getScrollOffset().y,n=a.cell.data.height,r=a._groupCellCount,o=Math.floor(t/r),s=0!=o?a.top:0,p=(n+a.spacingY)*o+s;p>i&&a.scrollToOffset(cc.v2(0,p),0)}},t.pageType=1,t.prefabPath="bookPickPage",n([s(cc.Node)],t.prototype,"p_tabView",void 0),n([s(cc.Node)],t.prototype,"p_nodeSkill",void 0),n([s(cc.Sprite)],t.prototype,"p_sprSkillIcon",void 0),n([s(cc.Label)],t.prototype,"p_labSkillIntro",void 0),n([s(cc.Button)],t.prototype,"p_btnOk",void 0),n([s(cc.Node)],t.prototype,"p_nodeSelectStar",void 0),n([s(cc.Node)],t.prototype,"p_nodeMoreStar",void 0),n([s(cc.Node)],t.prototype,"p_arrNodeStar",void 0),n([s(cc.Label)],t.prototype,"p_labStar",void 0),a=n([o],t)}(e("basePage"));t.exports=p,cc._RF.pop()},{basePage:void 0}],bookResetPage:[function(e,t){"use strict";cc._RF.push(t,"db6c061DTtDBYRnnVwtoWXP","bookResetPage");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=cc._decorator,o=r.ccclass,s=r.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_nodeItem=null,t.p_labName=null,t.p_arrNodeProp=[],t.p_arrNodeRProp=[],t.p_labAwaken=[],t.p_arrNodeLock=[],t.p_arrNodeCost=[],t.p_btnHelp=[],t.p_btnRest=null,t.p_btnCancel=null,t.p_btnOk=null,t.m_strGuid=null,t.m_strBookGuid=null,t.m_closeCb=null,t.m_bookInfo=null,t.m_lockData=[],t.m_previewProp=null,t.m_cost=null,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){var e=this;a.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.p_arrNodeLock.forEach(function(t,a){t.on("touchend",function(){e.m_lockData.indexOf(a)>-1?e.m_lockData.splice(e.m_lockData.indexOf(a),1):e.m_lockData.push(a),e.refreshCost()})}),this.p_btnCancel.node.on("click",function(){app.playSound("click"),e.resetConfirm(0)}),this.p_btnOk.node.on("click",function(){app.playSound("click"),e.resetConfirm(1)}),this.p_btnRest.node.on("click",function(){app.playSound("click"),app.player.sfBookResetGet(null,e.m_strBookGuid,e.m_cost,function(t,a){e.refreshRight(a.book)})})},t.prototype.setParam=function(e){cc.log("now star up treas is ",e.gsid),this.m_strGuid=e.guid,this.m_strBookGuid=e.bookGuid,this.m_previewProp=e.prop,this.m_closeCb=e.closecb,this.m_bookInfo=this.m_strGuid?app.player.general[this.m_strGuid].book:app.player.books[this.m_strBookGuid],this.refreshTarget(),this.refreshLeft(),this.refreshCost(),this.refreshRightUI(this.m_previewProp)},t.prototype.refreshTarget=function(){this.p_nodeItem.getComponent("propItem").initForGsid(this.m_bookInfo.gsid);var e=app.db.getBBaseByGsid(this.m_gsid);this.p_labName.string=e.NAME},t.prototype.refreshCost=function(){this.m_cost=app.db.getRestCostByLockNum(this.m_lockData.length);for(var e=0;e<this.m_cost.length;e++){var t=this.m_cost[e],a=this.p_arrNodeCost[e];a.active=!0;var i=a.getChildByName("icon").getComponent(cc.Sprite),n=a.getChildByName("numHave").getComponent(cc.Label),r=a.getChildByName("numNeed").getComponent(cc.Label),o=app.db.getPropsIconPath(t.GSID);app.loadTexture(o,i,this.prefabPath),n.string=""+app.player.getCount(t.GSID),r.string="/"+t.COUNT}},t.prototype.refreshLeft=function(){for(var e=this.m_bookInfo.rand,t=0;t<e.length;t++){var a=this.p_arrNodeProp[t],i=e[t],n=a.getChildByName("tx_key").getComponent(cc.Label),r=a.getChildByName("val_add").getComponent(cc.Label),o=i.val[0],s=i.val[1],p=app.db.getPropertyIdByEn(i.key);p&&2==app.db.dbProperty[p].NUMTYPE&&(o=o/10+"%",s=s/10+"%"),n.string=p+"+"+o,r.string="(\u5f3a\u5316\u63d0\u5347+"+s+")"}var c=this.m_bookInfo.awake[0],h=app.db.getPropertyIdByEn(c.key),l=c.val;h&&2==app.db.dbProperty[h].NUMTYPE&&(l=l/10+"%"),this.p_labAwaken[0].string=h+"+"+l},t.prototype.refreshRight=function(e){if(!e)return this.p_btnRest.node.active=!0,this.p_btnCancel.node.active=!1,void(this.p_btnOk.node.active=!1);for(var t=e.rand,a=0;a<t.length;a++){var i=this.p_arrNodeRProp[a],n=t[a],r=i.getChildByName("tx_key").getComponent(cc.Label),o=i.getChildByName("val_add").getComponent(cc.Label),s=n.val[0],p=n.val[1],c=app.db.getPropertyIdByEn(n.key);c&&2==app.db.dbProperty[c].NUMTYPE&&(s=s/10+"%",p=p/10+"%"),r.string=c+"+"+s,o.string="(\u5f3a\u5316\u63d0\u5347+"+p+")"}var h=e.awake[0],l=app.db.getPropertyIdByEn(h.key),g=h.val;l&&2==app.db.dbProperty[l].NUMTYPE&&(g=g/10+"%"),this.p_labAwaken[1].string=l+"+"+g,this.p_btnRest.node.active=!1,this.p_btnCancel.node.active=!0,this.p_btnOk.node.active=!0},t.prototype.resetConfirm=function(e){var t=this;app.player.sfTreasResetConfirm(this.m_general,this.m_guid,e,function(a,i){a||(e&&(t.m_bookInfo=i.book),t.m_lockData=[],t.refreshUI(),t.refreshRight(null),t.refreshCost())})},t.prefabPath="bookResetPage",n([s(cc.Node)],t.prototype,"p_nodeItem",void 0),n([s(cc.Label)],t.prototype,"p_labName",void 0),n([s(cc.Node)],t.prototype,"p_arrNodeProp",void 0),n([s(cc.Node)],t.prototype,"p_arrNodeRProp",void 0),n([s(cc.Label)],t.prototype,"p_labAwaken",void 0),n([s(cc.Node)],t.prototype,"p_arrNodeLock",void 0),n([s(cc.Node)],t.prototype,"p_arrNodeCost",void 0),n([s(cc.Button)],t.prototype,"p_btnHelp",void 0),n([s(cc.Button)],t.prototype,"p_btnRest",void 0),n([s(cc.Button)],t.prototype,"p_btnCancel",void 0),n([s(cc.Button)],t.prototype,"p_btnOk",void 0),a=n([o],t)}(e("basePage"));t.exports=p,cc._RF.pop()},{basePage:void 0}],bookResolvePage:[function(e,t){"use strict";cc._RF.push(t,"1e332hs62xGZIm/3axJnPWT","bookResolvePage");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=this&&this.__awaiter||function(e,t,a,i){return new(a||(a=Promise))(function(n,r){function o(e){try{p(i.next(e))}catch(t){r(t)}}function s(e){try{p(i.throw(e))}catch(t){r(t)}}function p(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(o,s)}p((i=i.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var a,i,n,r,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(e){return function(t){return p([e,t])}}function p(r){if(a)throw new TypeError("Generator is already executing.");for(;o;)try{if(a=1,i&&(n=2&r[0]?i.return:r[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,r[1])).done)return n;switch(i=0,n&&(r=[2&r[0],n.value]),r[0]){case 0:case 1:n=r;break;case 4:return o.label++,{value:r[1],done:!1};case 5:o.label++,i=r[1],r=[0];continue;case 7:r=o.ops.pop(),o.trys.pop();continue;default:if(!(n=(n=o.trys).length>0&&n[n.length-1])&&(6===r[0]||2===r[0])){o=0;continue}if(3===r[0]&&(!n||r[1]>n[0]&&r[1]<n[3])){o.label=r[1];break}if(6===r[0]&&o.label<n[1]){o.label=n[1],n=r;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(r);break}n[2]&&o.ops.pop(),o.trys.pop();continue}r=t.call(e,o)}catch(s){r=[6,s],i=0}finally{a=n=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},s=cc._decorator,p=s.ccclass,c=s.property,h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_labLongClick=null,t.p_tabView=null,t.p_nodeContent=null,t.p_nodeGirl=null,t.p_btnSelect=null,t.p_btnResolve=null,t.p_arrNodePos=[],t.p_arrNodePosLight=[],t.p_nodeSelectStar=null,t.p_nodeMoreStar=null,t.p_arrNodeSelectSatr=[],t.p_labStar=null,t.p_btnHelp=null,t.pfbPropItem=null,t.m_selectPos=0,t.m_selectStar=0,t.m_selectData=[],t.m_arrShowData=null,t._propList=[],t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){var e=this;a.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.fitTopMenu(),this.p_btnSelect.node.on("click",function(){app.playSound("click"),e.onClickBtnPick()}),this.p_btnResolve.node.on("click",function(){if(app.playSound("click"),e.m_selectData.length){var t=function(){app.player.sfBookDecomp(e.m_selectData,function(t,a){if(!t){var i=a.items;e.m_selectData=[];var n={showtype:1,reward:i,confirmcb:function(){app.player.sfPlayerByParam(["books"],function(){e.refreshUI()})},target:e};app.pages.windowspagereward.showPage(n)}})};if(e.checkStar()){var a={content:window.langMgr.getString("bookResolvePage",9),confirmcb:function(){t()},cancelcb:function(){},target:e};app.pages.windowspagetipsmsg.showPage(a)}else t()}}),this.p_arrNodePos.forEach(function(t,a){t.on("touchend",function(){app.playSound("click"),e.clickPos(a)})}),this.p_nodeSelectStar.on("touchend",function(){app.playSound("click"),e.p_nodeMoreStar.active=!e.p_nodeMoreStar.active,e.p_nodeSelectStar.angle=e.p_nodeMoreStar.active?0:180}),this.p_arrNodeSelectSatr.forEach(function(t,a){t.on("touchend",function(){app.playSound("click"),e.clickStar(a)})}),this.p_btnHelp.node.on("click",function(){app.playSound("click"),app.pages.windowspagetipshelp.showPage(1110)})},t.prototype.setParam=function(){this.p_labLongClick.string=window.langMgr.getString("bookResolvePage",0),this.refreshUI(),this.p_labStar.string=window.langMgr.getString("bookResolvePage",2)},t.prototype.refreshUI=function(){this.p_btnResolve.interactable=!1,this.p_nodeGirl.active=!0,this.p_nodeContent.parent.active=!1,this.setData(),this.refreshView(),this.refreshCoin()},t.prototype.refreshCoin=function(){this.node.getComponent("currency").refreshCoin([{gsid:30092},{gsid:30093},{gsid:30094}])},t.prototype.clickStar=function(e){var t;switch(this.p_nodeMoreStar.active=!1,this.m_selectStar=e,this.setData(),this.refreshView(),e){case 0:t=window.langMgr.getString("bookResolvePage",2);break;case 1:t=window.langMgr.getString("bookResolvePage",3);break;case 2:t=window.langMgr.getString("bookResolvePage",4);break;case 3:t=window.langMgr.getString("bookResolvePage",5);break;case 4:t=window.langMgr.getString("bookResolvePage",6);break;case 5:t=window.langMgr.getString("bookResolvePage",7);break;case 6:t=window.langMgr.getString("bookResolvePage",8)}this.p_labStar.string=t},t.prototype.clickPos=function(e){this.p_arrNodePosLight.forEach(function(t,a){t.active=a==e}),this.m_selectPos=e,this.setData(),this.refreshView()},t.prototype.setData=function(){var e=app.player.books,t=[];for(var a in e){for(var i=0,n=0;n<this.m_selectData.length;n++)a==this.m_selectData[n]&&(i=1);var r=e[a].gsid,o={gsid:r,guid:a,count:1,picked:i},s=app.db.getBBaseByGsid(r);this.m_selectPos&&this.m_selectStar?s.POS==this.m_selectPos&&this.m_selectStar==s.STAR&&t.push(o):this.m_selectPos?s.POS==this.m_selectPos&&t.push(o):this.m_selectStar?s.STAR==this.m_selectStar&&t.push(o):t.push(o)}t.sort(function(e,t){var a=app.player.books[e.guid],i=app.player.books[t.guid],n=app.db.getBBaseByGsid(a.gsid),r=app.db.getBBaseByGsid(i.gsid);return n.STAR>r.STAR?1:n.STAR==r.STAR&&a.level>i.level?1:-1}),this.m_arrShowData=t},t.prototype.refreshView=function(){var e=this.m_arrShowData.length;this.p_tabView.getComponent("tableView").initTableView(e,{array:this.m_arrShowData,target:this,len:10})},t.prototype.onClickBtnPick=function(){for(var e=this.m_selectData.length,t=0;e<10&&t<this.m_arrShowData.length;++t)if(!this.m_arrShowData[t].picked){var a=this.m_arrShowData[t].guid;this.m_arrShowData[t].picked=1,e++,this.m_selectData.push(a)}this.refreshView(),this.getPreview()},t.prototype.getPreview=function(){var e=this;this.p_btnResolve.interactable=!!this.m_selectData.length,this.m_selectData.length?app.player.sfBookDecompPreview(this.m_selectData,function(t,a){t||e.refreshItemsView(a.items)}):this.refreshItemsView([])},t.prototype.refreshItemsView=function(e){return r(this,void 0,void 0,function(){var t,a,i,n,r;return o(this,function(o){switch(o.label){case 0:if(e.length<=0)return this.p_nodeContent.parent.active=!1,this.p_nodeGirl.active=!0,[2];this.p_nodeContent.parent.active=!0,this.p_nodeGirl.active=!1,o.label=1;case 1:return o.trys.push([1,4,,5]),cc.isValid(this.pfbPropItem)?[3,3]:(t=this,[4,app.loadPropItem()]);case 2:t.pfbPropItem=o.sent(),o.label=3;case 3:return[3,5];case 4:return a=o.sent(),cc.error(a),[3,5];case 5:for(r=0;r<e.length;r++)i=this._propList[r],cc.isValid(i)||(i=cc.instantiate(this.pfbPropItem),this.p_nodeContent.addChild(i),this._propList[r]=i),i.active=!0,n=e[r],i.getComponent("propItem").initForBag(n),i.getComponent("propItem").setClick(!0);for(r=e.length;r<this._propList.length;r++)this._propList[r].active=!1;return[2]}})})},t.prototype.itemClickHandler=function(e,t){if("plus"==t&&this.m_selectData.push(e.guid),"minus"==t){var a=this.m_selectData.indexOf(e.guid);this.m_selectData.splice(a,1)}this.getPreview()},t.prototype.checkStar=function(){for(var e=0;e<this.m_selectData.length;e++){var t=app.player.books[this.m_selectData[e]];if(app.db.getBBaseByGsid(t.gsid).STAR>4)return!0}return!1},t.prototype.onClose=function(){eventMgr.emit(eventStr.generalPageBook.RefreshBook),eventMgr.emit(eventStr.generalPageBook.RefreshBookBag),e.prototype.onClose.call(this)},t.prefabPath="bookResolvePage",n([c(cc.Label)],t.prototype,"p_labLongClick",void 0),n([c(cc.Node)],t.prototype,"p_tabView",void 0),n([c(cc.Node)],t.prototype,"p_nodeContent",void 0),n([c(cc.Node)],t.prototype,"p_nodeGirl",void 0),n([c(cc.Button)],t.prototype,"p_btnSelect",void 0),n([c(cc.Button)],t.prototype,"p_btnResolve",void 0),n([c(cc.Node)],t.prototype,"p_arrNodePos",void 0),n([c(cc.Node)],t.prototype,"p_arrNodePosLight",void 0),n([c(cc.Node)],t.prototype,"p_nodeSelectStar",void 0),n([c(cc.Node)],t.prototype,"p_nodeMoreStar",void 0),n([c(cc.Node)],t.prototype,"p_arrNodeSelectSatr",void 0),n([c(cc.Label)],t.prototype,"p_labStar",void 0),n([c(cc.Button)],t.prototype,"p_btnHelp",void 0),a=n([p],t)}(e("basePage"));t.exports=h,cc._RF.pop()},{basePage:void 0}],bookSkillPreviewPage:[function(e,t){"use strict";cc._RF.push(t,"e9c19/o4DZORbZ/wqA4JiVP","bookSkillPreviewPage");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=cc._decorator,o=r.ccclass,s=r.property,p=e("basePage"),c=[new cc.Color(37,133,16),new cc.Color(104,55,9)],h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_labSuitName=null,t.p_labOpenIntro=null,t.p_sprSkillIcon=null,t.p_arrLabSkillIntro=[],t.p_labStarIntro=null,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.creatMask(!0)},t.prototype.setParam=function(e){this.m_suitId=e.suitId,this.m_skillId=e.skillId,this.refreshUI()},t.prototype.refreshUI=function(){this.p_labOpenIntro.string=window.langMgr.getString("bookSkillPreviewPage",0),this.p_labStarIntro.string=window.langMgr.getString("bookSkillPreviewPage",1);var e=app.db.getSuitBookById(this.m_suitId,1);this.p_labSuitName.string=e.NAME;for(var t=this.setData(),a=0;a<t.length;a++){var i=this.p_arrLabSkillIntro[a],n=app.db.getSuitSkillInfoBySuitId(t[a]);i.string=n.INTRO,t[a]==this.m_skillId?i.node.color=c[0]:i.node.color=c[1]}var r=app.db.getBookSuitIconPath(this.m_suitId,1);app.loadTexture(r,this.p_sprSkillIcon,this.prefabPath)},t.prototype.setData=function(){for(var e=app.db.getArrSuitBySuitId(this.m_suitId),t=[],a=0;a<e.length;a++)t.push(e[a].SKILL[0]);return t},t.prefabPath="bookSkillPreviewPage",t.pageType=1,n([s(cc.Label)],t.prototype,"p_labSuitName",void 0),n([s(cc.Label)],t.prototype,"p_labOpenIntro",void 0),n([s(cc.Sprite)],t.prototype,"p_sprSkillIcon",void 0),n([s(cc.Label)],t.prototype,"p_arrLabSkillIntro",void 0),n([s(cc.Label)],t.prototype,"p_labStarIntro",void 0),a=n([o],t)}(p);t.exports=h,cc._RF.pop()},{basePage:void 0}],bountyCZJJPage:[function(e,t){"use strict";cc._RF.push(t,"f66bbqTVj9L57/gclmm8416","bountyCZJJPage");var a=[{page:"rechargewelfarepageczjj",pageParam:null,coin:[38005,38006]},{page:"rechargewelfarepagesljj",pageParam:null,coin:[38005,38006]}],i=cc.Class({extends:e("basePage"),statics:{prefabPath:"bountyczjjpage",pageParent:"premiumpage"},properties:{p_arrNode:[cc.Node],p_arrBtnNode:[cc.Node],p_nodeBg:cc.Node,p_arrNodeRed:[cc.Node]},onEnable:function(){this._super(),eventMgr.on(eventStr.redEvent.RefreshPremiumRed,this.refreshRed,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.redEvent.RefreshPremiumRed,this.refreshRed,this)},onLoad:function(){i.instance=this,this.stopBgNodeEvent(),this.handleUI()},handleUI:function(){var e=this;this.p_arrBtnNode.forEach(function(t,a){t.on("click",function(){e.onClickMenu(a)})})},setParam:function(e){void 0===e&&(e=0),this.refreshRed(),(e>1||null==e)&&(e=0),this.onClickMenu(e)},start:function(){},refreshRed:function(){this.p_arrNodeRed.forEach(function(e,t){app.pages[a[t].page].refreshRed(e)})},onClickMenu:function(e){this.p_arrBtnNode.forEach(function(t,a){t.getChildByName("pick").active=e==a}),this.currentPageData=a[e],this.openShopPage()},refreshCoinUI:function(){app.pages.premiumpage.instance.refreshCoinUI(),this.refreshRed()},openShopPage:function(){var e=this;if(this.currentPageData&&this.currentPageData.page){this.canSelectMenu=!1;var t=app.pages[this.currentPageData.page],a=function(){t.showPage(e.currentPageData.pageParam,e.p_nodeBg,function(a){a?e.canSelectMenu=!0:(e.m_showPage=t.instance,t.instance.p_bgNode?(e.m_showPageNode=e.m_showPage.p_bgNode,e.m_showPageNode.opacity=0,e.m_showPageNode.runAction(cc.sequence(cc.fadeIn(.15),cc.callFunc(function(){e.canSelectMenu=!0})))):e.canSelectMenu=!0)})};if(this.m_showPage){if(this.m_showPage.node.active=!0,this.m_showPageNode=this.m_showPage.p_bgNode,!this.m_showPageNode)return this.m_showPage.onClose(),this.m_showPage=null,void a();this.m_showPageNode.runAction(cc.sequence(cc.fadeOut(.1),cc.callFunc(function(){e.m_showPage.onClose(),e.m_showPage=null,a()})))}else a()}},onClose:function(){app.pages[this.currentPageData.page].instance&&cc.isValid(app.pages[this.currentPageData.page].instance.node)&&app.pages[this.currentPageData.page].instance.onClose(),this._super()}});i.refreshRed=function(e){for(var t=!1,i=0;i<a.length;i++)t||(t=app.pages[a[i].page].refreshRed());return e&&(e.active=t),t},cc._RF.pop()},{basePage:void 0}],bountyPage:[function(e,t){"use strict";cc._RF.push(t,"45b219/4CdLCbyhYWNgXCFJ","bountyPage");var a=[{page:"rechargebountypage",pageParam:null,coin:[38005,38006]},{page:"expeditionbountypage",pageParam:null,coin:[38005,38006]}],i=cc.Class({extends:e("basePage"),statics:{prefabPath:"bountypage",pageParent:"premiumpage"},properties:{p_arrBtnNode:[cc.Node],p_nodeBg:cc.Node,p_arrNodeRed:[cc.Node]},onEnable:function(){this._super(),eventMgr.on(eventStr.redEvent.RefreshPremiumRed,this.refreshRed,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.redEvent.RefreshPremiumRed,this.refreshRed,this)},onLoad:function(){i.instance=this,this.stopBgNodeEvent(),this.handleUI()},handleUI:function(){var e=this;this.p_arrBtnNode.forEach(function(t,a){t.on("click",function(){e.onClickMenu(a)})})},setParam:function(e){void 0===e&&(e=0),this.refreshRed(),(e>1||null==e)&&(e=0),this.onClickMenu(e)},start:function(){},refreshRed:function(){this.p_arrNodeRed.forEach(function(e,t){app.pages[a[t].page].refreshRed(e)})},onClickMenu:function(e){this.p_arrBtnNode.forEach(function(t,a){t.getChildByName("pick").active=e==a}),this.currentPageData=a[e],this.openShopPage()},refreshCoinUI:function(){app.pages.premiumpage.instance.refreshCoinUI(),this.refreshRed()},openShopPage:function(){var e=this;if(this.currentPageData&&this.currentPageData.page){this.canSelectMenu=!1;var t=app.pages[this.currentPageData.page],a=function(){t.showPage(e.currentPageData.pageParam,e.p_nodeBg,function(a){a?e.canSelectMenu=!0:(e.m_showPage=t.instance,t.instance.p_bgNode?(e.m_showPageNode=e.m_showPage.p_bgNode,e.m_showPageNode.opacity=0,e.m_showPageNode.runAction(cc.sequence(cc.fadeIn(.15),cc.callFunc(function(){e.canSelectMenu=!0})))):e.canSelectMenu=!0)})};if(this.m_showPage){if(this.m_showPage.node.active=!0,this.m_showPageNode=this.m_showPage.p_bgNode,!this.m_showPageNode)return this.m_showPage.onClose(),this.m_showPage=null,void a();this.m_showPageNode.runAction(cc.sequence(cc.fadeOut(.1),cc.callFunc(function(){e.m_showPage.onClose(),e.m_showPage=null,a()})))}else a()}},onClose:function(){app.pages[this.currentPageData.page].instance&&cc.isValid(app.pages[this.currentPageData.page].instance.node)&&app.pages[this.currentPageData.page].instance.onClose(),this._super()}});i.refreshRed=function(e){for(var t=!1,i=0;i<a.length;i++)t||(t=app.pages[a[i].page].refreshRed());return e&&(e.active=t),t},cc._RF.pop()},{basePage:void 0}],cardManagePage:[function(e,t){"use strict";cc._RF.push(t,"83530cBUsJKUqNOyQiV9EBE","cardManagePage");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=cc._decorator,o=r.ccclass,s=r.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_nodeBg=null,t.p_nodeCoin=null,t.p_nodeCoinItem=null,t.m_showPage=null,t.m_index=null,t.m_arrCardPage=[{page:"normalrecruitpage",coin:[30019,30006,30005,38005],redKey:"comeInNormalRecruit"},{page:"seniorrecruitpage",coin:[30019,30006,30005,38005],redKey:"comeInSeniorRecruit"},{page:"friendrecruitpage",coin:[30019,30006,30005,38005],redKey:"comeInFriendRecruit"}],t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,this.stopNodeEvent(),this.handleUI(),this.fitTopMenu(),this.m_menu=this.node.getComponent("menu"),this.m_menu.init(this)},t.prototype.setParam=function(e){void 0===e&&(e=0),this.m_menu.setMenuIndex(e),this.refreshRed()},t.prototype.menuHandler=function(e){return this.m_index=e,!!this.m_arrCardPage[e]&&(app[this.m_arrCardPage[e].redKey]=!0,this.refreshRed(),this.openCardPage(e),!0)},t.prototype.openCardPage=function(e){var t=this,a=app.pages[this.m_arrCardPage[e].page];this.refreshCoinUI();var i=function(){a.showPage(t,t.p_nodeBg,function(){t.m_showPage=a.instance,t.m_showPage.node.opacity=0,t.m_showPage.node.runAction(cc.fadeIn(.2))})};this.m_showPage?(this.m_showPage.node.active=!0,this.m_showPage.node.runAction(cc.sequence(cc.fadeOut(.2),cc.callFunc(function(){t.m_showPage.onClose(),t.m_showPage=null,i()})))):i()},t.prototype.refreshRed=function(){this.m_menu.refreshRed()},t.prototype.refreshMenuRed=function(e){return app.pages[this.m_arrCardPage[e].page].refreshRed()},t.prototype.refreshCoinUI=function(){this.node.getComponent("currency").refreshCoin(this.m_arrCardPage[this.m_index].coin)},t.prototype.onClose=function(){app.pages.newworldmappage.instance&&cc.isValid(app.pages.newworldmappage.instance)&&app.pages.newworldmappage.instance.refreshAchive(),this.m_showPage&&cc.isValid(this.m_showPage.node)&&this.m_showPage.onClose(),e.prototype.onClose.call(this)},t.refreshRed=function(e){var t=!1,a=app.pages.normalrecruitpage.refreshRed(),i=app.pages.friendrecruitpage.refreshRed(),n=app.pages.seniorrecruitpage.refreshRed();return(a||i||n)&&(t=!0),e&&(e.active=t),t},t.prefabPath="cardmanagepage",n([s(cc.Node)],t.prototype,"p_nodeBg",void 0),n([s(cc.Node)],t.prototype,"p_nodeCoin",void 0),n([s(cc.Node)],t.prototype,"p_nodeCoinItem",void 0),a=n([o],t)}(e("basePage"));t.exports=p,cc._RF.pop()},{basePage:void 0}],cardRecruitingPage:[function(e,t){"use strict";cc._RF.push(t,"5351f/sb4BPtrwAnnRIpnxf","cardRecruitingPage");var a=[38005,30005,30006,30019],i=[cc.v2(-90,320),cc.v2(-275,162),cc.v2(-275,-162),cc.v2(-90,-320),cc.v2(90,320),cc.v2(275,162),cc.v2(275,-162),cc.v2(-90,0),cc.v2(90,0),cc.v2(90,-320)],n=cc.Class({extends:e("basePage"),statics:{prefabPath:"cardrecruitingpage",pageType:1},properties:{p_nodeCoin:cc.Node,p_nodeCoinItem:cc.Node,p_nodeTen:cc.Node,p_nodeOne:cc.Node,p_btnOpen:cc.Button,p_sprOpen:cc.Sprite,p_sprArrOpen:[cc.SpriteFrame],p_sprBtn:cc.Sprite,p_sprArrBtn:[cc.SpriteFrame],p_btnCloseNode:cc.Button,p_lightSpriteFrame:[cc.SpriteFrame],p_tGradeFrames:[cc.SpriteFrame],p_numAtlas:cc.SpriteAtlas,p_BigColorFrames:[cc.SpriteFrame],p_smallColorFrames:[cc.SpriteFrame],p_animationNode:sp.Skeleton,p_nodeDraw:cc.Node,p_labCount:cc.Label,p_btnGet:cc.Button,p_btnAgain:cc.Button,p_nodexfzhBg:cc.Node,p_nodexfzhTitle:cc.Node},onLoad:function(){n.instance=this,this.isShowAnim=!1,this.stopBgNodeEvent(),this.creatMask(),this.handleUI(),this.fitTopMenu()},onEnable:function(){this._super(),eventMgr.on(eventStr.commonEvent.QuitGame,this.onQuitGame,this),this.m_isRare=!1},onDisable:function(){this._super(),eventMgr.off(eventStr.commonEvent.QuitGame,this.onQuitGame,this)},onQuitGame:function(){this.m_confirmCb&&this.m_confirmCb.apply(this.m_target,this.m_confirmParm),cc.director.emit("close_reward_page")},handleUI:function(){var e=this;this._super(),this.node.getChildByName("black").on("touchend",function(){e.isShowAnim||e.p_btnCloseNode.node.active&&(e.m_confirmCb&&e.m_confirmCb.apply(e.m_target,e.m_confirmParm),e.onClose(!0))}),this.p_btnCloseNode.node.on("click",function(){e.isShowAnim||(app.playSound("click"),e.m_confirmCb&&e.m_confirmCb.apply(e.m_target,e.m_confirmParm),e.onClose(!0),cc.director.emit("close_reward_page"))});for(var t=function(t){e.p_nodeTen.children[t].on("touchend",function(){e.m_click&&!e.isShowAnim&&e.openCard(e.p_nodeTen.children[t])})},a=0;a<this.p_nodeTen.children.length;a++)t(a);this.p_nodeOne.children[0].on("touchend",function(){e.isShowAnim||e.openCard(e.p_nodeOne.children[0])}),this.p_btnOpen.node.on("click",function(){e.isShowAnim||(app.playSound("click"),e.aKeyOpen())}),this.p_btnAgain.node.on("click",function(){if(!e.isShowAnim)if(app.playSound("click"),e.m_isRare&&e.m_isDraw){var t={content:langMgr.getString("cardRecruitingPage",3),confirmcb:function(){e.m_againCb&&e.m_againCb.apply(e.m_target,e.m_againParm),e.onClose(!0,!0,!0)},target:e};app.pages.windowspagetipsmsg.showPage(t)}else e.m_againCb&&e.m_againCb.apply(e.m_target,e.m_againParm),e.onClose(!0,!0,!0)}),this.p_btnGet.node.on("click",function(){if(!e.isShowAnim)if(app.playSound("click"),app.player.gnum+10>app.player.bagspace){var t={content:langMgr.getString("cardRecruitingPage",1),confirmcb:function(){app.goToPage(1018)},cancelcb:function(){Boolean(app.player.autodecomp)&&cc.director.emit("EVENT_DISMISS_HERO")},target:e};app.pages.windowspagetipsmsg.showPage(t)}else{for(var a=!1,i=!1,n="\u60a8\u662f\u5426\u8981\u5c06\u5f53\u6b21\u62db\u52df\u7684\u6b66\u5c06\u9886\u53d6\u5230\u80cc\u5305\u4e2d\uff1f\n\n<\u8bf7\u6ce8\u610f\u5148\u950b\u53ec\u5524\u53ea\u80fd\u9886\u53d6\u4e00\u6b21< >>",r=0;r<e.m_reward.length;r++){var o=e.m_reward[r],s=app.db.getGBaseByGsid(o.gsid);5===s.STAR&&(a=!0),7===s.TGRADE&&(i=!0)}a?i||(n="\u672c\u6b21\u53ec\u5524\u6ca1\u6709\u8d44\u8d287\u6b66\u5c06\uff0c\u662f\u5426\u786e\u5b9a\u9886\u53d6\u672c\u6b21\u53ec\u5524\u7ed3\u679c\uff1f\n\n<\u8bf7\u6ce8\u610f\u5148\u950b\u53ec\u5524\u53ea\u80fd\u9886\u53d6\u4e00\u6b21< >>"):n="\u672c\u6b21\u53ec\u5524\u6ca1\u67095\u661f\u6b66\u5c06\uff0c\u662f\u5426\u786e\u5b9a\u9886\u53d6\u672c\u6b21\u53ec\u5524\u7ed3\u679c\uff1f\n\n<\u8bf7\u6ce8\u610f\u5148\u950b\u53ec\u5524\u53ea\u80fd\u9886\u53d6\u4e00\u6b21< >>";var p={content:n,confirmcb:function(){app.player.sfVanguardConfirm(function(){e.onClose(!0,null,null,!0),app.player.sfPlayerData(function(){app.pages.newworldmappage.instance.refreshXFZH()})})},target:e};app.pages.windowspagetipsmsg.showPage(p,e.node)}})},setParam:function(e){this.m_data=e,this.m_confirmCb=e.confirmcb,this.m_confirmParm=e.confirmparm,this.m_ark=e.ark,this.m_tag=e.tag,this.m_reward=e.reward,this.m_isDraw=e.isDraw,this.m_force=e.force,this.m_againName=e.againname,this.m_againCb=e.againcb,this.m_againParm=e.againparm,this.m_maxStar=e.maxstar,this.m_arrCoin=a,this.m_target=e.target,this.m_type=e.type,this.m_quickShowCard=e.quickshowcard,this.beforeAnim(this.refreshUI.bind(this))},beforeAnim:function(e){var t=this;"1"!=localDataUtils.GetValue("draw_card_show_anim","1")||this.m_isDraw?e():(this.isShowAnim=!0,this.p_animationNode.node.active=!0,this.p_nodeCoin.opacity=0,this.p_btnCloseNode.node.opacity=0,this.p_animationNode.setAnimation(0,"1",!1),this.p_btnOpen.node.opacity=0,this.scheduleOnce(function(){t.isShowAnim=!1,t.p_nodeCoin.runAction(cc.fadeIn(.5)),t.p_btnOpen.node.runAction(cc.fadeIn(.5)),t.p_btnCloseNode.node.runAction(cc.fadeIn(.5)),e()},1.5))},refreshUI:function(){var e,t=cc.winSize.height/cc.winSize.width,a=1,n=cc.v2(0,0);if(t<2e3/1080&&this.m_isDraw&&(a=.9,n=cc.v2(0,-40)),this.p_btnCloseNode.node.active=!1,this.p_btnOpen.node.active=!1,this.p_nodexfzhBg.active=!1,this.p_nodexfzhTitle.active=!1,this.m_openNodeIndex=[],this.m_isDraw&&(this.p_nodeTen.active=!1,this.p_nodeOne.active=!1,this.p_nodexfzhBg.active=!0,this.p_nodexfzhTitle.active=!0),10==this.m_againName||this.m_isDraw?(this.m_isDraw&&(this.p_nodeTen.scale=a),this.p_nodeTen.active=!0,this.p_nodeOne.active=!1,this.p_nodeTen.setPosition(n),this.m_quickShowCard||(e=this.p_nodeTen.getComponent(cc.Animation).play(),this.schedule(function(){app.playSound("fly")},.1,8))):(this.p_nodeTen.active=!1,this.p_nodeOne.active=!0,this.p_nodeOne.setPosition(0,0),this.p_nodeOne.opacity=0,e=this.p_nodeOne.getComponent(cc.Animation).play(),app.playSound("fly")),e&&!this.m_quickShowCard&&e.on("finished",this.onFinished,this),this.openNum=0,this.isAKey=!1,this.isFast=!1,this.index=0,this.refreshCoinUI(),this.m_isDraw){if(this.m_quickShowCard){this.p_nodeTen.opacity=255;for(var r=0;r<this.p_nodeTen.children.length;r++)this.p_nodeTen.children[r].position=i[r],this.openCard(this.p_nodeTen.children[r])}}else this.node.getChildByName("lianchou_btn").active=!1},onFinished:function(){this.m_click=!0,(10==this.m_againName||this.m_isDraw)&&(this.p_btnOpen.node.active=!0,this.p_sprBtn.spriteFrame=this.p_sprArrBtn[0],this.p_sprOpen.spriteFrame=this.p_sprArrOpen[0]),cc.director.emit("show_card_end")},loadTexture:function(e,t){var a=this;app.db.getGBaseByGsid(t.gsid).TGRADE>=7&&(this.m_isRare=!0);var i=t.gsid,n=app.db.getGBaseByGsid(i);4==n.STAR?(e.getChildByName("drawcard").getChildByName("light").getComponent(cc.Sprite).spriteFrame=this.p_lightSpriteFrame[0],e.getChildByName("drawcard").getChildByName("light").active=!0):(n.STAR,e.getChildByName("drawcard").getChildByName("light").getComponent(cc.Sprite).spriteFrame=null);var r=[e.getChildByName("drawcard").getChildByName("BigColor0"),e.getChildByName("drawcard").getChildByName("BigColor1")].filter(function(e){return cc.isValid(e)}),o=[e.getChildByName("drawcard").getChildByName("SmallColor0"),e.getChildByName("drawcard").getChildByName("SmallColor1")].filter(function(e){return cc.isValid(e)});switch(!0){case n.STAR<3:r.forEach(function(e){return e.active=!1}),o.forEach(function(e){return e.active=!1});break;case 3===n.STAR:r.forEach(function(e){e.active=!0,e.getComponent(cc.Sprite).spriteFrame=a.p_BigColorFrames[0]}),o.forEach(function(e){e.active=!0,e.getComponent(cc.Sprite).spriteFrame=a.p_smallColorFrames[0]});break;case 4===n.STAR:r.forEach(function(e){e.active=!0,e.getComponent(cc.Sprite).spriteFrame=a.p_BigColorFrames[1]}),o.forEach(function(e){e.active=!0,e.getComponent(cc.Sprite).spriteFrame=a.p_smallColorFrames[1]});break;case n.STAR>4:r.forEach(function(e){e.active=!0,e.getComponent(cc.Sprite).spriteFrame=a.p_BigColorFrames[2]}),o.forEach(function(e){e.active=!0,e.getComponent(cc.Sprite).spriteFrame=a.p_smallColorFrames[2]})}var s=app.db.getGCardPathByGsid(i),p=e.getChildByName("drawcard");if(!cc.isValid(p))return cc.warn("missing drawcard node");p.getChildByName("GeneralQuality").getChildByName("GeneralNumLayout").parent.active=Boolean(n.TGRADE),n.TGRADE;var c=e.getChildByName("drawcard").getChildByName("card_hero").getComponent(cc.Sprite);app.loadTexture(s,c,this.prefabPath,function(){n.STAR}),this.p_btnCloseNode.node.active=!0,this.p_nodeDraw.active=!0,this.p_btnOpen.node.active=!1},openCard:function(e){if(!this.isAKey&&!this.isFast){var t=e.name.split("_"),a=Number(t[1])-1;if(!(this.m_openNodeIndex.indexOf(a)>-1)){var i=this.m_reward[a];this.showCard(e,i,function(){cc.director.emit("open_card_end")}),this.m_openNodeIndex.push(a)}}},showCard:function(e,t,a){var i=this;this.m_quickShowCard&&(e.getChildByName("drawcard").getChildByName("card_back").active=!1),app.db.getGBaseByGsid(t.gsid).TGRADE>=7&&(this.m_isRare=!0);var n=t.gsid;app.player.haveGeneral(n)||(app.player._icons+="|"+n),app.isGuide()||this.m_isDraw;var r,o=app.db.getGBaseByGsid(n);this.m_quickShowCard||(4==o.STAR?(e.getChildByName("drawcard").getChildByName("light").getComponent(cc.Sprite).spriteFrame=this.p_lightSpriteFrame[0],r=e.getChildByName("drawcard").getChildByName("sp_purple_fanpai")):o.STAR>=5?(e.getChildByName("drawcard").getChildByName("light").getComponent(cc.Sprite).spriteFrame=null,r=e.getChildByName("drawcard").getChildByName("sp_yellow_fanpai")):e.getChildByName("drawcard").getChildByName("light").getComponent(cc.Sprite).spriteFrame=null);var s=[e.getChildByName("drawcard").getChildByName("BigColor0"),e.getChildByName("drawcard").getChildByName("BigColor1")].filter(function(e){return cc.isValid(e)}),p=[e.getChildByName("drawcard").getChildByName("SmallColor0"),e.getChildByName("drawcard").getChildByName("SmallColor1")].filter(function(e){return cc.isValid(e)});switch(!0){case o.STAR<3:s.forEach(function(e){return e.active=!1}),p.forEach(function(e){return e.active=!1});break;case 3===o.STAR:s.forEach(function(e){e.active=!0,e.getComponent(cc.Sprite).spriteFrame=i.p_BigColorFrames[0]}),p.forEach(function(e){e.active=!0,e.getComponent(cc.Sprite).spriteFrame=i.p_smallColorFrames[0]});break;case 4===o.STAR:s.forEach(function(e){e.active=!0,e.getComponent(cc.Sprite).spriteFrame=i.p_BigColorFrames[1]}),p.forEach(function(e){e.active=!0,e.getComponent(cc.Sprite).spriteFrame=i.p_smallColorFrames[1]});break;case o.STAR>4:s.forEach(function(e){e.active=!0,e.getComponent(cc.Sprite).spriteFrame=i.p_BigColorFrames[2]}),p.forEach(function(e){e.active=!0,e.getComponent(cc.Sprite).spriteFrame=i.p_smallColorFrames[2]})}var c=app.db.getGCardPathByGsid(n),h=e.getChildByName("drawcard");if(!cc.isValid(h))return cc.warn("missing drawcard node");var l=e.getChildByName("drawcard").getChildByName("card_hero").getComponent(cc.Sprite),g=function(){h.getChildByName("GeneralQuality").getChildByName("GeneralNumLayout").parent.active=Boolean(o.TGRADE),o.TGRADE},d=function(){app.loadTexture(c,l,i.prefabPath,function(){var t=e.getChildByName("drawcard").getComponent(cc.Animation);o.STAR>3?4==o.STAR?i.m_quickShowCard?(g(),a&&a(),e.getChildByName("drawcard").getChildByName("sp_blue_daiji").active=!0,e.getChildByName("drawcard").getChildByName("sp_blue_daiji").getComponent(sp.Skeleton).setAnimation(0,"xd",!0)):(t.play(),t.on("finished",function(){g(),a&&a(),e.getChildByName("drawcard").getChildByName("sp_blue_daiji").active=!0,e.getChildByName("drawcard").getChildByName("sp_blue_daiji").getComponent(sp.Skeleton).setAnimation(0,"xd",!0)},i)):o.STAR>=5&&(i.m_quickShowCard?(g(),a&&a(),e.getChildByName("drawcard").getChildByName("sp_star").active=!0,e.getChildByName("drawcard").getChildByName("sp_star").getComponent(sp.Skeleton).setAnimation(0,"xd",!0)):(t.play(),t.on("finished",function(){g(),a&&a(),e.getChildByName("drawcard").getChildByName("sp_star").active=!0,e.getChildByName("drawcard").getChildByName("sp_star").getComponent(sp.Skeleton).setAnimation(0,"xd",!0)},i))):i.m_quickShowCard?a&&a():(t.play(),t.on("finished",function(){a&&a()},i)),i.refreshOpenNum()}),e.off("touchend",i.openCard,i)};r?(r.active=!0,r.getComponent(sp.Skeleton).setAnimation(0,"xd",!1),4==o.STAR&&app.playSound("open_purple"),o.STAR>=5&&app.playSound("open_gold"),this.scheduleOnce(function(){d()},4==o.STAR?1:2)):d()},refreshOpenNum:function(){var e=this;this.openNum++,10==this.m_againName||this.m_isDraw?this.openNum>=10?this.scheduleOnce(function(){e.isFast=!1,e.p_btnCloseNode.node.active=!0,e.p_sprBtn.spriteFrame=e.p_sprArrBtn[0],e.p_sprOpen.spriteFrame=e.p_sprArrOpen[1],e.p_nodeDraw.active=!1,e.m_isDraw&&(e.p_nodeDraw.active=!0,e.p_btnOpen.node.active=!1)},.3):(this.p_sprBtn.spriteFrame=this.p_sprArrBtn[1],this.p_sprOpen.spriteFrame=this.p_sprArrOpen[2]):this.p_btnCloseNode.node.active=!0},showNewCard:function(e,t){app.pages.windowspagerewardgeneral.showPage({gsid:e,tag:0,confirmcb:function(){t&&t()},target:this})},aKeyShowCard:function(){var e=this;if(!(this.openNum>=10||this.index>=10))if(this.m_openNodeIndex.indexOf(this.index)<0){var t=this.p_nodeTen.children[this.index],a=this.m_reward[this.index];this.m_openNodeIndex.push(this.index),this.index++,this.showCard(t,a,function(){e.isFast||e.aKeyShowCard()})}else this.index++,this.aKeyShowCard()},aKeyOpen:function(){var e=this;if(!this.isFast)if(this.openNum<10&&!this.isAKey)this.isAKey=!0,this.aKeyShowCard();else if(this.openNum<10&&this.isAKey){this.isFast=!0;for(var t=0;t<10;t++)if(this.m_openNodeIndex.indexOf(t)<0){var a=this.p_nodeTen.children[t],i=this.m_reward[t];this.m_openNodeIndex.push(t),this.showCard(a,i)}}else{if(this.m_isRare&&this.m_isDraw){var n={content:langMgr.getString("cardRecruitingPage",3),confirmcb:function(){e.m_againCb&&e.m_againCb.apply(e.m_target,e.m_againParm),e.onClose(!0,!0,!0)},target:this};return void app.pages.windowspagetipsmsg.showPage(n)}this.m_againCb&&this.m_againCb.apply(this.m_target,this.m_againParm),this.onClose(!0,!0,!0)}},refreshCoinUI:function(){this.m_isDraw?this.node.getChildByName("bg_title").active=!1:(this.node.getChildByName("bg_title").active=!0,this.node.getComponent("currency").refreshCoin(this.m_arrCoin))},onClose:function(e,t,a,i){if(this._super(),app.showRecommendGift(),1!=app.player.autodecomp||a||cc.director.emit("EVENT_DISMISS_HERO"),this.m_isDraw){var n={showtype:1,reward:this.m_data.reward};i&&app.pages.windowspagereward.showPage(n),!a&&app.pages.activitypagexfzh.instance.onClose()}},renderTGrade:function(e,t,a){var i=e.getChildByName("TopTGrade"),n=e.getChildByName("TGradeAnim");if(cc.isValid(i)&&cc.isValid(n)){var r=this.p_tGradeFrames[Number(a-1)];if(cc.isValid(r))if(i.getComponent(cc.Sprite).spriteFrame=r,!t||1!=a&&2!=a)i.active=!0;else{n.active=!0;try{n.getComponent("sp.Skeleton").setAnimation(0,"T"+(a-1),!1)}catch(l){cc.log(l),n.active=!1}var o=cc.delayTime(.5),s=cc.moveTo(.5,i.position),p=cc.scaleTo(.5,i.scale),c=cc.spawn(s,p),h=cc.sequence(o,c);n.runAction(h)}else i.getComponent(cc.Sprite).spriteFrame=null}}});cc._RF.pop()},{basePage:void 0}],carddrawPage:[function(e,t){"use strict";cc._RF.push(t,"fb1bcKe1m9OBLShsqKuULWU","carddrawPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"carddrawpage",pageParent:"generalmanagepage"},properties:{p_btnShop:cc.Button,p_arrNodeDraw:[cc.Node],p_arrNodePickDraw:[cc.Node],p_arrSpriteFrame:[cc.SpriteFrame],p_btnDraw:cc.Button,p_btnDraw10:cc.Button,p_btnHelp:cc.Button,p_spDrawCardAnim:sp.Skeleton,_isPlayAnim:!1,isPlayAnim:{visible:!1,get:function(){return this._isPlayAnim},set:function(e){this._isPlayAnim=Boolean(e),cc.director.emit("EVT_SET_ANIM_MASK_VISIBLE",e)}}},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(),this.handleUI(),this.fitTopMenu(100),this.playIdleAnim()},handleUI:function(){var e=this;this._super(),this.p_arrNodeDraw.forEach(function(t,a){t.on("touchend",function(){e.onClickDraw(a)})}),this.p_btnDraw.node.on("click",function(){app.playSound("click"),e.onClickBtnDraw(1)}),this.p_btnDraw10.node.on("click",function(){app.playSound("click"),e.onClickBtnDraw(10)}),this.p_btnShop.node.on("click",function(){app.playSound("click"),app.pages.shoppage.showPage("general")}),this.p_btnHelp.node.on("click",function(){app.pages.windowspagetipshelp.showPage("1007")})},setParam:function(){this.refreshUI(),app.runUnlockGuide("CARD_DRAW"),this.p_btnShop.node.active=app.db.checkFuncUnLock("SHOP_DRAW")},refreshUI:function(){this.onClickDraw(0)},refreshCoin:function(){this.p_labCoinDraw.string=app.player.getCount(30011),this.p_labCoinEx.string=app.player.getCount(30012),this.p_labCoinShop.string=app.player.getCount(30013)},onClickDraw:function(e){this.m_numNowDrawIndex!=e&&(this.m_numNowDrawIndex=e,this.p_arrNodePickDraw.forEach(function(t,a){t.active=a==e}))},onClickBtnDraw:function(e){var t=this;if(!this.isDraw)if(this.m_numNowDrawIndex||0==this.m_numNowDrawIndex)if(app.player.getCount(30011)<e){var a=app.db.getPropsName(30011);app.showNotice(a+langMgr.getString("carddrawPage",1))}else{app.playSound("click_card_draw");var i=this.m_numNowDrawIndex+1;this.isDraw=!0,this.playDrawAnim(),app.player.sfSummon(i,e,function(a,i){a?app.showNotice(a):app.player.sfPlayerData(function(){var a={reward:i,confirmcb:function(){cc.isValid(t)&&(t.isDraw=!1)},againname:e,againcb:function(e){cc.isValid(t)&&(t.isDraw=!1,t.onClickBtnDraw(e))},againparm:[e],target:t};cc.isValid(t)&&t.isPlayAnim?t._showRewardFunc=function(){cc.isValid(t)&&(t._showRewardFunc=null),app.pages.windowspagereward.showPage(a)}:app.pages.windowspagereward.showPage(a)})})}else app.showNotice(langMgr.getString("carddrawPage",0))},onClose:function(){this.isDraw=!1,this._super()},playIdleAnim:function(){cc.isValid(this.p_spDrawCardAnim)&&this.p_spDrawCardAnim.setAnimation(0,"1",!0)},playDrawAnim:function(){var e=this;cc.isValid(this.p_spDrawCardAnim)&&(this.isPlayAnim=!0,this.p_spDrawCardAnim.setAnimation(0,"2",!1),this.p_spDrawCardAnim.setCompleteListener(function(t){cc.isValid(e)&&(e.p_spDrawCardAnim.setCompleteListener(null),"2"===t.animation.name&&e.playIdleAnim())}),this.scheduleOnce(function(){cc.isValid(e)&&(e.isPlayAnim=!1,"function"==typeof e._showRewardFunc&&e._showRewardFunc())},2))}});cc._RF.pop()},{basePage:void 0}],cardpubBasePage:[function(e,t,a){"use strict";cc._RF.push(t,"42db6coaSRKV58oi57/xrPd","cardpubBasePage");var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function a(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(a.prototype=t.prototype,new a)}),r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,a=1,i=arguments.length;a<i;a++)for(var n in t=arguments[a])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},o=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o};Object.defineProperty(a,"__esModule",{value:!0}),a.CardpubBasePage=void 0;var s=cc._decorator,p=s.ccclass,c=s.property,h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_btnTip=null,t.p_btnOneTime=null,t.p_btnTenTimes=null,t.p_btnScore=null,t.p_labelScore=null,t.p_labelFreeTime=null,t.p_sprOneTimeIcon=null,t.p_sprTenTimesIcon=null,t.p_labelTenTimes=null,t.p_labelOneTime=null,t.p_nodeXuYuanBg=null,t.p_xuYuanParent=null,t.p_nodeOneTime=null,t.p_nodeFreeTime=null,t.p_generalItem=null,t.p_checkbox=null,t.p_progress=null,t.p_labNFreeTime=null,t.m_general=[],t.dismissAssemble=[],t.rewardAssemble=[],t.isDraw=!1,t._target=null,t.time=0,t.isRTime=!0,t}var a;return n(t,e),a=t,t.prototype.onLoad=function(){this.stopNodeEvent(),this.fitTopMenu(),this.handleEvent(),this.refreshUI()},t.prototype.refreshUI=function(){this.refreshScore(),this.refreshXuYuan(),this.refreshConsume(),this.refreshBaodi()},t.prototype.setParam=function(e){this._target=e;var t=localDataUtils.GetValue(a.DRAW_CARD_SHOW_ANIM,"1");this.p_checkbox.isChecked="0"==t},t.prototype.refreshTime=function(){var e=this.getOneTimeCost().freeTime,t=app.player.getServerTime(),a=e&&e-t<=0,i=(e-t)/1e3;this.p_labNFreeTime.string=langMgr.getString("cardpubPage",0,gUtils.getHourMinSecTime(i)),this.p_labNFreeTime.node.active=!a,this._target.refreshRed(),this.p_btnOneTime.node.getChildByName("rednotice").active=a},t.prototype.update=function(e){this.isRTime&&this.p_labNFreeTime&&(this.time>1?(this.time=0,this.refreshTime()):this.time+=e)},t.prototype.handleEvent=function(){var e=this;this.p_btnOneTime.node.on("click",this.oneTimeClickHandle.bind(this)),this.p_btnTenTimes.node.on("click",this.tenTimesClickHandle.bind(this)),this.p_btnScore.node.on("click",this.scoreClickHandle.bind(this)),this.p_btnTip.node.on("click",this.tipClickHandle.bind(this)),this.p_xuYuanParent.on("touchend",this.xuyuanClickHandle.bind(this)),this.p_checkbox.node.on("toggle",this.checkboxClickHandle.bind(this)),Boolean(app.player.autodecomp)&&cc.director.on("EVENT_DISMISS_HERO",function(){if(e.rewardAssemble instanceof Array&&e.rewardAssemble.length>0){var t={showtype:1,reward:e.rewardAssemble,confirmcb:function(){app.player.sfPlayerByParam(["others"],function(){})},target:e,isAutoDismiss:!0};app.pages.windowspagereward.showPage(t),e.rewardAssemble=[]}},this)},t.prototype.refreshScore=function(){this.p_btnScore.node.active=this.showTianyun();var e=app.player.getCount(app.db.dbDraw[4][1].COST[0].GSID);this.p_progress.fillRange=e/a.TOTAL_SCORE>1?1:e/a.TOTAL_SCORE,this.p_labelScore.string=e+"/"+a.TOTAL_SCORE,this.p_btnScore.node.getChildByName("rednotice").active=e/a.TOTAL_SCORE>=1&&(app.player.vip>=3||app.player.level>=80)},t.prototype.refreshXuYuan=function(){var e=this,t=app.player.zmqy.gsidlist||[];this.p_nodeXuYuanBg.active=this.showXuyuan()&&!!t.length,t.forEach(function(t,a){var i=e.m_general[a];i||((i=cc.instantiate(e.p_generalItem)).parent=e.p_xuYuanParent,i.scale=.7,e.m_general[a]=i),i.active=!0;var n=app.db.getGBaseByGsid(t.gsid);i.getComponent("generalPortraitItem").initReport(n,r({},t)),i.getComponent("generalPortraitItem").setGray(!!t.got),i.getComponent("generalPortraitItem").setSelector(!!t.got)})},t.prototype.refreshConsume=function(){var e=this.getOneTimeCost(),t=this.getTenTimesCost(),a=e.freeTime,i=app.player.getServerTime(),n=a&&a-i<=0;if(this.p_nodeOneTime.active=!n,this.p_nodeFreeTime.active=n,this.p_labelFreeTime.string=n?"1":e.count,this.p_btnOneTime.node.getChildByName("rednotice").active=n,this.p_labNFreeTime){var r=(a-i)/1e3;this.p_labNFreeTime.string=langMgr.getString("cardpubPage",0,gUtils.getHourMinSecTime(r)),this.p_labNFreeTime.node.active=!n}this.p_labelOneTime.string=e.count,this.p_labelTenTimes.string=t.count,app.loadTexture(e.iconPath,this.p_sprOneTimeIcon,this.prefabPath),app.loadTexture(t.iconPath,this.p_sprTenTimesIcon,this.prefabPath)},t.prototype.refreshBaodi=function(){},t.prototype.scoreClickHandle=function(){app.playSound("click"),app.pages.windowspagescorerecruit.showPage({cb:this.extract,target:this,params:[4,1]})},t.prototype.tipClickHandle=function(){app.playSound("click"),app.pages.windowspagetipshelp.showPage("1006")},t.prototype.xuyuanClickHandle=function(){app.goToPage(1041)},t.prototype.checkboxClickHandle=function(e){localDataUtils.SetValue(a.DRAW_CARD_SHOW_ANIM,e.isChecked?"0":"1")},t.prototype.extract=function(e,t,a){var i=this;if(!this.isDraw){if(this.isDraw=!0,app.player.gnum+t>app.player.bagspace){var n={content:langMgr.getString("cardpubPage",7),confirmcb:function(){if(app.player.autodecomp&&i.rewardAssemble instanceof Array&&i.rewardAssemble.length>0){var e={showtype:1,reward:i.rewardAssemble,confirmcb:function(){app.player.sfPlayerByParam(["others"],function(){app.goToPage(1018)})},target:i,isAutoDismiss:!0};app.pages.windowspagereward.showPage(e)}else app.goToPage(1018)},cancelcb:function(){Boolean(app.player.autodecomp)&&cc.director.emit("EVENT_DISMISS_HERO")},target:this};return app.pages.windowspagetipsmsg.showPage(n),void(this.isDraw=!1)}if(3!=e||1==app.isSaveGenerals){for(var r,o=app.db.dbDraw[e][t].COST,s=!1,p=!1,c=0;c<o.length;++c){var h=o[c],l=app.player.getCount(h.GSID),g=h.COUNT;if(this.checkFree(e,t)){p=!0,s=!0;break}if(l>=g){s=!0;break}r=h.GSID}if(s)if(3==e)if(h=void 0,1==t&&(h=this.m_nowPOneCost),10==t&&(h=this.m_nowPTenCost),38005!=h.GSID||p)this.drawcard(e,t,a);else{var d=200-app.player.getCount(90591);if(d<=0)return app.player.sfPlayerByParam(["others"],function(){app.showNotice(langMgr.getString("cardpubPage",1==t?11:12))}),void(this.isDraw=!1);n={content:langMgr.getString("cardpubPage",9,[h.COUNT,t,d]),confirmcb:function(e,t,a){i.drawcard(e,t,a)},confirmparm:[e,t,a],cancelcb:function(){i.isDraw=!1,Boolean(app.player.autodecomp)&&cc.director.emit("EVENT_DISMISS_HERO")},target:this},app.pages.windowspagetipsmsg.showPage(n)}else this.drawcard(e,t,a);else{var u=app.db.getPropsInfoByGsid(r);app.showNotice((u.NAME||langMgr.getString("cardpubPage",3))+langMgr.getString("cardpubPage",4)),this.isDraw=!1,Boolean(app.player.autodecomp)&&cc.director.emit("EVENT_DISMISS_HERO")}}else if(app.isSaveGenerals=!0,app.pages.activityzhdpagecxry.isSaveGenerals()){this.isDraw=!1;n={content:langMgr.getString("cardpubPage",8),confirmcb:function(){app.goToPage(1041)},target:this};app.pages.windowspagetipsmsg.showPage(n)}else this.isDraw=!1,this.extract(e,t,a),app.isSaveGenerals=!1}},t.prototype.drawcard=function(e,t,a){var i=this;this.isDraw=!0,app.player.sfRecruit(e,t,function(n,r){var o,s;if(n){var p=n;return(n="gold limit")&&(p=langMgr.getString("cardpubPage",1==t?11:12)),app.showNotice(p),void(i.isDraw=!1)}if(app.player.gnum+=t,cc.log("drawcard data is ",r),Boolean(app.player.autodecomp)){var c=r.filter(function(e){return e.star<4}).map(function(e){return e.guid});(o=i.dismissAssemble).push.apply(o,c),app.player.sfGeneralsDeComp(i.dismissAssemble,1,function(e,t){if(e)return app.showNotice(e);i.rewardAssemble instanceof Array||(i.rewardAssemble=[]);for(var a=0,n=t;a<n.length;a++){for(var r=n[a],o=!1,s=0,p=i.rewardAssemble;s<p.length;s++){var c=p[s];if(c.GSID===r.GSID){c.COUNT+=r.COUNT,o=!0;break}}o||i.rewardAssemble.push(r)}app.player.sfPlayerByParam(["others","recruitfree","zmqy","safe"],function(){i.refreshUI(),i._target.refreshCoinUI(),i._target.refreshRed()})}),i.dismissAssemble=[]}else GodGuide.addGuideProgress("guide_draw_card_end"),app.player.sfPlayerByParam(["others","recruitfree","zmqy","safe"],function(){i.refreshUI(),i._target.refreshCoinUI(),i._target.refreshRed()});switch(e){case 1:s=1*t;break;case 2:s=5*t;break;case 3:s=20*t}app.player.addItem({gsid:30007,count:s});for(var h=r,l=0,g=[],d=[],u=a;l<h.length;++l){var f=h[l].gsid,m=app.db.getGBaseByGsid(f);d.push({gsid:f,count:1}),m.STAR>=5&&(u?m.STAR>u&&(u=m.STAR):u=m.STAR,g.push(f))}app.pages.cardrecruitingpage.showPage({ark:g,tag:0,againname:t,againcb:function(e,t,a){i.isDraw=!1,i.extract(e,t,a)},againparm:[e,t,u],confirmcb:function(){i.isDraw=!1},reward:d,maxstar:u,target:i})})},t.prototype.checkFree=function(e,t){if(10==t)return!1;if(2==e||4==e)return!1;var a=app.player.getServerTime();return 1==e&&app.player.recruitfree.normal-a<=0||3==e&&app.player.recruitfree.premium-a<=0},t.prototype.onClose=function(){this.isDraw=!1,this.isRtime=!1,e.prototype.onClose.call(this)},t.prototype.onDestroy=function(){e.prototype.onDestroy.call(this),cc.director.targetOff(this)},t.instance=null,t.pageParent="cardmanagepage",t.DRAW_CARD_SHOW_ANIM="draw_card_show_anim",t.TOTAL_SCORE=1e3,o([c(cc.Button)],t.prototype,"p_btnTip",void 0),o([c(cc.Button)],t.prototype,"p_btnOneTime",void 0),o([c(cc.Button)],t.prototype,"p_btnTenTimes",void 0),o([c(cc.Button)],t.prototype,"p_btnScore",void 0),o([c(cc.Label)],t.prototype,"p_labelScore",void 0),o([c(cc.Label)],t.prototype,"p_labelFreeTime",void 0),o([c(cc.Sprite)],t.prototype,"p_sprOneTimeIcon",void 0),o([c(cc.Sprite)],t.prototype,"p_sprTenTimesIcon",void 0),o([c(cc.Label)],t.prototype,"p_labelTenTimes",void 0),o([c(cc.Label)],t.prototype,"p_labelOneTime",void 0),o([c(cc.Node)],t.prototype,"p_nodeXuYuanBg",void 0),o([c(cc.Node)],t.prototype,"p_xuYuanParent",void 0),o([c(cc.Node)],t.prototype,"p_nodeOneTime",void 0),o([c(cc.Node)],t.prototype,"p_nodeFreeTime",void 0),o([c(cc.Prefab)],t.prototype,"p_generalItem",void 0),o([c(cc.Toggle)],t.prototype,"p_checkbox",void 0),o([c(cc.Sprite)],t.prototype,"p_progress",void 0),o([c(cc.Label)],t.prototype,"p_labNFreeTime",void 0),a=o([p],t)}(e("basePage"));a.CardpubBasePage=h,cc._RF.pop()},{basePage:void 0}],chapterPage:[function(e,t){"use strict";cc._RF.push(t,"e4e36ZW3eBDyZ83FlPCG/be","chapterPage");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=e("basePage"),o=cc._decorator,s=o.ccclass,p=o.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_chapterBar=null,t.p_chapterLayout=null,t.p_chapterContent=null,t.p_chapterItem=null,t.p_nodeGeneral=null,t.p_sprGeneral=null,t.p_spGeneral=null,t.p_animGeneral=null,t.p_chapterTitle=null,t.p_chapterRemark=null,t.p_chapterRateBar=null,t.p_chapterRateLab=null,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,e.prototype.onLoad.call(this),e.prototype.stopBgNodeEvent.call(this)},t.prototype.onEnable=function(){e.prototype.onEnable.call(this)},t.prototype.onDisable=function(){e.prototype.onDisable.call(this)},t.prototype.onDestroy=function(){e.prototype.onDestroy.call(this)},t.prototype.onClose=function(){e.prototype.onClose.call(this)},t.prototype.handleUI=function(){e.prototype.handleUI.call(this)},t.prototype.setParam=function(){this.refreshUI();var e=app.db.getMapInfo(app.player.maxmapid),t=app.db.getCityInfo(e.CITY);this.refreshData(t)},t.prototype.refreshUI=function(){this.totalChapterArr=[];var e=app.db.dbCity;if(this.p_chapterLayout.node.removeAllChildren(),!e||e.length<=0)cc.log("\u914d\u7f6e\u51fa\u9519");else{for(var t in e)if(e[t].MAP){this.totalChapterArr.push(t);var a=cc.instantiate(this.p_chapterItem);a.setParent(this.p_chapterLayout.node),a.active=!0,a.getComponent("chapterNewItem").refreshUI(e[t],this)}var i=this.p_chapterLayout.node.children[0],n=this.p_chapterLayout.node.children[this.p_chapterLayout.node.children.length-1];this.p_chapterLayout.updateLayout(),this.p_chapterContent.width=this.p_chapterLayout.node.width;var r=n.x-i.x;this.p_chapterBar.node.width=r,this.p_chapterBar.totalLength=r,this.p_chapterBar.node.children[0].width=r-14;var o=app.db.getMapInfo(app.player.maxmapid),s=String(o.CITY),p=this.totalChapterArr.indexOf(s),c=p/(this.totalChapterArr.length-1);if(this.p_chapterBar.progress=c,p>0){var h=this.p_chapterLayout.node.children[p].x-i.x,l=Math.min(h+375,this.p_chapterContent.width-375);this.p_chapterContent.x=-l}}},t.prototype.refreshData=function(e){this.p_chapterTitle.string=e.CITYNAME,this.p_chapterRemark.string=e.INTRO,this.p_chapterRateBar.progress=1,this.p_chapterRateBar.progress=1;var t,a,i=e.MAP.length,n=e.GENERAL;e.MAP.indexOf(app.player.maxmapid)>=0?a=(t=e.MAP.indexOf(app.player.maxmapid)+1)/i:(a=1,t=i),this.p_chapterRateBar.progress=a,this.p_chapterRateLab.string=t+"/"+i,app.loadGeneral(n,this.p_sprGeneral,this.p_spGeneral,this.p_animGeneral,null,this.prefabPath)},t.prefabPath="chapterpage",t.pageType=1,n([p(cc.ProgressBar)],t.prototype,"p_chapterBar",void 0),n([p(cc.Layout)],t.prototype,"p_chapterLayout",void 0),n([p(cc.Node)],t.prototype,"p_chapterContent",void 0),n([p(cc.Prefab)],t.prototype,"p_chapterItem",void 0),n([p(cc.Node)],t.prototype,"p_nodeGeneral",void 0),n([p(cc.Sprite)],t.prototype,"p_sprGeneral",void 0),n([p(sp.Skeleton)],t.prototype,"p_spGeneral",void 0),n([p(cc.Animation)],t.prototype,"p_animGeneral",void 0),n([p(cc.Label)],t.prototype,"p_chapterTitle",void 0),n([p(cc.Label)],t.prototype,"p_chapterRemark",void 0),n([p(cc.ProgressBar)],t.prototype,"p_chapterRateBar",void 0),n([p(cc.Label)],t.prototype,"p_chapterRateLab",void 0),a=n([s],t)}(r);c.refreshRed=function(e){var t=!1;return app.player.getCount(38020)>0&&(t=!0),e&&(e.active=t),t},t.exports=c,cc._RF.pop()},{basePage:void 0}],chatPage:[function(e,t){"use strict";cc._RF.push(t,"a5ae7ffwglJg6AfYoL8xFc2","chatPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"chatpage",pageType:1},properties:{p_scrvContent:cc.ScrollView,p_eboxTx:cc.EditBox,p_btnSend:cc.Button},onLoad:function(){a.instance=this,this.view=this.p_scrvContent.node.getChildByName("view"),this.content=this.p_scrvContent.node.getChildByName("view").getChildByName("content"),this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.m_menu=this.node.getComponent("menu"),this.m_menu.init(this),this.m_list=this.node.getComponent("listViewCtrl")},onEnable:function(){this._super(),eventMgr.on(eventStr.ChatPageEvent.ReceiveMsg,this.addMsg,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.ChatPageEvent.ReceiveMsg,this.addMsg,this)},handleUI:function(){var e=this;this._super(),this.p_btnSend.node.on("click",function(){e.p_eboxTx.string&&""!=e.p_eboxTx.string?e.sendTextMsg():app.showNotice(langMgr.getString("chatPage",0))})},start:function(){},setParam:function(){this.m_arrData=[],this.refreshUI()},refreshUI:function(){this.m_menu.setMenuIndex(0)},refreshSView:function(){cc.log(this.m_arrData.length,this.m_arrData),this.m_list.initListView(this.m_arrData.length,this.m_arrData,"down",this)},menuHandler:function(e){switch(e){case 0:this.m_strNowRoom=app.roomid_server,this.m_arrData=ChatMsgMgr.getRoomMsg(app.roomid_server),ChatMsgMgr._objNewMsg.server=0;break;case 1:if(!app.player.legion)return app.showNotice(langMgr.getString("chatPage",1)),!1;this.m_strNowRoom=app.roomid_guild,this.m_arrData=ChatMsgMgr.getRoomMsg(app.roomid_guild),ChatMsgMgr._objNewMsg.guild=0;break;case 2:this.m_strNowRoom=app.roomid_cross,this.m_arrData=ChatMsgMgr.getRoomMsg(app.roomid_cross),ChatMsgMgr._objNewMsg.cross=0}this.refreshSView(),this.m_menu.refreshRed()},refreshMenuRed:function(e){var t=!1;switch(e){case 0:this.m_strNowRoom==app.roomid_server?ChatMsgMgr._objNewMsg.server=0:ChatMsgMgr._objNewMsg.server>0&&(t=!0);break;case 1:this.m_strNowRoom==app.roomid_guild?ChatMsgMgr._objNewMsg.guild=0:ChatMsgMgr._objNewMsg.guild>0&&(t=!0);break;case 2:this.m_strNowRoom==app.roomid_cross?ChatMsgMgr._objNewMsg.cross=0:ChatMsgMgr._objNewMsg.cross>0&&(t=!0)}return t},update:function(){for(var e=cc.rect(-this.view.width/2,-this.content.y-this.view.height/2,this.view.width,this.view.height),t=0;t<this.content.children.length;t++){var a=this.content.children[t];e.intersects(a.getBoundingBox())?a.opacity=255:a.opacity=0}},sendTextMsg:function(){var e=this;if(this.m_strNowRoom){var t=app.player.getCount(38004),a=this.m_strNowRoom==app.roomid_cross?4:3;if(app.player.vip<3&&t<a){var i={type:"nocancel",content:langMgr.getString("chatPage",4,app.db.getOfficialInfoByLv(a).NAME)};return app.pages.windowspagetipsmsg.showPage(i),void(this.p_eboxTx.string="")}var n=this.p_eboxTx.string;n=gUtils.trim(n,1);var r=this.m_strNowRoom;r?r==app.roomid_guild?app.player.sfPlayerByParam(["legion"],function(){app.player.legion?app.sendChatMsg(e.m_strNowRoom,n,1,{isHideVip:app.player.set.vipHide}):app.showNotice(langMgr.getString("chatPage",1)),e.p_eboxTx.string=""}):(app.sendChatMsg(this.m_strNowRoom,n,1,{isHideVip:app.player.set.vipHide}),this.p_eboxTx.string=""):this.p_eboxTx.string=""}else app.showNotice(langMgr.getString("chatPage",2))},addMsg:function(e){e.roomid==this.m_strNowRoom&&this.m_list.addItem(e.scroll),this.m_menu.refreshRed()},checkMsg:function(e){return!gUtils.checkQJStr(e)},onClose:function(){app.mainScene.p_btnChat.node.getChildByName("rednotice").active=!1,this._super()}});a.refreshRed=function(){app.mainScene&&cc.isValid(app.mainScene.node)&&(app.mainScene.p_btnChat.node.getChildByName("rednotice").active=!0)},cc._RF.pop()},{basePage:void 0}],cityPage:[function(e,t){"use strict";cc._RF.push(t,"6595fyfzTxPTa4Bal+alZI+","cityPage");var a={legionrecommendpage:"p_nodeLegion",generalcomppage:"p_nodeGComp",godbeastpage:"p_nodeGodbeast",cardmanagepage:"p_nodePub",generalrelivepage:"p_nodeGDeComp",lookstarpage:"p_nodeLookStar",shoppage:"p_nodeShop",fusionpage:"p_nodeSmithy",summitpvpchapmionpage:"p_nodeSummitChapmion",palacepage:"p_nodePalace",nationWarMainPage:"p_nodeNationWar",generalmanagepage:"p_nodeGeneral"},i={PALACE:"palacepage",PVP_SUMMIT_CHAPMION:"summitpvpchapmionpage",LEGION:"legionrecommendpage",PUB:"cardmanagepage",LOOK:"lookstarpage",COMP:"generalcomppage",SHOP:"shoppage",MYTHICAL:"godbeastpage",SMITHY:"fusionpage",RELIVE:"generalrelivepage"},n=cc.Class({extends:e("basePage"),statics:{prefabPath:"citypage"},properties:{p_nodeBg:cc.Node,p_nodeLegion:cc.Node,p_nodePalace:cc.Node,p_nodeGComp:cc.Node,p_nodeGodbeast:cc.Node,p_nodePub:cc.Node,p_nodeGDeComp:cc.Node,p_nodeGeneral:cc.Node,p_nodeLookStar:cc.Node,p_nodeShop:cc.Node,p_nodeSummitChapmion:cc.Node,p_nodeSmithy:cc.Node,p_nodeNationWar:cc.Node,p_nodeYoujie:cc.Node,p_prefabNewFun:cc.Prefab},onLoad:function(){n.instance=this,this.m_numBgOriginX=this.p_nodeBg.x,this.m_numBgOriginY=this.p_nodeBg.y,this.stopBgNodeEvent(),this.handleUI(),this.creatMask(),this.controlFunctionByChannel(),this.preTimeItems=[]},onEnable:function(){this._super(),eventMgr.on(eventStr.redEvent.RefreshCityRed,this.refreshCityRed,this),eventMgr.on(eventStr.unlockNewFuncEvent.RefreshNewFunc,this.refreshNewFunc,this),eventMgr.on(eventStr.palaceEvent.RefreshYoujie,this.refreshYoujie,this),eventMgr.on(eventStr.commonEvent.RefreshTime,this.refreshTime,this),eventMgr.on(eventStr.commonEvent.RefreshMainSceneSpecialButton,this.refreshPreCityUI,this),app.cacheCityPage=app.cacheCityPage||{},app.cacheCityPage.numOpenTimes=app.cacheCityPage.numOpenTimes||0,app.cacheCityPage.numOpenTimes+=1,app.pages.activitygcflpage.isNeedAutoOpenByCityPage()&&app.cacheCityPage.numOpenTimes>=2&&app.pages.activitygcflpage.showPage()},onDisable:function(){this._super(),eventMgr.off(eventStr.commonEvent.RefreshTime,this.refreshTime,this),eventMgr.off(eventStr.commonEvent.RefreshMainSceneSpecialButton,this.refreshPreCityUI,this),eventMgr.off(eventStr.redEvent.RefreshCityRed,this.refreshCityRed,this),eventMgr.off(eventStr.unlockNewFuncEvent.RefreshNewFunc,this.refreshNewFunc,this),eventMgr.off(eventStr.palaceEvent.RefreshYoujie,this.refreshYoujie,this)},handleUI:function(){var e=this;this.p_nodeBg.on("touchmove",function(t){e.moveMapByTouch(t)}),this.p_nodeBg.on("touchend",function(){e.m_isMove=!1}),this.p_nodePub.getChildByName("touch_ctr").on("touchend",function(){cc.log("touch \u9152\u9986")}),this.p_nodePub.on("touchend",function(){e.m_isMove||(app.playSound("click"),app.pages.cardmanagepage.showPage(app.player.level>=3?1:0))}),this.p_nodeLookStar.getChildByName("touch_ctr").on("touchend",function(){cc.log("touch \u89c2\u661f")}),this.p_nodeLookStar.on("touchend",function(){e.m_isMove||(app.playSound("click"),app.pages.lookstarpage.showPage())}),this.p_nodeShop.getChildByName("touch_ctr").on("touchend",function(){cc.log("touch \u5546\u94fa")}),this.p_nodeShop.on("touchend",function(){e.m_isMove||(app.playSound("click"),app.pages.shoppage.showPage("day"))}),this.p_nodeGComp.getChildByName("touch_ctr").on("touchend",function(){cc.log("touch \u5c01\u795e\u5802")}),this.p_nodeGComp.on("touchend",function(){e.m_isMove||(app.playSound("click"),app.pages.generalcomppage.showPage())}),this.p_nodeGDeComp.getChildByName("touch_ctr").on("touchend",function(){cc.log("touch \u9a7f\u7ad9")}),this.p_nodeGDeComp.on("touchend",function(){e.m_isMove||(app.playSound("click"),app.pages.generalrelivepage.showPage())}),this.p_nodeGeneral.getChildByName("touch_ctr").on("touchend",function(){cc.log("touch \u70b9\u5c06\u53f0")}),this.p_nodeGeneral.on("touchend",function(){e.m_isMove||(app.playSound("click"),app.pages.generalmanagepage.showPage())}),this.p_nodeSmithy.getChildByName("touch_ctr").on("touchend",function(){cc.log("touch \u94c1\u5320\u94fa")}),this.p_nodeSmithy.on("touchend",function(){e.m_isMove||(app.playSound("click"),app.pages.fusionpage.showPage())}),this.p_nodeSummitChapmion.getChildByName("touch_ctr").on("touchend",function(){cc.log("touch \u5168\u670d\u9738\u4e3b")}),this.p_nodeSummitChapmion.on("touchend",function(){e.m_isMove||(app.playSound("click"),app.lockFunConfig&&app.lockFunConfig.checkPreFuncByKey("PVP_SUMMIT")?app.pages.prepagesummitpvp.showPage():app.pages.summitpvpchapmionpage.showPage())}),this.p_nodeGodbeast.getChildByName("touch_ctr").on("touchend",function(){cc.log("touch \u796d\u795e\u53f0")}),this.p_nodeGodbeast.on("touchend",function(){e.m_isMove||(app.playSound("click"),app.pages.godbeastpage.showPage())}),this.p_nodeLegion.getChildByName("touch_ctr").on("touchend",function(){cc.log("touch \u519b\u56e2")}),this.p_nodeLegion.on("touchend",function(){e.m_isMove||(app.playSound("click"),app.pages.legionrecommendpage.showPage())}),this.p_nodePalace.getChildByName("touch_ctr").on("touchend",function(){cc.log("touch \u7687\u5bab")}),this.p_nodePalace.on("touchend",function(){e.m_isMove||(app.playSound("click"),app.lockFunConfig&&app.lockFunConfig.checkPreFuncByKey("PALACE")?app.pages.prepagepalace.showPage():app.pages.palacepage.showPage())}),this.p_nodeNationWar.getChildByName("touch_ctr").on("touchend",function(){cc.log("touch \u56fd\u6218")}),this.p_nodeNationWar.on("touchend",function(){e.m_isMove||(app.playSound("click"),app.pages.nationWarMainPage.showPage())})},setParam:function(){this.upLock(),this.refreshPreCityUI(),this.refreshCityRed(),app.getUnlockGuideInfo(this.refreshNewFunc,this),this.refreshYoujie();var e=localDataUtils.GetValue("palacefirsttime",null);this.p_nodePalace.active=app.db.checkChannelShow("PALACE")&&app.db.checkPageUnLock("palacepage")&&(!e||1==e),this.p_nodeSummitChapmion.active=app.db.checkChannelShow("CHAPMION"),this.p_nodeNationWar.active=app.db.checkChannelShow("NATION_RING")},upLock:function(){for(var e in a){var t=a[e];if(this[t]){"palacepage"===e&&cc.log(2);var i=app.db.checkPageUnLock(e);this[t].active=i,i&&this.refreshCityUI(e,this[t],i)}}},controlFunctionByChannel:function(){var e=app.db.getChannelControlInfo(),t=localDataUtils.GetValue("palacefirsttime",null);this.p_nodePalace.active=1!=e.PALACE&&app.db.checkPageUnLock("palacepage")&&(!t||1==t),this.p_nodeSummitChapmion.active=1!=e.CHAPMION},refreshNewFunc:function(){this.m_arrNewFun||(this.m_arrNewFun=[]);var e=0;for(var t in a){var i=a[t];if(this[i]){var n=app.db.checkPageUnLock(t),r=app.db.getLockInfoByPage(t);if(n&&app.guideUnlockInfo[r.FUNCTION_ID])if(cc.log("city page func info",app.guideUnlockInfo[r.FUNCTION_ID]),app.guideUnlockInfo[r.FUNCTION_ID].isDone)this[i].getChildByName("new_func_item")&&(this[i].getChildByName("new_func_item").opacity=0);else if(this[i].getChildByName("new_func_item"))this[i].getChildByName("new_func_item").opacity=255;else{var o=this.m_arrNewFun[e];o||(o=cc.instantiate(this.p_prefabNewFun),this.m_arrNewFun.push(o));var s=cc.v2(0,0);this[i].getChildByName("rednotice")&&(s=this[i].getChildByName("rednotice").getPosition()),o.getComponent("newFuncItem").init(this[i],s),++e}}}},moveMapByTouch:function(e){if(e.getLocation&&!(Math.abs(e.getLocation().x-e.getStartLocation().x)<=6)){this.m_isMove=!0;var t=e.getDelta();this.setNodeMove(t)}},setNodeMove:function(e){var t=this.p_nodeBg.x,a=this.p_nodeBg.y,i=e.x,n=e.y,r=this.p_nodeBg.width/2-cc.winSize.width/2,o=-this.p_nodeBg.width/2+cc.winSize.width/2,s=this.p_nodeBg.height/2-cc.winSize.height/2,p=-this.p_nodeBg.height/2+cc.winSize.height/2;a+=1*n,t+=1.1*i,a=Math.min(s,a),a=Math.max(p,a),t=Math.min(r,t),t=Math.max(o,t),this.p_nodeBg.x=t},refreshCityUI:function(e,t,a){switch(e){case"summitpvpchapmionpage":return a&&app.pages.summitpvpchapmionpage.isOpen()?void 0:void(t&&cc.isValid(t)&&t.getChildByName("spr_name")&&(t.getChildByName("spr_name").active=!1))}},refreshPreCityUI:function(){this.preTimeItems=[]},refreshTime:function(){if(this.preTimeItems.length>0)for(var e=app.player.getServerTime(),t=0;t<this.preTimeItems.length;t++){var a=this.preTimeItems[t],i=a.etime-e;if(!(i>0)){this.preTimeItems=[],this.setParam();break}a.label&&(a.label.string=langMgr.getString("cityPage",5,gUtils.getCountDownStr(i)))}},refreshCityRed:function(){for(var e in a){var t=a[e];if(this[t]){var i=this[t].getChildByName("rednotice");app.pages[e]&&app.pages[e].refreshRed&&app.db.checkPageUnLock(e)?app.pages[e].refreshRed(i):i.active=!1}}},refreshYoujie:function(){app.palaceData&&app.palaceData.isNowPeopleYoujie()&&app.palaceData.youjie.player?(this.p_nodeYoujie.active=!0,this.p_nodeYoujie.getComponent("modGeneralPlayer").refreshUI()):this.p_nodeYoujie.active=!1},initBuildRedPacket:function(){var e=this;app.arrZhdTime&&!app.pages.activityHydtPage.isOpen()||app.player.sfGetHydtInfo().then(function(t){if(cc.isValid(e)){var n=t.reduce(function(e,t){return e[t.id]=t.end,e},cc.js.createMap()),r=app.player.getServerTime(),o=function(t){if(Object.hasOwnProperty.call(i,t)){var o=i[t],s=a[o];if(!cc.isValid(e[s]))return"continue";var p=e[s].getChildByName("img_red_packet");if(!cc.isValid(p))return"continue";app.db.checkPageUnLock(o)&&n[t]>r?(p.active||(p.active=!0,p.stopAllActions(),cc.tween(p).repeatForever(cc.tween().by(.1,{angle:15}).by(.1,{angle:-15}).by(.1,{angle:15}).by(.1,{angle:-15}).delay(.3)).start()),p.attr({eTime:n[t]}),p.off("click"),p.on("click",function(){app.pages.activityHydtPage.showPage({pageType:1,redPacketId:t})},e)):p.active=!1}};for(var s in i)o(s)}}).catch(function(e){cc.warn("\u8bf7\u6c42\u7ea2\u5305\u6570\u636e\u5931\u8d25",e)})}});n.refreshRed=function(e){for(var t=!1,i=Object.keys(a),n=0;n<i.length&&!(app.pages[i[n]]&&app.pages[i[n]].refreshRed&&app.db.checkPageUnLock(i[n])&&(t=app.pages[i[n]].refreshRed()));n++);return e&&(e.active=t),t},cc._RF.pop()},{basePage:void 0}],climbingTowerPage:[function(e,t){"use strict";function a(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(a)return(a=a.call(e)).next.bind(a);if(Array.isArray(e)||(a=i(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function i(e,t){if(e){if("string"==typeof e)return n(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?n(e,t):void 0}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,i=new Array(t);a<t;a++)i[a]=e[a];return i}cc._RF.push(t,"3f615O4SUtDaKgW4m20ppg0","climbingTowerPage");var r=cc.Class({extends:e("basePage"),statics:{prefabPath:"climbingtowerpage"},properties:{p_sprTitle:cc.Sprite,p_arrSprTitle:[cc.SpriteFrame],p_btnRank:cc.Button,p_btnHelp:cc.Button,p_btnAchieve:cc.Button,p_pfbPowerDisplay:cc.Prefab,p_nodePowerContent:cc.Node,_mNodePower:null,p_nodeRewardContent:cc.Node,p_pfbPropItem:cc.Prefab,_mRewardList:[],p_btnChallenge:cc.Button,p_nodeGeneralModel:cc.Node,p_labPlies:cc.Label,p_nodeTipBg:cc.Node,p_labTip:cc.Label,p_btnInfo:cc.Button,p_sprGeneral:cc.Sprite,p_spGeneral:sp.Skeleton,p_animGeneral:cc.Animation,p_nodePlies:cc.Node,p_prePass:cc.Prefab,p_sprHeroName:cc.Sprite,p_layoutFirstPass:cc.Node,p_pfbPlayer:cc.Prefab,p_firstPassSprFrame:[cc.SpriteFrame],p_sprEmptyTip:cc.Sprite,p_btnTgzdTip:cc.Button},onLoad:function(){r.instance=this,this.m_firstPassPlayers=[],this._firstPlayer=[],this.stopNodeEvent(),this.handleUI(),this.fitTopMenu(),this.m_girlPassTip=cc.instantiate(this.p_prePass),this.m_girlPassTip.parent=this.p_bgNode,this.m_girlPassTip.x=0,this.m_girlPassTip.y=103,this.m_girlPassTip.getChildByName("bg").getChildByName("title").getComponent(cc.Label).string="\u60a8\u5df2\u901a\u5173\u8bd5\u70bc\u5854\u6240\u6709\u5173\u5361~\u8bf7\u8010\u5fc3\u7b49\u5f85\u7b56\u5212\u66f4\u65b0\uff01",this.m_girlPassTip.active=!1},handleUI:function(){var e=this;this._super(),this.p_btnAchieve.node.on("click",function(){app.playSound("click"),app.pages.windowspageachieve.showPage(1)}),this.p_btnRank.node.on("click",function(){app.player.sfRankByType("tower",function(e,t){e?app.showNotice(e):app.pages.ranklistpage.showPage({rank:t,rtype:"tower",title:null})})}),this.p_btnHelp.node.on("click",function(){switch(app.playSound("click"),e.m_objData.type){case"occ":switch(e.m_objData.occ){case 1:app.pages.windowspagetipshelp.showPage("1002");break;case 2:app.pages.windowspagetipshelp.showPage("1004");break;case 3:app.pages.windowspagetipshelp.showPage("1005");break;case 4:app.pages.windowspagetipshelp.showPage("1003")}break;default:app.pages.windowspagetipshelp.showPage("1001")}}),this.p_btnTgzdTip.node.on("click",function(){app.playSound("click"),app.showNotice(langMgr.getString("climbingTowerPage",3,gConfig.skipTower))}),this.p_btnChallenge.node.on("click",function(){switch(app.playSound("click"),e.m_objData.type){case"occ":e.goOccFight();break;default:e.goFight()}},this),this.p_btnInfo.node.on("click",function(){if(app.playSound("click"),void 0!==e.m_tower){var t;switch(e.m_objData.type){case"occ":t=app.db.getOccTowerInfoByFloor(e.m_objData.occ,e.m_tower);break;default:t=app.db.getTowerInfoByFloor(e.m_tower)}if(!t)return cc.warn("no info, m_tower: ",e.m_tower);var a={type:"occ"==e.m_objData.type?e.m_objData.occ:-1,floor:e.m_tower,status:1};app.pages.practicetowerreplaypage.showPage(a)}},this)},afterBattleFresh:function(){var e=this.m_objData.occ||5;this.m_objData.floor=app.loginReset.OCCUTOWER[e-1],this.initUI()},setParam:function(e){cc.log(e),this.m_objData=e||{},this.initUI(),this.p_btnAchieve.node.active="occ"!=this.m_objData.type,app.runUnlockGuide("TOWER")},onEnable:function(){this._super(),eventMgr.on(eventStr.redEvent.RefreshTowerManageRed,this.refreshRed,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.redEvent.RefreshTowerManageRed,this.refreshRed,this)},initUI:function(){var e;this.setType(),this.setData(),this.refreshRed(),this.renderReward(),this.renderPowerView(),this.renderGeneralModel(),this.refreshFirstPass();var t=this.m_objData.occ||5;if(this.p_sprTitle.spriteFrame=this.p_arrSprTitle[t-1],this.p_labPlies.string=langMgr.getString("climbingTowerItem",0,null!=(e=this.m_objData.floor)?e:1),this.p_nodePlies.active=!!this.generalInfo,this.m_girlPassTip.active=!this.generalInfo,this.p_btnInfo.node.active=this.generalInfo,this.p_btnChallenge.interactable=!!this.generalInfo,this.p_btnTgzdTip.node.active=this.m_objData.floor<=gConfig.skipTower&&"occ"!=this.m_objData.type,this.p_nodeTipBg.opacity="occ"===this.m_objData.type&&this.generalInfo?255:0,"occ"===this.m_objData.type&&this.generalInfo){var a=app.db.getOccTowerInfoByFloor(this.m_objData.occ,this.m_tower);this.p_labTip.string=langMgr.getString("climbingTowerPage",2,a.UP_NUM,gConfig.getOccuLangByOccu(this.m_objData.occ))}else this.p_labTip.string=""},refreshFirstPass:function(){var e=this,t="occ"==this.m_objData.type?this.m_objData.occ:-1;-1==t?app.player.sfTowerReplay({floor:this.m_tower},function(t,a){e._firstPlayer=a||[],e.renderFirstPassPlayer()}):app.player.sfOccTowerVideo({floor:this.m_tower,type:t},function(t,a){e._firstPlayer=a||[],e.renderFirstPassPlayer()})},renderFirstPassPlayer:function(){var e=this;this.m_firstPassPlayers.map(function(e){return e.active=!1}),this.p_sprEmptyTip.node.active=!this._firstPlayer.length,this._firstPlayer.forEach(function(t,a){var i=e.m_firstPassPlayers[a];if(i||((i=cc.instantiate(e.p_pfbPlayer)).parent=e.p_layoutFirstPass,e.m_firstPassPlayers[a]=i),i.active=!0,i.getComponent("headItem").init({iconid:t.iconid,headid:t.headid,frameid:t.frameid,target:e}),!i.getChildByName("tip")){var n=new cc.Node("tip");n.parent=i,n.addComponent(cc.Sprite).spriteFrame=e.p_firstPassSprFrame[a],n.position=cc.v2(30,40)}var r=i.getChildByName("name");r||((r=new cc.Node("name")).parent=i,r.fontSize,r.position=cc.v2(0,-75));var o=r.getComponent(cc.Label);if(!o){(o=r.addComponent(cc.Label)).fontSize=20,o.color=cc.color(255,241,226);var s=r.addComponent(cc.LabelOutline);s.color=cc.color(92,52,29),s.width=2}o.string=t.name})},renderGeneralModel:function(){if(this.generalInfo){var e=this.generalInfo.team[Object.keys(this.generalInfo.team).sort(function(e,t){return e-t})[0]];app.loadTexture(app.db.getGNamePathHByGsid(e.gsid),this.p_sprHeroName,this.prefabPath),this.p_nodeGeneralModel.opacity=255,app.loadGeneral(e.gsid,this.p_sprGeneral,this.p_spGeneral,this.p_animGeneral,function(){},this.prefabPath)}else this.p_nodeGeneralModel.opacity=0},renderPowerView:function(){switch(this.m_objData.type){case"occ":var e=app.db.getOccTowerInfoByFloor(this.m_objData.occ,this.m_tower);this.generalInfo=e?app.db.getOccTowerBattleInfo(e.ID):null;break;default:this.generalInfo=app.db.getTowerBattleInfo(this.m_tower)}this.generalInfo?(cc.isValid(this._mNodePower)?this._mNodePower.opacity=255:(this._mNodePower=cc.instantiate(this.p_pfbPowerDisplay),this.p_nodePowerContent.addChild(this._mNodePower),this._mNodePower.setPosition(cc.Vec2.ZERO)),this._mNodePower.getComponent("PowerDisplay").init({val:this.generalInfo.power})):cc.isValid(this._mNodePower)&&(this._mNodePower.opacity=0)},setType:function(){switch(this.m_objData.type){case"occ":this.m_tower=this.m_objData.floor||app.db.dbOccTower.TOWER[this.m_objData.occ].length+1,this.p_btnRank.node.active=!1;var e=app.db.getOccTowerInfoByFloor(this.m_objData.occ,this.m_tower);if(!e)return void(this.generalInfo=null);this.generalInfo=app.db.getOccTowerBattleInfo(e.id);break;default:this._bQuick=1,this.m_tower=app.player.tower,this.p_btnRank.node.active=!0,this.generalInfo=app.db.getTowerBattleInfo(this.m_tower)}},refreshCoinUI:function(){var e=this.p_coinItem.getChildByName("icon").getComponent(cc.Sprite),t=this.p_coinItem.getChildByName("count").getComponent(cc.Label),a=app.db.getPropsIconPath(38011);t.string=app.player.getCount(38011),app.loadTexture(a,e,this.prefabPath)},setQuick:function(){this._bQuick=this._bQuick?0:1,cc.sys.localStorage.setItem(app.player.id+"tower",this._bQuick),this.refreshQuickBtn()},refreshQuickBtn:function(){for(var e,t=a(this.p_btnQuick.node.children);!(e=t()).done;){var i=e.value;"icon"==i.name&&(i.getComponent(cc.Sprite).spriteFrame=this._bQuick?this.p_arrSf[1]:this.p_arrSf[0])}},setData:function(){var e=this.m_tower;this.m_arrTower=[];for(var t=e-8;t<=e+3;++t)if(!(t<=0)){var a=void 0;switch(this.m_objData.type){case"occ":a=app.db.getOccTowerInfoByFloor(this.m_objData.occ,t);break;default:a=app.db.getTowerInfoByFloor(t)}if(!a)break;var i,n=a.ID;i=t==e?1:t<e?2:3,this.m_arrTower.push({chapter:t,status:i,id:n})}this.m_arrTower.reverse(),cc.log("\u5f53\u524d\u5c42",e,"\u722c\u5854\u6570\u636e\uff1a",this.m_arrTower)},refreshTabV:function(){this.setData(),assetMsg.ReleaseDynamic("tower")},refreshRed:function(){this.p_btnRank.node.getChildByName("redpoint").active=app.pages.rankpage.checkReward("tower"),this.p_btnAchieve.node.getChildByName("redpoint").active=app.pages.climbingtowerpage.checkReward()},onDestroy:function(){this._super(),assetMsg.ReleaseDynamic("tower")},goFight:function(){var e=this;app.battleType="tower",app.player.sfTowerInfo(function(t,a){t?app.showNotice(langMgr.getString("climbingTowerItem",2)):(app.battleConfig=a,app.player.level>=50&&!e._bQuick?app.pages.quickbattleformpage.showPage({battletype:"tower",sureCb:function(){app.goToNormBattle()},refreshCb:function(){cc.isValid(e)&&e.initUI()}}):app.goToNormBattle())})},goOccFight:function(){var e=this.m_objData.occ;app.player.sfGetOccFightInfo({type:e},function(t,a){if(t)return app.showNotice(t);app.occuType=e,app.battleType="occutower"+e,app.battleConfig=a,app.goToNormBattle()})},renderReward:function(){var e,t=[];if("all"==this.m_objData.type){if(!(e=app.db.getTowerInfoByFloor(this.m_tower)))return;t=e.REWARDS||[]}else{if(!(e=app.db.getOccTowerInfoByFloor(this.m_objData.occ,this.m_tower)))return;t=e.KILL_REWARDS||[]}for(var a=0;a<t.length;++a){var i=this._mRewardList[a];cc.isValid(i)?i.active=!0:(i=cc.instantiate(this.p_pfbPropItem),this.p_nodeRewardContent.addChild(i),this._mRewardList[a]=i),i.getComponent("propItem").initForBag(t[a]),i.getComponent("propItem").setClick(!0)}for(var n=t.length;n<this._mRewardList.length;++n)this._mRewardList[n].active=!1}});r.refreshRed=function(e){var t=app.pages.rankpage.checkReward("tower"),a=app.pages.climbingtowerpage.checkReward();return e&&(e.active=t||a),t||a},r.checkReward=function(){var e=app.player.getCount(app.db.dbTowerAchieve.GETMARK),t=gUtils.deepClone(app.db.dbTowerAchieve.ACHIEVE),a=!1;return!!t[e]&&(app.player.tower>t[e].TOWER&&(a=!0),a)},cc._RF.pop()},{basePage:void 0}],cloudManager:[function(e,t){"use strict";cc._RF.push(t,"4021f3/CKlI2b3mq6v4HTQr","cloudManager");cc.Class({extends:cc.Component,properties:{p_nodeCloud:[cc.Node]},onLoad:function(){var e=app.player.maxmapid;this.m_mapInfo=app.db.getMapInfo(e);var t=this.m_mapInfo.CITY,a=app.db.getCityInfo(t).CAMPID;this.initCloud(a)},initCloud:function(e){var t=this;this.p_nodeCloud.forEach(function(a,i){a.active=e<=i,e<=i&&t.playAnim(a)})},playAnim:function(e){var t=100*Math.random()+100,a=1*Math.random()+2;cc.tween(e).to(a,{opacity:t}).to(2,{opacity:255}).call(this.playAnim.bind(this,e)).start()}}),cc._RF.pop()},{}],dramaBossSurePage:[function(e,t){"use strict";cc._RF.push(t,"3d5a6AyiwNCf6jgRFhb1dCu","dramaBossSurePage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"dramabosssurepage",pageType:1},properties:{p_btnNext:cc.Button,p_labIntro:cc.Label},onLoad:function(){a.instance=this,this.stopNodeEvent(),this.handleUI()},handleUI:function(){var e=this;this._super(),this.p_btnNext.node.on("click",function(){e.getBossInfo(),e.onClose()})},setParam:function(e){this.m_bossId=e.id,this.m_bossInfo=e,this.refreshUI()},refreshUI:function(){var t=app.db.getDramaBossInfo(this.m_bossId);this.m_bossInfo.general=t.GSID,this.m_bossInfo.rewards=t.KREWARD;var a=app.db.getMapInfo(t.CHAPTER).CITY,i=app.db.getCityInfo(a),n=cc.js.formatStr(t.INTRO,i.NAME);this.p_labIntro.string=n;var r=e("newWorldMapPage").instance;if(cc.isValid(r)){var o=r.p_nodeDramaItem;if(cc.isValid(o)){var s=o.convertToWorldSpaceAR(cc.v2(0,o.height/2)),p=this.node.convertToNodeSpaceAR(s);this.p_bgNode.y=p.y+this.p_bgNode.width/2}}},getBossInfo:function(){var e=this,t=this.m_bossInfo;app.pages.newworldmappage.instance.onTouchCity(this.m_bossId,!0,function(){app.player.sfGetDramaBossInfo(e.m_bossId,function(e){t.bset=e,app.pages.windowspageplotboss.showPage({boss:t,type:2})})})}});cc._RF.pop()},{basePage:void 0,newWorldMapPage:"newWorldMapPage"}],dramabossListPage:[function(e,t){"use strict";cc._RF.push(t,"8f356qJq0NNbancQEwWmdGk","dramabossListPage");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=e("basePage"),o=cc._decorator,s=o.ccclass,p=o.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_nodeTitle=[],t.p_playerItem=null,t.p_countryItem=null,t.p_labTip=null,t.p_dramabossItem=null,t.p_scrollView=null,t.p_tableView=null,t.p_rewardList=null,t.p_propItem=null,t.p_challengeBtn=null,t.p_infoBtn=null,t.curIndex=0,t.m_rewardArr=[],t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){var t=this;a.instance=this,this.fitTopMenu(),e.prototype.onLoad.call(this),this.p_challengeBtn.node.on("click",function(){return t.itemClickHandle()}),this.p_infoBtn.node.on("click",function(){return t.infoClickHandle()})},t.prototype.onClose=function(){e.prototype.onClose.call(this),app.pages.newworldmappage.instance&&app.pages.newworldmappage.instance.refreshDramaBossIcon()},t.prototype.setParam=function(e){this.refreshData(e.data||[]),this.refreshDramaBoss();var t=gUtils.dateFormatter("YYYY-MM-DD",(new Date).getTime());localDataUtils.SetValue("dramabossred",t)},t.prototype.refreshData=function(e){this.m_dramaList=e},t.prototype.refreshDramaBoss=function(){var e=this;this.p_tableView&&this.p_tableView.getComponent("tableView").initTableView(this.m_dramaList.length,{array:this.m_dramaList,target:this},function(){var t=e.m_dramaList.length-1;e.m_dramaList.forEach(function(e,a){e.undoneCount>0&&(t=a)});var a=Math.max(t,0),i=e.p_tableView.getComponent("tableView"),n=(i.cell.data.height+-50)*a;i.scrollToOffset(new cc.Vec2(0,n),.5),e.selectMenu(a)})},t.prototype.reloadList=function(){var e=this;cc.isValid(this.p_tableView)&&this.p_tableView.getComponent("tableView").reload({array:this.m_dramaList,target:this},function(){var t=e.m_dramaList.length-1;e.m_dramaList.forEach(function(e,a){e.undoneCount>0&&(t=a)});var a=Math.max(t,0);a<e.curIndex&&e.selectMenu(a)})},t.prototype.selectMenu=function(e){this.curIndex=e,this.refreshUI()},t.prototype.itemClickHandle=function(){app.playSound("click"),app.pages.windowspageplotboss.showPage(this.m_dramaList[this.curIndex])},t.prototype.infoClickHandle=function(){app.playSound("click"),app.pages.windowspagetipshelp.showPage(1083)},t.prototype.refreshUI=function(){var e=this;this.p_tableView.getComponent("tableView").getCells(function(e){e.filter(function(e){return cc.Node.isNode(e)}).map(function(e){var t=e.getComponent("dramaBossCellItem");cc.isValid(t)&&t.refreshPickState()})});var t=this.m_dramaList[this.curIndex];if(t){var a=app.db.getDramaEventInfo(t.boss.bossid);this.m_rewardArr.map(function(e){return e.active=!1}),a.ITEMS.forEach(function(t,a){var i=e.m_rewardArr[a];i||((i=cc.instantiate(e.p_propItem)).parent=e.p_rewardList,i.scale=.8,e.m_rewardArr[a]=i),i.active=!0,i.getComponent("propItem").initForBag({gsid:t,count:1}),i.getComponent("propItem").setClick(!0);var n=i.getComponent("propItem").getGeneralNode();n?n.getComponent("generalPortraitItem").getNumNode().active=!1:i.getComponent("propItem").getNumNode().active=!1}),this.p_challengeBtn.interactable=t.undoneCount>0&&app.player.getServerTime()<t.etime}},t.prototype.resetGetList=function(){var e=this;app.player.sfDramaBossList(function(t){e.refreshData(t.eventlist||[]),e.reloadList()})},t.prefabPath="dramabosslistpage",n([p([cc.Node])],t.prototype,"p_nodeTitle",void 0),n([p(cc.Node)],t.prototype,"p_playerItem",void 0),n([p(cc.Node)],t.prototype,"p_countryItem",void 0),n([p(cc.Label)],t.prototype,"p_labTip",void 0),n([p(cc.Node)],t.prototype,"p_dramabossItem",void 0),n([p(cc.ScrollView)],t.prototype,"p_scrollView",void 0),n([p(cc.Node)],t.prototype,"p_tableView",void 0),n([p(cc.Node)],t.prototype,"p_rewardList",void 0),n([p(cc.Prefab)],t.prototype,"p_propItem",void 0),n([p(cc.Button)],t.prototype,"p_challengeBtn",void 0),n([p(cc.Button)],t.prototype,"p_infoBtn",void 0),a=n([s],t)}(r);c.refreshRed=function(e){return e&&(e.active=!1),!1},c.showPage=function(t,a,i){var n=this;app.player.sfDramaBossList(function(r){cc.log("boss\u5217\u8868",r),e("basePage").showPage.call(n,{objParam:t,data:r.eventlist},a,i)})},t.exports=c,cc._RF.pop()},{basePage:void 0}],dungeonBuffChoosePage:[function(e,t){"use strict";cc._RF.push(t,"d61edeOSf5G7LsonTMI+ybd","dungeonBuffChoosePage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"dungeonbuffchoosepage",pageType:1},properties:{p_arrNodeBuff:[cc.Node]},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){var e=this;this._super(),this.p_arrNodeBuff.forEach(function(t,a){t.on("touchend",function(){e._pickBuff!=a&&(e.isChoose||(e.timeBegin||(e.timeBegin=!0),e.timed=.5,e._pickBuff=a,e.refreshUI()))})})},setParam:function(e){this._pickBuff=-1,this.timed=.5,this.timeBegin=!1,this.isChoose=!1,this._chapter=e.chapter,this._node=e.node,this._pos=e.pos,this._buffs=e.buffs,this._confirmcb=e.confirmcb,this._confirmparm=e.confirmparm,this._target=e.target,this.refreshUI()},update:function(e){this.timeBegin&&(this.timed>0?this.timed-=e:this.chooseBuff())},refreshUI:function(){var e=this;this.p_arrNodeBuff.forEach(function(t,a){var i=app.db.getDungeonBuffInfo(e._buffs[a]);app.loadTexture(gConfig.getDungeonBuffPath(i.BPATH),t.getChildByName("spr_buff").getComponent(cc.Sprite),e.prefabPath),t.getChildByName("lab_up").getComponent(cc.Label).string=i.NAME,t.getChildByName("lab_down").getComponent(cc.Label).string=i.REMARKS+"+"+i.ADDITION+"%",t.getChildByName("buff_choose_bg_light").active=a==e._pickBuff})},chooseBuff:function(){var e=this;if(!this.sfChoose){this.sfChoose=!0,this.isChoose=!0,this.timeBegin=!1;var t={chapter:this._chapter,node:this._node,pos:this._pos,buff:this._pickBuff},a=this._buffs[this._pickBuff];app.player.sfDgChooseBuff(t,function(t,i){if(e.sfChoose=!1,t)return app.showNotice(t),void(e.isChoose=!1);var n=app.db.getDungeonBuffInfo(a);if(app.pages.dungeonpage.instance){var r=app.pages.dungeonpage.instance._buffList[n.NATUREID];null!=r?r+=n.ADDITION:r=n.ADDITION,app.pages.dungeonpage.instance._buffList[n.NATUREID]=r}e.onClose(),app.dgFightOver=!1,e._confirmcb&&e._confirmcb.call(e._target,e._confirmparm),i.global_gifts&&app.setNewRecommendGift(i.global_gifts),app.showRecommendGift()})}},onClose:function(){this._super()}});cc._RF.pop()},{basePage:void 0}],dungeonBuffRewardPage:[function(e,t){"use strict";cc._RF.push(t,"e1d8dKxytVAFrlEcAKt/1Lq","dungeonBuffRewardPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"dungeonbuffrewardpage",pageType:1},properties:{p_sprBuff:cc.Sprite,p_labName:cc.Label,p_labXianxi:cc.Label},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){this._super()},start:function(){},setParam:function(e){this.m_reward=e.reward,this.m_strPath=this.m_reward.BPATH,this.m_numLast=this.m_reward.LAST,this.m_name=this.m_reward.NAME,this.m_strName=this.m_reward.REMARKS,this.m_numAdd=this.m_reward.ADDITION,this.m_confirmcb=e.confirmcb,this.m_confirmparm=e.confirmparm,this.m_target=e.target,this.refreshUI()},refreshUI:function(){app.loadTexture(gConfig.getDungeonBuffPath(this.m_strPath),this.p_sprBuff,this.prefabPath),this.p_labName.string=this.m_name,this.m_numLast,this.p_labXianxi.string=this.m_strName+"+"+this.m_numAdd+"%"},onClose:function(){this.m_confirmcb&&this.m_confirmcb.call(this.m_target,this.m_confirmparm),this._super()}});cc._RF.pop()},{basePage:void 0}],dungeonBuffinfoPage:[function(e,t){"use strict";cc._RF.push(t,"4d6957P+79OwJ6MoMEcOwfe","dungeonBuffinfoPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"dungeonbuffinfopage",pageType:1},properties:{p_nodeContent:cc.Node,p_nodeBuffItem:cc.Node},onLoad:function(){a.instance=this,this._arrItems=[],this._arrItems.push(this.p_nodeBuffItem),this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){this._super()},setParam:function(e){this._buffList=gUtils.deepClone(e.buffList),this._spbuffList=gUtils.deepClone(e.spbuffList),this.mergeBuffAddition(),this.refreshUI()},mergeBuffAddition:function(){for(var e in this._spbuffList)this._buffList[e]?this._buffList[e]+=this._spbuffList[e]:this._buffList[e]=this._spbuffList[e]},refreshUI:function(){this.p_nodeBuffItem.active=!1;var e=0;for(var t in this._buffList){var a=gUtils.deepClone(app.db.getDungeonBuffInfoNt(t));a.ADDITION=this._buffList[t],a.LAST=0;var i=this._arrItems[e];i||(i=cc.instantiate(this.p_nodeBuffItem),this._arrItems.push(i),i.parent=this.p_nodeContent),i.active=!0,i.getComponent("dungeonBuffinfoItem").refreshUI(a,this),e++}for(var n=e;n<this._arrItems.length;++n)this._arrItems[n].active=!1}});cc._RF.pop()},{basePage:void 0}],dungeonEnemyinfoPage:[function(e,t){"use strict";cc._RF.push(t,"15f37h93S1KKbNEGszceWzr","dungeonEnemyinfoPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"dungeonenemyinfopage",pageType:1},properties:{p_pfbItem:cc.Prefab,p_nodeContent:cc.Node,p_btnFight:cc.Button},onLoad:function(){a.instance=this,this.m_arrItems=[],this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){var e=this;this._super(),this.p_btnFight.node.on("click",function(){if(null==e._pickGeneral||e._pickGeneral<0||e._pickGeneral>=e._generalList.length)app.showNotice("\u6b66\u5c06\u5df2\u5168\u90e8\u9635\u4ea1");else if(e._bQuickFight)e.quickFight();else{e.onClose(),app.battleType="dungeon",app.lockGeneral={};for(var t=0;t<e._generalList.length;++t){app.lockGeneral[e._generalList[t].guid]=app.player.dealGeneral(gUtils.deepClone(e._generalList[t])),app.lockGeneral[e._generalList[t].guid].specialbuff=[];var a={};for(var i in e._buffList)a[i]=e._buffList[i];for(var n in e._spbuffList)a[n]+=e._spbuffList[n];for(var r in a){var o={};o[r]=a[r],app.lockGeneral[e._generalList[t].guid].specialbuff.push(o)}}app.dungeonInfo={chapter:e._chapter,node:e._cNodeinfo.node,pos:e._cNodeinfo.pos,detail:e._cNodeinfo.detail},app.enemyConfig=e._battleSet,app.enemyHpper=e._hppercent,app.doLoading("scenes_battle")}})},setParam:function(e){this._chapter=e.chapter,this._cNodeinfo=e.cNodeinfo,this._bQuickFight=e.quickfight,this._confirmcb=e.confirmcb,this._confirmparm=e.confirmparm,this._target=e.target,this._buffList=e.buffList,this._spbuffList=e.spbuffList,this._generalList=e.generalList,this._pickGeneral=e.pickGeneral,this._enemySet=e.cNodeinfo.detail.set,this._battleSet=e.cNodeinfo.detail.set,this._hppercent=e.cNodeinfo.detail.hppercent,this.refreshUI()},refreshUI:function(){var e=app.db.getPveProperInfo(this._enemySet);this._enemySet=e.team;var t=0;for(var a in this._enemySet){var i=this.m_arrItems[t];i||((i=cc.instantiate(this.p_pfbItem)).parent=this.p_nodeContent,this.m_arrItems.push(i)),i.active=!0,this._enemySet[a].hppercent=this._hppercent&&null!=this._hppercent[a]?this._hppercent[a]:gConfig.saveHp,i.getComponent("generalDungeonItem").refreshUI(this._enemySet[a],!0,!0,!1),i.getComponent("generalDungeonItem").selected(!1),++t}for(var n=t;n<this.m_arrItems.length;++n)this.m_arrItems[n].active=!1},quickFight:function(){var e=this,t=gConfig.battleForm.dungeon,a={team:{}};if(a.team[app.seasonData.info.pos[0]]=this._generalList[this._pickGeneral].guid,app.player.battlearr[t]&&app.player.battlearr[t].mythic)a.mythic=app.player.battlearr[t].mythic;else{var i=this.getmythical();i&&(a.mythic=i)}if(!this._bClose){this._bClose=!0;var n={chapter:this._chapter,node:this._cNodeinfo.node,pos:this._cNodeinfo.pos,battleset:a};this._target.quickFightAnimal(this._cNodeinfo.cNode),app.dungeonInfo={chapter:this._chapter,node:this._cNodeinfo.node,pos:this._cNodeinfo.pos,detail:this._cNodeinfo.detail},this.onClose(),app.player.sfDgStart(n,function(i,n){if(i)app.showNotice(i);else if(e.checkSeasonChange(n.season))e.caseErrOp("season change");else{app.battleSeed=n.seed,app.player.battlearr[t]=gUtils.deepClone(a);var r={chapter:e._chapter,node:e._cNodeinfo.node,pos:e._cNodeinfo.pos,battleid:n.battleid};app.player.sfDgEnd(r,function(t,a){if(t)app.showNotice(t);else{for(var i in e._resultData=a,"win"==a.result.ret&&(app.dgFightOver=!0),e._resultData=a,a.result.lper)e._generalList[e._pickGeneral].hppercent=a.result.lper[i];e._target.refreshGeneralList(),e._target.quickFightOverFun(a),app.dgPageData.generalList=e._generalList,a.global_gifts&&app.setNewRecommendGift(a.global_gifts)}})}})}},checkSeasonChange:function(e){return e!=app.seasonData.info.season},getmythical:function(){var e=0,t=0;for(var a in app.player.mythical)t<app.player.mythical[a].level&&(t=app.player.mythical[a].level,e=a);return e},onClose:function(){this._super()}});cc._RF.pop()},{basePage:void 0}],dungeonEntrancePage:[function(e,t){"use strict";cc._RF.push(t,"951dbRb1YBCoKsWjNBTJXWm","dungeonEntrancePage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"dungeonentrancepage"},properties:{p_arrBgChapter:[cc.Node],p_nodeMap:cc.Node,p_nodeMapMask:cc.Node,p_atlasChapterNum:cc.SpriteAtlas,p_sprChapterNum:cc.Sprite,p_nodePlayer:cc.Node,p_headContent:cc.Node,p_headPfb:cc.Prefab,p_specialAnim:cc.Animation,p_nodeBgFarm:cc.Node,p_spFarm:sp.Skeleton,p_btnShopList:cc.Button,p_btnRank:cc.Button,p_btnTips:cc.Button,p_sprShopRedNotice:cc.Sprite,p_labDgTimeTips:cc.Label,p_labTime:cc.Label,p_nodeLock:cc.Node,p_btnChallenge:cc.Button,p_noticeNoOpenNode:cc.Node,p_girlTip_prefab:cc.Prefab},onLoad:function(){a.instance=this,this._centerWorldPos=cc.v2(cc.winSize.width/2,cc.winSize.height/2),this.p_nodeBgFarm.active=!1,this.stopNodePropagation(this.p_nodeBgFarm),this.p_nodeLock.active=!1,this.stopNodePropagation(this.p_nodeLock),this.p_sprShopRedNotice.node.active=!1,this.schedule(this.refreshTime,1),this.stopBgNodeEvent(),this.fitTopMenu(),this.creatMask(!0),this.handleUI(),this.nextTime=0,this.m_headnode=null,this.grilTip=cc.instantiate(this.p_girlTip_prefab),this.grilTip.parent=this.p_bgNode,this.grilTip.x=0,this.grilTip.y=103,this.grilTip.getChildByName("bg").getChildByName("title").getComponent(cc.Label).string="\u5355\u9a91\u95ef\u5173\u8fd8\u672a\u5f00\u542f\uff0c\u8bf7\u8010\u5fc3\u7b49\u5f85\uff01",this.grilTip.active=!1,this.timed=0},refreshTime:function(){if(app.dgOpenTime){if(this.timed>0)return this.timed--,void(this.p_labTime.string=gUtils.getCountDownStr(1e3*this.timed));var e=app.player.getServerTime(),t=app.dgOpenTime;t-e<0?(this.timed=5,app.player.sfDgChapterClearList()):this.p_labTime.string=gUtils.getCountDownStr(t-e)}},stopNodePropagation:function(e){e.on("touchstart",function(e){e.stopPropagation()}),e.on("touchmove",function(e){e.stopPropagation()}),e.on("touchend",function(e){e.stopPropagation()})},moveMapByTouch:function(e){if(e.getLocation&&!(Math.abs(e.getLocation().y-e.getStartLocation().y)<=6)){this.m_isMove=!0;var t=this.p_nodeMap.y,a=e.getDelta();this.setNodeMove(t,a.y)}},setNodeMove:function(e,t){var a=this.p_arrBgChapter[this._curIndex],i=this.p_arrBgChapter[this.getOtherIndex(this._curIndex)],n=a.height*a.scaleY/2,r=cc.winSize.height-n,o=a.convertToWorldSpaceAR(cc.v2(0,0)),s=n-cc.winSize.height/2+2*this._curChapterGroup*n,p=-(n-cc.winSize.height/2+(7-this._curChapterGroup)*a.height*a.scaleY),c=e;e+=t,0==this._curMap&&(e=Math.min(s,e)),7==this._curMap&&(e=Math.max(p,e)),this.p_nodeMap.y=e;var h=o.y+(e-c);if(t<0&&h<-n?(this._curMap++,this._curIndex=this.getOtherIndex(this._curIndex)):t>0&&h>n+cc.winSize.height&&(this._curMap--,this._curIndex=this.getOtherIndex(this._curIndex)),t<0&&h<r){if(a.y>i.y){i.y=a.y+a.height*a.scaleY;for(var l=1;l<=6;++l){var g="spr_chapter"+l,d="layout_chapter_num_"+l,u=i.getChildByName(g),f=i.getChildByName(d);u.chapterid+=12,this.refreshSprFlag(u.getChildByName("spr_flag"),u.chapterid),this.refreshSprChapterNum(u,f)}}}else if(t>0&&h>n&&a.y<i.y){i.y=a.y-a.height*a.scaleY;for(var m=1;m<=6;++m){var _="spr_chapter"+m,v="layout_chapter_num_"+m,b=i.getChildByName(_),y=i.getChildByName(v);b.chapterid-=12,this.refreshSprFlag(b.getChildByName("spr_flag"),b.chapterid),this.refreshSprChapterNum(b,y)}}},getOtherIndex:function(e){return 0==e?1:0},handleUI:function(){var e=this;this._super(),this.p_nodeMapMask.on("touchmove",function(t){e.moveMapByTouch(t)}),this.p_nodeMapMask.on("touchend",function(){e.m_isMove=!1}),this.p_btnShopList.node.on("click",function(){e.p_sprShopRedNotice.node.active=!1,app.pages.dungeonshoplistpage.showPage(e._chapterid)}),this.p_btnRank.node.on("click",function(){app.pages.dungeonrankpage.showPage()}),this.p_btnTips.node.on("click",function(){e.m_isMove||(app.playSound("click"),app.pages.windowspagetipshelp.showPage("1031"))}),this.p_arrBgChapter.forEach(function(t){for(var a=function(a){var i="spr_chapter"+a,n=t.getChildByName(i);n.on("touchend",function(){e.onClickChapter(n)})},i=1;i<=6;++i)a(i)}),this.p_btnChallenge.node.on("click",function(){app.playSound("click"),e.showDungeonPage()})},onClickChapter:function(e){e.chapterid==this._dungeonList.length-1?this.showDungeonPage():e.chapterid<this._dungeonList.length-1?0==this._dungeonList[e.chapterid].isget?this.getReward(e):app.showNotice(langMgr.getString("dungeonEntrancePage",2)):app.showNotice(langMgr.getString("dungeonEntrancePage",3))},showDungeonPage:function(){var e={chapterid:this._chapterid,generalList:this._generalList};app.pages.dungeonpage.showPage(e)},dgEntranceCheck:function(){new Date(app.player.getServerTime()).getDay(),this._bOpen=!0,this.p_nodeLock.active=!this._bOpen,this.setOpen(this._bOpen),this.p_labDgTimeTips.string=this._bOpen?langMgr.getString("dungeonEntrancePage",0):langMgr.getString("dungeonEntrancePage",1),this.refreshTime()},setOpen:function(e){this.p_btnChallenge.interactable=e,app.setSpriteState(this.p_btnChallenge.getComponentInChildren(cc.Sprite),!e),this.grilTip.active=!e},setParam:function(e){var t=this;if(void 0===e&&(e=!0),this.m_isMove=!1,this._curMap=0,this._curIndex=0,this._curChapterGroup=0,this.dgEntranceCheck(),this._bOpen){var a=function(e){e?app.player.sfDgChapterClearList(i):t.onClose()},i=function(i,n){if(i){if("generals nexist"==i){var r={confirmcb:a,target:t};app.pages.dungeonsavegeneralspage.showPage(r),app.runUnlockGuide("DUNGEON")}}else{localDataUtils.SetValue("dungeonred",1,app.dgOpenTime),t.p_nodeMap.setPosition(0,0),t.p_arrBgChapter.forEach(function(e,t){e.setPosition(0,t*e.height*e.scaleY)}),t._curIndex=0,t._dungeonList=n.dungeonlist,t._generalList=n.dungeonset,t._chapterid=!t._dungeonList||t._dungeonList.length<=0?0:t._dungeonList.length-1,app.dgPageData={chapterid:t._chapterid,generalList:t._generalList};var o=6*parseInt((t._dungeonList.length-1)/6);if(t.p_arrBgChapter.forEach(function(e,a){for(var i=1;i<=6;++i){var n="spr_chapter"+i,r="layout_chapter_num_"+i,s=o+(i-1)+6*a,p=e.getChildByName(n),c=e.getChildByName(r);p.chapterid=s,t.refreshSprFlag(p.getChildByName("spr_flag"),s),t.refreshSprChapterNum(p,c)}}),t._curMap=parseInt((t._dungeonList.length-1)/6),t._curChapterGroup=parseInt((t._dungeonList.length-1)/6),t.refreshUI(),app.dgFarmData&&app.dgFarmData.reward)t.showFarmProcess(),t.p_sprShopRedNotice.node.active=!0;else if(e){var s={chapterid:t._chapterid,generalList:t._generalList};app.pages.dungeonpage.showPage(s)}}};app.player.sfDgChapterClearList(i)}},refreshSprFlag:function(e,t){e.active=t>=0&&t<this._dungeonList.length-1&&1==this._dungeonList[t].isget},refreshSprChapterNum:function(e,t){var a=e.getChildByName("bg_spr_chapter");if(e.chapterid>=42)a.active=!1;else{a.active=!0,"JP"===gSetting.getLangName()&&(t.y=14),t.destroyAllChildren();var i=new cc.Node;i.parent=t,i.y=-15;var n=i.addComponent(cc.Label);n.string=String(e.chapterid+1),i.color=(new cc.Color).fromHEX("#d0550b"),n.fontSize=20}},showFarmProcess:function(){var e=this;this.p_nodeBgFarm.active=!0,this.p_spFarm.setAnimation(0,"animation",!1),this.p_spFarm.setCompleteListener(function(){cc.isValid(e)&&(e.p_spFarm.setAnimation(0,"animation2",!1),e.p_spFarm.setCompleteListener(function(){cc.isValid(e)&&(e.p_spFarm.setCompleteListener(null),e.p_nodeBgFarm.active=!1),app.pages.dungeonfarmrewardpage.showPage(),app.player.addItem(app.dgFarmData.reward)}))})},getReward:function(e){var t=this,a={chapter:e.chapterid};app.player.sfDgChapterReward(a,function(a,i){if(a)app.showNotice(langMgr.getString("dungeonEntrancePage",4));else{t._dungeonList[e.chapterid].isget=1,t.refreshSprFlag(e.getChildByName("spr_flag"),e.chapterid);var n={showtype:1,reward:i.reward,target:t};app.pages.windowspagereward.showPage(n),app.player.addItem(i.reward)}})},refreshUI:function(){this.showCurChapterNode(!0)},showCurChapterNode:function(e){var t=this.getChapterNode(0);this.focusOnChapterNode(t,t.scaleX<0?-1:1,e)},getChapterNode:function(e,t){if(this._chapterid%6==0&&this._chapterid>0&&1==e&&t){var a=this.p_arrBgChapter[0],i=a.height*a.scaleY/2-cc.winSize.height/2;this.setNodeMove(this.p_nodeMap.y,i+10)}for(var n=0;n<this.p_arrBgChapter.length;++n)for(var r=1;r<=6;++r){var o="spr_chapter"+r,s=this.p_arrBgChapter[n].getChildByName(o);if(1==e&&s.chapterid==this._chapterid-1||0==e&&this._chapterid==s.chapterid)return s}},focusOnChapterNode:function(e,t,a){var i=e.getChildByName("spr_flag").convertToWorldSpaceAR(cc.v2(0,0)),n=this.p_nodePlayer.parent.convertToNodeSpaceAR(i);if(this.p_nodePlayer.setPosition(n.x,n.y+240),a){var r=this.p_nodePlayer.convertToWorldSpaceAR(cc.v2(0,0)),o=this._centerWorldPos.y-r.y;this.setNodeMove(this.p_nodeMap.y,o)}},playTPAnim:function(e){var t=this;this.p_specialAnim.on("finished",function a(){t.p_specialAnim.off("finished",a),e&&e()}),app.loadEff("shengji_01",this.p_specialAnim,1,.7,.7)},marchToNextChapter:function(){var e=this,t=this.getChapterNode(1);this.focusOnChapterNode(t,t.scaleX<0?-1:1),this.p_specialAnim.node.setPosition(this.p_nodePlayer.x,this.p_nodePlayer.y),this.playTPAnim(function(){e.showCurChapterNode(),e.p_specialAnim.node.setPosition(e.p_nodePlayer.x,e.p_nodePlayer.y),e.playTPAnim(function(){var t={chapterid:e._chapterid,generalList:e._generalList};app.pages.dungeonpage.showPage(t)})})},onClose:function(){this.p_nodeBgFarm.activeInHierarchy||this._super()},onDestroy:function(){this.p_atlasChapterNum=null,this._super()}});a.refreshRed=function(e){var t=!1;return app.db.checkFuncUnLock("DUNGEON",!1)&&null==localDataUtils.GetValue("dungeonred",null)&&(t=!0),e&&(e.active=t),t},a.getResetTime=function(){},a.showPage=function(t,a,i){e("basePage").showPage.call(this,t,a,i)},cc._RF.pop()},{basePage:void 0}],dungeonFailPage:[function(e,t){"use strict";cc._RF.push(t,"886eb3kAIVN4Yn7qLE9p9gZ","dungeonFailPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"dungeonfailpage"},properties:{p_btnComfirm:cc.Button,p_nodeGeneral:cc.Node},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(),this.handleUI()},handleUI:function(){var e=this;this._super(),this.p_btnComfirm.node.on("click",function(){e.onClose()})},setParam:function(e){this._general=e,this.refreshUI()},refreshUI:function(){if(this._general){var e=app.db.getGBaseByGsid(this._general.gsid);this.p_nodeGeneral.getComponent("generalPortraitItem").initReport(e,this._general),this.p_nodeGeneral.getComponent("generalPortraitItem").setGray(!0)}},onClose:function(){this._super()}});cc._RF.pop()},{basePage:void 0}],dungeonFarmRewardPage:[function(e,t){"use strict";cc._RF.push(t,"7dbbe0DsbhFlbMVt/69axTp","dungeonFarmRewardPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"dungeonfarmrewardpage",pageType:1},properties:{p_nodePotion:cc.Node,p_labPotionNum:cc.Label,p_pfbItem:cc.Prefab,p_nodeContent:cc.Node,titleAnim:sp.Skeleton},onLoad:function(){a.instance=this,this._arrItems=[],this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){this._super()},setParam:function(){this._potion=app.dgFarmData.potion,this._reward=app.dgFarmData.reward,app.playUpgradeAnim({spComp:this.titleAnim,startName:"appear",endName:"loop",index:1,target:this}),this.refreshUI()},refreshUI:function(){this.p_nodePotion.active=this._potion&&this._potion.length>0,this.p_nodePotion.active&&(this.p_labPotionNum.string=this._potion[0].count);for(var e=0;e<this._reward.length;++e){var t=this._arrItems[e];t||(t=cc.instantiate(this.p_pfbItem)),t.active=!0,t.setParent(this.p_nodeContent),t.getComponent("propItem").initForBag(this._reward[e])}for(var a=this._reward.length;a<this._arrItems.length;++a)this._arrItems[a].active=!1},onClose:function(){this._super(),app.dgFarmData=null}});cc._RF.pop()},{basePage:void 0}],dungeonPage:[function(e,t){"use strict";cc._RF.push(t,"40ad5Mm0eRNOLfVfsMcizir","dungeonPage");var a=[0,0,0,0,0,0,0],i=cc.Class({extends:e("basePage"),statics:{prefabPath:"dungeonpage"},properties:{p_nodeDungeonBg:cc.Node,p_player:cc.Node,p_arrNodePoint:[cc.Node],p_nodeLines:cc.Node,p_arrNodes:[cc.Node],p_arrSprEvent:[cc.Sprite],p_arrLightNodes:[cc.Node],p_nodePlayerPosLight:cc.Node,p_nodeRewardBox:cc.Node,p_pfbItem:cc.Prefab,p_nodeContent:cc.Node,p_nodeQuickFight:cc.Node,p_nodeCheck:cc.Node,p_nodePotionReward:cc.Node,p_spFightWin:sp.Skeleton,p_spFightLose:sp.Skeleton,p_enmyFightEff:cc.Animation,p_playerFightEff:cc.Animation,p_btnShopList:cc.Button,p_sprShopRedNotice:cc.Sprite,p_btnRank:cc.Button,p_btnTips:cc.Button,p_sprGenerals:cc.Sprite,p_sprBuff:cc.Sprite,p_labTime:cc.Label,p_labTitle:cc.Label,p_nodeLock:cc.Node,p_nodeMsg:cc.Node,p_nodeMsgMask:cc.Node,p_btnMsgCancel:cc.Button,p_btnMsgConfirm:cc.Button},onLoad:function(){i.instance=this,this.quickFightEnmyInfo=null,this.quickFightOver=!1,this._playerComp=this.p_player.getComponent("dungeonPlayerItem"),this._playerComp.initTarget(this),this._arrCNodesPos=gConfig.getArrDungeonNodesPos();var e=localDataUtils.GetValue("bQuickFight_"+app.player.id,null);this._bQuickFight=null!=e&&1==e,this.schedule(this.refreshTime,1),this.stopBgNodeEvent(),this.creatMask(!0),this.fitTopMenu(),this.handleUI(),this.m_arrItems=[],this.timed=0},refreshTime:function(){if(app.dgOpenTime){if(this.timed>0)return this.timed--,void(this.p_labTime.string=gUtils.getCountDownStr(1e3*this.timed));var e=app.player.getServerTime(),t=app.dgOpenTime;t-e<0?(this.timed=5,app.player.sfDgChapterClearList()):this.p_labTime.string=gUtils.getCountDownStr(t-e)}},dungeonTimeoutCb:function(){var e=app.arrPages.indexOf(i.prefabPath);if(-1==e)return cc.warn("dungeonpage index error"),void this.onClose();for(var t=app.arrPages.length-1;t>=e;--t){if("mainscenes"==app.arrPages[t])return;app.pages[app.arrPages[t]].instance.onClose()}},handleUI:function(){var e=this;this.p_nodeDungeonBg.on("touchmove",function(t){e.moveMapByTouch(t)}),this.p_nodeDungeonBg.on("touchend",function(){e.m_isMove=!1}),this.p_btnShopList.node.on("click",function(){e.p_sprShopRedNotice.node.active=!1,app.pages.dungeonshoplistpage.showPage(e._chapterid)}),this.p_nodeQuickFight.on("touchend",function(){e.m_isMove||e._playerMoving||(app.playSound("click"),e.p_nodeCheck.active=!e._bQuickFight,e._bQuickFight=!e._bQuickFight,null==localDataUtils.GetValue("bQuickFight_"+app.player.id,null)&&(e.p_nodeMsg.active=!0),localDataUtils.SetValue("bQuickFight_"+app.player.id,e._bQuickFight))}),this.p_btnMsgCancel.node.on("click",function(){app.playSound("click"),e._bQuickFight=!1,localDataUtils.SetValue("bQuickFight_"+app.player.id,e._bQuickFight),e.p_nodeCheck.active=e._bQuickFight,e.p_nodeMsg.active=!1}),this.p_btnMsgConfirm.node.on("click",function(){app.playSound("click"),e._bQuickFight=!0,localDataUtils.SetValue("bQuickFight_"+app.player.id,e._bQuickFight),e.p_nodeCheck.active=e._bQuickFight,e.p_nodeMsg.active=!1}),this.p_nodeMsgMask.on("touchend",function(){e.p_nodeMsg.active=!1}),this.p_btnRank.node.on("click",function(){e.m_isMove||e._playerMoving||(app.playSound("click"),app.pages.dungeonrankpage.showPage())}),this.p_btnTips.node.on("click",function(){e.m_isMove||e._playerMoving||(app.playSound("click"),app.pages.windowspagetipshelp.showPage("1031"))}),this.p_sprGenerals.node.on("touchend",function(){var t={potion:e._potion,generalList:e._generalList,target:e};app.pages.dungeonpotionpage.showPage(t)}),this.p_sprBuff.node.on("touchend",function(){var t={buffList:e._buffList,spbuffList:e._spbuffList};app.pages.dungeonbuffinfopage.showPage(t)}),this.p_btnClose&&this.p_btnClose.node.on("click",function(){if(app.playSound("cancel"),app.dgChapterOver){var t={content:langMgr.getString("dungeonPage",9),confirmcb:function(){},target:e};app.pages.windowspagetipsmsg.showPage(t)}else e.onClose()})},showBuffChoose:function(){var e=this;app.player.sfDgChapterinfo(function(t,a){if(t)return"generals nexist"==t&&(t=langMgr.getString("dungeonPage",7)),void app.showNotice(t);e._curNode=a.position,e._nodeList=a.nodelist,e._potion=a.potion,e._buffList=a.bufflist,e._spbuffList=a.spbufflist,app.dgFightOver&&e._nodeList[1].some(function(e){return 1==e.choose})&&(e.p_nodeLock.active=!0,e.p_spFightWin.node.active=!0,e.p_spFightWin.setAnimation(0,"effect",!1),e.p_spFightWin.setEndListener(function(){var t;e.p_nodeLock.active=!1,e.p_spFightWin.node.active=!1;for(var a=e._nodeList[1],i=0;i<a.length;++i)if(1==a[i].choose){t=e.p_arrNodes[i+1];break}var n={cNode:t,node:t.line-1,pos:t.pos,lightIndex:0},r={chapter:app.dungeonInfo.chapter,node:app.dungeonInfo.node,pos:app.dungeonInfo.pos,buffs:app.dungeonInfo.detail.buffs,confirmcb:e.eventCb,confirmparm:n,target:e};app.pages.dungeonbuffchoosepage.showPage(r)}))})},setParam:function(e){this.m_isMove=!1,this._playerMoving=!1,this.p_nodePotionReward.active=!1,this.p_nodeRewardBox.active=!1,this.p_nodeLock.active=!1,this.p_spFightWin.node.active=!1,this.p_spFightLose.node.active=!1,this.p_nodeDungeonBg.setPosition(cc.Vec2.ZERO),this._bFirstEnter=!0,this._curNode=e.position,this._nodeList=e.nodelist,this._chapterid=e.chapterid,this._generalList=e.generalList,this._potion=e.potion,this._buffList=e.bufflist,this._spbuffList=e.spbufflist,this.quickFightBegin=!1,this.refreshTime(),this.refreshUI()},refreshUI:function(e){var t=this;this.refreshNodeMap(e),this.refreshGeneralList(),this.m_arrItems.forEach(function(e,a){e.targetOff(t),e.on("touchend",function(){t.selectGeneral(a)},t)}),this.p_nodeCheck.active=this._bQuickFight},afterBattleFresh:function(){this.showBuffChoose(),this.refreshGeneralList()},refreshNodeMap:function(e){var t=this,i=this.getCNode(this._curNode,0);this.p_player.active=!0,this.p_player.setPosition(i.x,i.y),this._playerComp.updateAction(12181,"b_stand"),this.p_nodePlayerPosLight.setPosition(i.x,i.y),this._bFirstEnter&&(this._bFirstEnter=!1,this.setNodeMove(this.p_nodeDungeonBg.y,0-(i.y+(cc.winSize.height/2-300))+300)),e||this.p_arrSprEvent.forEach(function(e){e.node.active=!1}),this.getViewNodeList().forEach(function(e,i){var n=gConfig.getIconDungeonEventPath(e.type-1);t.p_arrSprEvent[i].node.active=!0,e.type<=3?(t.p_arrSprEvent[i].node.getChildByName("anim").active=!1,t.p_arrSprEvent[i].node.getChildByName("skeleton").active=!0,app.loadBattleGeneral(n,t.p_arrSprEvent[i].node.getChildByName("skeleton").getComponent(sp.Skeleton),"f_stand",t.prefabPath)):(cc.isValid(t.p_arrSprEvent[i].node.children[0])&&(t.p_arrSprEvent[i].node.children[0].active=!1),app.loadTexture(n,t.p_arrSprEvent[i].node.getChildByName("anim").getComponent(cc.Sprite),t.prefabPath,function(){t.p_arrSprEvent[i].node.getChildByName("anim").active=!0,t.p_arrSprEvent[i].node.getChildByName("skeleton").active=!1})),t._nodeList[2]&&t._nodeList[1]&&i>=t._nodeList[1].length?app.setSpriteState(t.p_arrSprEvent[i],!0):app.setSpriteState(t.p_arrSprEvent[i],!1);var r=t.getCNode(e,i+1);t.p_arrSprEvent[i].node.setPosition(r.x,r.y+a[e.type-1]),e.type>3?t.p_arrSprEvent[i].node.setScale(1):(t.p_arrSprEvent[i].node.scaleX=2==e.type?-1/.7:-1.5,t.p_arrSprEvent[i].node.scaleY=2==e.type?1/.7:1.5)}),this.setActiveNode(),this.p_labTitle.string=langMgr.getString("dungeonPage",0,[this._chapterid+1,this._curNode.node+1]),this.updateFace()},refreshGeneralList:function(){for(var e=this,t=0;t<this._generalList.length;++t){var a=this.m_arrItems[t];a||((a=cc.instantiate(this.p_pfbItem)).parent=this.p_nodeContent,this.m_arrItems.push(a)),a.active=!0,a.getComponent("generalDungeonItem").refreshUI(this._generalList[t],!1,!0,!1)}for(var i=t;i<this.m_arrItems.length;++i)this.m_arrItems[i].active=!1;var n=gConfig.battleForm.dungeon,r="";if(app.player.battlearr[n]){for(var o in app.player.battlearr[n].team)r=app.player.battlearr[n].team[o];this._generalList.forEach(function(t,a){t.guid==r&&(e._pickGeneral=a)}),(!this._pickGeneral||this._pickGeneral>=this._generalList.length||this._pickGeneral<0||this._generalList[this._pickGeneral].hppercent<=0)&&this.pickLiveGeneral()}else this.pickLiveGeneral();this.selectGeneral(this._pickGeneral)},pickLiveGeneral:function(){for(var e=!this._pickGeneral||this._pickGeneral>=this._generalList.length||this._pickGeneral<0?0:this._pickGeneral,t=0;t<this._generalList.length;++t){if(this._generalList[e].hppercent>0)return void(this._pickGeneral=e);e=e>=this._generalList.length-1?0:e+1}this._pickGeneral=-1},selectGeneral:function(e){if(!this.m_isMove&&!this._playerMoving)if(e<0||e>this._generalList.length-1)for(var t=0;t<this.m_arrItems.length;++t)this.m_arrItems[t].getComponent("generalDungeonItem").selected(!1);else if(this._generalList[e].hppercent<=0)app.showNotice("\u8be5\u6b66\u5c06\u5df2\u9635\u4ea1");else{this._pickGeneral=e;for(var a=0;a<this.m_arrItems.length;++a)this.m_arrItems[a].getComponent("generalDungeonItem").selected(e==a);var i=gConfig.battleForm.dungeon;if(app.player.battlearr[i])for(var n in app.player.battlearr[i].team)app.player.battlearr[i].team[n]=this._generalList[this._pickGeneral].guid;else app.player.battlearr[i]={team:{3:this._generalList[this._pickGeneral].guid}}}},showGeneralForm:function(){},getViewNodeList:function(){var e=this,t=[];return this._curNode.node>=15?t:(this._nodeList[1].forEach(function(a,i){var n=gUtils.deepClone(a);n.node=e._curNode.node+1,n.pos=i,t.push(n)}),this._curNode.node<14&&this._nodeList[2].forEach(function(a,i){var n=gUtils.deepClone(a);n.node=e._curNode.node+2,n.pos=i,t.push(n)}),t)},getCNode:function(e,t){var a=e.node+1,i=e.pos,n=this._arrCNodesPos[a][i];return this.p_arrNodes[t].setPosition(n.x,n.y),this.p_arrNodes[t].line=a,this.p_arrNodes[t].pos=i,this.p_arrNodes[t]},setActiveNode:function(){var e=this,t=this._curNode.node+1,a=this._curNode.pos,i=[];if(16!=t)if(this._nodeList[1].some(function(e){return 1==e.choose}))this._nodeList[1].forEach(function(t,a){var n=e.p_arrNodes[a+1];if(1==t.choose)i.push(n);else{var r=e.p_arrSprEvent[a].node;r&&(r.active=!1)}});else if(t%2==0&&0!=t)switch(a){case 0:i.push(this.p_arrNodes[1]);break;case 1:i.push(this.p_arrNodes[1]),i.push(this.p_arrNodes[2]);break;case 2:i.push(this.p_arrNodes[2])}else 15==t?i.push(this.p_arrNodes[1]):0==t?(i.push(this.p_arrNodes[1]),i.push(this.p_arrNodes[2])):0==a?(i.push(this.p_arrNodes[1]),i.push(this.p_arrNodes[2])):(i.push(this.p_arrNodes[2]),i.push(this.p_arrNodes[3]));this.p_arrNodes.forEach(function(t,a){(!e._nodeList[2]||e._nodeList[2].length<2)&&a>e._nodeList[1].length?t.active=!1:(t.active=!0,t.targetOff(e),t.on("touchend",function(){e.m_isMove||e._playerMoving||app.showNotice(langMgr.getString("dungeonPage",5))},e))}),this.p_arrLightNodes.forEach(function(e){e.active=!1}),this.p_arrNodePoint.forEach(function(e){e.active=!1}),i.forEach(function(t,a){t.targetOff(e),t.on("touchend",function(){e.m_isMove||e._playerMoving||e.quickFightBegin||e.onNodeTouch(t,a)},e),e.p_arrLightNodes[a].setPosition(t.x,t.y),e.p_arrLightNodes[a].active=!0;var i=t.parent.convertToWorldSpaceAR(t.getPosition()),n=e.p_arrNodePoint[a].parent.convertToNodeSpaceAR(i);e.p_arrNodePoint[a].active=!0,e.p_arrNodePoint[a].setPosition(n.x,n.y+120),e.p_arrNodePoint[a].stopAllActions(),e.p_arrNodePoint[a].runAction(cc.repeatForever(cc.sequence(cc.moveBy(.5,cc.v2(0,20)),cc.moveBy(.5,cc.v2(0,-20)))))})},onNodeTouch:function(e,t){var a=this,i={chapter:this._chapterid,node:e.line-1,pos:e.pos};app.player.sfDgChooseNode(i,function(i,n){if(i)return"already choose"==i&&(i=langMgr.getString("dungeonPage",5)),void app.showNotice(i);a._nodeList[1].forEach(function(t,i){var n=a.p_arrNodes[i+1];n.pos!=e.pos?(n.targetOff(a),n.on("touchend",function(){a.m_isMove||a._playerMoving||app.showNotice(langMgr.getString("dungeonPage",5))},a)):t.choose=1;var r=a.p_arrSprEvent[i].node;r&&(r.active=n.pos==e.pos)}),a.p_arrLightNodes.forEach(function(e,a){e.active=a==t}),a.p_arrNodePoint.forEach(function(e,a){e.active=a==t}),n.cNode=e,n.node=e.line-1,n.pos=e.pos,n.lightIndex=t,a.processEvent(n),a.updateFace()})},processEvent:function(e){switch(e.type){case 1:case 2:case 3:if(app.dgFightOver||this.checkBattleOver(e)){var t={chapter:this._chapterid,node:e.node,pos:e.pos,buffs:e.detail.buffs,confirmcb:this.eventCb,confirmparm:e,target:this};app.pages.dungeonbuffchoosepage.showPage(t)}else{var a={chapter:this._chapterid,cNodeinfo:e,quickfight:this._bQuickFight,generalList:this._generalList,pickGeneral:this._pickGeneral,buffList:this._buffList,spbuffList:this._spbuffList,confirmcb:this.eventCb,confirmparm:e,target:this};app.pages.dungeonenemyinfopage.showPage(a)}break;case 4:var i={showtype:1,reward:e.detail.goods,confirmcb:this.eventCb,confirmparm:[e],target:this};app.pages.windowspagereward.showPage(i),app.player.addItem(e.detail.goods);break;case 5:this.processEvent(e.detail.detail);break;case 6:var n={chapter:this._chapterid,node:e.node,pos:e.pos,detail:e.detail,confirmcb:this.eventCb,confirmparm:e,target:this};app.pages.dungeonshoppage.showPage(n);break;case 7:this.campEvent(e);break;case 8:var r={chapter:this._chapterid,detail:e.detail,confirmcb:this.eventCb,confirmparm:e,target:this};app.pages.dungeonturntablepage.showPage(r)}},eventCb:function(e){var t=this;if(this.p_arrSprEvent[e.pos].node.active=!1,this.p_arrLightNodes[e.lightIndex].active=!1,this.p_arrNodePoint[e.lightIndex].active=!1,app.dgChapterOver=!1,app.player.sfPlayerByParam(["dgtop"]),15==e.node)e.cNode.targetOff(this),this.p_nodeRewardBox.active=!0,this.p_nodeRewardBox.setPosition(e.cNode.x,e.cNode.y),this.p_nodeRewardBox.on("touchend",function(){t.getReward()}),app.dgChapterOver=!0;else{var a=new vecT(e.cNode.x,e.cNode.y);this._playerMoving=!0,this._playerComp.move(12181,null,a,function(){app.player.sfDgChapterinfo(function(e,a){e?app.showNotice(e):(t._curNode=a.position,t._nodeList=a.nodelist,t._potion=a.potion,t._buffList=a.bufflist,t._spbuffList=a.spbufflist,t.refreshNodeMap(),t.refreshGeneralList(),t._playerMoving=!1)})})}},getReward:function(){var e=this,t={chapter:this._chapterid};app.player.sfDgChapterReward(t,function(t,a){if(t)app.showNotice(langMgr.getString("dungeonPage",6));else{var i={showtype:1,reward:a.reward,confirmcb:e.finishChapterCb,target:e};app.pages.windowspagereward.showPage(i),app.player.addItem(a.reward),app.dgChapterOver=!1}})},finishChapterCb:function(){this.onClose(),app.pages.dungeonentrancepage.instance.setParam(!1)},checkBattleOver:function(e){if(!e.detail.hppercent)return!1;var t=e.detail.set,a=e.detail.hppercent;for(var i in t)if(0!=a[i])return!1;return!0},campEvent:function(e){var t=this;this.p_nodePotionReward.stopAllActions(),this.p_nodePotionReward.active=!0,this.p_nodePotionReward.opacity=255,this.p_nodePotionReward.parent=cc.director.getScene(),this.p_nodePotionReward.x=.5*cc.winSize.width,this.p_nodePotionReward.y=.75*cc.winSize.height,this.p_nodePotionReward.zIndex=500;var a=cc.sequence(cc.moveBy(.8,0,60),cc.fadeOut(.5),cc.callFunc(function(){t.p_nodePotionReward.active=!1}));this.p_nodePotionReward.runAction(a),this.eventCb(e)},moveMapByTouch:function(e){if(e.getLocation&&!(Math.abs(e.getLocation().y-e.getStartLocation().y)<=6)){this.m_isMove=!0;var t=this.p_nodeDungeonBg.y,a=e.getDelta();this.setNodeMove(t,a.y)}},setNodeMove:function(e,t){var a=this.p_nodeDungeonBg.height/2-cc.winSize.height/2,i=-this.p_nodeDungeonBg.height/2+cc.winSize.height/2;e+=1.05*t,e=Math.min(a,e),e=Math.max(i,e),this.p_nodeDungeonBg.y=e},onClose:function(){this._super()},updateFace:function(){var e=this;this.m_isMove||this._playerMoving||this.getViewNodeList().forEach(function(t,a){if(t.choose&&(1==t.type||2==t.type||3==t.type)){var i=e.p_arrSprEvent[a].node,n=i.convertToWorldSpaceAR(cc.v2()),r=e._playerComp.p_aniRole.node,o=r.convertToWorldSpaceAR(cc.v2());(n<=o&&i.scaleX<0||n>o&&i.scaleX>0)&&(i.scaleX=-1*i.scaleX),(n>=o&&r.scaleX>0||n<o&&r.scaleX<0)&&(r.scaleX=-1*r.scaleX)}})},quickFightAnimal:function(){var e=this;this.quickFightBegin=!0,this.quickFightOver=!1,this.quickFightEnmyInfo={},this.getViewNodeList().forEach(function(t,a){if(t.choose){if(1==t.type||2==t.type||3==t.type)e.quickFightEnmyInfo.strIconPath=gConfig.getIconDungeonEventPath(t.type-1),e.quickFightEnmyInfo.Node=e.p_arrSprEvent[a].node,e.quickFightEnmyInfo.type=t.type,e.quickFightEnmyInfo.scaleX=e.quickFightEnmyInfo.Node.scaleX,e.quickFightEnmyInfo.scaleY=e.quickFightEnmyInfo.Node.scaleY;else{e.quickFightEnmyInfo.strIconPath=gConfig.getIconDungeonEventPath(t.type-1),e.quickFightEnmyInfo.Node=e.p_arrSprEvent[a].node,e.quickFightEnmyInfo.type=t.type,e._playerAttack=!0;var i=e.p_arrSprEvent[a].node.convertToWorldSpaceAR(cc.v2()),n=e._playerComp.p_aniRole.node,r=n.convertToWorldSpaceAR(cc.v2());(i>=r&&n.scaleX<0||i<r&&n.scaleX>0)&&(n.scaleX=-1*n.scaleX)}return e._playerAttack=!0,e.p_actname=e.getAttckFace(!0),app.loadBattleGeneral(app.db.getGBaseByGsid(12181).MODEL,e._playerComp.p_aniRole,e.p_actname,app.pages.dungeonpage.prefabPath,function(){e.scheduleOnce(function(){e.quickFightResult(1==t.type||2==t.type||3==t.type)},e.getDurationTime(e._playerComp.p_aniRole,e.p_actname))},!1),void e.showFightEff()}})},quickFightResult:function(e){var t=this;void 0===e&&(e=!0),this.quickFightOver?(cc.log("quickOver"),this.quickFightBegin=!1,this.showFightEff(!1),this.quickFightEnmyInfo=null,"win"==this._quickResultData.result.ret?this.showBuffChoose():(this.p_nodeLock.active=!0,this.p_spFightLose.node.active=!0,this.p_spFightLose.setAnimation(0,"effect",!1),this.p_spFightLose.setEndListener(function(){t.p_nodeLock.active=!1,t.p_spFightLose.node.active=!1,t.refreshUI(!0)}))):e?this._playerAttack?(this.quickFightEnmyInfo.e_actname=this.getAttckFace(!1),app.loadBattleGeneral(this.quickFightEnmyInfo.strIconPath,this.quickFightEnmyInfo.Node.getChildByName("skeleton").getComponent(sp.Skeleton),this.quickFightEnmyInfo.e_actname,app.pages.dungeonpage.prefabPath,function(){t.quickFightEnmyInfo.Node.scaleX=t.quickFightEnmyInfo.scaleX,t.quickFightEnmyInfo.Node.scaleY=t.quickFightEnmyInfo.scaleY,t.scheduleOnce(function(){t.quickFightResult(!0)},t.getDurationTime(t.quickFightEnmyInfo.Node.getChildByName("skeleton").getComponent(sp.Skeleton),t.p_actname))},!1),this._playerAttack=!1):(app.loadBattleGeneral(app.db.getGBaseByGsid(12181).MODEL,this._playerComp.p_aniRole,this.p_actname,app.pages.dungeonpage.prefabPath,function(){t.scheduleOnce(function(){t.quickFightResult(!0)},t.getDurationTime(t._playerComp.p_aniRole,t.p_actname))},!1),this._playerAttack=!0):app.loadBattleGeneral(app.db.getGBaseByGsid(12181).MODEL,this._playerComp.p_aniRole,this.p_actname,app.pages.dungeonpage.prefabPath,function(){t.scheduleOnce(function(){t.quickFightResult(!1)},t.getDurationTime(t._playerComp.p_aniRole,t.p_actname))},!1)},quickFightOverFun:function(e){this.quickFightOver=!0,this._quickResultData=e,cc.log(e)},getAttckFace:function(e){return void 0===e&&(e=!0),this.quickFightEnmyInfo.Node.convertToWorldSpaceAR(cc.v2()),this._playerComp.p_aniRole.node.convertToWorldSpaceAR(cc.v2()),e?"b_attack":"f_attack"},getDurationTime:function(e,t){var a=e.skeletonData,i=0;t=t.split("_")[1];for(var n=0;n<a.getRuntimeData().animations.length;n++){var r=a.getRuntimeData().animations[n];r.name.indexOf(t)>=0&&(i=r.duration)}return i},showFightEff:function(e){if(void 0===e&&(e=!0),e){var t=this._playerComp.node.parent.convertToWorldSpaceAR(this._playerComp.node.getPosition()),a=this.p_playerFightEff.node.parent.convertToNodeSpaceAR(t);this.p_playerFightEff.node.active=!0,this.p_playerFightEff.node.setPosition(a.x,a.y+120),app.loadEff("fight_anim",this.p_playerFightEff,2,1,1,14),(1==this.quickFightEnmyInfo.type||2==this.quickFightEnmyInfo.type||3==this.quickFightEnmyInfo.type)&&(t=this.quickFightEnmyInfo.Node.parent.convertToWorldSpaceAR(this.quickFightEnmyInfo.Node.getPosition()),a=this.p_enmyFightEff.node.parent.convertToNodeSpaceAR(t),this.p_enmyFightEff.node.active=!0,this.p_enmyFightEff.node.setPosition(a.x,a.y+100),app.loadEff("fight_anim",this.p_enmyFightEff,2,1,1,14),this.p_arrNodePoint.forEach(function(e){e.active=!1}))}else this.p_enmyFightEff.node.active=!1,this.p_playerFightEff.node.active=!1}});i.showPage=function(t,a,i){var n=this;app.player.sfDgChapterinfo(function(r,o){if(r)return"generals nexist"==r&&(r=langMgr.getString("dungeonPage",7)),void app.showNotice(r);o.chapterid=t.chapterid,o.generalList=t.generalList,e("basePage").showPage.call(n,o,a,i)})},cc._RF.pop()},{basePage:void 0}],dungeonPotionPage:[function(e,t){"use strict";cc._RF.push(t,"1a165Nc2AVLpYVvAO+g0QKN","dungeonPotionPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"dungeonpotionpage",pageType:1},properties:{p_sprProp:cc.Sprite,p_labNum:cc.Label,p_nodeContent:cc.Node,p_pfbItem:cc.Prefab,p_btnConfirm:cc.Button},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this._arrItems=[]},handleUI:function(){var e=this;this._super(),this.p_btnConfirm.node.on("click",function(){app.playSound("click"),e.usePotion()})},setParam:function(e){e&&(this._data=e,this._potion=e.potion,this._generalList=e.generalList,this._target=e.target,this._pickGeneral=-1,this.refreshUI())},refreshUI:function(){var e=this;this.refreshPotionCount(),this.refreshGeneralList(),this._arrItems.forEach(function(t,a){t.on("touchend",function(){e.selectGeneral(a)})})},refreshGeneralList:function(){for(var e=0;e<this._generalList.length;++e){var t=this._arrItems[e];t||((t=cc.instantiate(this.p_pfbItem)).parent=this.p_nodeContent,this._arrItems.push(t)),t.active=!0,t.getComponent("generalDungeonItem").refreshUI(this._generalList[e],!1,!0,!1)}for(var a=e;a<this._arrItems.length;++a)this._arrItems[a].active=!1;this.pickLiveGeneral(),this.selectGeneral(this._pickGeneral)},pickLiveGeneral:function(){for(var e=this._pickGeneral>=this._generalList.length||this._pickGeneral<0?0:this._pickGeneral,t=0;t<this._generalList.length;++t){if(this._generalList[e].hppercent>0)return void(this._pickGeneral=e);e=e>=this._generalList.length-1?0:e+1}this._pickGeneral=-1},selectGeneral:function(e){if(e<0||e>this._generalList.length-1)for(var t=0;t<this._arrItems.length;++t)this._arrItems[t].getComponent("generalDungeonItem").selected(!1);else if(this._generalList[e].hppercent<=0)app.showNotice(langMgr.getString("dungeonPotionPage",2));else{this._pickGeneral=e;for(var a=0;a<this._arrItems.length;++a)this._arrItems[a].getComponent("generalDungeonItem").selected(e==a)}},usePotion:function(){var e=this;if(this._potion[0]&&0!=this._potion[0].count)if(this._pickGeneral<0||this._pickGeneral>this._generalList.length-1)app.showNotice(langMgr.getString("dungeonPotionPage",1));else if(0!=this._generalList[this._pickGeneral].hppercent)if(1e4!=this._generalList[this._pickGeneral].hppercent){var t={potion:101,guid:this._generalList[this._pickGeneral].guid};app.player.sfDgUsePotion(t,function(t,a){if(t)return"nomore potion"==t?t=langMgr.getString("dungeonPotionPage",5):"hp full"==t&&(t=langMgr.getString("dungeonPotionPage",6)),void app.showNotice(t);for(var i=0;i<e._generalList.length;++i)if(e._generalList[i].guid==a.guid){e._generalList[i].hppercent=a.hppercent;break}app.dgPageData.generalList=e._generalList,e._potion[0]&&e._potion[0].count--,e.refreshUI(),e._target.refreshGeneralList(),app.showNotice(langMgr.getString("dungeonPotionPage",4))})}else app.showNotice(langMgr.getString("dungeonPotionPage",3));else app.showNotice(langMgr.getString("dungeonPotionPage",2));else app.showNotice(langMgr.getString("dungeonPotionPage",0))},refreshPotionCount:function(){this.p_labNum.string=this._potion[0]?this._potion[0].count:0}});cc._RF.pop()},{basePage:void 0}],dungeonQuickResultPage:[function(e,t){"use strict";cc._RF.push(t,"eb590IGAT1KS4NZnAPmD4i+","dungeonQuickResultPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"dungeonquickresultpage",pageType:1},properties:{p_leftGeneralNode:cc.Node,p_rightGeneralNode:cc.Node,p_btnReport:cc.Button,p_btnVideo:cc.Button},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){var e=this;this._super(),this.p_btnReport&&this.p_btnReport.node.on("click",function(){e.onReport()}),this.p_btnVideo&&this.p_btnVideo.node.on("click",function(){e.goToPlayReplay()})},setParam:function(e){this._resultData=e.result,this._videoid=e.videoid,this.refreshUI()},refreshUI:function(){if(this.p_leftGeneralNode){var e={gsid:this._resultData.report.left[0].gsid};e.hppercent=this._resultData.ltper,e.level=this._resultData.report.left[0].level,this.p_leftGeneralNode.getComponent("generalDungeonItem").refreshUI(e,!1,!0,!1),this.p_leftGeneralNode.getComponent("generalDungeonItem").selected(!1)}if(this.p_rightGeneralNode){var t={gsid:this._resultData.report.right[0].gsid};t.hppercent=this._resultData.rtper,t.level=this._resultData.report.right[0].level,this.p_rightGeneralNode.getComponent("generalDungeonItem").refreshUI(t,!1,!0,!1),this.p_rightGeneralNode.getComponent("generalDungeonItem").selected(!1)}},goToPlayReplay:function(){},onReport:function(){app.player.sfVideoInfo(this._videoid,function(e,t){if(e)app.showNotice(langMgr.getString("quickBattleResultPage",2));else{var a=JSON.parse(t.video);app.pages.battlereportpage.showPage({obj:a})}})},onClose:function(){this._super()}});cc._RF.pop()},{basePage:void 0}],dungeonRankPage:[function(e,t){"use strict";cc._RF.push(t,"56830VUrZ9NrobUxR+C1XrN","dungeonRankPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"dungeonrankpage"},properties:{p_nodeView:cc.Node,p_nodeSelfContent:cc.Node,p_pfbRankItem:cc.Prefab,_nodeSelf:null},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!1),this.fitTopMenu(),this.handleUI()},handleUI:function(){this._super()},setParam:function(){var e=this;app.player.sfRankByType("dungeon",function(t,a){cc.isValid(e.node)&&(t?app.showNotice(t):(e.m_data=a,e.m_chapter=app.player.dgtop.chapter||0,e.m_node=app.player.dgtop.node||-1,e.m_arrData=e.m_data.list,e.refreshUI()))})},refreshUI:function(){this.p_nodeView.getComponent("tableView").initTableView(this.m_arrData.length,{array:this.m_arrData,target:this});var e={rname:app.player.rname,rid:app.player.rid,power:app.player.power,score:this.m_data.selfscore||0,iconid:app.player.iconid,headid:app.player.headid,frameid:app.player.frameid};!cc.isValid(this._nodeSelf)&&cc.isValid(this.p_pfbRankItem)&&(this._nodeSelf=cc.instantiate(this.p_pfbRankItem),this.p_nodeSelfContent.addChild(this._nodeSelf),this._nodeSelf.setPosition(cc.Vec2.ZERO)),this._nodeSelf.getComponent("dungeonRanktabvItem").refreshUI(this.m_data.selfrank,e)},onClose:function(){this._super()}});cc._RF.pop()},{basePage:void 0}],dungeonSaveGeneralsPage:[function(e,t){"use strict";cc._RF.push(t,"8dc57ebLuBNYqfSDLGkLiGC","dungeonSaveGeneralsPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"dungeonsavegeneralspage",pageType:1},properties:{p_nodeMenuContainer:cc.Node,p_pfbMenuSelector:cc.Prefab,p_tabGeneralBag:cc.Node,p_btnSortStar:cc.Button,p_btnSortLv:cc.Button,p_btnSaveGeneral:cc.Button,p_btnCancel:cc.Button,p_pfbItem:cc.Prefab,p_nodeContent:cc.Node},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this._initMenu()},handleUI:function(){var e=this;this._super(),this.p_btnSaveGeneral.node.on("click",function(){e.onClickSaveGeneral()}),this.p_btnCancel.node.on("click",function(){e.onClose()})},initData:function(){if(this.m_guids=[],this.m_powers=[],this.m_tabListIndex=0,this.m_isCurr=!1,this.m_arrItems&&this.m_arrItems.length>0)for(var e=0;e<this.m_arrItems.length;e++)this.m_arrItems[e].active=!1;this.upLabCountPower()},_initMenu:function(){this._nodeMenuController=cc.instantiate(this.p_pfbMenuSelector),this.p_nodeMenuContainer.addChild(this._nodeMenuController),this._nodeMenuController.setPosition(cc.Vec2.ZERO),this._nodeMenuController.getComponent("GeneralMenuSelector").onCampClick(this.onClickCamp,this),this._nodeMenuController.getComponent("GeneralMenuSelector").onProfessionClick(this.onClickProfess,this)},setParam:function(e){e&&(this.m_confirmcb=e.confirmcb,this.m_target=e.target),this.initData(),this.refreshUI()},refreshUI:function(){this.onClickCamp(0)},upLabCountPower:function(){},onClickCamp:function(e){cc.log("now click camp: ",e),this.m_numShowCampIndex==e&&(e=0),this.m_numShowCampIndex=e,this.m_arrGeneralBagShowData=this.setGeneralBagViewData(),this.refreshGeneralBagView()},onClickProfess:function(e){cc.log("now click camp: ",e),this.m_numShowProfeIndex==e&&(e=0),this.m_numShowProfeIndex=e,this.m_arrGeneralBagShowData=this.setGeneralBagViewData(),this.refreshGeneralBagView()},itemClick:function(e){for(var t=-1,a=0;a<this.m_guids.length;a++)this.m_guids[a]==e&&(t=a);return-1==t?this.m_guids.length<5?(this.m_guids[this.m_tabListIndex]=e,this.m_powers[this.m_tabListIndex]=app.player.general[e].power,this.m_tabListIndex++,this.upLabCountPower(),this.refreshSView(),!0):(app.showNotice(langMgr.getString("dungeonSaveGeneralsPage",0)),!1):-1!=t?(this.m_guids.splice(t,1),this.m_powers.splice(t,1),this.m_tabListIndex--,this.m_tabListIndex<0&&(this.m_tabListIndex=0),this.upLabCountPower(),this.refreshSView(),!1):void 0},refreshGeneralBagView:function(){var e=this.m_arrGeneralBagShowData.length;this.p_tabGeneralBag.getComponent("tableView").initTableView(e,{array:this.m_arrGeneralBagShowData,arrpick:this.m_guids,maxpick:5,initfun:"initForBag",scale:.75,target:this})},refreshSView:function(){this.m_arrItems||(this.m_arrItems=[]);for(var e=0;e<this.m_guids.length;e++){var t=this.m_arrItems[e];t||((t=cc.instantiate(this.p_pfbItem)).parent=this.p_nodeContent,this.m_arrItems.push(t)),t.active=!0,t.getComponent("generalPortraitItem").initForBag(this.m_guids[e])}for(var a=this.m_guids.length;a<this.m_arrItems.length;a++)this.m_arrItems[a].active=!1},setGeneralBagViewData:function(){var e=this,t=[];for(var a in app.player.general)if(0==this.m_numShowCampIndex)t.push(a);else{var i=app.player.general[a].camp;this.m_numShowCampIndex==i&&t.push(a)}return this.m_numShowProfeIndex&&(t=t.filter(function(t){var a=app.player.general[t];return!!a&&(a.occu===e.m_numShowProfeIndex||a.occu2===e.m_numShowProfeIndex)})),t.sort(function(e,t){var a=app.player.general[e],i=app.player.general[t];if(a.star<i.star)return 1;if(a.star==i.star){if(a.level<i.level)return 1;if(a.level==i.level&&a.gsid>i.gsid)return 1}return-1}),t.filter(function(e){return!app.player.isTimeLimitGeneral(e)})},onClickSaveGeneral:function(){var e=this;if(5==this.m_guids.length){var t={content:langMgr.getString("dungeonSaveGeneralsPage",4),confirmcb:function(){app.player.sfDgSaveGeneralList({guids:e.m_guids},function(t,a){t?app.showNotice(langMgr.getString("dungeonSaveGeneralsPage",2)):(app.showNotice(langMgr.getString("dungeonSaveGeneralsPage",3)),e.m_isCurr=!0,app.dgFarmData=a,e.onClose())})},target:this};app.pages.windowspagetipsmsg.showPage(t)}else app.showNotice(langMgr.getString("dungeonSaveGeneralsPage",1))},onClose:function(){this._super(),this.m_confirmcb&&this.m_confirmcb.call(this.m_target,this.m_isCurr)}});cc._RF.pop()},{basePage:void 0}],dungeonShopPage:[function(e,t){"use strict";cc._RF.push(t,"e16f7+cCjNMsJFc5Fbk1ztc","dungeonShopPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"dungeonshoppage",pageType:1},properties:{p_sprTitle:cc.Sprite,p_nodeItem:cc.Prefab,p_nodeParent:cc.Node,p_sprPrice:cc.Sprite,p_labPrice:cc.Label,p_labPrePrice:cc.Label,p_btnBuy:cc.Button,p_btnGiveUp:cc.Button},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){var e=this;this._super(),this.p_btnBuy.node.on("click",function(){e.onClickBuy(1)}),this.p_btnGiveUp.node.on("click",function(){e.onClickBuy(0)})},setParam:function(e){e&&(this.m_objData=e.detail,this.m_chapter=e.chapter,this.m_node=e.node,this.m_pos=e.pos,this.m_confirmcb=e.confirmcb,this.m_confirmparm=e.confirmparm,this.m_target=e.target,this.refreshUI())},refreshUI:function(){this.refreshSView(),this.refreshSprTitle(),app.loadTexture(app.db.getPropsIconPath(this.m_objData.consume[0].GSID),this.p_sprPrice,this.prefabPath),this.p_labPrice.string=gUtils.showNum(this.m_objData.consume[0].COUNT),this.p_labPrePrice.string=gUtils.showNum(this.m_objData.consume[0].COUNT/(this.m_objData.disc/10))},refreshSprTitle:function(){if(null!=this.m_objData.quality){var e="shop_tx_0"+this.m_objData.quality;app.loadTexture(gConfig.getDungeonShopImg(e),this.p_sprTitle,this.prefabPath)}},refreshSView:function(){this.m_arrItems||(this.m_arrItems=[]);for(var e=gConfig.getDgGoodsDisPath(this.m_objData.disc),t=0;t<this.m_objData.item.length;++t){var a=this.m_arrItems[t];a||((a=cc.instantiate(this.p_nodeItem)).parent=this.p_nodeParent,this.m_arrItems.push(a)),a.active=!0,a.getComponent("propItem").initForBag(this.m_objData.item[t]),a.getComponent("propItem").setClick(!0);var i=new cc.Node("disc"),n=i.addComponent(cc.Sprite);i.setPosition(cc.v2(50,51)),i.parent=a,i.active=!0,i.zIndex=999,app.loadTexture(e,n,this.prefabPath)}for(var r=this.m_objData.item.length;r<this.m_arrItems.length;++r)this.m_arrItems[r].active=!1},onClickBuy:function(e){var t=this;e&&!app.player.checkCount(this.m_objData.consume[0].GSID,this.m_objData.consume[0].COUNT)||app.player.sfDgBuyShop({chapter:this.m_chapter,node:this.m_node,pos:this.m_pos,buy:e},function(a){if(a)app.showNotice(a);else if(e){t._payRefreshEnd=!1;var i={showtype:1,reward:t.m_objData.item,target:t,confirmcb:function(){t.m_confirmcb&&t.m_confirmcb.call(t.m_target,t.m_confirmparm),t.onClose()}};app.pages.windowspagereward.showPage(i),app.player.addItem(t.m_objData.item),app.player.reduceItem(t.m_objData.consume)}else t.m_confirmcb&&t.m_confirmcb.call(t.m_target,t.m_confirmparm),t.onClose()})}});cc._RF.pop()},{basePage:void 0}],dungeonShoplistPage:[function(e,t){"use strict";cc._RF.push(t,"63178vC+ZlNiYNljFy7Jvim","dungeonShoplistPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"dungeonshoplistpage",pageType:1},properties:{p_tabvMail:cc.tableView,p_menu:e("menu"),p_labTips:cc.Label},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.p_menu.init(this)},handleUI:function(){this._super()},setParam:function(e){var t=this;this.m_clickIndex=0,this.m_chapter=e,app.player.sfShopList(function(e,a){e?app.showNotice(e):(t.m_arrDungeonData=a.list,t.refreshUI())})},refreshUI:function(){this.refreshView()},refreshView:function(){if(this.m_arrDungeonData){this.m_arrData=[[],[],[]];for(var e=0;e<this.m_arrDungeonData.length;e++){var t=this.m_arrDungeonData[e].quality-1||0;this.m_arrData[t].push(this.m_arrDungeonData[e])}this.p_menu.setMenuIndex(this.m_clickIndex)}},menuHandler:function(e){this.m_arrDungeonData&&(this.m_clickIndex=e,this.m_arrShowData=this.m_arrData[this.m_clickIndex],this.upDataArray())},upDataArray:function(){var e=this.m_arrShowData.length;this.p_tabvMail.getComponent("tableView").initTableView(e,{array:this.m_arrShowData,delete:this.deleteData,target:this}),this.p_labTips.node.active=e<=0},deleteData:function(e){if(null!=e&&this.m_arrShowData&&this.m_arrShowData[e]){this.m_arrShowData.splice(e,1);var t=this.m_arrShowData.length;this.p_tabvMail.getComponent("tableView").newReload(t,{array:this.m_arrShowData,delete:this.deleteData,target:this}),this.p_labTips.node.active=t<=0}},onClose:function(){this._super()}});cc._RF.pop()},{basePage:void 0,menu:void 0}],dungeonTurntablePage:[function(e,t){"use strict";cc._RF.push(t,"af095IlN+BBMJa/1kZ48QII","dungeonTurntablePage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"dungeonturntablepage",pageType:1},properties:{p_nodeSpin:cc.Node,p_arrNodeReward:[cc.Node],p_btnDrawOne:cc.Button,p_lookstar_eff:cc.Animation},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(),this.handleUI(),this.playAnimSpin()},handleUI:function(){var e=this;this._super(),this.p_btnDrawOne.node.on("click",function(){app.playSound("click"),e.onClickDarw(1)})},start:function(){},setParam:function(e){e&&(this.m_chapterId=e.chapter,this.m_detail=e.detail,this.m_confirmcb=e.confirmcb,this.m_confirmparm=e.confirmparm,this.m_target=e.target,this.getNewData())},getNewData:function(){this.m_objData=app.db.getDungeonArrBuff(this.m_chapterId),this.m_index=0;for(var e=0;e<this.m_objData.length;e++)this.m_detail.id==this.m_objData[e].BUFFID&&(this.m_index=e);this.refreshUI()},refreshUI:function(){this.refreshReward()},refreshReward:function(){var e=this;if(this.m_objData){var t=this.m_objData;this.p_arrNodeReward.forEach(function(a,i){app.loadTexture(gConfig.getDungeonBuffPath(t[i].BPATH),a.getComponent(cc.Sprite),e.prefabPath),a.on("touchend",function(){app.pages.windowspagetipsbuff.showPage(t[i])})})}},onClickDarw:function(){var e=this;if(!this.isSpin){this.isSpin=!0,app.mainScene.p_nodeWait.show({isShow:!1});var t=this.m_objData[this.m_index],a={reward:t,confirmcb:this.m_confirmcb,confirmparm:this.m_confirmparm,target:this.m_target};this.p_nodeSpin.stopAllActions();var i=this.p_nodeSpin.angle%360,n=60*(this.m_index+1)-i-30;app.loadEff("guanxing",this.p_lookstar_eff,2,2.1),cc.tween(this.p_nodeSpin).by(5,{angle:3600+n+10},{easing:"cubicInOut"}).by(1,{angle:-10},{easing:"cubicOut"}).call(function(){if(app.pages.dungeonpage.instance){var i=app.pages.dungeonpage.instance._spbuffList[t.NATUREID];null!=i?i+=t.ADDITION:i=t.ADDITION,app.pages.dungeonpage.instance._spbuffList[t.NATUREID]=i}app.pages.dungeonbuffrewardpage.showPage(a,null,function(){app.mainScene.p_nodeWait.hide(),e.onClose()}),e.p_lookstar_eff.node.active=!1}).start()}},playAnimSpin:function(){cc.tween(this.p_nodeSpin).by(1,{angle:-5}).repeatForever().start()},onClose:function(){this._super(),this.isSpin=!1}});cc._RF.pop()},{basePage:void 0}],editMapPage:[function(e,t){"use strict";cc._RF.push(t,"fa9182act9Lza3czSYk/RcQ","editMapPage");var a=e("Pathfinding"),i=cc.Class({name:"city",properties:{node:{default:null,type:cc.Node,tooltip:"\u5efa\u7b51"},no:{default:0,type:cc.Integer,tooltip:"\u7f16\u53f7"}}});cc.Class({extends:cc.Component,properties:{citys:{default:[],type:[i],tooltip:"\u5efa\u7b51"},save:{default:null,type:cc.Button,tooltip:"\u4fdd\u5b58\u57ce\u6c60\u4fe1\u606f"},delete:{default:null,type:cc.Button,tooltip:"\u5220\u9664\u4efb\u4e00\u8def\u5f84"},push:{default:null,type:cc.Button,tooltip:"\u4fdd\u5b58\u5e76\u8986\u76d6\u8def\u5f84"},p_nodeMap:cc.Node,graphics:cc.Graphics,InputNode:cc.Node,editBox:cc.EditBox,sureBtn:cc.Button},onLoad:function(){this.m_arrCacheDot=[],this.m_arrMapGeneral=[],this.m_selfRolePos=1,Camera.initCameraMaxLOS({width:this.p_nodeMap.width,height:this.p_nodeMap.height}),this.initEdit(),this.setCameraZoom(1),this.loadJson(),this.handleUI()},handleUI:function(){var e=this;this.node.on(cc.Node.EventType.TOUCH_START,function(t){e.isMove=!0,e.lastPoint=t.getLocation()}),this.node.on(cc.Node.EventType.TOUCH_MOVE,function(t){if(e.isMove){var a=t.getLocation(),i=a.sub(e.lastPoint);e.lastPoint=a,Camera._moveCamera(i)}}),this.node.on(cc.Node.EventType.TOUCH_END,function(){e.isMove=!1}),this.sureBtn.node.on("click",function(){e.InputNode.active=!1,""!=e.editBox.string&&(delete e.m_objPath[e.editBox.string],e.restDrawLine())}),this.delete.node.on("click",function(){e.InputNode.active=!0}),this.citypos={},this.citys.forEach(function(t){e.citypos[t.no]={x:t.node.x,y:t.node.y},t.node.cityId=t.no,t.node.getChildByName("num").getComponent(cc.Label).string=t.no,t.node.on(cc.Node.EventType.TOUCH_START,function(a){e.onTouchStart(a,t)}),t.node.on(cc.Node.EventType.TOUCH_MOVE,function(a){e.onTouchMove(a,t)}),t.node.on(cc.Node.EventType.TOUCH_CANCEL,function(a){e.onTouchEnd(a,t)})}),this.push.node.on("click",function(){jsb.fileUtils.writeStringToFile(JSON.stringify(e.m_objPath),"C:\\Users\\86166\\Documents\\MCG_threekings_client\\TKclient\\assets\\resources\\db_json\\mappath.json")}),this.save.node.on("click",function(){jsb.fileUtils.writeStringToFile(JSON.stringify(e.citypos),"C:\\Users\\86166\\Documents\\MCG_threekings_client\\TKclient\\assets\\resources\\db_json\\citypos.json")})},initEdit:function(){this.InputNode.active=!1,this.m_objPath={},this.m_arrPath=[]},initPathfinding:function(){this.Pathfinding=new a(this.citys,this.m_objPath)},setCameraZoom:function(e){this.cameraZoom="number"==typeof e?e:e.progress+.5,Camera._setZoomScale(this.cameraZoom)},onTouchStart:function(e,t){this.m_arrPath.push(t.node.getPosition(cc.v2())),this.m_onId=t.no,e.stopPropagation()},onTouchMove:function(e){var t=e.getLocation(),a=this.m_arrPath[this.m_arrPath.length-1],i=Camera._getLoacalPos(t,this.p_nodeMap);this.checkDrawLength(a,i)&&this.m_arrPath.push(i),this.drawLine(),e.stopPropagation()},onTouchEnd:function(e){var t=e.getLocation(),a=Camera._getLoacalPos(t,this.p_nodeMap);this.checkRectIsIntersect(a),this.drawLine(),this.savePath(),e.stopPropagation()},savePath:function(){if(null==this.m_onId||null==this.m_endId)this.restDrawLine();else{var e=this.countWeight(this.m_arrPath);this.m_objPath[this.m_onId+"/"+this.m_endId]={on:this.m_onId,end:this.m_endId,weight:e,path:this.m_arrPath}}this.m_onId=this.m_endId=null,this.m_arrPath=[]},checkDrawLength:function(e,t){return e.sub(t).mag()>=5},checkRectIsIntersect:function(e){var t=this;this.citys.forEach(function(a){if(a.node.getBoundingBox().contains(e))return a.node.color=new cc.Color(140,140,140,255),t.m_endId=a.no,void t.m_arrPath.push(a.node.getPosition(cc.v2()))})},countWeight:function(e){for(var t=0,a=1;a<e.length;++a){var i=e[a-1],n=e[a];t+=i.sub(n).mag()}return t},drawLine:function(){var e=this.m_arrPath,t=e.length,a=e[t-2];if(a){var i=e[t-1];this.graphics.moveTo(a.x,a.y),this.graphics.lineTo(i.x,i.y),this.graphics.stroke()}},loadJson:function(){var e=this;cc.resources.load("db_json/mappath",cc.Asset,function(t,a){e.m_objPath=a.json,e.restDrawLine(),e.initPathfinding()})},restDrawLine:function(){for(var e in this.graphics.clear(),this.m_objPath)for(var t=this.m_objPath[e].path,a=1;a<t.length;++a){var i=t[a],n=t[a-1];this.graphics.moveTo(n.x,n.y),this.graphics.lineTo(i.x,i.y),this.graphics.stroke()}},restCachePathDot:function(){for(var e=0;e<this.m_arrCacheDot.length;++e){var t=this.m_arrCacheDot[e].node;this.onDotKilled(t)}this.m_arrCacheDot=[],this.p_walkPath.end.active=!1}}),cc._RF.pop()},{Pathfinding:void 0}],equicSuitBuildPage:[function(e,t){"use strict";cc._RF.push(t,"6c1b9PM5ENO1o7ffcYMAbay","equicSuitBuildPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"equicsuitbuildpage"},properties:{p_nodeLeftEquic:cc.Node,p_nodeRightEquic:cc.Node,p_pfbPropItem:cc.Prefab,p_labLeftName:cc.Label,p_labRightName:cc.Label,p_arrLabPropL:[cc.Label],p_arrLabPropR:[cc.Label],p_arrRightSkill:[cc.Node],p_arrLeftSkill:[cc.Node],p_nodeCost:cc.Node,p_arrNodeCost:[cc.Node],p_buildCost:cc.Node,p_btnBuild:cc.Button},onLoad:function(){a.instance=this,this.handleUI(),this.stopBgNodeEvent(),this.creatMask(),this.fitTopMenu(),this.m_nodeLeftEquic=null,this.m_nodeRightEquic=null},handleUI:function(){var e=this;this._super(),this.p_btnBuild.node.on("click",function(){app.playSound("click"),e.onClickBuild()}),this.p_arrLeftSkill.forEach(function(t,a){t.on("touchend",function(){e.m_leftSkill&&e.m_leftSkill[a]&&app.pages.windowspagetipsskill.showPage({gsid:e.m_leftSkill[a]})})}),this.p_arrRightSkill.forEach(function(t,a){t.on("touchend",function(){e.m_rightSkill&&e.m_rightSkill[a]&&app.pages.windowspagetipsskill.showPage({gsid:e.m_rightSkill[a]})})})},setParam:function(e){console.log(e),this.m_strGuid=e.guid,this.m_objData=e.data,this.m_nowGsid=e.nowGsid,this.m_targetGsid=e.targetGsid,this.m_isBuild=e.isBuild,this.m_target=e.target,this.refreshSkillUI(),this.refreshProp(),this.refreshCost()},refreshSkillUI:function(){var e=this;this.m_nodeLeftEquic||(this.m_nodeLeftEquic=cc.instantiate(this.p_pfbPropItem),this.m_nodeLeftEquic.parent=this.p_nodeLeftEquic,this.m_nodeLeftEquic.active=!0),this.m_nodeRightEquic||(this.m_nodeRightEquic=cc.instantiate(this.p_pfbPropItem),this.m_nodeRightEquic.parent=this.p_nodeRightEquic,this.m_nodeRightEquic.active=!0),this.m_nodeLeftEquic.getComponent("propItem").initForGEquip(this.m_nowGsid),this.m_nodeRightEquic.getComponent("propItem").initForGEquip(this.m_targetGsid);var t=app.db.getEBaseByGsid(this.m_nowGsid),a=app.db.getEBaseByGsid(this.m_targetGsid);if(this.p_labLeftName.string=t.NAME,this.p_labRightName.string=a.NAME,t.SLEVEL<18)this.p_arrLeftSkill.forEach(function(e){e.getChildByName("skill_icon").active=!1,e.getChildByName("skill_name").active=!1,e.getChildByName("icon_zb_wh").active=!0});else{var i=app.db.getEBaseByGsid(this.m_nowGsid);this.m_leftSkill=app.db.dbOccuequipset[i.SETID].SKILL,this.p_arrLeftSkill.forEach(function(t,a){t.getChildByName("skill_icon").active=!0,t.getChildByName("skill_name").active=!0,t.getChildByName("icon_zb_wh").active=!1;var i=app.db.getSkillPathByGsid(e.m_leftSkill[a]),n=t.getChildByName("skill_icon").getComponent(cc.Sprite),r=t.getChildByName("skill_name").getComponent(cc.Label);app.loadTexture(i,n,e.prefabPath);var o=app.db.dbSuitSkill[e.m_leftSkill[a]];r.string=o.NAME})}var n=app.db.getEBaseByGsid(this.m_targetGsid);this.m_rightSkill=app.db.dbOccuequipset[n.SETID].SKILL,this.p_arrRightSkill.forEach(function(t,a){var i=app.db.getSkillPathByGsid(e.m_rightSkill[a]),n=t.getChildByName("skill_icon").getComponent(cc.Sprite),r=t.getChildByName("skill_name").getComponent(cc.Label);app.loadTexture(i,n,e.prefabPath);var o=app.db.dbSuitSkill[e.m_rightSkill[a]];r.string=o.NAME})},refreshProp:function(){var e=app.db.getEBaseByGsid(this.m_nowGsid),t=app.db.getEBaseByGsid(this.m_targetGsid);this.p_arrLabPropL.forEach(function(t,a){if(e.PROP[a]){var i=e.PROP[a],n=app.db.getPropertyCnByEn(i.KEY),r=i.VAL,o=app.db.getPropertyIdByEn(i.KEY);o&&2==app.db.dbProperty[o].NUMTYPE&&(r=r/10+"%"),t.string=n+": "+r,t.node.active=!0}else t.node.active=!1}),this.p_arrLabPropR.forEach(function(e,a){if(t.PROP[a]){var i=t.PROP[a],n=app.db.getPropertyCnByEn(i.KEY),r=i.VAL,o=app.db.getPropertyIdByEn(i.KEY);o&&2==app.db.dbProperty[o].NUMTYPE&&(r=r/10+"%"),e.string=n+": "+r,e.node.active=!0}else e.node.active=!1})},refreshCost:function(){var e=app.db.getEBaseByGsid(this.m_targetGsid);if(this.m_isBuild){this.p_nodeCost.active=!1,this.p_buildCost.active=!0,this.m_buildCostData=e.OTHERS_CAST;for(var t=0;t<this.m_buildCostData.length;t++){var a=this.p_buildCost.children[t];if(a||(a=cc.instantiate(this.p_buildCost.children[0]),this.p_buildCost.addChild(a)),a.active=!0,!a.getChildByName("porp_item").children[0]){var i=cc.instantiate(this.p_pfbPropItem);i.parent=a.getChildByName("porp_item"),i.active=!0}var n=a.getChildByName("porp_item").children[0].getComponent("propItem");n.initForGsid(this.m_buildCostData[t].GSID),n.setClick(!0);var r=a.getChildByName("layout"),o=r.getChildByName("num").getComponent(cc.Label),s=r.getChildByName("cost_num").getComponent(cc.Label);o.string=gUtils.showCoinNum(app.player.getCount(this.m_buildCostData[t].GSID)),s.string="/"+gUtils.showCoinNum(this.m_buildCostData[t].COUNT)}}else{this.p_nodeCost.active=!0,this.p_buildCost.active=!1,this.m_costData=e.OTHERS_CAST,console.log(this.m_costData);for(var p=0;p<this.p_nodeCost.children.length;++p)this.m_costData[p]?(this.p_nodeCost.children[p].getComponent("costItem").refreshUI(this.m_costData[p].GSID,this.m_costData[p].COUNT,this),this.p_nodeCost.children[p].active=!0):this.p_nodeCost.children[p].active=!1}},onClickBuild:function(){var e=this;if(this.m_isBuild){if(!this.checkCost(this.m_buildCostData))return;for(var t=app.db.getEBaseByGsid(this.m_targetGsid).NAME,a=langMgr.getString("equicSuitBuildPage",3),i=0;i<this.m_buildCostData.length;i++){var n=app.db.getPropsName(this.m_buildCostData[i].GSID);a+=0==i?langMgr.getString("equicSuitBuildPage",4,[gUtils.showCoinNum(this.m_buildCostData[i].COUNT),n]):langMgr.getString("equicSuitBuildPage",5,[gUtils.showCoinNum(this.m_buildCostData[i].COUNT),n])}var r={content:a+=langMgr.getString("equicSuitBuildPage",6,t),confirmcb:function(){app.player.sfEquipBuild(e.m_strGuid,e.m_nowGsid,e.m_targetGsid,function(t,a){t||(a.beforequip=e.m_nowGsid,app.pages.windowspageequipbuildsucc.showPage(a),app.pages.windowspagelistequipsuit.instance&&app.pages.windowspagelistequipsuit.instance.onClose(),e.onClose())})},target:this};app.pages.windowspagetipsmsg.showPage(r)}else{if(!this.checkCost(this.m_costData))return;var o=app.db.getEBaseByGsid(this.m_targetGsid).NAME,s=app.db.getEBaseByGsid(this.m_nowGsid).NAME,p={content:langMgr.getString("equicSuitBuildPage",7,[s,o]),confirmcb:function(){app.player.sfEquipReBuild(e.m_strGuid,e.m_nowGsid,e.m_targetGsid,function(t,a){t||(a.beforequip=e.m_nowGsid,app.pages.windowspageequipbuildsucc.showPage(a),app.pages.windowspagelistequipsuit.instance&&app.pages.windowspagelistequipsuit.instance.onClose(),e.onClose())})},target:this};app.pages.windowspagetipsmsg.showPage(p)}},checkCost:function(e){for(var t=0;t<e.length;t++)if(app.player.getCount(e[t].GSID)<e[t].COUNT){var a=app.db.getPropsInfoByGsid(e[t].GSID).NAME;return app.showNotice(a+langMgr.getString("equicSuitBuildPage",1)),app.pages.windowspagesource.showPage(e[t].GSID),!1}return!0}});cc._RF.pop()},{basePage:void 0}],equipLevelPage:[function(e,t){"use strict";cc._RF.push(t,"adeeeTdWKlNZ5zXvAXa7Iy1","equipLevelPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"equiplevelpage"},properties:{p_nodeEquipNow:cc.Node,p_nodeEquipNowName:cc.Label,p_nodeEquipNext:cc.Node,p_nodeEquipNextName:cc.Label,p_nodeArrow:cc.Node,p_nodeProp:cc.Node,p_nodeSet:cc.Node,p_labNoSet:cc.Label,p_labLvLeft:cc.Label,p_labLvRight:cc.Label,p_barExp:cc.ProgressBar,p_labExp:cc.Label,p_tabvEquip:cc.Node,p_arrNodeCost:[cc.Node],p_btnPick:cc.Button,p_btnUp:cc.Button,textAnim:[sp.Skeleton],iconAnim:[sp.Skeleton],_animLock:!1},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!1,255,"#21140b"),this.handleUI(),this.fitTopMenu()},getAnimLock:function(){return this._animLock},setAnimLock:function(e){this._animLock=e},handleUI:function(){var e=this;this._super(),this.p_btnUp.node.on("click",function(){app.playSound("click"),e.onClickLvUp()}),this.p_btnPick.node.on("click",function(){e.getAnimLock()||(app.playSound("click"),e.onClickOneKey())}),this.textAnim.forEach(function(e){e.setCompleteListener(function(){return e.node.active=!1})}),this.iconAnim.forEach(function(e){e.setCompleteListener(function(){e.node.active=!1})})},start:function(){},setParam:function(e){cc.log("now star up equip is ",e.gsid),this.m_strGuid=e.guid,this.m_strTargetGsid=e.gsid,this.m_closeCb=e.closecb,this.m_objNewGData=null,this.refreshData(),this.refreshUI()},refreshData:function(){this.m_arrShowData=this.setData()},refreshUI:function(){this.refreshTarget(),this.refreshView(),this.initExp(),this.refreshInfo(),this.refreshCost()},refreshTarget:function(e){cc.log("now treas id is ",this.m_strTargetGsid),this.p_nodeEquipNow.getComponent("propItem").initForGsid(this.m_strTargetGsid),this.p_nodeEquipNowName.string=app.db.getPropsName(this.m_strTargetGsid),e?(this.p_nodeEquipNext.active=!0,this.p_nodeArrow.active=!0,this.p_nodeEquipNext.getComponent("propItem").initForGsid(e),this.p_nodeEquipNextName.string=app.db.getPropsName(e)):(this.p_nodeEquipNext.active=!1,this.p_nodeArrow.active=!1)},refreshView:function(){cc.log("refreshview");var e=this.m_arrShowData.length;this.p_tabvEquip.getComponent("tableView").initTableView(e,{array:this.m_arrShowData,target:this})},refreshInfo:function(e){var t,a,i,n,r=app.db.getEBaseByGsid(e?e-1:this.m_strTargetGsid),o=r.PROP;r.SETID&&(t=app.db.dbEquipSet[r.SETID].PROPERTY),e&&(i=(a=app.db.getEBaseByGsid(e)).PROP,a.SETID&&(n=app.db.dbEquipSet[a.SETID].PROPERTY)),this.p_nodeProp.getComponent("propertyArrItem").refreshUI(o,i),t||n?!t&&n?(t=n.map(function(e){var t={};for(var a in e)t[a]="VAL"==a?0:e[a];return t}),this.p_labNoSet.node.active=!1):this.p_labNoSet.node.active=!1:(this.p_labNoSet.node.active=!0,this.p_labNoSet.string=langMgr.getString("equipLevelPage",0)),this.p_nodeSet.getComponent("propertyArrItem").refreshUI(t,n)},initExp:function(){this.m_isMaxExp=!1,this.m_isMaxLv=!1,this.m_strNextGsid=null,this.m_objPickItem={},this.m_numPickExp=0;var e=app.db.getEBaseByGsid(this.m_strTargetGsid),t=e.NEXT;if(t){var a=e.SLEVEL,i=app.db.getEBaseByGsid(t.ID),n=i.SLEVEL;this.p_labLvLeft.string=langMgr.getString("equipLevelPage",3,a);var r=langMgr.getString("equipLevelPage",3,n);i.NEXT||(r+=langMgr.getString("equipLevelPage",4)),this.p_labLvRight.string=r,this.p_labExp.string="0/"+t.EXP,this.p_barExp.progress=0,this.m_numNextBeginExp=0,this.m_numNextExp=t.EXP}else{this.m_isMaxLv=!0;var o=e.SLEVEL,s=e.SLEVEL;this.p_labLvLeft.string=langMgr.getString("equipLevelPage",1,o),this.p_labLvRight.string=langMgr.getString("equipLevelPage",1,s),this.p_labExp.string=langMgr.getString("equipLevelPage",2),this.p_barExp.progress=1}},itemClickHandler:function(e,t){this.refreshPick(e,t),this.refreshExp()},refreshPick:function(e,t){if(cc.log(e),e){var a=app.db.getEBaseByGsid(e.gsid);this.m_objPickItem[e.gsid]?("plus"==t&&(this.m_objPickItem[e.gsid]+=Number(e.count)),"minus"==t&&(this.m_objPickItem[e.gsid]-=Number(e.count))):this.m_objPickItem[e.gsid]=Number(e.count),"plus"==t&&(this.m_numPickExp+=a.EXP*e.count),"minus"==t&&(this.m_numPickExp-=a.EXP*e.count)}},refreshExp:function(){this.m_arrCost=[];var e=this.getNextInfo(this.m_numPickExp,this.m_strTargetGsid);this.m_isMaxExp=!!e.isMax,this.m_numNextExp=e.nextexp,this.m_numNextBeginExp=e.exp;for(var t={},a=[],i=0;i<this.m_arrCost.length;++i)t[this.m_arrCost[i].GSID]||(t[this.m_arrCost[i].GSID]={COUNT:0}),t[this.m_arrCost[i].GSID].COUNT+=this.m_arrCost[i].COUNT;for(var n in t)a.push({GSID:n,COUNT:t[n].COUNT});this.refreshCost(a),e.nextprop&&e.nextprop!=this.m_strTargetGsid?(this.m_strNextGsid=e.nextprop,this.refreshInfo(e.nextprop),this.refreshTarget(e.nextprop)):(this.m_strNextGsid=null,this.refreshInfo(),this.refreshTarget());var r=app.db.getEBaseByGsid(e.now),o=app.db.getEBaseByGsid(e.next);o.NEXT?this.m_numNextNextExp=o.NEXT.EXP:this.m_numNextNextExp=null;var s=r.SLEVEL,p=o.SLEVEL;this.p_labLvLeft.string=langMgr.getString("equipLevelPage",1,s);var c=langMgr.getString("equipLevelPage",3,p);o.NEXT||(c+=langMgr.getString("equipLevelPage",4)),this.p_labLvRight.string=c,this.p_labExp.string=e.exp+"/"+e.nextexp,this.playProgressAnim(e.exp/e.nextexp)},refreshCost:function(e){e||(e=[]);for(var t=0;t<this.p_arrNodeCost.length;++t)e[t]?(this.p_arrNodeCost[t].getComponent("costItem").refreshUI(e[t].GSID,e[t].COUNT,this),this.p_arrNodeCost[t].active=!0):this.p_arrNodeCost[t].active=!1},getNextInfo:function(e,t,a){var i=app.db.getEBaseByGsid(t).NEXT,n={exp:e,now:t,next:i.ID,nextexp:i.EXP,isMax:!1};if(a&&this.m_arrCost.push.apply(this.m_arrCost,a),e>i.EXP){var r=e-i.EXP;return app.db.getEBaseByGsid(i.ID).NEXT?this.getNextInfo(r,i.ID,i.CONSUME):(n.isMax=!0,n.nextprop=i.ID,this.m_arrCost.push.apply(this.m_arrCost,i.CONSUME),n)}if(e==i.EXP){var o=app.db.getEBaseByGsid(i.ID);return n.nextprop=i.ID,this.m_arrCost.push.apply(this.m_arrCost,i.CONSUME),o.NEXT?n:(n.isMax=!0,n)}return n.nextprop=t,n},onClickLvUp:function(){var t=this;if(cc.log("click equip lv up"),this.m_isMaxLv)app.showNotice(langMgr.getString("equipLevelPage",5));else if(this.m_strNextGsid)if(app.player.getCount(this.m_arrCost[0].GSID)<this.m_arrCost[0].COUNT)app.showNotice(langMgr.getString("equipLevelPage",7));else{var a=this.setArrChooseItem();cc.log(a),app.player.sfEquipLvUp(this.m_strGuid,this.m_strTargetGsid,a,function(a,i){if(a){var n=/(no enough:)(\d*)/g;return n.test(a)&&(a=a.replace(n,function(t,a,i){a=langMgr.getString("equipLevelPage",8);var n=e("dbPropHide");return(i=n[i]?n[i].NAME:langMgr.getString("equipLevelPage",9))+a})),void app.showNotice(a)}var r=t.m_strNextGsid;t.m_objNewGData=i.general;var o={showtype:1,reward:[{gsid:r,count:1}],confirmcb:function(){t.m_strTargetGsid=r,t.refreshData(),t.refreshUI(),t.textAnim.forEach(function(e){cc.isValid(e)&&e.node.parent.active&&(e.node.active=!0,e.setAnimation(0,"shengji_shuzhi",!1))}),t.iconAnim.forEach(function(e){cc.isValid(e)&&(e.node.active=!0,e.setAnimation(0,"shengji_guang",!1))})}};app.pages.windowspagereward.showPage(o)})}else app.showNotice(langMgr.getString("equipLevelPage",6))},onClickOneKey:function(){if(this.m_isMaxLv)app.showNotice(langMgr.getString("equipLevelPage",10));else{var e=this.m_numNextExp-this.m_numNextBeginExp,t=0;if(e>=0){0==e&&this.m_numNextNextExp&&(e=this.m_numNextNextExp);for(var a=0;a<this.m_arrShowData.length;++a){var i=this.m_arrShowData[a];if(i.picked!=i.count){for(var n=app.db.getEBaseByGsid(i.gsid).EXP,r=i.picked,o=i.count,s=0,p=r;p<o&&(++s,!((t+=n)>=e));++p);if(i.picked+=s,this.refreshPick({gsid:i.gsid,count:s},"plus"),this.m_lastItemIndex=a,t>=e)break}}t>0&&app.showNotice(langMgr.getString("equipLevelPage",11,t)),this.refreshExp(),this.refreshView(),this.scrollToPick()}else app.showNotice(langMgr.getString("equipLevelPage",12))}},setData:function(){var e=[],t=[];cc.log(app.player.equip);var a=app.db.getEBaseByGsid(this.m_strTargetGsid).POS;for(var i in app.player.equip){var n=app.player.equip[i].count;if(i!=this.m_strTargetGsid||this.m_strGuid||(n-=1),n&&!(n<0)){var r=app.db.getEBaseByGsid(i);if(0==r.POS){var o={gsid:i,count:n,picked:0};t.push(o)}if(a==r.POS){var s={gsid:i,count:n,picked:0};e.push(s)}}}e.sort(function(e,t){var a=app.db.getEBaseByGsid(e.gsid),i=app.db.getEBaseByGsid(t.gsid);if(a.QUALITY>i.QUALITY)return 1;if(a.QUALITY==i.QUALITY){if(a.STAR>i.STAR)return 1;if(a.STAR==i.STAR&&e.gsid>t.gsid)return 1}return-1});for(var p=t.length-1;p>=0;--p){var c=t[p];e.unshift(c)}return cc.log(e),e},setArrChooseItem:function(){var e=[];for(var t in this.m_objPickItem)e.push({gsid:t,count:this.m_objPickItem[t]});return e},scrollToPick:function(){var e=this.m_lastItemIndex;if(!(e<0)){var t=this.p_tabvEquip.getComponent("tableView").getScrollOffset().y,a=this.p_tabvEquip.getComponent("tableView").cell.data.height,i=this.p_tabvEquip.getComponent("tableView")._groupCellCount,n=Math.floor(e/i),r=0!=n?this.p_tabvEquip.getComponent("tableView").top:0,o=(a+this.p_tabvEquip.getComponent("tableView").spacingY)*n+r;o>t&&this.p_tabvEquip.getComponent("tableView").scrollToOffset(cc.v2(0,o),1)}},onClose:function(){this._super(),this.m_closeCb&&this.m_closeCb(this.m_objNewGData)},playProgressAnim:function(e){var t=this;this.barAnim=cc.tween(this.p_barExp).call(function(){return t.setAnimLock(!0)}).to(.3,{progress:e}).call(function(){return t.setAnimLock(!1)}).start()},stopProgressAnim:function(){this.barAnim&&this.barAnim.stop(),this.barAnim=null,this.setAnimLock(!1)},onDestroy:function(){this._super(),this.stopProgressAnim()}});cc._RF.pop()},{basePage:void 0,dbPropHide:void 0}],eventPageAct:[function(e,t){"use strict";cc._RF.push(t,"e79b9mUYhdIVrRO67CyQksO","eventPageAct");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"eventpageact",createShot:!0},properties:{p_nodeReward:cc.Node,p_btnSure:cc.Button,p_labIntro:cc.Label,p_labName:cc.Label},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){var e=this;this.p_btnSure.node.on("click",function(){app.playSound("click"),e.onSure()})},setParam:function(e){cc.log("open \u4e0a\u4ea4\u754c\u9762---\x3e>>>",e),this.m_to=e.to;var t=e.obj.info;this.m_items=t.cost,this.p_labIntro.string=t.des,this.refreshUI()},refreshUI:function(){var e=this.m_items;this.p_nodeReward.getComponent("propItem").initForBag(e),this.p_nodeReward.getComponent("propItem").setClick(!0);var t=app.db.getPropsName(e.gsid);this.p_labName.string=t},onSure:function(){var e=this,t=this.m_items;app.player.getCount(t.gsid)<t.count?app.showNotice(langMgr.getString("eventPageAct",0)):app.player.sfSpringFinish(function(a){var i=a;i.push({gsid:90330,count:1}),app.player.reduceItem(t),app.player.addItem(i);var n=function(){i.length>=2?app.pages.windowspagereward.showPage({showtype:1,reward:i,confirmcb:function(){e.onClose(),app.mapEvent.refreshSpringEvent()},target:e}):(e.onClose(),app.mapEvent.refreshSpringEvent())};e.m_to?app.pages.windowspagenoticebingo.showPage({str:e.m_to,cb:n}):n()})}});cc._RF.pop()},{basePage:void 0}],eventPageBingo:[function(e,t){"use strict";cc._RF.push(t,"d7769set2JMjob3Y3Oi/KEl","eventPageBingo");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"eventpagebingo",pageType:1,createShot:!0},properties:{p_btnBingo:[cc.Button],p_btnSure:[cc.Button],p_nodeBingo:cc.Node,p_nodeSure:cc.Node,p_nodeReward:cc.Node,p_pfbPropItem:cc.Prefab,p_nodeBrand:cc.Node,p_labTips:cc.Label,p_sprBrand:cc.Sprite,p_sfBrand:[cc.SpriteFrame],p_labNotice:cc.Label,p_labTime:cc.Label,p_spBingo:sp.Skeleton},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.m_porpItem=null},onEnable:function(){this._super(),eventMgr.on(eventStr.commonEvent.RefreshTime,this.refreshTimeUI,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.commonEvent.RefreshTime,this.refreshTimeUI,this)},handleUI:function(){var e=this;this._super(),this.p_btnBingo.forEach(function(t,a){t.node.on("click",function(){e.m_bingoIndex=a,e.bingo()})}),this.p_btnSure.forEach(function(t,a){t.node.on("click",function(){a?(e.m_bingoType=!1,e.setBtnState(),e.refreshUI()):e.endBingo()})}),this.p_spBingo.setCompleteListener(function(){cc.isValid(e)&&e.scheduleOnce(function(){cc.isValid(e)&&(e.p_spBingo.node.active=!1,e.p_nodeBrand.active=!0,e.m_bingoCb&&e.m_bingoCb())},1)})},setParam:function(e){cc.log(e),this.m_outTime=e.etime,app.m_numWin?this.m_numWin=app.m_numWin[e.id]?app.m_numWin[e.id]:e.winnum:(app.m_numWin={},this.m_numWin=e.winnum),app.m_numWin[e.id]=this.m_numWin,this.m_hash=e.hash,this.m_objInfo=e.info,this.m_numId=e.id,this.m_desCb=e.des,this.m_bingoType=!1,this.setBtnState(),this.refreshUI(),this.refreshTimeUI()},refreshUI:function(){var e=this;this.m_porpItem||(this.m_porpItem=cc.instantiate(this.p_pfbPropItem),this.m_porpItem.parent=this.p_nodeReward,this.m_porpItem.active=!0),this.m_bingoCb=null,this.p_nodeBrand.x=0;var t=this.m_objInfo.pay,a=this.m_objInfo.rate[this.m_numWin];this.m_lastRate=a;var i=1;if(this.m_numWin>=1)for(var n=0;n<this.m_numWin;++n)i*=this.m_objInfo.rate[n];this.nowRate=i,this.p_labNotice.string=langMgr.getString("eventPageBingo",0,a),this.p_labTips.string=langMgr.getString("eventPageBingo",1,this.m_numWin+1),this.m_porpItem.getComponent("propItem").initForBag({gsid:t.gsid,count:t.count*a*i}),this.m_porpItem.getComponent("propItem").setClick(!0);var r=app.db.getPropsIconPath(t.gsid);this.p_btnBingo.forEach(function(a){var n=a.node.getChildByName("icon").getComponent(cc.Sprite),o=a.node.getChildByName("num").getComponent(cc.Label);app.loadTexture(r,n,e.prefabPath),o.string=gUtils.showNum(t.count*i)})},setBtnState:function(e){e?(this.p_nodeBingo.active=!1,this.p_nodeSure.active=!1):this.m_bingoType?(this.p_nodeBingo.active=!1,this.p_nodeSure.active=!0):(this.p_nodeBingo.active=!0,this.p_nodeSure.active=!1)},playResAnim:function(e,t){var a=this;app._mask.active=!0,e||(this.m_bingoIndex=this.m_bingoIndex?0:1),this.m_numWin++,app.m_numWin[this.m_numId]++;var i=this.m_bingoIndex;this.p_sprBrand.node.active=!0,this.p_sprBrand.spriteFrame=this.p_sfBrand[i],this.m_bingoCb=function(){e?(app._mask.active=!1,app.pages.windowspagenoticebingo.showPage({str:langMgr.getString("eventPageBingo",2,a.m_lastRate),cb:function(){a.m_numWin<3?(a.m_bingoType=!0,a.p_labNotice.string=langMgr.getString("eventPageBingo",3),a.setBtnState()):(a.setBtnState(!0),a.p_labNotice.string=langMgr.getString("eventPageBingo",4)),app.pages.windowspagereward.showPage({showtype:1,reward:t})}})):(app._mask.active=!1,app.pages.windowspagenoticebingo.showPage({str:langMgr.getString("eventPageBingo",5),cb:function(){a.onClose(),a._onDestroy()}}),a.p_labNotice.string=langMgr.getString("eventPageBingo",6))},this.p_spBingo.node.active=!0,this.p_nodeBrand.active=!1,this.p_spBingo.setAnimation(0,"animation",!1)},refreshTimeUI:function(){if(this.m_outTime){var e=app.player.getServerTime(),t=this.m_outTime-e,a=gUtils.getHourMinSecTime(t/1e3);this.p_labTime.string=langMgr.getString("eventPageBingo",7,a),t<=0&&this.onClose()}},endBingo:function(){var e=this,t={content:langMgr.getString("eventPageBingo",8),confirmcb:function(){app.player.sfMapEventFinish({id:e.m_numId,hash:e.m_hash,data:{giveup:1}},function(){e._onDestroy(),e.onClose()})},target:this};app.pages.windowspagetipsmsg.showPage(t)},bingo:function(){var e=this,t=this.m_objInfo.pay.gsid,a=this.m_objInfo.pay.count*this.nowRate,i=app.db.getPropsName(t);if(app.player.getCount(t)<a)app.showNotice(langMgr.getString("eventPageBingo",11,i));else{var n=function(){app.player.sfMapEventFinish({id:e.m_numId,hash:e.m_hash,data:{giveup:0}},function(i){cc.log("\u5b9d\u85cf\u5956\u52b1",i);var n=i.reward;app.player.reduceItem({gsid:t,count:a}),1==i.ret?(app.player.addItem(n),e.playResAnim(!0,n)):e.playResAnim(!1)})};if(38005==t){var r={content:langMgr.getString("eventPageBingo",10,[a,i]),confirmcb:n,target:this};app.pages.windowspagetipsmsg.showPage(r)}else n()}},_onDestroy:function(){app.m_nowWin=0,this.m_desCb&&this.m_desCb(),this.m_desCb=null},onClose:function(){this.m_numWin>=3&&this._onDestroy(),this._super()}});cc._RF.pop()},{basePage:void 0}],eventPageDialogue:[function(e,t){"use strict";cc._RF.push(t,"f982asBd2NDzZEYxxEM7Z9k","eventPageDialogue");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,a=1,i=arguments.length;a<i;a++)for(var n in t=arguments[a])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},r=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},o=cc._decorator,s=o.ccclass,p=o.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_intro=null,t.p_heroName=null,t.p_star=null,t.p_power=null,t.p_sprGeneral=null,t.p_spGeneral=null,t.p_animGeneral=null,t.p_challengeBtn=null,t.p_continueBtn=null,t.p_leaveBtn=null,t.p_giveupBtn=null,t.p_probabilityNode=null,t.p_tip=null,t.p_fromIcon=null,t.p_fromIconText=null,t.p_btnGeneralDraw=null,t._pursuitCount=0,t._eventInfo=null,t}var a;return i(t,e),a=t,Object.defineProperty(t.prototype,"m_objInfo",{get:function(){return this._eventInfo.info},enumerable:!1,configurable:!0}),t.prototype.start=function(){eventMgr.on(eventStr.commonEvent.FinishMapEventBattle,this.finishMapEventBattle,this)},t.prototype.onLoad=function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(),this.handleUI()},t.prototype.handleUI=function(){var t=this;e.prototype.handleUI.call(this),this.p_challengeBtn.node.on("click",function(){return t.challengeClickHandle()}),this.p_continueBtn.node.on("click",function(){return t.continueClickHandle()}),this.p_giveupBtn.node.on("click",function(){return t.giveupClickHandle()}),this.p_btnGeneralDraw.node.on("click",function(){return t.generalDrawClickHandle()})},t.prototype.setParam=function(e){this._eventInfo=e,e.catchchance&&(this._pursuitCount=e.info.pursuit-e.catchchance),this.refreshUI()},t.prototype.refreshUI=function(){this.p_intro.string=this.m_objInfo.talk[0];var e=this.m_objInfo.icon;if(e){var t=app.db.getGBaseByGsid(e);this.p_heroName.string=t.NAME;var a=0,i=app.player.level;i>70&&i<=90?a=1:i>90&&(a=2);var n=app.db.getPveProperInfo(this._eventInfo.battleset).power;this.p_power.string=gUtils.showCoinNum(n*this.m_objInfo.mobs[a].power);var r=gConfig.getIconCommonStarPath(t.STAR-1);app.loadTexture(r,this.p_star,this.prefabPath),app.loadGeneral(e,this.p_sprGeneral,this.p_spGeneral,this.p_animGeneral,null,this.prefabPath),this._eventInfo.catchchance&&this._eventInfo.catchchance>0&&(this.p_probabilityNode.active=!0,this.p_challengeBtn.node.active=!1,this.p_continueBtn.node.active=!0,this.p_leaveBtn.node.active=!1,this.p_giveupBtn.node.active=!0,this.p_tip.node.active=!1,this.p_intro.string=this.m_objInfo.talk[1],this.p_fromIconText.string=this.m_objInfo.from[0].count,app.loadTexture(gConfig.getCurrencyIconPath(this.m_objInfo.from[0].gsid),this.p_fromIcon),this.refreshPercent())}},t.prototype.continueClickHandle=function(){var e=this;if(app.playSound("click"),app.player.yb<this.m_objInfo.from[0].count)app.showNotice(langMgr.getString("rechargeBountyPage",1));else{var t={id:this._eventInfo.id,hash:this._eventInfo.hash};app.player.sfMapEventPursuit(t,function(t){if(cc.log("\u8ffd\u51fb\u7ed3\u679c:",t),app.player.reduceItem(e.m_objInfo.from),t.generals&&t.generals.length){var a=t.reward;e.captiveGeneral(t.generals[0],function(){0!==a.length&&(app.player.addItem(a),app.pages.windowspagereward.showPage({showtype:1,reward:a,confirmcb:function(){e.deleteEvent(),e.onClose()}}))})}else{if(app.showNotice("\u62db\u964d\u6b66\u5c06\u5931\u8d25!"),e._pursuitCount++,e._eventInfo.catchchance?e._eventInfo.catchchance--:e._eventInfo.catchchance=e.m_objInfo.pursuit-1,app.pages.newworldmappage.instance.updateEventDataByKey(e._eventInfo.id,n({},e._eventInfo)),e._eventInfo.catchchance<1)return e.onClose(),void e.deleteEvent();e.refreshPercent()}})}},t.prototype.giveupClickHandle=function(){var e=this;app.playSound("click");var t={id:this._eventInfo.id,hash:this._eventInfo.hash};app.player.sfMapEventPursuitGiveup(t,function(t){cc.log("\u653e\u5f03\u8ffd\u51fb\u7ed3\u679c:",JSON.stringify(t));var a=t.reward;a.length?(app.player.addItem(a),app.pages.windowspagereward.showPage({showtype:1,reward:a,confirmcb:function(){e.onClose(),e.deleteEvent()},target:e})):(e.onClose(),e.deleteEvent())})},t.prototype.generalDrawClickHandle=function(){var e={garr:[this.m_objInfo.icon],gsid:this.m_objInfo.icon,index:0,isShowMode:!0};app.pages.generalpage.showPage(e)},t.prototype.challengeClickHandle=function(){app.playSound("click"),this._eventInfo.id,this._eventInfo.hash,app.player.battlearr.normal,app.battleInfo={id:this._eventInfo.id,hash:this._eventInfo.hash},app.battleType="mapevent",app.battleConfig=this._eventInfo.battleset,app.goToNormBattle()},t.prototype.finishMapEventBattle=function(e){var t=this;if(e.result===a.BATTLE_RESULT_LOSE)return this.onClose(),void this.deleteEvent();e.generals&&e.generals.length?this.captiveGeneral(e.generals[0],function(){t.deleteEvent(),t.onClose()}):(this.p_probabilityNode.active=!0,this.p_challengeBtn.node.active=!1,this.p_continueBtn.node.active=!0,this.p_leaveBtn.node.active=!1,this.p_giveupBtn.node.active=!0,this.p_tip.node.active=!1,this.p_intro.string=this.m_objInfo.talk[1],this.p_fromIconText.string=this.m_objInfo.from[0].count,app.loadTexture(gConfig.getCurrencyIconPath(this.m_objInfo.from[0].gsid),this.p_fromIcon),this.refreshPercent())},t.prototype.refreshPercent=function(){var e=this.m_objInfo.capture_rate_zj,t=this.m_objInfo.capture_rate+this._pursuitCount*e;this.p_probabilityNode.getChildByName("txt").getComponent(cc.Label).string=(t>100?100:t)+"% (\u989d\u5916+"+e+"%)"},t.prototype.captiveGeneral=function(e,t){app.pages.gongchengshenglipage.showPage({gsid:e,cb:function(){t&&t()}})},t.prototype.deleteEvent=function(){this._eventInfo.des&&this._eventInfo.des()},t.prefabPath="eventpagedialogue",t.createShot=!1,t.BATTLE_RESULT_LOSE="lose",r([p(cc.Label)],t.prototype,"p_intro",void 0),r([p(cc.Label)],t.prototype,"p_heroName",void 0),r([p(cc.Sprite)],t.prototype,"p_star",void 0),r([p(cc.Label)],t.prototype,"p_power",void 0),r([p(cc.Sprite)],t.prototype,"p_sprGeneral",void 0),r([p(sp.Skeleton)],t.prototype,"p_spGeneral",void 0),r([p(cc.Animation)],t.prototype,"p_animGeneral",void 0),r([p(cc.Button)],t.prototype,"p_challengeBtn",void 0),r([p(cc.Button)],t.prototype,"p_continueBtn",void 0),r([p(cc.Button)],t.prototype,"p_leaveBtn",void 0),r([p(cc.Button)],t.prototype,"p_giveupBtn",void 0),r([p(cc.Node)],t.prototype,"p_probabilityNode",void 0),r([p(cc.Label)],t.prototype,"p_tip",void 0),r([p(cc.Sprite)],t.prototype,"p_fromIcon",void 0),r([p(cc.Label)],t.prototype,"p_fromIconText",void 0),r([p(cc.Button)],t.prototype,"p_btnGeneralDraw",void 0),a=r([s],t)}(e("basePage"));c.showPage=function(t){var a={id:t.id,hash:t.hash,battleset:app.player.battlearr.normal};app.player.sfMapEventChallengeData(a,function(a){cc.log("\u9635\u5bb9:",a),t.battleset=a.battleset,e("basePage").showPage.call(c,t)})},t.exports=c,cc._RF.pop()},{basePage:void 0}],eventPageOffice:[function(e,t){"use strict";cc._RF.push(t,"82fcaxzUYNKDrgBWox79d42","eventPageOffice");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"eventpageoffice",pageType:1,createShot:!0},properties:{p_sprBg:cc.Sprite,p_sprTitle:cc.Sprite,p_btnLeft:cc.Button,p_btnRight:cc.Button,p_labLeft:cc.Label,p_labRight:cc.Label,p_labTalk:cc.Label,p_labTime:cc.Label,p_timeNode:cc.Node,p_nodeMask:cc.Node,p_sprGeneral:cc.Sprite,p_animGeneral:cc.Animation,p_spGeneral:sp.Skeleton,p_sprGName:cc.Sprite,p_arrSfTitle:[cc.SpriteFrame],p_arrSfBg:[cc.SpriteFrame]},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){var e=this;this._super(),this.p_btnLeft.node.on("click",function(){app.playSound("click"),e.m_optIndex=0,e.getReward()}),this.p_btnRight.node.on("click",function(){app.playSound("click"),e.m_optIndex=1,e.getReward()})},setParam:function(e){cc.log(e),this.m_type=e.type,this.m_numId=e.id,this.m_objInfo=e.info,this.m_hash=e.hash,this.m_desCb=e.des,this.refreshUI()},refreshUI:function(){switch(this.m_type){case 1:this.p_sprBg.spriteFrame=this.p_arrSfBg[0],this.p_sprTitle.spriteFrame=this.p_arrSfTitle[0];break;case 2:this.p_sprBg.spriteFrame=this.p_arrSfBg[1],this.p_sprTitle.spriteFrame=this.p_arrSfTitle[1];break;case 6:this.p_sprBg.spriteFrame=this.p_arrSfBg[2],this.p_sprTitle.spriteFrame=this.p_arrSfTitle[2]}var e=this.m_objInfo.talk;this.p_labLeft.string=e.opt[0],this.p_labRight.string=e.opt[1],this.p_labTalk.string=e.text;var t=this.m_objInfo.icon;if(this.p_nodeMask.active=!!t,t){app.db.getGBaseByGsid(t);var a=app.db.getGNamePathHByGsid(t);app.loadTexture(a,this.p_sprGName,this.prefabPath),app.loadGeneral(t,this.p_sprGeneral,this.p_spGeneral,this.p_animGeneral,null,this.prefabPath)}this.m_objInfo.etime&&this.schedule(this.countdown.bind(this),1),this.m_objInfo.etime||(this.p_timeNode.active=!1,this.unscheduleAllCallbacks())},countdown:function(){if(this.m_objInfo.etime){var e,t=this.m_objInfo.etime-app.player.getServerTime(),a=gUtils.getDayHourMinSecTime(t);e=langMgr.getString("eventPageOffice",0,[a[1],a[2]+1]),this.p_labTime.string=e,this.p_timeNode.node.active=!0,t||this.destroySelf()}},getReward:function(){var e=this,t={};t.id=this.m_numId,t.hash=this.m_hash,t.data={opt:this.m_optIndex},app.player.sfMapEventFinish(t,function(t){cc.log("\u5bf9\u8bdd\u5956\u52b1",t);var a=t.reward;app.pages.windowspagenoticebingo.showPage({str:e.m_objInfo.talk.to[e.m_optIndex]||"",cb:function(){e.onClose(),a.length>=1&&(app.player.addItem(a),app.pages.windowspagereward.showPage({showtype:1,reward:a,confirmcb:function(){e.m_desCb&&e.m_desCb()}}))}})})},destroySelf:function(){app.pages.newworldmappage.instance.p_nodeEvent.getComponent("mapEvent").destroyEventItem(this.m_objInfo.pos),app.pages.newworldmappage.instance.destroyEventItem(this.m_objInfo.pos)}});cc._RF.pop()},{basePage:void 0}],eventPageReward:[function(e,t){"use strict";cc._RF.push(t,"5158d2pHhZEWJdx5mlLs/vr","eventPageReward");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"eventpagereward",pageType:1,createShot:!0},properties:{p_layout:cc.Node,p_pfbItem:cc.Prefab,p_btnSure:cc.Button,p_labCost:cc.Label,p_sprCost:cc.Sprite,p_btnEnd:cc.Button},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){var e=this;this._super(),this.p_btnSure.node.on("click",function(){app.playSound("click"),e.getReward()}),this.p_btnEnd.node.on("click",function(){app.playSound("click"),e.onEnd()})},setParam:function(e){this.m_hash=e.hash,this.m_numId=e.id,this.m_desCb=e.des,this.m_arrItems=e.items,this.refreshUI(e)},refreshUI:function(e){this.m_arrNodeItem=this.m_arrNodeItem||[];for(var t=e.info,a=0;a<this.m_arrItems.length;++a){var i=this.m_arrItems[a],n=this.m_arrNodeItem[a];n?n.active=!0:((n=cc.instantiate(this.p_pfbItem)).parent=this.p_layout,this.m_arrNodeItem.push(n)),n.getComponent("propItem").initForBag({gsid:i.GSID,count:i.COUNT[1]}),n.getComponent("propItem").setClick(!0)}for(var r=this.m_arrItems.length;r<this.m_arrNodeItem.length;++r)this.m_arrNodeItem[r].active=!1;this.m_objCost=t.pay;var o=app.db.getPropsIconPath(this.m_objCost.gsid);app.loadTexture(o,this.p_sprCost,this.prefabPath),this.p_labCost.string=gUtils.showNum(this.m_objCost.count)},getReward:function(){var e=this,t=this.m_objCost.gsid,a=this.m_objCost.count;if(app.player.getCount(t)<a)app.showNotice(langMgr.getString("eventPageReward",0));else{var i=function(){app.player.sfMapEventFinish({id:e.m_numId,hash:e.m_hash,data:{}},function(i){cc.log("\u5b9d\u85cf\u5956\u52b1",i),e.onClose(),app.player.reduceItem({gsid:t,count:a}),app.player.addItem(i.reward),app.pages.windowspagereward.showPage({showtype:1,reward:i.reward,confirmcb:function(){e.m_desCb&&e.m_desCb()},target:e})})};if(38005==t){var n=app.db.getPropsName(t),r={content:langMgr.getString("eventPageReward",2,[gUtils.showNum(a),n]),confirmcb:i,target:this};app.pages.windowspagetipsmsg.showPage(r)}else i()}},onEnd:function(){var e=this,t={content:langMgr.getString("eventPageReward",3),confirmcb:function(){app.player.sfMapEventFinish({id:e.m_numId,hash:e.m_hash,data:{giveup:1}},function(){e.m_desCb&&e.m_desCb(),e.onClose(),app.showNotice(langMgr.getString("eventPageReward",1))})},target:this};app.pages.windowspagetipsmsg.showPage(t)}});cc._RF.pop()},{basePage:void 0}],eventPageShop:[function(e,t){"use strict";cc._RF.push(t,"3cb19trQSlON6YWvaZcM1HT","eventPageShop");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"eventpageshop",pageType:1,createShot:!0},properties:{p_arrPayBtn:[cc.Button],p_arrGoodsItem:[cc.Node],p_pfbGoodItem:cc.Prefab,p_arrGoodsName:[cc.Label],p_arrDisIcon:[cc.Sprite],p_labTime:cc.Label},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.schedule(this.refreshTimeUI.bind(this),1)},handleUI:function(){var e=this;this._super(),this.p_arrPayBtn.forEach(function(t,a){t.node.on("click",function(){e.onPay(a)})})},setParam:function(e){cc.log("obj----\x3e>",e),this.m_hash=e.hash,this.m_desCb=e.des,this.m_id=e.id,this.m_etime=e.etime,this.m_arrItems=e.info.items,this.m_numDis=e.info.dis,this.refreshUI(),this.refreshTimeUI()},refreshUI:function(){var e=this,t=gConfig.getGoodsDisPath(this.m_numDis);this.p_arrDisIcon.forEach(function(a){app.loadTexture(t,a,e.prefabPath)}),this.p_arrPayBtn.forEach(function(t,a){var i=e.m_arrItems[a].get,n=e.m_arrItems[a].pay,r=t.node.getChildByName("icon").getComponent(cc.Sprite),o=t.node.getChildByName("num").getComponent(cc.Label),s=app.db.getPropsIconPath(n.gsid);app.loadTexture(s,r,e.prefabPath),o.string=gUtils.showNum(n.count),e.p_arrGoodsItem[a].removeAllChildren();var p=cc.instantiate(e.p_pfbGoodItem);p.parent=e.p_arrGoodsItem[a],p.getComponent("propItem").initForBag(i),p.getComponent("propItem").setClick(!0),e.p_arrGoodsName[a].string=app.db.getPropsName(i.gsid)})},refreshTimeUI:function(){if(this.m_etime){var e=this.m_etime-app.player.getServerTime();this.p_labTime.string=gUtils.getHourMinSecTime(e/1e3),e<=0&&(this.m_etime=0,this._onDestroy())}},onPay:function(e){var t=this,a=this.m_arrItems[e],i=a.pay,n=a.get,r=app.db.getPropsName(i.gsid),o=app.db.getPropsName(n.gsid);if(app.player.getCount(i.gsid)<i.count)app.showNotice(langMgr.getString("eventPageShop",0,r));else{var s=function(){app.player.sfMapEventFinish({id:t.m_id,hash:t.m_hash,data:{index:e}},function(e){var a=e.reward;app.player.reduceItem(i),app.player.addItem(a),app.pages.windowspagereward.showPage({showtype:1,reward:a,confirmcb:function(){t._onDestroy()}})})};if(38005==i.gsid){var p={content:cc.js.formatStr(langMgr.getString("eventPageShop",2,[gUtils.showNum(i.count),r,o])),confirmcb:s,target:this};app.pages.windowspagetipsmsg.showPage(p)}else s()}},onClose:function(e){var t=this;if(e){if(!cc.isValid(this.node)||!this.node.active)return;--app.numPrefabZindex,app.popPage(),this.node.active=!1,cc.director.emit("page_close_end")}else{var a={content:langMgr.getString("eventPageShop",3),confirmcb:function(){app.player.sfMapEventFinish({id:t.m_id,hash:t.m_hash,data:{giveup:1}},function(){t._onDestroy(),app.showNotice(langMgr.getString("eventPageShop",1))})},target:this};app.pages.windowspagetipsmsg.showPage(a)}},_onDestroy:function(){this.m_desCb&&this.m_desCb(),this.m_desCb=null,this.onClose(!0)}});cc._RF.pop()},{basePage:void 0}],eventPageTips:[function(e,t){"use strict";cc._RF.push(t,"8fc56kApIpIKrO+TKPsdtnS","eventPageTips");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"eventpagetips",pageType:1,createShot:!0},properties:{p_btnConfirm:cc.Button,p_labTips:cc.Label},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){var e=this;this._super(),this.p_btnConfirm.node.on("click",function(){app.playSound("click"),e.onClose(),e.m_cb&&e.m_cb.apply(e.m_target)})},setParam:function(e){this.m_cb=e.confirmCb,this.p_labTips.string=e.intro,this.m_target=e.target},onClose:function(){this._super()}});cc._RF.pop()},{basePage:void 0}],exchangePage:[function(e,t){"use strict";cc._RF.push(t,"ae3a9QFum9PZbOYcXKkAeId","exchangePage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"exchangepage",pageParent:"generalmanagepage"},properties:{list:cc.Node,grid:cc.tableView,campMenu:e("campMenu"),gbefore:e("generalSample"),gafter:e("generalSample"),preview:cc.Button,cancel:cc.Button,confirm:cc.Button,p_btnHelp:cc.Button,cost:cc.Label,payIcon:cc.Sprite,p_girlTip_prefab:cc.Prefab},onLoad:function(){a.instance=this,this.fitTopMenu(150),this.campIndex=0,this.preview.node.on("click",this._preview.bind(this)),this.cancel.node.on("click",this._cancel.bind(this)),this.confirm.node.on("click",this._confirm.bind(this)),this.p_btnHelp.node.on("click",function(){app.playSound("click"),app.pages.windowspagetipshelp.showPage("1008")}),this.campMenu.target=this,this.grilTip=cc.instantiate(this.p_girlTip_prefab),this.grilTip.parent=this.p_bgNode,this.grilTip.x=0,this.grilTip.y=420,this.grilTip.getChildByName("bg").getChildByName("title").getComponent(cc.Label).string="\u53ef\u968f\u673a\u7f6e\u6362\u540c\u9635\u8425\u7684\u56db\u661f\u6216\u4e94\u661f\u6b66\u5c06\uff01",this.grilTip.active=!1},onDisable:function(){0!=this.campIndex&&this.campMenu._click(this.campIndex)},setParam:function(){this.refreshUI()},refreshUI:function(){var e=this;app.player.sfGExchangePreviewGet(function(t){if(cc.isValid(e)){var a;if(e.previewData=t,app.player.general[t.guid]){var i=e.previewData.guid,n=app.player.general[i].gsid;e.selectGeneralGuid=i;var r=e.previewData.gsid;e.gbefore.setGeneralSample(n,e),e.gafter.setGeneralSample(r,e);var o=app.db.getGBaseByGsid(n),s=app.db.getGBaseByGsid(r);a=o.STAR<0||o.STAR>5||o.STAR!==s.STAR?"err":"confirm"}else a="err";e.refreshBtn(a),e.refreshView(),e.refreshCostValue()}},function(t){cc.log("get err",t),e.previewData=null,e.gbefore.clean(),e.gafter.clean(),e.refreshBtn("clean"),e.selectGeneralGuid=null,e.selectBtn=null,e.m_arrPickedId=[],e.refreshView()})},_preview:function(){var e=this;cc.log("preview");var t=app.player.general[this.selectGeneralGuid],a=app.db.dbExchange[t.camp-1][4==t.star?0:1].ITEMS[0];if(app.player.getCount(a.GSID)<a.COUNT){var i=app.db.getPropsName(a.GSID);app.showNotice(langMgr.getString("exchangePage",0,i))}else app.player.sfGExchangePreviewRefresh(this.selectGeneralGuid,function(t,a){t?app.showNotice(t):(e.gafter.setGeneralSample(a.gsid,e),e.previewData=a,e.refreshBtn("confirm"),app.player.sfPlayerData(function(){app.pages.generalmanagepage.instance.refreshCoinUI()}))})},_cancel:function(){var e=this;cc.log("cancel"),this.previewData&&app.player.sfGExchangeConfirm(this.selectGeneralGuid,0,function(t){if(t)app.showNotice(t);else{if(e.previewData=null,e.gafter.clean(),e.selectGeneralGuid){var a=app.player.general[e.selectGeneralGuid].gsid,i=app.db.getGBaseByGsid(a);if(i.STAR<0||i.STAR>5)return e.gbefore.clean(),e.gafter.clean(),e.selectGeneralGuid=null,e.selectBtn=null,e.refreshBtn("clean"),e.m_arrPickedId=[],void e.refreshView()}e.refreshBtn("preview"),e.refreshView()}})},_confirm:function(){var e=this;cc.log("confirm"),app.player.sfGExchangeConfirm(this.selectGeneralGuid,1,function(t,a){if(t)app.showNotice(t);else{e.previewData=null,app.player.addGeneral(a);var i={showtype:1,reward:[{gsid:a.gsid,count:1}],target:e};app.pages.windowspagereward.showPage(i),e.gbefore.clean(),e.gafter.clean(),app.player.haveGeneral(a.gsid)||(app.player._icons+="|"+a.gsid),e.selectGeneralGuid=null,e.selectBtn=null,e.refreshBtn("clean"),e.m_arrPickedId=[],e.refreshView()}})},refreshView:function(){this.m_arrShowData=this.setData();var e=this.m_arrShowData.length;this.grid.initTableView(e,{array:this.m_arrShowData,maxpick:1,initfun:"initForBag",selectitem:"selectBtn",target:this}),this.scrollToPick(this.selectGeneralGuid)},setData:function(){var e=[];for(var t in app.player.general)if(!(app.player.isSoulGeneral(t)||app.player.hasBeenSoulBind(t)||app.player.isOfficialGeneral(t)||app.player.isRetinueGeneral(t))){var a=app.player.general[t],i=app.db.getGBaseByGsid(a.gsid);i.STAR<4||i.STAR>5||5==i.CAMP||6==i.CAMP||0!=this.campIndex&&this.campIndex!=a.camp||e.push(t)}return e.sort(function(e,t){var a=app.player.general[e],i=app.player.general[t];return a.star<i.star?1:a.star==i.star&&a.camp>i.camp?1:-1}),e},refreshBtn:function(e){switch(e){case"preview":this.preview.node.active=!0,this.cancel.node.active=!1,this.confirm.node.active=!1,this.grilTip.active=!1,this.list.active=!0;break;case"confirm":this.preview.node.active=!1,this.cancel.node.active=!0,this.confirm.node.active=!0,this.grilTip.active=!1,this.list.active=!1;break;case"clean":this.preview.node.active=!1,this.cancel.node.active=!1,this.confirm.node.active=!1,this.grilTip.active=!0,this.list.active=!0;break;case"err":this.preview.node.active=!1,this.cancel.node.active=!0,this.confirm.node.active=!1,this.grilTip.active=!1,this.list.active=!1;break;default:this.preview.node.active=!1,this.cancel.node.active=!1,this.confirm.node.active=!1,this.list.active=!0,this.grilTip.active=!0}},itemClick:function(e,t){if(this.previewData)return app.showNotice(langMgr.getString("exchangePage",1)),!1;if(this.selectGeneralGuid==e)return!0;var a=app.player.general[e];if(!a)return!1;this.selectBtn&&this.selectBtn.selected(!1,this.selectGeneralGuid),this.selectBtn=t,this.selectGeneralGuid=e,this.gbefore.setGeneralSample(a.gsid,this);var i=app.db.dbExchange[a.camp-1],n=4==a.star?0:1,r=i[n].ITEMS[0];cc.log(i,n,r);var o=app.db.getPropsIconPath(r.GSID);return app.loadTexture(o,this.payIcon,this.prefabPath),this.cost.string=r.COUNT,this.preview.node.active=!0,this.grilTip.active=!1,!0},campMenuHandler:function(e){return this.campIndex=e,this.refreshView(),!0},scrollToPick:function(e){var t=this.m_arrShowData.indexOf(e);if(!(t<0)){var a=this.grid.getScrollOffset().y,i=this.grid.cell.data.height,n=this.grid._groupCellCount,r=Math.floor(t/n),o=0!=r?this.grid.top:0,s=(i+this.grid.spacingY)*r+o;s>a&&this.grid.scrollToOffset(cc.v2(0,s),1)}},refreshCostValue:function(){if(this.previewData){this.previewData.gsid;var e=this.previewData.guid,t=app.player.general[e];if(t){var a=app.db.dbExchange[t.camp-1],i=4==t.star?0:1,n=a[i].ITEMS[0];cc.log(a,i,n);var r=app.db.getPropsIconPath(n.GSID);app.loadTexture(r,this.payIcon,this.prefabPath),this.cost.string=n.COUNT}}}});cc._RF.pop()},{basePage:void 0,campMenu:void 0,generalSample:void 0}],expeditionBagPage:[function(e,t){"use strict";cc._RF.push(t,"1d00fl0ZuFOpa4YKr0UT6b9","expeditionBagPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"expeditionbagpage",pageType:1},properties:{p_cardItemPrefab:cc.Prefab,p_cardContent:cc.Node},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(),this._super(),this.m_arrCardItems=[]},handleUI:function(){this._super()},setParam:function(){this.m_data=[];for(var e=0;e<app.expeditionInfo.cardbag.length;e++)this.m_data.push(app.expeditionInfo.cardbag[e].id);this.refreshUI()},refreshUI:function(){for(var e=0;e<this.m_data.length;e++){var t=this.m_arrCardItems[e];t||((t=cc.instantiate(this.p_cardItemPrefab)).parent=this.p_cardContent,t.scale=.7,this.m_arrCardItems.push(t)),t.active=!0,t.getComponent("expeditionCardItem")&&(t.getComponent("expeditionCardItem").refreshUI(this.m_data[e],this),t.getComponent("expeditionCardItem").setClick(!0),t.getComponent("expeditionCardItem").setCountry(!1))}for(var a=this.m_data.length;a<this.m_arrCardItems.length;a++)this.m_arrCardItems[a].active=!1},onDestroy:function(){this._super()},onClose:function(){this._super()}});a.showPage=function(t,a,i){!app.expeditionInfo||!app.expeditionInfo.cardbag||app.expeditionInfo.cardbag.length<=0?app.showNotice(langMgr.getString("expeditionBagPage",0)):e("basePage").showPage.call(this,t,a,i)},a.refreshRed=function(e){var t=app.player.getCount(90153);e.active=t<=0},cc._RF.pop()},{basePage:void 0}],expeditionBlessPage:[function(e,t){"use strict";cc._RF.push(t,"aaa81Bj8NBK/7E3GhaKM8lV","expeditionBlessPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"expeditionblesspage"},properties:{p_arrBless:[cc.Node],p_btnBless:cc.Button,p_labCost:cc.Label,p_labCoin:cc.Label,p_btnAdd:cc.Button},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){var e=this;this.p_btnBless.node.on("click",function(){app.playSound("click"),e.onBless()}),this.p_btnAdd.node.on("click",function(){app.playSound("click")}),this.p_arrBless.forEach(function(e,t){e.on("touchend",function(){var a=app.expedinfo.info.wish;app.pages.windowspageexpeditionskill.showPage({index:t,level:a[t],spriteFrame:e.getChildByName("icon").getComponent(cc.Sprite).spriteFrame})})})},setParam:function(){this.refreshUI()},refreshUI:function(){for(var e=app.expedinfo.info.wish,t=0;t<e.length;++t)this.p_arrBless[t].getChildByName("tv_blessing").getComponent(cc.Label).string="x"+e[t];var a=app.db.getStatueCostByType(1);this._max=a.length,this._useCount=app.player.getCount(90154),this._cost=a[Math.min(a.length-1,this._useCount)],this.p_labCost.string=this._cost,this.p_labCoin.string=gUtils.showNum(app.player.getCount(38009))},onBless:function(){var e=this;this._useCount>=this._max&&app.showNotice(langMgr.getString("expeditionBlessPage",0)),app.player.getCount(38009)<this._cost?app.showNotice(langMgr.getString("expeditionBlessPage",1)):app.player.sfExpedStatue({type:1},function(t){app.expedinfo.info=t,app.player.reduceItem({gsid:38009,count:e._cost}),app.player.addItem({gsid:90154,count:1}),app.showNotice(langMgr.getString("expeditionBlessPage",2)),e.refreshUI(),app.pages.expeditionpage.instance.refreshBuff()})}});cc._RF.pop()},{basePage:void 0}],expeditionBossInfoPage:[function(e,t){"use strict";cc._RF.push(t,"185f2f92z9M+6Knky0deJwJ","expeditionBossInfoPage");var a=cc.Class({extends:e("basePage"),properties:{},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},setParam:function(){},refreshUI:function(){}});cc._RF.pop()},{basePage:void 0}],expeditionBountyPage:[function(e,t){"use strict";cc._RF.push(t,"8340erQgQFPwIGmGtUCDoFh","expeditionBountyPage");var a="expeditionbountyred",i=cc.Class({extends:e("basePage"),statics:{prefabPath:"expeditionbountypage",pageParent:"bountypage"},properties:{p_tableView:cc.tableView,p_merBar:cc.ProgressBar,p_barItem:cc.Node,p_btnUnLock:cc.Button,p_btnBuygx:cc.Button,p_btnBuyRed:cc.Node,p_btnHelp:cc.Button,p_btnGoMission:cc.Button,p_labScore:cc.Label,p_labTime:cc.Label},onLoad:function(){i.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.fitTopMenu(),this.starContentY=this.p_tableView.content.y,this.starBarY=this.p_merBar.node.y,this.m_arrBarItems||(this.m_arrBarItems=[],this.m_arrBarItems.push(this.p_barItem))},handleUI:function(){var e=this;this._super(),this.p_tableView.content.on("position-changed",function(){var t=e.p_tableView.content.y-e.starContentY;e.p_merBar.node.y=e.starBarY+t},this),this.p_btnUnLock.node.on("click",function(){}),this.p_btnBuygx.node.on("click",function(){if(app.playSound("click"),1==app.player.getCount(94100)){if(null==localDataUtils.GetValue(a,null)){var t=app.pages.expeditionbountypage.getEndTime();localDataUtils.SetValue(a,1,t),e.p_btnBuyRed.active=!1,eventMgr.emit(eventStr.redEvent.RefreshPremiumRed)}var i=langMgr.getString("expeditionBountyPage",3);app.player.getCount(gConfig.player.yq)>=e.m_maxScore&&(i=langMgr.getString("expeditionBountyPage",4));var n={content:i,confirmcb:function(){app.player.yb<100?app.showNotice(langMgr.getString("expeditionBountyPage",1)):app.player.sfMazeBountyBuy({time:100},function(t,a){app.player.sfPlayerData(function(){app.pages.windowspagereward.showPage({showtype:1,reward:a.items}),e.refreshData(),app.pages.premiumpage.instance.refreshCoinUI(),eventMgr.emit(eventStr.redEvent.RefreshPremiumRed)})})},target:e};app.pages.windowspagetipsmsg.showPage(n)}else app.showNotice(langMgr.getString("expeditionBountyPage",0))}),this.p_btnHelp.node.on("click",function(){app.pages.windowspagetipshelp.showPage("1034")}),this.p_btnGoMission.node.on("click",function(){app.playSound("click"),app.goToPage(1024)})},setParam:function(){this.time=0,this.refreshData()},refreshData:function(){if(this.m_arrGiftData&&this.m_arrGiftData.length>0){var e=this.m_arrGiftData;this.refreshUI(e)}else this.m_arrGiftData=app.db.dbMazeBounty,this.refreshUI(this.m_arrGiftData)},refreshUI:function(e){var t=this;if(this.p_labScore.string=app.player.getCount(gConfig.player.yq),this.p_btnUnLock.node.active=!1,this.refreshTime(),this.p_merBar.active=e&&e.length>0,e&&e.length>0){for(var a=0,i=0;i<e.length;++i){var n=this.m_arrBarItems[i];n||((n=cc.instantiate(this.p_barItem)).parent=this.p_merBar.node,this.m_arrBarItems.push(n)),n.y=-143*i,n.getChildByName("pick").active=app.player.getCount(gConfig.player.yq)>=e[i].SCORE,n.getComponentInChildren(cc.Label).string=e[i].SCORE,a=e[i].SCORE,this.m_maxScore=a,n.active=!0}var r=(e.length-1)*Math.abs(-143);this.p_merBar.node.height=r,this.p_merBar.totalLength=r,this.p_merBar.progress=app.player.getCount(gConfig.player.yq)/a>1?1:app.player.getCount(gConfig.player.yq)/a;for(var o=e.length;o<this.m_arrBarItems.length;++o)this.m_arrBarItems[o].active=!1;for(var s,p=0,c=0;c<e.length;++c){var h=e[c],l=1==app.player.getCount(h.MARK.N),g=1==!!app.player.getCount(h.MARK.S),d=app.player.getCount(gConfig.player.yq);(!l&&h.SCORE<=d||!g&&h.SCORE<=d&&d>0)&&0==s&&(s=c),d<h.SCORE&&0==p&&(p=c)}this.p_tableView.initTableView(e.length,{array:e,type:1,target:this},function(){s=s||p;var e=t.p_tableView.cell.data.height,a=Math.max(s-1,0)*e;t.p_tableView.scrollToOffset(cc.Vec2(0,a))})}else this.p_tableView.clear()},isThreeDay:function(){if(1==app.player.getCount(94100)&&!this.p_btnBuygx.node.activeInHierarchy){this.p_btnBuygx.node.active=!0;var e=localDataUtils.GetValue(a,null);this.p_btnBuyRed.active=1==app.player.getCount(94100)&&null==e}},refreshTime:function(){var e=app.player.getServerTime(),t=app.pages.expeditionbountypage.getEndTime(),a=gUtils.getDayHourMinSecTime(t-e);this.p_labTime.string=gUtils.getCountDownStr(t-e),a[0]<3?this.isThreeDay():this.p_btnBuygx.node.activeInHierarchy&&(this.p_btnBuygx.node.active=!1)},update:function(e){this.time>1?(this.time=0,this.refreshTime()):this.time+=e},refreshMenuRed:function(){return!1},onClose:function(){this._super()}});i.showPage=function(t,a,i){if(0===app.player.mazeend)return app.showNotice(langMgr.getString("expeditionBountyPage",2)),void(i&&i("\u8fdc\u5f81\u8d4f\u91d1\u9601\u672a\u5f00\u542f"));e("basePage").showPage.call(this,t,a,i)},i.getEndTime=function(){return app.player.mazeend},i.refreshRed=function(e){var t=!1;if(0!==app.player.mazeend){for(var i=app.db.dbMazeBounty,n=0;n<i.length;n++){var r=i[n];if(t=app.player.getCount(gConfig.player.yq)>=r.SCORE&&(app.player.getCount(r.MARK.N)<=0||app.player.getCount(r.MARK.S)<=0&&app.player.getCount(94100)>0))break}if(!t){var o=app.player.getServerTime(),s=app.pages.expeditionbountypage.getEndTime();if(gUtils.getDayHourMinSecTime(s-o)[0]<3){var p=localDataUtils.GetValue(a,null);t=1==app.player.getCount(94100)&&null==p}}}return e&&(e.active=t),t},cc._RF.pop()},{basePage:void 0}],expeditionCheckpointPage:[function(e,t){"use strict";cc._RF.push(t,"090bdbL/AROi474cDNDEKZ3","expeditionCheckpointPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"expeditioncheckpointpage"},properties:{p_nodeHead:cc.Node,p_labName:cc.Label,p_labPower:cc.Label,p_pfbItem:cc.Prefab,p_nodeContent:cc.Node,p_btnGo:cc.Button,p_arrRewards:[cc.Node]},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.m_arrItems=[]},handleUI:function(){var e=this;this.p_btnGo.node.on("click",function(){if(app.playSound("click"),app.player.getCount(90153)==e._id-1){for(var t in app.player.general)break;app.battleType="expedition",app.expedHpInfo=app.expedinfo.info.hp,app.expedWishArr=app.expedinfo.info.wish||[],app.expedBattleInfo=e._obj.battleset,app.expedEnemyInfo={rname:e._obj.rname,level:e._obj.level,power:e._obj.power,iconid:e._obj.iconid},app.goToNormBattle()}else app.showNotice(langMgr.getString("expeditionCheckpointPage",0))})},setParam:function(e){this._id=e,app.expedinfo?(this._obj=app.expedinfo.map,this.refreshUI()):this.onClose()},refreshUI:function(){this.p_nodeHead&&this.p_nodeHead.getComponent("headItem").init({iconid:this._obj.iconid,headid:this._obj.headid,frameid:this._obj.frameid,target:this}),this.p_labName.string=this._obj.rname;var e=0,t=0;for(var a in this._obj.battleset.team){t+=this._obj.battleset.team[a].power;var i=this.m_arrItems[e];i||((i=cc.instantiate(this.p_pfbItem)).parent=this.p_nodeContent,this.m_arrItems.push(i)),i.active=!0,i.getComponent("generalExpedItem").refreshUI(this._obj.battleset.team[a],this),e++}this.p_labPower.string=t;for(var n=e;n<this.m_arrItems.length;++n)this.m_arrItems[n].active=!1;for(var r=app.db.getExpedInfoById(this._id),o=0;o<r.REWARD.length;++o)this.p_arrRewards[o].active=!0,this.p_arrRewards[o].getComponent("propItem").initForBag(r.REWARD[o]),this.p_arrRewards[o].getComponent("propItem").setClick(!0);for(var s=r.REWARD.length;s<this.p_arrRewards.length;++s)this.p_arrRewards[s].active=!1;this.p_btnGo.node.active=app.player.getCount(90153)==this._id-1}});cc._RF.pop()},{basePage:void 0}],expeditionEntrancePage:[function(e,t){"use strict";cc._RF.push(t,"490b94837tCg5/lBG29GUBK","expeditionEntrancePage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"expeditionentrancepage"},properties:{p_nodeExpedition:cc.Node,p_labTimeExpedition:cc.Label,p_nodeAncient:cc.Node,p_labTimeAncient:cc.Label},onLoad:function(){a.instance=this,this.fitTopMenu(),this._super(),this.schedule(this.refreshTime,1),this.schedule(this.checkServerInfo,5)},handleUI:function(){this._super(),this.p_nodeExpedition.on("touchend",function(){app.pages.expeditionpage.showPage()}),this.p_nodeAncient.on("touchend",function(){app.pages.ancientfieldpage.showPage()})},setParam:function(){app.cacheExpeditionEntrance&&app.cacheExpeditionEntrance.mazeetime>Date.now()&&app.cacheExpeditionEntrance.ancientetime>Date.now()?this.refreshUI():this.sfExpeditionTime()},sfExpeditionTime:function(){var e=this;app.player.sfExpeditionTimeInfo(function(t,a){cc.log(t,a),t?app.showNotice(t):(app.cacheExpeditionEntrance={},app.cacheExpeditionEntrance.mazeetime=a.MAZE_ETIME.etime||0,app.cacheExpeditionEntrance.ancientetime=a.YUANGU_ETIME.etime||0,e.refreshUI())})},refreshUI:function(){this.refreshTime()},refreshTime:function(){if(app.cacheExpeditionEntrance){var e=app.player.getServerTime();this.p_labTimeExpedition.string=gUtils.getHourMinSecTime((app.cacheExpeditionEntrance.mazeetime-e)/1e3),this.p_labTimeAncient.string=gUtils.getHourMinSecTime((app.cacheExpeditionEntrance.ancientetime-e)/1e3)}},checkServerInfo:function(){app.cacheExpeditionEntrance&&(app.cacheExpeditionEntrance.mazeetime>Date.now()&&app.cacheExpeditionEntrance.ancientetime>Date.now()||this.sfExpeditionTime())}});cc._RF.pop()},{basePage:void 0}],expeditionEventPage:[function(e,t){"use strict";cc._RF.push(t,"fab94lqfVFM5KBzI+YXs56o","expeditionEventPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"expeditioneventpage",pageType:1,createShot:!0},properties:{p_tableView:cc.Node,p_labelRefreshTime:cc.Label,p_lableEventCount:cc.Label},onLoad:function(){a.instance=this,this.isRTime=!0,this.time=0,this.creatMask(!0),this.stopNodeEvent(),this.handleUI()},handleUI:function(){this._super()},setParam:function(e){this.eventInfo=e.list,this.eventNextTime=e.next,this.eventMax=e.max,this.refreshTableV();var t=gUtils.dateFormatter("YYYY-MM-DD",(new Date).getTime());localDataUtils.SetValue("expeditioneventred",t),this.refreshTime()},refreshTableV:function(){var e=this.setData(this.eventInfo);this.p_tableView.getComponent("tableView").initTableView(e.length,{array:e,target:this}),this.p_lableEventCount.string=langMgr.getString("mapEvent",1,[e.length,this.eventMax])},update:function(e){this.isRTime&&(this.time>1?(this.time=0,this.refreshTime()):this.time+=e)},refreshTime:function(){var e=this,t=app.player.getServerTime(),a=(this.eventNextTime-t)/1e3,i=this.setData(this.eventInfo);i.length==this.eventMax?(this.p_labelRefreshTime.string=langMgr.getString("mapEvent",3),this.p_labelRefreshTime.node.active=!1):(this.p_labelRefreshTime.string=langMgr.getString("mapEvent",2,gUtils.getHourMinSecTime(a)),this.p_labelRefreshTime.node.active=!0),a<0&&i.length<this.eventMax&&app.pages.newworldmappage.instance.getEvent().then(function(t){t&&(e.eventInfo=t.list,e.eventNextTime=t.next,e.eventMax=t.max,e.refreshTableV())})},setData:function(e){this.m_eventData=e;var t=[];for(var a in e){var i=e[a];i.pos=a,t.push(i)}return t.sort(function(e,t){return t.info.lv-e.info.lv}),t},onClose:function(){this._super(),this.isRTime=!1,app.pages.newworldmappage.instance&&app.pages.newworldmappage.instance.refreshEvent()}});cc._RF.pop()},{basePage:void 0}],expeditionMoqiPage:[function(e,t){"use strict";cc._RF.push(t,"37b87Cfc3lFwYqBx5Vn7aR7","expeditionMoqiPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"expeditionmoqipage"},properties:{},onLoad:function(){a.instance=this,this.creatMask(!0,200),this.stopBgNodeEvent(),this.handleUI()},handleUI:function(){var e=this;this.scheduleOnce(function(){e.onClose()},4)}});cc._RF.pop()},{basePage:void 0}],expeditionPage:[function(e,t){"use strict";cc._RF.push(t,"0f4b3dfG4xHLopE95buF14j","expeditionPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"expeditionpage"},properties:{p_flagNode:cc.Node,p_flagSpine:sp.Skeleton,p_arrowsNode:[cc.Node],p_shadowNode:cc.Node,p_mapNode:cc.Node,p_roadNode:cc.Node,p_posNode:cc.Node,p_mapItemPrefab:cc.Node,p_labTime:cc.Label,p_sprTitle:cc.Sprite,p_titleSprite:[cc.SpriteFrame],p_btnHelp:cc.Button,p_btnShop:cc.Button,p_btnSevenLight:cc.Button,p_btnGeneral:cc.Button,p_btnBag:cc.Button,p_btnReward:cc.Button,p_rewardAnimal:cc.Node,p_btnNextLevels:[cc.Button],p_markNode:cc.Node,p_passNode:cc.Node,p_passTime:cc.Label,p_passTouchNode:cc.Node},onLoad:function(){a.instance=this,this.fitTopMenu(),this._super();var e=this.p_posNode.convertToWorldSpaceAR(this.p_posNode.getChildByName("pos_-1_0").getPosition()),t=this.p_mapNode.convertToNodeSpaceAR(e);this.m_shadowOffset=this.p_shadowNode.y-t.y,this.time=0,this.m_isMove=!1,this.Rtime=!1,this.arrMapItems=[],this.arrMapItems.push(this.p_mapItemPrefab)},onEnable:function(){this._super(),eventMgr.on(eventStr.commonEvent.TurnEvent,this.goToTurnPage,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.commonEvent.TurnEvent,this.goToTurnPage,this)},goToTurnPage:function(){this.isShowTurn=!1},handleUI:function(){var e=this;this._super(),this.p_mapNode.on("touchmove",function(t){e.moveMapByTouch(t)}),this.p_mapNode.on("touchend",function(t){e.m_isMove=!1,e.moveMapByTouch(t)}),this.p_btnHelp.node.on("click",function(){app.playSound("click"),app.pages.windowspagetipshelp.showPage("1021")}),this.p_btnShop.node.on("click",function(){app.playSound("click"),app.pages.shoppage.showPage("kill")}),this.p_btnSevenLight.node.on("click",function(){app.playSound("click"),app.pages.windowspageexpeditionsevenlight.showPage()}),this.p_btnGeneral.node.on("click",function(){app.playSound("click"),app.pages.windowspageexpeditiongeneral.showPage()}),this.p_btnBag.node.on("click",function(){app.playSound("click"),app.pages.expeditionbagpage.showPage()}),this.p_btnReward.node.on("click",function(){e.onBtnRewardClick()}),this.p_btnNextLevels.forEach(function(e,t){e.node.on("click",function(){app.playSound("click"),app.pages.windowspageexpeditioncsm.showPage(t)})}),this.p_flagSpine.setEventListener(function(t,a){if("qidian"==a.data.name){var i=t.animation.timelines[t.animation.timelines.length-1].frames,n=i[1]-i[0];n-=.1,e.p_flagNode.stopAllActions(),e.p_flagNode.runAction(cc.moveTo(n,e.p_posNode.getChildByName("pos_"+app.expeditionInfo.row+"_"+app.expeditionInfo.pos).position))}}),this.p_flagSpine.clearTracks(),this.p_passTouchNode.on("touchend",function(){e.onClose()})},onBtnRewardClick:function(){var e=this;app.expeditionInfo.row==app.expeditionInfo.map.length-1&&void 0===app.expeditionInfo.finish&&(app.playSound("click"),void 0!==app.expeditionInfo.map[app.expeditionInfo.map.length-1][0].finish?app.player.sfExpedGift(function(t,a){if(t)app.showNotice(t);else{var i={showtype:1,reward:a.items};a.global_gifts&&app.setNewRecommendGift(a.global_gifts),app.expeditionInfo.finish=app.player.getServerTime(),e.refreshUI(),app.player.sfPlayerByParam(["props","hide","others"],function(){app.expeditionInfo.nextgatetype.length>0?app.pages.windowspagereward.showPage(i):app.pages.windowspageexpeditionpass.showPage(i)})}}):app.showNotice(langMgr.getString("expeditionPage",5)))},moveMapByTouch:function(e){if(e.getLocation&&!(Math.abs(e.getLocation().y-e.getStartLocation().y)<=6)){this.m_isMove=!0;var t=this.p_mapNode.y,a=e.getDelta();this.setNodeMove(t,a.y)}},setNodeMove:function(e,t){var a=this.p_mapNode.height/2-cc.winSize.height/2,i=-this.p_mapNode.height/2+cc.winSize.height/2;e+=1*t,e=Math.min(a,e),e=Math.max(i,e),this.p_mapNode.y=e},setParam:function(e){var t=this;void 0===e&&(e=!1),this.isShowTurn=!0,this.setMark(!0);var a=function(){t.time=1,t.Rtime=!1,t.getNextTime(),t.createMap(),t.getNextCanAttack(),t.refreshMap(),t.refreshUI(),t.initMoveMap(),t.p_passNode.active=!!app.expeditionInfo.finish&&app.expeditionInfo.nextgatetype.length<=0,app.runUnlockGuide("MAZE")};e?app.player.sfExpedInfo(function(e,i){if(e)return app.showNotice(langMgr.getString("expeditionPage",6)),void t.onClose();app.pages.expeditionpage.getExpeditionInfo(i),null==localDataUtils.GetValue("expeditionred",null)&&localDataUtils.SetValue("expeditionred",1,i.nextreftime),a()}):a()},afterBattleFresh:function(){var e=app.battleParam.row,t=app.battleParam.pos;this.updateMapItem(e,t,app.battleParam.node),void 0!==app.battleParam.node.finish?this.moveNextPosition(e,t):void 0!==app.battleParam.node.cardlist&&void 0===app.battleParam.node.choicecard&&(this.isShowTurn&&app.pages.windowspageexpeditioncards.showPage({row:e,pos:t}),this.moveNextPosition(e,t))},initMoveMap:function(){var e=this.p_posNode.getChildByName("pos_-1_0").y-this.p_posNode.getChildByName("pos_"+app.expeditionInfo.row+"_"+app.expeditionInfo.pos).y;this.setNodeMove(667,e),this.setMark(!1)},refreshUI:function(){this.showArrow();var e=Math.min(2,app.expeditionInfo.floor-1);this.p_sprTitle.spriteFrame=this.p_titleSprite[e];var t=!0,a=!1,i=!1;app.expeditionInfo.row==app.expeditionInfo.map.length-1&&void 0!==app.expeditionInfo.map[app.expeditionInfo.map.length-1][0].finish&&(void 0===app.expeditionInfo.finish?i=!0:(a=!0,t=!1)),this.p_btnReward.node.active=t,this.p_rewardAnimal.active=i,this.p_btnNextLevels.forEach(function(e,t){var i=app.expeditionInfo.nextgatetype[t];e.node.active=!!i&&a});var n=this.p_posNode.convertToWorldSpaceAR(this.p_posNode.getChildByName("pos_"+app.expeditionInfo.row+"_"+app.expeditionInfo.pos).position),r=this.p_mapNode.convertToNodeSpaceAR(n);this.p_shadowNode.y=r.y+this.m_shadowOffset},refreshMap:function(){for(var e=0;e<app.expeditionInfo.map.length;e++)for(var t=0;t<app.expeditionInfo.map[e].length;t++)app.expeditionInfo.map[e][t].node.getComponent("expeditionItem").refreshUI(e,t,this)},createMap:function(){var e=app.expeditionInfo.map,t=0;this.p_flagNode.position=this.p_posNode.getChildByName("pos_"+app.expeditionInfo.row+"_"+app.expeditionInfo.pos).position;for(var a=0;a<e.length;a++)for(var i=0;i<e[a].length;i++){var n=this.p_posNode.getChildByName("pos_"+a+"_"+i);if(n){var r=this.arrMapItems[t];r||((r=cc.instantiate(this.p_mapItemPrefab)).parent=this.p_posNode,this.arrMapItems.push(r)),r.position=n.position,r.active=!0,this.setMapItem(a,i,r),t++}}},expedBattle:function(e,t){app.battleType="expedition";var a=app.expeditionInfo.map[e][t];switch(app.battleCache=a.cache,app.battleParam={pos:t,row:e,type:a.type},app.expeditionInfo.map[e][t].type){case gConfig.expeditionEventType.PTGW:case gConfig.expeditionEventType.JYGW:case gConfig.expeditionEventType.BOSS:app.expedType=1,app.battleConfig=gUtils.deepClone(a.bset);break;case gConfig.expeditionEventType.SLZM:case gConfig.expeditionEventType.SMDK:app.expedType=2,app.battleConfig=gUtils.deepClone(a.bset.team)}app.battleParam.factor=1,app.battleParam.exlevel=0,app.player.sfExpedCards(function(a,i){a?app.showNotice(a):(cc.log(e,t),e==i.row+1?(app.battleParam.levelFactor=i.levelfactor||0,app.leftCards=i.lcards,cc.log("vipfactor",app.player.vipbattlefactor),cc.log("stepfactor",0,"floorfactor",1,"levelfactor",i.levelfactor),cc.log("stepnum",0,"exlevel",0),app.goToNormBattle()):app.showNotice(langMgr.getString("expeditionPage",7)))})},gotoBattle:function(){var e=this,t=app.player.battlearr.normal;app.player.sfExpedStart({type:app.battleParam.type,pos:app.battleParam.pos,row:app.battleParam.row,battleset:t},function(t,a){app.battleSeed=a.seed,app.player.sfExpedFinish({battleid:a.battleid},function(t,a){if(app.expeditionInfo.gcache=a.gcache,app.battleParam.node=a.node,app.battleParam.result=a.result.ret,app.battleParam.node.type==gConfig.expeditionEventType.SLZM&&a.tempgeneral)for(var i=0;i<a.tempgeneral.length;++i){var n=app.player.dealGeneral(a.tempgeneral[i]);if(!app.expeditionInfo.tempgeneral[n.guid]){app.expeditionInfo.tempgeneral[n.guid]=n;break}}e.afterBattleFresh()})})},getGeneralByGuid:function(e){var t={1:app.player.general,2:app.expeditionInfo.tempgeneral};for(var a in t)if(t[a][e])return t[a][e];return null},isCanNext:function(){return-1==app.expeditionInfo.row||!!app.expeditionInfo.map[app.expeditionInfo.row][app.expeditionInfo.pos].finish},goNextPosition:function(e,t){var a=this;this.isCanNext()?app.player.sfExpedGo({index:t},function(i,n){if(i)app.showNotice(i);else{switch(app.expeditionInfo.map[e].forEach(function(e,a){t!=a&&e.node.getComponent("expeditionItem").setHide()}),a.updateMapItem(e,t,n),a.getNextCanAttack(),a.showArrow(),app.expeditionInfo.map[e][t].type){case gConfig.expeditionEventType.PTGW:case gConfig.expeditionEventType.JYGW:case gConfig.expeditionEventType.BOSS:case gConfig.expeditionEventType.SLZM:case gConfig.expeditionEventType.SMDK:a.expedBattle(e,t);break;default:app.expeditionInfo.map[e][t].node.getComponent("expeditionItem").onBtnClick()}cc.log(app.expeditionInfo)}}):app.showNotice(langMgr.getString("expeditionPage",5))},moveNextPosition:function(e,t){app.expeditionInfo.map[e][t].type==gConfig.expeditionEventType.LMKZ&&app.expeditionInfo.map[e].forEach(function(e,a){t!=a&&e.node.getComponent("expeditionItem").setHide()}),app.expeditionInfo.row=e,app.expeditionInfo.pos=t,this.getNextCanAttack(),app.expeditionInfo.map[e+1]&&app.expeditionInfo.map[e+1].forEach(function(e,t){e.node&&-1!=app.expeditionInfo.canAttack.indexOf(t)&&(e.node.getComponent("expeditionItem").setLight(!0),e.node.getComponent("expeditionItem").showPower())}),app.expeditionInfo.map[e+2]&&app.expeditionInfo.map[e+2].forEach(function(e){e.node&&e.node.getComponent("expeditionItem").setShow(),e.node&&e.node.getComponent("expeditionItem").setLight(!1)}),app.expeditionInfo.map[e][t].node.getComponent("expeditionItem").refreshUI(e,t,this),this.p_flagSpine.setAnimation(0,"3"),this.p_flagNode.position=this.p_posNode.getChildByName("pos_"+app.expeditionInfo.row+"_"+app.expeditionInfo.pos).position,this.refreshUI()},goNextFloor:function(){var e=this;app.player.sfExpedInfo(function(t,a){t?app.showNotice(langMgr.getString("expeditionPage",6)):(app.pages.expeditionpage.getExpeditionInfo(a),e.setParam())})},setMapItem:function(e,t,a){app.expeditionInfo.map[e][t].node=a},getMapItem:function(e,t){return app.expeditionInfo.map[e][t].node||null},updateMapItem:function(e,t,a){var i=app.expeditionInfo.map[e][t].node;app.expeditionInfo.map[e][t]=a,app.expeditionInfo.map[e][t].node=i},showArrow:function(){var e=[],t=[164,178,161,95,101,73,116,125,99],a=app.expeditionInfo.row;app.expeditionInfo.canAttack.forEach(function(t){e.push(app.expeditionInfo.map[a+1][t])}),this.p_arrowsNode.forEach(function(a,i){if(e[i]){var n=e[i].node,r=t[e[i].type]+80,o=cc.v2(n.position.x,n.position.y+r);a.position=a.parent.convertToNodeSpaceAR(n.parent.convertToWorldSpaceAR(o)),a.zIndex=1,a.active=!0,a.stopAllActions(),a.runAction(cc.repeatForever(cc.sequence(cc.spawn(cc.moveBy(.3,cc.v2(0,-30)).easing(cc.easeIn(3)),cc.scaleTo(.3,1,1)),cc.spawn(cc.moveBy(.4,cc.v2(0,30)),cc.scaleTo(.4,.9,1)))))}else a.active=!1}),this.showRoad()},showRoad:function(){var e=[];app.expeditionInfo.canAttack.forEach(function(t){var a="line_"+app.expeditionInfo.row+"_"+app.expeditionInfo.pos+"_"+t;e.push(a)}),this.p_roadNode.children.forEach(function(t){t.active=-1!==e.indexOf(t.name)})},getNextCanAttack:function(){var e=app.expeditionInfo.row,t=app.expeditionInfo.pos,a=[],i=e+1,n=!1;if(void 0!==app.expeditionInfo.map[i]&&(app.expeditionInfo.map[i].forEach(function(e,t){if(1==e.state)return n=!0,void a.push(t)}),!n))if(-1==e)app.expeditionInfo.map[i].forEach(function(e,t){a.push(t)});else{var r=app.expeditionInfo.map[i].length;3==r?0==t?(a.push(0),a.push(1)):(a.push(1),a.push(2)):2==r?0==t?a.push(0):1==t?(a.push(0),a.push(1)):a.push(1):a.push(0)}app.expeditionInfo.canAttack=a},hideArrow:function(){this.p_arrowsNode.forEach(function(e){e.active=!1})},setMark:function(e){this.p_markNode.active=e},getNextTime:function(){this._nexttime=app.expeditionInfo.nextreftime,this.Rtime=!0},update:function(e){this.time>1?(this.refreshTime(),this.time=0):this.time+=e},refreshTime:function(){var e=this;if(this.Rtime){if(this._nexttime<=app.player.getServerTime())return this.time=-3,void app.player.sfExpedInfo(function(t,a){if(t)app.showNotice(langMgr.getString("expeditionPage",6));else{if("expeditionpage"!==app.arrPages[app.arrPages.length-1]){var i=app.arrPages[app.arrPages.length-1];app.pages[i].instance&&app.pages[i].instance.onClose()}app.pages.expeditionpage.getExpeditionInfo(a),e.setParam()}});this.p_labTime.string=gUtils.getHourMinSecTime((this._nexttime-app.player.getServerTime())/1e3),this.p_passTime&&(this.p_passTime.string=gUtils.getHourMinSecTime((this._nexttime-app.player.getServerTime())/1e3))}},onDestroy:function(){this._super()},onClose:function(e){void 0===e&&(e=!1);var t=!1;if(app.expeditionInfo&&app.expeditionInfo.row==app.expeditionInfo.map.length-1&&void 0!==app.expeditionInfo.map[app.expeditionInfo.map.length-1][0].finish&&void 0===app.expeditionInfo.finish&&(t=!0),t&&!e){var a={content:langMgr.getString("expeditionPage",9),confirmcb:function(){app.pages.expeditionpage.instance.onClose(!0)},target:this};app.pages.windowspagetipsmsg.showPage(a,this.node)}else this._super()}});a.refreshRed=function(e){var t=!1;return app.db.checkFuncUnLock("MAZE",!1)&&null==localDataUtils.GetValue("expeditionred",null)&&(t=!0),e&&(e.active=t),t},a.showPage=function(){app.db.checkFuncUnLock("MAZE",!0)&&e("basePage").showPage.call(this,!0)},a.getExpeditionInfo=function(e){app.expeditionInfo=e;for(var t={},a=0;a<app.expeditionInfo.tempgeneral.length;++a){var i=app.player.dealGeneral(app.expeditionInfo.tempgeneral[a]);t[i.guid]=i}app.expeditionInfo.tempgeneral=t},cc._RF.pop()},{basePage:void 0}],expeditionStatuePage:[function(e,t){"use strict";cc._RF.push(t,"ee6acL0jSFI0KYxx/5lRhcy","expeditionStatuePage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"expeditionstatuepage"},properties:{p_arrButton:[cc.Button]},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){for(var e=this,t=function(t){e.p_arrButton[t].node.on("click",function(){app.playSound("click"),0==t?app.pages.expeditionblesspage.showPage():app.pages.expeditiontreatmentpage.showPage(t+1)})},a=0;a<this.p_arrButton.length;++a)t(a)}});cc._RF.pop()},{basePage:void 0}],expeditionTreatmentPage:[function(e,t){"use strict";cc._RF.push(t,"4da65tjZ1NJO7VGvR+SAG1a","expeditionTreatmentPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"expeditiontreatmentpage"},properties:{p_nodeTreat:cc.Node,p_nodeTreaTips:cc.Node,p_nodeReviveTips:cc.Node,p_nodeRevive:cc.Node,p_btnUse:cc.Button,p_pfbItem:cc.Prefab,p_nodeContent:cc.Node,p_labCost:cc.Label,p_labCoin:cc.Label,p_btnAdd:cc.Button},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.m_arrItems=[]},handleUI:function(){var e=this;this.p_btnUse.node.on("click",function(){app.playSound("click"),e.onUse()})},setParam:function(e){this._type=e,this.refreshUI()},refreshUI:function(){this.p_labCoin.string=gUtils.showNum(app.player.getCount(38009)),this.p_nodeTreat.active=2==this._type,this.p_nodeTreaTips.active=2==this._type,this.p_nodeRevive.active=3==this._type,this.p_nodeReviveTips.active=3==this._type;var e=app.db.getStatueCostByType(this._type);this._max=e.length,this._useCount=app.player.getCount(2==this._type?90155:90156),this._cost=e[Math.min(e.length-1,this._useCount)],this.p_labCost.string=this._cost;var t=app.expedinfo.info.hp,a=[];for(var i in t)2==this._type&&t[i]<gConfig.saveHp&&t[i]>0?a.push(i):3==this._type&&t[i]<=0&&a.push(i);for(var n=0;n<a.length;++n){var r=this.m_arrItems[n];r||((r=cc.instantiate(this.p_pfbItem)).parent=this.p_nodeContent,this.m_arrItems.push(r)),r.active=!0,r.getComponent("generalTreatItem").refreshUI(a[n],t[a[n]],this)}for(var o=a.length;o<this.m_arrItems.length;++o)this.m_arrItems[o].active=!1;this.m_lastChoose=null},choose:function(e,t){this.m_lastChoose&&this.m_lastChoose.getComponent("generalTreatItem").setPick(!1),this.m_lastChoose=t,this._guid=e},cancel:function(){this.m_lastChoose&&this.m_lastChoose.getComponent("generalTreatItem").setPick(!1),this._guid=null},onUse:function(){var e=this;this._guid?this._useCount>=this._max?app.showNotice(langMgr.getString("expeditionTreatmentPage",1)):app.player.getCount(38009)<this._cost?app.showNotice(langMgr.getString("expeditionTreatmentPage",2)):app.player.sfExpedStatue({type:this._type,general:this._guid},function(t){app.expedinfo.info.hp=t.hp,app.showNotice(2==e._type?langMgr.getString("expeditionTreatmentPage",3):langMgr.getString("expeditionTreatmentPage",4)),e.cancel(),app.player.reduceItem({gsid:38009,count:e._cost});var a=2==e._type?90155:90156;app.player.addItem({gsid:a,count:1}),e.refreshUI()}):app.showNotice(langMgr.getString("expeditionTreatmentPage",0))}});cc._RF.pop()},{basePage:void 0}],fiveWarAnnoPage:[function(e,t){"use strict";cc._RF.push(t,"c623dvGuThJyaUd3BsAWq/+","fiveWarAnnoPage");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=cc._decorator,o=r.ccclass,s=r.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_nodeContents=[],t.p_nodePlayer=null,t.p_labTitle=null,t.p_editAnno=null,t.p_btnOk=null,t.p_btnSearch=null,t.p_btnChanage=null,t.p_editSearch=null,t.p_nodeCommander=null,t.p_nodeMenuLayout=null,t.curIndex=0,t.m_bCommander=!1,t.m_searchPlayer=null,t.m_canClick=!1,t.m_curAnno="",t}var a;return i(t,e),a=t,t.prototype.onEnable=function(){e.prototype.onEnable.call(this),eventMgr.on(eventStr.fiveWar.ReferenceFiveWarAnno,this.referenceFiveWarAnno,this),eventMgr.on(eventStr.fiveWar.GiveWarRight,this.giveWarRight,this)},t.prototype.onDisable=function(){e.prototype.onDisable.call(this),eventMgr.off(eventStr.fiveWar.ReferenceFiveWarAnno,this.referenceFiveWarAnno,this),eventMgr.off(eventStr.fiveWar.GiveWarRight,this.giveWarRight,this)},t.prototype.onLoad=function(){a.instance=this,e.prototype.onLoad.call(this),e.prototype.stopBgNodeEvent.call(this),e.prototype.creatMask.call(this,!0),this.m_menu=this.node.getComponent("menu"),this.m_menu.init(this)},t.prototype.handleUI=function(){var t=this;e.prototype.handleUI.call(this),this.p_btnOk.node.on("click",function(){if(t.m_canClick)if(app.playSound("click"),t.p_editAnno.string.length<=0)app.showNotice(langMgr.getString("fivewarannopage",2));else if(t.p_editAnno.string!=t.m_curAnno){var e={};e.anno=t.p_editAnno.string,app.player.sfSetWarAnno(e,function(e){e?app.showNotice(langMgr.getString("fivewarannopage",4)):(app.showNotice(langMgr.getString("fivewarannopage",5)),t.m_curAnno=t.p_editAnno.string)})}else app.showNotice(langMgr.getString("fivewarannopage",3))}),this.p_btnSearch.node.on("click",function(){if(t.m_canClick){t.p_nodeCommander.active=!1,t.m_searchPlayer=null,app.playSound("click");var e=t.p_editSearch.string;app.player.rname!=e?t.p_editSearch.string.length<=0?app.showNotice(langMgr.getString("fivewarannopage",7)):(t.m_canClick=!1,app.player.sfGetSearch(e,function(e,a){t.m_canClick=!0,e||a.length<=0?app.showNotice(langMgr.getString("fivewarannopage",8)):(t.p_nodeCommander.active=!0,t.m_searchPlayer=a[0],t.p_nodeCommander.getComponent("modPlayerInfo").init(a[0],t))})):app.showNotice(langMgr.getString("fivewarannopage",6))}}),this.p_btnChanage.node.on("click",function(){if(t.m_canClick){app.playSound("click");var e={content:langMgr.getString("fivewarannopage",9,t.m_searchPlayer.rname),confirmcb:function(){t.toChange()},target:t};app.pages.windowspagetipsmsg.showPage(e)}})},t.prototype.setParam=function(){var e=this;this.m_bCommander=app.fiveWarInfo.isCommander(),this.m_canClick=!1,app.player.sfFiveWarAnno();var t={rids:[app.fiveWarInfo.rid]};app.player.sfGetRolesInfo(t,function(t){e.m_canClick=!0,e._CommanderData=t[0],e.m_menu.setMenuIndex(1)})},t.prototype.menuHandler=function(e){return!!this.m_canClick&&(this.curIndex=e,this.refreshUI(),!0)},t.prototype.refreshUI=function(){var e=this;this.p_nodeContents.forEach(function(t,a){t.active=e.curIndex==a}),this.p_labTitle.string=langMgr.getString("fivewarannopage",this.curIndex),this.p_nodePlayer.getComponent("playerPortraitItem").refreshUI(this._CommanderData,this._target),this.p_editAnno.enabled=this.m_bCommander,this.p_btnOk.node.active=this.m_bCommander,this.p_nodeMenuLayout.active=this.m_bCommander,this.p_nodeCommander.active=!!this.m_searchPlayer},t.prototype.referenceFiveWarAnno=function(e){cc.log(e),e.err?this.p_editAnno.string="":this.p_editAnno.string=this.m_curAnno=e.data.anno||""},t.prototype.toChange=function(){this.m_canClick=!1,app.player.sfGiveWarRight({changerid:this.m_searchPlayer.id})},t.prototype.giveWarRight=function(e){this.m_canClick=!0,e.err?app.showNotice(langMgr.getString("fivewarannopage",10)):(app.showNotice(langMgr.getString("fivewarannopage",11)),app.fiveWarInfo.rid=this.m_searchPlayer.id,this.m_searchPlayer=null,this.setParam())},t.prefabPath="fivewarannopage",t.pageType=1,n([s([cc.Node])],t.prototype,"p_nodeContents",void 0),n([s(cc.Node)],t.prototype,"p_nodePlayer",void 0),n([s(cc.Label)],t.prototype,"p_labTitle",void 0),n([s(cc.EditBox)],t.prototype,"p_editAnno",void 0),n([s(cc.Button)],t.prototype,"p_btnOk",void 0),n([s(cc.Button)],t.prototype,"p_btnSearch",void 0),n([s(cc.Button)],t.prototype,"p_btnChanage",void 0),n([s(cc.EditBox)],t.prototype,"p_editSearch",void 0),n([s(cc.Node)],t.prototype,"p_nodeCommander",void 0),n([s(cc.Node)],t.prototype,"p_nodeMenuLayout",void 0),a=n([o],t)}(e("basePage"));t.exports=p,cc._RF.pop()},{basePage:void 0}],fiveWarBattlesetPage:[function(e,t){"use strict";cc._RF.push(t,"518351TuLBOsI6gOHlViGJt","fiveWarBattlesetPage");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=cc._decorator,o=r.ccclass,s=r.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_generalContent=null,t.p_pfbGeneralItem=null,t.p_nodePower=null,t.p_btnSetLineup=null,t.p_btnSetCamp=null,t.p_labSetCamp=null,t.p_btnDissolution=null,t.p_labBsetName=null,t.p_labTip=null,t.m_arrGeneral=[],t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},t.prototype.handleUI=function(){var e=this;this.p_btnSetCamp.node.on("click",function(){app.fiveWarInfo.mysettlement[e.m_nIndex]?app.showNotice(langMgr.getString("fivewarbattlesetpage",0)):3==app.fiveWarInfo.getState()||2==app.fiveWarInfo.getState()&&app.fiveWarInfo.nextroundtime<app.player.getServerTime()?app.showNotice(langMgr.getString("fivewarbattlesetpage",5)):(e._target.doSetShow&&e._target.doSetShow(),e.onClose())}),this.p_btnSetLineup.node.on("click",function(){app.fiveWarInfo.isNoCanSetLineup()?app.showNotice(langMgr.getString("fivewarbattlesetpage",1)):(app.battleType="nationwar",app.nationCampIndex=e.m_nIndex,app.goToNormBattle())}),this.p_btnDissolution.node.on("click",function(){if(app.playSound("click"),0!=app.fiveWarInfo.getState())if(1!==app.fiveWarInfo.getState()||app.fiveWarInfo.nextroundtime-app.player.getServerTime()<=18e5)app.showNotice("\u5f53\u524d\u4e3a\u6307\u6325\u5b98\u64cd\u4f5c\u65f6\u95f4");else{var t=e.m_nIndex;app.player.sfNationRecallArmy({teamid:t}).then(function(a){var i=a.leftnum;delete app.fiveWarInfo.mysettlement[t],eventMgr.emit(eventStr.fiveWar["CAMP_"+t],i),eventMgr.emit(eventStr.fiveWar.RECALL_TEAM,i),cc.isValid(e)&&(e.refreshUI(),e.refreshBtn())}).catch(function(e){cc.warn("\u64a4\u56de\u961f\u4f0d\u9519\u8bef\uff1a",e)})}})},t.prototype.onEnable=function(){e.prototype.onEnable.call(this),eventMgr.on(eventStr.fiveWar.SET_CHANGE,this.refreshUI,this)},t.prototype.onDisable=function(){e.prototype.onDisable.call(this),eventMgr.off(eventStr.fiveWar.SET_CHANGE,this.refreshUI,this)},t.prototype.setParam=function(e){this.m_data=e,this.m_nIndex=e.index,this.m_type=e.type,this._target=e.target,this.refreshUI(),this.refreshBtn()},t.prototype.refreshUI=function(){this.p_labBsetName.string=langMgr.getString("fivewartocamppage",this.m_nIndex);var e="other"!=this.m_type?app.player.battlearr["nationwar"+this.m_nIndex]:this.m_data.bset,t=0,a=0;for(var i in e.team){var n=null;if("string"==typeof e.team[i]){if(!app.player.general[e.team[i]])continue;n=app.player.general[e.team[i]]}else n=e.team[i];var r=this.m_arrGeneral[t];r||((r=cc.instantiate(this.p_pfbGeneralItem)).parent=this.p_generalContent,this.m_arrGeneral.push(r)),a+=n.power||0,r.active=!0,r.getComponent("generalPortraitItem").initForTips(n),t++}this.p_nodePower.getComponent("num").init(a);for(var o=t;o<this.m_arrGeneral.length;o++)this.m_arrGeneral[o].active=!1},t.prototype.refreshBtn=function(){var e="other"!=this.m_type&&(app.fiveWarInfo.mysettlement[this.m_nIndex]||3==app.fiveWarInfo.getState());this.p_btnSetCamp.interactable=!e,this.p_labSetCamp.node.active=e,e&&(this.p_labSetCamp.string=langMgr.getString("fivewarbattlesetpage",{front_left:2,front_right:3,back_left:4,back_right:5,pre:6}[app.fiveWarInfo.mysettlement[this.m_nIndex]])),this.p_btnSetCamp.node.parent.active="other"!=this.m_type,this.p_btnDissolution.node.active="other"!=this.m_type&&(app.fiveWarInfo.mysettlement[this.m_nIndex]||3==app.fiveWarInfo.getState())},t.prefabPath="fivewarbattlesetpage",t.pageType=1,n([s(cc.Node)],t.prototype,"p_generalContent",void 0),n([s(cc.Prefab)],t.prototype,"p_pfbGeneralItem",void 0),n([s(cc.Node)],t.prototype,"p_nodePower",void 0),n([s(cc.Button)],t.prototype,"p_btnSetLineup",void 0),n([s(cc.Button)],t.prototype,"p_btnSetCamp",void 0),n([s(cc.Label)],t.prototype,"p_labSetCamp",void 0),n([s(cc.Button)],t.prototype,"p_btnDissolution",void 0),n([s(cc.Label)],t.prototype,"p_labBsetName",void 0),n([s(cc.Label)],t.prototype,"p_labTip",void 0),a=n([o],t)}(e("basePage"));t.exports=p,cc._RF.pop()},{basePage:void 0}],fiveWarCampOutPage:[function(e,t){"use strict";cc._RF.push(t,"b7a1as1PvFOB7KezYrwd1xJ","fiveWarCampOutPage");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=cc._decorator,o=r.ccclass,s=r.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_labCampName=null,t.p_labCamp=null,t.p_labTeam=null,t.p_labAgainst=null,t.p_labState=null,t.p_nodeView=null,t.p_btnCancel=null,t.p_btnEnter=null,t.p_btnSort=null,t.p_labTip=null,t._viewState=0,t._chooseIndex=-1,t._nowIndex=0,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},t.prototype.handleUI=function(){var t=this;e.prototype.handleUI.call(this),this.p_btnCancel.node.active=!1,this.p_btnCancel.node.on("click",function(){t.onClickCancel()}),this.p_btnEnter.node.on("click",function(){app.pages.fivewarjoinpage.showPage(t.m_objData)}),this.p_btnSort.node.active=!1,this.p_btnSort.node.on("click",function(){t.onClickSort()})},t.prototype.onEnable=function(){e.prototype.onEnable.call(this),eventMgr.on(eventStr.fiveWar.CAMP_INFO,this.refreshUI,this),eventMgr.on(eventStr.fiveWar.CAMP_REFRESH,this.refreshInfo,this)},t.prototype.onDisable=function(){e.prototype.onDisable.call(this),eventMgr.off(eventStr.fiveWar.CAMP_INFO,this.refreshUI,this),eventMgr.off(eventStr.fiveWar.CAMP_REFRESH,this.refreshInfo,this)},t.prototype.setParam=function(e){this.m_objData=e,this._areas=e.road;var t=app.fiveWarInfo.isCommander();this.p_btnCancel.node.active=t,this.p_btnSort.node.active=t,this.p_labTip.node.active=t,app.player.sfWarCampInfo(e)},t.prototype.refreshInfo=function(e){e&&e.set==this.m_objData.set&&e.index==this.m_objData.index&&app.player.sfWarCampInfo(this.m_objData)},t.prototype.refreshUI=function(e){this.m_arrData=[],this._nowIndex=0;for(var t=0;t<e.team.length;++t)if(!(e.team[t].state&&e.team[t].state>1)){this._nowIndex=t;break}for(t=this._nowIndex;t<e.team.length;++t)this.m_arrData.push(e.team[t]);for(t=0;t<this._nowIndex;++t)this.m_arrData.push(e.team[t]);this.p_nodeView.getComponent("tableView").initTableView(this.m_arrData.length,{array:this.m_arrData,target:this});var a="left"==this.m_objData.index?0:1;this.p_labCampName.string=gUtils.getServNameForShow(app.fiveWarInfo.getAreaInfo(0).servid)+langMgr.getString("fivewarcampoutpage",{front:0,back:1}[this.m_objData.set]),this.p_labCamp.string=langMgr.getString("fivewarcampoutpage",{left:2,right:3}[this.m_objData.index],this.m_arrData.length);var i=this.getEnemy(),n="front"==this.m_objData.set?"back":"front";this.p_labAgainst.string=gUtils.getServNameForShow(i.servid),this.p_labTeam.string=langMgr.getString("fivewarcampoutpage",{front:4,back:6}[n]+a,i.team[n][a]),this.p_labState.string=langMgr.getString("fivewarcampoutpage",app.fiveWarInfo.state+7)},t.prototype.getEnemy=function(){return app.fiveWarInfo.aliveArr.length<=2?app.fiveWarInfo.getAreaInfo(app.fiveWarInfo.aliveArr[1]):"front"==this.p_campSet?app.fiveWarInfo.getAreaInfo(app.fiveWarInfo.aliveArr[1]):app.fiveWarInfo.getAreaInfo(app.fiveWarInfo.aliveArr[app.fiveWarInfo.aliveArr.length-1])},t.prototype.allsetState=function(){for(var e=this.p_nodeView.getComponent("tableView").content.children,t=0;t<e.length;++t)for(var a=e[t].children,i=0;i<a.length;++i)cc.isValid(a[i])&&a[i].activeInHierarchy&&a[i].getComponent("fiveWarTeamItem").refreshState()},t.prototype.deleteOne=function(e,t){var a=this,i=e;e=this._nowIndex+e;var n={areamark:app.fiveWarInfo.myareamark,set:this.m_objData.set,index:this.m_objData.index,posindex:e,toteam:"pre"};app.player.sfCommanderSet(n,function(e){"invalid move team time"===e&&app.showNotice("\u6bcf\u8f6e\u6218\u6597\u5f00\u6218\u524d30\u5206\u949f\u53ef\u8fdb\u884c\u961f\u4f0d\u7684\u6d3e\u9063"),cc.isValid(a.node)&&(a.m_arrData.splice(i,1),a._viewState=0,a.p_nodeView.getComponent("tableView").initTableView(a.m_arrData.length,{array:a.m_arrData,target:a}),a.p_labCamp.string=langMgr.getString("fivewarcampoutpage",{left:2,right:3}[a.m_objData.index],a.m_arrData.length),app.player.sfGetGroundInfo({road:a._areas}),t===app.player.id&&app.player.sfWarBaseInfo(function(){cc.isValid(app.pages.fivewargroundpage.instance)&&app.pages.fivewargroundpage.instance.refreshCamp()}))})},t.prototype.swapTeam=function(e){var t=this,a=this._nowIndex+e,i=this._nowIndex+this._chooseIndex,n={areamark:app.fiveWarInfo.myareamark,set:this.m_objData.set,index:this.m_objData.index,team:[a,i]};app.player.sfSwapTeamPos(n,function(){if(cc.isValid(t.node)){var e=t.m_arrData[a];t.m_arrData[a]=t.m_arrData[i],t.m_arrData[i]=e,t._viewState=0,t._chooseIndex=-1,t.p_nodeView.getComponent("tableView").initTableView(t.m_arrData.length,{array:t.m_arrData,target:t})}})},t.prototype.onClickCancel=function(){var e=app.fiveWarInfo.getState();1==e&&app.fiveWarInfo.nextroundtime-app.player.getServerTime()<=18e5||2===e?(1==this._viewState?this._viewState=0:this._viewState=1,this._chooseIndex=-1,this.allsetState()):app.showNotice("\u5f53\u524d\u4e3a\u73a9\u5bb6\u64cd\u4f5c\u65f6\u95f4")},t.prototype.onClickSort=function(){2==this._viewState||3==this._viewState?this._viewState=0:this._viewState=2,this._chooseIndex=-1,this.allsetState()},t.prototype.onClickItemSort=function(e){2==this._viewState?(this._chooseIndex=e,this._viewState=3):(this._viewState=2,this._chooseIndex=-1),this.allsetState()},t.prefabPath="fivewarcampoutpage",t.pageType=1,n([s(cc.Label)],t.prototype,"p_labCampName",void 0),n([s(cc.Label)],t.prototype,"p_labCamp",void 0),n([s(cc.Label)],t.prototype,"p_labTeam",void 0),n([s(cc.Label)],t.prototype,"p_labAgainst",void 0),n([s(cc.Label)],t.prototype,"p_labState",void 0),n([s(cc.Node)],t.prototype,"p_nodeView",void 0),n([s(cc.Button)],t.prototype,"p_btnCancel",void 0),n([s(cc.Button)],t.prototype,"p_btnEnter",void 0),n([s(cc.Button)],t.prototype,"p_btnSort",void 0),n([s(cc.Label)],t.prototype,"p_labTip",void 0),a=n([o],t)}(e("basePage"));t.exports=p,cc._RF.pop()},{basePage:void 0}],fiveWarCampPrePage:[function(e,t){"use strict";cc._RF.push(t,"531e8cGYwNIBIdcJ9luhyYp","fiveWarCampPrePage");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=cc._decorator,o=r.ccclass,s=r.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_labTimeTitle=null,t.p_labTime=null,t.p_proHp=null,t.p_labHp=null,t.p_labHpLang=null,t.p_labTotalTeam=null,t.p_labPreTeam=null,t.p_nodeView=null,t.p_btnLookFront=null,t.p_labFront=null,t.p_btnLookBack=null,t.p_labLookBack=null,t.p_btnEnter=null,t.p_labTitle=null,t.m_servInfo=null,t.m_frontArea=null,t.m_backArea=null,t.m_arrData=[],t.m_set="pre",t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.p_labTitle.string=langMgr.getString("fivewarcampprepage",3)},t.prototype.handleUI=function(){var t=this;e.prototype.handleUI.call(this),this.p_btnLookFront.node.on("click",function(){app.playSound("click"),e.prototype.onClose.call(t),app.pages.fivewargroundpage.showPage({areas:[t.m_servInfo.areamark,t.m_frontArea.areamark]})}),this.p_btnLookBack.node.on("click",function(){app.playSound("click"),e.prototype.onClose.call(t),app.pages.fivewargroundpage.showPage({areas:[t.m_backArea.areamark,t.m_servInfo.areamark]})}),this.p_btnEnter.node.on("click",function(){app.playSound("click"),app.pages.fivewarjoinpage.showPage(t.m_objData)})},t.prototype.onEnable=function(){e.prototype.onEnable.call(this),eventMgr.on(eventStr.fiveWar.CAMP_INFO,this.refreshUI,this),eventMgr.on(eventStr.commonEvent.RefreshTime,this.refreshTime,this),eventMgr.on(eventStr.fiveWar.CAMP_REFRESH,this.refreshInfo,this)},t.prototype.onDisable=function(){e.prototype.onDisable.call(this),eventMgr.off(eventStr.fiveWar.CAMP_INFO,this.refreshUI,this),eventMgr.off(eventStr.fiveWar.CAMP_REFRESH,this.refreshInfo,this),eventMgr.off(eventStr.commonEvent.RefreshTime,this.refreshTime,this)},t.prototype.setParam=function(){this.m_servInfo=app.fiveWarInfo.getAreaInfo(0),this.m_objData={set:this.m_set,areamark:app.fiveWarInfo.myareamark},app.player.sfWarCampInfo(this.m_objData)},t.prototype.refreshInfo=function(e){e&&e.set==this.m_objData.set&&app.player.sfWarCampInfo(this.m_objData)},t.prototype.refreshUI=function(e){this.m_arrData=[];for(var t=0;t<e.team.length;++t)this.m_arrData.push(e.team[t]);this.p_nodeView.getComponent("tableView").initTableView(this.m_arrData.length,{array:this.m_arrData,target:this});var a=this.m_servInfo.nowhp/this.m_servInfo.maxhp;this.p_proHp.progress=a,this.p_labHp.string=Math.min(100,Math.floor(100*a))+"%",this.p_labHpLang.string=this.m_servInfo.nowhp+"/"+this.m_servInfo.maxhp;var i=0;for(var n in this.m_servInfo.team)this.m_servInfo.team[n].forEach(function(e){i+=e});this.p_labTotalTeam.string=i.toString(),this.p_labPreTeam.string=langMgr.getString("fivewarcampprepage",0,this.m_arrData.length),this.m_frontArea=this.getFrontarea(),this.p_btnLookFront.node.active=this.p_labFront.node.active=!!this.m_frontArea,this.m_frontArea&&(this.p_labFront.string=langMgr.getString("fivewarcampprepage",1,gUtils.getServNameForShow(this.m_frontArea.servid))),this.m_backArea=this.getBackarea(),this.p_btnLookBack.node.active=this.p_labLookBack.node.active=!!this.m_backArea,this.m_backArea&&(this.p_labLookBack.string=langMgr.getString("fivewarcampprepage",2,gUtils.getServNameForShow(this.m_backArea.servid)))},t.prototype.getFrontarea=function(){var e=app.fiveWarInfo.getAreaInfo(app.fiveWarInfo.aliveArr[1]);return app.fiveWarInfo.aliveArr.length<=2&&e.pos<this.m_servInfo.pos?null:e},t.prototype.getBackarea=function(){var e=app.fiveWarInfo.getAreaInfo(app.fiveWarInfo.aliveArr[app.fiveWarInfo.aliveArr.length-1]);return app.fiveWarInfo.aliveArr.length<=2&&e.pos>this.m_servInfo.pos?null:e},t.prototype.refreshTime=function(){var e=app.fiveWarInfo.getCountTime();this.p_labTimeTitle.string=e.title+": ",this.p_labTime.string=e.diff},t.prefabPath="fivewarcampprepage",t.pageType=1,n([s(cc.Label)],t.prototype,"p_labTimeTitle",void 0),n([s(cc.Label)],t.prototype,"p_labTime",void 0),n([s(cc.ProgressBar)],t.prototype,"p_proHp",void 0),n([s(cc.Label)],t.prototype,"p_labHp",void 0),n([s(cc.Label)],t.prototype,"p_labHpLang",void 0),n([s(cc.Label)],t.prototype,"p_labTotalTeam",void 0),n([s(cc.Label)],t.prototype,"p_labPreTeam",void 0),n([s(cc.Node)],t.prototype,"p_nodeView",void 0),n([s(cc.Button)],t.prototype,"p_btnLookFront",void 0),n([s(cc.Label)],t.prototype,"p_labFront",void 0),n([s(cc.Button)],t.prototype,"p_btnLookBack",void 0),n([s(cc.Label)],t.prototype,"p_labLookBack",void 0),n([s(cc.Button)],t.prototype,"p_btnEnter",void 0),n([s(cc.Label)],t.prototype,"p_labTitle",void 0),a=n([o],t)}(e("basePage"));p.showPage=function(){app.fiveWarInfo.aliveArr.indexOf(0)<0||e("basePage").showPage.call(this,!0)},t.exports=p,cc._RF.pop()},{basePage:void 0}],fiveWarGroundPage:[function(e,t){"use strict";cc._RF.push(t,"bbb1bOmrFhMZLvR2QIuK9d0","fiveWarGroundPage");var a,i,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),r=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},o=cc._decorator,s=o.ccclass,p=o.property,c=e("basePage"),h=[{x:-341,y:-305},{x:-248,y:-232},{x:-137,y:-150},{x:-49,y:-74},{x:54,y:2},{x:133,y:67}],l=[{x:-144,y:-412},{x:-51,y:-339},{x:59,y:-257},{x:147,y:-180},{x:250,y:-104},{x:330,y:-39}],g={front_left:"p_nodeFrontCampL",front_right:"p_nodeFrontCampR",back_left:"p_nodeBackCampL",back_right:"p_nodeBackCampR"};(function(e){e[e.NoseOut=0]="NoseOut",e[e.EdgeOut=1]="EdgeOut",e[e.Whup=2]="Whup",e[e.Retire=3]="Retire",e[e.DoubleKill=4]="DoubleKill",e[e.TripleKill=5]="TripleKill",e[e.QuadraKill=6]="QuadraKill"})(i||(i={}));var d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_nodeMap=null,t.p_btnHelp=null,t.p_arrSers=[],t.p_labTimeTip=null,t.p_labTime=null,t.p_nodeFrontCampL=null,t.p_nodeFrontCampR=null,t.p_nodeBackCampL=null,t.p_nodeBackCampR=null,t.p_nodeFiveOver=null,t.p_nodeFiveOverTouch=null,t.p_nodeTeamId=null,t.p_arrTeam=[],t.p_pfbTeam=null,t.p_arrNumSprite=[],t.p_nodeArrow=null,t.p_pfbNum=null,t.m_TeamPool=new cc.NodePool,t.m_frontleft=[],t.m_frontright=[],t.m_backleft=[],t.m_backright=[],t._areas=[],t.m_arrArrow=[],t._teamIdArr=[],t}var a;return n(t,e),a=t,t.prototype.onEnable=function(){e.prototype.onEnable.call(this),eventMgr.on(eventStr.fiveWar.GROUND_INFO,this.refreshUI,this),eventMgr.on(eventStr.commonEvent.RefreshTime,this.refreshTime,this),eventMgr.on(eventStr.fiveWar.GROUND_CHANGE,this.dealNextStep,this),eventMgr.on(eventStr.fiveWar.SERV_CAMP,this.onRefreshCampChange,this)},t.prototype.onDisable=function(){e.prototype.onDisable.call(this),eventMgr.off(eventStr.fiveWar.GROUND_INFO,this.refreshUI,this),eventMgr.off(eventStr.commonEvent.RefreshTime,this.refreshTime,this),eventMgr.off(eventStr.fiveWar.GROUND_CHANGE,this.dealNextStep,this),eventMgr.off(eventStr.fiveWar.SERV_CAMP,this.onRefreshCampChange,this)},t.prototype.onLoad=function(){a.instance=this,e.prototype.onLoad.call(this),this._teamIdArr.push(this.p_nodeTeamId),this.p_nodeArrow.active=!1,this.m_arrArrow.push(this.p_nodeArrow)},t.prototype.handleUI=function(){var t=this;e.prototype.handleUI.call(this),this.p_nodeMap.on("touchmove",function(e){t.moveMapByTouch(e)}),this.p_nodeMap.on("touchend",function(){t.closeArrow()}),this.p_nodeFrontCampL.on("touchend",function(){t.closeArrow(),app.fiveWarInfo.myareamark==t._areas[0]&&app.pages.fivewarcampoutpage.showPage({set:"front",index:"left",road:t._areas})}),this.p_nodeFrontCampR.on("touchend",function(){t.closeArrow(),app.fiveWarInfo.myareamark==t._areas[0]&&app.pages.fivewarcampoutpage.showPage({set:"front",index:"right",road:t._areas})}),this.p_nodeBackCampL.on("touchend",function(){t.closeArrow(),app.fiveWarInfo.myareamark==t._areas[1]&&app.pages.fivewarcampoutpage.showPage({set:"back",index:"left",road:t._areas})}),this.p_nodeBackCampR.on("touchend",function(){t.closeArrow(),app.fiveWarInfo.myareamark==t._areas[1]&&app.pages.fivewarcampoutpage.showPage({set:"back",index:"right",road:t._areas})}),this.p_btnHelp.node.on("click",function(){app.playSound("click"),app.pages.windowspagetipshelp.showPage("1124")},this),this.p_nodeFiveOverTouch.on("touchend",function(){t.p_nodeFiveOver.active=!1})},t.prototype.setParam=function(e){this.p_nodeFiveOver.active=3==app.fiveWarInfo.getState(),this._areas=e.areas,app.player.sfGetGroundInfo({road:e.areas}),this.initMapPos(),this.refreshCamp(),e.isEnter&&this.doSetShow()},t.prototype.moveMapByTouch=function(e){if(e.getLocation){var t=e.getStartLocation(),a=e.getLocation();if(!(Math.abs(a.x-t.x)<=6&&Math.abs(a.y-t.y))){this.m_isMove=!0;var i=this.p_nodeMap.x,n=this.p_nodeMap.y,r=e.getDelta();this.setNodeMove(i,n,r.x,r.y)}}},t.prototype.setNodeMove=function(e,t,a,i){var n=this.p_nodeMap.width/2-cc.winSize.width/2,r=-this.p_nodeMap.width/2+cc.winSize.width/2,o=this.p_nodeMap.height/2-cc.winSize.height/2,s=-this.p_nodeMap.height/2+cc.winSize.height/2;e+=a,t+=i,e=Math.min(n,e),e=Math.max(r,e),t=Math.min(o,t),t=Math.max(s,t),this.p_nodeMap.x=e,this.p_nodeMap.y=t},t.prototype.initMapPos=function(){var e=this.p_nodeMap.x,t=this.p_nodeMap.y;if(app.fiveWarInfo.myareamark==this._areas[1]){var a=-150-this.p_nodeMap.x,i=20-this.p_nodeMap.y;this.setNodeMove(e,t,a,i)}else a=150-this.p_nodeMap.x,i=183-this.p_nodeMap.y,this.setNodeMove(e,t,a,i)},t.prototype.refreshUI=function(){if(app.fiveWarInfo.myareamark==this._areas[0]||app.fiveWarInfo.myareamark==this._areas[1]){var e=app.fiveWarInfo.myareamark==this._areas[0]?"front":"back";eventMgr.emit(eventStr.fiveWar.CAMP_REFRESH,{set:e,index:"left"}),eventMgr.emit(eventStr.fiveWar.CAMP_REFRESH,{set:e,index:"right"})}this.refreshServGround(),this.refreshCampShow()},t.prototype.refreshCampShow=function(){var e=app.fiveWarInfo.getWarGround(),t=e.getAreaInfo(this._areas[0]);this.refreshCampLabel(this.p_nodeFrontCampL,t.front.left,t.servid),this.refreshCampLabel(this.p_nodeFrontCampR,t.front.right,t.servid),t=e.getAreaInfo(this._areas[1]),this.refreshCampLabel(this.p_nodeBackCampL,t.back.left,t.servid),this.refreshCampLabel(this.p_nodeBackCampR,t.back.right,t.servid)},t.prototype.refreshCampLabel=function(e,t,a){e.getChildByName("lab_num").getComponent(cc.Label).string=Number(t.alive)+"/"+Number(t.max),e.getChildByName("lab_serv").getComponent(cc.Label).string=gUtils.getServNameForShow(a)},t.prototype.onRefreshCampChange=function(){this.refreshCampShow();for(var e=app.fiveWarInfo.getWarGround(),t=0;t<this._areas.length;++t){var a=this._areas[t],i=e.getAreaInfo(a);this.p_arrSers[t].getComponent("warServMod").initInfo(i,a)}},t.prototype.refreshServGround=function(){for(var e=this,t=app.fiveWarInfo.getWarGround(),a=0;a<this._areas.length;++a){var i=this._areas[a],n=t.getAreaInfo(i);this.p_arrSers[a].getComponent("warServMod").initInfo(n,i);var r=0==a?"front":"back",o=t.getGround(i,r),s=0==a?-1:-6;this["m_"+r+"left"].length>0&&this["m_"+r+"left"].forEach(function(t){t.active=!1,e.putTeamNode(t)}),this["m_"+r+"left"]=[];for(var p=0;p<o.left.length;++p){(d=this.getTeamNode()).parent=this.p_nodeMap;var c=o.left[p],g=h[Math.abs(c.pos+s)];this["m_"+r+"left"].push(d),d.getComponent("warGeneralItem").initInfo(c,a,g,this)}for(this["m_"+r+"right"].length>0&&this["m_"+r+"right"].forEach(function(t){t.active=!1,e.putTeamNode(t)}),this["m_"+r+"right"]=[],p=0;p<o.right.length;++p){var d;(d=this.getTeamNode()).parent=this.p_nodeMap,c=o.right[p],g=l[Math.abs(c.pos+s)],this["m_"+r+"right"].push(d),d.getComponent("warGeneralItem").initInfo(c,a,g,this)}}},t.prototype.getTeamNode=function(){var e;return(e=this.m_TeamPool.size()>0?this.m_TeamPool.get():cc.instantiate(this.p_pfbTeam)).opacity=255,e.active=!0,e},t.prototype.putTeamNode=function(e){this.m_TeamPool.put(e)},t.prototype.dealNextStep=function(e){this.onRefreshCampChange();var t=app.fiveWarInfo.getWarGround(),a=t.judgeOneRoadAction("left",e.front.left,e.back.left),i=t.judgeOneRoadAction("right",e.front.right,e.back.right);this.doSthByAction(a,"left",e.front,e.back),this.doSthByAction(i,"right",e.front,e.back),t.setGroundTeamData("front",e.front),t.setGroundTeamData("back",e.back)},t.prototype.doSthByAction=function(e,t,a,i){switch(e){case 1:this.attackCity("front",t,i[t]);break;case 2:this.attackCity("back",t,a[t]);break;case 3:this.doAttack(t,a[t],i[t]);break;case 4:this.moveAction("front",t,a[t]);break;case 5:this.moveAction("back",t,i[t]);break;case 6:this.moveAction("front",t,a[t]),this.moveAction("back",t,i[t])}},t.prototype.moveAction=function(e,t,a){var i=this;this["m_"+e+t].forEach(function(i,n){var r=a[n];if(r){var o="front"==e?-1:-6,s=("left"==t?h:l)[Math.abs(r.pos+o)];i.getComponent("warGeneralItem").goToNextPos(r,s)}}),this.scheduleOnce(function(){a.length>i["m_"+e+t].length&&i.createOneTeam(e,t,a[a.length-1])},3)},t.prototype.createOneTeam=function(e,t,a){var i=this.getTeamNode();i.parent=this.p_nodeMap;var n="front"==e?-1:-6,r=("left"==t?h:l)[Math.abs(a.pos+n)];i.getComponent("warGeneralItem").initInfo(a,"front"==e?0:1,r,this),this["m_"+e+t].push(i)},t.prototype.attackCity=function(e,t,a){var n,r=this;null===(n=this["m_"+e+t][0])||void 0===n||n.getComponent("warGeneralItem").doAttack(),this.scheduleOnce(function(){var a;null===(a=r["m_"+e+t][0])||void 0===a||a.getComponent("warGeneralItem").resetState();var n=r["m_"+e+t].shift();null==n||n.getComponent("warGeneralItem")._playResultAnim(i.Retire),null==n||n.getComponent("warGeneralItem").doDisappear(),r.actionHurm("front"==e?"back":"front",t)},1.5),this.scheduleOnce(function(){r.moveAction("front"==e?"back":"front",t,a)},3.6)},t.prototype.actionHurm=function(e,t){cc.log(e,t,"\u88ab\u653b\u57ce\u4e86\u4e00\u4e0b");var a=cc.instantiate(this.p_pfbNum);a.parent=this[g[e+"_"+t]],a.setPosition(0,130);var i=app.fiveWarInfo.getWarGround(),n="front"==e?"back":"front",r=i.ground[i[n+"mark"]][n][t+"attackcity"]||0;a.getComponent("battlewords").initContent("yellow_small","-"+r.toString());var o=cc.sequence(cc.spawn(cc.moveBy(1.5,cc.v2(0,70)),cc.scaleTo(.1,.8),cc.sequence(cc.fadeTo(.2,255),cc.delayTime(1),cc.fadeTo(.3,0))),cc.callFunc(function(){a.destroy()}));a.runAction(o)},t.prototype.doAttack=function(e,t,a){var n=this;try{this["m_front"+e][0].getComponent("warGeneralItem").doAttack(),this["m_back"+e][0].getComponent("warGeneralItem").doAttack()}catch(c){cc.warn(c)}var r=app.fiveWarInfo.getWarGround(),o=r.report[e][r.report[e].length-1];if(o&&o.btime+1e4==r.nexttime){var s="win"==o.result?t[0].hpper||1e4:0,p="win"!=o.result?a[0].hpper||1e4:0;try{this["m_front"+e][0].getComponent("warGeneralItem")._playHpAnim(s/1e4,3),this["m_back"+e][0].getComponent("warGeneralItem")._playHpAnim(p/1e4,3)}catch(c){cc.warn(c)}}this.scheduleOnce(function(){n.doResetState(e);var r=app.fiveWarInfo.getWarGround(),o=r.report[e][r.report[e].length-1];if(o&&o.btime+1e4==r.nexttime){var s,p="win"==o.result?"front":"back",h="front"==p?t[0].hpper:a[0].hpper;s=h>=7e3?i.Whup:h>=3e3?i.EdgeOut:i.NoseOut;try{n["m_"+p+e][0].getComponent("warGeneralItem")._playResultAnim(s)}catch(c){cc.warn(c)}var l=n["m_"+("front"==p?"back":"front")+e].shift();null==l||l.getComponent("warGeneralItem").doDisappear(),n.scheduleOnce(function(){n.moveAction(p,e,"front"==p?t:a)},2.5)}},3)},t.prototype.doResetState=function(e){try{this["m_front"+e][0].getComponent("warGeneralItem").resetState(),this["m_back"+e][0].getComponent("warGeneralItem").resetState()}catch(t){cc.warn(t)}},t.prototype.refreshCamp=function(){var e=this;if(app.fiveWarInfo.myareamark==this._areas[0]||app.fiveWarInfo.myareamark==this._areas[1]){var t=app.fiveWarInfo.myareamark==this._areas[0]?"front":"back",a=app.fiveWarInfo.mysettlement||{},i=0;for(var n in a)if(a[n].split("_")[0]==t){var r=this._teamIdArr[i];r||(r=cc.instantiate(this.p_nodeTeamId)),r.parent=this[g[a[n]]].getChildByName("team_layout"),r.setPosition(0,0),r.active=!0,r.getChildByName("num").getComponent(cc.Sprite).spriteFrame=this.p_arrNumSprite[Number(n)-1],i++}for(o=i;o<this._teamIdArr.length;++o)this._teamIdArr[o].active=!1;this.p_arrTeam.forEach(function(t,a){t.opacity=255,t.active=!0,t.getComponent("nationCampItem").initUI(a+1,e)})}else{this.p_arrTeam.forEach(function(e){e.opacity=0,e.active=!1});for(var o=0;o<this._teamIdArr.length;++o)this._teamIdArr[o].active=!1}},t.prototype.refreshTime=function(){if(this.refreshTipTime(),!app._sfFiveWarGround&&!(1==app.fiveWarInfo.getState()&&app.fiveWarInfo.nextroundtime<app.player.getServerTime()||3==app.fiveWarInfo.getState())){var e=app.fiveWarInfo.getWarGround();e&&e.isNexttimeOver()&&app.player.sfGetGroundInfo({road:this._areas})}},t.prototype.refreshTipTime=function(){var e=app.fiveWarInfo.getCountTime();this.p_labTimeTip.string=e.title,this.p_labTime.string=e.diff},t.prototype.doSetShow=function(){var e=app.fiveWarInfo.myareamark==this._areas[0]?"front":"back";this.initMapPos();for(var t=["left","right"],a=0;a<t.length;++a){var i=this.m_arrArrow[a];i||(i=cc.instantiate(this.p_nodeArrow),this.m_arrArrow.push(i)),i.parent=this[g[e+"_"+t[a]]],i.active=!0,i.setPosition(0,100)}for(a=t.length;a<this.m_arrArrow.length;++a)this.m_arrArrow[a].active=!1},t.prototype.closeArrow=function(){this.m_arrArrow.forEach(function(e){e.active=!1})},t.prototype.onClose=function(){e.prototype.onClose.call(this),app.fiveWarInfo.destroyWarGround()},t.prefabPath="fivewargroundpage",r([p(cc.Node)],t.prototype,"p_nodeMap",void 0),r([p(cc.Button)],t.prototype,"p_btnHelp",void 0),r([p(cc.Node)],t.prototype,"p_arrSers",void 0),r([p(cc.Label)],t.prototype,"p_labTimeTip",void 0),r([p(cc.Label)],t.prototype,"p_labTime",void 0),r([p(cc.Node)],t.prototype,"p_nodeFrontCampL",void 0),r([p(cc.Node)],t.prototype,"p_nodeFrontCampR",void 0),r([p(cc.Node)],t.prototype,"p_nodeBackCampL",void 0),r([p(cc.Node)],t.prototype,"p_nodeBackCampR",void 0),r([p(cc.Node)],t.prototype,"p_nodeFiveOver",void 0),r([p(cc.Node)],t.prototype,"p_nodeFiveOverTouch",void 0),r([p(cc.Node)],t.prototype,"p_nodeTeamId",void 0),r([p([cc.Node])],t.prototype,"p_arrTeam",void 0),r([p(cc.Prefab)],t.prototype,"p_pfbTeam",void 0),r([p([cc.SpriteFrame])],t.prototype,"p_arrNumSprite",void 0),r([p(cc.Node)],t.prototype,"p_nodeArrow",void 0),r([p(cc.Prefab)],t.prototype,"p_pfbNum",void 0),a=r([s],t)}(c);t.exports=d,cc._RF.pop()},{basePage:void 0}],fiveWarJoinPage:[function(e,t){"use strict";cc._RF.push(t,"04a140iyHhGyaAsWaU7Rmgm","fiveWarJoinPage");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=cc._decorator,o=r.ccclass,s=r.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_arrCamp=[],t.p_arrbtnCamp=[],t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},t.prototype.onEnable=function(){e.prototype.onEnable.call(this),eventMgr.on(eventStr.fiveWar.CAMP_REFRESH,this.refreshUI,this)},t.prototype.onDisable=function(){e.prototype.onDisable.call(this),eventMgr.off(eventStr.fiveWar.CAMP_REFRESH,this.refreshUI,this)},t.prototype.handleUI=function(){var e=this;this.p_arrbtnCamp.forEach(function(t,a){t.node.on("click",function(){e.onClick(a+1)})})},t.prototype.setParam=function(e){this.m_objData=e,this.refreshUI()},t.prototype.refreshUI=function(){var e=this;this.p_arrCamp.forEach(function(t,a){t.getComponent("nationCampItem").initUI(a+1,e)}),this.p_arrbtnCamp.forEach(function(e,t){e.node.active=!app.player.isBattlearrEmpty("nationwar"+(t+1))})},t.prototype.onClick=function(e){if(app.fiveWarInfo.mysettlement[e])app.showNotice(langMgr.getString("fivewarbattlesetpage",0));else if(app.player.battlearr["nationwar"+e])if(3==app.fiveWarInfo.getState()||2==app.fiveWarInfo.getState()&&app.fiveWarInfo.nextroundtime<app.player.getServerTime())app.showNotice(langMgr.getString("fivewarbattlesetpage",7));else{var t={};for(var a in this.m_objData)t[a]=this.m_objData[a];t.teamid=e,app.player.sfSetTeamToCamp(t,function(a){if(a)app.showNotice(a);else{app.showNotice("\u5165\u9a7b\u6210\u529f");var i="";t.set&&(i+=t.set),t.index&&(i+="_"+t.index),app.fiveWarInfo.mysettlement[e]=i,eventMgr.emit(eventStr.fiveWar["CAMP_"+e]),eventMgr.emit(eventStr.fiveWar.CAMP_REFRESH,t),app.player.sfWarCampInfo(t)}})}else app.showNotice(langMgr.getString("fivewarbattlesetpage",8))},t.prefabPath="fivewarjoinpage",t.pageType=1,n([s([cc.Node])],t.prototype,"p_arrCamp",void 0),n([s([cc.Button])],t.prototype,"p_arrbtnCamp",void 0),a=n([o],t)}(e("basePage"));t.exports=p,cc._RF.pop()},{basePage:void 0}],fiveWarMainPage:[function(e,t){"use strict";cc._RF.push(t,"c18d0oy66xEOL86HXjMSxaN","fiveWarMainPage");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=cc._decorator,o=r.ccclass,s=r.property,p=e("basePage"),c=e("langMgr"),h={"01":{pos:{x:-129,y:43},rotation:40,width:300},"02":{pos:{x:-68,y:-87},rotation:70,width:550},"03":{pos:{x:88,y:-142},rotation:-70,width:550},12:{pos:{x:-229,y:-239},rotation:-80,width:300},13:{pos:{x:-43,y:-203},rotation:-38,width:500},14:{pos:{x:0,y:-81},rotation:0,width:300},23:{pos:{x:0,y:-405},rotation:0,width:300}},l={"01":{pos:[{x:-137,y:90},{x:-77,y:60},{x:-181,y:52},{x:-122,y:22}],0:{x:0,y:10},1:{x:0,y:10}},"02":{pos:[{x:-98,y:-46},{x:-20,y:-52},{x:-120,y:-105},{x:-40,y:-112}],0:{x:0,y:10},1:{x:0,y:10}},"03":{pos:[{x:45,y:-124},{x:112,y:-111},{x:69,y:-189},{x:146,y:-171}],0:{x:0,y:10},1:{x:0,y:10}},12:{pos:[{x:-271,y:-198},{x:-190,y:-192},{x:-263,y:-251},{x:-181,y:-246}],0:{x:0,y:10},1:{x:0,y:10}},13:{pos:[{x:-92,y:-199},{x:-31,y:-160},{x:-40,y:-236},{x:14,y:-194}],0:{x:0,y:0},1:{x:0,y:10}},14:{pos:[{x:-38,y:-44},{x:-38,y:-110},{x:43,y:-44},{x:43,y:-110}],0:{x:0,y:10},1:{x:0,y:10}},23:{pos:[{x:-35,y:-362},{x:-35,y:-430},{x:38,y:-362},{x:38,y:-430}],0:{x:0,y:10},1:{x:0,y:10}}},g={"04":"01",34:"12","03":"02",24:"13"},d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_btnIntro=null,t.p_btnReward=null,t.p_btnRank=null,t.p_btnAnno=null,t.p_btnTips=null,t.p_labTimeTitle=null,t.p_labTime=null,t.p_labBattlelive=null,t.p_arrReport=[],t.p_arrReportLabelColor=[],t.p_arrReportLabelOutColor=[],t.p_arrReportChildLabelColor=[],t.p_arrReportChildLabelOutColor=[],t.p_arrKingdom=[],t.p_arrTeam=[],t.p_nodeLine=null,t.p_nodeArmy=null,t.p_nodeArrow=null,t.m_arrLine=[],t.m_arrArmy=[],t.m_armyIndex=0,t.m_arrTouch=[],t.m_arrArrow=[],t.m_step=0,t.m_stepLimit=60,t.rewardsShow={OPEN_REWARD:!1,ROUND_REWARD:!1,FINAL_REWARD:!1},t}var a;return i(t,e),a=t,t.prototype.onEnable=function(){e.prototype.onEnable.call(this),eventMgr.on(eventStr.fiveWar.REFRESH_BASE,this.refreshUI,this),eventMgr.on(eventStr.commonEvent.RefreshTime,this.refreshTime,this)},t.prototype.onDisable=function(){e.prototype.onDisable.call(this),eventMgr.off(eventStr.fiveWar.REFRESH_BASE,this.refreshUI,this),eventMgr.off(eventStr.commonEvent.RefreshTime,this.refreshTime,this)},t.prototype.onLoad=function(){a.instance=this,e.prototype.onLoad.call(this),e.prototype.fitTopMenu.call(this),this.m_arrLine.push(this.p_nodeLine),this.m_arrArmy.push(this.p_nodeArmy),this.p_nodeArrow.active=!1,this.m_arrArrow.push(this.p_nodeArrow)},t.prototype.handleUI=function(){var t=this;e.prototype.handleUI.call(this),this.p_btnIntro.node.on("click",function(){app.playSound("click"),t.closeArrow(),app.pages.fiveWarIntroducePage.showPage()}),this.p_btnReward.node.on("click",function(){app.playSound("click"),t.closeArrow(),app.pages.nationwarrewardpage.showPage()}),this.p_btnRank.node.on("click",function(){app.playSound("click"),t.closeArrow(),app.pages.nationwarrankpage.showPage()}),this.p_btnTips.node.on("click",function(){app.playSound("click"),app.pages.windowspagetipshelp.showPage("1124")}),this.p_btnAnno.node.on("click",function(){app.playSound("click"),t.closeArrow(),app.pages.fivewarannopage.showPage()}),this.p_arrKingdom.forEach(function(e,a){e.on("touchend",function(){t.closeArrow(),app.fiveWarInfo?0==a?app.pages.fivewarcampprepage.showPage():app.pages.fivewarservpage.showPage(a):app.showNotice(c.getString("fivewarmainpage",0))})})},t.prototype.setParam=function(){app.player.sfWarBaseInfo()},t.prototype.refreshUI=function(){this.refreshKingdom(),this.refreshCamp(),this.refreshReport(),this.refreshRewards()},t.prototype.refreshTime=function(){if(app.fiveWarInfo){var e=app.fiveWarInfo.getCountTime();if(this.p_labTimeTitle.string=e.title,this.p_labTime.string=e.diff,!(app.player._sfFiveWarBase||3==app.fiveWarInfo.getState()&&app.player.getServerTime()<app.fiveWarInfo.nextroundtime))return app.player.getServerTime()>app.fiveWarInfo.nextroundtime?(this.m_step=0,void app.player.sfWarBaseInfo()):void(this.m_step>=this.m_stepLimit?(this.m_step=0,app.player.sfWarBaseInfo()):this.m_step++)}},t.prototype.refreshKingdom=function(){var e=this;this.p_arrKingdom.forEach(function(t,a){t.getComponent("fiveWarCity").refreshUI(app.fiveWarInfo.areas[a],a,e)}),this.getNowLine()},t.prototype.getNowLine=function(){for(var e=this,t=app.fiveWarInfo.aliveArr,a={},i=0;i<t.length;++i)i+1<t.length?a[""+t[i]+t[i+1]]=i:t.length>2&&(a[""+t[0]+t[i]]=i);var n=0;this.m_armyIndex=0;var r=function(t){var i=o.m_arrLine[n];i||((i=cc.instantiate(o.p_nodeLine)).parent=o.p_nodeLine.parent,o.m_arrLine.push(i)),i.active=!0;var r=h[t],s=1;r||(r=h[g[t]],s=-1),o.setArmyPosByLine(t,s),i.setPosition(r.pos.x*s,r.pos.y),i.width=r.width,i.angle=r.rotation*s;var p=o.m_arrTouch[n];if(!p){p=new cc.Node,o.m_arrTouch.push(p);var c=new cc.Node;c.name="anim",c.parent=p,c.setPosition(0,50),c.addComponent(cc.Sprite),c.addComponent(cc.Animation),c.active=!1}p.targetOff(o),p.width=90,p.height=90,p.parent=i.parent.parent;var l=i.convertToWorldSpaceAR(cc.Vec2.ZERO),d=i.parent.parent.convertToNodeSpaceAR(l);p.setPosition(d);var u=a[t];p.on("touchend",function(){e.goToGround(u),e.closeArrow()},o),n++},o=this;for(var s in a)r(s);for(i=n;i<this.m_arrLine.length;++i)this.m_arrLine[i].active=!1;for(i=this.m_armyIndex;i<this.m_arrArmy.length;++i)this.m_arrArmy[i].active=!1;this.playBattleAnim(2==app.fiveWarInfo.getState())},t.prototype.setArmyPosByLine=function(e){var t=l[e],a=1;if(t||(t=l[g[e]],a=-1),t){var i,n=app.fiveWarInfo.aliveArr,r=app.fiveWarInfo.getAreaInfo(e[0]),o=app.fiveWarInfo.getAreaInfo(e[1]),s=n.indexOf(Number(e[0])),p=n.indexOf(Number(e[1]));i=n.length>2?Math.abs(s-p)==n.length-1?["back","front"]:s<p?["front","back"]:["back","front"]:r.pos<o.pos?["front","back"]:["back","front"];for(var c=0;c<4;++c){var h=this.m_arrArmy[this.m_armyIndex];if(h||((h=cc.instantiate(this.p_nodeArmy)).parent=this.p_nodeArmy.parent,this.m_arrArmy.push(h)),this.m_armyIndex++,h.active=!0,a>0||g[e][0]==e[0])h.setPosition(t.pos[c].x*a,t.pos[c].y);else{var d=(c+2)%4;h.setPosition(t.pos[d].x*a,t.pos[d].y)}var u=h.getChildByName("lab_node");u.setPosition(t[c%2].x*a,t[c%2].y),u.getChildByName("label_num").getComponent(cc.Label).string=c<2?r.team[i[0]][c%2]||0:o.team[i[1]][c%2]||0;var f=c<2?e[0]:e[1];app.loadTexture(gConfig.rootPath.uiimagenation+"wjzz_pepole_"+["red","green","purple","yellow","blu"][f],h.getComponent(cc.Sprite),this)}}},t.prototype.playBattleAnim=function(e){this.m_arrTouch.forEach(function(t){var a=t.getChildByName("anim");e?(a.active=!0,app.loadEff("fight_anim",a.getComponent(cc.Animation),2,1,1,14)):a.active=!1})},t.prototype.refreshCamp=function(){var e=this;this.p_arrTeam.forEach(function(t,a){t.getComponent("nationCampItem").initUI(a+1,e)})},t.prototype.goToGround=function(e){var t,a=app.fiveWarInfo.aliveArr,i=[],n=app.fiveWarInfo.getAreaInfo(a[e]);if(2==a.length){var r=app.fiveWarInfo.getAreaInfo(a[1]);n.pos<r.pos?(i.push(n.areamark),i.push(r.areamark)):(i.push(r.areamark),i.push(n.areamark))}else i.push(n.areamark),e<a.length-1?(n=app.fiveWarInfo.getAreaInfo(a[e+1]),i.push(n.areamark)):(n=app.fiveWarInfo.getAreaInfo(a[0]),i.push(n.areamark));app.pages.fivewargroundpage.showPage({areas:i,isEnter:null===(t=this.m_arrArrow[0])||void 0===t?void 0:t.active})},t.prototype.doSetShow=function(){if(app.fiveWarInfo.getAreaInfo(0).isout)app.showNotice(c.getString("fivewarmainpage",1));else{var e=app.fiveWarInfo.aliveArr,t=[];e.length>2?(t.push(""+e[0]+e[1]),t.push(""+e[0]+e[e.length-1])):t.push(""+e[0]+e[1]),this.m_arrArrow[0].active=!0;for(var a=0;a<t.length;++a){var i=t[a],n=h[i],r=1;n||(n=h[g[i]],r=-1);var o=this.m_arrArrow[a+1];o||((o=cc.instantiate(this.p_nodeArrow)).parent=this.p_nodeArrow.parent,this.m_arrArrow.push(o)),o.active=!0,o.setPosition(n.pos.x*r,n.pos.y+50)}for(a=t.length+1;a<this.m_arrArrow.length;++a)this.m_arrArrow[a].active=!1}},t.prototype.closeArrow=function(){this.m_arrArrow.forEach(function(e){e.active=!1})},t.prototype.refreshReport=function(){var e=this;if(app.fiveWarInfo){var t=app.fiveWarInfo.areas.map(function(e){return{servid:e.servid,nowhp:e.nowhp,isout:e.isout}});t.sort(function(e,t){return 0==e.isout&&0==t.isout?e.nowhp==t.nowhp?e.servid-t.servid:t.nowhp-e.nowhp:0==e.isout||0==t.isout?e.isout-t.isout:t.isout-e.isout}),this.p_arrReport.forEach(function(a,i){var n=t[i];if(n){a.node.active=!0;var r=0;n.isout>0&&(r=n.isout==app.fiveWarInfo.round?1:2),a.string=gUtils.getServNameForShow(n.servid),a.node.color=e.p_arrReportLabelColor[r],a.node.getComponent(cc.LabelOutline).color=e.p_arrReportLabelOutColor[r];var o=a.node.getComponentInChildren(cc.Label),s=n.nowhp>999999?gUtils.showCoinNum(n.nowhp):n.nowhp;o.string=c.getString("fivewarmainpage",2,s),o.node.color=e.p_arrReportChildLabelColor[r],o.node.getComponent(cc.LabelOutline).color=e.p_arrReportChildLabelOutColor[r]}else a.node.active=!1})}},t.prototype.refreshRewards=function(){if(app.fiveWarInfo)if(app.fiveWarInfo.rewards&&app.fiveWarInfo.rewards.length>0&&app.arrPages[app.arrPages.length-1]==this.prefabPath)if(app.fiveWarInfo.rewards.indexOf("open")>=0)this.rewardsShow.OPEN_REWARD||(app.pages.nationwarrewardopenpage.showPage(),this.rewardsShow.OPEN_REWARD=!0);else switch(app.fiveWarInfo.rewards[0]){case"open":this.rewardsShow.OPEN_REWARD||(app.pages.nationwarrewardopenpage.showPage(),this.rewardsShow.OPEN_REWARD=!0);break;case"audi":this.rewardsShow.ROUND_REWARD||(app.pages.nationwarrewardroundpage.showPage("audi"),this.rewardsShow.ROUND_REWARD=!0);break;case"match":this.rewardsShow.ROUND_REWARD||(app.pages.nationwarrewardroundpage.showPage("match"),this.rewardsShow.ROUND_REWARD=!0);break;case"final":this.rewardsShow.FINAL_REWARD||(app.pages.nationwarrewardfinalpage.showPage(),this.rewardsShow.FINAL_REWARD=!0)}else this.rewardsShow.FINAL_REWARD||3!=app.fiveWarInfo.getState()||4!=app.fiveWarInfo.round||(app.pages.nationwarrewardfinalpage.showPage(),this.rewardsShow.FINAL_REWARD=!0)},t.prototype.onClose=function(){e.prototype.onClose&&e.prototype.onClose.call(this),cc.director.emit("EVT_REFRESH_MILITARY_RANK_DATA")},t.prefabPath="fivewarmainpage",n([s(cc.Button)],t.prototype,"p_btnIntro",void 0),n([s(cc.Button)],t.prototype,"p_btnReward",void 0),n([s(cc.Button)],t.prototype,"p_btnRank",void 0),n([s(cc.Button)],t.prototype,"p_btnAnno",void 0),n([s(cc.Button)],t.prototype,"p_btnTips",void 0),n([s(cc.Label)],t.prototype,"p_labTimeTitle",void 0),n([s(cc.Label)],t.prototype,"p_labTime",void 0),n([s(cc.Label)],t.prototype,"p_labBattlelive",void 0),n([s([cc.Label])],t.prototype,"p_arrReport",void 0),n([s([cc.Color])],t.prototype,"p_arrReportLabelColor",void 0),n([s([cc.Color])],t.prototype,"p_arrReportLabelOutColor",void 0),n([s([cc.Color])],t.prototype,"p_arrReportChildLabelColor",void 0),n([s([cc.Color])],t.prototype,"p_arrReportChildLabelOutColor",void 0),n([s([cc.Node])],t.prototype,"p_arrKingdom",void 0),n([s([cc.Node])],t.prototype,"p_arrTeam",void 0),n([s(cc.Node)],t.prototype,"p_nodeLine",void 0),n([s(cc.Node)],t.prototype,"p_nodeArmy",void 0),n([s(cc.Node)],t.prototype,"p_nodeArrow",void 0),a=n([o],t)}(p);t.exports=d,cc._RF.pop()},{basePage:void 0,langMgr:void 0}],fiveWarServPage:[function(e,t){"use strict";cc._RF.push(t,"c4d6cgTPPJE8b0rsrQKlKO/","fiveWarServPage");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=cc._decorator,o=r.ccclass,s=r.property,p=e("basePage"),c=e("langMgr"),h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_btnLeft=null,t.p_btnRight=null,t.p_sprFlag=null,t.p_labGuohao=null,t.p_labKingname=null,t.p_labTeam=null,t.p_labFrontLeft=null,t.p_labFrontRight=null,t.p_labBackLeft=null,t.p_labBackRight=null,t.p_labHp=null,t.p_pfbMember=null,t.p_labPreTeam=null,t.nodeListContent=null,t.p_labRightTip=null,t.p_labLeftTip=null,t.p_labTitle=null,t._areaInfo=null,t._memList=[],t._index=0,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},t.prototype.setParam=function(e){this._index=e,this.getNowAreaInfo()},t.prototype.getNowAreaInfo=function(){var e=this;this._areaInfo=app.fiveWarInfo.getAreaInfo(this._index),app.player.getOtherAreaInfo({areamark:this._areaInfo.areamark},function(t,a){e.refreshUI(t,a)})},t.prototype.refreshUI=function(e,t){var a,i;if(e)return"no open"===e&&app.showNotice(c.getString("nationWarMainPage",2)),void cc.warn("\u8bf7\u6c42\u56fd\u5bb6\u7687\u5ba4\u6210\u5458\u5217\u8868\u9519\u8bef",e);cc.log("fiveWarServPage refreshUI");for(var n=t,r=this._areaInfo.servid,o=0;o<n.palace.length;++o){var s=this._memList[o];cc.isValid(s)||(s=cc.instantiate(this.p_pfbMember),this._memList[o]=s,this.nodeListContent.addChild(s));var p=n.palace[o];s.getComponent("NationRoyalMemberItem")._refreshUI(p,o,r,this)}var h=null!==(i=null===(a=app.fiveWarInfo)||void 0===a?void 0:a.aliveArr)&&void 0!==i?i:[];h.length<=2&&h.sort(function(e,t){return app.fiveWarInfo.getAreaInfo(e).pos-app.fiveWarInfo.getAreaInfo(t)});var l=h.indexOf(this._index),g=l>=0;this.p_labTitle.string=""+gUtils.getServNameForShow(r),this.p_labGuohao.string="\u56fd\u53f7: "+n.name,app.loadTexture(app.db.getCountryFlagByIndex(this._areaInfo.flag),this.p_sprFlag,this.prefabPath),this.p_labHp.string=n.nowhp+"/"+n.maxhp,this.p_labKingname.string="\u56fd\u738b: "+n.palace[0].rname;var d=n.team.front[0],u=n.team.front[1],f=n.team.back[0],m=n.team.back[1],_=n.team.pre.reduce(function(e,t){return e+t},0);this.p_labFrontLeft.string=""+(g?d:0),this.p_labFrontRight.string=""+(g?u:0),this.p_labBackLeft.string=""+(g?f:0),this.p_labBackRight.string=""+(g?m:0),this.p_labPreTeam.string=""+(g?_:0),this.p_labTeam.string=""+(g?d+u+f+m+_:0);var v="",b="",y=-1,P=-1;g&&(2===h.length?0===l?P=l+1:l===h.length-1&&(y=l-1):h.length>2&&(0===l?(y=h.length-1,P=l+1):l===h.length-1?(y=l-1,P=0):(y=l-1,P=l+1))),-1!==y&&(b="\u540e\u519b\u5bf9\u9635"+gUtils.getServNameForShow(app.fiveWarInfo.getAreaInfo(h[y]).servid)+"\u524d\u519b"),-1!==P&&(v="\u524d\u519b\u5bf9\u9635"+gUtils.getServNameForShow(app.fiveWarInfo.getAreaInfo(h[P]).servid)+"\u540e\u519b"),this.p_labLeftTip.string=v,this.p_labRightTip.string=b},t.prefabPath="fivewarservpage",t.pageType=1,n([s(cc.Button)],t.prototype,"p_btnLeft",void 0),n([s(cc.Button)],t.prototype,"p_btnRight",void 0),n([s(cc.Sprite)],t.prototype,"p_sprFlag",void 0),n([s(cc.Label)],t.prototype,"p_labGuohao",void 0),n([s(cc.Label)],t.prototype,"p_labKingname",void 0),n([s(cc.Label)],t.prototype,"p_labTeam",void 0),n([s(cc.Label)],t.prototype,"p_labFrontLeft",void 0),n([s(cc.Label)],t.prototype,"p_labFrontRight",void 0),n([s(cc.Label)],t.prototype,"p_labBackLeft",void 0),n([s(cc.Label)],t.prototype,"p_labBackRight",void 0),n([s(cc.Label)],t.prototype,"p_labHp",void 0),n([s(cc.Prefab)],t.prototype,"p_pfbMember",void 0),n([s(cc.Label)],t.prototype,"p_labPreTeam",void 0),n([s(cc.Node)],t.prototype,"nodeListContent",void 0),n([s(cc.Label)],t.prototype,"p_labRightTip",void 0),n([s(cc.Label)],t.prototype,"p_labLeftTip",void 0),n([s(cc.Label)],t.prototype,"p_labTitle",void 0),a=n([o],t)}(p);t.exports=h,cc._RF.pop()},{basePage:void 0,langMgr:void 0}],fiveWartoCampPage:[function(e,t){"use strict";cc._RF.push(t,"54630hu7PJNgplzcPNKD9ik","fiveWartoCampPage");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=cc._decorator,o=r.ccclass,s=r.property,p=e("basePage"),c=function(){function e(){this.p_campSet="",this.p_campIndex=0,this.p_campNum=null,this.p_enemyServ=null,this.p_enemyCampNum=null,this.p_btnjoin=null,this.m_target=null}return e.prototype.handleUI=function(e){var t=this;this.m_target=e,this.p_btnjoin.node.on("click",function(){var e,a,i,n;app.playSound("click");var r={areamark:app.fiveWarInfo.myareamark,set:t.p_campSet,index:["left","right"][t.p_campIndex],posindex:t.m_target.m_data.teamIndex},o=null===(a=null===(e=t.m_target)||void 0===e?void 0:e.m_data)||void 0===a?void 0:a.teamid,s=null===(n=null===(i=t.m_target)||void 0===i?void 0:i.m_data)||void 0===n?void 0:n.rid;app.player.sfCommanderSet(r,function(e){var a;cc.isValid(t.m_target.node)&&(e?"invalid move team time"===e&&app.showNotice("\u6bcf\u8f6e\u6218\u6597\u5f00\u6218\u524d30\u5206\u949f\u53ef\u8fdb\u884c\u961f\u4f0d\u7684\u6d3e\u9063"):(app.showNotice(langMgr.getString("fivewartocamppage",4)),eventMgr.emit(eventStr.fiveWar.CAMP_REFRESH,{set:"pre"}),s===app.player.id&&(app.fiveWarInfo.mysettlement[o]=r.set+"_"+r.index,eventMgr.emit(eventStr.fiveWar["CAMP_"+o])),null===(a=t.m_target)||void 0===a||a.onClose()))})})},e.prototype.refreshUI=function(){var e=app.fiveWarInfo.getAreaInfo(0);this.p_campNum.string=e.team[this.p_campSet][this.p_campIndex];var t=this.getEnemy();this.p_enemyServ.string=gUtils.getServNameForShow(t.servid);var a="front"==this.p_campSet?"back":"front",i=0==this.p_campIndex?1:0;this.p_enemyCampNum.string=t.team[a][i],this.p_btnjoin.interactable=app.fiveWarInfo.aliveArr.length>2||app.fiveWarInfo.aliveArr.length<=2&&"back"==this.p_campSet&&e.pos>t.pos||app.fiveWarInfo.aliveArr.length<=2&&"front"==this.p_campSet&&e.pos<t.pos},e.prototype.getEnemy=function(){return app.fiveWarInfo.aliveArr.length<=2?app.fiveWarInfo.getAreaInfo(app.fiveWarInfo.aliveArr[1]):"front"==this.p_campSet?app.fiveWarInfo.getAreaInfo(app.fiveWarInfo.aliveArr[1]):app.fiveWarInfo.getAreaInfo(app.fiveWarInfo.aliveArr[app.fiveWarInfo.aliveArr.length-1])},n([s],e.prototype,"p_campSet",void 0),n([s],e.prototype,"p_campIndex",void 0),n([s(cc.Label)],e.prototype,"p_campNum",void 0),n([s(cc.Label)],e.prototype,"p_enemyServ",void 0),n([s(cc.Label)],e.prototype,"p_enemyCampNum",void 0),n([s(cc.Button)],e.prototype,"p_btnjoin",void 0),n([o("fiveWartoCampItem")],e)}(),h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_nodePlayer=null,t.p_labTeam=null,t.p_nodeGeneral=null,t.p_btnLook=null,t.p_arrWarToCampItems=[],t.labTitle=null,t.m_playerdata=null,t.m_data=null,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.labTitle.string=langMgr.getString("fivewartocamppage",5)},t.prototype.handleUI=function(){var t=this;e.prototype.handleUI.call(this),this.p_arrWarToCampItems.forEach(function(e){e.handleUI(t)}),this.p_btnLook.node.on("click",function(){app.playSound("click"),app.pages.fivewarbattlesetpage.showPage({index:t.m_data.teamid,bset:t.m_playerdata.battleset,type:"other",target:t._target})})},t.prototype.setParam=function(t){var a=this;cc.log(t),this.m_data=t,app.player.sfGetRolesInfo({rids:[t.rid],battleset:"nationwar"+t.teamid},function(t){if(cc.log(t),!t[0].battleset||!t[0].battleset.team)return app.showNotice(langMgr.getString("fivewartocamppage",0)),void e.prototype.onClose.call(a);a.m_playerdata=t[0],a.refreshUI()},this)},t.prototype.refreshUI=function(){var e=null,t=0;for(var a in this.m_playerdata.battleset.team){var i=this.m_playerdata.battleset.team[a];(!e||e.power<i.power)&&(e=i),t+=i.power}this.m_playerdata.power=t,this.p_nodePlayer.getComponent("playerPortraitItem").refreshUI(this.m_playerdata,this);var n=app.db.getGBaseByGsid(e.gsid);n&&this.p_nodeGeneral.getComponent("generalPortraitItem").initReport(n,e,this),this.p_labTeam.string=langMgr.getString("fivewartocamppage",this.m_data.teamid),this.p_arrWarToCampItems.forEach(function(e){e.refreshUI()})},t.prefabPath="fivewartocamppage",t.pageType=1,n([s(cc.Node)],t.prototype,"p_nodePlayer",void 0),n([s(cc.Label)],t.prototype,"p_labTeam",void 0),n([s(cc.Node)],t.prototype,"p_nodeGeneral",void 0),n([s(cc.Button)],t.prototype,"p_btnLook",void 0),n([s([c])],t.prototype,"p_arrWarToCampItems",void 0),n([s(cc.Label)],t.prototype,"labTitle",void 0),a=n([o],t)}(p);t.exports=h,cc._RF.pop()},{basePage:void 0}],friendAddExplorePage:[function(e,t){"use strict";cc._RF.push(t,"95bf8pjbWxMPpgI9Ws+A9GG","friendAddExplorePage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"friendaddexplorepage"},properties:{p_tabView:cc.ScrollView,p_nodeItem:cc.Node,p_labFriendNum:cc.Label,p_btnExplore:cc.Button,p_labPower:cc.Label,p_labMaxPower:cc.Label},handleUI:function(){var e=this,t=this;this.p_btnExplore.node.on("click",function(){if(app.playSound("click"),app.player.getCount(90264)>=e.m_maxqphys)app.showNotice(langMgr.getString("friendAddExplorePage",2));else if(e.m_power>=e.m_maxPower)if(e.m_numCountFriend>=e.m_numMaxFriend){var a=[];a.push(e.m_arrFriendId[0].id),a.push(e.m_arrFriendId[1].id),app.player.sfOpenExplore(e.m_chapterid,a,function(e,a){e?"no more"==e&&app.showNotice(langMgr.getString("friendAddExplorePage",2)):(app.showNotice(langMgr.getString("friendAddExplorePage",3)),t.m_objData.status=1,t.m_objData.friends=t.m_arrFriendId,t.m_objData.etime=a.etime,app.player.addItem({gsid:90264,count:1}),t.m_refreshUI&&t.m_refreshUI.apply(t.m_trage),t.m_receiveArr&&t.m_receiveArr.apply(t.m_target),t.onClose())})}else app.showNotice(langMgr.getString("friendAddExplorePage",4));else app.showNotice(langMgr.getString("friendAddExplorePage",4))})},onLoad:function(){a.instance=this,this.m_numMaxFriend=2,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},setParam:function(e){this.m_arrFriend=e.arrFriend,this.m_refreshUI=e.refreshUI,this.m_trage=e.trage,this.m_target=e.target,this.m_receiveArr=e.receiveArr,this.m_maxqphys=e.maxqphys,this.m_objData=e.objData,this.m_maxPower=this.m_objData.power,this.m_chapterid=this.m_objData.chapterid,this.m_arrFriendId=[],this.m_numCountFriend=0,this.m_index1=-1,this.m_index2=-1,this.refreshUI()},refreshUI:function(){this.refreshTView(this.m_arrFriend),this.m_power=app.player.power,this.upLabPower(),this.upLabMaxPower(),this.upLabFriendNum()},getAddExplore:function(){return!(this.m_numCountFriend>=this.m_numMaxFriend)},updateAddFriend:function(e,t){e?(-1==this.m_index1?(this.m_arrFriendId[0]=this.m_arrFriend[t],this.m_index1=t):-1==this.m_index2&&(this.m_arrFriendId[1]=this.m_arrFriend[t],this.m_index2=t),this.m_numCountFriend++,this.m_power+=this.m_arrFriend[t].power,this.upLabPower()):(this.m_numCountFriend--,t==this.m_index1?(this.m_arrFriendId[0]=null,this.m_index1=-1):t==this.m_index2&&(this.m_arrFriendId[1]=null,this.m_index2=-1),this.m_power-=this.m_arrFriend[t].power,this.upLabPower()),this.upLabFriendNum()},upLabPower:function(){var e=this.m_power;e>=1e4?(e=(e/=1e4).toFixed(1),this.p_labPower.string=langMgr.getString("friendAddExplorePage",0,e)):this.p_labPower.string=e},upLabMaxPower:function(){var e=this.m_maxPower;e>=1e4?(e/=1e4,this.p_labMaxPower.string=langMgr.getString("friendAddExplorePage",1,e)):this.p_labMaxPower.string="/"+e},upLabFriendNum:function(){this.p_labFriendNum&&(this.p_labFriendNum.string=this.m_numCountFriend+"/"+this.m_numMaxFriend)},refreshTView:function(e){this.m_arrItems||(this.m_arrItems=[],this.m_arrItems.push(this.p_nodeItem));for(var t=0;t<e.length;++t){var a=this.m_arrItems[t];a||((a=cc.instantiate(this.p_nodeItem)).parent=this.p_tabView.content,this.m_arrItems.push(a)),a.active=!0;var i={data:e[t],trget:this,getAddExplore:this.getAddExplore,updateAddFriend:this.updateAddFriend,index:t};a.getComponent("friendAddExploreItem").refreshUI(i,this)}for(var n=e.length;n<this.m_arrItems.length;++n)this.m_arrItems[n].active=!1}});cc._RF.pop()},{basePage:void 0}],friendAddFriendPage:[function(e,t){"use strict";cc._RF.push(t,"16355ZFBu9P2qB+l9NngU++","friendAddFriendPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"friendaddfriendpage",pageType:1},properties:{p_srcView:cc.ScrollView,p_nodeItem:cc.Node,p_btnLookup:cc.Button,p_editboxName:cc.EditBox,p_btnRefresh:cc.Button,p_btnAllAdd:cc.Button,p_nodeAdd:cc.Node,p_nodeChoose:cc.Node,p_sprTitle:cc.Sprite,p_arrTitle:[cc.SpriteFrame],p_labFriendCount:cc.Label},setParam:function(e){this.m_friendData=e,e.arrfriend&&(this.m_arrFriend=e.arrfriend),this.m_strShowType="add",this.m_menu.setMenuIndex(0)},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.m_menu=this.node.getComponent("menu"),this.m_menu.init(this)},onEnable:function(){this._super(),eventMgr.on(eventStr.redEvent.RefreshFriendPageAddRed,this.refreshUI,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.redEvent.RefreshFriendPageAddRed,this.refreshUI,this)},refreshUI:function(){if(this.m_friendData){var e=this.m_arrFriend.length,t=this.m_friendData.maxcount;this.p_labFriendCount.string=langMgr.getString("friendAddFriendPage",0,[e,t])}this.m_menu.refreshRed()},refreshMenuRed:function(e){var t=!1;return 1==e&&(t=app.pages.friendpage.checkApply()),t},menuHandler:function(e){switch(e){case 0:this.m_strShowType="add",this.p_sprTitle.spriteFrame=this.p_arrTitle[0],this._updateRecommendList();break;case 1:this.m_strShowType="choose",this.p_sprTitle.spriteFrame=this.p_arrTitle[1],this.p_nodeChoose.getComponent("friendPageApply").getNewData(this.m_friendData)}this.p_nodeAdd.active="add"==this.m_strShowType,this.p_nodeChoose.active="choose"==this.m_strShowType,this.refreshUI()},_updateRecommendList:function(){var e=this;app.player.sfGetRecommendList(function(t,a){t||(e.m_objData=a,e.refreshTView(e.m_objData,"recf"))})},refreshTView:function(e,t){this.m_arrItems||(this.m_arrItems=[],this.m_arrItems.push(this.p_nodeItem));for(var a=0;a<e.length;++a){var i=this.m_arrItems[a];i||((i=cc.instantiate(this.p_nodeItem)).parent=this.p_srcView.content,this.m_arrItems.push(i)),i.active=!0;var n={data:e[a],arrFriend:this.m_arrFriend,strType:t};i.getComponent("friendAddFriendItem").refreshUI(n,this)}for(var r=e.length;r<this.m_arrItems.length;++r)this.m_arrItems[r].active=!1},handleUI:function(){var e=this;this._super();var t=this;this.p_btnLookup.node.on("click",function(){app.playSound("click"),e.p_editboxName.string.length<=0?app.showNotice(langMgr.getString("friendAddFriendPage",3)):app.checkMatchStr(e.p_editboxName.string)?app.player.sfGetSearch(e.p_editboxName.string,function(a,i){a||(t.m_objData=i,t.refreshTView(e.m_objData,"lookup"))}):app.showNotice(langMgr.getString("friendAddFriendPage",4))}),this.p_btnRefresh&&this.p_btnRefresh.node.on("click",function(){app.playSound("click"),e._updateRecommendList()}),this.p_btnAllAdd&&this.p_btnAllAdd.node.on("click",function(){if(app.playSound("click"),app.checkMaxFriend())app.showNotice(langMgr.getString("friendAddFriendPage",5));else{var a=[];e.m_arrItems.forEach(function(e){var t=e.getComponent("friendItem");t.getIsClickAddBtn()||a.push(t.getFriendId())}),0==a.length?app.showNotice(langMgr.getString("friendAddFriendPage",6)):app.player.sfApply(a,function(e){e?"friend full"==e?app.showNotice(langMgr.getString("friendAddFriendPage",7)):"rfriend full"==e&&app.showNotice(langMgr.getString("friendAddFriendPage",8)):t.m_arrItems.forEach(function(e){e.getComponent("friendItem").waitAdopt()})})}})}});cc._RF.pop()},{basePage:void 0}],friendAllExplorePage:[function(e,t){"use strict";cc._RF.push(t,"547c0u506NODJNsJgLXY750","friendAllExplorePage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"friendallexplorepage"},properties:{p_tabView:cc.ScrollView,p_nodeItem:cc.Node,p_labCheckpointNum:cc.Label,p_btnExplore:cc.Button},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){var e=this,t=this;this.p_btnExplore.node.on("click",function(){app.playSound("click");var a=[];a.push(e.m_arr[0].id),a.push(e.m_arr[1].id),app.player.sfOpenExplore(e.m_chointData.chapterid,a,function(a,i){a||(app.showNotice(langMgr.getString("friendAllExplorePage",0)),app.player.addItem({gsid:90264,count:1}),t.m_chointData.friends=t.m_arr,t.m_chointData.status=1,t.m_chointData.etime=i.etime,e.m_receiveArr.apply(e.m_target),t.onClose())})})},setParam:function(e){null!=e&&(this.m_arr=e.arr,this.m_numExplore=e.numExplore,this.m_chointData=e.chointData,this.m_target=e.target,this.m_receiveArr=e.receiveArr,this.refreshTView(this.m_arr),this.upLabCheckpointNum())},upLabCheckpointNum:function(){this.p_labCheckpointNum&&(this.p_labCheckpointNum.string=gUtils.transformToChinese(this.m_numExplore+1))},refreshTView:function(e){if(null!=e){this.m_arrItems||(this.m_arrItems=[],this.m_arrItems.push(this.p_nodeItem));for(var t=0;t<e.length;++t){var a=this.m_arrItems[t];a||((a=cc.instantiate(this.p_nodeItem)).parent=this.p_tabView.content,this.m_arrItems.push(a)),a.active=!0,a.getComponent("friendAllExploreItem").refreshUI(e[t],this)}for(var i=e.length;i<this.m_arrItems.length;++i)this.m_arrItems[i].active=!1}},start:function(){}});cc._RF.pop()},{basePage:void 0}],friendCheckpointDetailsPage:[function(e,t){"use strict";cc._RF.push(t,"80d1a5Dfh5MDYVbRDQhgu0i","friendCheckpointDetailsPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"friendcheckpointdetailspage"},properties:{p_labPower:cc.Label,p_labTime:cc.Label,p_nodeArrPeop:cc.Node,p_sprExplore_icon:cc.Sprite,p_btnCheck:cc.Button,p_labCheckpointNum:cc.Label,p_btnExplore:cc.Button,p_arrHeadNode:[cc.Node]},handleUI:function(){var e=this,t=this;this.p_btnExplore.node.on("click",function(){if(app.playSound("click"),app.db.checkFuncUnLock("FRIENDTS",!0)){var a={arrFriend:e.m_arrFriend,objData:e.m_objData,refreshUI:e.refreshUI,trage:e,target:t.m_target,receiveArr:t.m_receiveArr,maxqphys:e.m_maxqphys};app.pages.friendaddexplorepage.showPage(a,app.mainScene.p_nodeBg)}}),this.p_btnCheck.node.on("click",function(){app.pages.windowspagetipsrewards.showPage(e.m_arrRewardsData,app.mainScene.p_nodeBg)})},getCheckPointData:function(){for(var e=app.db.getFchapterInfo(this.m_objData.chapterid),t=[],a=0;a<e.ITEMS.length;a++)if(e.ITEMS[a].GSID){var i={gsid:e.ITEMS[a].GSID};t.push(i)}for(var n=0;n<e.DROPS.length;n++)if(e.DROPS.ITEMS)for(var r=0;r<e.DROPS.ITEMS.length;r++)if(e.DROPS.ITEMS[n].GSID){var o={gsid:e.DROPS.ITEMS[n].GSID};t.push(o)}return t},setParam:function(e){this.m_objData=e.data,this.m_index=e.index,this.m_arrFriend=e.arrFriend,this.m_target=e.target,this.m_maxqphys=e.maxqphys,this.m_receiveArr=e.receiveArr,this.m_time=1,this.m_isTime=!1,this.refreshUI()},refreshUI:function(){if(this.upLabCheckpointNum(),0==this.m_objData.status||2==this.m_objData.status){this.p_nodeArrPeop.active=!1,this.m_isTime=!1,this.setLabTime(this.m_objData.exploremin),this.p_btnExplore.interactable=!0,this.p_sprExplore_icon.node.active=!0;var e=app.db.getFchapterInfo(this.m_objData.chapterid),t=gConfig.getIconFExplore(e.EPID);app.loadTexture(t,this.p_sprExplore_icon,this.prefabPath)}else 1==this.m_objData.status&&(this.p_nodeArrPeop.active=!0,this._updataArrHeadIcon(),this.m_isTime=!0,this._updataLabTime(),this.p_btnExplore.interactable=!1,this.p_sprExplore_icon.node.active=!1);this._updataPower(),this.m_arrRewardsData=this.getCheckPointData()},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},_updataArrHeadIcon:function(){var e={headid:app.player.headid,frameid:app.player.frameid,rid:app.player.id,level:app.player.level};this.p_arrHeadNode[2].getComponent("headItem").initByObjItem(e,this),this.p_arrHeadNode[2].getComponent("headItem").setClick(!0);for(var t=0;t<2;t++)this.p_arrHeadNode[t].getComponent("headItem").initByObjItem(this.m_objData.friends[t],this),this.p_arrHeadNode[t].getComponent("headItem").setClick(!0)},_updataPower:function(){if(0==this.m_objData.status)this.setLabPower(this.m_objData.power);else if(1==this.m_objData.status){for(var e=app.player.power,t=0;t<2;t++)e+=this.m_objData.friends[t].power;this.setLabPower(e)}},_updataLabTime:function(){if(app.player.getServerTime()>=this.m_objData.etime)this.m_objData.status=2,this.refreshUI();else{var e=this.m_objData.etime-app.player.getServerTime();this.p_labTime.string=gUtils.getHourMinSecTime(e/1e3)}},upLabCheckpointNum:function(){this.p_labCheckpointNum&&(this.p_labCheckpointNum.string=gUtils.transformToChinese(this.m_index+1))},setLabPower:function(e){null!=e&&(this.p_labPower.string=e)},setLabTime:function(e){if(null!=e){var t=Math.floor(e/60),a=e-60*t;this.p_labTime.string=(t>0?langMgr.getString("friendCheckpointDetailsPage",0,t):"")+(a>0?langMgr.getString("friendCheckpointDetailsPage",1,a):"")}},start:function(){},update:function(e){this.m_isTime&&(this.m_time+=e,this.m_time>=1&&(this.m_time=0,this._updataLabTime()))}});cc._RF.pop()},{basePage:void 0}],friendExploreBossPage:[function(e,t){"use strict";cc._RF.push(t,"29051mc5wZAe6tXmZrHAoPG","friendExploreBossPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"friendexplorebosspage"},properties:{p_labBossName:cc.Label,p_labBossPhysic:cc.Label,p_pbarExperience:cc.ProgressBar,p_labExperience:cc.Label,p_layoutArrRewards:cc.Layout,p_nodeItem:cc.Node,p_btnExplore:cc.Button,p_sprGeneralHead:cc.Sprite,p_sprGeneral:cc.Sprite,p_spGeneral:sp.Skeleton,p_animGeneral:cc.Animation,p_labDisappearBoss:cc.Label,p_btnMop:cc.Button},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.m_isBossTime=!1},setParam:function(e){var t=this;null!=e&&(this.m_id=e,app.player.sfFriendBoss(e,function(e,a){e?("boss inactive"==e||app.showNotice(langMgr.getString("friendExploreBossPage",0)),t.onClose()):(t.m_objData=a,t.refreshUI())}))},handleUI:function(){var e=this;this.p_btnExplore.node.on("click",function(){e.m_objData&&e.m_objData.boss?app.db.checkFuncUnLock("FRIENDTS",!0)&&(app.player.fbossphys>0?(app.fbossOwnerId=e.m_id,app.goToBossBattle("friendboss",e.m_objData.boss)):app.showNotice(langMgr.getString("friendExploreBossPage",2))):app.showNotice(langMgr.getString("friendExploreBossPage",1))}),this.p_btnMop.node.on("click",function(){e.m_objData&&e.m_objData.boss?e.onMop():app.showNotice(langMgr.getString("friendExploreBossPage",1))})},refreshUI:function(){if(null==this.m_objData&&this.onClose(),this.m_isBossTime=!0,this.m_time=1,this.m_boss=this.m_objData.boss,this.m_objData.kill){var e=app.getFriendNum(this.m_id);-1!=e&&(app.arrFriend[e].bosstime=null),app.pages.friendpage.instance&&app.pages.friendpage.instance.refreshFriendList(),app.showNotice(langMgr.getString("friendExploreBossPage",3)),this.onClose()}this.m_boss.lastdamges?this.p_btnMop.node.active=!0:this.p_btnMop.node.active=!1,this.setBossName(this.m_boss.name),this.setLabBossPhysic(this.m_objData.maxbphys),this.upPbarExperience(),app.loadTexture(app.db.getGHeadIconByGsid(this.m_boss.gsid),this.p_sprGeneralHead,this.prefabPath),app.loadGeneral(this.m_boss.gsid,this.p_sprGeneral,this.p_spGeneral,this.p_animGeneral,null,this.prefabPath),this.refreshTView(this.m_boss.rewards)},refreshTView:function(e){this.m_arrItems||(this.m_arrItems=[],this.m_arrItems.push(this.p_nodeItem));for(var t=0;t<e.length;++t){var a=this.m_arrItems[t];a||((a=cc.instantiate(this.p_nodeItem)).parent=this.p_layoutArrRewards.node,this.m_arrItems.push(a)),a.active=!0,a.getComponent("propItem").initForBag(e[t]),a.getComponent("propItem").setClick(!0)}for(var i=e.length;i<this.m_arrItems.length;++i)this.m_arrItems[i].active=!1},setBossName:function(e){null!=e&&(this.p_labBossName.string=e)},setLabBossPhysic:function(e){null!=e&&(this.p_labBossPhysic.string=app.player.fbossphys+"/"+e)},upPbarExperience:function(){var e=this.m_boss.nowhp||0==this.m_boss.nowhp?this.m_boss.nowhp/this.m_boss.maxhp:1;this.p_pbarExperience.progress=e,this.p_labExperience.string=e<.01?Math.ceil(100*e)+"%":Math.floor(100*e)+"%"},refreshBossTime:function(){if(app.player.getServerTime()>=this.m_boss.etime)this.m_isBossTime=!1,this.m_contanfunc.apply(this.m_trane);else{var e=this.m_boss.etime-app.player.getServerTime();this.p_labDisappearBoss.string=gUtils.getHourMinSecTime(e/1e3)}},onMop:function(){var e=this;if(app.db.checkFuncUnLock("FRIENDTS",!0))if(app.player.fbossphys<=0)app.showNotice(langMgr.getString("friendExploreBossPage",2));else{var t={content:langMgr.getString("friendExploreBossPage",6,this.m_boss.lastdamges),confirmcb:function(){app.player.sfFriendBossFarm(e.m_id,function(t,a){t||(e.m_objData=a,app.player.fbossphys--,e.refreshUI())})},target:this};app.pages.windowspagetipsmsg.showPage(t)}},update:function(e){this.m_isBossTime&&(this.m_time+=e,this.m_time>=1&&(this.m_time=0,this.refreshBossTime()))}});cc._RF.pop()},{basePage:void 0}],friendPageApply:[function(e,t){"use strict";cc._RF.push(t,"046e8QphGdFA5EuPmDu5rLW","friendPageApply"),cc.Class({extends:cc.Component,properties:{p_tabView:cc.tableView,p_btnAllAccept:cc.Button,p_btnAllRefuse:cc.Button,p_labelNum:cc.Label},onLoad:function(){this.handleUI()},handleUI:function(){var e=this,t=this;this.p_btnAllAccept.node.on("click",function(){if(app.playSound("click"),null!=e.m_objData){for(var a=[],i=0;i<e.m_objData.length;i++)e.m_objData[i]&&e.m_objData[i].id&&a.push(e.m_objData[i].id);var n=app.friMaxCount,r=app.arrFriend.length;if(a.length<=0)app.showNotice(langMgr.getString("friendPageApply",1));else if(r>=n)app.showNotice(langMgr.getString("friendPageApply",2));else if(r+a.length>n){var o={type:"nocancel",content:langMgr.getString("friendPageApply",6),confirmcb:function(){app.player.sfHandleApply(1,a,function(a,i){for(var n=0;n<i.length;n++)i[n].error?"friend full"==i[n].error?app.showNotice(langMgr.getString("friendPageApply",3)):"rfriend full"==i[n].error&&app.showNotice(langMgr.getString("friendPageApply",4)):app.showNotice(langMgr.getString("friendPageApply",5));e.getNewData(t.m_friendData)})},target:e};app.pages.windowspagetipsmsg.showPage(o)}else app.player.sfHandleApply(1,a,function(e){e||t.getNewData(t.m_friendData)})}}),this.p_btnAllRefuse.node.on("click",function(){if(app.playSound("click"),e.m_objData){for(var a=[],i=0;i<e.m_objData.length;i++)e.m_objData[i]&&e.m_objData[i].id&&a.push(e.m_objData[i].id);a.length<=0||app.player.sfHandleApply(0,a,function(e){e||t.getNewData(t.m_friendData)})}})},getNewData:function(e){this.m_friendData=e,this.m_friendData.apply={};var t=this;app.player.sfGetFriendApplyList(function(e,a){e||(t.refreshUI(a),t.m_friendData.apply=a,app.redDataServer.friend.apply=a.length,eventMgr.emit(eventStr.redEvent.RefreshFriendPageAddRed),eventMgr.emit(eventStr.redEvent.RefreshFriendPageRed))})},refreshUI:function(e){null!=e&&(this.m_objData=e,this.refreshTView(e))},deleteApply:function(e){for(var t=0;t<this.m_objData.length;t++)if(this.m_objData[t].id==e){this.m_objData.splice(t,1);break}this.refreshTView(this.m_objData)},refreshTView:function(e){this.p_labelNum.string=langMgr.getString("friendPageApply",0,e.length),this.p_tabView.getComponent("tableView").initTableView(e.length,{array:e,target:this,friendMax:app.friMaxCount,firendListNum:app.arrFriend.length,confirmcb:this.deleteApply})},onDisable:function(){app.pages.friendpage.instance&&cc.isValid(app.pages.friendpage.instance.node)&&(app.pages.friendpage.instance.m_setParam=!1,app.pages.friendpage.instance.getNewData({}))}}),cc._RF.pop()},{}],friendPageExploreBossInterface:[function(e,t){"use strict";cc._RF.push(t,"63774y/os1GRJXRKvUbPwJ4","friendPageExploreBossInterface"),cc.Class({extends:cc.Component,properties:{p_labBossName:cc.Label,p_labBossPhysic:cc.Label,p_pbarExperience:cc.ProgressBar,p_labExperience:cc.Label,p_layoutArrRewards:cc.Layout,p_nodeItem:cc.Node,p_btnExplore:cc.Button,p_sprGeneralHead:cc.Sprite,p_sprGeneral:cc.Sprite,p_spGeneral:sp.Skeleton,p_animGeneral:cc.Animation,p_labDisappearBoss:cc.Label,p_btnMop:cc.Button},onLoad:function(){this.handleUI(),this.m_isBossTime=!1},handleUI:function(){var e=this;this.p_btnExplore.node.on("click",function(){app.playSound("click"),e.m_objData&&e.m_objData.boss?app.player.fbossphys<=0?app.showNotice(langMgr.getString("friendPageExploreBossInterface",1)):app.db.checkFuncUnLock("FRIENDTS",!0)&&(app.fbossSelf=3,app.fbossOwnerId=app.player.id,app.battleType="friendboss",app.goToBossBattle("friendboss",e.m_objData.boss)):app.showNotice(langMgr.getString("friendPageExploreBossInterface",0))}),this.p_btnMop.node.on("click",function(){e.m_objData&&e.m_objData.boss?e.onMop():app.showNotice(langMgr.getString("friendPageExploreBossInterface",0))})},setData:function(e){this.m_friendData=e.friendData,this.m_contanfunc=e.contanfunc,this.m_trane=e.trane,this.m_objData=this.m_friendData.explore,this.m_time=1,this.m_isBossTime=!0,this.refreshUI()},refreshUI:function(){if(null!=this.m_objData){if(this.m_boss=this.m_objData.boss,this.m_objData.kill)return app.showNotice(langMgr.getString("friendPageExploreBossInterface",2)),void this.m_contanfunc.apply(this.m_trane);this.m_boss.lastdamges?this.p_btnMop.node.active=!0:this.p_btnMop.node.active=!1,this.setBossName(this.m_boss.name),this.setLabBossPhysic(this.m_objData.maxbphys),this.upPbarExperience(),app.loadTexture(app.db.getGHeadIconByGsid(this.m_boss.gsid),this.p_sprGeneralHead,app.pages.friendpage.prefabPath),app.loadGeneral(this.m_boss.gsid,this.p_sprGeneral,this.p_spGeneral,this.p_animGeneral,null,app.pages.friendpage.prefabPath),this.refreshTView(this.m_boss.rewards)}},setBossName:function(e){null!=e&&(this.p_labBossName.string=e)},setLabBossPhysic:function(e){null!=e&&(this.p_labBossPhysic.string=app.player.fbossphys+"/"+e)},upPbarExperience:function(){var e=this.m_boss.nowhp||0==this.m_boss.nowhp?this.m_boss.nowhp/this.m_boss.maxhp:1;this.p_pbarExperience.progress=e,this.p_labExperience.string=e<.01?Math.ceil(100*e)+"%":Math.floor(100*e)+"%"},refreshTView:function(e){this.m_arrItems||(this.m_arrItems=[],this.m_arrItems.push(this.p_nodeItem));for(var t=0;t<e.length;++t){var a=this.m_arrItems[t];a||((a=cc.instantiate(this.p_nodeItem)).parent=this.p_layoutArrRewards.node,this.m_arrItems.push(a)),a.active=!0,a.getComponent("propItem").initForBag(e[t]),a.getComponent("propItem").setClick(!0)}for(var i=e.length;i<this.m_arrItems.length;++i)this.m_arrItems[i].active=!1},refreshBossTime:function(){if(app.player.getServerTime()>=this.m_boss.etime)this.m_isBossTime=!1,this.m_contanfunc.apply(this.m_trane);else{var e=this.m_boss.etime-app.player.getServerTime();this.p_labDisappearBoss.string=gUtils.getHourMinSecTime(e/1e3)}},onMop:function(){var e=this;if(app.player.fbossphys<=0)app.showNotice(langMgr.getString("friendPageExploreBossInterface",1));else if(app.db.checkFuncUnLock("FRIENDTS",!0)){var t={content:langMgr.getString("friendPageExploreBossInterface",3,this.m_boss.lastdamges),confirmcb:function(){app.player.sfFriendBossFarm(app.player.id,function(t,a){t||(e.m_objData=a,app.player.fbossphys--,e.refreshUI())})},target:this};app.pages.windowspagetipsmsg.showPage(t)}},update:function(e){this.m_isBossTime&&(this.m_time+=e,this.m_time>=1&&(this.m_time=0,this.refreshBossTime()))}}),cc._RF.pop()},{}],friendPageExploreInterface:[function(e,t){"use strict";cc._RF.push(t,"ab176e3LJxAuKB+rmM6fV1y","friendPageExploreInterface"),cc.Class({extends:cc.Component,properties:{p_btnOnekeyExplore:cc.Button,p_arrCheckpoint:[cc.Node],p_labFriendShip:cc.Label},onLoad:function(){this.handleUI(),this.m_time=1,this.m_isOutTime=!1},handleUI:function(){var e=this,t=this;this.p_btnOnekeyExplore.node.on("click",function(){if(app.db.checkFuncUnLock("FRIENDTS",!0))if(app.playSound("click"),(a=app.player.getCount(90264))>=e.m_exploreData.maxqphys)app.showNotice(langMgr.getString("friendPageExploreInterface",0));else{var a,i=e._excludeFriend();if(e._sortArrFriend(i),i.length<2)app.showNotice(langMgr.getString("friendPageExploreInterface",1));else if(-1!=(a=e._getNumExplore(i))){var n=t.m_exploreData.chapters[a],r=[];r.push(i[0]),r.push(i[1]);var o={arr:r,numExplore:a,chointData:n,target:t,receiveArr:t.refreshUI};app.pages.friendallexplorepage.showPage(o,app.mainScene.p_nodeBg)}else app.showNotice(langMgr.getString("friendPageExploreInterface",2))}}),this.p_arrCheckpoint.forEach(function(e,a){app.playSound("click"),e.on("click",function(){var e=t.m_exploreData.chapters[a],i=t._excludeFriend();t._sortArrFriend(i);var n={data:e,index:a,arrFriend:i,maxqphys:t.m_exploreData.maxqphys,target:t,receiveArr:t.refreshUI};0==e.status||1==e.status?app.pages.friendcheckpointdetailspage.showPage(n,app.mainScene.p_nodeBg):2==e.status&&t.receiveBtnBack(a)}),e.getChildByName("chest").on("click",function(){t.receiveBtnBack(a)})})},receiveBtnBack:function(e){var t=this,a=this.m_exploreData.chapters[e];app.player.sfReceiveExplore(a.chapterid,function(a,i){if(a)app.showNotice(langMgr.getString("friendPageExploreInterface",3));else{var n={showtype:1,reward:i.rewards,target:t,confirmcb:t._confirmcb};t.m_bossid=i.bossid,t.m_exploreData.chapters[e].status=0,app.player.addItem(i.rewards),app.pages.windowspagereward.showPage(n),app.pages.friendpage.instance&&app.pages.friendpage.instance.refreshExploreRed()}})},_confirmcb:function(){null!=this.m_bossid&&""!=this.m_bossid&&(this.m_bossid=null,app.showNotice(langMgr.getString("friendPageExploreInterface",4))),this.m_contanfunc.apply(this.m_trane)},refreshArrChointData:function(){var e=this;this.m_isOutTime=!1,null==this.m_arrIndex&&(this.m_arrIndex=[]),this.p_arrCheckpoint.forEach(function(t,a){switch(e.m_exploreData.chapters[a].status){case 0:t.getChildByName("exploration").active=!1,t.getChildByName("chest").active=!1;break;case 1:t.getChildByName("exploration").active=!0,t.getChildByName("chest").active=!1,e.m_isOutTime=!0,e.m_arrIndex.push(a);break;case 2:t.getChildByName("exploration").active=!1,t.getChildByName("chest").active=!0}})},refresArrTime:function(){if(0!=this.m_arrIndex.length)for(var e=0;e<this.m_arrIndex.length;e++){var t=this.m_arrIndex[e],a=this.p_arrCheckpoint[t],i=this.m_exploreData.chapters[t];if(app.player.getServerTime()>=i.etime)i.status=2,a.getChildByName("exploration").active=!1,a.getChildByName("chest").active=!0;else{var n=i.etime-app.player.getServerTime();a.getChildByName("exploration").getChildByName("time_bg").getChildByName("tx_time").getComponent(cc.Label).string=gUtils.getHourMinSecTime(n/1e3)}}else this.m_isOutTime=!1},_excludeFriend:function(){for(var e=app.arrFriend.slice(),t=0;t<this.m_chapters.length;t++){var a=this.m_chapters[t].friends;if(a&&a.length>0)for(var i=0;i<a.length;i++)for(var n=0;n<e.length;n++)if(a[i].id==e[n].id){e.splice(n,1);break}}return e},_sortArrFriend:function(e){e.sort(function(e,t){var a=e.power,i=t.power;return a<i?1:a>i?-1:0})},_getNumExplore:function(e){for(var t=-1,a=app.player.power+e[0].power+e[1].power,i=this.m_chapters.length-1;i>=0;i--)if(a>=this.m_chapters[i].power&&0==this.m_chapters[i].status){t=i;break}return t},setData:function(e){this.m_friendData=e.friendData,this.m_contanfunc=e.contanfunc,this.m_trane=e.trane,this.m_exploreData=e.friendData.explore,this.m_chapters=this.m_exploreData.chapters,this.refreshUI()},refreshUI:function(){this.refreshArrChointData(),this.refLabFriendShip(),this.refArrExploreIcon()},refArrExploreIcon:function(){for(var e=0;e<this.m_chapters.length;e++){var t=app.db.getFchapterInfo(this.m_chapters[e].chapterid),a=gConfig.getIconFExplore(t.EPID);app.loadTexture(a,this.p_arrCheckpoint[e].getComponent(cc.Sprite),app.pages.friendpage.prefabPath)}},refLabFriendShip:function(){var e=app.player.getCount(90264);this.p_labFriendShip.string=this.m_exploreData.maxqphys-e},update:function(e){this.m_isOutTime&&(this.m_time+=e,this.m_time>=1&&(this.m_time=0,this.refresArrTime()))}}),cc._RF.pop()},{}],friendPageExplore:[function(e,t){"use strict";cc._RF.push(t,"939eeVx349Fg5S4Z/XKFIR4","friendPageExplore"),cc.Class({extends:cc.Component,properties:{p_nodeExploreInterface:cc.Node,p_ndoeExploreBossInterface:cc.Node},onLoad:function(){},handleUI:function(){},getNewData:function(e){this.m_friendData=e,this.m_friendData.explore={},this.refreshUI()},refreshUI:function(){var e=this;app.player.sfGetExploreData(function(t,a){if(t);else{e.m_data=a,e.m_friendData.explore=a;var i={friendData:e.m_friendData,contanfunc:e.refreshUI,trane:e};null==a.boss||null==a.boss.etime?(e.p_ndoeExploreBossInterface.active=!1,e.p_nodeExploreInterface.active=!0,e.p_nodeExploreInterface.getComponent("friendPageExploreInterface").setData(i)):(e.p_ndoeExploreBossInterface.active=!0,e.p_nodeExploreInterface.active=!1,e.p_ndoeExploreBossInterface.getComponent("friendPageExploreBossInterface").setData(i))}})}}),cc._RF.pop()},{}],friendPageList:[function(e,t){"use strict";cc._RF.push(t,"fbfc8V/EPRNOopoZC+d8Law","friendPageList"),cc.Class({extends:cc.Component,properties:{p_tabView:cc.tableView,p_btnRecGive:cc.Button,p_btnAddFriend:cc.Button,p_labFriendNum:cc.Label,p_labFriendShipNum:cc.Label,p_nodeNoFriend:cc.Node},onLoad:function(){this.handleUI()},handleUI:function(){var e=this;this.p_btnRecGive.node.on("click",function(){app.playSound("click"),e.onClickBtnRec()}),this.p_btnAddFriend.node.on("click",function(){app.playSound("click"),app.pages.friendaddfriendpage.showPage(e.m_objData)})},getDaySendData:function(){var e=this;app.player.sfGetReddot(function(t,a){t||(e.m_numSendMax=a.send,e.m_numReceiveMax=a.receive)})},getNewData:function(e){var t=this;this.m_friendData=e,this.p_nodeNoFriend.active=!1,null==this.m_numSendMax&&this.getDaySendData(),app.player.sfGetFriendList(function(e,a){e?cc.log(e):(cc.log(a),app.arrFriend=a.arrfriend,t.refreshUI(a),t.m_friendData.list=a)})},refreshUI:function(e){this.m_objData=e,this.refreshTView(e.arrfriend),this.refreshLabFriendShipNum()},deleteFriend:function(e){for(var t=this.m_objData.arrfriend,a=0;a<t.length;a++)if(t[a].id==e){t.splice(a,1);break}this.refreshTView(t)},refreshTView:function(e){this.p_tabView.getComponent("tableView").initTableView(e.length,{array:e,target:this,againCb:this.refreshLabFriendShipNum,maxcount:this.m_objData.maxcount,delete:this.deleteFriend}),0==e.length?this.p_nodeNoFriend.active=!0:this.p_nodeNoFriend.active=!1,this.refreshRed(),app.pages.friendpage.instance&&app.pages.friendpage.instance.refreshListRed(),this.setLabFriendNum(e.length,this.m_objData.maxcount)},setLabFriendNum:function(e,t){null!=e&&null!=t&&this.p_labFriendNum&&(this.p_labFriendNum.string=langMgr.getString("friendPageList",0,[e,t]))},refreshLabFriendShipNum:function(){var e=app.player.getCount(30019);null!=e&&this.p_labFriendShipNum&&(this.p_labFriendShipNum.string=e)},refreshRed:function(){this.p_btnRecGive.node.getChildByName("rednotice").active=app.pages.friendpage.checkFpoint()&&app.pages.friendpage.checkSend(),this.p_btnAddFriend.node.getChildByName("rednotice").active=app.pages.friendpage.checkApply()},onClickBtnRec:function(){for(var e=this,t=!1,a=0;a<this.m_objData.arrfriend.length;a++)1!=this.m_objData.arrfriend[a].pstatus.receive&&1!=this.m_objData.arrfriend[a].pstatus.send||(t=!0);if(t){if(this.m_numSendMax<=0&&this.m_numReceiveMax<=0)return void app.showNotice(langMgr.getString("friendPageList",2));app.player.sfRecGiveFriend(function(t,a){if(!t)if(0!=a.items.length){for(var i=[],n=0;n<a.items.length;++n){var r=a.items[n];(r.GSID||r.gsid)>=9e4||i.push(r)}app.showNoticeReward(i),app.player.addItem(a.items),e.getNewData(e.m_friendData);var o=app.player.getCount(90263);app.pages.friendpage.instance.p_labelNum.string=langMgr.getString("friendPageList",1,[o,e.m_friendData.dailypsend]),app.redDataServer.friend.send=0,app.redDataServer.friend.fpoint=0,e.refreshRed()}else app.showNotice(langMgr.getString("friendPageList",2))})}else app.showNotice(langMgr.getString("friendPageList",3))}}),cc._RF.pop()},{}],friendPage:[function(e,t){"use strict";cc._RF.push(t,"7fdd3MUhP1DaJHL778UkcMe","friendPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"friendpage"},properties:{p_nodeParent:cc.Node,p_pfbList:cc.Node,p_labelNum:cc.Label,p_tabView:cc.tableView,p_btnRecGive:cc.Button,p_btnAddFriend:cc.Button,p_labFriendNum:cc.Label,p_labFriendShipNum:cc.Label,p_nodeNoFriend:cc.Node},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.fitTopMenu(),this.m_friendData={}},onEnable:function(){this._super(),eventMgr.on(eventStr.redEvent.RefreshFriendPageRed,this.refreshRed,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.redEvent.RefreshFriendPageRed,this.refreshRed,this)},handleUI:function(){var e=this;this._super(),this.p_btnRecGive.node.on("click",function(){app.playSound("click"),e.onClickBtnRec()}),this.p_btnAddFriend.node.on("click",function(){app.playSound("click"),app.pages.friendaddfriendpage.showPage(e.m_objData)})},setParam:function(){null==this.m_friendData&&(this.m_friendData={}),this.getNewData(this.m_friendData)},getDaySendData:function(){this.m_numSendMax=this.m_objData.dailypsend,this.m_numReceiveMax=this.m_objData.dailyprece},getNewData:function(e){var t=this;this.m_friendData=e,this.p_nodeNoFriend.active=!1,app.player.sfGetFriendList(function(e,a){if(e)cc.log(e);else{cc.log(a),app.arrFriend=a.arrfriend,t.refreshUI(a),t.m_friendData.list=a;for(var i=0,n=0;n<app.arrFriend.length;n++)app.arrFriend[n].pstatus.receive>0&&i++;app.redDataServer.friend.fpoint=i}})},refreshUI:function(e){this.m_objData=e,null==this.m_numSendMax&&this.getDaySendData(),1==this.m_setParam?this.refreshFriendList():this.refreshTView(e.arrfriend),this.refreshLabFriendShipNum();var t=app.player.getCount(90263);this.p_labelNum.string=langMgr.getString("friendPage",0,[t,this.m_numSendMax]),this.m_setParam=!0},deleteFriend:function(e){for(var t=this.m_objData.arrfriend||app.arrFriend,a=0;a<t.length;a++)if(t[a].id==e){t.splice(a,1);break}this.reloadTView(t)},refreshTView:function(e){this.p_tabView.getComponent("tableView").initTableView(e.length,{array:e,target:this,againCb:this.refreshLabFriendShipNum,maxcount:this.m_objData.maxcount,delete:this.deleteFriend}),0==e.length?this.p_nodeNoFriend.active=!0:this.p_nodeNoFriend.active=!1,this.refreshRed(),this.setLabFriendNum(e.length,this.m_objData.maxcount)},reloadTView:function(e){this.p_tabView.getComponent("tableView").newReload(e.length,{array:e,target:this}),0==e.length?this.p_nodeNoFriend.active=!0:this.p_nodeNoFriend.active=!1,this.refreshRed(),this.setLabFriendNum(e.length,this.m_objData.maxcount)},setLabFriendNum:function(e,t){null!=e&&null!=t&&this.p_labFriendNum&&(this.p_labFriendNum.string=langMgr.getString("friendPage",1,[e,t]))},refreshLabFriendShipNum:function(){var e=app.player.getCount(30019);null!=e&&this.p_labFriendShipNum&&(this.p_labFriendShipNum.string=e)},refreshRed:function(){this.p_btnRecGive.node.getChildByName("rednotice").active=app.pages.friendpage.checkFpoint(),this.p_btnAddFriend.node.getChildByName("rednotice").active=app.pages.friendpage.checkApply()},onClickBtnRec:function(){for(var e=this,t=!1,a=0;a<this.m_objData.arrfriend.length;a++)1!=this.m_objData.arrfriend[a].pstatus.receive&&1!=this.m_objData.arrfriend[a].pstatus.send||(t=!0);if(t){if(this.m_numSendMax<=0&&this.m_numReceiveMax<=0)return void app.showNotice(langMgr.getString("friendPage",3));app.player.sfRecGiveFriend(function(t,i){if(!t)if(0!=i.items.length){var n={};for(var r in i.send)if(null==n[r]){n[r]={},n[r].str=langMgr.getString("friendPage",5,app.getFriendName(r)),n[r].items=[];for(var o=0;o<i.send[r].length;o++){var s=i.send[r][o];(s.GSID||s.gsid)>=9e4||n[r].items.push(s)}}for(var p in i.rec)if(null==n[p]){n[p]={},n[p].str=langMgr.getString("friendPage",5,app.getFriendName(a)),n[p].items=[];for(var c=0;c<i.rec[p].length;c++){var h=i.rec[p][c];(h.GSID||h.gsid)>=9e4||n[p].items.push(h)}}else for(var l=0;l<i.rec[p].length;l++){var g=i.rec[p][l];(g.GSID||g.gsid)>=9e4||n[p].items.push(g)}for(var d in n){var u=n[d];app.showNoticeReward(u.items,null,u.str)}app.player.addItem(i.items),e.getNewData(e.m_friendData);var f=app.player.getCount(90263);app.pages.friendpage.instance.p_labelNum.string=langMgr.getString("friendPage",0,[f,e.m_numSendMax]),app.redDataServer.friend.send=0,app.redDataServer.friend.fpoint=0,e.refreshRed()}else app.showNotice(langMgr.getString("friendPage",4))})}else app.showNotice(langMgr.getString("friendPage",4))},refreshFriendList:function(){this.reloadTView(app.arrFriend)},onClose:function(){this._super(),this.m_setParam=!1}});a.refreshRed=function(e){var t=!1;return t||(t=a.checkApply()),t||(t=a.checkFpoint()),e&&(e.active=t),t},a.checkApply=function(){var e=!1,t=app.getRedInfoByObj(["friend","apply"],null);return null!=t&&(e=t>0),e},a.checkFpoint=function(){var e=!1,t=app.getRedInfoByObj(["friend","fpoint"],null);return null!=t&&(e=t>0),e},a.checkSend=function(){var e=!1,t=app.getRedInfoByObj(["friend","send"],null);return null!=t&&(e=t>0),e},cc._RF.pop()},{basePage:void 0}],friendRecruitPage:[function(e,t){"use strict";cc._RF.push(t,"cb84dECr2NJRYZZqcYjmzKB","friendRecruitPage");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=cc._decorator,o=r.ccclass,s=(r.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,e.prototype.onLoad.call(this)},t.prototype.getOneTimeCost=function(){return{count:"x"+app.db.dbDraw[2][1].COST[0].COUNT,iconPath:app.db.getPropsIconPath("30019")}},t.prototype.getTenTimesCost=function(){return{count:"x"+app.db.dbDraw[2][10].COST[0].COUNT,iconPath:app.db.getPropsIconPath("30019")}},t.prototype.oneTimeClickHandle=function(){app.playSound("click"),this.extract(2,1)},t.prototype.tenTimesClickHandle=function(){app.playSound("click"),this.extract(2,10)},t.prototype.showXuyuan=function(){return!1},t.prototype.showTianyun=function(){return!1},t.refreshRed=function(){return!app.comeInFriendRecruit},t.prefabPath="friendrecruitpage",a=n([o],t)}(e("./cardpubBasePage").CardpubBasePage));t.exports=s,cc._RF.pop()},{"./cardpubBasePage":"cardpubBasePage"}],fusionPage:[function(e,t){"use strict";function a(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(a)return(a=a.call(e)).next.bind(a);if(Array.isArray(e)||(a=i(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function i(e,t){if(e){if("string"==typeof e)return n(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?n(e,t):void 0}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,i=new Array(t);a<t;a++)i[a]=e[a];return i}cc._RF.push(t,"5dc40K8sLRCQ5xLHPe7P5IB","fusionPage");var r=cc.Class({extends:e("basePage"),statics:{prefabPath:"fusionpage"},properties:{p_pfbProp:cc.Prefab,p_nodeNeedEquip:cc.Node,p_labNeedName:cc.Label,p_barNeed:cc.ProgressBar,p_labNeed:cc.Label,p_nodeTargetEquip:cc.Node,p_labTargetName:cc.Label,p_labNum:cc.Label,p_btnUp:cc.Button,p_btnDown:cc.Button,p_btnMin:cc.Button,p_btnMax:cc.Button,p_labCost:cc.Label,p_btnComp:cc.Button,p_btnHelp:cc.Button,p_btnAutoCompound:cc.Button,p_arrNodeMenu:[cc.Node],p_arrNodePickMenu:[cc.Node],p_tabvEquip:cc.Node},onLoad:function(){r.instance=this,this.stopBgNodeEvent(),this.creatMask(),this.handleUI(),this.fitTopMenu()},handleUI:function(){var e=this;this._super(),this.p_arrNodeMenu.forEach(function(t,a){t.on("touchend",function(){e.onClickMenu(a)})}),this.p_btnUp.node.on("click",function(){app.playSound("click"),e.onClickUpDown(1)}),this.p_btnDown.node.on("click",function(){app.playSound("click"),e.onClickUpDown(2)}),this.p_btnMin.node.on("click",function(){app.playSound("click"),e.onClickFloatTen(2)}),this.p_btnMax.node.on("click",function(){app.playSound("click"),e.onClickMinMax(1)}),this.p_btnComp.node.on("click",function(){app.playSound("click"),e.onClickComp()}),this.p_btnHelp.node.active=!1,this.p_btnHelp.node.on("click",function(){app.playSound("click")}),this.p_btnAutoCompound.node.on("click",function(){app.playSound("click");var t=[33001,33101,33201,33301][e.m_numShowMenuIndex];app.player.sfEquipAutoCompPreview(t).then(function(i){if(cc.isValid(e)){if(i.items.length<=0)return app.showNotice(langMgr.getString("fusionPage",6));for(var n,r=0,o=a(i.castitems);!(n=o()).done;){var s=n.value;if(38006===s.GSID){r=s.COUNT;break}}app.pages.windowspagepreview.showPage({content:langMgr.getString("fusionPage",5,gUtils.showCoinNum(r)),props:[].concat(i.items),confirmcb:function(){app.player.sfEquipAutoComp(t).then(function(t){app.player.reduceItem(t.castitems),app.player.addItem(t.items),cc.isValid(app.mainScene)&&app.mainScene.refreshCoin(),app.player.sfPlayerByParam(["hide","props","others"],function(){if(cc.isValid(e)){e.setData(e.m_numShowMenuIndex),e.m_arrShowData,e.m_nodeChoose=null,e.m_chooseIndex=null,e.m_arrChooseIndex=[];var a={showtype:1,reward:t.items.map(function(e){return{gsid:e.GSID,count:e.COUNT}})};app.playSound("synthesis"),app.pages.windowspagereward.showPage(a),cc.isValid(e)&&(e.setData(e.m_numShowMenuIndex),e.m_chooseIndex=null,e.refreshView(),e.refreshCompUI(e.m_strNowCompGsid),e.refreshMenuRed())}})}).catch(function(e){return cc.warn(e)})}})}}).catch(function(e){return cc.warn(e)})},this)},setParam:function(){this.refreshUI(),app.runUnlockGuide("FUSION")},refreshUI:function(){this.onClickMenu(0,!0),this.refreshMenuRed()},onClickMenu:function(e,t){cc.log("now click menu index: ",e),(this.m_numShowMenuIndex!=e||t)&&(this.m_numShowMenuIndex=e,this.p_arrNodePickMenu.forEach(function(t,a){t.active=a==e}),this.setData(e),this.m_chooseIndex=null,this.refreshView(),this.refreshCompUI(this.m_strNowCompGsid))},refreshMenuRed:function(){var e=app.player.getCount(38006);this.p_arrNodeMenu.forEach(function(t,a){var i=app.db.dbEquipComp;for(var n in t.getChildByName("rednotice").active=!1,i)if(a+1==app.db.getEBaseByGsid(n).POS){var r=0,o=i[n][0].GSID;app.player.equip[o]&&(r=app.player.equip[o].count);var s=i[n][0].COUNT,p=i[n][1].COUNT;if(r>=s&&e>=p){t.getChildByName("rednotice").active=!0;break}}})},refreshView:function(){this.m_nodeChoose=null,this.m_arrChooseIndex=[];var e=this.m_arrShowData.length;this.p_tabvEquip.getComponent("tableView").initTableView(e,{array:this.m_arrShowData,pickmax:1,initfun:"initForFusion",target:this},function(){eventMgr.emit(eventStr.propTabvItem.EVT_DEFAULT_SELECT)})},refreshCompUI:function(e){var t,i=this.m_objEquipComp[e];if(!i)return this.refreshTarget(),this.refreshNeed(),void(this.m_strNowCompGsid=null);this.refreshTarget(e);for(var n,r=a(i);!(n=r()).done;){var o=n.value;if(cc.log(o),"equip"==app.db.getTypeByGsid(Number(o.GSID))){t=o.GSID;break}}this.refreshNeed(t,e)},refreshTarget:function(e){if(!e)return this.p_nodeTargetEquip.active=!1,void(this.p_labTargetName.node.opacity=0);this.m_nodeTargetEquip||(this.m_nodeTargetEquip=cc.instantiate(this.p_pfbProp),this.m_nodeTargetEquip.parent=this.p_nodeTargetEquip,this.m_nodeTargetEquip.setPosition(cc.v2(0,0))),this.m_nodeTargetEquip.getComponent("propItem").initForGEquip(e),this.m_nodeTargetEquip.getComponent("propItem").setClick(!0),this.p_nodeTargetEquip.active=!0;var t=app.db.getPropsInfoByGsid(e);this.p_labTargetName.node.opacity=255,this.p_labTargetName.string=t.NAME},refreshNeed:function(e,t){if(!e)return this.p_nodeNeedEquip.active=!1,this.p_labNeedName.node.opacity=0,this.p_barNeed.progress=0,this.p_labNeed.string="0/0",void this.refreshCompNum(0,0,0);this.m_nodeNeedEquip||(this.m_nodeNeedEquip=cc.instantiate(this.p_pfbProp),this.m_nodeNeedEquip.parent=this.p_nodeNeedEquip,this.m_nodeNeedEquip.setPosition(cc.v2(0,0))),this.m_nodeNeedEquip.getComponent("propItem").initForGEquip(e),this.m_nodeNeedEquip.getComponent("propItem").setClick(!0),this.p_nodeNeedEquip.active=!0;var i=app.db.getPropsInfoByGsid(e);this.p_labNeedName.node.opacity=255,this.p_labNeedName.string=i.NAME;for(var n,r=0,o=app.player.getCount(e),s=0,p=a(this.m_objEquipComp[t]);!(n=p()).done;){var c=n.value;c.GSID==e&&(r=c.COUNT),c.GSID==gConfig.player.gold&&(s=c.COUNT)}this.p_barNeed.progress=Math.min(o/r,1),this.p_labNeed.string=gUtils.showNum(o)+"/"+r;var h=Math.floor(o/r);this.m_numMaxComp=h,this.m_numNowComp=h,this.m_numOneCost=s,this.refreshCompNum(this.m_numMaxComp,this.m_numNowComp,this.m_numOneCost)},refreshCompNum:function(e,t,a){this.p_btnUp.interactable=e>t,this.p_btnDown.interactable=t>1,this.p_labNum.string=langMgr.getString("fusionPage",4,t),this.p_labCost.string=gUtils.showCoinNum(a*t)},setData:function(e){var t=app.db.dbEquipComp;for(var a in this.m_objEquipComp=t,this.m_arrShowData=[],t){var i=app.db.getEBaseByGsid(a);if(i){var n=0,r=t[a][0].GSID;app.player.equip[r]&&(n=app.player.equip[r].count);var o={gsid:a,have:n,need:t[a][0].COUNT,unitPrice:this.m_objEquipComp[a][1]?this.m_objEquipComp[a][1].COUNT:0};e+1==i.POS&&this.m_arrShowData.push(o)}}},itemPorpClick:function(e,t){return e==this.m_chooseIndex||(this.m_chooseItem&&(cc.log("handle choose item"),this.m_chooseItem.selected(!1,this.m_chooseIndex)),this.m_chooseItem=t,this.m_chooseIndex=e,this.m_strNowCompGsid=this.m_arrShowData[e].gsid,this.refreshCompUI(this.m_strNowCompGsid),!0)},onClickUpDown:function(e){1==e?this.m_numNowComp+1<=this.m_numMaxComp&&++this.m_numNowComp:this.m_numNowComp-1>0&&--this.m_numNowComp,this.refreshCompNum(this.m_numMaxComp,this.m_numNowComp,this.m_numOneCost)},onClickMinMax:function(e){this.m_strNowCompGsid&&(this.m_numNowComp=1==e?this.m_numMaxComp:this.m_numNowComp>0?1:0,this.refreshCompNum(this.m_numMaxComp,this.m_numNowComp,this.m_numOneCost))},onClickFloatTen:function(e){this.m_strNowCompGsid&&(this.m_numNowComp=1==e?this.m_numNowComp+10>=this.m_numMaxComp?this.m_numMaxComp:this.m_numNowComp+10:this.m_numNowComp-10<=1?1:this.m_numNowComp-10,this.refreshCompNum(this.m_numMaxComp,this.m_numNowComp,this.m_numOneCost))},onClickComp:function(){var e=this;if(this.m_strNowCompGsid){var t=this.m_objEquipComp[this.m_strNowCompGsid],a=t[0],i=t[1],n=a.COUNT||0,r=app.player.getCount(a.GSID),o=i.COUNT*this.m_numNowComp||0,s=app.player.getCount(i.GSID);if(r<n)app.showNotice(langMgr.getString("fusionPage",0));else if(s<o){var p=app.db.getPropsName(i.GSID);app.showNotice(langMgr.getString("fusionPage",1,p))}else app.player.sfEquipComp(this.m_strNowCompGsid,this.m_numNowComp,function(t){if(t)return"no enough"==t&&(t=langMgr.getString("fusionPage",2)),void app.showNotice(t);cc.isValid(app.mainScene)&&app.mainScene.refreshCoin(),e.setData(e.m_numShowMenuIndex);var a={array:e.m_arrShowData,pickmax:1,initfun:"initForFusion",target:e};e.m_nodeChoose=null,e.m_chooseIndex=null,e.m_arrChooseIndex=[];var i={showtype:1,reward:[{gsid:e.m_strNowCompGsid,count:e.m_numNowComp}]};app.playSound("synthesis"),app.player.sfPlayerData(function(){app.pages.windowspagereward.showPage(i),e.p_tabvEquip.getComponent("tableView").reload(a),eventMgr.emit(eventStr.propTabvItem.EVT_DEFAULT_SELECT),e.refreshMenuRed()})})}},onNumInput:function(){if(this.m_numMaxComp&&this.m_numOneCost){if(this.checkNumLegal(this.p_editNum.string)){var e=parseInt(this.p_editNum.string);this.m_numNowComp=e>this.m_numMaxComp?this.m_numMaxComp:e}else this.m_numNowComp=0;this.refreshCompNum(this.m_numMaxComp,this.m_numNowComp,this.m_numOneCost)}else this.refreshCompNum(0,0,0)},checkNumLegal:function(e){return/^[1-9]\d*$/.test(e)},onClose:function(){this.m_strNowCompGsid=null,this._super(),cc.isValid(app.pages.citypage.instance)&&app.pages.citypage.instance.refreshCityRed()}});r.refreshRed=function(e){var t=app.db.dbEquipComp;cc.isValid(e)&&(e.active=!1);var a=!1,i=app.player.getCount(38006);for(var n in t){var r=0,o=t[n][0].GSID;app.player.equip[o]&&(r=app.player.equip[o].count);var s=t[n][0].COUNT,p=t[n][1].COUNT;if(r>=s&&i>=p){cc.isValid(e)&&(e.active=!0),a=!0;break}}return a},cc._RF.pop()},{basePage:void 0}],generalAttributeDetailedPage:[function(e,t){"use strict";cc._RF.push(t,"93220VF3dVFvqLi2f5a20Q6","generalAttributeDetailedPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"generalattributedetailedpage",pageType:1,createShot:!1},properties:{p_labAtk:cc.Label,p_labHp:cc.Label,p_labDef:cc.Label,p_labMdef:cc.Label,p_labMp:cc.Label,p_labAtktime:cc.Label,p_labPpthr:cc.Label,p_labPmthr:cc.Label,p_labPcri:cc.Label,p_labPcrid:cc.Label,p_labDpcri:cc.Label,p_labAccu:cc.Label,p_labPdex:cc.Label,p_labPmdex:cc.Label,p_labPdam:cc.Label,p_labPrdc:cc.Label,p_labPpdam:cc.Label,p_labPmdam:cc.Label,p_labPprdc:cc.Label,p_labPmrdc:cc.Label,p_labPskidam:cc.Label,p_labPatkdam:cc.Label,p_labPratk:cc.Label},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0,1)},setParam:function(e){e||this.onClose(),this.m_objData="string"==typeof e||"number"==typeof e?app.player.general[e].property:e,this.refreshUI()},refreshUI:function(){this.p_labAtk.string=this.m_objData.atk||0,this.p_labHp.string=this.m_objData.hp||0,this.p_labDef.string=this.m_objData.def||0,this.p_labMdef.string=this.m_objData.mdef||0,this.p_labMp.string=this.m_objData.mp||0,this.p_labAtktime.string=(this.m_objData.pasp||0)/10+"%",this.p_labPpthr.string=(this.m_objData.ppthr||0)/10+"%",this.p_labPmthr.string=(this.m_objData.pmthr||0)/10+"%",this.p_labPcri.string=(this.m_objData.pcri||0)/10+"%",this.p_labPcrid.string=(this.m_objData.pcrid||0)/10+"%",this.p_labDpcri.string=(this.m_objData.dpcri||0)/10+"%",this.p_labAccu.string=(this.m_objData.accu||0)/10+"%",this.p_labPdex.string=(this.m_objData.pdex||0)/10+"%",this.p_labPmdex.string=(this.m_objData.pmdex||0)/10+"%",this.p_labPdam.string=(this.m_objData.pdam||0)/10+"%",this.p_labPrdc.string=(this.m_objData.prdc||0)/10+"%",this.p_labPpdam.string=(this.m_objData.ppdam||0)/10+"%",this.p_labPmdam.string=(this.m_objData.pmdam||0)/10+"%",this.p_labPprdc.string=(this.m_objData.pprdc||0)/10+"%",this.p_labPmrdc.string=(this.m_objData.pmrdc||0)/10+"%",this.p_labPskidam.string=(this.m_objData.pskidam||0)/10+"%",this.p_labPatkdam.string=(this.m_objData.patkdam||0)/10+"%",this.p_labPratk.string=(this.m_objData.pratk||0)/10+"%"}});cc._RF.pop()},{basePage:void 0}],generalCompPage:[function(e,t){"use strict";function a(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(a)return(a=a.call(e)).next.bind(a);if(Array.isArray(e)||(a=i(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function i(e,t){if(e){if("string"==typeof e)return n(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?n(e,t):void 0}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,i=new Array(t);a<t;a++)i[a]=e[a];return i}cc._RF.push(t,"fadf7VtEmtAVaOR/l8+ptng","generalCompPage");var r=[cc.v2(-180,12),cc.v2(-55,0),cc.v2(55,0),cc.v2(168,0)],o=cc.Class({extends:e("basePage"),statics:{prefabPath:"generalcomppage",checkComp:function(e){for(var t=!0,a=0;a<e.length;++a){if(!e[a]){t=!1;break}var i=e[a].need;if(e[a].picked.length<i){t=!1;break}}return t}},properties:{p_sprName:cc.Sprite,p_sprStar:[cc.Sprite],p_sprCamp:cc.Sprite,p_sprOccu:cc.Sprite,p_sprOccu2:cc.Sprite,p_nodeGeneral:cc.Node,p_sprGeneral:cc.Sprite,p_spGeneral:sp.Skeleton,p_animGeneral:cc.Animation,p_listCampNode:cc.Node,p_btnComp:cc.Button,p_btnHelp:cc.Button,p_nodeMenuContent:cc.Node,p_pfbMenu:cc.Prefab,_menuSelector:null,p_tabvGeneral:cc.Node,p_animLevelup:cc.Animation,p_spLvUp:sp.Skeleton,contentText:cc.Label,p_nodePlaneMid:cc.Node,p_nodePlaneDefault:cc.Node,p_pfbGQuality:cc.Prefab,p_nodeQContent:cc.Node,_generalQualityItem:null,p_btnGenInfo:cc.Button,p_nodeContent:cc.Node,p_pfbGeneral:cc.Prefab,_arrItemList:[]},onLoad:function(){o.instance=this,this.handleUI(),this.stopBgNodeEvent(),this.fitTopMenu(),this.creatMask(),this._initMenu()},_initMenu:function(){cc.isValid(this._menuSelector)||(this._menuSelector=cc.instantiate(this.p_pfbMenu),this.p_nodeMenuContent.addChild(this._menuSelector),this._menuSelector.setPosition(cc.Vec2.ZERO),this.m_campIndex=0,this.m_professIndex=0,this._menuSelector.getComponent("GeneralMenuSelector").onCampClick(this.campMenuHandler,this),this._menuSelector.getComponent("GeneralMenuSelector").onProfessionClick(this.professMenuHandler,this))},start:function(){var e=this;eventMgr.on(eventStr.battleEvent.ExitBattle,function(){e.refreshList()},this),eventMgr.on(eventStr.soulBinding.ExitBinding,function(){e.refreshList()},this)},refreshList:function(){var e=this;this.m_arrShowData=this.setData();var t=this.m_arrShowData.length;this.p_tabvGeneral.getComponent("tableView").initTableView(t,{array:this.m_arrShowData,maxpick:1,initfun:"initForComp",target:this,selectitem:"m_chooseItem",arrpick:this.m_selectGsid?[this.m_selectGsid]:[]},function(){cc.isValid(e)&&(!e.m_arrPickedId||e.m_arrPickedId.length<=0)&&(e.m_strNowCompGsid?(e.scrollToPick(e.m_strNowCompGsid),e.refreshUpMain(e.m_strNowCompGsid)):(e.p_nodePlaneMid.active&&(e.p_nodePlaneMid.active=!1),cc.isValid(e.p_nodePlaneDefault)&&!e.p_nodePlaneDefault.opacity&&(e.p_nodePlaneDefault.opacity=255),e.p_nodeGeneral.opacity=0))})},handleUI:function(){var e=this;this._super(),this.p_sprCamp.node.on("touchend",function(){app.pages.windowspagetipscamp.showPage({camp:e.m_camp})}),this.p_sprOccu.node.on("touchend",function(){app.pages.windowspagetipsoccu.showPage({occu:e.m_occu1})}),this.p_sprOccu2.node.on("touchend",function(){app.pages.windowspagetipsoccu.showPage({occu:e.m_occu2})}),this.p_btnComp.node.on("click",function(){app.playSound("click"),e.onClickComp()}),this.p_btnHelp.node.on("click",function(){app.pages.windowspagetipshelp.showPage("1016")}),this.p_btnGenInfo.node.on("click",function(){app.playSound("click"),app.showPropTips({gsid:e.m_strNowCompGsid})},this)},setParam:function(e){e&&(this.m_selectGsid=e.gsid+1,this.m_selectGuid=e.guid),cc.isValid(this._menuSelector)||this._initMenu(),this._menuSelector.getComponent("GeneralMenuSelector").initMenu(this.m_campIndex,this.m_professIndex),this.campMenuHandler(this.m_campIndex),app.runUnlockGuide("GENERAL_COMPOUND")},refreshMain:function(e){var t=this;if(e){this.p_nodeGeneral.opacity=255;var a=app.db.getGBaseByGsid(e);a||(a={GSID:0,NAME:"\u672a\u77e5\u6b66\u5c06",CAMP:1,STAR:1,TGRADE:1});var i=app.db.getGNamePathHByGsid(e);if(app.loadTexture(i,this.p_sprName,this.prefabPath),gConfig.getNameGOccu(a.OCCU-1)){var n=gConfig.getIconGOccuPath(a.OCCU-1);app.loadTexture(n,this.p_sprOccu,this.prefabPath),this.p_sprOccu.node.active=!0,this.m_occu1=a.OCCU}else this.p_sprOccu.node.active=!1;if(a.OCCU2&&gConfig.getNameGOccu(a.OCCU2-1)){var r=gConfig.getIconGOccuPath(a.OCCU2-1);app.loadTexture(r,this.p_sprOccu2,this.prefabPath),this.p_sprOccu2.node.active=!0,this.m_occu2=a.OCCU2}else this.p_sprOccu2.node.active=!1;var o=gConfig.getIconGCampPath(a.CAMP-1);app.loadTexture(o,this.p_sprCamp,this.prefabPath),this.m_camp=a.CAMP;var s=a.STAR,p=(s-1)%5;s>=10&&(p=0);var c=gConfig.getIconGBigStarPath(a.STAR);this.p_sprStar.forEach(function(e,a){e.node.active=p>=a,app.loadTexture(c,e,t.prefabPath)}),this._bLoad=!0,app.loadGeneral(a.GSID,this.p_sprGeneral,this.p_spGeneral,this.p_animGeneral,function(){t._bLoad=!1},this.prefabPath),!cc.isValid(this._generalQualityItem)&&a.TGRADE&&(this._generalQualityItem=cc.instantiate(this.p_pfbGQuality),this.p_nodeQContent.addChild(this._generalQualityItem),this._generalQualityItem.setPosition(cc.Vec2.ZERO)),cc.isValid(this._generalQualityItem)&&this._generalQualityItem.getComponent("GeneralQualityItem").init(a.TGRADE)}},refreshComp:function(e){if(void 0===e&&(e=!1),!e){this.m_genListData=[];for(var t=0;t<this.m_arrCondGData.length;t++)this.m_genListData.push(this.setCompData(t))}for(var a=0;a<this.m_arrCondGData.length;++a){var i=this.getGeneralItem(a);i.active=!0,i.getComponent("generalPortraitItem").initForAwake(a,this.m_arrCondGData,!0)}for(var n=this.m_arrCondGData.length;n<this._arrItemList.length;++n)this._arrItemList[index].active=!1;this.p_btnComp.node.active=this.m_arrCondGData.length>0},getGeneralItem:function(e){var t,a=this;if(cc.isValid(this._arrItemList[e]))return this._arrItemList[e];var i=cc.instantiate(this.p_pfbGeneral);return i.scale=0===e?1:.8,this.p_nodeContent.addChild(i),i.setPosition(null!=(t=r[e])?t:cc.Vec2.ZERO),this._arrItemList[e]=i,i.on(cc.Node.EventType.TOUCH_END,function(){a.onClickCond(e)}),i},refreshView:function(){var e=this;this.m_arrPickedId=[],this.m_strNowCompGsid=null,this.m_chooseItem=null;var t=this.m_arrShowData.length;this.p_tabvGeneral.getComponent("tableView").initTableView(t,{array:this.m_arrShowData,maxpick:1,initfun:"initForComp",target:this,selectitem:"m_chooseItem",arrpick:this.m_selectGsid?[this.m_selectGsid]:[]},function(){cc.isValid(e)&&(0===e.m_arrPickedId.length&&(e.m_selectGsid?(e.scrollToPick(e.m_selectGsid),e.refreshUpMain(e.m_selectGsid),e.m_selectGsid=null,e.m_selectGuid=null):(e.p_nodePlaneMid.active&&(e.p_nodePlaneMid.active=!1),e.p_btnComp.node.active=!1,cc.isValid(e.p_nodePlaneDefault)&&!e.p_nodePlaneDefault.opacity&&(e.p_nodePlaneDefault.opacity=255),e.p_nodeGeneral.opacity=0)),e.scheduleOnce(function(){return e.p_tabvGeneral.getComponent("tableView").getCells(function(e){return app.playGridListAction(e)})},0))})},setData:function(){var e=app.db.dbGCompList,t=[];app.GCompData={},this.m_arrRed=[0,0,0,0,0,0];for(var i,n=a(e);!(i=n()).done;){var r=i.value,o=app.db.getGBaseByGsid(r);if(o){var s=app.db.isFullComp(r),p=this.m_arrRed[o.CAMP-1];s.ISFULL&&(this.m_arrRed[o.CAMP-1]=p+1),app.GCompData[r]=s;var c=0==this.m_campIndex||this.m_campIndex==o.CAMP,h=0==this.m_professIndex||this.m_professIndex==o.OCCU||this.m_professIndex==o.OCCU2;c&&h&&t.push(r)}}return t.sort(function(e,t){var a=app.db.getGBaseByGsid(e),i=app.GCompData[e].ISFULL,n=app.db.getGBaseByGsid(t),r=app.GCompData[t].ISFULL;if(i<r)return 1;if(i==r){if(6==a.STAR||6==n.STAR){var o=6==a.STAR,s=6==n.STAR;if(o!=s)return s-o}if(a.STAR>n.STAR)return 1;if(a.STAR==n.STAR&&a.GSID>n.GSID)return 1}return-1}),t},setCondGData:function(e){var t=[];if(!e)return t;var a=app.db.getCompByGsid(e);if(!a)return t;var i={};i.cond=a.MAIN,i.need=1,i.picked=[],this.m_selectGuid&&(i.picked=[this.m_selectGuid]),t.push(i);for(var n=a.CONS,r=0;r<n.length;++r){var o={};o.cond=n[r].COND,o.need=n[r].COUNT,o.picked=[],t.push(o)}return cc.log("now condGData is",t),t},itemClick:function(e,t){return e==this.m_strNowCompGsid||(this.p_nodePlaneMid.active||(this.p_nodePlaneMid.active=!0),cc.isValid(this.p_nodePlaneDefault)&&this.p_nodePlaneDefault.opacity&&(this.p_nodePlaneDefault.opacity=0),e!=this.m_selectGsid&&(this.m_selectGsid=null,this.m_selectGuid=null),this.m_chooseItem&&(cc.log("handle choose item"),this.m_chooseItem.selected(!1,this.m_strNowCompGsid)),this.m_chooseItem=t,this.m_strNowCompGsid=e,this.refreshMain(e),this.m_arrCondGData=this.setCondGData(e),this.refreshComp(),this.p_listCampNode.x=55*(4-this._arrItemList.length),!0)},refreshUpMain:function(e){this.p_nodePlaneMid.active||(this.p_nodePlaneMid.active=!0),cc.isValid(this.p_nodePlaneDefault)&&this.p_nodePlaneDefault.opacity&&(this.p_nodePlaneDefault.opacity=0),this.m_strNowCompGsid=e,this.refreshMain(e),this.m_arrCondGData=this.setCondGData(e),this.refreshComp(),this.p_listCampNode.x=55*(4-this._arrItemList.length)},onClickCond:function(e){var t={};t.index=e,t.arrcond=this.m_arrCondGData,t.cb=this.refreshComp,t.target=this,t.noplus=!0,t.isGeneralComp=!0,t.showData=this.m_genListData,app.pages.windowspagelistgeneral.showPage(t)},onClickComp:function(){var e=this,t=this.m_strNowCompGsid,a=this.m_arrCondGData[0].picked[0],i=[];if(o.checkComp(this.m_arrCondGData)){for(var n=0,r=0,s=1;s<this.m_arrCondGData.length;++s)this.m_arrCondGData[s]&&(i.push(this.m_arrCondGData[s].picked),s>1&&this.m_arrCondGData[s].picked.forEach(function(e){var t=app.player.general[e];t.level>1&&n++,app.db.getGBaseByGsid(t.gsid).TGRADE>5&&r++}));cc.log(t,a,i),app.player.isOfficialGeneral(a)&&app.player.refreshMostGeneral();var p=function(){var n=app.player.general[a];app.player.sfGeneralAwake(t,a,i,function(t,i){t?app.showNotice(t):(app.showNotice(langMgr.getString("generalCompPage",1)),app.playSound("plevelup"),i.global_gifts&&app.setNewRecommendGift(i.global_gifts),e.showGeneralEffAnim(),app.player.sfPlayerData(function(){var t={old:n,new:app.player.general[a],items:i.items};app.pages.windowspagegstarsucc.showPage(t),e.m_arrShowData=e.setData(),e.p_nodePlaneMid.active&&(e.p_nodePlaneMid.active=!1),e.p_btnComp.node.active=!1,e.m_strNowCompGsid="",cc.isValid(e.p_nodePlaneDefault)&&!e.p_nodePlaneDefault.opacity&&(e.p_nodePlaneDefault.opacity=255),e.p_nodeGeneral.opacity=0;var r={array:e.m_arrShowData,maxpick:1,initfun:"initForComp",selectitem:"m_chooseItem",target:e,arrpick:[]};e.p_tabvGeneral.getComponent("tableView").reload(r),e.m_selectGuid=null,e.m_selectGsid=null,app.pages.generalbaghandbookpage.instance&&cc.isValid(app.pages.generalbaghandbookpage.instance.node)&&app.pages.generalbaghandbookpage.instance.node.active&&app.pages.generalbaghandbookpage.instance.setParam()}))})};if(cc.log("\u6b66\u5c06\u7b49\u7ea7\u9ad8\u4e8e1\u7ea7:"+n+", \u6b66\u5c06\u8d44\u8d28\u9ad8\u4e8e\u7b49\u4e8e6:"+r),n||r){var c={content:langMgr.getString("generalCompPage",2),confirmcb:p,target:this};app.pages.windowspagetipsmsg.showPage(c)}else p()}else app.showNotice(langMgr.getString("generalCompPage",0))},campMenuHandler:function(e){return cc.log("campMenuHandler",e),this.p_tabvGeneral.getComponent("tableView")._isInitTabv?(cc.log("now init tabv no end"),!1):(this.m_campIndex=e,this.m_arrShowData=this.setData(),this.p_tabvGeneral.getComponent("tableView")._isInitTabv=!0,this.refreshView(),!0)},professMenuHandler:function(e){return cc.log("campMenuHandler",e),this.p_tabvGeneral.getComponent("tableView")._isInitTabv?(cc.log("now init tabv no end"),!1):(this.m_professIndex=e,this.m_arrShowData=this.setData(),this.p_tabvGeneral.getComponent("tableView")._isInitTabv=!0,this.refreshView(),!0)},refreshCampMenuRed:function(e){return this.m_arrRed[e]>0},showGeneralEffAnim:function(){var e=this;app.loadSpine("game_ui_spine/level_up/shengji",this.p_spLvUp,function(){cc.log("load succ"),e.p_spLvUp.setAnimation(0,"animation",!1)},null,this.prefabPath)},onClose:function(){this._super(),eventMgr.targetOff(this)},scrollToPick:function(e){var t=this.m_arrShowData.indexOf(e);if(!(t<0)){var a=this.p_tabvGeneral.getComponent("tableView"),i=a.getScrollOffset().y,n=a.cell.data.height,r=a._groupCellCount,o=Math.floor(t/r),s=0!=o?a.top:0,p=(n+a.spacingY)*o+s;p>i&&a.scrollToOffset(cc.v2(0,p),0)}},setCompData:function(e){var t=this.setPreviewData(this.m_arrCondGData[e].cond,e);t=t.sort(function(t,a){var i=app.player.general[t],n=app.player.general[a],r=app.db.getGBaseByGsid(i.gsid),o=app.db.getGBaseByGsid(n.gsid);switch(e){case 1:case 2:return i.level!==n.level?i.level-n.level:r.TGRADE!==o.TGRADE?r.TGRADE-o.TGRADE:n.gsid-i.gsid;default:return 0}});for(var a=this.m_arrCondGData[e].need,i=0;2!==e&&a>0&&i<t.length&&this.m_arrCondGData[e].picked.length<this.m_arrCondGData[e].need;){var n=t[i++];0!==e&&(app.player.checkIsInLimitTeam(n)||app.player.hasBeenSoulBind(n))||this.m_arrAllPicked.includes(n)||this.m_arrCondGData[e].picked.includes(n)||(this.m_arrCondGData[e].picked.push(n),a--)}if(0===e)return t;var r=[];return t.filter(function(e){var t=app.player.checkIsInLimitTeam(e)||app.player.hasBeenSoulBind(e);return t&&r.push(e),!t}).concat(r)},setPreviewData:function(e,t){this.m_arrAllPicked=this.getOtherPicked(t);var a=[],i=[];for(var n in app.player.general)if(!(this.m_arrAllPicked.indexOf(n)>=0||app.player.isSoulGeneral(n))){if(0!==t||this.m_strMain){if(app.player.isOfficialGeneral(n))continue;if(app.player.isRetinueGeneral(n))continue}var r=app.player.general[n];e?this.checkCond(r.gsid,e)&&(app.player.checkIsInLimitTeam(n)?i.push(n):a.push(n)):a.push(n)}a.sort(function(e,t){var a=app.player.general[e],i=app.player.general[t];if(a.star<i.star)return 1;if(a.star==i.star){if(a.level<i.level)return 1;if(a.level==i.level&&a.gsid>i.gsid)return 1}return-1});for(var o=0;o<i.length;++o)a.push(i[o]);return 0===t&&a.sort(function(e,t){var a=app.player.general[e];return app.player.general[t].level-a.level}),a},getOtherPicked:function(e){var t=[];this.m_strMain&&t.push(this.m_strMain);for(var a=0;a<this.m_arrCondGData.length;++a)if(e!=a)for(var i=this.m_arrCondGData[a],n=0;n<i.picked.length;++n)t.push(i.picked[n]);return t},checkCond:function(e,t){if(!t)return!1;if("Array"!=gUtils.getType(t))return t==e;if("Array"==gUtils.getType(t)){for(var a=0;a<t.length;++a)if(!app.db.checkGeneralCond(e,t[a]))return!1;return!0}}});o.refreshRed=function(e){for(var t,i=!1,n=a(app.db.dbGCompList);!(t=n()).done;){var r=t.value;if(app.db.getGBaseByGsid(r)){var o=app.db.isFullComp(r);if(o.HAVE>=o.NEED){i=!0;break}}}return e&&(e.active=i),i},cc._RF.pop()},{basePage:void 0}],generalEquicResetPage:[function(e,t){"use strict";cc._RF.push(t,"98bbaIUnwJMR4Nip2OAaje8","generalEquicResetPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"generalequicresetpage"},properties:{p_labNowName:cc.Label,p_nodeInfo:cc.Node,p_nodeProperty:cc.Node,p_labTitleProperty:cc.Label,p_labTitleSkill:cc.Label,p_nodeLockP:cc.Node,p_nodePickP:cc.Node,p_nodeLockS:cc.Node,p_nodePickS:cc.Node,p_nodeCost:cc.Node,p_arrNodeCost:[cc.Node],p_btnReset:cc.Button,p_btnCancel:cc.Button,p_btnConfirm:cc.Button,p_nodeContent:cc.Node,p_pfbPropItem:cc.Prefab,_mNodeMountItem:null,p_spMountImage:cc.Sprite},onLoad:function(){a.instance=this,this.handleUI(),this.stopBgNodeEvent(),this.creatMask(),this.fitTopMenu()},handleUI:function(){var e=this;this._super(),this.p_btnReset.node.on("click",function(){app.playSound("click"),e.onClickBtnReset()}),this.p_nodeLockP.on("touchend",function(){e.onClickBtnLock("prop")}),this.p_nodeLockS.on("touchend",function(){e.onClickBtnLock("skill")}),this.p_btnConfirm.node.on("click",function(){app.playSound("click"),e.onClickBtnConfirm(1)}),this.p_btnCancel.node.on("click",function(){app.playSound("click"),e.onClickBtnConfirm(0)})},setParam:function(e){this.m_strGuid=e.general,this.m_objData=e.data,this.m_funCb=e.cb,this.m_target=e.target,this.getNextData()},getNextData:function(){var e=this;this.m_arrNextProperty=[],this.m_arrNextSkill=[],this.m_objNewGData=null,app.player.sfExcluPreviewGet(this.m_strGuid,function(t){t?(e.m_arrNextProperty=t.property||[],e.m_arrNextSkill=t.skill||[],e.m_strType="confirm"):e.m_strType="reset",e.refreshUI()})},refreshUI:function(){var e=this.m_objData.gsid,t=this.m_objData.level,a=app.db.getExclusiveById(e,t);switch(this.m_strType){case"reset":this.p_nodeLockP.active=!0,this.p_nodeLockS.active=!0,this.p_btnReset.node.active=!0,this.p_btnCancel.node.active=!1,this.p_btnConfirm.node.active=!1,this.p_nodeCost.active=!0;break;case"confirm":this.p_nodeLockP.active=!1,this.p_nodeLockS.active=!1,this.p_btnReset.node.active=!1,this.p_btnCancel.node.active=!0,this.p_btnConfirm.node.active=!0,this.p_nodeCost.active=!1}this.p_labTitleProperty.string=langMgr.getString("generalEquicResetPage",2),this.p_labTitleSkill.string=langMgr.getString("generalEquicResetPage",3),this.p_nodeLockP.active=0!==this.m_objData.skill.length,this.p_nodePickP.active=!1,this.p_nodePickS.active=!1,this.m_boolLockP=!1,this.m_boolLockS=!1;var i=gConfig.getMountImageByName(a.IMAGE);app.loadTexture(i,this.p_spMountImage,app.getPrefabPathFrom(this)),this.p_labNowName.string=a.NAME,this.refreshProp(),this.refreshSkill(),this.refreshCost()},refreshProp:function(){var e=[];"reset"==this.m_strType&&this.m_boolLockP?this.m_objData.property.forEach(function(t){var a=t;e.push(a)}):this.m_arrNextProperty.forEach(function(t){e.push(t)}),this.p_nodeProperty.getComponent("propertyArrItem").refreshUI(this.m_objData.property,e)},refreshSkill:function(){var e=[],t=app.db.getExclusiveById(this.m_objData.gsid,this.m_objData.level);this.m_boolLockS?(e=[],this.m_objData.skill.forEach(function(t){e.push(t)})):e=this.m_arrNextSkill&&this.m_arrNextSkill.length>0?this.m_arrNextSkill:t.SARR;var a=this.p_nodeInfo.getComponent("skillIExclusUpdateItem").refreshUI(this.m_objData.skill,e,this);this.p_nodeLockS.active=!a&&"reset"==this.m_strType},refreshCost:function(){var e={},t=[],a=app.db.getExclusResetCost(this.m_objData.level),i=a.ITEMS,n=a.ATTR,r=a.SKILL;t=t.concat(i),this.m_boolLockP&&(t=t.concat(n)),this.m_boolLockS&&(t=t.concat(r));for(var o=0;o<t.length;++o)e[t[o].GSID]?e[t[o].GSID].COUNT+=t[o].COUNT:(e[t[o].GSID]={},e[t[o].GSID].COUNT=t[o].COUNT);var s=[];for(var p in e)s.push({GSID:p,COUNT:e[p].COUNT});for(var c=0;c<this.p_arrNodeCost.length;++c)s[c]?(this.p_arrNodeCost[c].active=!0,this.p_arrNodeCost[c].getComponent("costItem").refreshUI(s[c].GSID,s[c].COUNT,this)):this.p_arrNodeCost[c].active=!1;this.m_arrShowCost=s},onClickBtnLock:function(e){switch(e){case"none":this.m_boolLockP=!1,this.m_boolLockS=!1,this.p_nodePickP.active=!1,this.p_nodePickS.active=!1;break;case"prop":this.p_nodePickP.active=!this.p_nodePickP.active,this.m_boolLockP=!!this.p_nodePickP.active,this.m_boolLockP&&(this.p_nodePickS.active=!1,this.m_boolLockS=!1);break;case"skill":this.p_nodePickS.active=!this.p_nodePickS.active,this.m_boolLockS=!!this.p_nodePickS.active,this.m_boolLockS&&(this.p_nodePickP.active=!1,this.m_boolLockP=!1)}this.refreshProp(),this.refreshSkill(),this.refreshCost()},onClickBtnReset:function(){var e=this;if(!this.m_onReset){var t=0;this.m_boolLockP&&(t=1),this.m_boolLockS&&(t=2);for(var a="",i=[],n=0;n<this.m_arrShowCost.length;++n){var r=this.m_arrShowCost[n],o=r.COUNT;app.player.getCount(r.GSID)<o&&(a+="\u3010"+app.db.getPropsName(r.GSID)+"\u3011",i[i.length]=r.GSID)}i.length>0&&app.pages.windowspagesource.showPage(i[0]),a&&""!=a?app.showNotice(langMgr.getString("generalEquicResetPage",0,a)):(this.m_onReset=!0,app.player.sfExcluPreviewFresh(this.m_strGuid,t,function(t,a){if(t)return app.showNotice(t),void(e.m_onReset=!1);var i=[e.m_strGuid];if(app.player.hasBeenSoulBind(e.m_strGuid)){var n=app.player.getSoulBindGuid(e.m_strGuid);n&&i.push(n)}app.player.sfQueryGeneralListInfo(i,function(){app.player.sfPlayerByParam(["others","hide","props"],function(){a&&(e.m_arrNextProperty=a.property||[],e.m_arrNextSkill=a.skill||[]),e.m_strType="confirm",e.refreshUI(),e.m_onReset=!1})})}))}},onClickBtnConfirm:function(e){var t=this;app.player.sfExcluResetConfirm(this.m_strGuid,e,function(a,i){if(a)app.showNotice(a);else{var n=[t.m_strGuid];if(app.player.hasBeenSoulBind(t.m_strGuid)){var r=app.player.getSoulBindGuid(t.m_strGuid);r&&n.push(r)}app.player.sfQueryGeneralListInfo(n,function(){e&&(i.gsid=t.m_objData.gsid,t.m_objData=i),t.m_objNewGData=app.player.general[t.m_strGuid],t.m_strType="reset",t.m_arrNextProperty=[],t.m_arrNextSkill=[],t.refreshUI(),app.player.sfPlayerByParam(["others"],function(){})})}})},onClose:function(){"confirm"!=this.m_strType?(this.m_onReset=!1,this._super(),this.m_objNewGData&&this.m_funCb&&this.m_funCb(this.m_objNewGData)):app.showNotice(langMgr.getString("generalEquicResetPage",1))}});cc._RF.pop()},{basePage:void 0}],generalEquicSkillListPage:[function(e,t){"use strict";cc._RF.push(t,"8d398kwmxRKl5nhpESzdrvF","generalEquicSkillListPage");var a=e("dbExcluSkill"),i=cc.Class({extends:e("basePage"),statics:{prefabPath:"generalequicskilllistpage",pageType:1},properties:{p_tabView:cc.Node},onLoad:function(){i.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.creatMask(!0),this.refreshUI()},handleUI:function(){this._super()},start:function(){},refreshUI:function(){var e=this.setData(),t=e.length;this.p_tabView.getComponent("tableView").initTableView(t,{array:e,target:this})},setData:function(){var e=[];for(var t in a)e.push(t);return e}});cc._RF.pop()},{basePage:void 0,dbExcluSkill:void 0}],generalEquicUpPage:[function(e,t){"use strict";cc._RF.push(t,"60aafaNAAhDF6Xte+g/rPFm","generalEquicUpPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"generalequicuppage"},properties:{p_labNowName:cc.Label,p_labNextName:cc.Label,p_nodeInfo:cc.Node,p_nodeProperty:cc.Node,p_nodeLockP:cc.Node,p_nodePick:cc.Node,p_arrNodeCostUp:[cc.Node],p_btnUp:cc.Button,p_pfbPropItem:cc.Prefab,p_arrMountContents:[cc.Node],_mArrMountItems:[],p_spMountImage:cc.Sprite},onLoad:function(){a.instance=this,this.handleUI(),this.stopBgNodeEvent(),this.creatMask(),this.fitTopMenu()},handleUI:function(){var e=this;this._super(),this.p_btnUp.node.on("click",function(){app.playSound("click"),e.onClickBtnUp()}),this.p_nodeLockP.on("touchend",function(){e.onClickBtnLock()})},setParam:function(e){this.m_strGuid=e.general,this.m_objData=e.data,this.m_funCb=e.cb,this.m_target=e.target,this.getNextData()},getNextData:function(){this.p_nodePick.active=!1,this.m_arrNextProperty=[],this.m_arrNextSkill=[],this.m_objNewGData=null,this.refreshUI()},refreshUI:function(){var e=this.m_objData.gsid,t=this.m_objData.level,a=app.db.getExclusiveById(e,t),i=app.db.getExclusiveById(e,t+1),n=gConfig.getMountImageByName(a.IMAGE);if(app.loadTexture(n,this.p_spMountImage,app.getPrefabPathFrom(this)),this.p_labNowName.string=a.NAME,!cc.isValid(this._mArrMountItems[1])){var r=cc.instantiate(this.p_pfbPropItem);this._mArrMountItems[1]=r,this.p_arrMountContents[1].parent.addChild(r),r.setPosition(this.p_arrMountContents[1].getPosition())}cc.isValid(this._mArrMountItems[1])&&this._mArrMountItems[1].active&&(this._mArrMountItems[1].getComponent("propItem").initForGExclus(e,t+1),this.p_labNextName.string=i.NAME),this.p_nodePick.active=!1,this.m_boolLock=!1,this.refreshProp(),this.refreshSkill(),this.refreshCost()},refreshProp:function(e){var t=this;e?this.m_objData.property.forEach(function(e){var a=e;t.m_arrNextProperty.push(a)}):this.m_arrNextProperty=[],this.p_nodeProperty.getComponent("propertyArrItem").refreshUI(this.m_objData.property,this.m_arrNextProperty)},refreshSkill:function(e){var t=app.db.getExclusiveById(this.m_objData.gsid,this.m_objData.level+1).SARR;e&&(t=[],this.m_objData.skill.forEach(function(e){t.push(e)})),this.p_nodeInfo.getComponent("skillIExclusUpdateItem").refreshUI(this.m_objData.skill,t,this)},refreshCost:function(){var e={},t=[],a=app.db.getExclusLvCost(this.m_objData.level+1),i=a.ITEMS,n=a.LOCK;t=t.concat(i),this.m_boolLock&&(t=t.concat(n));for(var r=0;r<t.length;++r)e[t[r].GSID]?e[t[r].GSID].COUNT+=t[r].COUNT:(e[t[r].GSID]={},e[t[r].GSID].COUNT=t[r].COUNT);var o=[];for(var s in e)o.push({GSID:s,COUNT:e[s].COUNT});for(var p=0;p<this.p_arrNodeCostUp.length;++p)o[p]?(this.p_arrNodeCostUp[p].getComponent("costItem").refreshUI(o[p].GSID,o[p].COUNT,this),this.p_arrNodeCostUp[p].active=!0):this.p_arrNodeCostUp[p].active=!1;this.m_arrShowCost=o},onClickSkill:function(e,t){var a=this.m_objData.skill[e];"right"==t&&(a=this.m_arrNextSkill[e]);var i={type:"special",gsid:a};app.pages.windowspagetipsskill.showPage(i)},onClickBtnUp:function(){var e=this;if(!this.m_onUp){for(var t="",a=[],i=0;i<this.m_arrShowCost.length;++i){var n=this.m_arrShowCost[i],r=n.COUNT;app.player.getCount(n.GSID)<r&&(t+="\u3010"+app.db.getPropsName(n.GSID)+"\u3011",a[a.length]=n.GSID)}if(a.length>0&&app.pages.windowspagesource.showPage(a[0]),t&&""!=t)app.showNotice(langMgr.getString("generalEquicUpPage",0,t));else{var o=this;this.m_onUp=!0;var s=this.m_boolLock?1:0;app.player.sfExcluLevel(this.m_strGuid,s,function(t,a){if(t)return app.showNotice(t),void(e.m_onUp=!1);if(app.player.hasBeenSoulBind(e.m_strGuid)){var i=app.player.getSoulBindGuid(e.m_strGuid);i&&app.player.sfQueryGeneralListInfo([i])}app.player.addGeneral(a),e.m_objNewGData=a,app.player.reduceItem(e.m_arrShowCost);var n={showtype:1,reward:[{gsid:a.exclusive.gsid,count:1,level:a.exclusive.level}],target:o,confirmcb:function(){a.exclusive.level>=app.db.getExclusMaxLv()?e.onClose():(e.m_objData=a.exclusive,e.refreshUI()),e.m_onUp=!1}};app.pages.windowspagereward.showPage(n),app.player.sfPlayerByParam(["others","props"],function(){})})}}},onClickBtnLock:function(){this.p_nodePick.active=!this.p_nodePick.active,this.m_boolLock=!!this.p_nodePick.active,this.refreshCost(),this.refreshProp(this.m_boolLock),this.refreshSkill(this.m_boolLock)},onClose:function(){this.m_onUp=!1,this._super(),this.m_objNewGData&&this.m_funCb&&this.m_funCb(this.m_objNewGData)}});cc._RF.pop()},{basePage:void 0}],generalManagePage:[function(e,t){"use strict";cc._RF.push(t,"f7c91N2s7ZDo5hIU3pMyt3s","generalManagePage");var a=[{page:"exchangepage",coin:[30013,30012,30011]},{page:"carddrawpage",coin:[30013,30012,30011]}],i=cc.Class({extends:e("basePage"),statics:{prefabPath:"generalmanagepage"},properties:{p_nodeBg:cc.Node},onLoad:function(){i.instance=this,this.stopNodeEvent(),this.handleUI(),this.fitTopMenu(100),this.m_menu=this.node.getComponent("menu"),this.m_menu.init(this)},onEnable:function(){this.addEvent()},onDisable:function(){this.removeEvent()},addEvent:function(){var e=this;cc.director.on("EVT_SET_ANIM_MASK_VISIBLE",function(t){cc.isValid(e._animMask)||(e._animMask=e.createAnimMask()),e._animMask.active=t},this)},removeEvent:function(){cc.director.targetOff(this)},setParam:function(e){e=e||0==e?e:1,this.m_menu.setMenuIndex(e)},openCardPage:function(e){var t=this,i=app.pages[a[e].page];this.m_arrCoin=a[e].coin,this.refreshCoinUI();var n=function(){i.showPage(null,t.p_nodeBg,function(){t.m_showPage=i.instance,t.m_showPage.node.opacity=0,t.m_showPage.node.runAction(cc.fadeIn(.2))})};this.m_showPage?(this.m_showPage.node.active=!0,this.m_showPage.node.runAction(cc.sequence(cc.fadeOut(.2),cc.callFunc(function(){t.m_showPage.onClose(),t.m_showPage=null,n()})))):n()},menuHandler:function(e){return this.m_index=e,!!a[e]&&(this.openCardPage(e),!0)},refreshCoinUI:function(){this.node.getComponent("currency").refreshCoin(this.m_arrCoin)},onClose:function(){app.pages.newworldmappage.instance&&cc.isValid(app.pages.newworldmappage.instance)&&app.pages.newworldmappage.instance.refreshAchive(),this.m_showPage&&cc.isValid(this.m_showPage.node)&&this.m_showPage.onClose(),this._super()},createAnimMask:function(){var e=new cc.Node("AnimMask");return this.node.addChild(e),e.setContentSize(this.node.getContentSize()),e.setPosition(cc.Vec2.ZERO),e.addComponent(cc.BlockInputEvents),e}});i.refreshRed=function(){return!1},cc._RF.pop()},{basePage:void 0}],generalPageBook:[function(e,t){"use strict";cc._RF.push(t,"4ce60Jhn1BDOJstJZb62AJh","generalPageBook");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=cc._decorator,o=r.ccclass,s=r.property,p=["hp","atk","def","mdef"],c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_nodeBag=null,t.p_tabView=null,t.p_nodeproperty=null,t.p_btnBook=null,t.p_btnSYN=null,t.p_btnSplit=null,t.p_arrNodeBook=[],t.p_arrNodeBookPlus=[],t.p_arrNodeBRed=[],t.p_nodeBook=null,t.p_arrLabProperty=[],t.p_btnOn=null,t.p_nodeOnRed=null,t.p_btnOff=null,t.p_sprSuitIcon=null,t.p_btnBookProp=null,t.p_btnSuitSkill=null,t.p_arrNodePos=[],t.p_arrNodePosLight=[],t.p_nodeSelectStar=null,t.p_labSelectStar=null,t.p_nodeSecelt=null,t.p_arrNodeSelect=[],t.p_btnBagClose=null,t.p_arrLabSuitProp=[],t.p_nodeNoProp=null,t.p_labSkillIntro=null,t.p_nodeSuitSkill=null,t.p_nodeSkillMask=null,t.p_spfNormalSkill=null,t.p_animNode=null,t.p_animPower_01=null,t.p_animPower_02=null,t.p_animPower_03=null,t.p_nodePowerNum=null,t.labSuitTitles=[],t.colSuitLab=[],t.colSuitLabOutline=[],t.p_labBagTitle=null,t.p_spDressAnimArr=[],t.p_spUnlockAnim=null,t.m_generalInfo=null,t.m_generalGuid=null,t.m_bagPos=0,t.m_bagStar=0,t.m_objParent=null,t.m_isClick=!0,t}return i(t,e),t.prototype.onLoad=function(){var e=this;this.p_nodeNoProp.getComponent(cc.Label).string=langMgr.getString("bookResolvePage",11),this.labSuitTitles.forEach(function(e,t){return e.string=langMgr.getString("bookResolvePage",10,2*(t+1))}),this.p_labBagTitle.string=langMgr.getString("generalPageBook",6),this.p_nodeBag.active=!1,this.p_nodeSkillMask.active=!1,this.p_arrNodeBookPlus.forEach(function(t,a){t.on("touchend",function(){e.p_nodeproperty.active=!1,e.p_nodeBag.active=!0,e.onClickBookPosStar(a+1,-1)})}),this.p_btnBook.node.on("click",function(){app.playSound("click"),e.p_nodeproperty.active=!1,e.p_nodeBag.active=!0,e.onClickBookPosStar(0,0)}),this.p_btnSYN.node.on("click",function(){app.playSound("click"),app.pages.bookCompoundPage.showPage()}),this.p_btnSplit.node.on("click",function(){app.playSound("click"),app.pages.bookResolvePage.showPage()}),this.p_btnOn.node.on("click",function(){if(e.m_isClick){e.m_isClick=!1,app.playSound("click");var t=e.m_generalInfo.power;app.player.sfBookYijian(e.m_generalGuid,function(a,i){a?e.m_isClick=!0:app.player.sfPlayerByParam(["books"],function(){e.m_isClick=!0,e.m_objParent.refreshInfo(i),e.setData(),e.refreshPosStar(),e.p_spDressAnimArr.forEach(function(e){return e.setAnimation(0,"animation",!1)}),e.animPower(e.m_generalInfo.power,t)})})}}),this.p_btnOff.node.on("click",function(){if(e.m_isClick){e.m_isClick=!1,app.playSound("click");var t=e.m_generalInfo.power;app.player.sfBookYjOff(e.m_generalGuid,function(a,i){a?e.m_isClick=!0:app.player.sfPlayerByParam(["books"],function(){e.m_isClick=!0,e.m_objParent.refreshInfo(i),e.setData(),e.refreshPosStar(),e.animPower(e.m_generalInfo.power,t)})})}}),this.p_arrNodePos.forEach(function(t,a){t.on("touchend",function(){e.onClickBookPosStar(a,-1)})}),this.p_arrNodeSelect.forEach(function(t,a){t.on("touchend",function(){e.p_nodeSecelt.active=!1,e.onClickBookPosStar(-1,a)})}),this.p_nodeSelectStar.on("touchend",function(){e.p_nodeSecelt.active=!e.p_nodeSecelt.active,e.p_nodeSelectStar.angle=e.p_nodeSecelt.active?0:180}),this.p_btnBagClose.node.on("click",function(){app.playSound("click"),e.p_nodeBag.active=!1,e.p_nodeproperty.active=!0,e.m_bagStar=0,e.m_bagPos=0}),this.p_nodeSuitSkill.on("touchend",function(){app.playSound("click"),e.clickSkill()}),this.p_btnSuitSkill.node.on("click",function(){app.playSound("click"),e.clickSkill()}),this.p_btnBookProp.node.on("click",function(){app.playSound("click");var t=e.getBookProp();app.pages.generalattributedetailedpage.showPage(t)}),cc.director.on("EVT_PLAY_BOOK_POWER_ANIM",function(t){var a=t.curPower,i=t.beforePower;e.animPower(a,i)},this)},t.prototype.onEnable=function(){eventMgr.on(eventStr.generalPageBook.RefreshBook,this.setData,this),eventMgr.on(eventStr.generalPageBook.RefreshBookBag,this.refreshPosStar,this),eventMgr.on(eventStr.generalPageBook.ShowBookBag,this.showBookBag,this)},t.prototype.onDisable=function(){eventMgr.off(eventStr.generalPageBook.RefreshBook,this.setData,this),eventMgr.off(eventStr.generalPageBook.RefreshBookBag,this.refreshPosStar,this),eventMgr.off(eventStr.generalPageBook.ShowBookBag,this.showBookBag,this)},t.prototype.start=function(){},t.prototype.init=function(e){this.m_objParent=e},t.prototype.refreshUI=function(e){this.m_generalGuid=e,this.setData(),this.onClickBookPosStar()},t.prototype.setData=function(){this.m_generalInfo=app.player.general[this.m_generalGuid],this.refreshBookEquip(),this.refreshBookProperty()},t.prototype.showBookBag=function(e){this.p_nodeproperty.active=!1,this.p_nodeBag.active=!0,this.onClickBookPosStar(e)},t.prototype.refreshBookEquip=function(){for(var e=this.m_generalInfo.book,t=0;t<this.p_arrNodeBook.length;t++){var a=e?e[t]:null,i=this.p_arrNodeBook[t];a?(this.p_arrNodeBookPlus[t].active=!1,i.getComponent("bookEquip").refreshUI({book:a,general:this.m_generalGuid,target:this}),i.active=!0):(this.p_arrNodeBookPlus[t].active=!0,i.active=!1),this.p_arrNodeBRed[t].active=app.pages.generalbaghandbookpage.checkBook(this.m_generalGuid,t)}if(this.m_generalInfo.bookskill&&this.m_generalInfo.bookskill[0]){this.p_nodeSkillMask.active&&(this.p_spUnlockAnim.node.active=!0,this.p_spUnlockAnim.setAnimation(0,"mj_eff_item_frame_glow03",!1)),this.p_nodeSkillMask.active=!1;var n=app.db.getBookSuitIconPath(e[0].suit,e[0].star);app.loadTexture(n,this.p_sprSuitIcon,app.getPrefabPathFrom(this.m_objParent))}else this.p_nodeSkillMask.active=!0,this.p_sprSuitIcon.spriteFrame=this.p_spfNormalSkill},t.prototype.onClickBookPosStar=function(e,t){if(void 0===e&&(e=-1),void 0===t&&(t=-1),e>-1&&(this.m_bagPos=e,this.p_arrNodePosLight.forEach(function(t,a){t.active=a==e})),t>-1){this.m_bagStar=t;var a=void 0;switch(t){case 0:a=window.langMgr.getString("bookResolvePage",2);break;case 1:a=window.langMgr.getString("bookResolvePage",3);break;case 2:a=window.langMgr.getString("bookResolvePage",4);break;case 3:a=window.langMgr.getString("bookResolvePage",5);break;case 4:a=window.langMgr.getString("bookResolvePage",6);break;case 5:a=window.langMgr.getString("bookResolvePage",7);break;case 6:a=window.langMgr.getString("bookResolvePage",8)}this.p_labSelectStar.string=a}this.refreshBookBag()},t.prototype.refreshBookBag=function(){var e=this.setBookData(),t=e.length;this.p_tabView.getComponent("tableView").initTableView(t,{array:e,general:this.m_generalGuid,target:this})},t.prototype.refreshRed=function(){for(var e=!1,t=0;t<4;++t)if(app.pages.generalbaghandbookpage.checkBook(this.m_generalGuid,t)){e=!0;break}this.p_nodeOnRed.active=e,cc.director.emit("EVT_REFRESH_BOOK_RED")},t.prototype.refreshBookProperty=function(){var e=this.getBookProperty();this.p_arrLabProperty.forEach(function(t,a){t.string=Math.round(e[p[a]]||0).toString()});for(var t=this.m_generalInfo.book,a=0,i=0,n=0,r=0;r<t.length;r++)if(t[r]){i||(i=t[r].suit),n&&t[r].star,n=t[r].star;var o=app.db.getBSetNumByGuid(t[r].suit,this.m_generalGuid);o>a&&(a=o)}if(i){this.p_nodeNoProp.active=!1;var s=app.db.getSuitBookById(i,n).PROP;for(r=0;r<s.length;r++){var c=app.db.getPropertyCnByEn(s[r].KEY),h=s[r].VAL,l=app.db.getPropertyIdByEn(s[r].KEY);l&&2==app.db.dbProperty[l].NUMTYPE&&(h=h/10+"%"),this.p_arrLabSuitProp[r].node.parent.active=!0,a>=2*(r+1)?(this.p_arrLabSuitProp[r].string=window.langMgr.getString("generalPageBook",0,[c,h]),this.p_arrLabSuitProp[r].node.color=this.colSuitLab[0],this.p_arrLabSuitProp[r].getComponent(cc.LabelOutline).color=this.colSuitLabOutline[0]):(this.p_arrLabSuitProp[r].string=window.langMgr.getString("generalPageBook",1,[c,h]),this.p_arrLabSuitProp[r].node.color=this.colSuitLab[1],this.p_arrLabSuitProp[r].getComponent(cc.LabelOutline).color=this.colSuitLabOutline[1])}}else this.p_nodeNoProp.active=!0,this.p_arrLabSuitProp.forEach(function(e){e.node.parent.active=!1});var g=this.m_generalInfo.bookskill?this.m_generalInfo.bookskill[0]:0;if(g){var d=app.db.getSuitSkillInfoBySuitId(g);this.p_labSkillIntro.string=d.INTRO}else this.p_labSkillIntro.string=window.langMgr.getString("generalPageBook",2)},t.prototype.getBookProperty=function(){for(var e={},t=this.m_generalInfo.book,a=0;a<t.length;a++)if(t[a]){var i=t[a].attr;for(var n in i)e[n]?e[n]+=i[n]:e[n]=i[n]}return e},t.prototype.refreshPosStar=function(e,t){void 0===e&&(e=-1),void 0===t&&(t=-1),this.onClickBookPosStar(e,t)},t.prototype.setBookData=function(){var e=this,t=app.player.books,a=[];for(var i in t){var n=t[i].gsid,r=app.db.getBBaseByGsid(n);this.m_bagPos?this.m_bagStar?r.POS==this.m_bagPos&&r.STAR==this.m_bagStar&&a.push(i):r.POS==this.m_bagPos&&a.push(i):this.m_bagStar?r.STAR==this.m_bagStar&&a.push(i):a.push(i)}return a.sort(function(t,a){var i=app.player.books[t],n=app.player.books[a],r=app.db.getBBaseByGsid(i.gsid),o=app.db.getBBaseByGsid(n.gsid);if(r.STAR>o.STAR)return-1;if(r.STAR==o.STAR){if(i.level>n.level)return-1;if(i.level==n.level&&e.checkOccu(r)>e.checkOccu(o))return-1}return 1}),a},t.prototype.checkOccu=function(e){for(var t=e.OCCU,a=0;a<t.length;a++)if(this.m_generalInfo.occu==t[a]||this.m_generalInfo.occu2&&this.m_generalInfo.occu2==t[a])return 1;return-1},t.prototype.clickSkill=function(){if(this.m_generalInfo.bookskill&&this.m_generalInfo.bookskill[0]){var e={skillId:this.m_generalInfo.bookskill[0],suitId:this.m_generalInfo.book[0].suit};app.pages.bookSkillPreviewPage.showPage(e)}else app.showNotice(window.langMgr.getString("generalPageBook",3))},t.prototype.getBookProp=function(){for(var e=this.m_generalInfo.book,t={},a=0;a<e.length;a++)if(e[a]){var i=e[a].attr;for(var n in i)t[n]?t[n]+=i[n]:t[n]=i[n]}return t},t.prototype.animPower=function(e,t){cc.log("beforePower"+t+", curPower: "+e)},n([s(cc.Node)],t.prototype,"p_nodeBag",void 0),n([s(cc.Node)],t.prototype,"p_tabView",void 0),n([s(cc.Node)],t.prototype,"p_nodeproperty",void 0),n([s(cc.Button)],t.prototype,"p_btnBook",void 0),n([s(cc.Button)],t.prototype,"p_btnSYN",void 0),n([s(cc.Button)],t.prototype,"p_btnSplit",void 0),n([s(cc.Node)],t.prototype,"p_arrNodeBook",void 0),n([s(cc.Node)],t.prototype,"p_arrNodeBookPlus",void 0),n([s(cc.Node)],t.prototype,"p_arrNodeBRed",void 0),n([s(cc.Node)],t.prototype,"p_nodeBook",void 0),n([s(cc.Label)],t.prototype,"p_arrLabProperty",void 0),n([s(cc.Button)],t.prototype,"p_btnOn",void 0),n([s(cc.Node)],t.prototype,"p_nodeOnRed",void 0),n([s(cc.Button)],t.prototype,"p_btnOff",void 0),n([s(cc.Sprite)],t.prototype,"p_sprSuitIcon",void 0),n([s(cc.Button)],t.prototype,"p_btnBookProp",void 0),n([s(cc.Button)],t.prototype,"p_btnSuitSkill",void 0),n([s(cc.Node)],t.prototype,"p_arrNodePos",void 0),n([s(cc.Node)],t.prototype,"p_arrNodePosLight",void 0),n([s(cc.Node)],t.prototype,"p_nodeSelectStar",void 0),n([s(cc.Label)],t.prototype,"p_labSelectStar",void 0),n([s(cc.Node)],t.prototype,"p_nodeSecelt",void 0),n([s(cc.Node)],t.prototype,"p_arrNodeSelect",void 0),n([s(cc.Button)],t.prototype,"p_btnBagClose",void 0),n([s(cc.Label)],t.prototype,"p_arrLabSuitProp",void 0),n([s(cc.Node)],t.prototype,"p_nodeNoProp",void 0),n([s(cc.Label)],t.prototype,"p_labSkillIntro",void 0),n([s(cc.Node)],t.prototype,"p_nodeSuitSkill",void 0),n([s(cc.Node)],t.prototype,"p_nodeSkillMask",void 0),n([s(cc.SpriteFrame)],t.prototype,"p_spfNormalSkill",void 0),n([s(cc.Animation)],t.prototype,"p_animNode",void 0),n([s(cc.Animation)],t.prototype,"p_animPower_01",void 0),n([s(cc.Animation)],t.prototype,"p_animPower_02",void 0),n([s(cc.Animation)],t.prototype,"p_animPower_03",void 0),n([s(cc.Node)],t.prototype,"p_nodePowerNum",void 0),n([s([cc.Label])],t.prototype,"labSuitTitles",void 0),n([s([cc.Color])],t.prototype,"colSuitLab",void 0),n([s([cc.Color])],t.prototype,"colSuitLabOutline",void 0),n([s(cc.Label)],t.prototype,"p_labBagTitle",void 0),n([s([sp.Skeleton])],t.prototype,"p_spDressAnimArr",void 0),n([s(sp.Skeleton)],t.prototype,"p_spUnlockAnim",void 0),n([o],t)}(cc.Component);t.exports=c,cc._RF.pop()},{}],generalPageCompound:[function(e,t){"use strict";function a(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(a)return(a=a.call(e)).next.bind(a);if(Array.isArray(e)||(a=i(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function i(e,t){if(e){if("string"==typeof e)return n(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?n(e,t):void 0}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,i=new Array(t);a<t;a++)i[a]=e[a];return i}cc._RF.push(t,"63e8a8jbedFf64Hfk0zFXy8","generalPageCompound");var r=["HP","ATK","DEF","MDEF"],o=cc.Class({extends:cc.Component,properties:{p_nodeProp:cc.Node,p_arrLabProp:[cc.Label],p_arrNodePick:[cc.Node],p_btnComp:cc.Button,p_btnHelp:cc.Button,p_campMenu:e("campMenu"),p_tabvGeneral:cc.tableView,p_scrvGeneral:cc.ScrollView,p_prebGeneral:cc.Prefab,p_nodeContent:cc.Node,hierarchyContents:[cc.Node]},statics:{checkComp:function(e){for(var t=!0,a=0;a<e.length;++a){if(!e[a]){t=!1;break}var i=e[a].need;if(e[a].picked.length<i){t=!1;break}}return t}},onLoad:function(){this.handleUI()},handleUI:function(){var e=this;this.p_arrNodePick.forEach(function(t,a){t.on("touchend",function(){e.onClickCond(a)})}),this.p_btnComp.node.on("click",function(){app.playSound("click"),e.onClickComp()}),this.p_btnHelp.node.on("click",function(){app.pages.windowspagetipshelp.showPage("\u5c01\u795e",app.mainScene.p_nodeBg)})},refreshUI:function(){this.p_campMenu.target=this,this.p_campMenu.setMenuIndex(0)},refreshData:function(){this.m_arrShowData=this.setData(),this.m_arrCondGData=this.setCondGData()},refreshMain:function(e){if(app.pages.generalpage.instance.refreshMain(e),this.p_nodeProp.active=!!e,e){var t=app.db.calGPropNoEquip(e,100,0);cc.log(t),this.p_arrLabProp.forEach(function(e,a){e.string=t[r[a]]})}},refreshComp:function(){for(var e=0;e<this.p_arrNodePick.length;++e)this.m_arrCondGData[e]?(this.p_arrNodePick[e].active=!0,this.p_arrNodePick[e].getComponent("generalPortraitItem").initForAwake(e,this.m_arrCondGData)):this.p_arrNodePick[e].active=!1;this.p_btnComp.node.active=this.m_arrCondGData.length>0},refreshView:function(){var e=this;this.m_arrPickedId=[],this.m_strNowCompGsid=null,this.m_chooseItem=null;var t=this.m_arrShowData.length;this.p_tabvGeneral.initTableView(t,{array:this.m_arrShowData,maxpick:1,initfun:"initForComp",target:this},function(){(!e.m_arrPickedId||e.m_arrPickedId.length<=0)&&e.p_tabvGeneral.getContentChildByTag(0).children[0].getComponent("generalTabvItem").clicked(),cc.log("now init tavbv status",e.p_tabvGeneral._isInitTabv)})},refreshSView:function(){for(var e=this.m_arrShowData.length,t=(this.p_nodeContent.childrenCount,0);t<e;++t){var a=this.p_nodeContent.children[t];a||((a=cc.instantiate(this.p_prebGeneral)).parent=this.p_nodeContent),a.getComponent("generalPortraitItem").initForComp(this.m_arrShowData[t])}this.p_nodeContent.getComponent(cc.Layout).updateLayout(),this.p_nodeContent.parent.height=this.p_nodeContent.height,this.OptimizeDC(this.p_nodeContent.children)},OptimizeDC:function(e){cc.log(e);for(var t,i=[["icon_bg"],["icon"],["tx_present","level","level_small","name","name_small"],["star"],["portrait_country_icon"],["portrait_gtype_icon"],["g_exp"]],n=a(e);!(t=n()).done;)for(var r=t.value,o=0;o<i.length;o++)for(var s=i[o],p=this.hierarchyContents[o],c=0;c<s.length;c++){var h=s[c],l=cc.find(h,r);cc.log(h,r,l);var g=p.convertToNodeSpaceAR(l.convertToWorldSpaceAR(cc.Vec2.ZERO));l.parent=p,l.position=g,l.zIndex=c}},setData:function(){var e=app.db.dbGCompList,t=[];app.GCompData={},this.m_arrRed=[0,0,0,0,0,0];for(var i,n=a(e);!(i=n()).done;){var r=i.value,o=app.db.getGBaseByGsid(r);if(o){var s=app.db.isFullComp(r),p=this.m_arrRed[o.CAMP-1];s.ISFULL&&(this.m_arrRed[o.CAMP-1]=p+1),app.GCompData[r]=s,-1!=this.m_campIndex&&this.m_campIndex!=o.CAMP-1||t.push(r)}}return t.sort(function(e,t){var a=app.db.getGBaseByGsid(e),i=app.GCompData[e].ISFULL,n=app.db.getGBaseByGsid(t),r=app.GCompData[t].ISFULL;if(i<r)return 1;if(i==r){if(a.STAR>n.STAR)return 1;if(a.STAR==n.STAR&&a.GSID>n.GSID)return 1}return-1}),t},setCondGData:function(e){var t=[];if(!e)return t;var a=app.db.getCompByGsid(e);if(!a)return t;var i={};i.cond=a.MAIN,i.need=1,i.picked=[],t.push(i);for(var n=a.CONS,r=0;r<n.length;++r){var o={};o.cond=n[r].COND,o.need=n[r].COUNT,o.picked=[],t.push(o)}return cc.log("now condGData is",t),t},itemClick:function(e,t){return e==this.m_strNowCompGsid||(this.m_chooseItem&&(cc.log("handle choose item"),this.m_chooseItem.selected(!1,this.m_strNowCompGsid)),this.m_chooseItem=t,this.m_strNowCompGsid=e,this.refreshMain(e),this.m_arrCondGData=this.setCondGData(e),this.refreshComp(),!0)},onClickCond:function(e){var t={};t.index=e,t.arrcond=this.m_arrCondGData,t.cb=this.refreshComp,t.target=this,app.pages.windowspagelistgeneral.showPage(t)},onClickComp:function(){var e=this,t=this.m_strNowCompGsid,a=this.m_arrCondGData[0].picked[0],i=[];if(o.checkComp(this.m_arrCondGData)){for(var n=1;n<this.m_arrCondGData.length;++n)this.m_arrCondGData[n]&&i.push(this.m_arrCondGData[n].picked);cc.log(t,a,i);var r=app.player.general[a];app.player.sfGeneralAwake(t,a,i,function(t,i){t?app.showNotice(t):(app.showNotice(langMgr.getString("generalPageCompound",1)),app.playSound("plevelup"),app.pages.generalpage.instance.showGeneralEffAnim(),app.player.sfPlayerData(function(){var t={old:r,new:app.player.general[a],items:i.items};app.pages.windowspagegstarsucc.showPage(t),e.m_arrCondGData=e.setCondGData(e.m_strNowCompGsid),e.m_arrShowData=e.setData(),e.refreshComp();var n={array:e.m_arrShowData,maxpick:1,initfun:"initForComp",selectitem:"m_chooseItem",target:e};e.p_tabvGeneral.reload(n)}))})}else app.showNotice(langMgr.getString("generalPageCompound",0))},campMenuHandler:function(e){return cc.log("campMenuHandler",e),this.p_tabvGeneral._isInitTabv?(cc.log("now init tabv no end"),!1):(this.m_campIndex=e,this.m_arrShowData=this.setData(),this.p_tabvGeneral._isInitTabv=!0,this.refreshView(),!0)},refreshCampMenuRed:function(e){return this.m_arrRed[e]>0}});cc._RF.pop()},{campMenu:void 0}],generalPageInfo:[function(e,t){"use strict";cc._RF.push(t,"280beFN/ThDVpJrpg0VWsMw","generalPageInfo");var a=["hp","atk","def","mdef"],i=[10,12,14];cc.Class({extends:cc.Component,properties:{p_arrNodeEquip:[cc.Node],p_arrNodePlus:[cc.Node],p_nodeExLock:cc.Node,p_nodeExActive:cc.Node,p_labPower:cc.Label,p_btnLock:cc.Button,p_btnShare:cc.Button,p_btnDiscuss:cc.Button,p_btnGonglve:cc.Button,p_btnEquipOn:cc.Button,p_btnEquipOff:cc.Button,p_nodeLevel:cc.Node,p_arrNodeClass:[cc.Node],p_arrNodeNowClass:[cc.Node],p_nodeCost:cc.Node,p_labCost1:cc.Label,p_labCost2:cc.Label,p_labCostTips:cc.Label,p_btnUp:cc.Button,p_sprUpLv:cc.Sprite,p_sprUpClass:cc.Sprite,p_labLv:cc.Label,p_arrLabProperty:[cc.Label],p_arrNodeSkill:[cc.Node],p_nodeStar:cc.Node,p_sprNowStar:cc.Sprite,p_sprNextStar:cc.Sprite,p_labNowMaxLv:cc.Label,p_labNextMaxLv:cc.Label,p_labStarUpTips:cc.Label,p_labStarBackTips:cc.Label,p_arrNodeGeneral:[cc.Node],p_btnStarUp:cc.Button,p_nodeCostStar:cc.Node,p_labCostStar:cc.Label,p_nodeWuhun:cc.Node,p_arrWuhunDizuo:[cc.Node],p_arrWuhunSkill:[cc.Node],p_arrWuhunPlus:[cc.Node],p_arrWuhunBoxDi:[cc.Node],p_arrWuhunBox:[cc.Node],p_arrWuhunLock:[cc.Node],p_arrWuhunLockLab:[cc.Node],p_animNode:cc.Animation,p_animPower_01:cc.Animation,p_animPower_02:cc.Animation,p_animPower_03:cc.Animation,p_nodePowerNum:cc.Node,p_btnSearch:cc.Button},onLoad:function(){this.handleUI(),this.m_arrObjCondGeneral=[],this.m_colorCost=this.p_labCost1.node.color.clone(),this.menu2Pos=this.p_arrNodeMenu[2].position,this.maxSpace=200,this.toucheduprank=!1,this.p_btnGonglve.node.active=!1,this.m_arrShowTips={4:langMgr.getString("generalPageInfo",5),5:langMgr.getString("generalPageInfo",6),6:langMgr.getString("generalPageInfo",7),7:langMgr.getString("generalPageInfo",7),8:langMgr.getString("generalPageInfo",7),9:langMgr.getString("generalPageInfo",8),10:langMgr.getString("generalPageInfo",9),11:langMgr.getString("generalPageInfo",10)}},start:function(){},handleUI:function(){var e=this;this.p_btnEquipOn.node.on("click",function(){app.playSound("click"),e.onClickEquipOn()}),this.p_btnEquipOff.node.on("click",function(){app.playSound("click"),e.onClickEquipOff()}),this.p_btnUp.node.on(cc.Node.EventType.TOUCH_START,function(){e.toucheduprank=!0,e.isLongPressCheck=!1,e.lastTouch=Date.now()}),this.p_btnUp.node.on(cc.Node.EventType.TOUCH_CANCEL,function(){e.toucheduprank=!1}),this.p_btnUp.node.on(cc.Node.EventType.TOUCH_END,function(){e.toucheduprank=!1,e.isLongPressCheck?(app.guideProgress>8&&app.guideProgress<10||app.guideProgress>13&&app.guideProgress<15)&&event.stopPropagation():(app.playSound("click"),e.onClickBtnUp())}),this.p_arrNodeSkill.forEach(function(t,a){t.on("touchend",function(){e.onClickSkill(a)})}),this.p_btnStarUp.node.on("click",function(){app.playSound("click"),e.onClickBtnStarUp()}),this.p_btnSearch.node.on("click",function(){e.m_objGData&&app.pages.generalattributedetailedpage.showPage(e.m_objGData.guid)}),gSetting.funofhide&&(this.p_btnGonglve.node.active=!1)},onDisable:function(){this.toucheduprank=!1,this.lastTouch=Date.now()},update:function(){this.toucheduprank&&Date.now()-this.lastTouch>this.maxSpace&&(this.lastTouch=Date.now(),this.isLongPressCheck=!0,-1!=app.arrPages[app.arrPages.length-1].indexOf("generalpage")?this.onClickBtnUp():this.toucheduprank=!1)},refreshUI:function(e){this.refreshData(e)},refreshData:function(e){switch(this.m_objGData=e,this.p_btnSearch.node.active=!0,this.m_objGData={},this.m_numShowType){case 0:break;case 1:this.m_objGData=e,this.p_btnSearch.node.active=!0;break;case 2:this.p_btnSearch.node.active=!1,this.m_objGData.gsid=e.GSID,this.m_objGData.class=e.MAXCLASS,this.m_objGData.level=app.db.getGMaxLvByGsid(e.GSID,e.MAXCLASS),this.m_objGData.occu=e.OCCU,this.m_objGData.skill=e.SKILL}},refreshMenu:function(){var e=!0;return app.db.getAwakeIdByGsid(this.m_objGData.gsid)&&2!=this.m_numShowType?(this.p_arrNodeMenu[1].active=!0,this.m_arrCondGeneral=this.setCondGData(),this.p_arrNodeMenu[2].setPosition(this.menu2Pos),e=!0):(this.p_arrNodeMenu[1].active=!1,this.p_arrNodeMenu[2].setPosition(this.p_arrNodeMenu[1].position),e=!1),this.p_arrNodeMenu[2].active=this.m_objGData.star>=10,this.refreshMenuRed(),e},onClickMenu:function(e,t){if(cc.log("now click menu index: ",e),this.m_numShowMenuIndex!=e||t){switch(this.m_numShowMenuIndex=e,this.p_arrNodePickMenu.forEach(function(t,a){t.active=a==e}),e){case 0:this.refreshModLvevel();break;case 1:this.refreshModStar();break;case 2:this.refreshModWuhun()}this.p_nodeLevel.active=0==e,this.p_nodeStar.active=1==e,this.p_nodeWuhun.active=2==e}},refreshMenuRed:function(){if(this.p_arrNodeMenu[1].active){var e=app.pages.generalbaghandbookpage.checkStarUp(this.m_objGData.guid);this.p_arrNodeMenu[1].getChildByName("rednotice").active=!!e}this.p_arrNodeMenu[0].getChildByName("rednotice").active=!1;var t=!1,a=this.m_objGData.talent||[0,0,0,0,0,0];a=a.length<=0?[0,0,0,0,0,0]:a;for(var i=0;i<a.length&&!(this.m_objGData.star<i+10);++i)if(a[i]<=0){t=!0;break}this.p_arrNodeMenu[2].getChildByName("rednotice").active=t},refreshModLvevel:function(){var e=this,t=app.db.getGBaseByGsid(this.m_objGData.gsid);this.p_labPower.string=this.m_objGData.power||0,this.p_labPower.node.active=1==this.m_numShowType||0==this.m_numShowType,this.p_btnEquipOff.node.active=1==this.m_numShowType||0==this.m_numShowType,this.p_btnEquipOn.node.active=1==this.m_numShowType||0==this.m_numShowType,this.p_arrNodeClass.forEach(function(e,a){e.active=a<t.MAXCLASS}),this.p_arrNodeNowClass.forEach(function(t,a){t.active=a<e.m_objGData.class});var i=app.db.getGMaxLvByGsid(this.m_objGData.gsid,this.m_objGData.class);if(this.p_labLv.string=this.m_objGData.level+"/"+i,this.m_objGData.class==t.MAXCLASS&&this.m_objGData.level==i)this.p_btnUp.node.active=!1,this.p_nodeCost.active=!1,this.p_labCostTips.node.active=!0;else if(this.m_objGData.level==i)this.p_sprUpLv.node.active=!1,this.p_sprUpClass.node.active=!0,this.m_numTypeBtnUp=2,this.p_btnUp.node.active=!0,this.p_nodeCost.active=!1,this.p_labCostTips.node.active=!0;else{this.p_sprUpLv.node.active=!0,this.p_sprUpClass.node.active=!1,this.m_numTypeBtnUp=1,this.p_btnUp.node.active=!0,this.p_nodeCost.active=!0,this.p_labCostTips.node.active=!1;var n=app.db.getGLevelCostByLevel(this.m_objGData.level);n&&(this.p_labCost1.string=n[0].COUNT,this.p_labCost2.string=n[1].COUNT,this.p_labCost1.node.color=app.player.getCountEnough(n[0])?this.m_colorCost:cc.Color.RED,this.p_labCost2.node.color=app.player.getCountEnough(n[1])?this.m_colorCost:cc.Color.RED)}for(var r=0;r<4;++r){var o=t.SKILL[r];if(o){this.p_arrNodeSkill[r].active=!0,app.db.getSkillInfoByGsid(o);var s=!(o==app.db.getUnLockSkill(this.m_objGData.gsid,this.m_objGData.class)[r]);this.p_arrNodeSkill[r].getComponent("skillItem").initForGSkill(o,s,app.pages.generalpage)}else this.p_arrNodeSkill[r].active=!1}if(2!==this.m_numShowType){this.p_arrLabProperty.forEach(function(t,i){var n=a[i];t.string=Math.round(e.m_objGData.property[n])});var p=this.m_objGData.equip,c=this.m_objGData.treasure,h=this.m_objGData.exclusive;this.m_objEquipPos={};for(var l=0;l<p.length;++l){var g=p[l];if(g){var d=app.db.getEBaseByGsid(g);d&&(this.m_objEquipPos[d.POS]=g)}}for(var u=1;u<5;++u)if(this.m_objEquipPos[u]){this.p_arrNodeEquip[u-1].getComponent("propItem").initForGEquip(this.m_objEquipPos[u]),this.p_arrNodePlus[u-1].active=!1;var f=app.pages.generalbaghandbookpage.checkEquip(this.m_objGData.guid,u-1);this.p_arrNodeEquip[u-1].getChildByName("rednotice").active=!!f}else{this.p_arrNodeEquip[u-1].getComponent("propItem").initForGEquip(),this.p_arrNodePlus[u-1].active=!0;var m=app.pages.generalbaghandbookpage.checkEquip(this.m_objGData.guid,u-1);this.p_arrNodeEquip[u-1].getChildByName("rednotice").active=m}var _=this.m_objGData.level<40&&0==h.level,v=0==h.level&&this.m_objGData.level>=40;if(this.p_nodeExLock.active=_,this.p_nodeExActive.active=v,this.p_arrNodeEquip[4].getComponent("propItem").initForGExclus(h.gsid,h.level,_,v),this.p_arrNodePlus[4].active=!1,this.p_arrNodeEquip[4].getChildByName("rednotice").active=v,c){this.p_arrNodeEquip[5].getComponent("propItem").initForGEquip(c),this.p_arrNodePlus[5].active=!1;var b=app.pages.generalbaghandbookpage.checkTreas(this.m_objGData.guid);this.p_arrNodeEquip[5].getChildByName("rednotice").active=!!b}else{this.p_arrNodeEquip[5].getComponent("propItem").initForGEquip(),this.p_arrNodePlus[5].active=!0;var y=app.pages.generalbaghandbookpage.checkTreas(this.m_objGData.guid);this.p_arrNodeEquip[5].getChildByName("rednotice").active=y}this.p_arrNodeEquip.forEach(function(e){e.active=!0});for(var P=!1,w=0;w<6;++w)if(4!=w&&this.p_arrNodeEquip[w].getChildByName("rednotice").active){P=!0;break}this.p_btnEquipOn.node.active=P,this.p_btnEquipOn.node.getChildByName("rednotice").active=P,this.p_btnEquipOff.node.active=!P,0==p.length&&(this.p_btnEquipOn.node.active=!0,this.p_btnEquipOff.node.active=!1)}else{this.p_arrNodeEquip.forEach(function(e){e.active=!1});var I=app.db.calGPropNoEquip(this.m_objGData.gsid,this.m_objGData.level,this.m_objGData.class);this.p_arrLabProperty.forEach(function(e,t){var i=a[t].toUpperCase();e.string=I[i]})}},refreshModStar:function(){var e=app.db.getAwakeIdByGsid(this.m_objGData.gsid);if(e){var t=app.db.getGBaseByGsid(this.m_objGData.gsid),a=app.db.getGBaseByGsid(e),i=app.db.getAwakeByGsid(this.m_objGData.gsid),n=gConfig.getIconGStarPath(this.m_objGData.star-1);app.loadTexture(n,this.p_sprNowStar,app.pages.generalpage.prefabPath);var r=gConfig.getIconGStarPath(a.STAR-1);app.loadTexture(r,this.p_sprNextStar,app.pages.generalpage.prefabPath);var o=app.db.getGMaxLvByGsid(this.m_objGData.gsid,t.MAXCLASS),s=app.db.getGMaxLvByGsid(a.GSID,a.MAXCLASS);this.p_labNowMaxLv.string=o,this.p_labNextMaxLv.string=s;var p=this.m_arrShowTips[this.m_objGData.star];this.p_labStarUpTips.string=p;var c=gUtils.showCoinNum(app.player.getCount(30015)),h=i.ITEMS[0]?i.ITEMS[0].COUNT:0;this.p_nodeCostStar.active=!!(h>0);var l=h+"/"+c;this.p_labCostStar.string=l,cc.log("now m_arrCondGeneral: ",this.m_arrCondGeneral);for(var g=0;g<this.p_arrNodeGeneral.length;++g)this.m_arrCondGeneral[g]?(this.p_arrNodeGeneral[g].active=!0,this.p_arrNodeGeneral[g].getComponent("generalPortraitItem").initForAwake(g,this.m_arrCondGeneral)):this.p_arrNodeGeneral[g].active=!1}},refreshModWuhun:function(){for(var e=this.m_objGData.talent||[0,0,0,0,0,0],t=0;t<this.p_arrWuhunSkill.length;++t){var a=e[2*t],n=e[2*t+1],r=!!e&&!(!a||!n);if(this.p_arrWuhunSkill[t].active=r,this.p_arrWuhunPlus[t].active=!0,this.p_arrWuhunPlus[t].stopAllActions(),this.p_arrWuhunPlus[t].opacity=255,!a&&this.m_objGData.star>=2*t+10||!n&&this.m_objGData.star>=11+2*t?(this.p_arrWuhunPlus[t].runAction(cc.repeatForever(cc.sequence(cc.fadeOut(1),cc.fadeIn(1)))),this.p_arrWuhunSkill[t].opacity=140):(this.p_arrWuhunSkill[t].opacity=255,this.p_arrWuhunPlus[t].active=!1),r){this.p_arrWuhunSkill[t].setPosition(-2,12),this.p_arrWuhunSkill[t].width=200,this.p_arrWuhunSkill[t].height=191;var o=a.toString()+n.toString(),s=n.toString()+a.toString(),p=app.db.dbTalentWuhun[o]||app.db.dbTalentWuhun[s];app.loadTexture(gConfig.rootPath.uiwuhun+"icon_wuhun_"+p,this.p_arrWuhunSkill[t].getComponent(cc.Sprite),app.pages.generalpage.prefabPath)}else(a||n)&&(this.p_arrWuhunSkill[t].active=!0,this.p_arrWuhunSkill[t].setPosition(1,0),this.p_arrWuhunSkill[t].width=130,this.p_arrWuhunSkill[t].height=130,app.loadTexture(gConfig.rootPath.uiwuhun+"wuhun_talent_"+(a||n),this.p_arrWuhunSkill[t].getComponent(cc.Sprite),app.pages.generalpage.prefabPath))}for(var c=2;c<this.p_arrWuhunBoxDi.length;++c)this.p_arrWuhunBoxDi[c].active=!1;for(var h=0;h<this.p_arrWuhunBox.length;++h){var l=!!e&&!!e[h];this.p_arrWuhunBox[h].active=l,l&&app.loadTexture(gConfig.rootPath.uiwuhun+"wuhun_stone_"+e[h],this.p_arrWuhunBox[h].getComponent(cc.Sprite),app.pages.generalpage.prefabPath)}for(var g=0;g<this.p_arrWuhunLock.length;++g){var d=this.m_objGData.star<i[g];this.p_arrWuhunLock[g].active=d,this.p_arrWuhunLockLab[g].active=!1}},showWuhunPage:function(e){this.m_objGData.star<i[e]?app.showNotice(langMgr.getString("generalPageInfo",0)):app.pages.generalwuhunpage.showPage({target:this,guid:this.m_objGData.guid,group:e},null)},onClickEquipOn:function(){var e=this;app.player.sfEquipAllOn(this.m_objGData.guid,function(t,a){if(t)app.showNotice(t);else{for(var i=0;i<4;++i)app.player.addItem({GSID:e.m_objGData.equip[i],COUNT:1});app.player.addItem({GSID:e.m_objGData.treasure,COUNT:1});for(var n=0;n<4;++n)app.player.reduceItem({GSID:a.equip[n],COUNT:1});app.player.reduceItem({GSID:a.treasure,COUNT:1}),app.player.addGeneral(a),app.pages.generalpage.instance.showInfo(e.m_objGData.guid,0)}})},onClickEquipOff:function(){var e=this;app.player.sfEquipYjOff(this.m_objGData.guid,function(t,a){if(t)app.showNotice(t);else{for(var i=0;i<4;++i)app.player.addItem({GSID:e.m_objGData.equip[i],COUNT:1});app.player.addItem({GSID:e.m_objGData.treasure,COUNT:1}),app.player.addGeneral(a),app.pages.generalpage.instance.showInfo(e.m_objGData.guid,0)}})},onClickBtnUp:function(){var e=this;if(!GodGuide.isSpecGuide)switch(this.m_numTypeBtnUp){case 1:var t=app.db.getGMaxLvByGsid(this.m_objGData.gsid,this.m_objGData.class);if(this.m_objGData.level>=t){this.toucheduprank=!1;break}var a=app.db.getGLevelCostByLevel(this.m_objGData.level),i=[];if(a.forEach(function(e){app.player.checkCount(e.GSID,e.COUNT)||i.push(e.GSID)}),i.length>0){this.toucheduprank=!1;break}app.player.sfGeneralLvUp(this.m_objGData.guid,function(t,a){if(t)return app.showNotice(t),void(e.toucheduprank=!1);(app.guideProgress>8&&app.guideProgress<10||app.guideProgress>13&&app.guideProgress<15)&&(GodGuide._clickCb(a.level),GodGuide._numClick>=6&&(e.toucheduprank=!1)),e.animPower(a.power),app.playSound("glevelup"),app.pages.generalpage.instance.showGeneralEffAnim();var i=a.property,n=e.m_objGData.property;app.showProperty(i,n),e.m_objGData=a,e.m_objGData.level>app.player.getCount(90186)&&(app.player.others[90186].count=e.m_objGData.level),40==e.m_objGData.level&&app.player.level<30&&!GodGuide.isUnlockSpec&&(GodGuide.isUnlockSpec=!0,GodGuide.isSpecGuide=!0),e.refreshModLvevel(),app.player.sfPlayerByParam(["others","props"],function(){})});break;case 2:this.toucheduprank=!1;var n={gdata:this.m_objGData,target:this};app.pages.windowspagegclassready.showPage(n);break;default:cc.log("no up")}},onClickEquip:function(e){var t=e+1,a=this.m_objEquipPos[t];if(a){var i={};i.gsid=a,i.type=1,i.general=this.m_objGData.guid,app.pages.windowspagetipsequip.showPage(i)}else{var n={};n.general=this.m_objGData.guid,n.pos=t,app.pages.windowspagelistequip.showPage(n)}},onClickTreas:function(){var e=this.m_objGData.treasure,t=this.m_objGData.guid;if(e){var a={};a.gsid=e,a.type=1,a.general=this.m_objGData.guid,a.upcb=function(){app.pages.generalpage.instance.showInfo(t,0)},app.pages.windowspagetipstreas.showPage(a)}else{var i={};i.general=this.m_objGData.guid,i.pos=6,app.pages.windowspagelistequip.showPage(i)}},onClickExclus:function(){var e=this;if(cc.log("now click Exclus",this.m_objGData.exclusive),this.m_objGData.level<40&&!this.m_objGData.exclusive.level)app.showNotice(langMgr.getString("generalPageInfo",1));else if(this.m_objGData.exclusive.level){var t={data:this.m_objGData.exclusive,general:this.m_objGData.guid,funup:function(){app.pages.generalpage.instance.showInfo(e.m_objGData.guid,0)}};app.pages.windowspagetipsexclus.showPage(t)}else cc.log("now general guid is",this.m_objGData.guid),app.player.sfExcluLevel(this.m_objGData.guid,0,function(t,a){t?app.showNotice(t):(app.player.general[e.m_objGData.guid]=a,app.pages.generalpage.instance.showInfo(e.m_objGData.guid,0),app.showNotice(langMgr.getString("generalPageInfo",2)))})},onClickSkill:function(e){var t=this.p_arrNodeSkill[e],a=app.db.getGBaseByGsid(this.m_objGData.gsid);if(a){var i=a.SKILL[e];if(i){var n={type:"general",gsid:i,index:e,lock:t.getComponent("skillItem").isLock()};app.pages.windowspagetipsskill.showPage(n)}}},onClickCond:function(e){var t={};t.index=e,t.arrcond=this.m_arrCondGeneral,t.main=this.m_objGData.guid,t.cb=this.refreshModStar,t.target=this,app.pages.windowspagelistgeneral.showPage(t)},onClickGo:function(){app.pages.generalpage.instance.m_objData.type=1;var e={type:3,objPrevData:app.pages.generalpage.instance.m_objData};app.pages.generalpage.instance.setParam(e,app.mainScene.p_nodeBg)},onClickBtnStarUp:function(){var t=this,a=app.db.getAwakeIdByGsid(this.m_objGData.gsid),i=app.db.getAwakeByGsid(this.m_objGData.gsid),n=this.m_objGData.guid,r=[],o=i.ITEMS[0]?i.ITEMS[0].COUNT:0;if(app.player.checkCount(30015,o))if(e("generalPageCompound").checkComp(this.m_arrCondGeneral)){for(var s=0;s<this.m_arrCondGeneral.length;++s)this.m_arrCondGeneral[s]&&r.push(this.m_arrCondGeneral[s].picked);cc.log(a,n,r),app.player.sfGeneralAwake(a,n,r,function(e,a){e?app.showNotice(e):(app.showNotice(langMgr.getString("generalPageInfo",4)),app.pages.generalpage.instance.showGeneralEffAnim(),app.player.sfPlayerData(function(){var e={old:t.m_objGData,new:app.player.general[t.m_objGData.guid],items:a.items};app.pages.windowspagegstarsucc.showPage(e);var i={type:1,guid:t.m_objGData.guid};app.pages.generalpage.instance.refreshUI(i),app.pages.generalbaghandbookpage.instance.refreshUI(0)}))})}else app.showNotice(langMgr.getString("generalPageInfo",3))},animPower:function(e){var t=this;this.p_animNode.on("finished",function e(){t.p_animNode.node.active=!1,t.p_animNode.off("finished",e)}),this.p_animNode.node.active=!0,this.p_animNode.play(),cc.log(e),this.p_nodePowerNum.getComponent("powerItem").initPower(e),app.loadEff("zhandoulitisheng_01",this.p_animPower_01,1,1),app.loadEff("zhandoulitisheng_02",this.p_animPower_02,1,1),app.loadEff("zhandoulitisheng_03",this.p_animPower_03,2,1)},setCondGData:function(){var e=[],t=app.db.getAwakeByGsid(this.m_objGData.gsid);if(!t)return e;for(var a=t.CONS,i=0;i<a.length;++i){var n={};n.cond=a[i].COND,n.need=a[i].COUNT,n.picked=[],e.push(n)}return e}}),cc._RF.pop()},{generalPageCompound:"generalPageCompound"}],generalPagePot:[function(e,t){"use strict";cc._RF.push(t,"5a283Hv0oxP9JUC59TbtUhW","generalPagePot");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=cc._decorator,o=r.ccclass,s=r.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_arrNodePots=[],t.p_btnSoulTemple=null,t.p_nodeSoulEquip0=null,t.p_nodeSoulEquip1=null,t.p_btnTujian=null,t.p_btnBag=null,t.p_nodeBeastSkill=null,t.p_nodeStoneProperty=null,t.p_itemStoneProperty=null,t.p_nodeNoStoneTip=null,t.p_sfBeastIntroBg=[],t.p_sfBeastSkillKuang=[],t.p_sfBeastSkillTxt=[],t.p_colBeastIntro=[],t.m_menu=null,t.m_showPotIndex=0,t.m_topPos=[],t.m_movePos=[],t.m_generalGuid=null,t.m_generalInfo=null,t.m_objParent=null,t.m_stonePropertyItems=[],t.m_playAnim=!1,t.m_isInit=!1,t.m_beastsoul=[],t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){var e=this;this.m_movePos=[this.p_arrNodePots[0].getPosition(),this.p_arrNodePots[1].getPosition(),this.p_arrNodePots[2].getPosition()],this.p_btnSoulTemple.node.on("click",function(){app.playSound("click"),e.m_playAnim||app.pages.soultemplepage.showPage()}),this.p_nodeSoulEquip0.on("click",function(){app.playSound("click"),e.m_playAnim||e.onStonePosClick(0)}),this.p_nodeSoulEquip1.on("click",function(){app.playSound("click"),e.m_playAnim||e.onStonePosClick(1)}),this.p_nodeBeastSkill.getChildByName("skill").getChildByName("spr_icon_skill").on("click",function(){if(app.playSound("click"),!e.m_playAnim){var t=(e.m_generalInfo.beastsoul||[])[e.m_showPotIndex];if(gUtils.isNull(t));else{var a={id:t,target:e};app.pages.beastsoulskilldetailpage.showPage(a)}}}),this.p_btnTujian.node.on("click",function(){if(app.playSound("click"),!e.m_playAnim){var t={target:e};app.pages.beastsoulhandbookpage.showPage(t)}}),this.p_btnBag.node.on("click",function(){if(app.playSound("click"),!e.m_playAnim){var t={target:e,guid:e.m_generalGuid,stonePos:null},i=e.m_generalInfo.stone||[],n=i[a.ONE_BEAST_STONE_COUNT*e.m_showPotIndex],r=i[a.ONE_BEAST_STONE_COUNT*e.m_showPotIndex+1],o=a.ONE_BEAST_STONE_COUNT*e.m_showPotIndex;n&&!r&&(o+=1),t.stonePos=o,app.pages.soulstonebagpage.showPage(t)}}),this.p_arrNodePots.forEach(function(e){e.getChildByName("spr_no").runAction(cc.sequence(cc.moveBy(.8,cc.v2(0,-50)),cc.moveBy(.8,cc.v2(0,50))).repeatForever())}),this.node.getComponent("menu").init(this)},t.prototype.init=function(e){this.m_objParent=e},t.prototype.refreshUI=function(e){if(e&&(e!==this.m_generalGuid&&(this.m_isInit=!1),this.m_generalGuid=e),this.m_generalInfo=app.player.general[this.m_generalGuid],!this.m_isInit){var t=(this.m_generalInfo.beastsoul||[]).findIndex(function(e){return!!e});if(-1===t&&(t=0),this.node.getComponent("menu").setMenuIndex(t),app.runUnlockGuide("BEAST_SOUL"),0!==t)return;this.m_isInit=!0}var a={};this.refreshStonePos(0,a),this.refreshStonePos(1,a);for(var i=Object.values(a),n=0;n<i.length;n++){var r=i[n],o=this.m_stonePropertyItems[n];o||((o=cc.instantiate(this.p_itemStoneProperty)).parent=this.p_nodeStoneProperty,this.m_stonePropertyItems.push(o)),o.getComponent("propertyItem").refreshUI(r)}for(var s=0;s<this.m_stonePropertyItems.length;s++)this.m_stonePropertyItems[s].active=cc.isValid(i[s]);this.p_nodeNoStoneTip.active=!i.length,this.refreshBeastSoul()},t.prototype.refreshStonePos=function(e,t){var i=e?this.p_nodeSoulEquip1:this.p_nodeSoulEquip0,n=this.m_generalInfo.stone||[],r=a.ONE_BEAST_STONE_COUNT*this.m_showPotIndex+e,o=n[r],s=app.db.getSoulStoneLockInfoByPos(r);i.getChildByName("node_nostone").active=!cc.isValid(o),i.getChildByName("soul_stone_item").active=cc.isValid(o),i.getChildByName("node_nostone").getChildByName("spr_add").active=s.STAR<=this.m_generalInfo.star,i.getChildByName("node_nostone").getChildByName("lock").active=s.STAR>this.m_generalInfo.star,s.STAR>this.m_generalInfo.star?i.getChildByName("node_nostone").getChildByName("lock").getChildByName("lab_lock").getComponent(cc.Label).string=langMgr.getString("wuhunTianfuPage",6,[s.STAR]):cc.isValid(o)&&(i.getChildByName("soul_stone_item").getComponent("soulStItem").refreshUI({stone:o,click:!0}),[o.main,o.rand].map(function(e){if(e)for(var a in e)t[a]||(t[a]={key:a,val:0}),t[a].val+=e[a]})),i.getChildByName("spr_red").active=app.pages.generalbaghandbookpage.checkSoulStone(this.m_generalGuid,r)},t.prototype.refreshBeastSoul=function(){for(var e,t=this,a=this.m_generalInfo.beastsoul||[],i=function(t){var i=n.p_arrNodePots[t],r=a[t];i.getChildByName("spr_no").active=gUtils.isNull(r)&&t===n.m_showPotIndex;var o=i.getChildByName("spr_infoBg");o.active=!gUtils.isNull(r)&&t===n.m_showPotIndex;var s=i.getChildByName("spr_image");s.active=!gUtils.isNull(r),i.getChildByName("spr_star").active=!gUtils.isNull(r)&&t===n.m_showPotIndex;var p=["1","2","4","3"],c=p[0];if(!gUtils.isNull(r)){var h=app.db.getGeneralPotByID(r);if(n.m_showPotIndex===t&&(e=h),n.m_beastsoul[t]===r)return"continue";s.opacity=0;var l=gConfig.getBeastImageByName(h.ANIM);app.loadTexture(l,s.getComponent(cc.Sprite),app.getPrefabPathFrom(n.m_objParent)),cc.tween(s).delay(.3).to(.5,{opacity:255}).start();var g=i.getChildByName("node_sp").getComponent(sp.Skeleton);g.node.active=!0,g.setAnimation(0,"1",!1),g.setCompleteListener(function(){g.node.active=!1});var d=gConfig.getBeastNameTxtByName(h.NAMEPNG);app.loadTexture(d,o.getChildByName("spr_name").getComponent(cc.Sprite),app.getPrefabPathFrom(n.m_objParent));var u=gConfig.rootPath.uibeastsoul+"star/icon_sh_"+["","pt","guan","an"][h.STYPE]+"0"+h.STAR;app.loadTexture(u,i.getChildByName("spr_star").getComponent(cc.Sprite),app.getPrefabPathFrom(n.m_objParent));var f=gConfig.getBeastOccuByType(h.TYPE);app.loadTexture(f,o.getChildByName("icon_occ").getComponent(cc.Sprite),app.getPrefabPathFrom(n.m_objParent)),c=p[h.STYPE]}i.getChildByName("sp_dizuo").getComponent(sp.Skeleton).setAnimation(0,c,!0)},n=this,r=0;r<this.p_arrNodePots.length;r++)i(r);var o=a[this.m_showPotIndex];if(this.p_nodeBeastSkill.getChildByName("no_skill").active=gUtils.isNull(o),this.p_nodeBeastSkill.getChildByName("skill").active=!gUtils.isNull(o),e){var s=this.p_nodeBeastSkill.getChildByName("skill"),p=s.getChildByName("spr_icon_skill").getComponent(cc.Sprite);app.loadTexture(gConfig.getBeastHeadByName(e.SKILLICON),p,app.getPrefabPathFrom(this.m_objParent)),s.getChildByName("lab_intro").getComponent(cc.Label).string=e.INTRO,s.getChildByName("lab_intro").color=this.p_colBeastIntro[e.STYPE-1],s.getChildByName("spr_kuang_skill").getComponent(cc.Sprite).spriteFrame=this.p_sfBeastSkillKuang[e.STYPE-1],s.getChildByName("spr_txt").getComponent(cc.Sprite).spriteFrame=this.p_sfBeastSkillTxt[e.STYPE-1],s.getComponent(cc.Sprite).spriteFrame=this.p_sfBeastIntroBg[e.STYPE-1];var c=gConfig.rootPath.uibeastsoul+"star/icon_sh_"+["","pt","guan","an"][e.STYPE]+"01";s.getChildByName("layout_star").children.forEach(function(a,i){a.active=i<e.STAR,i<e.STAR&&app.loadTexture(c,a.getComponent(cc.Sprite),app.getPrefabPathFrom(t.m_objParent))})}this.m_beastsoul=a},t.prototype.onStonePosClick=function(e){var t=a.ONE_BEAST_STONE_COUNT*this.m_showPotIndex+e;if(!(app.db.getSoulStoneLockInfoByPos(t).STAR>this.m_generalInfo.star))if(this.m_generalInfo.stone[t]){var i={guid:this.m_generalGuid,stone:this.m_generalInfo.stone[t],stonePos:t,showType:app.pages.windowspagetipssoulstoneinfo.SHOW_TYPE.GENERAL,target:this};app.pages.windowspagetipssoulstoneinfo.showPage(i)}else i={guid:this.m_generalGuid,stonePos:t,target:this},app.pages.soulstonelistpage.showPage(i)},t.prototype.menuHandler=function(e){var t=this;if(e!==this.m_showPotIndex){if(this.m_playAnim)return!1;this.m_playAnim=!0;var a=!0;(e>this.m_showPotIndex&&(2!==e||0!==this.m_showPotIndex)||0===e&&2===this.m_showPotIndex)&&(a=!1);var i=this.p_arrNodePots.length;return this.p_arrNodePots.forEach(function(n,r){r===t.m_showPotIndex&&(n.getChildByName("spr_infoBg").active=!1,n.getChildByName("spr_star").active=!1),n.zIndex=e===r?10:1;var o,s=(r-t.m_showPotIndex+i)%i;o=a?s+1>i-1?0:s+1:s-1<0?i-1:s-1,t.m_isInit?cc.tween(n).to(.5,{position:t.m_movePos[o],scale:0===o?1:.65}).start():(n.setPosition(t.m_movePos[o]),n.scale=0===o?1:.65)}),this.scheduleOnce(function(){t.m_playAnim=!1,t.m_showPotIndex=e,t.m_isInit||(t.m_isInit=!0),t.refreshUI(null)},this.m_isInit?.5:0),!0}},t.prototype.arrowClicked=function(e,t){if(!this.m_playAnim){var a=this.m_showPotIndex;"left"===t?--a<0&&(a=2):"right"===t&&++a>2&&(a=0),this.node.getComponent("menu").setMenuIndex(a)}},t.ONE_BEAST_STONE_COUNT=2,n([s(cc.Node)],t.prototype,"p_arrNodePots",void 0),n([s(cc.Button)],t.prototype,"p_btnSoulTemple",void 0),n([s(cc.Node)],t.prototype,"p_nodeSoulEquip0",void 0),n([s(cc.Node)],t.prototype,"p_nodeSoulEquip1",void 0),n([s(cc.Button)],t.prototype,"p_btnTujian",void 0),n([s(cc.Button)],t.prototype,"p_btnBag",void 0),n([s(cc.Node)],t.prototype,"p_nodeBeastSkill",void 0),n([s(cc.Node)],t.prototype,"p_nodeStoneProperty",void 0),n([s(cc.Node)],t.prototype,"p_itemStoneProperty",void 0),n([s(cc.Node)],t.prototype,"p_nodeNoStoneTip",void 0),n([s(cc.SpriteFrame)],t.prototype,"p_sfBeastIntroBg",void 0),n([s(cc.SpriteFrame)],t.prototype,"p_sfBeastSkillKuang",void 0),n([s(cc.SpriteFrame)],t.prototype,"p_sfBeastSkillTxt",void 0),n([s(cc.Color)],t.prototype,"p_colBeastIntro",void 0),a=n([o],t)}(cc.Component);t.exports=p,cc._RF.pop()},{}],generalPageStar:[function(e,t){"use strict";cc._RF.push(t,"f6384VXMbpGxahw09vSuDnb","generalPageStar");var a={6:{HP:25,ATK:20},7:{HP:25,ATK:20},8:{HP:25,ATK:20},9:{HP:60,ATK:25},10:{HP:20,ATK:10},11:{HP:15,ATK:10},12:{HP:15,ATK:15},13:{HP:10,ATK:10}};cc.Class({extends:cc.Component,properties:{p_sprNextStar:cc.Sprite,p_labNextMaxLv:cc.Label,p_labAddHp:cc.Label,p_labAddAtk:cc.Label,p_labStarUpTips:cc.Label,p_labStarBackTips:cc.Label,p_btnStarUp:cc.Button,p_arrNodeCost:[cc.Node],p_nodeGenContent:cc.Node,p_pfbGeneral:cc.Prefab,_genList:[]},onLoad:function(){this.handleUI(),this.m_arrObjCondGeneral=[]},start:function(){},handleUI:function(){var e=this;this.p_btnStarUp.node.on("click",function(){app.playSound("click"),e.onClickBtnStarUp()})},init:function(e){this.m_objParent=e},refreshUI:function(e){this.m_objGData=e,this.refreshNextStar(e),this.m_arrCondGeneral=this.setCondGData(e),this.refreshComp()},refreshNextStar:function(e){var t=app.db.getAwakeIdByGsid(e.gsid);if(t){var i=app.db.getGBaseByGsid(t),n=app.db.getAwakeByGsid(e.gsid),r=gConfig.getNewIconGStarPath(i.STAR-1);app.loadTexture(r,this.p_sprNextStar,app.pages.generalpage.prefabPath);var o=app.db.getGMaxLvByGsid(i.GSID,i.MAXCLASS);this.p_labNextMaxLv.string=langMgr.getString("generalPageStar",0,o);var s=a[e.star];s&&(this.p_labAddHp.string=cc.js.formatStr("+%s%",s.HP),this.p_labAddAtk.string=cc.js.formatStr("+%s%",s.ATK));for(var p=0;p<this.p_arrNodeCost.length;++p)n.ITEMS[p]?(this.p_arrNodeCost[p].getComponent("costItem").refreshUI(n.ITEMS[p].GSID,n.ITEMS[p].COUNT,this),this.p_arrNodeCost[p].active=!0):this.p_arrNodeCost[p].active=!1}},refreshComp:function(){var e=this;cc.log("now m_arrCondGeneral: ",this.m_arrCondGeneral);for(var t=function(t){var a=e._genList[t];cc.isValid(a)||((a=cc.instantiate(e.p_pfbGeneral)).scale=.8,e.p_nodeGenContent.addChild(a),a.setPosition(cc.Vec2.ZERO),e._genList[t]=a,a.on(cc.Node.EventType.TOUCH_END,function(){e.onClickCond(t)})),a.active=!0,a.getComponent("generalPortraitItem").initForAwake(t,e.m_arrCondGeneral,!0)},a=0;a<this.m_arrCondGeneral.length;++a)t(a);for(var i=this.m_arrCondGeneral.length;i<this._genList.length;++i)cc.isValid(this._genList[i])&&(this._genList[i].active=!1)},onClickCond:function(e){var t={};t.index=e,t.arrcond=this.m_arrCondGeneral,t.main=this.m_objGData.guid,t.cb=this.refreshComp,t.target=this,t.noplus=!0,t.isGeneralComp=!0,app.pages.windowspagelistgeneral.showPage(t)},onClickBtnStarUp:function(){for(var t=this,a=app.db.getAwakeIdByGsid(this.m_objGData.gsid),i=app.db.getAwakeByGsid(this.m_objGData.gsid),n=this.m_objGData.guid,r=[],o=[],s=!1,p=0;p<i.ITEMS.length;++p){var c=i.ITEMS[p];if(!app.player.checkCount(c.GSID,c.COUNT)){o.push(c.GSID),s=!0;break}}if(s)app.pages.windowspagesource.showPage(o[0]);else if(e("generalPageCompound").checkComp(this.m_arrCondGeneral)){for(var h=0;h<this.m_arrCondGeneral.length;++h)this.m_arrCondGeneral[h]&&r.push(this.m_arrCondGeneral[h].picked);cc.log(a,n,r),app.player.sfGeneralAwake(a,n,r,function(e,a){e?app.showNotice(e):(app.showNotice(langMgr.getString("generalPageStar",2)),a.global_gifts&&app.setNewRecommendGift(a.global_gifts),t.m_objParent.showGeneralEffAnim(),app.player.sfPlayerData(function(){cc.log("\u5347\u661f\u6210\u529f",t.m_objGData.guid,app.player.general);var e={old:t.m_objGData,new:app.player.general[t.m_objGData.guid],items:a.items};app.pages.windowspagegstarsucc.showPage(e);var i={type:1,guid:t.m_objGData.guid},o=app.pages.generalpage.instance;cc.isValid(o)&&(("function"==typeof Array.prototype.flat?r.flat():gUtils.flat(r)).forEach(function(e){var t=o.m_arrGeneral.indexOf(e);t>=0&&o.m_arrGeneral.splice(t,1)}),o.refreshArrow(o.m_arrGeneral.indexOf(n)),o.refreshUI(i))}))})}else app.showNotice(langMgr.getString("generalPageStar",1))},setCondGData:function(){var e=[],t=app.db.getAwakeByGsid(this.m_objGData.gsid);if(!t)return e;for(var a=t.CONS,i=0;i<a.length;++i){var n={};n.isMain=0===i,n.cond=a[i].COND,n.need=a[i].COUNT,n.picked=[],e.push(n)}return e}}),cc._RF.pop()},{generalPageCompound:"generalPageCompound"}],generalPageTrain:[function(e,t){"use strict";cc._RF.push(t,"b7c09583oZN4ISQzFPG+Sq6","generalPageTrain");var a=["hp","atk","def","mdef"];cc.Class({extends:cc.Component,properties:{p_labLv:cc.Label,p_arrLabProperty:[cc.Label],p_arrNodeSkill:[cc.Node],p_btnEquipOn:cc.Button,p_btnEquipOff:cc.Button,p_btnEquipOnRed:cc.Node,p_arrNodeCost:[cc.Node],p_btnDetail:cc.Button,p_btnUp:cc.Button,p_maxLv:cc.Node,p_nodeUpLv:cc.Node,p_nodeClass:cc.Node,p_nodeGoStar:cc.Node,p_nodeGoComp:cc.Node,p_animNode:cc.Animation,p_animPower_01:cc.Animation,p_animPower_02:cc.Animation,p_animPower_03:cc.Animation,p_nodePowerNum:cc.Node,p_btnFastUpgrade:cc.Button,p_fastUpgradeNum:cc.Node},onLoad:function(){var e=this;this.handleUI(),this.m_arrObjCondGeneral=[],this._contUpgradeCount=0,this.upgradeMaxLv=0,cc.director.on("EVT_AUTO_UPGRADE_REFRESH",function(t){e.animPower(t.generalInfo.power,t.beforePower),app.playSound("glevelup"),e.m_objParent.showGeneralEffAnim();var a=t.generalInfo.property,i=e.m_objGData.property;app.showProperty(a,i),e.refreshUI(t.generalInfo,!0),e.m_objParent.m_objNowGData=app.player.general[t.generalInfo.guid],e.m_objParent.refreshPower(t.generalInfo.power),e.m_objParent.refreshEquip(t.generalInfo),e.m_objParent.refreshBtnState()},this),cc.director.on("EVT_PLAY_POWER_ANIM",function(t){var a=t.curPower,i=t.beforePower;e.animPower(a,i)},this)},handleUI:function(){var e=this;this.p_btnEquipOn.node.on("click",function(){app.playSound("click"),e.onClickEquipOn()}),this.p_btnEquipOff.node.on("click",function(){app.playSound("click"),e.onClickEquipOff()}),this.clickPressBtn=function(){return e.onClickBtnUp(),"lvup"==e.m_strStatus},this.longPressUpdate=function(){-1===app.arrPages[app.arrPages.length-1].indexOf("generalpage")&&e.longPress.setStatus(!1)},this.p_arrNodeSkill.forEach(function(t,a){t.on("touchend",function(){e.onClickSkill(a)})}),this.p_btnDetail.node.on("click",function(){var t;app.pages.generalattributedetailedpage.showPage(null!=(t=e.m_property)?t:e.m_objGData.guid)}),this.p_btnFastUpgrade.node.on("click",function(){app.playSound("click"),app.pages.windowsPageFastUpgrade.showPage({generalGuid:e.m_objGData.guid,maxLv:e.upgradeMaxLv})})},init:function(e){this.m_objParent=e,this.longPress=this.node.getComponent("longPressBtn"),this.longPress.init(this,200)},refreshUI:function(e,t,i){void 0===t&&(t=!1),void 0===i&&(i=!1),i&&(this.p_btnEquipOff.active=this.p_btnEquipOn.active=this.p_btnUp.active=!1),this.m_objGData=e;var n=app.db.getGBaseByGsid(e.gsid);if(!this.m_objGData.guid||!app.player.general[this.m_objGData.guid]){var r,o=null!=(r=e.level)?r:app.db.getGMaxLvByGsid(e.gsid,n.MAXCLASS);this.m_property=e.property||app.db.calGPropNoEquip(e.gsid,o,n.MAXCLASS)}t||this.refreshRetinueSoulInfo(),this.m_lastGuid=this.m_objGData.guid,this.p_labLv.string=e.level,this.p_arrLabProperty.forEach(function(t,i){var n=a[i];t.string=Math.round(e.property[n])});for(var s=e,p=s.exclusive_equip?s.exclusive_equip:0,c=app.db.getExclusiveSkillLockLv(s.occu),h=[],l=0;l<c.length;++l)p>=c[l]&&h.push(l);for(var g=0;g<4;++g){var d=n.SKILL[g];if(d){this.p_arrNodeSkill[g].active=!0;var u=!(d==app.db.getUnLockSkill(e.gsid,e.class)[g]);!u&&h.includes(g)&&d++,this.p_arrNodeSkill[g].getComponent("skillItem").initForGSkill(d,u,app.pages.generalpage)}else this.p_arrNodeSkill[g].getComponent("skillItem").hideItem()}1==n.SKILL.length?(this.p_arrNodeSkill[0].x=0,this.p_arrNodeSkill[0].parent.getChildByName("LabelContent").getChildByName("lab_lv0").x=6.55):(this.p_arrNodeSkill[0].x=-182,this.p_arrNodeSkill[0].parent.getChildByName("LabelContent").getChildByName("lab_lv0").x=-175.45);var f=this.checkStatusUp(e);if(this.refreshCost(e,f),this.refreshRed(),t){if(app.player.level>=50){var m=this._contUpgradeCount>=5,_=this.upgradeMaxLv-e.level>=20;_&&(this.p_fastUpgradeNum.getComponent(cc.Label).string="U"+this.upgradeMaxLv+langMgr.getString("public",26)),this.p_btnFastUpgrade.node.active?(this.p_btnFastUpgrade.node.active=m&&_,this.p_btnFastUpgrade.node.active||this.unschedule(this.hideFastUpgrade)):(this.p_btnFastUpgrade.node.active=m&&_,this.p_btnFastUpgrade.node.active||this.scheduleOnce(this.hideFastUpgrade,3))}}else this.upgradeMaxLv=this.calculateUpgradeMaxLv(e),cc.log("==== \u5f53\u524d\u6700\u5927\u7b49\u7ea7: ",this.upgradeMaxLv),this.unschedule(this.hideFastUpgrade),this.hideFastUpgrade(),this._contUpgradeCount=0},hideFastUpgrade:function(){cc.isValid(this.p_btnFastUpgrade)&&(this.p_btnFastUpgrade.node.active=!1),this._contUpgradeCount=0},refreshCost:function(e,t){var a=[];switch(t){case"lvup":a=app.db.getGLevelCostByLevel(e.level)||[];break;case"classup":(a=app.db.getGLevelCostByLevel(e.level)||[]).sort(function(e,t){var a=[38006,30001,30015];return a.indexOf(Number(e.GSID))-a.indexOf(Number(t.GSID))});break;case"gostar":case"gocomp":default:a=[]}for(var i=0;i<this.p_arrNodeCost.length;++i)a[i]?(this.p_arrNodeCost[i].getComponent("costItem").refreshUI(a[i].GSID,a[i].COUNT,this),this.p_arrNodeCost[i].active=!0):this.p_arrNodeCost[i].active=!1;this.refreshBtnUp(t)},refreshBtnUp:function(e){cc.log("now btn strStatus is",e);var t=app.player.isRetinueGeneral(this.m_objGData.guid);this.m_strStatus==e||"lvup"!=this.m_strStatus||"gocomp"!=e&&"gostar"!=e||this.longPress.setStatus(!1),this.m_strStatus=e,this.p_nodeUpLv.active="lvup"==e,this.p_nodeClass.active="classup"==e,this.p_nodeGoComp.active="gocomp"==e||"gostar"==e,this.p_maxLv.active="maxlv"==e,this.longPress.setOver("maxlv"==e||t),this.p_btnUp.interactable&&"maxlv"==e||t?this.p_btnUp.interactable=!1:this.p_btnUp.interactable||"maxlv"==e||(this.p_btnUp.interactable=!0)},checkStatusUp:function(e){var t=app.db.getGMaxLvByClass(e.class),a=app.db.getGBaseByGsid(e.gsid),i=app.db.getGMaxLvByGsid(e.gsid,a.MAXCLASS),n=app.db.getGMaxLvByClass(e.class+1);if(e.level<i&&e.level>=t&&n)return"classup";var r=app.db.getGMaxLvByGsid(e.gsid,e.class),o=app.db.getAwakeIdByGsid(e.gsid);if(e.level>=r&&o){if(e.star>=6)return"gostar";if(e.star<6)return"gocomp"}return e.level>=r&&void 0===o?"maxlv":"lvup"},onClickEquipOn:function(){var e=this,t=this.m_objGData.power;app.player.sfEquipAllOn(this.m_objGData.guid,function(a,i){a?app.showNotice(a):(app.isGuide()&&cc.director.emit("EVT_GUIDE_EQUIP_ON"),app.player.sfPlayerData(function(){cc.isValid(e)&&(e.m_objParent.m_objNowGData=app.player.general[i.guid],i&&(i.isClick=!0),e.m_objParent.refreshInfo(i),e.refreshRed(),e.animPower(e.m_objGData.power,t))}))})},onClickEquipOff:function(){var e=this,t=this.m_objGData.power;app.player.sfEquipYjOff(this.m_objGData.guid,function(a,i){a?app.showNotice(a):app.player.sfPlayerData(function(){cc.isValid(e)&&(e.m_objParent.m_objNowGData=app.player.general[i.guid],e.m_objParent.refreshInfo(i),e.refreshRed(),e.animPower(e.m_objGData.power,t))})})},refreshRed:function(){for(var e=!1,t=0;t<4;++t)if(app.pages.generalbaghandbookpage.checkEquip(this.m_objGData.guid,t)){e=!0;break}e||(e=app.pages.generalbaghandbookpage.checkTreas(this.m_objGData.guid)&&app.db.checkFuncUnLock("GENER_TERA")),this.p_btnEquipOnRed.active=e},onClickBtnUp:function(){var e=this;switch(this.m_strStatus){case"lvup":var t=app.db.getGMaxLvByGsid(this.m_objGData.gsid,this.m_objGData.class);if(this.m_objGData.level>=t){this.longPress.setStatus(!1),app.isGuide()&&GodGuide.addGuideProgress("guide_lv_up_end");break}var a=app.db.getGLevelCostByLevel(this.m_objGData.level),i=[];if(!a)return app.isGuide()&&GodGuide.addGuideProgress("guide_lv_up_end"),void app.showNotice(langMgr.getString("generalPageTrain",0));a.sort(function(e,t){var a=[38006,30001,30015];return a.indexOf(Number(e.GSID))-a.indexOf(Number(t.GSID))});for(var n=!1,r=0;r<a.length;r++){var o=a[r];if(!app.player.checkCount(o.GSID,o.COUNT)){i.push(o.GSID),n=!0;break}}if(n){this.longPress.setStatus(!1),app.isGuide()&&GodGuide.addGuideProgress("guide_lv_up_end"),app.pages.windowspagesource.showPage(i[0]);break}var s=app.player.general[this.m_objGData.guid].power;app.player.sfGeneralLvUp(this.m_objGData.guid,function(t,a){if(t)return app.showNotice(t),e.longPress.setStatus(!1),void(app.isGuide()&&GodGuide.addGuideProgress("guide_lv_up_end"));if(cc.director.emit("guide_lv_up_end"),cc.isValid(e)){e.m_isUpgrade=!0,GodGuide.addGuideProgress("guide_lv_up_end"),e.animPower(a.power,s),app.playSound("glevelup"),e.m_objParent.showGeneralEffAnim();var i=a.property,n=e.m_objGData.property;app.showProperty(i,n),a.level>app.player.getCount(90186)&&(void 0===app.player.others[90186]&&(app.player.others[90186]={}),app.player.others[90186].count=a.level),a.level>app.player.getCount(94200)&&(app.player.getCount(94200)?app.player.others[94200].count=a.level:(app.player.others[94200]={},app.player.others[94200].count=a.level)),40==a.level&&app.player.level<30&&!GodGuide.isUnlockSpec&&(GodGuide.isUnlockSpec=!0,GodGuide.isSpecGuide=!0),e._contUpgradeCount++,e.refreshUI(a,!0),e.m_objParent.m_objNowGData=app.player.general[a.guid],e.m_objParent.refreshPower(a.power),e.m_objParent.refreshEquip(a),e.m_objParent.refreshBtnState(),app.player.sfPlayerByParam(["others","props"],function(){})}});break;case"classup":this.longPress.setStatus(!1);var p={gdata:this.m_objGData,target:this};app.pages.windowspageupgradeready.showPage(p);break;case"gostar":this.longPress.setStatus(!1),app.pages.generalpage.instance&&app.pages.generalpage.instance.setMenuIndex(1);break;case"gocomp":this.longPress.setStatus(!1),app.goToPage(1016,[{gsid:this.m_objGData.gsid,guid:this.m_objGData.guid}]);break;default:cc.log("no up")}},onClickSkill:function(e){var t=this.p_arrNodeSkill[e],a=app.db.getGBaseByGsid(this.m_objGData.gsid);if(a){var i=a.SKILL[e];if(i){for(var n=t.getComponent("skillItem").isLock(),r=this.m_objGData.exclusive_equip?this.m_objGData.exclusive_equip:0,o=app.db.getExclusiveSkillLockLv(this.m_objGData.occu),s=[],p=0;p<o.length;++p)r>=o[p]&&s.push(p);!n&&s.includes(e)&&i++;var c={type:"general",gsid:i,index:e,lock:n};app.pages.windowspagetipsskill.showPage(c)}}},onClickGo:function(){app.pages.generalpage.instance.m_objData.type=1;var e={type:3,objPrevData:app.pages.generalpage.instance.m_objData};app.pages.generalpage.instance.setParam(e,app.mainScene.p_nodeBg)},animPower:function(){},calculateUpgradeMaxLv:function(e){for(var t=app.db.getGBaseByGsid(e.gsid),a=app.db.getGMaxLvByGsid(e.gsid,t.MAXCLASS),i={38006:0,30001:0,30015:0},n=e.level;n<a;++n){var r=app.db.getGLevelCostByLevel(n)||[];for(var o in r.forEach(function(e){var t=e.GSID;void 0===i[t]?i[t]=e.COUNT:i[t]+=e.COUNT}),i)if(i[o]&&i.hasOwnProperty(o)&&app.player.getCount(o)<i[o])return n}return a},onDestroy:function(){this.refreshRetinueSoulInfo(),cc.director.targetOff(this)},refreshRetinueSoulInfo:function(e){if(this.m_isUpgrade&&this.m_lastGuid){var t=app.db.getNeedRefreshGeneralArray(this.m_lastGuid);if(t.length>0?app.player.sfQueryGeneralListInfo(t,function(){"function"==typeof e&&e()}):"function"==typeof e&&e(),!cc.isValid(this))return;this.m_lastGuid="",this.m_isUpgrade=!1}else"function"==typeof e&&e()}}),cc._RF.pop()},{}],generalPageWuhun:[function(e,t){"use strict";cc._RF.push(t,"3585cuDrk9CL6cZcQYDP/EP","generalPageWuhun"),cc.Class({extends:cc.Component,properties:{p_arrNodeWuhun:[cc.Node]},onLoad:function(){},refreshUI:function(e,t,a){void 0===t&&(t=!1);for(var i=e.soul,n=0;n<this.p_arrNodeWuhun.length;++n){var r={wuhunid:i[n],isLock:app.db.getWuhunPos(n)>e.star,gdata:e,isReadOnly:t,target:a};this.p_arrNodeWuhun[n].getComponent("wuhunItem").refreshUI(r,n)}}}),cc._RF.pop()},{}],generalPage:[function(e,t){"use strict";cc._RF.push(t,"ed17eCd6+1BSrhFdEcEbd0+","generalPage");var a=cc.Enum({Train:0,UpgradeStar:1,HunShou:2,Skin:3,Book:4}),i=cc.Enum({Default:0,Expedition:1,GeneralRank:2}),n=cc.Class({extends:e("basePage"),statics:{prefabPath:"generalpage"},properties:{p_sprName:cc.Sprite,p_starContainer:cc.Node,p_highStarIcon:cc.Sprite,p_highStarIconBg:cc.Sprite,p_sprStar:[cc.Sprite],p_btnShare:cc.Button,p_arrNodeEmpty:[cc.Node],p_arrNodeERed:[cc.Node],p_nodeExLock:cc.Node,p_nodeExLockTip:cc.Node,p_nodeBwLock:cc.Node,p_nodeBwLockTip:cc.Node,p_nodeBwAdd:cc.Node,p_sprCamp:cc.Sprite,p_sprOccu:cc.Sprite,p_sprOccu2:cc.Sprite,p_labPower:cc.Label,p_nodeGeneral:cc.Node,p_sprGeneral:cc.Sprite,p_spGeneral:sp.Skeleton,p_animGeneral:cc.Animation,p_nodeLeft:cc.Node,p_nodeRight:cc.Node,p_nodeTrain:cc.Node,p_nodeStar:cc.Node,p_nodeWuhun:cc.Node,p_nodeBook:cc.Node,p_animLevelup:cc.Animation,p_spLvUp:sp.Skeleton,p_spDress:[sp.Skeleton],p_spTreasAnim:[cc.Node],soulBindingInfo:cc.Node,ropeNode:cc.Node,generalItemL:cc.Node,generalItemR:cc.Node,p_pfbGeneral:cc.Prefab,_generalItemR:null,_generalItemL:null,btnLayout:cc.Node,btnEquipOff:cc.Node,btnEquipOn:cc.Node,btnUpgrade:cc.Node,costLayout:cc.Node,btnRest:cc.Button,equipFlashAnims:[cc.Node],btnGenRank:cc.Button,p_spriteBg:cc.Sprite,p_nodeSkinPanel:cc.Node,p_btnExclusiveEquip:cc.Button,p_spExclusiveIcon:cc.Sprite,p_labActivateTip:cc.Label,p_labUnableActivateTip:cc.Label,p_labExclusiveName:cc.Label,p_nodeExclusiveLv:cc.Node,p_nodeTrainPanel:cc.Node,p_nodeBookBg:cc.Node,p_nodeBeastBg:cc.Node,p_nodeSkinBg:cc.Node,p_nodeTopBtn:cc.Node,p_pfbEquipItem:cc.Prefab,p_nodeEquipContent:cc.Node,_equipList:[],p_pfbGQuality:cc.Prefab,p_nodeQContent:cc.Node,_generalQualityItem:null,p_nodeMaxTip:cc.Node,_sourceType:0,_isShowMode:!1,p_matOutflew:cc.Material,p_nodeHunShou:cc.Node},onLoad:function(){n.instance=this,this.handleUI(),this.stopBgNodeEvent(),this.fitTopMenu(80),this.m_interval=0,this.p_nodeLeft.active=!1,this.p_nodeRight.active=!1,this.node.getComponent("menu").init(this),this.p_nodeTrain.getComponent("generalPageTrain").init(this),this.p_nodeStar.getComponent("generalPageStar").init(this),this.p_nodeBook.getComponent("generalPageBook").init(this),this.p_nodeHunShou.getComponent("generalPagePot").init(this)},start:function(){this.addEvent(),this._exclOriginPos=this.p_btnExclusiveEquip.node.getPosition()},update:function(e){if(this.m_interval+=e,this.m_interval>.3&&!this.isPlayGSound){if(!this.m_nowPlayGsid)return;this.isPlayGSound=!0;var t=app.db.getSoundByGsid(this.m_nowPlayGsid);t&&app.playGeneralSound(t,1),this.m_nowPlayGsid=null}},handleUI:function(){var e=this;this._super(),this.p_nodeLeft.on("touchend",function(){e._bLoad||!e.m_arrGeneral||e.m_nIndex<=0||function(){if(cc.isValid(e)){var t={type:0};e._isShowMode?t.gsid=e.m_arrGeneral[e.m_nIndex-1]:t.guid=e.m_arrGeneral[e.m_nIndex-1],e.refreshUI(t),e.refreshArrow(e.m_nIndex-1),audioMsg.stopAllEffects(),e.m_interval=0,e.isPlayGSound=!1}}()}),this.p_nodeRight.on("touchend",function(){e._bLoad||!e.m_arrGeneral||e.m_nIndex>=e.m_arrGeneral.length-1||function(){if(cc.isValid(e)){var t={type:0};e._isShowMode?t.gsid=e.m_arrGeneral[e.m_nIndex+1]:t.guid=e.m_arrGeneral[e.m_nIndex+1],e.refreshUI(t),e.refreshArrow(e.m_nIndex+1),audioMsg.stopAllEffects(),e.m_interval=0,e.isPlayGSound=!1}}()}),this.p_sprCamp.node.on("touchend",function(){app.pages.windowspagetipscamp.showPage({camp:e.m_camp})}),this.p_sprOccu.node.on("touchend",function(){app.pages.windowspagetipsoccu.showPage({occu:e.m_occu1})}),this.p_sprOccu2.node.on("touchend",function(){app.pages.windowspagetipsoccu.showPage({occu:e.m_occu2})}),this.p_arrNodeEmpty.forEach(function(t,a){4==a?t.on("touchend",function(){if((!e._isShowMode||e._sourceType===i.GeneralRank)&&app.db.checkFuncUnLock("GENER_MOUNT",!0)&&(!(e.m_objNowGData.level<40)||e.m_objNowGData.exclusive.level))return app.player.isSoulGeneral(e.curShowGuid)?app.showNotice(langMgr.getString("generalPage",7)):void e.onClickExclus()}):5==a?t.on("touchend",function(){if((!e._isShowMode||e._sourceType===i.GeneralRank)&&app.db.checkFuncUnLock("GENER_TERA",!0))return app.player.isSoulGeneral(e.curShowGuid)?app.showNotice(langMgr.getString("generalPage",7)):void e.onClickTreas()}):t.on("touchend",function(){if(!e._isShowMode||e._sourceType===i.GeneralRank)return app.player.isSoulGeneral(e.curShowGuid)?app.showNotice(langMgr.getString("generalPage",7)):void e.onClickEquip(a)})}),this.p_btnShare.node.on("click",function(){var t={type:2,data:{guid:e.m_objNowGData.guid,gname:app.db.getGNameByGsid(e.m_objNowGData.gsid),gstar:e.m_objNowGData.star,rid:app.player.id,sid:app.servid}};app.pages.windowspagesharechat.showPage(t)}),this.btnRest.node.on("click",function(){if(app.playSound("click"),e.handleRest()){var t=e.curShowGuid;app.player.sfGeneralResetPreview(t,function(a,i){if(cc.isValid(e)){var n=app.player.general[t].gsid;i.items.map(function(e){for(var t in e)e.hasOwnProperty(t)&&t.toLowerCase()!==t&&(e[t.toLowerCase()]=e[t],delete e[t]);return e}),i.items.unshift({gsid:n,count:1});var r={title:"\u6b66\u5c06\u91cd\u7f6e",content:langMgr.getString("generalPage",14),props:e.handlePreviewData(i.items),confirmname:"\u91cd\u7f6e",confirmcb:function(){if(app.player.getCount(38005)<20)return app.showNotice(langMgr.getString("generalPage",8));app.player.sfGeneralResetConfirm(t,function(a,i){if(cc.isValid(e)){if(a)return cc.log(a);var n=app.player.general[t];i.splice(0,0,{GSID:n.gsid,COUNT:1});var r={showtype:1,reward:i,target:e};app.pages.windowspagereward.showPage(r),app.player.sfPlayerByParam(["others","battlearr","props","books"],function(){var a=app.db.getNeedRefreshGeneralArray(t);if(a.length>0&&app.player.sfQueryGeneralListInfo(a),cc.isValid(e)){e.refreshUI({guid:t});try{var i=app.pages.generalbaghandbookpage.instance;if(!cc.isValid(i)||!i.node.active)return;var n=i.m_numShowCampIndex;i.m_arrGeneralBagShowData=i.setGeneralBagViewData(n),i.reloadGeneralBagView(),i.refreshMenu()}catch(r){cc.warn("error info: ",r)}}})}})},target:e};app.pages.windowspagepreview.showPage(r)}})}},this),this.btnGenRank.node.on("click",function(){if(app.playSound("click"),this.curShowGuid){var e=app.player.general[this.curShowGuid];e&&app.player.sfGeneralRankAllServers({guid:this.curShowGuid}).then(function(t){app.pages.generalRankListPage.showPage({dataList:t,generalName:e.name||""})}).catch(function(e){return cc.warn(e)})}}.bind(this),this),this.p_btnExclusiveEquip.node.on("click",function(){app.playSound("click"),app.pages.windowsPageTipsExclusiveEquip.showPage({guid:e.curShowGuid})},this)},setParam:function(e){var t;this._isShowMode=e.isShowMode,this._isShowMode&&(this._sourceType=null!=(t=e.sourceType)?t:0),e.garr&&this.initArrGeneral(e),this.refreshUI(e)},refreshUI:function(e){var t,a,n,r,o,s,p=this;if(this._isShowMode?(n=e.gsid,r=null!=(o=e.exclusive_equip)?o:0):n=null!=(s=(a=app.player.general[e.guid]).gsid)?s:a.GSID,!this.needFreshMost&&app.player.isOfficialGeneral(e.guid)&&(this.needFreshMost=!0),this.m_nowPlayGsid=n,this.curShowGuid=null!=(t=e.guid)?t:"",this._isShowMode){var c=app.db.getGBaseByGsid(n);c||(c={GSID:0,NAME:"\u672a\u77e5\u6b66\u5c06",CAMP:1,STAR:1,SKILL:[],TGRADE:0});var h=e.level||app.db.getGMaxLvByGsid(n,c.MAXCLASS),l=e.class||c.MAXCLASS;this.m_property=e.property||app.db.calGPropNoEquip(n,h,c.MAXCLASS);var g=e.power||app.db.getPropertyPower(this.m_property);a={gsid:n,level:h,class:l,skill:e.skill||c.SKILL,property:this.m_property,power:g,exclusive_equip:r,occu:e.occu,occu2:e.occu2}}cc.log("now show general info",a),this.refreshMain(n),this.refreshInfo(a);var d=app.player.isSoulGeneral(this.curShowGuid);if(this.soulBindingInfo.active=d,this.btnLayout.active=!d,this.btnEquipOff.active=!d&&!this._isShowMode,this.p_btnShare.node.active=!this._isShowMode,this.btnEquipOn.active=!d&&!this._isShowMode,this.btnUpgrade.active=!d&&!this._isShowMode,this.costLayout.active=!d&&!this._isShowMode,this.btnGenRank.node.active=!this._isShowMode,this.p_nodeMaxTip.opacity=this._isShowMode&&this._sourceType!==i.GeneralRank?255:0,d&&!this._isShowMode){var u=a.inherit.guid,f=Boolean(u);if(this.ropeNode.active=f,this.generalItemR.active=f,cc.isValid(this._generalItemL)||(this._generalItemL=cc.instantiate(this.p_pfbGeneral),this.generalItemL.addChild(this._generalItemL),this._generalItemL.setPosition(cc.Vec2.ZERO)),this._generalItemL.getComponent("generalPortraitItem").initForTips({gsid:n,level:""+a.level}),cc.isValid(this._generalItemR)||(this._generalItemR=cc.instantiate(this.p_pfbGeneral),this.generalItemR.addChild(this._generalItemR),this._generalItemR.setPosition(cc.Vec2.ZERO)),f)try{var m=app.player.general[u];this._generalItemR.getComponent("generalPortraitItem").initForTips({gsid:m.gsid,level:""+m.level,skinId:m.skin})}catch(y){cc.error("refresh error",JSON.stringify(y)),this._generalItemR.getComponent("generalPortraitItem").initForNone();var _=this._generalItemR.getComponent("generalPortraitItem").getPlusNode();_.off(cc.Node.EventType.TOUCH_END,this),_.on(cc.Node.EventType.TOUCH_END,function(){p.isPastDue()||(app.closeAllPage(),app.pages.generalSoulBindingPage.showPage({guid:p.curShowGuid}))},this)}else{this._generalItemR.getComponent("generalPortraitItem").initForNone();var v=this._generalItemR.getComponent("generalPortraitItem").getPlusNode();v.off(cc.Node.EventType.TOUCH_END,this),v.on(cc.Node.EventType.TOUCH_END,function(){p.isPastDue()||(app.closeAllPage(),app.pages.generalSoulBindingPage.showPage({guid:p.curShowGuid}))},this)}}this.refreshBtnState();var b=a.skin;this.loadGeneralBg(a.gsid,b),this.refreshExclusiveEquip()},refreshBtnState:function(){if(this.btnRest.node.active=app.db.checkFuncUnLock("RELIVE")&&!this._isShowMode,this.btnRest.node.active){var e=app.player.general[this.curShowGuid],t=this.btnRest.node.getChildByName("Render");if(cc.isValid(t)){var a=e.level<=1||app.player.isRetinueGeneral(this.curShowGuid)||app.player.hasBeenSoulBind(this.curShowGuid)||app.player.isSoulGeneral(this.curShowGuid);app.setSpriteState(t.getComponent(cc.Sprite),a)}}},handleRest:function(){var e=app.player.general[this.curShowGuid],t=!1;switch(!0){case app.player.hasBeenSoulBind(this.curShowGuid):app.showNotice(langMgr.getString("generalPage",15));break;case app.player.isRetinueGeneral(this.curShowGuid):app.showNotice(langMgr.getString("generalPage",16));break;case e.level<=1:app.showNotice(langMgr.getString("generalPage",17));break;case app.player.checkIsInLimitTeam(this.curShowGuid):app.goToPage(1053,[null,{menuIdx:1,guid:this.curShowGuid}]);break;case app.player.isSoulGeneral(this.curShowGuid):break;case app.player.isOfficialGeneral(this.curShowGuid):default:t=!0}return t},isPastDue:function(){var e=window.app.player.getServerTime();try{if(e>(app.player.general[this.curShowGuid].expireAt?app.player.general[this.curShowGuid].expireAt:0))return window.app.showNotice(langMgr.getString("generalPage",9)),!0}catch(t){return cc.warn("\u7075\u9b42\u6b66\u5c06\u83b7\u53d6\u8fc7\u671f\u65f6\u95f4\u9519\u8bef"),window.app.showNotice(langMgr.getString("generalPage",9)),!0}return!1},initArrGeneral:function(e){this.m_nIndex=e.index,this.m_arrGeneral=e.garr,this.refreshArrow(this.m_nIndex)},refreshArrow:function(e){this.m_arrGeneral instanceof Array?(this._isShowMode&&(this.p_nodeLeft.y=250,this.p_nodeRight.y=250),this.m_nIndex=e,this.p_nodeLeft.active=3!==this.m_numMenuIndex&&2!==this.m_numMenuIndex&&e>=1&&this.m_arrGeneral.length>=2,this.p_nodeRight.active=3!==this.m_numMenuIndex&&2!==this.m_numMenuIndex&&e<this.m_arrGeneral.length-1&&this.m_arrGeneral.length>=2):this.p_nodeLeft.active=this.p_nodeRight.active=!1},refreshMain:function(e){var t=this;if(e){var a=app.db.getGBaseByGsid(e);a||(a={GSID:0,NAME:"\u672a\u77e5\u6b66\u5c06",CAMP:1,STAR:1});var i=app.db.getGNamePathHByGsid(e);if(app.loadTexture(i,this.p_sprName,this.prefabPath),gConfig.getNameGOccu(a.OCCU-1)){var n=gConfig.getIconGOccuPath(a.OCCU-1);app.loadTexture(n,this.p_sprOccu,this.prefabPath),this.p_sprOccu.node.active=!0,this.m_occu1=a.OCCU}else this.p_sprOccu.node.active=!1;if(a.OCCU2&&gConfig.getNameGOccu(a.OCCU2-1)){var r=gConfig.getIconGOccuPath(a.OCCU2-1);app.loadTexture(r,this.p_sprOccu2,this.prefabPath),this.p_sprOccu2.node.active=!0,this.m_occu2=a.OCCU2}else this.p_sprOccu2.node.active=!1;var o=gConfig.getIconGCampPath(a.CAMP-1);app.loadTexture(o,this.p_sprCamp,this.prefabPath),this.m_camp=a.CAMP;var s=a.STAR;if(this.p_starContainer.opacity=s<10?255:0,this.p_highStarIconBg.node.opacity=s>=10?255:0,s>=10){var p=gConfig.gHightStarBgPath;if(app.loadTexture(p,this.p_highStarIconBg,this.prefabPath,function(){}),s>10){var c=gConfig.getIconCommonStarNumPath(s-10);app.loadTexture(c,this.p_highStarIcon,this.prefabPath,function(){})}}else{var h=(s-1)%5,l=gConfig.getIconGBigStarPath(a.STAR);this.p_sprStar.forEach(function(e,a){e.node.active=h>=a,e.node.active&&app.loadTexture(l,e,t.prefabPath)})}!cc.isValid(this._generalQualityItem)&&a.TGRADE&&(this._generalQualityItem=cc.instantiate(this.p_pfbGQuality),this.p_nodeQContent.addChild(this._generalQualityItem),this._generalQualityItem.setPosition(cc.Vec2.ZERO)),cc.isValid(this._generalQualityItem)&&this._generalQualityItem.getComponent("GeneralQualityItem").init(a.TGRADE)}},refreshEquip:function(t){var a,i,n=Boolean(t.isClick),r=null!=(a=t.equip)?a:[],o=t.treasure?t.treasure.gsid?t.treasure.gsid:t.treasure:null,s=null!=(i=t.exclusive)?i:{level:0,gsid:39e3},p=t.clickEquipGsid;t.clickTreasGsid,this.m_objEquipData={};for(var c=0;c<r.length;++c){var h=r[c];if(h){var l=app.db.getEBaseByGsid(h);this.m_objEquipData[l.POS]=h}}for(var g=0;g<4;++g){var d=g+1;if(this.m_objEquipData[d]){var u=this.getEquipItemByPos(g);u.getComponent("propItem").initForGEquip(this.m_objEquipData[d]),u.active=!0,n?this.playDressAnim(this.p_spDress[g]):p==this.m_objEquipData[d]&&this.playDressAnim(this.p_spDress[g])}else cc.isValid(this._equipList[g])&&this._equipList[g].active&&(this._equipList[g].active=!1);this.refreshEquipAnim(g),this.p_arrNodeERed[g].active=!this._isShowMode&&app.pages.generalbaghandbookpage.checkEquip(t.guid,g)&&!app.player.isSoulGeneral(this.curShowGuid)}var f=t.level<40&&s.level<=0||t.level>=40&&0==s.level||!app.db.checkFuncUnLock("GENER_MOUNT"),m=s.level>0&&app.db.checkFuncUnLock("GENER_MOUNT");if(this.p_nodeExLock.active=f,!m&&t.level<40?(this.p_nodeExLockTip.getComponent(cc.Label).string=langMgr.getString("generalPage",13),this.p_nodeExLockTip.active=!0):this.p_nodeExLockTip.active=!1,!m&&cc.isValid(this._equipList[4])&&this._equipList[4].active)this._equipList[4].active=m;else if(m){var _=this.getEquipItemByPos(4);_.active=!0,_.getComponent("propItem").initForGExclus(s.gsid,s.level,f,!m)}n&&m&&this.playDressAnim(this.p_spDress[4]),this.p_arrNodeERed[4].active=!this._isShowMode&&app.pages.generalbaghandbookpage.checkMount(t.guid)&&!app.player.isSoulGeneral(this.curShowGuid);var v=!app.db.checkFuncUnLock("GENER_TERA"),b=!app.db.checkFuncUnLock("GENER_TERA");if(this.p_nodeBwLock.active=v,this.p_nodeBwLockTip.active=v,n&&o&&this.playDressAnim(this.p_spDress[5]),v){var y=e("dbFuncLock").GENER_TERA,P=null==y?void 0:y.LEVEL;this.p_nodeBwLockTip.getComponent(cc.Label).string=langMgr.getString("generalPage",12,P)}if(this.p_nodeBwAdd.active=!v,o){var w=this.getEquipItemByPos(5);w.getComponent("propItem").initForGExclus(o,s.level,v,b),w.active=!0,t.treasure.guid?this.p_spTreasAnim.forEach(function(e){e.active=!0}):this.p_spTreasAnim.forEach(function(e){e.active=!1})}else cc.isValid(this._equipList[5])&&this._equipList[5].active&&(this._equipList[5].active=!1),this.p_spTreasAnim.forEach(function(e){e.active=!1});this.p_arrNodeERed[5].active=!this._isShowMode&&app.pages.generalbaghandbookpage.checkTreas(t.guid)&&app.db.checkFuncUnLock("GENER_TERA")&&!app.player.isSoulGeneral(this.curShowGuid)},getEquipItemByPos:function(e){var t=this;e=cc.misc.clampf(e,0,5);var a=this._equipList[e];if(!cc.isValid(a)){var i;switch(a=cc.instantiate(this.p_pfbEquipItem),this.p_nodeEquipContent.addChild(a),a.scale=this.p_arrNodeEmpty[0].width/a.width,this._equipList[e]=a,a.setPosition(this.p_arrNodeEmpty[e].getPosition()),!0){case 4===e:i=function(){t.onClickExclus()};break;case 5===e:i=function(){t.onClickTreas()};break;default:i=function(){t.onClickEquip(e)}}a.on(cc.Node.EventType.TOUCH_END,i,this)}return a},refreshPower:function(e){this.p_labPower.string=e},refreshInfo:function(e){this.m_objNowGData=e;var t=this.refreshMenu(e);this.refreshEquip(e),this.refreshPower(e.power),this.m_numMenuIndex||0==this.m_numMenuIndex||(this.m_numMenuIndex=0),t[this.m_numMenuIndex]||(this.m_numMenuIndex=0),this.node.getComponent("menu").setMenuIndex(this.m_numMenuIndex)},setMenuIndex:function(e){null!=e&&this.node.getComponent("menu").setMenuIndex(e)},refreshMenu:function(e){var t=app.db.getAwakeIdByGsid(e.gsid),a=!!(e.star>=6),i=!this._isShowMode&&t&&e.star>=6&&!app.player.isSoulGeneral(this.curShowGuid),n=app.db.getGeneralSkinList(e.gsid),r=!this._isShowMode&&app.db.checkChannelShow("GENERAL_BOOK")&&app.db.checkFuncUnLock("GENERAL_BOOK")&&!app.player.isSoulGeneral(this.curShowGuid),o=!this._isShowMode&&app.db.checkChannelShow("GENERAL_SKIN")&&Object.keys(n).filter(function(e){return n[e].VISIBLE}).length>1,s=o||a||i||app.player.isSoulGeneral(this.curShowGuid)||r;return this.node.getComponent("menu").p_arrBtnMenu[0].active=s,this.node.getComponent("menu").p_arrBtnMenu[1].active=i,this.node.getComponent("menu").p_arrBtnMenu[2].active=a,this.node.getComponent("menu").p_arrBtnMenu[3].active=o,this.node.getComponent("menu").p_arrBtnMenu[4].active=r,this.node.getComponent("menu").refreshRed(),[s,i,a,o,r]},showGeneralEffAnim:function(){var e=this;app.loadSpine("game_ui_spine/level_up/shengji",this.p_spLvUp,function(){cc.log("load succ"),e.p_spLvUp.setAnimation(0,"animation",!1)},null,this.prefabPath)},menuHandler:function(e){var t;this.p_nodeTrain.active=0==e,this.p_nodeStar.active=1==e,this.p_nodeSkinPanel.active=3===e,this.p_nodeSkinBg.active=3==e,this.p_nodeBook.active=4==e,this.p_nodeBookBg.active=4==e,this.p_nodeGeneral.active=4!=e&&2!=e,this.p_nodeTopBtn.active=4!=e,this.p_nodeHunShou.active=2==e,this.p_nodeBeastBg.active=2==e,this.m_numMenuIndex=e,this.p_nodeTrainPanel.active=this._isShowMode?3!==e&&4!=e&&2!=e&&Boolean(this.m_objNowGData.equip):3!==e&&4!=e&&2!=e,this.p_nodeQContent.active=2!=e,this._isShowMode&&(this.p_nodeQContent.x=150,this.p_nodeQContent.y=-250),this.refreshArrow(this.m_nIndex);var i=app.player.general[this.curShowGuid],n=app.db.getGBaseByGsid(null!=(t=null==i?void 0:i.gsid)?t:this.m_nowPlayGsid);if(cc.isValid(this._generalQualityItem)){var r=4!==e&&3!==e&&Boolean(n.TGRADE);this._generalQualityItem.opacity=r?255:0}if(3!==e)if(this._isShowMode)this.loadGeneralSkin(i&&i.skin?i.skin:null),this.loadGeneralBg(this.m_nowPlayGsid);else{var o=i.skin;this.loadGeneralSkin(o),this._displaySkinId!=o&&this.loadGeneralBg(i.gsid,o)}this.p_btnExclusiveEquip.node.opacity=2!=e&&3!==e&&4!==e?255:0;var s=3!==e&&4!==e?this._exclOriginPos?this._exclOriginPos:this.p_btnExclusiveEquip.node.getPosition():cc.v2(5e3,5e3);switch(this.p_btnExclusiveEquip.node.setPosition(s),!0){case e==a.Train:this.p_nodeTrain.getComponent("generalPageTrain").refreshUI(this.m_objNowGData,!1,!0);break;case!this._isShowMode&&e==a.UpgradeStar:this.p_nodeStar.getComponent("generalPageStar").refreshUI(this.m_objNowGData);break;case e==a.HunShou:this.p_nodeHunShou.getComponent("generalPagePot").refreshUI(this.curShowGuid);break;case!this._isShowMode&&e==a.Skin:this.p_nodeSkinPanel.getComponent("GeneralSkinPanel").refreshUI(this.curShowGuid);break;case!this._isShowMode&&e==a.Book:this.p_nodeBook.getComponent("generalPageBook").refreshUI(this.curShowGuid)}return!0},refreshMenuRed:function(e){if(this._isShowMode)return!1;var t=!1;switch(e){case 0:for(var a=0;a<4;++a)if(app.pages.generalbaghandbookpage.checkEquip(this.m_objNowGData.guid,a))return!0;if(t=app.pages.generalbaghandbookpage.checkTreas(this.m_objNowGData.guid))return t;t=app.pages.generalbaghandbookpage.checkMount(this.m_objNowGData.guid);var i=app.pages.generalbaghandbookpage.checkExclusiveEquip(this.m_objNowGData.guid);t=t||i;break;case 1:t=app.pages.generalbaghandbookpage.checkStarUp(this.m_objNowGData.guid);break;case 2:for(var n=0;n<5;++n)if(app.pages.generalbaghandbookpage.checkSoulStone(this.m_objNowGData.guid,n))return!0;break;case 3:t=app.pages.generalbaghandbookpage.checkGeneralSkin(this.m_objNowGData.guid)}return t},onClickEquip:function(e){var t=e+1,a=this.m_objEquipData[t];if(a||this._isShowMode){var i={};i.gsid=a,i.type=this._isShowMode?0:1,i.general=this.m_objNowGData.guid,i.isHideBtn=!this._isShowMode&&app.player.isSoulGeneral(this.curShowGuid),i.equipPos=e,i.upcb=function(e){e&&app.pages.generalpage.instance.refreshInfo(e)},app.pages.windowspagetipsequip.showPage(i)}else{var n={};n.general=this.m_objNowGData.guid,n.pos=t,app.pages.windowspagelistequip.showPage(n)}},onClickTreas:function(){if(app.db.checkFuncUnLock("GENER_TERA",!0)||this._isShowMode){var e=this.m_objNowGData.treasure?this.m_objNowGData.treasure.guid?this.m_objNowGData.treasure.gsid:this.m_objNowGData.treasure:null;if(e||this._isShowMode){var t={};t.gsid=e,this.m_objNowGData.treasure&&this.m_objNowGData.treasure.guid&&(t.guid=this.m_objNowGData.treasure.guid),t.type=this._isShowMode?0:1,t.general=this.m_objNowGData.guid,t.treasure=this.m_objNowGData.treasure,t.isHideBtn=app.player.isSoulGeneral(this.curShowGuid),t.upcb=function(e){e&&cc.isValid(app.pages.generalpage.instance)&&app.pages.generalpage.instance.refreshInfo(e)},app.pages.windowspagetipstreas.showPage(t)}else{var a={};a.general=this.m_objNowGData.guid,a.pos=6,app.pages.windowspagelistequip.showPage(a)}}},onClickExclus:function(){var e=this;if(this._isShowMode){if(this.m_objNowGData.exclusive.level){var t={data:this.m_objNowGData.exclusive,general:this.m_objNowGData.guid,isHideBtn:!0};app.pages.windowspagetipsexclus.showPage(t)}}else{if(!app.db.checkFuncUnLock("GENER_MOUNT",!0))return;if(cc.log("now click Exclus",this.m_objNowGData.exclusive),this.m_objNowGData.level<40&&!this.m_objNowGData.exclusive.level)return void app.showNotice(langMgr.getString("generalPage",10));if(this.m_objNowGData.exclusive.level){var a={data:app.player.general[this.m_objNowGData.guid].exclusive,general:this.m_objNowGData.guid,isHideBtn:app.player.isSoulGeneral(this.curShowGuid),funup:function(e){e&&cc.isValid(app.pages.generalpage.instance)&&app.pages.generalpage.instance.refreshInfo(e)}};app.pages.windowspagetipsexclus.showPage(a)}else cc.log("now general guid is",this.m_objNowGData.guid),app.player.sfExcluLevel(this.m_objNowGData.guid,0,function(t,a){if(t)app.showNotice(t);else if(app.player.addGeneral(a),app.showNotice(langMgr.getString("generalPage",11)),cc.isValid(e)){var i=app.player.general[e.m_objNowGData.guid];e.refreshInfo(i),e.playDressAnim(e.p_spDress[4])}})}},onClose:function(){var e=this;if(this._super(),this._isShowMode)audioMsg.stopAllEffects(),this.isPlayGSound=!1,eventMgr.emit(eventStr.windowspagegotopub.refreshflag),GodGuide.checkGuideProgress("showZZYZ_END")&&app.runGuide();else{var t=app.pages.generalbaghandbookpage.instance;if(!t||!cc.isValid(t.node)||!t.node.active)return;var a=this.needFreshMost;this.p_nodeTrain.getComponent("generalPageTrain").refreshRetinueSoulInfo(function(){a&&app.player.refreshMostGeneral();var i=t.m_numShowCampIndex;t.m_arrGeneralBagShowData=t.setGeneralBagViewData(i),t.reloadGeneralBagView(),t.refreshMenu(),audioMsg.stopAllEffects(),cc.isValid(e)&&(e.m_interval=0,e.isPlayGSound=!1)})}},onDestroy:function(){this._super(),this.removeEvent()},addEvent:function(){var e=this;cc.director.on("EVT_SKIN_PREVIEW_CHANGED",function(t){cc.log("=== Change General Skin Preview ==="),e.loadGeneralSkin(t);var a=app.player.general[e.curShowGuid];a&&e.loadGeneralBg(a.gsid,t)},this),cc.director.on("EVT_SKIN_DISPLAY_CHANGED",function(t){cc.log("=== Change General Skin Display ==="),e.loadGeneralSkin(t);var a=app.player.general[e.curShowGuid];a&&(e.loadGeneralBg(a.gsid,t),e.refreshPower(a.power))},this),cc.director.on("EVT_REFRESH_EXCLUSIVE_STATUS",function(){e.refreshExclusiveEquip(),e.refreshUI({guid:e.curShowGuid})},this),cc.director.on("EVT_REFRESH_SKIN_RED_POINT",function(){cc.isValid(e.node.getComponent("menu"))&&e.node.getComponent("menu").refreshTargetMenuRed(a.Skin)},this),cc.director.on("EVT_REFRESH_BOOK_RED",function(){cc.isValid(e.node.getComponent("menu"))&&e.node.getComponent("menu").refreshTargetMenuRed(a.Book)},this)},loadGeneralBg:function(e,t){var a=app.db.getGBaseByGsid(e);if(!t||app.db.isDefaultSkin(e,t))app.loadTexture(app.db.getGeneralBgByCamp(a.CAMP),this.p_spriteBg,this.prefabPath);else{if(!app.db.getGeneralSkinList(e)[t])return;var i=app.db.getSkinThemeBySkinId(e,t);i&&app.loadTexture(i,this.p_spriteBg,this.prefabPath)}},loadGeneralSkin:function(e){var t,a=this;if(this._isShowMode)t=this.m_nowPlayGsid;else{var i=app.player.general[this.curShowGuid];if(!i)return;t=i.gsid}this._bLoad=!0,app.loadGeneral(t,this.p_sprGeneral,this.p_spGeneral,this.p_animGeneral,function(){cc.isValid(a)&&(a._bLoad=!1,a._displaySkinId=e)},this.prefabPath,e)},removeEvent:function(){cc.director.targetOff(this)},playDressAnim:function(e){cc.isValid(e)&&(e.node.active=!0,e.setAnimation(1,"effect",!1))},refreshEquipAnim:function(e){if(!this._isShowMode){var t=app.player.general[this.curShowGuid],a=t.occu,i=t.occu2,n=[];n.push.apply(n,[a,i]);var r=this.m_objNowGData.equip;if(r){var o=r[e];if(o){var s=app.db.getEBaseByGsid(o).OCCU,p=!1;s&&(p=n.includes(s)),this.getEquipItemByPos(e).getComponent("propItem").setSpine(p,"suitEquip/rewardreceivingtips","animation",1.2)}}}},handlePreviewData:function(e){var t=e.filter(function(e){return"general"===app.db.getTypeByGsid(e.gsid)}).sort(function(e,t){var a=app.db.getGBaseByGsid(e.gsid).STAR||0;return(app.db.getGBaseByGsid(t.gsid).STAR||0)-a}),a=[38006,30001,30015,30026],i=e.filter(function(e){return a.includes(e.gsid)}).sort(function(e,t){return a.indexOf(e.gsid)-a.indexOf(t.gsid)}),n=e.filter(function(e){return"equip"===app.db.getTypeByGsid(e.gsid)}).sort(function(e,t){return(app.db.getEBaseByGsid(e.gsid).POS||1)-(app.db.getEBaseByGsid(t.gsid).POS||1)}),r=e.filter(function(e){return"treas"===app.db.getTypeByGsid(e.gsid)}),o=e.filter(function(e){return"book"===app.db.getTypeByGsid(e.gsid)});return[].concat([].concat(t,i,n,r,o))},refreshExclusiveEquip:function(){if(this._isShowMode)this.p_btnExclusiveEquip.active=!1;else{var e=app.player.general[this.curShowGuid],t=app.db.getLowestGsidByGuid(this.curShowGuid);if(t&&e){var a=app.db.getGenExclEquipInfoByGsid(t),i=app.player.isSoulGeneral(this.curShowGuid),n=e.exclusive_equip?e.exclusive_equip:0,r=app.db.getExclConsumeByGsid(e.gsid,n),o=n===app.db.getExclMaxLv(e.gsid)||r.length>0;if(this.p_btnExclusiveEquip.node.active=2!=this.m_numMenuIndex&&4!=this.m_numMenuIndex&&e.star>8&&Boolean(a)&&o&&!i&&app.db.checkChannelShow("GENERAL_EXCLUSIVE_EQUIP"),this.p_btnExclusiveEquip.node.active&&(void 0===this.p_exclusiveTween&&cc.isValid(this.p_spExclusiveIcon)&&(this.p_exclusiveTween=cc.tween(this.p_spExclusiveIcon.node).repeatForever(cc.tween().by(2,{y:7}).by(2,{y:-7}).delay(.1)).start()),this.p_btnExclusiveEquip.node.getChildByName("rednotice").opacity=app.pages.generalbaghandbookpage.checkExclusiveEquip(this.curShowGuid)?255:0,this.p_nodeExclusiveLv.opacity=n>0?255:0,n>0&&(this.p_nodeExclusiveLv.getComponent(cc.Label).string="+"+n),a)){var s=app.db.getExclusiveTinyIconPath(a.TINY_ICON);app.loadTexture(s,this.p_spExclusiveIcon,this.prefabPath);var p=Boolean(n);if(p&&this.p_matOutflew){this.p_spExclusiveIcon.setMaterial(0,this.p_matOutflew);var c=n>=30?2:this._equipLv/10|0,h=(new cc.Color).fromHEX(a.BG_COLORS[c]);this.p_spExclusiveIcon.getMaterial(0).setProperty("uGlowColor",h)}else app.setSpriteState(this.p_spExclusiveIcon,p);this.p_labActivateTip.node.opacity=!p&&e.star>=11?255:0,this.p_labUnableActivateTip.node.opacity=!p&&e.star<11?255:0,this.p_labExclusiveName.node.opacity=e.star>=11&&p?255:0,e.star<11?this.p_labUnableActivateTip.string=langMgr.getString("generalPage",19,11):p?this.p_labExclusiveName.string=langMgr.getString("generalPage",20):this.p_labActivateTip.string=langMgr.getString("generalPage",18)}}}}});cc._RF.pop()},{basePage:void 0,dbFuncLock:void 0}],generalRelivePage:[function(e,t){"use strict";cc._RF.push(t,"16da1adF35KfZ1e6hGnvXPg","generalRelivePage");var a=[{coin:[38006,30001,30015,30014]},{coin:[38006,30001,30015,38005]},{coin:[30042,30036,30037]}],i=["RELIVE","RELIVE","RELIVE_REBORN"],n=cc.Class({extends:e("basePage"),statics:{prefabPath:"generalrelivepage"},properties:{p_tabvGeneral:cc.Node,p_labGNum:cc.Label,p_nodeGirl:cc.Node,p_labIntro:cc.Sprite,p_arrSprF:[cc.SpriteFrame],p_pfbGeneralItem:cc.Prefab,p_nodeRelive:cc.Node,p_btnDeComp:cc.Button,p_btnPick:cc.Button,p_nodePickedList:cc.Node,p_tabvGeneralPicked:cc.Node,p_nodeBgReset:cc.Node,p_nodeBgResetList:cc.Node,p_nodeReset:cc.Node,p_nodePickedReset:cc.Node,p_tabvResetList:cc.Node,p_btnReset:cc.Button,p_nodeBgReborn:cc.Node,p_nodeBgRebornList:cc.Node,p_nodeReborn:cc.Node,p_nodePickedReborn:cc.Node,p_tabvRebornList:cc.Node,p_btnReborn:cc.Button,p_sprRebornCoin:cc.Sprite,p_labRebornCoin:cc.Label,p_nodeCoin:cc.Node,p_nodeCoinItem:cc.Node,p_nodeShop:cc.Button,p_btnHelp:cc.Button,autoDismissSwitch:cc.Node,dismissFrames:[cc.SpriteFrame],p_pfbMenuSelector:cc.Prefab,p_nodeMenuContent:cc.Node,_nodeMenuCampCtrl:cc.Node,p_sprResetCoin:cc.Sprite},onLoad:function(){var e=this;n.instance=this,this.stopBgNodeEvent(),this.creatMask(!1,255,"#000000"),this.handleUI(),this.fitTopMenu();var t=cc.instantiate(this.p_pfbMenuSelector);this.p_nodeMenuContent.addChild(t),t.setPosition(cc.Vec2.ZERO),this.campIndex=0,this.professIndex=0,this.m_campMenu=t.getComponent("GeneralMenuSelector"),this.m_campMenu.onCampClick(this.campMenuHandler,this),this.m_campMenu.onProfessionClick(this.professMenuHandler,this),this.m_menu=this.node.getComponent("menu"),this.m_menu.init(this),app.runUnlockGuide("RELIVE"),window.eventMgr.on(eventStr.battleEvent.ExitBattle,function(){e.refreshUI(e.m_menuIndex)},this),window.eventMgr.on(eventStr.soulBinding.ExitBinding,function(){e.refreshUI(e.m_menuIndex)},this);var a=app.db.getPropsIconPath(38005);app.loadTexture(a,this.p_sprResetCoin,this.prefabPath)},handleUI:function(){var e=this;this._super(),this.p_btnPick.node.on("click",function(){app.playSound("click"),e.onClickBtnPick()}),this.p_btnDeComp.node.on("click",function(){app.playSound("click"),e.onClickBtnDeComp()}),this.p_btnReset.node.on("click",function(){app.playSound("click"),e.onClickReset()}),this.p_btnReborn.node.on("click",function(){app.playSound("click"),e.onClickReborn()}),this.p_nodePickedReset.on("touchend",function(){app.playSound("click"),e.onClickPickedReset()}),this.p_nodePickedReborn.on("touchend",function(){app.playSound("click"),e.onClickPickedReborn()}),this.p_nodeShop.node.on("click",function(){app.playSound("click"),app.pages.shoppage.showPage("decomp")}),this.p_btnHelp.node.on("click",function(){0==e.m_numNowIndex?app.pages.windowspagetipshelp.showPage("1010"):1==e.m_numNowIndex?app.pages.windowspagetipshelp.showPage("1011"):app.pages.windowspagetipshelp.showPage("1012")}),this.autoDismissSwitch.getComponent(cc.Sprite).spriteFrame=this.dismissFrames[Number(app.player.autodecomp)],this.autoDismissSwitch.on("click",function(){app.playSound("click"),app.player.sfChangeDismiss(!app.player.autodecomp,function(){app.player.sfPlayerByParam(["others","props","books"],function(){app.player.autodecomp=Number(!app.player.autodecomp),cc.isValid(e)&&(e.autoDismissSwitch.getComponent(cc.Sprite).spriteFrame=e.dismissFrames[Number(app.player.autodecomp)])})})},this)},setParam:function(e){this.campIndex=0,this.m_arrPickedId=[],this.m_arrPickedGeneral=[],this.m_arrRelivePicked=[];var t=e?e.menuIdx:0;e&&e.guid&&(this.preSelectGuid=e.guid),this.m_menu.setMenuIndex(t||0),this.m_campMenu.initMenu(this.campIndex,this.professIndex),this.campMenuHandler(this.campIndex),this.p_nodeShop.node.active=app.db.checkFuncUnLock("DISMISS_SHOP"),app.db.checkChannelShow("RELIVE_REBORN")||(this.m_menu.p_arrBtnMenu[2].active=!1,this.m_menu.p_arrBtnMenu.splice(2,1))},scrollToPick:function(e){var t=this.m_arrShowData.indexOf(e);if(!(t<0)){var a=this.p_tabvGeneral.getComponent("tableView"),i=a.getScrollOffset().y,n=a.cell.data.height,r=a._groupCellCount,o=Math.floor(t/r),s=0!=o?a.top:0,p=(n+a.spacingY)*o+s;p>i&&a.scrollToOffset(cc.v2(0,p),0)}},refreshUI:function(e){switch(this.m_campMenu.resetMenu(),this.campIndex=0,this.professIndex=0,this.m_arrShowData=this.setData(),e){case 0:this.m_arrPickedGeneral=[],this.m_arrPickedId=[],this.m_arrRelivePicked=[],this.p_labIntro.spriteFrame=this.p_arrSprF[0],this.refreshView(),this.refreshNumPick(),this.refreshPickView();break;case 1:this.m_strPickedResetId=null,this.m_chooseItem=null,this.m_arrPickedGeneral=[],this.m_arrPickedId=[],this.p_labIntro.spriteFrame=this.p_arrSprF[1],this.refreshView(),this.refreshReset();break;case 2:this.m_strPickedRebornId=null,this.m_chooseItem=null,this.m_arrPickedGeneral=[],this.m_arrPickedId=[],this.p_labIntro.spriteFrame=this.p_arrSprF[2],this.refreshView(),this.refreshReborn()}this.p_nodeRelive.active=0==e,this.p_nodeReset.active=1==e,this.p_nodeReborn.active=2==e,this.p_btnPick.node.active=app.player.level>=20,this.refreshCoinUI(),this.refreshMenu(),this.m_menuIndex=e},refreshView:function(){var e=this,t=this.m_arrShowData.length;this.p_labGNum.string=this.m_numMax+"/"+app.player.bagspace;var a=0==this.m_numNowIndex?10:1;this.p_tabvGeneral.getComponent("tableView").initTableView(t,{array:this.m_arrShowData,maxpick:a,initfun:"initForBagInTeam",target:this,iscomp:!0,isReset:1===this.m_numNowIndex},function(){e.preSelectGuid&&(e.scrollToPick(e.preSelectGuid),app.pages.windowsPageGeneralTeamList.showPage({guid:e.preSelectGuid}),e.preSelectGuid=null)})},refreshPickView:function(){var e=this.m_arrRelivePicked.length;if(e<=0)return this.p_nodePickedList.active=!1,void(this.p_nodeGirl.active=!0);this.p_nodePickedList.active=!0,this.p_nodeGirl.active=!1,this.p_tabvGeneralPicked.getComponent("tableView").initTableView(e,{array:this.m_arrRelivePicked,initfun:"initForBagInTeam",clickfun:this.pickedClick,arrpick:this.m_arrRelivePickedId,nomask:!0,target:this,iscomp:!0,isReset:1===this.m_numNowIndex})},refreshNumPick:function(){this.m_arrPickedGeneral.length},refreshReset:function(){var e=this;this.m_strPickedResetId?(this.p_nodeGirl.active=!1,this.p_nodeBgReset&&(this.p_nodeBgReset.active=!0),this.p_nodeBgResetList&&(this.p_nodeBgResetList.active=!0),app.player.sfGeneralResetPreview(this.m_strPickedResetId,function(t,a){if(t)app.showNotice(t);else{a.items.length,e.m_nodePickedReset||(e.m_nodePickedReset=cc.instantiate(e.p_pfbGeneralItem),e.m_nodePickedReset.parent=e.p_nodePickedReset),e.m_nodePickedReset.getComponent("generalPortraitItem").initForBag(e.m_strPickedResetId),e.p_nodePickedReset.active=!0,e.p_tabvResetList.active=!0,cc.log("now show reset list",a.items);var i=app.player.general[e.m_strPickedResetId];a.items.splice(0,0,{GSID:i.gsid,COUNT:1});var n=e.handlePreviewData(a.items);console.log(n),e.p_tabvResetList.getComponent("tableView").initTableView(n.length,n),e.p_btnReset.interactable=!0,app.setSpriteState(e.p_btnReset.node.getChildByName("icon").getComponent(cc.Sprite),!1),app.setSpriteState(e.p_btnReset.node.getChildByName("tx").getComponent(cc.Sprite),!1)}})):(this.p_nodeGirl.active=!0,this.p_nodeBgReset&&(this.p_nodeBgReset.active=!1),this.p_nodeBgResetList&&(this.p_nodeBgResetList.active=!1),this.p_nodePickedReset.active=!1,this.p_tabvResetList.active=!1,this.p_btnReset.interactable=!1,app.setSpriteState(this.p_btnReset.node.getChildByName("icon").getComponent(cc.Sprite),!0),app.setSpriteState(this.p_btnReset.node.getChildByName("tx").getComponent(cc.Sprite),!0))},refreshReborn:function(){var e=this;this.m_strPickedRebornId?(this.p_nodeGirl.active=!1,this.p_nodeBgReborn&&(this.p_nodeBgReborn.active=!0),this.p_nodeBgRebornList&&(this.p_nodeBgRebornList.active=!0),app.player.sfGeneralRebornPreview(this.m_strPickedRebornId,function(t,a){if(t)app.showNotice(t);else{e.m_nodePickedReborn||(e.m_nodePickedReborn=cc.instantiate(e.p_pfbGeneralItem),e.m_nodePickedReborn.parent=e.p_nodePickedReborn),e.m_nodePickedReborn.getComponent("generalPortraitItem").initForBag(e.m_strPickedRebornId),e.p_nodePickedReborn.active=!0,e.p_tabvRebornList.active=!0;var i=e.setReviewData(a);i.length,cc.log("now show reborn list",i);var n=app.player.general[e.m_strPickedRebornId];a.items.splice(0,0,{GSID:n.gsid,COUNT:1});var r=e.handlePreviewData(i);e.p_tabvRebornList.getComponent("tableView").initTableView(r.length,r),e.p_btnReborn.node.active=!0,e.m_rebornCost=app.db.getCostByStar(n.star);var o=app.db.getPropsIconPath(e.m_rebornCost.GSID);app.loadTexture(o,e.p_sprRebornCoin,e.prefabPath),e.p_labRebornCoin.string=e.m_rebornCost.COUNT}})):(this.p_nodeGirl.active=!0,this.p_nodeBgReborn&&(this.p_nodeBgReborn.active=!1),this.p_nodeBgRebornList&&(this.p_nodeBgRebornList.active=!1),this.p_nodePickedReborn.active=!1,this.p_tabvRebornList.active=!1,this.p_btnReborn.node.active=!1)},setReviewData:function(e){var t=[],a=0;if(e.items)for(var i=0;i<e.items.length;++i)t.push(e.items[i]);if(e.general)for(var n=0;n<e.general.length;++n){var r={};for(var o in e.general[n])r[o.toUpperCase()]=e.general[n][o];a+=r.COUNT,r.MATER=!0,r.COUNT>0&&t.push(r)}return this.m_numGetGeneral=a,t},menuHandler:function(e){if(""!=i[e]&&!app.db.checkFuncUnLock(i[e],!0))return!1;this.m_numNowIndex=e,this.refreshUI(e)},refreshMenu:function(){this.node.getComponent("menu").p_arrBtnMenu.forEach(function(e,t){var a=""!=i[t]&&!app.db.checkFuncUnLock(i[t]);e.active=!a})},pickedClick:function(e){var t=this.m_arrPickedId.indexOf(e),a=this.m_arrPickedGeneral.indexOf(e);t>=0&&a>=0&&(this.m_arrPickedId.splice(t,1),this.m_arrPickedGeneral.splice(a,1)),this.p_tabvGeneral.getComponent("tableView").reload({array:this.m_arrShowData,maxpick:10,initfun:"initForBagInTeam",target:this,iscomp:!0,isReset:1===this.m_numNowIndex});var i=this.m_arrRelivePicked.indexOf(e);return i>=0&&this.m_arrRelivePicked.splice(i,1),this.refreshPickView(),!1},itemClick:function(e,t){var a=!t.p_nodeMask.active;if(0==this.m_numNowIndex)if(this.setArrGeneral(e,a),this.refreshNumPick(),a&&this.m_arrRelivePicked.length<10)this.m_arrRelivePicked.push(e),this.refreshPickView();else{var i=this.m_arrRelivePicked.indexOf(e);i>=0&&this.m_arrRelivePicked.splice(i,1),this.refreshPickView()}else 1==this.m_numNowIndex?(this.m_chooseItem&&(cc.log("handle choose item"),this.m_chooseItem.selected(!1,this.m_strPickedResetId)),e==this.m_strPickedResetId?(this.m_chooseItem=null,this.m_strPickedResetId=null):(this.m_chooseItem=t,this.m_strPickedResetId=e),this.refreshReset()):(this.m_chooseItem&&(cc.log("handle choose item"),this.m_chooseItem.selected(!1,this.m_strPickedRebornId)),e==this.m_strPickedRebornId?(this.m_chooseItem=null,this.m_strPickedRebornId=null):(this.m_chooseItem=t,this.m_strPickedRebornId=e),this.refreshReborn());return a},campMenuHandler:function(e){return this.p_tabvGeneral.getComponent("tableView")._isInitTabv?(cc.log("now init tabv no end"),!1):(cc.log("campMenuHandler",e),this.campIndex=e,this.m_arrShowData=this.setData(),this.p_tabvGeneral.getComponent("tableView")._isInitTabv=!0,this.refreshView(),!0)},professMenuHandler:function(e){return this.p_tabvGeneral.getComponent("tableView")._isInitTabv?(cc.log("now init tabv no end"),!1):(cc.log("professMenuHandler",e),this.professIndex=e,this.m_arrShowData=this.setData(),this.p_tabvGeneral.getComponent("tableView")._isInitTabv=!0,this.refreshView(),!0)},setData:function(){var e=[];for(var t in this.m_numMax=0,this.m_numHave=0,app.player.general)if(!app.player.isSoulGeneral(t)&&!app.player.isRetinueGeneral(t)){var a=app.player.general[t];if(a&&++this.m_numHave,0==this.m_numNowIndex){if(a.star>4)continue;if(app.player.isOfficialGeneral(t))continue}else if(1==this.m_numNowIndex){if(a.level<=1)continue}else{if(a.star<=5)continue;if(app.player.isOfficialGeneral(t))continue}++this.m_numMax,0!=this.campIndex&&this.campIndex!=a.camp||0!==this.professIndex&&this.professIndex!==a.occu&&this.professIndex!==a.occu2||e.push(t),e.sort(function(e,t){var a=app.player.general[e],i=app.player.general[t];if(a.star>i.star)return 1;if(a.star==i.star){if(a.level>i.level)return 1;if(a.level==i.level){if(a.camp>i.camp)return 1;if(a.camp==i.camp&&a.gsid>i.gsid)return 1}}return-1})}return e},setArrGeneral:function(e,t){var a=this.m_arrPickedGeneral,i=a.indexOf(e),n=a.length;i<0&&n<10&&t&&a.push(e),i>=0&&!t&&a.splice(i,1)},onClickBtnPick:function(){this.m_arrPickedGeneral=[],this.m_arrPickedId=[],this.m_arrRelivePicked=[];for(var e=0,t=0;e<10&&t<this.m_arrShowData.length;++t){var a=this.m_arrShowData[t];a&&(app.player.checkIsInLimitTeam(a)||app.player.isSoulGeneral(a)||app.player.isRetinueGeneral(a)||app.player.isOfficialGeneral(a)||(e++,this.m_arrPickedGeneral.push(a),this.m_arrPickedId.push(a),this.m_arrRelivePicked.push(a)))}this.refreshView(),this.refreshNumPick(),this.refreshPickView()},onClickBtnDeComp:function(){var e=this;this.m_arrPickedGeneral.length<=0?app.showNotice(langMgr.getString("generalRelivePage",1)):app.player.sfGeneralsDeComp(this.m_arrPickedGeneral,0,function(t,a){if(t)app.showNotice(t);else{var i={title:"\u6b66\u5c06\u5206\u89e3",content:langMgr.getString("generalRelivePage",11),props:a,confirmname:"\u5206\u89e3",confirmcb:e.confirmComp,target:e};app.pages.windowspagepreview.showPage(i)}})},confirmComp:function(){for(var e=0,t=0,a=0;a<this.m_arrPickedGeneral.length;++a){var i=app.player.general[this.m_arrPickedGeneral[a]];i.level>=30&&(t+=1),i.star>=4&&(e+=1)}if(e>0||t>0){var n={content:langMgr.getString("generalRelivePage",6,[e,t]),confirmcb:this.deCompCb,target:this};app.pages.windowspagetipsmsg.showPage(n)}else this.deCompCb()},deCompCb:function(){var e=this;app.player.sfGeneralsDeComp(this.m_arrPickedGeneral,1,function(t,a){if(t)app.showNotice(t);else{var i={showtype:1,reward:a,confirmcb:function(){app.player.sfPlayerByParam(["others","props","books"],function(){e.refreshUI(0),e.refreshCoinUI()})},target:e};app.pages.windowspagereward.showPage(i)}})},onClickReset:function(){var e=this;if(this.m_strPickedResetId)if(app.player.getCount(38005)<20)app.showNotice(langMgr.getString("generalRelivePage",3));else{var t=this.m_strPickedResetId,a={content:app.player.isOfficialGeneral(t)?langMgr.getString("generalRelivePage",10):langMgr.getString("generalRelivePage",7),confirmcb:function(){app.player.sfGeneralResetConfirm(t,function(a,i){var n=app.player.general[t];i.splice(0,0,{GSID:n.gsid,COUNT:1});var r={showtype:1,reward:i,target:e};app.pages.windowspagereward.showPage(r),app.player.sfPlayerByParam(["battlearr","props","books","others"],function(){if(app.player.isOfficialGeneral(t))app.player.refreshMostGeneral();else if(app.player.hasBeenSoulBind(t)){var a=app.db.getNeedRefreshGeneralArray(t);a.length>0&&app.player.sfQueryGeneralListInfo(a)}cc.isValid(e)&&(e.m_strPickedResetId=null,e.refreshUI(1),e.refreshCoinUI())})})},target:this};app.pages.windowspagetipsmsg.showPage(a)}else app.showNotice(langMgr.getString("generalRelivePage",2))},handlePreviewData:function(e){var t=e.filter(function(e){return"general"===app.db.getTypeByGsid(e.GSID)||void 0!==e.STAR}).sort(function(e,t){var a=e.STAR||app.db.getGBaseByGsid(e.GSID).STAR||0;return(t.STAR||app.db.getGBaseByGsid(t.GSID).STAR||0)-a}),a=[38006,30001,30015,30026],i=e.filter(function(e){return a.includes(e.GSID)}).sort(function(e,t){return a.indexOf(e.GSID)-a.indexOf(t.GSID)}),n=e.filter(function(e){return"equip"===app.db.getTypeByGsid(e.GSID)}).sort(function(e,t){return(app.db.getEBaseByGsid(e.GSID).POS||1)-(app.db.getEBaseByGsid(t.GSID).POS||1)}),r=e.filter(function(e){return"treas"===app.db.getTypeByGsid(e.GSID||e.gsid)}),o=e.filter(function(e){return"book"===app.db.getTypeByGsid(e.GSID||e.gsid)});return[].concat([].concat(t,i,n,r,o))},onClickPickedReset:function(){this.m_strPickedResetId=null,this.refreshUI(1)},onClickPickedReborn:function(){this.m_strPickedRebornId=null,this.refreshUI(2)},onClickReborn:function(){var e=this;if(this.m_strPickedRebornId)if(app.player.gnum+this.m_numGetGeneral>app.player.bagspace){var t={content:langMgr.getString("generalRelivePage",8),confirmcb:function(){e.m_menu.setMenuIndex(0)},target:this};app.pages.windowspagetipsmsg.showPage(t)}else if(app.player.getCount(this.m_rebornCost.GSID)<this.m_rebornCost.COUNT)app.showNotice(langMgr.getString("generalRelivePage",5));else{var a={content:langMgr.getString("generalRelivePage",9),confirmcb:function(){app.player.sfGeneralRebornConfirm(e.m_strPickedRebornId,function(t,a){t?app.showNotice(t):app.player.sfPlayerData(function(){var t={showtype:1,reward:e.setReviewData(a)};app.pages.windowspagereward.showPage(t),e.refreshUI(2),e.refreshCoinUI()})})},target:this};app.pages.windowspagetipsmsg.showPage(a)}else app.showNotice(langMgr.getString("generalRelivePage",4))},refreshCoinUI:function(){this.m_arrCoin=a[this.m_numNowIndex].coin,this.node.getComponent("currency").refreshCoin(this.m_arrCoin)},onDestroy:function(){this._super(),window.eventMgr.targetOff(this)}});cc._RF.pop()},{basePage:void 0}],generalResetPage:[function(e,t){"use strict";cc._RF.push(t,"33de9s8On9K9bFelpolTdPB","generalResetPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"generalresetpage"},properties:{p_nodeGenreal:cc.Node,p_sprCoin:cc.Sprite,p_labNumCoin:cc.Label,p_btnReset:cc.Button,p_sprCost:cc.Sprite,p_labCost:cc.Label,p_labNum:cc.Label,p_tabvGeneral:cc.tableView},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(),this.handleUI()},handleUI:function(){var e=this;this._super(),this.p_btnReset.node.on("click",function(){app.playSound("click"),e.onClickRest()})},setParam:function(e){cc.log("now general reset info is",e),this.m_strCostGsid=e.gsid,this.m_funCb=e.closecb,this.m_objCostInfo=app.db.dbGeneralReset[e.gsid],this.refreshData(),this.refreshUI()},refreshData:function(){this.m_arrShowData=this.setData()},refreshUI:function(){var e=app.db.getPropsIconPath(this.m_strCostGsid);app.loadTexture(e,this.p_sprCoin,this.prefabPath),this.p_labNumCoin.string=app.player.getCount(this.m_strCostGsid),this.refreshPick(),this.refreshBtn(),this.refreshView()},refreshView:function(){this.m_arrPickedId=[];var e=this.m_arrShowData.length;this.p_tabvGeneral.initTableView(e,{array:this.m_arrShowData,maxpick:1,initfun:"initForGCompList",iscomp:!0,target:this}),this.p_labNum.string=e},itemClick:function(e,t){return this.m_chooseItem&&(cc.log("handle choose item"),this.m_chooseItem.selected(!1,this.m_strPickGuid)),e==this.m_strPickGuid?(this.m_chooseItem=null,this.m_strPickGuid=null):(this.m_chooseItem=t,this.m_strPickGuid=e),this.refreshPick(this.m_strPickGuid),this.refreshBtn(this.m_strPickGuid),!!this.m_strPickGuid},refreshPick:function(e){e?(this.p_nodeGenreal.getComponent("generalPortraitItem").initForBag(this.m_strPickGuid),this.p_nodeGenreal.active=!0):this.p_nodeGenreal.active=!1},refreshBtn:function(e){var t=app.db.getPropsIconPath(this.m_strCostGsid);if(app.loadTexture(t,this.p_sprCost,this.prefabPath),e){var a=app.player.general[e].star;this.p_labCost.string=this.m_objCostInfo[a]}else this.p_labCost.string=0},onClickPicked:function(){},onClickRest:function(){var e=this;if(this.p_nodeGenreal.active){var t=app.player.general[this.m_strPickGuid].star,a=this.m_objCostInfo[t];app.player.checkCount(this.m_strCostGsid,a)&&app.player.sfGeneralRebornPreview(this.m_strPickGuid,function(t,a){if(t)app.showNotice(t);else{var i={title:langMgr.getString("generalResetPage",2),content:langMgr.getString("generalResetPage",3),props:e.setReviewData(a),confirmname:langMgr.getString("generalResetPage",4),confirmcb:e.confirmRest,target:e};app.pages.windowspagepreview.showPage(i)}})}else app.showNotice(langMgr.getString("generalResetPage",0))},confirmRest:function(){var e=this;if(app.player.gnum+this.m_numGetGeneral>app.player.bagspace){var t={content:langMgr.getString("generalResetPage",1),confirmcb:function(){app.goToPage(1018)},target:this};app.pages.windowspagetipsmsg.showPage(t)}else app.player.sfGeneralRebornConfirm(this.m_strPickGuid,function(t,a){t?app.showNotice(t):app.player.sfPlayerData(function(){var t={showtype:1,reward:e.setConfirmData(a.items)};app.pages.windowspagereward.showPage(t),e.refreshData(),e.refreshUI()})})},setData:function(){var e=[],t=[];for(var a in app.player.general){var i=app.player.general[a],n=!1;for(var r in this.m_objCostInfo)if(i.star==r){n=!0;break}n&&(app.player.checkIsInLimitTeam(a)?t.push(a):e.push(a))}e.sort(function(e,t){var a=app.player.general[e],i=app.player.general[t];if(a.star<i.star)return 1;if(a.star==i.star){if(a.level<i.level)return 1;if(a.level==i.level&&a.gsid>i.gsid)return 1}return-1});for(var o=0;o<t.length;++o)e.push(t[o]);return e},setReviewData:function(e){var t=[],a=0;if(e.items)for(var i=0;i<e.items.length;++i)t.push(e.items[i]);if(e.general)for(var n=0;n<e.general.length;++n){var r={};for(var o in e.general[n])r[o.toUpperCase()]=e.general[n][o];a+=r.COUNT,t.push(r)}return this.m_numGetGeneral=a,t},setConfirmData:function(e){for(var t=[],a={},i=[],n=0;n<e.length;++n){var r=e[n].gsid||e[n].GSID;"general"==app.db.getTypeByGsid(r)?(a[r]||(a[r]=0),++a[r]):t.push(e[n])}for(var o in a)i.push({gsid:o,count:a[o]});i.sort(function(e,t){var a=e.gsid||e.GSID,i=t.gsid||t.GSID,n=app.db.getGBaseByGsid(a),r=app.db.getGBaseByGsid(i);return n.STAR<r.STAR?1:n.STAR==r.STAR&&a>i?1:-1});for(var s=0;s<i.length;++s)t.push(i[s]);return cc.log(t),t},onClose:function(){this._super(),app.pages.propbagpage.instance&&cc.isValid(app.pages.propbagpage.instance.node)&&app.pages.propbagpage.instance.node.active&&(app.pages.propbagpage.instance.setData(),app.pages.propbagpage.instance.refreshView(0))}});cc._RF.pop()},{basePage:void 0}],generalShowPage:[function(e,t){"use strict";cc._RF.push(t,"465e55KbYBL6YdVPOCphiHq","generalShowPage");var a=["hp","atk","def","mdef"],i=cc.Enum({Expedition:1,GeneralRank:2}),n=cc.Class({extends:e("basePage"),statics:{prefabPath:"generalshowpage"},properties:{p_sprName:cc.Sprite,p_starContainer:cc.Node,p_highStarIcon:cc.Sprite,p_sprStar:[cc.Sprite],p_nodeTrain:cc.Node,p_nodeStar:cc.Node,p_nodeWuhun:cc.Node,p_arrNodeEquip:[cc.Node],p_arrNodeEmpty:[cc.Node],p_nodeExLock:cc.Node,p_sprCamp:cc.Sprite,p_sprOccu:cc.Sprite,p_sprOccu2:cc.Sprite,p_nodePower:cc.Node,p_nodeGeneral:cc.Node,p_sprGeneral:cc.Sprite,p_spGeneral:sp.Skeleton,p_animGeneral:cc.Animation,p_nodeLeft:cc.Node,p_nodeRight:cc.Node,p_labLv:cc.Label,p_arrLabProperty:[cc.Label],p_arrNodeSkill:[cc.Node],p_btnDetail:cc.Button,p_nodeLevelNum:cc.Node,p_sprGeneralZZ:cc.Node,p_sprFZZ:cc.SpriteAtlas,p_nodeZZContent:cc.Node,p_btnLayout:cc.Node,p_nodeTip:cc.Node,p_generalQuality:cc.Node,p_skeFlashAnim:sp.Skeleton,p_skeFlameAnim:sp.Skeleton,p_spriteBg:cc.Sprite,p_spTreasAnim:[cc.Node]},onLoad:function(){n.instance=this,this.handleUI(),this.stopBgNodeEvent(),this.creatMask(!1,255,"#21140b"),this.fitTopMenu(80),this.node.getComponent("menu").init(this),this.m_interval=0},start:function(){},update:function(e){if(this.m_interval+=e,this.m_interval>.3&&!this.isPlayGSound){if(!this.m_nowPlayGsid)return;this.isPlayGSound=!0;var t=app.db.getSoundByGsid(this.m_nowPlayGsid);t&&app.playGeneralSound(t,1),this.m_nowPlayGsid=null}},handleUI:function(){var e=this;this._super(),this.p_nodeLeft.on("touchend",function(){if(!e._bLoad&&e.m_arrGeneral&&!(e.m_nIndex<=0)){var t={gsid:e.m_arrGeneral[e.m_nIndex-1]};e.refreshUI(t),e.refreshArrow(e.m_nIndex-1),cc.audioEngine.stopAllEffects(),e.m_interval=0,e.isPlayGSound=!1}}),this.p_nodeRight.on("touchend",function(){if(!e._bLoad&&e.m_arrGeneral&&!(e.m_nIndex>=e.m_arrGeneral.length-1)){var t={gsid:e.m_arrGeneral[e.m_nIndex+1]};e.refreshUI(t),e.refreshArrow(e.m_nIndex+1),cc.audioEngine.stopAllEffects(),e.m_interval=0,e.isPlayGSound=!1}}),this.p_sprCamp.node.on("touchend",function(){app.pages.windowspagetipscamp.showPage({camp:e.m_camp})}),this.p_sprOccu.node.on("touchend",function(){app.pages.windowspagetipsoccu.showPage({occu:e.m_occu1})}),this.p_sprOccu2.node.on("touchend",function(){app.pages.windowspagetipsoccu.showPage({occu:e.m_occu2})}),this.p_btnDetail.node.on("click",function(){app.pages.generalattributedetailedpage.showPage(e.m_property)}),this.p_arrNodeSkill.forEach(function(t,a){t.on("touchend",function(){e.onClickSkill(a)})})},setParam:function(e){var t=this;cc.log(e),this.m_objNowGData=e,this.m_sourceType=void 0===e.sourceType?0:e.sourceType,this.m_sourceType===i.GeneralRank&&this.p_arrNodeEquip.forEach(function(e,a){4==a?e.on("touchend",function(){t.onClickExclus()}):5==a?e.on("touchend",function(){t.onClickTreas()}):e.on("touchend",function(){t.onClickEquip(a)})}),this.refreshUI(e),this.p_nodeLeft.active=!1,this.p_nodeRight.active=!1,e.garr&&this.initArrGeneral(e)},refreshUI:function(e){var t=e.gsid;if(t){this.m_nowShowGsid=t,this.m_nowPlayGsid=t;var a=app.db.getGBaseByGsid(t);a||(a={GSID:0,NAME:"\u672a\u77e5\u6b66\u5c06",CAMP:1,STAR:1,SKILL:[],TGRADE:0}),this.refreshMain(a);var n=e.level||app.db.getGMaxLvByGsid(t,a.MAXCLASS),r=e.class||a.MAXCLASS;this.m_property=e.property||app.db.calGPropNoEquip(t,n,a.MAXCLASS);var o=e.power||app.db.getPropertyPower(this.m_property),s=e.skill||a.SKILL;this.m_objGData={gsid:t,level:n,class:r,skill:s,property:this.m_property},this.refreshInfo(this.m_objGData),this.refreshPower(o);for(var p=0;p<this.p_arrNodeEquip.length;p++)this.p_arrNodeEquip[p].active=!!e.equip;for(var c=0;c<this.p_arrNodeEmpty.length;c++)this.p_arrNodeEmpty[c].active=!!e.equip;if(this.p_nodeExLock.active=!!e.equip,e.equip&&this.refreshEquip(e),this.p_btnLayout.active=this.m_sourceType===i.GeneralRank,this.m_sourceType===i.GeneralRank){this.p_nodeTip.active=!1;var h=this.refreshMenu(e);this.m_numMenuIndex||0==this.m_numMenuIndex||(this.m_numMenuIndex=0),h[this.m_numMenuIndex]||(this.m_numMenuIndex=0),this.node.getComponent("menu").setMenuIndex(this.m_numMenuIndex)}}},setMenuIndex:function(e){null!=e&&this.node.getComponent("menu").setMenuIndex(e)},refreshMenu:function(e){var t=app.db.getAwakeIdByGsid(e.gsid),a=!!(e.star>=10)&&app.db.checkChannelShow("GENERAL_SOUL"),i=!!(t&&e.star>=6),n=!(!a&&!i);return this.node.getComponent("menu").p_arrBtnMenu[0].active=n,this.node.getComponent("menu").p_arrBtnMenu[2].active=a,[n,void 0,a]},initArrGeneral:function(e){this.m_nIndex=e.index,this.m_arrGeneral=e.garr,this.refreshArrow(this.m_nIndex)},refreshArrow:function(e){this.m_nIndex=e,this.p_nodeLeft.active=e>=1&&this.m_arrGeneral.length>=2,this.p_nodeRight.active=e<this.m_arrGeneral.length-1&&this.m_arrGeneral.length>=2},refreshMain:function(e){var t=this,a=app.db.getGNamePathHByGsid(e.GSID);if(app.loadTexture(a,this.p_sprName,this.prefabPath),gConfig.getNameGOccu(e.OCCU-1)){var i=gConfig.getIconGOccuPath(e.OCCU-1);app.loadTexture(i,this.p_sprOccu,this.prefabPath),this.p_sprOccu.node.active=!0,this.m_occu1=e.OCCU}else this.p_sprOccu.node.active=!1;if(e.OCCU2&&gConfig.getNameGOccu(e.OCCU2-1)){var n=gConfig.getIconGOccuPath(e.OCCU2-1);app.loadTexture(n,this.p_sprOccu2,this.prefabPath),this.p_sprOccu2.node.active=!0,this.m_occu2=e.OCCU2}else this.p_sprOccu2.node.active=!1;var r=gConfig.getIconGCampPath(e.CAMP-1);app.loadTexture(r,this.p_sprCamp,this.prefabPath),this.m_camp=e.CAMP;var o=e.STAR;if(this.p_starContainer.opacity=o<10?255:0,this.p_highStarIcon.node.active=o>=10?255:0,o>=10){var s=gConfig.getIconGStarPath(o-1);app.loadTexture(s,this.p_highStarIcon,this.prefabPath,function(){})}else{var p=(o-1)%5,c=gConfig.getIconGBigStarPath(e.STAR);this.p_sprStar.forEach(function(e,a){e.node.active=p>=a,app.loadTexture(c,e,t.prefabPath)})}this.p_generalQuality.parent.active=Boolean(e.TGRADE),e.TGRADE&&(this.p_generalQuality.getComponent("num").init(e.TGRADE),this.p_skeFlashAnim.node.active=e.TGRADE>6,this.p_skeFlameAnim.node.active=e.TGRADE>8),this.loadGeneralSkin(),this.loadGeneralBg()},refreshPower:function(e){this.p_nodePower.getComponent("num").init(e)},refreshInfo:function(e){this.p_nodeLevelNum.getComponent("num").init(e.level),this.p_arrLabProperty.forEach(function(t,i){var n=a[i];t.string=Math.round(e.property[n])});for(var t=0;t<4;++t){var i=e.skill[t];if(i){this.p_arrNodeSkill[t].active=!0;var n=!(i>=app.db.getUnLockSkill(e.gsid,e.class)[t]);this.p_arrNodeSkill[t].getComponent("skillItem").initForGSkill(i,n,this)}else this.p_arrNodeSkill[t].active=!1}},refreshEquip:function(e){var t=e.equip,a=e.treasure?e.treasure.gsid?e.treasure.gsid:e.treasure:null,n=e.exclusive;this.m_objEquipData={};for(var r=0;r<t.length;++r){var o=t[r];if(o){var s=app.db.getEBaseByGsid(o);this.m_objEquipData[s.POS]=o}}for(var p=0;p<4;++p){var c=p+1;this.m_objEquipData[c]?(this.p_arrNodeEquip[p].getComponent("propItem").initForGEquip(this.m_objEquipData[c]),this.p_arrNodeEquip[p].active=!0):this.p_arrNodeEquip[p].active=!1}var h=e.level<40&&0==n.level&&this.m_sourceType!==i.GeneralRank,l=n.level>0&&e.level>=40;this.p_nodeExLock.active=h,this.p_arrNodeEquip[4].active=l,this.p_arrNodeEquip[4].getComponent("propItem").initForGExclus(n.gsid,n.level,h,!l),a?(this.p_arrNodeEquip[5].getComponent("propItem").initForGEquip(a),this.p_arrNodeEquip[5].active=!0,e.treasure.guid?this.p_spTreasAnim.forEach(function(e){e.active=!0}):this.p_spTreasAnim.forEach(function(e){e.active=!1})):this.p_arrNodeEquip[5].active=!1},onClickSkill:function(e){var t=this.p_arrNodeSkill[e],a=app.db.getGBaseByGsid(this.m_objGData.gsid);if(a){var i=a.SKILL[e];if(i){for(var n=t.getComponent("skillItem").isLock(),r=this.m_objNowGData,o=r.exclusive_equip?r.exclusive_equip:0,s=app.db.getExclusiveSkillLockLv(r.occu),p=[],c=0;c<s.length;++c)o>=s[c]&&p.push(c);p.includes(e)&&i++;var h={type:"general",gsid:i,index:e,lock:n};app.pages.windowspagetipsskill.showPage(h)}}},onClose:function(){this._super(),audioMsg.stopAllEffects(),this.isPlayGSound=!1,eventMgr.emit(eventStr.windowspagegotopub.refreshflag),GodGuide.checkGuideProgress("showZZYZ_END")&&app.runGuide()},onDestroy:function(){this._super(),this._compound&&cc.loader.release("game_prefabs_page/"+this.p_prefabsCompound.name),this._info&&cc.loader.release("game_prefabs_page/"+this.p_prefabsInfo.name)},menuHandler:function(e){switch(cc.isValid(this.p_nodeTrain)&&(this.p_nodeTrain.active=0==e),cc.isValid(this.p_nodeStar)&&(this.p_nodeStar.active=1==e),cc.isValid(this.p_nodeWuhun)&&(this.p_nodeWuhun.active=2==e),this.m_numMenuIndex=e,e){case 2:this.p_nodeWuhun.getComponent("generalPageWuhun").refreshUI(this.m_objNowGData,this.m_sourceType===i.GeneralRank,this)}return!0},onClickEquip:function(e){var t=e+1,a=this.m_objEquipData[t];if(a){var i={};i.gsid=a,i.type=0,i.general=this.m_objNowGData.guid,i.equipPos=e,i.gdata=this.m_objNowGData,app.pages.windowspagetipsequip.showPage(i)}},onClickTreas:function(){var e=this.m_objNowGData.treasure?this.m_objNowGData.treasure.guid?this.m_objNowGData.treasure.gsid:this.m_objNowGData.treasure:null;if(e){var t={};t.gsid=e,t.type=0,t.general=this.m_objNowGData.guid,t.treasure=this.m_objNowGData.treasure,t.isHideBtn=app.player.isSoulGeneral(this.curShowGuid),t.upcb=function(e){e&&app.pages.generalpage.instance.refreshInfo(e)},app.pages.windowspagetipstreas.showPage(t)}},onClickExclus:function(){if(this.m_objNowGData.exclusive.level){var e={data:this.m_objNowGData.exclusive,general:this.m_objNowGData.guid,isHideBtn:!0};app.pages.windowspagetipsexclus.showPage(e)}},loadGeneralBg:function(){var e=this.m_nowShowGsid,t=this.m_objNowGData.garr?app.db.getGBaseByGsid(e):this.m_objNowGData;if(t){var a=t.skin?t.skin:app.db.getLowestGsid(e),i=app.db.getGBaseByGsid(e);if(app.db.isDefaultSkin(e,a))app.loadTexture(app.db.getGeneralBgByCamp(i.CAMP),this.p_spriteBg,this.prefabPath);else{if(!app.db.getGeneralSkinList(e)[a])return;var n=app.db.getSkinThemeBySkinId(e,a);n&&app.loadTexture(n,this.p_spriteBg,this.prefabPath)}}},loadGeneralSkin:function(){var e=this,t=this.m_objNowGData.garr?app.db.getGBaseByGsid(this.m_nowShowGsid):this.m_objNowGData;if(t){var a=t.skin?t.skin:app.db.getLowestGsid(this.m_nowShowGsid);this._bLoad=!0,app.loadGeneral(this.m_nowShowGsid,this.p_sprGeneral,this.p_spGeneral,this.p_animGeneral,function(){cc.isValid(e)&&(e._bLoad=!1)},this.prefabPath,a)}}});cc._RF.pop()},{basePage:void 0}],generalSoulBindingPage:[function(e,t){"use strict";cc._RF.push(t,"6951cnCli9PHJg+U7niAydX","generalSoulBindingPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"generalSoulBindingPage",checkComp:function(e){for(var t=!0,a=0;a<e.length;++a){if(!e[a]){t=!1;break}var i=e[a].need;if(e[a].picked.length<i){t=!1;break}}return t}},properties:{p_sprName:cc.Sprite,p_sprStar:[cc.Sprite],p_sprCamp:cc.Sprite,p_sprOccu:cc.Sprite,p_sprOccu2:cc.Sprite,p_nodeGeneral:cc.Node,p_sprGeneral:cc.Sprite,p_spGeneral:sp.Skeleton,p_animGeneral:cc.Animation,p_sprNameR:cc.Sprite,p_sprStarR:[cc.Sprite],p_sprCampR:cc.Sprite,p_sprOccuR:cc.Sprite,p_sprOccu2R:cc.Sprite,p_nodeGeneralR:cc.Node,p_sprGeneralR:cc.Sprite,p_spGeneralR:sp.Skeleton,p_animGeneralR:cc.Animation,p_btnHelp:cc.Button,p_campMenu:cc.Node,p_tabvGeneral:cc.Node,leftGeneralPortrait:cc.Node,rightGeneralPortrait:cc.Node,btnEstablish:cc.Node,btnRelieve:cc.Node,relieveCost:cc.Label,rightPanel:cc.Node,ropeNode:cc.Node},onLoad:function(){a.instance=this,this.handleUI(),this.stopBgNodeEvent(),this.fitTopMenu(),this.creatMask(),this.bindingState=!1,this.p_campMenu.getComponent("GeneralMenuSelector").onCampClick(this.campMenuHandler,this),this.p_campMenu.getComponent("GeneralMenuSelector").onProfessionClick(this.professMenuHandler,this)},start:function(){},handleUI:function(){var e=this;this._super(),this.p_sprCamp.node.on("touchend",function(){void 0!==e.m_camp&&app.pages.windowspagetipscamp.showPage({camp:e.m_camp})}),this.p_sprOccu.node.on("touchend",function(){void 0!==e.m_occu1&&app.pages.windowspagetipsoccu.showPage({occu:e.m_occu1})}),this.p_sprOccu2.node.on("touchend",function(){void 0!==e.m_occu2&&app.pages.windowspagetipsoccu.showPage({occu:e.m_occu2})}),this.p_sprCampR.node.on("touchend",function(){void 0!==e.m_campR&&app.pages.windowspagetipscamp.showPage({camp:e.m_campR})}),this.p_sprOccuR.node.on("touchend",function(){void 0!==e.m_occu1R&&app.pages.windowspagetipsoccu.showPage({occu:e.m_occu1R})}),this.p_sprOccu2R.node.on("touchend",function(){void 0!==e.m_occu2R&&app.pages.windowspagetipsoccu.showPage({occu:e.m_occu2R})}),this.p_btnHelp.node.on("click",function(){app.pages.windowspagetipshelp.showPage("1066")}),this.btnEstablish.on("click",function(){if(!e.isPastDue()){app.playSound("click");var t=e.m_selectGuid,a=e.leftHeroGuid;t&&app.player.sfGeneralSoulBindPreview({guid:a,bind:t},function(t){cc.log("=== preview success ===",t),app.pages.windowsPageSoulBindingInfo.showPage({beforeInfo:app.player.general[a],afterInfo:t.general,bindInfo:{guid:e.leftHeroGuid,bind:e.m_selectGuid}})})}},this),this.btnRelieve.on("click",function(){if(!e.isPastDue()){if(app.playSound("click"),app.player.getCount(38005)<100)return app.showNotice(langMgr.getString("generalSoulBindingPage",0));app.pages.windowsPageRelieveSoulBinding.showPage({bindGuid:e.leftHeroGuid})}},this),cc.director.on("EVT_REFRESH_BIND_UI",function(){e.refreshUI()},this)},isPastDue:function(){var e=window.app.player.getServerTime();try{if(e>(app.player.general[this.leftHeroGuid].expireAt?app.player.general[this.leftHeroGuid].expireAt:0))return window.app.showNotice(langMgr.getString("generalSoulBindingPage",1)),this.onClose(),!0}catch(t){return cc.error("\u7075\u9b42\u6b66\u5c06\u83b7\u53d6\u8fc7\u671f\u65f6\u95f4\u9519\u8bef"),window.app.showNotice(langMgr.getString("generalSoulBindingPage",1)),this.onClose(),!0}return!1},setParam:function(e){this.leftHeroGuid=e.guid,this.refreshUI(),this.m_campIndex=0,this.m_professIndex=0,this.p_campMenu.getComponent("GeneralMenuSelector").initMenu(this.m_campIndex,this.m_professIndex),this.m_arrShowData=this.setData(),this.refreshView()},refreshUI:function(){var e=this;if(this.bindingState=this.getBindState(),this.btnEstablish.active=!this.bindingState,this.btnRelieve.active=this.bindingState,this.ropeNode.active=this.bindingState,this.refreshMain(this.leftHeroGuid),this.bindingState){var t=app.player.general[this.leftHeroGuid];if(!t)return cc.error("=== leftGeneralGuid ERROR ===");var a=t.inherit.guid;this.m_selectGuid=a,this.refreshRightGeneral(a),this.p_tabvGeneral.getComponent("tableView").initTableView(1,{array:[this.m_selectGuid],maxpick:1,initfun:"initForSoulBinding",target:this,selectitem:"m_chooseItem",shieldClicked:!0},function(){e.p_tabvGeneral.getComponent("tableView").getCells(function(e){var t=e[0];cc.isValid(t)&&t.getComponent("generalTabvItem").soulSelected(!0)})})}else this.m_selectGuid=null,this.m_arrShowData=this.setData(this.m_campIndex||0),this.m_arrPickedId=[],this.m_strNowCompGsid="",this.refreshRightGeneral(this.m_selectGuid),this.p_tabvGeneral.getComponent("tableView").initTableView(this.m_arrShowData.length,{array:this.m_arrShowData,maxpick:1,initfun:"initForSoulBinding",target:this,selectitem:"m_chooseItem",shieldClicked:!0})},getBindState:function(){var e=app.player.general[this.leftHeroGuid];return!!e&&!!e.inherit&&Boolean(e.inherit.guid)},refreshMain:function(e){var t=this,a=app.player.general[e];if(a){var i=a.gsid;if(i){var n=app.db.getGBaseByGsid(i);n||(n={GSID:0,NAME:"\u672a\u77e5\u6b66\u5c06",CAMP:1,STAR:1});var r=app.db.getGNamePathHByGsid(i);if(app.loadTexture(r,this.p_sprName,this.prefabPath),gConfig.getNameGOccu(n.OCCU-1)){var o=gConfig.getIconGOccuPath(n.OCCU-1);app.loadTexture(o,this.p_sprOccu,this.prefabPath),this.p_sprOccu.node.active=!0,this.m_occu1=n.OCCU}else this.p_sprOccu.node.active=!1;if(n.OCCU2&&gConfig.getNameGOccu(n.OCCU2-1)){var s=gConfig.getIconGOccuPath(n.OCCU2-1);app.loadTexture(s,this.p_sprOccu2,this.prefabPath),this.p_sprOccu2.node.active=!0,this.m_occu2=n.OCCU2}else this.p_sprOccu2.node.active=!1;var p=gConfig.getIconGCampPath(n.CAMP-1);app.loadTexture(p,this.p_sprCamp,this.prefabPath),this.m_camp=n.CAMP;var c=n.STAR,h=(c-1)%5;c>=10&&(h=0);var l=gConfig.getIconGBigStarPath(n.STAR);this.p_sprStar.forEach(function(e,t){e.node.active=h>=t,app.loadTexture(l,e)}),this._bLoad=!0,app.loadGeneral(n.GSID,this.p_sprGeneral,this.p_spGeneral,this.p_animGeneral,function(){t._bLoad=!1},this.prefabPath),this.leftGeneralPortrait.getComponent("generalPortraitItem").initForTips({gsid:i,level:""+(app.player.general[e].level||1)})}}},refreshRightGeneral:function(e){var t=this;if(this.rightPanel.active=this.rightGeneralPortrait.active=this.p_sprGeneralR.node.active=this.p_spGeneralR.node.active=this.p_animGeneralR.node.active=Boolean(e),e){var a=app.player.general[e];if(a){var i=a.gsid,n=app.db.getGBaseByGsid(i);n||(n={GSID:0,NAME:"\u672a\u77e5\u6b66\u5c06",CAMP:1,STAR:1});var r=app.db.getGNamePathHByGsid(i);if(app.loadTexture(r,this.p_sprNameR,this.prefabPath),gConfig.getNameGOccu(n.OCCU-1)){var o=gConfig.getIconGOccuPath(n.OCCU-1);app.loadTexture(o,this.p_sprOccuR,this.prefabPath),this.p_sprOccuR.node.active=!0,this.m_occu1R=n.OCCU}else this.p_sprOccuR.node.active=!1;if(n.OCCU2&&gConfig.getNameGOccu(n.OCCU2-1)){var s=gConfig.getIconGOccuPath(n.OCCU2-1);app.loadTexture(s,this.p_sprOccu2R,this.prefabPath),this.p_sprOccu2R.node.active=!0,this.m_occu2R=n.OCCU2}else this.p_sprOccu2R.node.active=!1;var p=gConfig.getIconGCampPath(n.CAMP-1);app.loadTexture(p,this.p_sprCampR,this.prefabPath),this.m_campR=n.CAMP;var c=n.STAR,h=(c-1)%5;c>=10&&(h=0);var l=gConfig.getIconGBigStarPath(n.STAR);this.p_sprStarR.forEach(function(e,a){e.node.active=h>=a,app.loadTexture(l,e,t.prefabPath)}),this._bLoadR=!0,app.loadGeneral(n.GSID,this.p_sprGeneralR,this.p_spGeneralR,this.p_animGeneralR,function(){t._bLoadR=!1},this.prefabPath),this.rightGeneralPortrait.getComponent("generalPortraitItem").initForTips({gsid:n.GSID,level:""+(app.player.general[e].level||1)})}}},refreshComp:function(){},refreshView:function(){this.m_strNowCompGsid=null,this.m_chooseItem=null;var e=this.m_arrShowData.length;this.p_tabvGeneral.getComponent("tableView").initTableView(e,{array:this.m_arrShowData,maxpick:1,initfun:"initForSoulBinding",target:this,selectitem:"m_chooseItem",shieldClicked:!0})},setData:function(){var e=[];for(var t in app.player.general){var a=app.player.general[t];a&&(0!==this.m_campIndex&&this.m_campIndex!==a.camp||0!==this.m_professIndex&&this.m_professIndex!==a.occu&&this.m_professIndex!==a.occu2||e.push(t))}e.sort(function(e,t){var a=app.player.general[e],i=app.player.general[t];if(a.star<i.star)return 1;if(a.star==i.star){if(a.level<i.level)return 1;if(a.level==i.level&&a.gsid>i.gsid)return 1}return-1});var i=e.indexOf(this.leftHeroGuid);return i>-1&&e.splice(i,1),e.filter(function(e){var t=app.player.isSoulGeneral(e),a=app.player.isTimeLimitGeneral(e),i=app.player.isRetinueGeneral(e);return!(t||a||i)})},setCondGData:function(){},itemClick:function(e,t){if(!this.bindingState){var a=app.player.general[e].gsid;return e==this.m_strNowCompGsid||(e!=this.m_selectGsid&&(this.m_selectGsid=null,this.m_selectGuid=null),this.m_chooseItem&&(cc.log("handle choose item"),this.m_chooseItem.soulSelected(!1,this.m_strNowCompGsid)),this.m_chooseItem=t,this.m_strNowCompGsid=e,this.m_selectGuid=e,this.refreshRightGeneral(e),this.m_arrCondGData=this.setCondGData(a),this.refreshComp(),!0)}},refreshUpMain:function(e){var t=app.player.general[e];if(t){var a=t.gsid;this.refreshRightGeneral(e),this.m_arrCondGData=this.setCondGData(a),this.refreshComp()}},onClickCond:function(e){var t={};t.index=e,t.arrcond=this.m_arrCondGData,t.cb=this.refreshComp,t.target=this,t.noplus=!0,app.pages.windowspagelistgeneral.showPage(t)},onClickComp:function(){},campMenuHandler:function(e){if(!this.bindingState)return cc.log("campMenuHandler",e),this.p_tabvGeneral.getComponent("tableView")._isInitTabv?(cc.log("now init tabv no end"),!1):(this.m_campIndex=e,this.m_arrShowData=this.setData(),this.p_tabvGeneral.getComponent("tableView")._isInitTabv=!0,this.refreshView(),!0)},professMenuHandler:function(e){if(!this.bindingState)return cc.log("professMenuHandler",e),this.p_tabvGeneral.getComponent("tableView")._isInitTabv?(cc.log("now init tabv no end"),!1):(this.m_professIndex=e,this.m_arrShowData=this.setData(),this.p_tabvGeneral.getComponent("tableView")._isInitTabv=!0,this.refreshView(),!0)},refreshCampMenuRed:function(e){return this.m_arrRed[e]>0},showGeneralEffAnim:function(){},onClose:function(){this._super(),window.eventMgr.emit(eventStr.soulBinding.ExitBinding)},scrollToPick:function(e){var t=this.m_arrShowData.indexOf(e);if(!(t<0)){var a=this.p_tabvGeneral.getComponent("tableView"),i=a.getScrollOffset().y,n=a.cell.data.height,r=a._groupCellCount,o=Math.floor(t/r),s=0!=o?a.top:0,p=(n+a.spacingY)*o+s;p>i&&a.scrollToOffset(cc.v2(0,p),0)}},onDestroy:function(){this._super(),cc.director.targetOff(this);try{var e=app.pages.generalbaghandbookpage.instance;if(!cc.isValid(e)||!e.node.active)return;var t=e.m_numShowCampIndex;e.m_arrGeneralBagShowData=e.setGeneralBagViewData(t),e.reloadGeneralBagView(),e.refreshMenu()}catch(a){cc.warn("error info: ",a)}}});cc._RF.pop()},{basePage:void 0}],generalSpecialEquicPage:[function(e,t){"use strict";cc._RF.push(t,"e493bOdPIdKfbAuVnfxT/hL","generalSpecialEquicPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"generalspecialequicpage"},properties:{p_nodeNowEx:cc.Node,p_labNowName:cc.Label,p_nodeNextEx:cc.Node,p_labNextName:cc.Label,p_nodeArrow:cc.Node,p_arrLabPropL:[cc.Label],p_arrLabPropR:[cc.Label],p_nodePropQ:cc.Node,p_nodeLockP:cc.Node,p_arrNodeSkillL:[cc.Node],p_arrNodeSkillR:[cc.Node],p_nodeSkillQ:cc.Node,p_nodeArrowS:cc.Node,p_nodeLockS:cc.Node,p_nodeNoSkill:cc.Node,p_nodeCostUp:cc.Node,p_labCostUp:cc.Label,p_arrNodeCostUp:[cc.Node],p_nodeCostLock:[cc.Node],p_arrNodeCostLock:[cc.Node],p_nodeLockUp:cc.Node,p_btnUp:cc.Button,p_btnReset:cc.Button,p_btnCancel:cc.Button,p_btnConfirm:cc.Button},onLoad:function(){a.instance=this,this.handleUI(),this.stopBgNodeEvent(),this.creatMask(!0)},handleUI:function(){var e=this;this.p_btnUp.node.on("click",function(){app.playSound("click"),e.onClickBtnUp()}),this.p_btnReset.node.on("click",function(){app.playSound("click"),e.onClickBtnReset()}),this.p_nodeLockP.on("touchend",function(){e.onClickBtnLock(1)}),this.p_nodeLockS.on("touchend",function(){e.onClickBtnLock(2)}),this.p_nodeLockUp.on("touchend",function(){e.onClickBtnLock(3)}),this.p_btnConfirm.node.on("click",function(){app.playSound("click"),e.onClickBtnConfirm(1)}),this.p_btnCancel.node.on("click",function(){app.playSound("click"),e.onClickBtnConfirm(0)}),this.p_arrNodeSkillL.forEach(function(t,a){t.on("touchend",function(){e.onClickSkill(a,"left")})}),this.p_arrNodeSkillR.forEach(function(t,a){t.on("touchend",function(){e.onClickSkill(a,"right")})})},setParam:function(e){var t=this;this.m_strType=e.type||"level",this.m_strGuid=e.general,this.m_objData=e.data,this.m_funCb=e.cb,this.m_target=e.target,this.m_lockIndex="level"==this.m_strType?0:1,this.p_nodeCostLock.forEach(function(e,a){e.active=a==t.m_lockIndex}),this.getNextData()},getNextData:function(){var e=this;this.m_arrNextProperty=[],this.m_arrNextSkill=[],"level"==this.m_strType?this.refreshUI():app.player.sfExcluPreviewGet(this.m_strGuid,function(t){t&&(e.m_arrNextProperty=t.property||[],e.m_arrNextSkill=t.skill||[],e.m_strType="confirm"),e.refreshUI()})},refreshUI:function(){var e=this.m_objData.gsid,t=this.m_objData.level,a=app.db.getExclusiveById(e,t),i=app.db.getExclusiveById(e,t+1);switch(this.m_strType){case"level":this.p_nodeNextEx.active=!0,this.p_labNextName.node.active=!0,this.p_nodeArrow.active=!0,this.p_nodeLockP.active=!1,this.p_nodeLockS.active=!1,this.p_nodeLockUp.active=!0,this.p_btnReset.node.active=!1,this.p_btnUp.node.active=!0,this.p_btnCancel.node.active=!1,this.p_btnConfirm.node.active=!1;break;case"reset":this.p_nodeNextEx.active=!1,this.p_labNextName.node.active=!1,this.p_nodeArrow.active=!1,this.p_nodeLockP.active=!0,this.p_nodeLockS.active=!0,this.p_nodeLockUp.active=!1,this.p_btnReset.node.active=!0,this.p_btnUp.node.active=!1,this.p_btnCancel.node.active=!1,this.p_btnConfirm.node.active=!1;break;case"confirm":this.p_nodeNextEx.active=!1,this.p_labNextName.node.active=!1,this.p_nodeArrow.active=!1,this.p_nodeLockP.active=!1,this.p_nodeLockS.active=!1,this.p_nodeLockUp.active=!1,this.p_btnReset.node.active=!1,this.p_btnUp.node.active=!1,this.p_btnCancel.node.active=!0,this.p_btnConfirm.node.active=!0}this.p_nodeNowEx.getComponent("propItem").initForGExclus(e,t),this.p_labNowName.string=a.NAME,this.p_nodeNextEx.active&&(this.p_nodeNextEx.getComponent("propItem").initForGExclus(e,t+1),this.p_labNextName.string=i.NAME),this.refreshProp(),this.refreshSkill(),this.onClickBtnLock(0),this.refreshCost()},refreshProp:function(){var e=this;this.p_arrLabPropL.forEach(function(t,a){if(e.m_objData.property[a]){var i=e.m_objData.property[a],n=app.db.getPropertyCnByEn(i.key),r=i.val,o=app.db.getPropertyIdByEn(i.key);o&&2==app.db.dbProperty[o].NUMTYPE&&(r=r/10+"%"),t.string=n+"\uff1a"+r,t.node.active=!0}else t.node.active=!1});var t=this.m_arrNextProperty;"reset"==this.m_strType&&this.m_boolLockP&&(t=this.m_objData.property),this.m_boolLockUp&&(t=this.m_objData.property),this.p_arrLabPropR.forEach(function(a,i){if(t[i]){var n=t[i],r=app.db.getPropertyCnByEn(n.key),o=n.val,s=app.db.getPropertyIdByEn(n.key);s&&2==app.db.dbProperty[s].NUMTYPE&&(o=o/10+"%"),e.m_boolLockUp&&(o="?"),a.string=r+"\uff1a"+o,a.node.active=!0}else a.node.active=!1}),this.p_nodePropQ.active=t.length<=0},refreshSkill:function(){var e=this;if(this.p_arrNodeSkillL.forEach(function(t,a){if(e.m_objData.skill[a]){t.active=!0;var i=e.m_objData.skill[a],n=app.db.getSkillInfoByGsid(i);t.getComponent("skillItem").initForGSkill(i,!1,e),t.getComponent("skillItem").p_labName.node.active=!0,t.getComponent("skillItem").p_labName.string=n.NAME}else t.active=!1}),"reset"==this.m_strType&&this.m_boolLockS)for(var t=0;t<this.m_objData.skill.length;++t)this.m_arrNextSkill[t]=this.m_objData.skill[t];else"reset"!=this.m_strType||this.m_boolLockS||(this.m_arrNextSkill=[]);var a=this.m_arrNextSkill;this.p_arrNodeSkillR.forEach(function(t,i){if(cc.log("now right skill info: ",a[i],i),a[i]){t.active=!0;var n=a[i],r=app.db.getSkillInfoByGsid(n);t.getComponent("skillItem").initForGSkill(n,!1,e),t.getComponent("skillItem").p_labName.node.active=!0,t.getComponent("skillItem").p_labName.string=r.NAME}else t.active=!1}),this.m_objData.skill.length<=0&&a.length<=0?(this.p_nodeNoSkill.active=!0,this.p_nodeArrowS.active=!1,this.p_nodeSkillQ.active=!1,this.p_nodeLockS.active=!1):(this.p_nodeNoSkill.active=!1,this.p_nodeArrowS.active=!0,this.p_nodeSkillQ.active=a.length<=0,this.p_nodeLockS.active="reset"==this.m_strType)},refreshCost:function(){var e=this;switch(this.m_arrCostUp=[],this.m_arrCostLock=[],this.m_strType){case"level":var t=app.db.getExclusLvCost(this.m_objData.level+1);t?(this.m_arrCostUp=t.ITEMS,this.m_arrCostLock=t.LOCK||[],this.p_labCostUp.string=langMgr.getString("generalSpecialEquicPage",0),this.p_nodeCostUp.active=this.m_arrCostUp.length>0,this.p_nodeCostLock[this.m_lockIndex].active=this.m_boolLockUp&&this.m_arrCostUp.length>0):(this.p_nodeCostUp.active=!1,this.p_nodeCostLock[this.m_lockIndex].active=!1);break;case"reset":var a=app.db.getExclusResetCost(this.m_objData.level);a?(this.m_arrCostUp=a.ITEMS||[],this.m_boolLockP&&(this.m_arrCostLock=a.ATTR||[]),this.m_boolLockS&&(this.m_arrCostLock=a.SKILL||[]),this.p_labCostUp.string=langMgr.getString("generalSpecialEquicPage",1),this.p_nodeCostUp.active=this.m_arrCostUp.length>0,this.p_nodeCostLock[this.m_lockIndex].active=this.m_boolLockP||this.m_boolLockS):(this.p_nodeCostUp.active=!1,this.p_nodeCostLock[this.m_lockIndex].active=!1);break;case"confirm":this.p_nodeCostUp.active=!1,this.p_nodeCostLock[this.m_lockIndex].active=!1}this.p_arrNodeCostUp.forEach(function(t,a){if(e.m_arrCostUp[a]){t.active=!0;var i=gUtils.showCoinNum(e.m_arrCostUp[a].COUNT);"reset"==e.m_strType&&(e.m_boolLockP||e.m_boolLockS)&&(i=gUtils.showCoinNum(2*e.m_arrCostUp[a].COUNT));var n=gUtils.showCoinNum(app.player.getCount(e.m_arrCostUp[a].GSID));t.getChildByName("num").getComponent(cc.Label).string=n+"/"+i;var r=app.db.getPropsIconPath(e.m_arrCostUp[a].GSID),o=t.getChildByName("exp").getComponent(cc.Sprite);app.loadTexture(r,o,e.prefabPath)}else t.active=!1}),this.p_arrNodeCostLock.forEach(function(t,a){if(e.m_arrCostLock[a]){t.active=!0;var i=gUtils.showCoinNum(e.m_arrCostLock[a].COUNT),n=gUtils.showCoinNum(app.player.getCount(e.m_arrCostLock[a].GSID));t.getChildByName("num").getComponent(cc.Label).string=n+"/"+i;var r=app.db.getPropsIconPath(e.m_arrCostLock[a].GSID),o=t.getChildByName("exp").getComponent(cc.Sprite);app.loadTexture(r,o,e.prefabPath)}else t.active=!1})},onClickSkill:function(e,t){var a=this.m_objData.skill[e];"right"==t&&(a=this.m_arrNextSkill[e]);var i={type:"special",gsid:a};app.pages.windowspagetipsskill.showPage(i)},onClickBtnReset:function(){var e=this;if(!this.m_onReset){var t=0;this.m_boolLockP&&(t=1),this.m_boolLockS&&(t=2);var a="",i=1;(this.m_boolLockP||this.m_boolLockS)&&(i=2);for(var n=0;n<this.m_arrCostUp.length;++n){var r=this.m_arrCostUp[n],o=r.COUNT*i;app.player.getCount(r.GSID)<o&&(a+="\u3010"+app.db.getPropsName(r.GSID)+"\u3011")}a&&""!=a?app.showNotice(langMgr.getString("generalSpecialEquicPage",2,a)):(this.m_onReset=!0,app.player.sfExcluPreviewFresh(this.m_strGuid,t,function(t,a){if(t)return app.showNotice(t),void(e.m_onReset=!1);app.player.sfPlayerData(function(){a&&(e.m_arrNextProperty=a.property||[],e.m_arrNextSkill=a.skill||[]),e.m_strType="confirm",e.refreshUI(),e.m_onReset=!1})}))}},onClickBtnUp:function(){var e=this;if(!this.m_onUp){for(var t="",a=0;a<this.m_arrCostUp.length;++a){var i=this.m_arrCostUp[a],n=i.COUNT;app.player.getCount(i.GSID)<n&&(t+="\u3010"+app.db.getPropsName(i.GSID)+"\u3011")}var r=0;if(this.m_boolLockUp){r=1;for(var o=0;o<this.m_arrCostLock.length;++o){var s=this.m_arrCostLock[o],p=s.COUNT;app.player.getCount(s.GSID)<p&&(t+="\u3010"+app.db.getPropsName(s.GSID)+"\u3011")}}if(t&&""!=t)app.showNotice(langMgr.getString("generalSpecialEquicPage",2,t));else{var c=this;this.m_onUp=!0,app.player.sfExcluLevel(this.m_strGuid,r,function(t,a){if(t)return app.showNotice(t),void(e.m_onUp=!1);app.player.sfPlayerData(function(){var t={showtype:1,reward:[{gsid:a.exclusive.gsid,count:1,level:a.exclusive.level}],target:c,confirmcb:function(){a.exclusive.level>=app.db.getExclusMaxLv()?e.onClose():(e.m_objData=a.exclusive,e.m_strType="level",e.refreshUI()),e.m_onUp=!1}};app.pages.windowspagereward.showPage(t)})})}}},onClickBtnLock:function(e){switch(cc.log("now click lock type",e),e){case 0:this.m_boolLockP=!1,this.m_boolLockS=!1,this.m_boolLockUp=!1;break;case 1:this.m_boolLockP=!this.m_boolLockP,this.m_boolLockP&&(this.m_boolLockS=!1);break;case 2:this.m_boolLockS=!this.m_boolLockS,this.m_boolLockS&&(this.m_boolLockP=!1);break;case 3:this.m_boolLockUp=!this.m_boolLockUp}this.p_nodeLockP.getChildByName("picked").active=this.m_boolLockP,this.p_nodeLockS.getChildByName("picked").active=this.m_boolLockS,this.p_nodeLockUp.getChildByName("picked").active=this.m_boolLockUp,this.refreshProp(),this.refreshSkill(),this.refreshCost()},onClickBtnConfirm:function(e){var t=this;app.player.sfExcluResetConfirm(this.m_strGuid,e,function(a,i){a?app.showNotice(a):app.player.sfPlayerData(function(){e&&(i.gsid=t.m_objData.gsid,t.m_objData=i),t.m_strType="reset",t.m_arrNextProperty=[],t.m_arrNextSkill=[],t.refreshUI()})})},onClose:function(){"confirm"!=this.m_strType?(this.m_onReset=!1,this.m_onUp=!1,this._super(),this.m_funCb&&this.m_funCb()):app.showNotice(langMgr.getString("generalSpecialEquicPage",3))}});cc._RF.pop()},{basePage:void 0}],generalWuhunPage:[function(e,t){"use strict";cc._RF.push(t,"7b848MYWi9LwII7Ncy8M3pd","generalWuhunPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"generalwuhunpage"},properties:{p_nodeLock:cc.Node,p_labLock:cc.Label,p_labName:cc.Label,p_sprIcon:cc.Sprite,p_nodeProp1:cc.Node,p_labPropKey1:cc.Label,p_labPropVal1:cc.Label,p_nodeProp2:cc.Node,p_labPropKey2:cc.Label,p_labPropVal2:cc.Label,p_labIntro:cc.Label,p_nodeList:cc.Node,p_nodeItemWuhun:cc.Node,p_arrNodeCost:[cc.Node],p_btnChange:cc.Button,p_arrBtnSprF:[cc.SpriteFrame],p_sprUseNode:cc.Node,p_sprChangeNode:cc.Node},onLoad:function(){a.instance=this,this.handleUI(),this.stopBgNodeEvent(),this.creatMask(!1,255,"#21140b"),this.fitTopMenu()},handleUI:function(){var e=this;this._super(),this.p_btnChange.node.on("click",function(){app.playSound("click"),e.onClickChange()})},setParam:function(e){this.m_objData=e,this.refreshList(),this.refreshCost()},refreshWuhun:function(e){var t=app.db.getWuhunInfo(e);if(t){this.refreshBtn(e),this.p_nodeLock.active=t.LOCK>this.m_objData.gdata.star,this.p_labLock.node.active=t.LOCK>this.m_objData.gdata.star,this.p_labLock.node.active&&(this.p_labLock.string=langMgr.getString("generalWuhunPage",0,t.LOCK)),this.p_labName.string=t.NAME;var a=gConfig.rootPath.uiwuhun+t.ICON;app.loadTexture(a,this.p_sprIcon,this.prefabPath),this.p_sprIcon.node.active=!0,t.KEY0?(this.p_labPropKey1.string=t.KEY0,this.p_labPropVal1.string="\u521d\u59cb\u80fd\u91cf"==t.KEY0?t.VAL0:t.VAL0+"%",this.p_nodeProp1.active=!0):this.p_nodeProp1.active=!1,t.KEY1?(this.p_labPropKey2.string=t.KEY1,this.p_labPropVal2.string="\u521d\u59cb\u80fd\u91cf"==t.KEY1?t.VAL1:t.VAL1+"%",this.p_nodeProp2.active=!0):this.p_nodeProp2.active=!1,t.KEY0&&t.KEY1?(this.p_nodeProp1.x=-120,this.p_nodeProp2.x=120):this.p_nodeProp1.x=0,this.p_labIntro.string=t.INTRO}},refreshList:function(){this.m_nowPickId=null,this.m_nodePicked=null;var e=this.setData();this.m_arrWuhunItem||(this.m_arrWuhunItem=[],this.m_arrWuhunItem.push(this.p_nodeItemWuhun));for(var t=0;t<e.length;++t){var a=this.m_arrWuhunItem[t];a||((a=cc.instantiate(this.p_nodeItemWuhun)).parent=this.p_nodeList.getComponent(cc.ScrollView).content,this.m_arrWuhunItem.push(a)),a.active=!0,a.getComponent("wuhunListItem").refreshUI(e[t],this.m_objData.gdata.soul),this.m_objData.pickedid?e[t].wuhunid==this.m_objData.pickedid&&a.getComponent("wuhunListItem").click(!0):0==t&&a.getComponent("wuhunListItem").click(!0)}for(var i=e.length;i<this.m_arrWuhunItem.length;++i)this.m_arrWuhunItem[i].active=!1},refreshBtn:function(e){console.log(this.m_objData.pickedid,e);var t=app.db.getWuhunInfo(e);if(this.m_objData.pickedid)this.p_btnChange.node.getComponent(cc.Sprite).spriteFrame=this.p_arrBtnSprF[0],this.p_sprChangeNode.active=!0,this.p_sprUseNode.active=!1,e==this.m_objData.pickedid?this.p_btnChange.interactable=!1:t&&t.LOCK>this.m_objData.gdata.star?this.p_btnChange.interactable=!1:this.p_btnChange.interactable=!0;else{this.p_btnChange.node.getComponent(cc.Sprite).spriteFrame=this.p_arrBtnSprF[1],this.p_sprChangeNode.active=!1,this.p_sprUseNode.active=!0;var a=!!(t&&t.LOCK>this.m_objData.gdata.star);this.p_btnChange.interactable=this.m_objData.gdata.soul.indexOf(e)<0&&!a}this.refreshCost()},refreshCost:function(){var e=app.player.getCount(90341),t=[app.db.dbTalentCost[e]||app.db.dbTalentCost[app.db.dbTalentCost.length-1]];this.m_arrNowCost=t,console.log(e,t);for(var a=0;a<this.p_arrNodeCost.length;++a)t[a]&&0!=t[a].COUNT?(this.p_arrNodeCost[a].getComponent("costItem").refreshUI(t[a].GSID,t[a].COUNT,this),this.p_arrNodeCost[a].active=!0):this.p_arrNodeCost[a].active=!1},itemClickHander:function(e,t){return this.m_nowPickId==e||(this.m_nodePicked&&this.m_nodePicked.setPick(!1),this.m_nowPickId=e,this.m_nodePicked=t,this.refreshWuhun(e),!0)},setData:function(){var e=[],t=app.db.dbWuhunInfo;for(var a in t){var i={wuhunid:a,pickedid:this.m_objData.pickedid,star:this.m_objData.gdata.star,target:this,handler:"itemClickHander"};e.push(i)}return e},onClickChange:function(){var e=this;app.player.checkCostEnough(this.m_arrNowCost)&&app.player.sfGeneralSoul(this.m_objData.gdata.guid,this.m_objData.index,this.m_nowPickId,function(t,a){t?app.showNotice(t):(app.checkPageValid("generalpage")&&app.pages.generalpage.instance.refreshInfo(a.general),app.player.addItem({gsid:90341,count:1}),e.onClose())})}});cc._RF.pop()},{basePage:void 0}],generalbagHandbookPageBook:[function(e,t){"use strict";cc._RF.push(t,"aa5ddDHAwJOL457l6CzEZbR","generalbagHandbookPageBook"),cc.Class({extends:cc.Component,properties:{p_arrNodeTitle:[cc.Node],p_nodeLegend:cc.Node,p_nodeElite:cc.Node,p_nodeNormal:cc.Node,p_nodeItemLegend:cc.Node,p_nodeItemElite:cc.Node,p_nodeItemNormal:cc.Node},onLoad:function(){this.m_arrItemLegend=[],this.m_arrItemLegend.push(this.p_nodeItemLegend),this.m_arrItemElite=[],this.m_arrItemElite.push(this.p_nodeItemElite),this.m_arrItemNormal=[],this.m_arrItemNormal.push(this.p_nodeItemNormal)},refreshUI:function(e,t){this.m_target=t,this.m_allBookData=this.setBookData(e);for(var a=0;a<this.p_arrNodeTitle.length;++a){var i=e[a];switch(this.p_arrNodeTitle[a].active=!!(i.length>0),a){case 0:i.length>0?(this.p_nodeLegend.active=!0,this.refreshArrGeneral(i,this.p_nodeItemLegend,this.p_nodeLegend,this.m_arrItemLegend,"handbookGeneralItem")):this.p_nodeLegend.active=!1;break;case 1:i.length>0?(this.p_nodeElite.active=!0,this.refreshArrGeneral(i,this.p_nodeItemElite,this.p_nodeElite,this.m_arrItemElite,"handbookGeneralItem")):this.p_nodeElite.active=!1;break;case 2:i.length>0?(this.p_nodeNormal.active=!0,this.refreshArrGeneral(i,this.p_nodeItemNormal,this.p_nodeNormal,this.m_arrItemNormal,"handbookGeneralItem")):this.p_nodeNormal.active=!1}}this.node.getComponent(cc.ScrollView).scrollToTop(.1)},refreshArrGeneral:function(e,t,a,i,n){for(var r=0;r<e.length;++r){var o=e[r],s=i[r];s||((s=cc.instantiate(t)).parent=a,i.push(s)),s.active=!0;var p={gsid:o,garr:this.m_allBookData,index:this.m_allBookData.indexOf(o)};s.getComponent(n).refreshUI(p,this.m_target);var c=r>=30;app.playItemAction(s,r,c?0:void 0)}for(var h=e.length;h<i.length;++h)i[h].active=!1},setBookData:function(e){for(var t=[],a=0;a<e.length;++a){var i=e[a];t=t.concat(i)}return t}}),cc._RF.pop()},{}],generalbagHandbookPage:[function(e,t){"use strict";cc._RF.push(t,"ed5baJBZcdK0biGwR2KJ/lo","generalbagHandbookPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"generalbaghandbookpage"},properties:{p_nodeMenuContainer:cc.Node,p_pfbMenuSelector:cc.Prefab,p_nodeAdd:cc.Node,p_tabGeneralBag:cc.Node,p_labSpace:cc.Label,p_btnBag:cc.Button,p_btnSetTeam:cc.Button,p_tabHandbook:cc.Node,p_srcPrelineup:cc.ScrollView,p_pfbLineup:cc.Prefab,p_nodeCloseOn:cc.Node,p_btnEdit:cc.Button,p_btnTop:cc.Button,p_btnDelete:cc.Button},onLoad:function(){a.instance=this,this.creatMask(),this.handleUI(),this.fitTopMenu(80),this.m_numShowCampIndex=0,this.m_numShowProfeIndex=0,this._initMenu(),this.m_menu=this.node.getComponent("menu"),this.m_menu.init(this)},handleUI:function(){var e=this;this.p_btnBag.node.on("click",function(){app.playSound("click"),e.onClickBtnBag()}),this.p_nodeCloseOn.on("touchend",function(){e.p_nodeCloseOn.active=!1,e.m_arrPre[e._nowChooseIndex-1]&&(e.m_arrPre[e._nowChooseIndex-1].opacity=255)}),this.p_btnEdit.node.on("click",function(){e.onEdit()}),this.p_btnTop.node.on("click",function(){e.onTop()}),this.p_btnDelete.node.on("click",function(){e.onDelete()})},setParam:function(){this._nodeMenuController.getComponent("GeneralMenuSelector").initMenu(this.m_numShowCampIndex,this.m_numShowProfeIndex),this.campMenuHandler(this.m_numShowCampIndex),this.m_menu.setMenuIndex(0),this.m_menu.p_arrBtnMenu[1].active=app.db.checkFuncUnLock("HAND_BOOK"),this.m_menu.p_arrBtnMenu[2].active=app.db.checkFuncUnLock("GENER_FROM"),this.refreshMenu()},refreshUI:function(e){e||0==e||(e=0),this.onClickMenu(e,!0),this.refreshMenu()},_initMenu:function(){this._nodeMenuController=cc.instantiate(this.p_pfbMenuSelector),this.p_nodeMenuContainer.addChild(this._nodeMenuController),this._nodeMenuController.setPosition(cc.Vec2.ZERO),this._nodeMenuController.getComponent("GeneralMenuSelector").onCampClick(this.campMenuHandler,this),this._nodeMenuController.getComponent("GeneralMenuSelector").onProfessionClick(this.professionMenuHandler,this)},campMenuHandler:function(e){switch(this.m_numShowMenuIndex){case 0:this.m_numShowCampIndex=e,this.m_arrGeneralBagShowData=this.setGeneralBagViewData(),this.refreshGeneralBagView();break;case 1:this.m_numShowCampIndex=e;var t=this.setHandbookViewData(e);this.refreshHandbookView(t)}return!0},professionMenuHandler:function(e){switch(this.m_numShowMenuIndex){case 0:this.m_numShowProfeIndex=e,this.m_arrGeneralBagShowData=this.setGeneralBagViewData(),this.refreshGeneralBagView();break;case 1:this.m_numShowProfeIndex=e;var t=this.setHandbookViewData(e);this.refreshHandbookView(t)}return!0},menuHandler:function(e){switch(this.m_numShowMenuIndex=e,this.p_tabGeneralBag.active=0==e,this.p_tabHandbook.active=1==e,this.p_srcPrelineup.node.active=2==e&&app.db.checkFuncUnLock("GENER_FROM"),this.p_nodeAdd.active=0==e,this._nodeMenuController.active=Boolean(2!==e),e){case 0:case 1:this.m_numShowCampIndex=0,this.m_numShowProfeIndex=0,this._nodeMenuController.getComponent("GeneralMenuSelector").resetMenu(),this.campMenuHandler(this.m_numShowCampIndex);break;case 2:this.refreshPrelineup()}return!0},itemClick:function(e){var t={guid:e,garr:gUtils.deepClone(this.m_arrGeneralBagShowData),index:this.m_arrGeneralBagShowData.indexOf(e)};return app.pages.generalpage.showPage(t,null),!1},handleRankData:function(){return Object.keys(app.player.general).filter(function(e){var t=app.player.isSoulGeneral(e),a=app.player.isRetinueGeneral(e),i=app.player.general[e];return!(t||a||i.level<140)})},onClickBtnBag:function(){var e=app.player.getCount(90158);if(e>=app.db.dbGeneralBag.length)app.showNotice(langMgr.getString("generalbagHandbookPage",0));else{var t=app.db.dbGeneralBag[e],a={content:langMgr.getString("generalbagHandbookPage",4,t),confirmcb:this.confirmCb,target:this};app.pages.windowspagetipsmsg.showPage(a)}},confirmCb:function(){var e=this,t=app.player.getCount(90158),a=app.db.dbGeneralBag[t];app.player.getCount(38005)<a?app.showNotice(langMgr.getString("generalbagHandbookPage",1)):app.player.sfBagSpace(function(t){if(t){if("on limit"==t)return void app.showNotice(langMgr.getString("generalbagHandbookPage",0))}else app.player.sfPlayerByParam(["bagspace","hide","others"],function(){e.refreshBagNum(),app.showNotice(langMgr.getString("generalbagHandbookPage",2))})})},refreshMenu:function(){this.m_menu.refreshRed(),this.m_genRankList=this.handleRankData()},refreshMenuRed:function(e){var t=!1;switch(e){case 0:t=a.checkAllGeneralRed()}return t},refreshGeneralBagView:function(){var e=this,t=this.m_arrGeneralBagShowData.length;this.p_tabGeneralBag.getComponent("tableView").initTableView(t,{array:this.m_arrGeneralBagShowData,initfun:"initForBagWithRed",target:this},function(){cc.isValid(e)&&e.p_tabGeneralBag.getComponent("tableView").getCells(function(e){app.playGridListAction(e)})}),cc.log("now init tavbv status",this.p_tabGeneralBag.getComponent("tableView")._isInitTabv),this.refreshBagNum()},refreshBagNum:function(){this.p_labSpace.string=this.m_arrGeneralBagShowData.length+"/"+app.player.bagspace},reloadGeneralBagView:function(){var e=this.m_arrGeneralBagShowData.length;this.p_tabGeneralBag.getComponent("tableView").reload({array:this.m_arrGeneralBagShowData,initfun:"initForBagWithRed",target:this}),this.p_tabGeneralBag.getComponent("tableView").getCells(function(e){app.playGridListAction(e)}),this.p_labSpace.string=e+"/"+app.player.bagspace},refreshHandbookView:function(e){this.p_tabHandbook.getComponent("generalbagHandbookPageBook").refreshUI(e,this)},setGeneralBagViewData:function(){var e=this,t=[];for(var a in app.player.general)if(0==this.m_numShowCampIndex)t.push(a);else{var i=app.player.general[a].camp;this.m_numShowCampIndex==i&&t.push(a)}return this.m_numShowProfeIndex&&(t=t.filter(function(t){var a=app.player.general[t];return!!a&&(a.occu===e.m_numShowProfeIndex||a.occu2===e.m_numShowProfeIndex)})),t.sort(function(e,t){var a=app.player.general[e],i=app.player.general[t];return app.sortGeneraFunc(a,i)}),t},setHandbookViewData:function(){var e=[],t=app.db.dbGHandbook;for(var a in t){for(var i=[],n=0;n<t[a].length;++n){var r=t[a][n];"LEGEND"!=a&&"ELITE"!=a||(r=t[a][n]);var o=app.db.getGBaseByGsid(r);0!=this.m_numShowCampIndex&&o.CAMP!=this.m_numShowCampIndex||0!==this.m_numShowProfeIndex&&o.OCCU!==this.m_numShowProfeIndex&&o.OCCU2!==this.m_numShowProfeIndex||i.push(r)}e.push(i)}cc.log(e);for(var s={4:1,3:2,2:3,1:4,6:5,5:6},p=0;p<e.length;++p)e[p].sort(function(e,t){var a=app.db.getGBaseByGsid(e),i=app.db.getGBaseByGsid(t);return a.TGRADE===i.TGRADE?s[a.CAMP]<s[i.CAMP]?1:a.CAMP==i.CAMP&&a.GSID<i.GSID?1:-1:i.TGRADE-a.TGRADE});return cc.log("now handbook data is",e),e},refreshPrelineup:function(){this.p_nodeCloseOn.active=!1,this.m_arrPre||(this.m_arrPre=[]);for(var e=0;e<=5;++e){var t=this.m_arrPre[e];t||((t=cc.instantiate(this.p_pfbLineup)).parent=this.p_srcPrelineup.content,this.m_arrPre.push(t)),t.getComponent("prelineupMod").refreshShow(e+1,this,!0)}},showLineupOpts:function(e){if(this._nowChooseIndex=e,this.p_nodeCloseOn.active=!0,this.m_arrPre[e-1]){var t=this.m_arrPre[e-1].convertToWorldSpaceAR(cc.v2(0,0));this.m_arrPre[e-1].opacity=140;var a=this.p_nodeCloseOn.convertToNodeSpaceAR(t);this.p_btnEdit.node.parent.setPosition(a)}},onEdit:function(){var e=this;app.pages.lineupnamepage.showPage({index:this._nowChooseIndex,name:"pre"+this._nowChooseIndex,type:"pre",funCb:function(){e.p_nodeCloseOn.active=!1,e.m_arrPre[e._nowChooseIndex-1].getComponent("prelineupMod").refreshShow(e._nowChooseIndex,e,!0)}})},onTop:function(){var e=this;1!=this._nowChooseIndex?app.player.sfTopLineup(this._nowChooseIndex,function(t){if(t)app.showNotice(t);else{for(var a=app.player.battlearr["pre"+e._nowChooseIndex],i=e._nowChooseIndex;i>1&&app.player.battlearr["pre"+i];--i)app.player.battlearr["pre"+i]=app.player.battlearr["pre"+(i-1)];app.player.battlearr.pre1=a,e.refreshPrelineup()}}):app.showNotice(langMgr.getString("generalbagHandbookPage",3))},onDelete:function(){var e=this;app.player.sfDeleteLineup(this._nowChooseIndex,function(t){if(t)app.showNotice(t);else{for(var a=e._nowChooseIndex;a<=6&&app.player.battlearr["pre"+a];++a)app.player.battlearr["pre"+a]=app.player.battlearr["pre"+(a+1)];delete app.player.battlearr["pre"+(a-1)],e.refreshPrelineup()}})},onDestroy:function(){this._super()},onClose:function(){cc.isValid(this.node)&&this.node.active&&(assetMsg.ReleaseDynamic("generalghandbook"),--app.numPrefabZindex,app.popPage(),cc.director.emit("page_close_end"),this.node.active=!1)}});a.refreshRed=function(e){var t=!1;return t||(t=a.checkAllGeneralRed()),e&&(e.active=t),t},a.checkAllGeneralRed=function(){var e=!1;for(var t in app.player.general)if(a.checkGeneralRed(t)){e=!0;break}return e},a.checkGeneralRed=function(e){if(void 0===app.player.general[e])return!1;if(app.player.gnum>=30&&(app.player.general[e].level<=1||app.player.general[e].star<=3))return!1;for(var t=0;t<4;++t)if(a.checkEquip(e,t))return!0;if(a.checkMount(e))return!0;if(a.checkTreas(e))return!0;if(a.checkStarUp(e))return!0;for(var i=0;i<5;++i)if(a.checkSoulStone(e,i))return!0;return!!a.checkExclusiveEquip(e)||!!a.checkGeneralSkin(e)},a.checkEquip=function(e,t){var i=app.player.getEquipForPos(),n=app.player.general[e];if(!n)return!1;var r=n.equip[t],o=i[t];if(!o)return!1;if(!r&&o.length>0)return!0;if(r){var s=app.db.dbOccuequip;o.sort(function(e,t){return a.checkEquipMax(e,t,n)});var p=Number(o[o.length-1]),c=Number(r);return(!s[p]||!s[c]||n.occu!=s[c].OCCU&&n.occu2!=s[c].OCCU)&&a.checkEquipMax(p,c,n)>0}return!1},a.checkEquipMax=function(e,t,a){var i=app.db.dbOccuequip;return i[e]&&i[t]?a.occu==i[e].OCCU&&a.occu==i[t].OCCU||a.occu2==i[e].OCCU&&a.occu2==i[t].OCCU||a.occu!=i[e].OCCU&&a.occu!=i[t].OCCU&&a.occu2!=i[e].OCCU&&a.occu2!=i[t].OCCU?Number(e)-Number(t)>0?1:-1:a.occu==i[e].OCCU||a.occu2==i[e].OCCU&&a.occu!=i[t].OCCU?1:-1:Number(e)-Number(t)>0?1:-1},a.checkMount=function(e){var t=app.player.general[e];return!!t&&0==t.exclusive.level&&t.level>=40&&app.db.checkFuncUnLock("GENER_MOUNT")},a.checkTreas=function(e){var t=app.player.general[e];if(!t)return!1;var a=app.player.getTreasForQS(),i=t.treasure;if(!app.db.checkFuncUnLock("GENER_TERA"))return!1;if(a.length<=0)return!1;if(!i&&a.length>0)return!0;if(i){var n=i.gsid?i.gsid:i,r=app.db.getPropsInfoByGsid(n),o=app.player.treas[a[0]].gsid?app.player.treas[a[0]].gsid:a[0],s=app.db.getPropsInfoByGsid(o);if(s.QUALITY>r.QUALITY)return!0;if(s.QUALITY==r.QUALITY&&s.STAR>r.STAR)return!0;if(i.property){if(app.player.treas[a[0]].property&&app.player.treas[a[0]].property.length>i.property.length)return!0}else if(app.player.treas[a[0]].property)return!0}return!1},a.checkStarUp=function(e){var t=app.player.general[e];if(!t)return!1;if(t.star<6)return!1;var a=app.db.getAwakeIdByGsid(t.gsid);if(!a)return!1;for(var i=app.db.getAwakeByGsid(t.gsid),n=!0,r=0;r<i.ITEMS.length;++r)if(app.player.getCount(i.ITEMS[r].GSID)<i.ITEMS[r].COUNT){n=!1;break}return!(!app.db.isFullComp(a).ISFULL||!n)},a.checkSoul=function(){return!1},a.checkExclusiveEquip=function(e){var t=app.player.general[e];if(!t)return!1;var a=t.exclusive_equip?t.exclusive_equip:0;return!(a>=app.db.getExclMaxLv(t.gsid)||app.db.getExclConsumeByGsid(t.gsid,a).filter(function(e){var t=e.COUNT;return app.player.getCount(e.GSID)<t}).length>0||!a&&!(t.star>=11))},a.checkGeneralSkin=function(){return!1},a.checkBook=function(e,t){var i=app.player.general[e];if(!i)return!1;var n=app.player.getBookForPos(t+1),r=(i&&i.book||[])[t];if(!n)return!1;if(!r&&n.length>0)return!0;if(r)for(var o=app.db.getBBaseByGsid(r.gsid),s=0;s<n.length;s++){var p=app.player.books[n[s]],c=app.db.getBBaseByGsid(p.gsid);if(c.STAR>o.STAR)return!0;if(c.STAR==o.STAR){if(p.level>r.level)return!0;if(p.level==r.level)for(var h=0;h<c.OCCU.length;h++)if(!a.checkBookOccu(i,r)&&(i.occu==c.OCCU[h]||i.occu2&&i.occu2==c.OCCU[h]))return!0}}return!1},a.checkBookOccu=function(e,t){if(!t)return!1;for(var a=app.db.getBBaseByGsid(t.gsid),i=0;i<a.OCCU.length;i++)if(e.occu==a.OCCU[i]||e.occu2&&e.occu2==a.OCCU[i])return!0;return!1},a.checkSoulStone=function(e,t){var a=app.player.soulstones?Object.values(app.player.soulstones):[],i=app.player.general[e];if(!i)return!1;var n=gUtils.isNull(i.stone)?null:i.stone[t];if(n){var r=app.db.getPropsInfoByGsid(n.gsid);return 0!==a.filter(function(e){return e.pType===r.PTYPE&&e.star>r.STAR}).length}return app.db.getSoulStoneLockInfoByPos(t).STAR<=i.star&&a.length>0},a.checkStoneOn=function(e,t){if(!e&&0!==e)return[];if(!t)return[];var a=app.player.general[t].beastsoul||[],i=app.player.general[t].stone||[];if(0===a.length)return[];var n=Math.floor(e/2),r=e%2==0?e+1:e-1;if(!i[r])return[];var o=app.db.getPropsInfoByGsid(i[r].gsid),s=[];return a.forEach(function(e,t){if(n!==t&&e){var a=app.db.getGeneralPotByID(e).GROUP[0].map(function(e){return e%100});if(a.indexOf(o.PTYPE)>=0){var i=a.find(function(e){return e!==o.PTYPE});i||(i=o.PTYPE),s.indexOf(i)<0&&s.push(i)}}}),s},cc._RF.pop()},{basePage:void 0}],giftRecommendPage:[function(e,t){"use strict";cc._RF.push(t,"82b4auz1UtM+IJYpqFhpCng","giftRecommendPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"giftrecommendpage",pageType:1},properties:{p_rtxIntro:cc.RichText,p_pfbItem:cc.Prefab,p_nodeParent:cc.Node,p_labTime:cc.Label,p_btnBuy:cc.Button,p_labPrice:cc.Label,p_btnLeft:cc.Button,p_btnRight:cc.Button,p_nodeDotList:cc.Node,p_nodeBtnParent:cc.Node,p_nodeBtn:cc.Node},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.schedule(this.refreshTime,1),this.m_menu=this.node.getComponent("menu"),this.m_menu.init(this)},handleUI:function(){var e=this;this._super(),this.p_btnBuy.node.on("click",function(){app.player.payRecommendGift(e.m_objShowData.type||0,e.m_objShowData.price,function(){e._payRefreshEnd=!1;var t={reward:e.m_objShowData.rewards,showtype:1};app.pages.windowspagereward.showPage(t),e.payRefresh(),e.schedule(e.payRefresh,1,3)},function(){app.showNotice(langMgr.getString("giftRecommendPage",0))})}),this.p_btnLeft.node.on("click",function(){e.m_nIndex<=0||(e.m_objShowData=e.m_arrData[e.m_nIndex-1],e.refreshUI(),e.refreshArrow(e.m_nIndex-1),e.p_nodeDotList.getComponent("dotListItem").flipLeft())}),this.p_btnRight.node.on("click",function(){e.m_nIndex>=e.m_arrData.length-1||(e.m_objShowData=e.m_arrData[e.m_nIndex+1],e.refreshUI(),e.refreshArrow(e.m_nIndex+1),e.p_nodeDotList.getComponent("dotListItem").flipRight())}),this.p_btnLeft.node.active=!1,this.p_btnRight.node.active=!1},setParam:function(e){cc.log("show gift recommend page"),cc.log(e),app.arrRed.tjlb=!0,this.m_objData=e,"Array"==gUtils.getType(e.data)?e.data.length>0?this.m_arrData=this.m_objData.data:this.onClose():this.m_arrData=[e.data],this.refreshBtn(),this.m_menu.setMenuIndex(0)},menuHandler:function(e){this.m_nowMenuIndex=e,this.m_objShowData=this.m_arrData[e],this.refreshUI()},refreshBtn:function(){var e=this;if(this.m_arrData.length<2)this.p_nodeBtnParent.active=!1;else{this.p_nodeBtnParent.active=!0;for(var t=function(t){var a=e.p_nodeBtnParent.children[t];a||((a=cc.instantiate(e.p_nodeBtnParent.children[0])).parent=e.p_nodeBtnParent,e.m_menu.p_arrBtnMenu.push(a),a.on("click",function(){app.playSound("click"),e.m_menu._onClickMenu(t)}));var i=app.db.dbRecommendGift[e.m_arrData[t].type],n=a.getComponent(cc.Sprite),r=a.getChildByName("btn_pick").getComponent(cc.Sprite),o=a.getChildByName("spr_name").getComponent(cc.Sprite),s=gConfig.rootPath.uiicontjlb+i.ICON,p=gConfig.rootPath.uiicontjlb+i.ICONLIGHT,c=gConfig.rootPath.uiicontjlb+i.TXTNAME;app.loadTexture(s,n,e.prefabPath),app.loadTexture(p,r,e.prefabPath),app.loadTexture(c,o,e.prefabPath),a.active=!0},a=0;a<this.m_arrData.length;a++)t(a);for(var i=this.m_arrData.length;i<this.p_nodeBtnParent.children.length;i++)this.p_nodeBtnParent.children[i].active=!1}},payRefresh:function(){var e=this;this._payRefreshEnd||app.player.sfPlayerData(function(){e._payRefreshEnd=!0,app.reduceRecommendGift(e.m_objShowData.type),app.mainScene&&app.mainScene.refreshTopUI(),e.onClose()})},refreshUI:function(){var e=app.db.dbRecommendGift[this.m_objShowData.type],t="";e&&e.INTRO&&(t=e.INTRO),this.p_rtxIntro.string=t;var a=gUtils.deepClone(this.m_objShowData.rewards);a.push({gsid:38003,count:this.m_objShowData.exp||10*this.m_objShowData.price}),this.refreshRewards(a),this.refreshBtnBuy(),this.refreshTime()},refreshRewards:function(e){this.m_arrItems||(this.m_arrItems=[]);for(var t=0;t<e.length;++t){var a=this.m_arrItems[t];a||((a=cc.instantiate(this.p_pfbItem)).parent=this.p_nodeParent,a.scale=.9,this.m_arrItems.push(a)),a.getComponent("propItem").initForBag(e[t]),a.getComponent("propItem").setClick(!0),a.active=!0}for(var i=e.length;i<this.m_arrItems.length;++i)this.m_arrItems[i].active=!1},refreshBtnBuy:function(){this.p_labPrice.string="\xa5"+this.m_objShowData.price},refreshTime:function(){var e=app.player.getServerTime(),t=this.m_objShowData.expireAt,a=t-e;(!t||a<0)&&(a=0),this.p_labTime.string=gUtils.getCountDownStr(a)+langMgr.getString("giftRecommendPage",1)},refreshArrow:function(e){this.m_nIndex=e;var t=this.m_arrData.length;this.p_btnLeft.node.opacity=t>=2&&e>=1?255:0,this.p_btnRight.node.opacity=t>=2&&e<t-1?255:0},onClose:function(){app.recommendnewgift=[],this._super()}});a.getEndTime=function(){var e=0;if(!app.recommendgiftlist||"Array"!=gUtils.getType(app.recommendgiftlist))return e;for(var t=0;t<app.recommendgiftlist.length;++t){var a=app.recommendgiftlist[t].expireAt;a&&(0==e||a<e)&&(e=a)}return e},a.refreshRed=function(e){return e&&(e.active=!app.arrRed.tjlb),!app.arrRed.tjlb},cc._RF.pop()},{basePage:void 0}],godbeastBattlePage:[function(e,t){"use strict";cc._RF.push(t,"b73b7iRDWNEe7w2vB4pCN2B","godbeastBattlePage");var a={kingpvpsave:"KPLINEUP",kingpvpfight:"KPLINEUP",wangpvpsave:"WPLINEUP",ringpvpsave:"RPLINEUP",ringpvpfight:"RPLINEUP",nationwar:"NWLINEUP"},i=cc.Class({extends:e("basePage"),statics:{prefabPath:"godbeastbattlepage",pageType:1},properties:{p_arrItem:[cc.Node]},onLoad:function(){i.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},setParam:function(e){if(this.m_Gid=e.gid,this._target=e.target,a[app.battleType]){this._arrLineupBeast=[];for(var t=a[app.battleType],i=0;i<this._target.m_multiMax;++i)i!=this._target.m_multiIndex&&app.player.battlearr[gConfig[t][i]]&&this._arrLineupBeast.push(Number(app.player.battlearr[gConfig[t][i]].mythic))}else if("legionpvpsave"==app.battleType){this._arrLineupBeast=[];for(var n=0;n<gConfig.LEGIONPVPLINEUP.length;++n)n!=app.LpvpIndex&&app.player.battlearr[gConfig.LEGIONPVPLINEUP[n]]&&this._arrLineupBeast.push(Number(app.player.battlearr[gConfig.LEGIONPVPLINEUP[n]].mythic))}else if("northsave"==app.battleType){this._arrLineupBeast=[];for(var r=0;r<3;++r)r+1!=app.northTeamIndex&&app.northInfo.battlearr.get(r+1)&&app.northInfo.battlearr.get(r+1).bset.mythic&&this._arrLineupBeast.push(Number(app.northInfo.battlearr.get(r+1).bset.mythic.tid))}this.refreshUI()},refreshUI:function(){var e=0;for(var t in app.db.dbMythical)this.p_arrItem[e]?(this.p_arrItem[e].getComponent("godBattleItem").initUI(t,this.m_Gid,this._arrLineupBeast,this._target),++e):cc.log("no enough item ",t)}});cc._RF.pop()},{basePage:void 0}],godbeastChoosePage:[function(e,t){"use strict";cc._RF.push(t,"d01baTtpapMXrj10oHZ9ta8","godbeastChoosePage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"godbeastchoosepage"},properties:{p_arrNodeItem:[cc.Node],p_btnBack:cc.Button},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(),this.handleUI()},handleUI:function(){this.p_btnBack.node.on("click",function(){app.playSound("click"),app.mainScene.onMenu(0)})},setParam:function(){this.refreshUI()},refreshUI:function(){var e=0;for(var t in app.db.dbMythical)this.p_arrNodeItem[e]?(this.p_arrNodeItem[e].getComponent("godbeastChooseItem").refreshUI(t),++e):cc.log("no enough item ",t)}});a.refreshRed=function(e){var t=!1;if(!app.opengodbeast){for(var a in app.db.dbMythical)if((app.player.mythical[a]||{}).level){var i=app.db.getMythicLvCostByLv(0);t=!0;for(var n=0;n<i.length;++n)if(i[n].GSID){var r=i[n].COUNT;if(app.player.getCount(i[n].GSID)<r){t=!1;break}}if(t)break}return e&&(e.active=t),t}e.active=!1},cc._RF.pop()},{basePage:void 0}],godbeastPage:[function(e,t){"use strict";cc._RF.push(t,"62fcetQHKhNUYGlFzqeU5mj","godbeastPage");var a={HP:11,PATKDAM:12,PASP:13,PCRI:14,PCRID:15,PMPS:16,PSKIDAM:17,PPBS:18,PMBS:19,PEFC:20,PDEX:21,PMDEX:22,PDAM:23,ATK:24},i=e("dbProperty"),n=cc.Class({extends:e("basePage"),statics:{prefabPath:"godbeastpage"},properties:{p_sprName:cc.Sprite,p_labLevel:cc.Label,p_sprGod:cc.Sprite,p_arrNodeMenu:[cc.Node],p_arrNodePickMenu:[cc.Node],p_nodeInfo:cc.Node,p_sprSkillIcon:cc.Sprite,p_labSkillName:cc.Label,p_labSkillIntro:cc.Label,p_nodeHalo:cc.Node,p_arrNodeHalo:[cc.Node],p_arrRtxHaloIntro:[cc.Label],p_arrRtxHaloDes:[cc.Label],p_nodeTianfu:cc.Node,p_arrSprTianfu:[cc.Node],p_arrNodeTupo:[cc.Node],p_nodeBreakContent:cc.Node,p_animNode:cc.Animation,p_animPower_01:cc.Animation,p_animPower_02:cc.Animation,p_animPower_03:cc.Animation,p_nodePowerNum:cc.Node,p_barTalent:cc.ProgressBar,p_nodeClass:cc.Node,p_sprTalentSkill:cc.Sprite,p_labTalentName:cc.Label,p_labTalentIntro:cc.Label,p_sprTalentCost:cc.Sprite,p_labTalentCostSelf:cc.Label,p_labTalentCost:cc.Label,p_btnTalentUp:cc.Button,p_nodeMax:cc.Node,p_arrLabKey:[cc.Label],p_arrLabValue:[cc.Label],p_spLvUp:sp.Skeleton,p_animLevelup:cc.Animation,p_spGod:sp.Skeleton,p_arrHaloAnim:[cc.Animation],p_skillAnim:cc.Animation,p_nodeCost:cc.Node,p_arrnodeCost:[cc.Node],p_arrLabCostSelf:[cc.Label],p_arrLabCost:[cc.Label],p_btnUp:cc.Button,p_maxLevel:cc.Node,p_btnHelp:cc.Button,p_btnPreview:cc.Button,p_btnReset:cc.Button,p_spBtnPreview:[cc.SpriteFrame],p_labTextLockTip:cc.Label,p_nodeTipBg:cc.Node,p_nodeMask:cc.Node,p_pfbSwitchItem:cc.Prefab,p_nodeContent:cc.Node,_arrSwitchList:[]},onLoad:function(){n.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.fitTopMenu(),this.longPress=this.node.getComponent("longPressBtn"),this.longPress.init(this),this.m_colorCost=this.p_arrLabCostSelf[0].node.color.clone(),this.p_nodeMask.active=!1},onEnable:function(){this._super(),eventMgr.on(eventStr.mythical.TALENT,this.refTalent,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.mythical.TALENT,this.refTalent,this)},handleUI:function(){var e=this;this._super(),this.p_arrNodeMenu.forEach(function(t,a){t.on("touchend",function(){e.onClickMenu(a)})}),this.p_arrSprTianfu.forEach(function(t,a){t.on("touchend",function(){var t={openLen:e.m_arrTalentSkill.length,arrSkill:e.m_talentSkill,index:a,maxProLen:e.m_maxProLen};app.pages.windowspagetalentskill.showPage(t)})}),this.p_arrNodeHalo.forEach(function(t,a){t.on("touchend",function(){e.onClickHalo(a)})}),this.clickPressBtn=function(){return e.onClickBtnUp(),1==e.m_numBtnType},this.longPressUpdate=function(){-1===app.arrPages[app.arrPages.length-1].indexOf("godbeastpage")&&e.longPress.setStatus(!1)},this.p_btnReset.node.on("click",function(){app.playSound("click"),e.onClickBtnReset()}),this.p_btnHelp.node.on("click",function(){app.pages.windowspagetipshelp.showPage("1022")}),this.p_btnPreview.node.on("click",function(){app.playSound("click"),e.onClickBtnPreview()}),this.p_btnTalentUp.node.on("click",function(){app.playSound("click"),app.player.getCount(e.m_classInfo[0].GSID)<e.m_classInfo[0].COUNT?app.showNotice(langMgr.getString("godbeastPage",25)):(e.p_nodeMask.active=!0,app.player.sfMythicalTalentClass(e.m_nowMid,e.m_arrTalentSkill.length,function(t){t?e.p_nodeMask.active=!1:(e.p_nodeMask.active=!1,app.player.sfPlayerByParam(["others","hide","props"],function(){eventMgr.emit(eventStr.mythical.TALENT,!0)}))}))})},setParam:function(){var e=Object.keys(app.db.dbMythical),t=app.player.mythical;this.m_thicalBase=e.sort(function(e,a){var i=t[e],n=t[a],r=0;return i&&n?i.level!=n.level&&(r=i.level>n.level?-1:1):(i||n)&&(r=i?-1:1),0==r&&(r=e>a?1:-1),r}),this.onSwitchGodBeast(0),app.runUnlockGuide("MYTHICAL")},refreshData:function(){if(this.m_objMBase=app.db.getMythicalById(this.m_nowMid),this.m_objMData=app.player.mythical[this.m_nowMid],this.refreshTop(),this.m_objMData)this.refreshUI();else{var e=app.db.getMythicMaxClass(),t=app.db.getMythicMaxLvByClass(e);this.m_objMData={},this.m_objMData.level=t,this.m_objMData.class=e,this.m_objMData.pskill=[];for(var a=0;a<4;++a){var i=app.db.getMythicPSkillMaxLv(e,a);this.m_objMData.pskill.push(i)}this.refreshUI(!0)}},refreshTop:function(){var e=this;this.m_thicalBase.forEach(function(t,a){var i=e.getSwitchItem(a);i.getComponent("godbeastSwitchItem").refreshUI(t,e);var n=Boolean(a==e.m_topIndex);i.getComponent("godbeastSwitchItem").setPick(n)})},getSwitchItem:function(e){var t=this,a=this._arrSwitchList[e];return cc.isValid(a)?a:(a=cc.instantiate(this.p_pfbSwitchItem),this.p_nodeContent.addChild(a),this._arrSwitchList[e]=a,a.on(cc.Node.EventType.TOUCH_END,function(){t.onSwitchGodBeast(e)},this),a)},refreshUI:function(e){var t=gConfig.getGodBeastNamePath(this.m_nowMid);app.loadTexture(t,this.p_sprName,this.prefabPath);var a="game_ui/04_page/godbeast_page/"+this.m_nowMid;app.loadTexture(a,this.p_sprGod,this.prefabPath),this.p_arrNodeMenu[1].active=!!app.player.mythical[this.m_nowMid],this.p_arrNodeMenu[2].active=!!app.player.mythical[this.m_nowMid]&&app.db.checkChannelShow("GODBEAST_TALENT");var i=!1;!e&&this.m_objMData.level>1?i=!0:!e&&this.m_objMData.pskill[0]>1?i=!0:!e&&app.player.mythical[this.m_nowMid].talent&&app.player.mythical[this.m_nowMid].talent.length&&(i=!0),this.p_btnPreview.node.getComponent(cc.Sprite).spriteFrame=this.p_spBtnPreview[Number(!!e)],this.p_btnReset.node.active=i},refreshBtn:function(e,t){this.p_btnUp.node.children.forEach(function(a,i){i==e&&app.setSpriteState(a.getComponent(cc.Sprite),t),a.active=i==e})},refreshInfo:function(){if(this.m_objMBase){var e=this.m_objMData.level,t=app.db.getMythicMaxLvByClass(this.m_objMData.class),a=app.db.getMythicMaxClass(),i=!1,n=[];if(this.p_maxLevel.active=!1,this.p_labTextLockTip.node.opacity=0,this.p_nodeTipBg.opacity=0,app.player.mythical[this.m_nowMid])if(e>=t&&e)if(this.m_objMData.class>=a)this.p_labLevel.string="Lv."+langMgr.getString("godbeastPage",0),i=!0,this.p_btnUp.node.active=!0,this.p_maxLevel.active=!0,this.refreshBtn(0,!0),this.p_btnUp.interactable&&(this.p_btnUp.interactable=!1,app.setSpriteState(this.p_btnUp.getComponent(cc.Sprite),!0)),this.longPress.setOver(),this.longPress.setStatus(!1);else{this.p_labLevel.string="Lv."+e,this.p_btnUp.node.active=!0,this.m_numBtnType=2,this.refreshBtn(2,!1),this.p_btnUp.interactable||(this.p_btnUp.interactable=!0,app.setSpriteState(this.p_btnUp.getComponent(cc.Sprite),!1));var r=app.db.getMythicCCostByClass(this.m_objMData.class+1);!r||r.length<=0?i=!0:n=r,this.longPress.setOver(!1)}else this.p_labLevel.string="Lv."+e,this.p_btnUp.node.active=e>0,this.refreshBtn(0,!1),this.p_btnUp.interactable||(this.p_btnUp.interactable=!0,app.setSpriteState(this.p_btnUp.getComponent(cc.Sprite),!1)),this.m_numBtnType=1,n=app.db.getMythicLvCostByLv(e),this.longPress.setOver(!1);else this.p_labLevel.string="",this.m_numBtnType=1,i=!1,this.p_btnUp.node.active=!0,this.refreshBtn(1,!1),this.p_btnUp.interactable||(this.p_btnUp.interactable=!0,app.setSpriteState(this.p_btnUp.getComponent(cc.Sprite),!1)),n=app.db.getMythicLvCostByLv(0),this.longPress.setOver(!1);var o=this.m_objMData.class-1>=0?this.m_objMData.class-1:0,s=this.m_objMBase.SKILL[o],p=e-1>=0?e:1,c=app.db.getSkillInfoByGsid(s,p);cc.log(s),cc.log(c),this.p_labSkillName.string=c.NAME,this.p_labSkillIntro.string=c.INTRO;var h=app.db.getSkillPathByGsid(s,this.m_objMData.level);app.loadTexture(h,this.p_sprSkillIcon,this.prefabPath),this.refreshCost(i,n)}},refreshHalo:function(){var e=this;this.p_arrNodeHalo.forEach(function(t,a){var i={skill:e.m_objMBase.PSKILL[a],lv:e.m_objMData.pskill[a]||0,blush:!0,isBrief:!0};cc.log("now init Halo info is",i),t.getComponent("godbeastHaloItem").refreshUI(i,e)})},refreshCost:function(e,t){void 0===e&&(e=!1);for(var a=0;a<t.length;++a){var i=this.p_arrnodeCost[a];i.active=!0;var n=i.getChildByName("icon_prop").getComponent(cc.Sprite),r=app.db.getPropsIconPath(t[a].GSID);app.loadTexture(r,n,this.prefabPath),this.p_arrLabCostSelf[a].node.color=app.player.getCountEnough(t[a])?this.m_colorCost:cc.Color.RED,this.p_arrLabCostSelf[a].string=gUtils.showNum(app.player.getCount(t[a].GSID||t[a].gsid)),this.p_arrLabCost[a].string="/ "+gUtils.showNum(t[a].COUNT)}for(var o=e?0:t.length;o<this.p_arrnodeCost.length;++o)this.p_arrnodeCost[o].active=!1},refreshHaloInfo:function(e){var t=this.m_objMData.pskill[e];cc.log("now show pskill lv is",t),t||this.longPress.setStatus(!1),this.p_maxLevel.active=!1;var n=this.m_objMBase.PSKILL[e],r=app.db.getSkillInfoByGsid(n,t||1),o=app.db.getSkillInfoByGsid(n,t+1);if(!r)return this.longPress.setStatus(!1),!1;this.p_labTextLockTip.node.opacity=0===t?255:0,this.p_nodeTipBg.opacity=0===t?255:0,0===t&&(this.p_labTextLockTip.string=langMgr.getString("godbeastPage",10,e+1));for(var s=0;s<4;++s)if(r.PROP[s]){var p=r.PROP[s].KEY,c=i[p].NAME,h=t?r.PROP[s].VAL:0;2==i[p].NUMTYPE&&(h=h/10+"%"),this.p_arrRtxHaloIntro[s].node.active=!0,this.p_arrRtxHaloDes[s].node.active=!0,this.p_arrRtxHaloIntro[s].string=langMgr.getString("godbeastPage",a[i[p].EN])||c,this.p_arrRtxHaloDes[s].string="+"+h}else this.p_arrRtxHaloIntro[s].node.active=!1,this.p_arrRtxHaloDes[s].node.active=!1;var l=!1,g=[],d=app.db.getMythicPSkillMaxLv(this.m_objMData.class,e);return app.player.mythical[this.m_nowMid]?!t||t>=d?(l=!0,this.p_btnUp.node.active=!0,this.refreshBtn(0,!0),this.p_maxLevel.active=0!==t,this.p_btnUp.interactable&&(this.p_btnUp.interactable=!1,app.setSpriteState(this.p_btnUp.getComponent(cc.Sprite),!0)),this.longPress.setOver(),this.longPress.setStatus(!1)):(o.COST.length<=0?l=!0:g=o.COST,this.p_btnUp.node.active=!0,this.refreshBtn(0,!1),this.p_btnUp.interactable||(this.p_btnUp.interactable=!0,app.setSpriteState(this.p_btnUp.getComponent(cc.Sprite),!1)),this.longPress.setOver(!1)):(l=!0,this.p_btnUp.node.active=!1,g=app.db.getMythicLvCostByLv(0),this.longPress.setOver(!1)),this.refreshCost(l,g),!0},refTalent:function(e){var t=this;if(this.m_arrTalentSkill=[],app.player.mythical[this.m_nowMid].talent&&(this.m_talent=app.player.mythical[this.m_nowMid].talent),app.player.mythical[this.m_nowMid].talentskill&&(this.m_arrTalentSkill=app.player.mythical[this.m_nowMid].talentskill),e){var a=this.p_arrSprTianfu[this.m_arrTalentSkill.length-1],i=a.getChildByName("spine").getComponent(sp.Skeleton);this.m_pro=Math.max(this.m_arrTalentSkill.length-1,0)/(this.m_talentSkill.length-1),this.m_isPlayAnim=!0,this.scheduleOnce(function(){a.getChildByName("lock").active=!1,i.node.opacity=255,i.setAnimation(0,"mj_eff_item_frame_glow03",!1),t.scheduleOnce(function(){app.playSound("talenclassup")},.9),i.setCompleteListener(function(){app.pages.windowspagegodbeasttalent.showPage(t.m_talentSkill[t.m_arrTalentSkill.length-1]),cc.isValid(t)&&(t.refreshTalent(),i.node.opacity=0)})},this.m_pro-this.p_barTalent.progress)}else this.p_barTalent.progress=Math.max(this.m_arrTalentSkill.length-1,0)/(this.m_talentSkill.length-1),this.refreshTalent()},update:function(e){this.m_isPlayAnim&&(this.p_barTalent.progress+=e,this.p_barTalent.progress>=this.m_pro&&(this.m_isPlayAnim=!1,this.p_barTalent.progress=this.m_pro))},refreshTalent:function(){var e=this;this.p_nodeMask.active=!1,this.p_btnReset.node.active||(this.p_btnReset.node.active=this.m_talent.length),this.m_talentSkill=app.db.getMythicalTalentSkill(this.m_nowMid),this.p_barTalent.progress=Math.max(this.m_arrTalentSkill.length-1,0)/(this.m_talentSkill.length-1);for(var t=0;t<this.m_talentSkill.length;t++){var a=this.m_talentSkill[t],i=this.p_arrSprTianfu[t].getChildByName("icon").getComponent(cc.Sprite),n=app.db.getSkillPathByGsid(a);app.loadTexture(n,i,this.prefabPath);var r=app.db.getSkillInfoByGsid(a);r&&(this.p_arrSprTianfu[t].getChildByName("name").getComponent(cc.Label).string=r.NAME),app.setSpriteState(i,this.m_arrTalentSkill.length<=t),this.p_arrSprTianfu[t].getChildByName("lock").active=this.m_arrTalentSkill.length<=t}if(this.m_talent.length>this.m_arrTalentSkill.length&&this.checkTalent(this.m_talent[this.m_arrTalentSkill.length])){this.p_nodeMax.active=!1,this.p_nodeBreakContent.active=!1,this.m_maxProLen=3;var o=app.db.getSkillInfoByGsid(this.m_talentSkill[this.m_arrTalentSkill.length]);if(o){this.p_nodeClass.active=!0,this.m_classInfo=app.db.getMythicalTalentInfoByClass(this.m_nowMid,this.m_arrTalentSkill.length);var s=app.db.getSkillPathByGsid(o.ICON);app.loadTexture(s,this.p_sprTalentSkill,this.prefabPath),this.p_labTalentName.string=o.NAME,this.p_labTalentIntro.string=o.INTRO,this.p_labTalentCostSelf.node.color=app.player.getCount(this.m_classInfo[0].GSID)>=this.m_classInfo[0].COUNT?this.m_colorCost:cc.Color.RED,this.p_labTalentCostSelf.string=gUtils.showNum(app.player.getCount(this.m_classInfo[0].GSID)),this.p_labTalentCost.string="/ "+gUtils.showNum(this.m_classInfo[0].COUNT);var p=app.db.getPropsIconPath(this.m_classInfo[0].GSID);app.loadTexture(p,this.p_sprTalentCost,this.prefabPath)}}else this.m_maxProLen=0,this.m_arrTalentSkill.length>3?(this.p_nodeMax.active=!0,this.refreshTalentMaxAttr(),this.p_nodeClass.active=!1,this.p_nodeBreakContent.active=!1):(this.p_nodeMax.active=!1,this.p_nodeClass.active=!1,this.p_nodeBreakContent.active=!0,this.p_arrNodeTupo.forEach(function(t,a){t.getComponent("tianFuItem").refreshUI(e.m_nowMid,e.m_arrTalentSkill.length,a)}))},refreshTalentMaxAttr:function(){for(var e={},t=0;t<this.m_talent.length;t++)for(var i=0;i<this.m_talent[t].length;i++)for(var n in this.m_talent[t][i].attr)e[n]||(e[n]=0),e[n]+=this.m_talent[t][i].attr[n];var r=[];for(var o in e)r.push({key:o,val:e[o]});for(var s=0;s<this.p_arrLabKey.length;s++)if(r[s]){var p=r[s].key,c=r[s].val;this.p_arrLabKey[s].node.active=!0,this.p_arrLabValue[s].node.active=!0,this.p_arrLabKey[s].string=langMgr.getString("godbeastPage",a[p]),this.p_arrLabValue[s].string="+"+c}else this.p_arrLabKey[s].node.active=!1,this.p_arrLabValue[s].node.active=!1},checkTalent:function(e){if(e.length<3)return!1;for(var t=0;t<e.length;t++){var a=e[t],i=app.db.getMythicalTalentInfo(this.m_nowMid,this.m_arrTalentSkill.length,t);if(!a||a.pro<i[0].MAXNUM)return!1}return!0},onClickMenu:function(e,t){if(app.playSound("click"),cc.log("now click menu index: ",e),this.m_numShowMenuIndex!=e||t){switch(this.m_numShowMenuIndex=e,this.p_arrNodePickMenu.forEach(function(t,a){t.active=a==e}),this.refreshInfo(),e){case 0:break;case 1:this.refreshHalo(),this.onClickHalo(this.m_nowHaloIndex,!0);break;case 2:this.p_maxLevel.active=!1,this.m_talent=[],this.m_arrTalentSkill=[],app.player.mythical[this.m_nowMid].talent&&(this.m_talent=app.player.mythical[this.m_nowMid].talent),app.player.mythical[this.m_nowMid].talentskill&&(this.m_arrTalentSkill=app.player.mythical[this.m_nowMid].talentskill),this.refreshTalent()}this.p_nodeInfo.active=0==e,this.p_nodeHalo.active=1==e,this.p_nodeTianfu.active=2==e,this.p_nodeCost.active=0==e||1==e,this.p_btnUp.node.active=0==e||1==e}},onSwitchGodBeast:function(e){this.m_nowMid=this.m_thicalBase[e],this.m_topIndex=e,this.m_nowHaloIndex=0,this.p_arrNodeMenu[1].active=!!app.player.mythical[this.m_nowMid],this.p_arrNodeMenu[2].active=!!app.player.mythical[this.m_nowMid]&&app.db.checkChannelShow("GODBEAST_TALENT"),this.refreshData(),app.player.mythical[this.m_nowMid]?this.onClickMenu(this.m_numShowMenuIndex||0,!0):this.onClickMenu(0,!0)},onClickHalo:function(e,t){(this.m_nowHaloIndex!=e||t)&&this.refreshHaloInfo(e)&&(this.m_nowHaloIndex=e,this.p_arrNodeHalo.forEach(function(t,a){var i=!(a!=e);t.getComponent("godbeastHaloItem").setPick(i)}))},onClickBtnUp:function(){var e=this;if(1!=this.m_numShowMenuIndex){var t=app.player.mythical[this.m_nowMid],a=t?this.m_objMData.level:0,i=t?this.m_objMData.class:0,n=t?langMgr.getString("godbeastPage",4):langMgr.getString("godbeastPage",3),r=app.db.getMythicLvCostByLv(a);if(1!=this.m_numBtnType&&(r=app.db.getMythicCCostByClass(i+1)),r){for(var o="",s=0;s<r.length;++s)if(r[s].GSID){var p=r[s].COUNT;app.player.getCount(r[s].GSID)<p&&(o+="\u3010"+app.db.getPropsName(r[s].GSID)+"\u3011")}if(o&&""!=o)return app.showNotice(langMgr.getString("godbeastPage",2,o)),void this.longPress.setStatus(!1);if(1==this.m_numBtnType)app.player.sfMythicalLv(this.m_nowMid,function(a){a?app.showNotice(a):(t||app.playSound("talenopen"),app.playSound("glevelup"),e.showLvUpAnim(),app.showNotice(n),app.loadEff("jiuguanchoujiang",e.p_skillAnim,1,.3),app.player.reduceItem(r),app.player.mythical[e.m_nowMid]?app.player.mythical[e.m_nowMid].level++:app.player.mythical[e.m_nowMid]={class:1,level:1,pskill:[1,0,0,0]},app.player.sfPlayerByParam(["others","mythical"],function(){e.refreshData(),e.refreshInfo()}))});else{var c={mid:this.m_nowMid,target:this};this.longPress.setStatus(!1),app.pages.windowspagegodbeastclass.showPage(c)}}else this.longPress.setStatus(!1)}else this.onClickBtnHaloUp()},onClassUp:function(){var e=this;app.player.sfMythicalClass(this.m_nowMid,function(t){t?app.showNotice(t):(e.showLvUpAnim(),app.loadEff("jiuguanchoujiang",e.p_skillAnim,1,.3),app.showNotice(langMgr.getString("godbeastPage",5)),app.player.sfPlayerData(function(){e.refreshData(),e.refreshInfo()}))})},onClickBtnHaloUp:function(){var e=this,t=this.m_objMBase.PSKILL[this.m_nowHaloIndex],a=this.m_objMData.pskill[this.m_nowHaloIndex];if(a>=app.db.getMythicPSkillMaxLv(this.m_objMData.class,this.m_nowHaloIndex))return app.showNotice(langMgr.getString("godbeastPage",6)),void this.longPress.setStatus(!1);var i=app.db.getSkillInfoByGsid(t,a+1).COST,n="";if(i){for(var r=0;r<i.length;++r)if(i[r].GSID){var o=i[r].COUNT;app.player.getCount(i[r].GSID)<o&&(n+="\u3010"+app.db.getPropsName(i[r].GSID)+"\u3011")}if(n&&""!=n)return app.showNotice(langMgr.getString("godbeastPage",2,n)),void this.longPress.setStatus(!1);app.player.sfMythicalPSkill(this.m_nowMid,this.m_nowHaloIndex,function(t){if(t)return app.showNotice(t),void e.longPress.setStatus(!1);app.playSound("glevelup"),e.showLvUpAnim(),app.loadEff("jiuguanchoujiang",e.p_arrHaloAnim[e.m_nowHaloIndex],1,.3),app.showNotice(langMgr.getString("godbeastPage",4)),app.player.sfPlayerData(function(){e.refreshData(),e.refreshHalo(),e.onClickHalo(e.m_nowHaloIndex,!0)})})}else this.longPress.setStatus(!1)},onClickBtnReset:function(){var e=(app.player.getCount(90350)||0)<1,t=app.player.getCount(38005);if(!e&&t<1e3)app.showNotice(langMgr.getString("godbeastPage",7,1e3));else{var a={content:e?langMgr.getString("godbeastPage",8):langMgr.getString("godbeastPage",9,1e3),confirmcb:this.resetCb,target:this};app.pages.windowspagetipsmsg.showPage(a)}},resetCb:function(){var e=this;app.player.sfMythicalReset(this.m_nowMid,function(t,a){if(t)app.showNotice(t);else{var i={showtype:1,reward:a,target:e};app.pages.windowspagereward.showPage(i),app.player.sfPlayerData(function(){e.refreshData(),e.refreshInfo(),e.onClickMenu(e.m_numShowMenuIndex,!0)})}})},showLvUpAnim:function(){var e=this;app.loadSpine("game_ui_spine/level_up/shengji",this.p_spLvUp,function(){cc.log("load succ"),e.p_spLvUp.setAnimation(0,"animation",!1)},null,this.prefabPath)},onClickBtnPreview:function(){app.pages.windowspagegodbeastpreview.showPage(this.m_nowMid)},onClose:function(){this._super()}});cc._RF.pop()},{basePage:void 0,dbProperty:void 0}],goldmidasPage:[function(e,t){"use strict";cc._RF.push(t,"e0bbfGs8WpOwq9/8MUeNRuN","goldmidasPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"goldmidaspage",pageType:1},properties:{arrItem:[e("goldmidasItem")],p_labReTime:cc.Label,p_labTitleTips:cc.Label,p_labReTimeTx:cc.Label},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.schedule(this.refreshTime,1),this.p_labTitleTips.string=langMgr.getString("goldmidasPage",0),this.p_labReTimeTx.string=langMgr.getString("goldmidasPage",1)},handleUI:function(){this._super()},setParam:function(){this.refreshData()},refreshUI:function(){var e=app.db.dbGold.INFO;this.arrItem.forEach(function(t,a){t.refreshUI(e[a],a)}),this.refreshTime()},refreshData:function(){var e=this,t=app.pages.goldmidaspage.instance;t&&cc.isValid(t.node)&&t.node.active&&app.player.sfPlayerByParam(["others"],function(){e.refreshUI()})},refreshTime:function(){for(var e=app.db.dbGold.REFRESH,t=new Date(app.player.getServerTime()),a=t.getHours(),i=new Date(t.getTime()+864e5).setHours(0,0,0,0),n=0;n<e.length;++n)if(a<e[n]){this.m_nowRefeshHour?this.m_nowRefeshHour!=e[n]&&(this.refreshData(),this.m_nowRefeshHour=e[n]):this.m_nowRefeshHour=e[n],i=t.setHours(e[n],0,0,0);break}var r=i-app.player.getServerTime();this.p_labReTime.string=gUtils.getHourMinSecTime(r/1e3)}});a.refreshRed=function(e){for(var t=app.db.dbGold.INFO,a=!1,i=0;i<t.length;++i){var n=t[i];if(app.player.getCount(n.MARK)<n.LIMIT){a=!0;break}}e.active=a},cc._RF.pop()},{basePage:void 0,goldmidasItem:void 0}],gongchengshengliPage:[function(e,t){"use strict";cc._RF.push(t,"963f7xKVIBJorILKVFGo+Pv","gongchengshengliPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"gongchengshenglipage"},properties:{p_mainAnim:cc.Animation,p_nodeMeizi:cc.Node,p_labDialog:cc.Label,p_labDialog_2:cc.Label,p_sprCamp:cc.Sprite,p_sprOccu:cc.Sprite,p_sprName:cc.Sprite,p_arrStar:[cc.Sprite],p_nodeAction:cc.Node,p_nodeNext:cc.Node,p_sprGeneral:cc.Sprite,p_spGeneral:sp.Skeleton,p_animGeneral:cc.Animation},onLoad:function(){a.instance=this,this._super(),this.refreshUI(),this.m_dialog=[langMgr.getString("gongchengshengliPage",1),langMgr.getString("gongchengshengliPage",2),langMgr.getString("gongchengshengliPage",3),langMgr.getString("gongchengshengliPage",4)]},handleUI:function(){var e=this;this._super(),this.nAniprog=0,this.bBgNode=!0,this.p_nodeAction.on("touchend",function(){e._gsid||e.nAniprog<1||e.bBgNode&&(e.bBgNode=!1,e.p_nodeMeizi.active=!1,e.p_nodeNext.active=!0,e.p_nodeAction.active=!1,e.p_mainAnim.play("animation_gongchengshengli_03"))}),this.p_mainAnim.on("finished",function(){e.nAniprog++})},setParam:function(e){this._gsid=e.gsid,this._cb=e.cb,this._gsid&&(this.showDeclarePage(),this.bBgNode=!1,this.p_nodeMeizi.active=!1,this.p_nodeNext.active=!0,this.p_nodeAction.active=!1,this.p_mainAnim.play("animation_gongchengshengli_03")),app.redDataServer.official&&app.redDataServer.official.srender++,localDataUtils.RemoveValue("prisonRed")},refreshUI:function(){this._gsid||(this.p_nodeMeizi.active=!1,this.p_nodeNext.active=!1,this.p_mainAnim.play("animation_gongchengshengli_01"))},showDeclarePage:function(){var e,t,a,i=this;this._gsid?a=app.db.getGBaseByGsid(this._gsid):(e=app.db.getMapInfo(app.player.maxmapid),t=app.db.getCityInfo(e.CITY),a=app.db.getGBaseByGsid(t.GENERAL));var n=app.db.getGNamePathHByGsid(a.GSID);app.loadTexture(n,this.p_sprName,this.prefabPath);var r=gConfig.getIconGOccuPath(a.OCCU-1);app.loadTexture(r,this.p_sprOccu,this.prefabPath);var o=gConfig.getIconGCampPath(a.CAMP-1);app.loadTexture(o,this.p_sprCamp,this.prefabPath),t?this.p_labDialog.string=langMgr.getString("gongchengshengliPage",0,[a.NAME]):(this.p_labDialog.node.active=!1,this.p_labDialog_2.node.active=!0,this.p_mainAnim.node.active=!0),app.loadGeneral(a.GSID,this.p_sprGeneral,this.p_spGeneral,this.p_animGeneral,null,this.prefabPath);var s=a.STAR,p=(s-1)%5;10==s&&(p=s%5);var c=gConfig.getIconGBigStarPath(a.STAR);this.p_arrStar.forEach(function(e,t){e.node.active=p>=t,app.loadTexture(c,e,i.prefabPath)});var h=gUtils.getRandomInt(0,this.m_dialog.length-1);this.p_labDialog_2.string=this.m_dialog[h],this.p_nodeMeizi.active=!0,this.p_nodeNext.active=!1},onClose:function(){this._super(),app.pages.newworldmappage.instance&&app.pages.newworldmappage.instance.refreshPrison(),this._cb&&this._cb()}});cc._RF.pop()},{basePage:void 0}],gppvpActivityYurePage:[function(e,t){"use strict";cc._RF.push(t,"6ca71tuQrROga+8LxVNzzw+","gppvpActivityYurePage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"gppvpactivityyurepage",pageType:1},properties:{p_btnHelp:cc.Button,p_sprNumLowReward:cc.Sprite,p_sprNumLowRewardSmal:cc.Sprite,p_sprNumHighestReward:cc.Sprite,p_barTargetItems:[cc.ProgressBar],p_nodeTargetItems:[cc.Node],p_sprTxSign:cc.Sprite,p_sprTxSigned:cc.Sprite,p_labSignCount:cc.Label,p_labTime:cc.Label,p_btnSign:cc.Button},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.creatMask(!0),this.m_canClick=!1,localDataUtils.SetValue("gppvpActivityYureRed",1,gUtils.getSecondDayTime(app.player.getServerTime()))},handleUI:function(){var e=this;this._super(),this.p_btnSign.node.on("click",function(){e.m_canClick&&(app.playSound("click"),e.onSign())}),this.p_btnHelp.node.on("click",function(){app.playSound("click"),app.pages.windowspagetipshelp.showPage("1098")})},onEnable:function(){this._super(),eventMgr.on(eventStr.commonEvent.RefreshTime,this.refreshTime,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.commonEvent.RefreshTime,this.refreshTime,this)},setParam:function(){var e=this;this.m_canClick=!1,app.player.sfGppvpPreInfo(function(){e.m_canClick=!0,e.refreshUI()})},refreshUI:function(){var e=app.gppvpPreData&&app.gppvpPreData.issign;this.p_btnSign.interactable=!e,this.p_btnSign.node.active=app.pages.gppvpactivityyurepage.isOpen(),this.p_sprTxSign.node.active=!e,this.p_sprTxSigned.node.active=e,this.p_labSignCount.string=langMgr.getString("gppvpActivityYurePage",0,app.gppvpPreData&&app.gppvpPreData.number?app.gppvpPreData.number:0),this.refreshBar()},refreshBar:function(){var e,t=this,a=app.gppvpPreData&&app.gppvpPreData.number?app.gppvpPreData.number:0,i=app.db.dbGPActivity;e=i.length>this.p_nodeTargetItems.length+1?i[this.p_nodeTargetItems.length]:i[i.length-1];var n=0;this.p_nodeTargetItems.forEach(function(r,o){var s=o+1,p=i[s],c=t.p_barTargetItems[o];if(p)if(r.active=!0,r.getComponent("gppvpActivityItem").setPick(a>=p.TARGET),r.getComponent("gppvpActivityItem").setLast(e==p),a>=p.TARGET)n=s,c&&(c.progress=1);else if(i[s-1].TARGET<=a){var h=(a-i[s-1].TARGET)/(p.TARGET-i[s-1].TARGET);h=Math.min(1,h),c&&(c.progress=h)}else c&&(c.progress=0);else r.active=!1});var r=i[n];app.loadTexture(gConfig.getGongPingActivityIcon("num_"+r.GUARANTEED+"_01"),this.p_sprNumLowReward,this.prefabPath),app.loadTexture(gConfig.getGongPingActivityIcon("num_"+r.GUARANTEED+"_02"),this.p_sprNumLowRewardSmal,this.prefabPath),app.loadTexture(gConfig.getGongPingActivityIcon("num_"+r.HIGHEST),this.p_sprNumHighestReward,this.prefabPath)},onSign:function(){var e=this;app.gppvpPreData&&app.gppvpPreData.issign||(this.m_canClick=!1,app.player.sfGppvpPreSign(function(t,a){if(e.m_canClick=!0,t)app.showNotice(t);else{app.player.addItem(a.reward);var i={showtype:1,reward:a.reward,target:e};app.pages.windowspagereward.showPage(i),app.gppvpPreData.number++,app.gppvpPreData.issign=1,e.refreshUI()}}))},refreshTime:function(){var e=new Date("2021-02-01 00:00:00").getTime()-app.player.getServerTime();this.p_labTime.string=gUtils.getCountDownStr(e),this.p_btnSign.node.active=app.pages.gppvpactivityyurepage.isOpen()}});a.refreshRed=function(e){var t=!1;return app.db.checkFuncUnLock("ACTIVITY_GONGPING_PVP")&&app.db.checkChannelShow("ACTIVITY_GONGPING_PVP")&&(t=!app.gppvpPreData&&!localDataUtils.GetValue("gppvpActivityYureRed",null)),e&&(e.active=t),t},a.isOpen=function(){var e=!1;return app.db.checkFuncUnLock("ACTIVITY_GONGPING_PVP")&&app.db.checkChannelShow("ACTIVITY_GONGPING_PVP")&&app.player.getServerTime()<new Date("2021-02-01 00:00:00").getTime()&&(e=!0),e},cc._RF.pop()},{basePage:void 0}],gppvpBuyTicketPage:[function(e,t){"use strict";cc._RF.push(t,"ff439XmuWJHuKF6XU28YdIe","gppvpBuyTicketPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"gppvpbuyticketpage",pageType:1},properties:{p_labTime:cc.Label,p_labTimeOver:cc.Label,p_labTitle:cc.Label,p_labContent:cc.Label,p_propItem:cc.Node,p_labCoin:cc.Label,p_labCost:cc.Label,p_sprCost:cc.Sprite,p_nodeFree:cc.Node,p_btnConfirm:cc.Button},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},onEnable:function(){this._super(),eventMgr.on(eventStr.commonEvent.RefreshTime,this.refreshTime,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.commonEvent.RefreshTime,this.refreshTime,this)},handleUI:function(){this._super()},onClickConfirm:function(){this.onClose(),this._data.confirmcb&&this._data.confirmcb.call(this._data.target,this._buyNum)},setParam:function(e){this._data=e,this._buyNum=e._buyNum,this.refreshUI()},refreshUI:function(){if(this.p_labTime.node.parent.active=!0,this.p_labTimeOver.node.active=!1,this.refreshTime(),this.p_propItem.active=!1,this._data.isprop){this.p_propItem.active=!0;var e={gsid:this._data.coin,count:this._buyNum};this.p_propItem.getComponent("propItem").initForBag(e)}this.p_labTitle.string=this._data.title,this.p_labCost.string=this._data.cost.COUNT,this.p_labCoin.string=app.player.getCount(this._data.cost.GSID);var t=this._data.cost.COUNT<=0;this.p_nodeFree.active=t,this.p_sprCost.node.active=!t,this.p_labCost.node.active=!t},refreshTime:function(){if(this.p_labTime&&this.p_labTime.node&&this.p_labTime.node.parent.active){var e=app.player.getServerTime(),t=app.player.getDayTimeBySet(10,0,0,0);this.p_labTime.string=gUtils.getCountDownStr(t-e);var a=app.lockFunConfig.GONGPING_PVP.settlementtime;new Date(e).getHours()>=10&&new Date(a).toDateString()==new Date(e).toDateString()&&(this.p_labTime.node.parent.active=!1,this.p_labTimeOver.node.active=!0)}}});cc._RF.pop()},{basePage:void 0}],gppvpChooseFetterPage:[function(e,t){"use strict";cc._RF.push(t,"85bbebIS7NKvr5hfVd+1FZ8","gppvpChooseFetterPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"gppvpchoosefetterpage",pageType:1},properties:{p_labChooseCount:cc.Label,p_btnChoose:cc.Button,p_btnBack:cc.Button,p_tutorItem:cc.Node,p_nodeFetters:[cc.Node],p_btnFetters:[cc.Button]},onLoad:function(){a.instance=this,this.fitTopMenu(),this._super()},onEnable:function(){this._super()},onDisable:function(){this._super()},handleUI:function(){var e=this;this._super(),this.p_btnChoose.node.on("click",function(){if(app.playSound("click"),2==app.gppvpData.chooseFetter.length){var t=app.gppvpData.getChooseParam();app.player.sfGppvpChooseTF(t,function(t){t?app.showNotice(t):(app.gppvpData.save(),e.onClose(),app.pages.gppvpchoosepage.showPage())})}else app.showNotice(langMgr.getString("gppvpChooseFetterPage",0))}),this.p_btnBack.node.on("click",function(){app.playSound("click"),e.onClose(),app.pages.gppvpchoosetutorpage.showPage()}),this.p_nodeFetters.forEach(function(t,a){t.on("touchend",function(){app.playSound("interfaceopen02"),e.menuHandle(a)})}),this.p_btnFetters.forEach(function(t,a){t.node.on("click",function(){app.playSound("click"),e.onClickFetter(a)})})},setParam:function(){this.m_chooseFetter=[],app.gppvpData.chooseFetter.length>0&&(this.m_chooseFetter=app.gppvpData.chooseFetter),this.refreshUI()},menuHandle:function(e){var t=e+1;app.gppvpData.setChooseFetter(t),this.m_chooseFetter=app.gppvpData.chooseFetter,this.refreshUI()},onClickFetter:function(e){var t=app.db.dbGPGeneral[e+1]?app.db.dbGPGeneral[e+1]:[];app.pages.windowspageshowgenerallist.showPage({gemerallist:t})},refreshUI:function(){var e=this;this.p_nodeFetters.forEach(function(e){e.getChildByName("pick").active=!1}),this.m_chooseFetter.forEach(function(t){var a=t-1;e.p_nodeFetters[a]&&(e.p_nodeFetters[a].getChildByName("pick").active=!0)}),this.p_labChooseCount.string=langMgr.getString("gppvpChooseFetterPage",1,this.m_chooseFetter.length),this.p_tutorItem.getComponent("gppvpChooseTutorItem").refreshUI(app.gppvpData.chooseTutorid,this)},onDestroy:function(){this._super()}});a.refreshRed=function(e){return e&&(e.active=!1),!1},a.showPage=function(){e("basePage").showPage.call(this,!0)},cc._RF.pop()},{basePage:void 0}],gppvpChoosePage:[function(e,t){"use strict";cc._RF.push(t,"9b8f3LesmNGj5w1LdZntjjJ","gppvpChoosePage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"gppvpchoosepage",pageType:1},properties:{p_nodeCards:[cc.Node],p_cardHero:[cc.Sprite],p_quailtyHero:[cc.Node],p_cardCampNodes:[cc.Node],p_nodeDes:cc.Node,p_labGeneralDes:[cc.Label],p_btnGeneralShow:[cc.Button],p_btnRefreshCard:cc.Button,p_btnChooseCard:cc.Button,p_labRefreshCount:cc.Label,p_labChooseCount:cc.Label,p_generalNodes:[cc.Node],p_chooseSkeletonAni:sp.Skeleton,p_tutorItem:cc.Node},onLoad:function(){a.instance=this,this.fitTopMenu(),this._super(),this.m_canClick=!0},onEnable:function(){this._super()},onDisable:function(){this._super()},handleUI:function(){var e=this;this._super(),this.p_nodeCards.forEach(function(t,a){t.on("touchend",function(){e.m_canClick&&a!=e.m_index&&(app.playSound("interfaceopen02"),e.checkCard(a))})}),this.p_btnGeneralShow.forEach(function(t,a){t.node.on("click",function(){app.playSound("click"),e.m_canClick&&e.showGeneral(a)})}),this.p_btnChooseCard.node.on("click",function(){app.playSound("click"),e.m_canClick&&(e.m_index<0?app.showNotice(langMgr.getString("gppvpChoosePage",0)):app.gppvpData.generals>=10?app.showNotice(langMgr.getString("gppvpChoosePage",1)):e.chooseGeneral())}),this.p_btnRefreshCard.node.on("click",function(){app.playSound("click"),e.m_canClick&&(e.m_data.forcecount&&e.m_data.forcecount>0?e.refreshCard():app.showNotice(langMgr.getString("gppvpChoosePage",2)))}),this.p_chooseSkeletonAni.setCompleteListener(function(){e.p_chooseSkeletonAni.node.active=!1})},setParam:function(e){this.m_data=e,this.refreshUI(),this.cardAni()},refreshUI:function(){var e=this;this.m_data.generals&&(this.m_data.generals.forEach(function(t,a){var i=t.gsid,n=app.db.getGBaseByGsid(i);if(e.p_cardHero[a]){var r=app.db.getGCardPathByGsid(i);app.loadTexture(r,e.p_cardHero[a],e.prefabPath,function(){})}e.p_quailtyHero[a]&&e.p_quailtyHero[a].getChildByName("GeneralNumLayout").getComponent("num").init(n.TGRADE),e.p_labGeneralDes[a]&&(e.p_labGeneralDes[a].string=t.des),e.p_cardCampNodes[a]&&(app.loadTexture(gConfig.getIconGCampPath(n.CAMP-1),e.p_cardCampNodes[a].getChildByName("camp").getComponent(cc.Sprite),e.prefabPath,function(){}),app.loadTexture(gConfig.getIconGOccuPath(n.OCCU-1),e.p_cardCampNodes[a].getChildByName("occu").getComponent(cc.Sprite),e.prefabPath,function(){}))}),this.p_labRefreshCount.string=this.m_data.forcecount||0,this.p_labChooseCount.string=langMgr.getString("gppvpChoosePage",3,app.gppvpData.chooseGenerals.length),this.p_generalNodes.forEach(function(e,t){app.gppvpData.chooseGenerals&&app.gppvpData.chooseGenerals[t]?e.getComponent("gppvpChooseGeneralItem").refreshUI(app.gppvpData.chooseGenerals[t]):e.getComponent("gppvpChooseGeneralItem").setEmpty()}),this.p_tutorItem.getComponent("gppvpChooseTutorItem").refreshUI(app.gppvpData.chooseTutorid,this),this.p_tutorItem.getComponent("gppvpChooseTutorItem").setOutLine())},refreshCard:function(e){var t=this;void 0===e&&(e=1),app.player.sfGppvpCardInfo({force:e},function(e,a){if(e)return app.showNotice(e),void t.onClose();t.m_data=a,t.cardAni(!1)})},checkCard:function(e){void 0===e&&(e=-1),this.p_nodeCards.forEach(function(e){e.y=123,e.scale=.7,e.getChildByName("pick").active=!1}),this.m_index=e,this.p_nodeCards[e]&&(this.p_nodeCards[e].getChildByName("pick").active=!0,this.p_nodeCards[e].y=153,this.p_nodeCards[e].scale=.8)},cardAni:function(e){var t=this;void 0===e&&(e=!0),this.m_canClick=!1,this.checkCard(),this.showOver=0,this.animalLimit=0,this.p_nodeDes.active=!1;var a=e?"animation_drawcard_open":"animation_drawcard_close";this.p_nodeCards.forEach(function(i){i.y=123,i.scale=.7;var n=i.getChildByName("drawcard").getComponent(cc.Animation);n&&(n.play(a),e?(n.once("finished",t.onShowCardFinished,t),t.animalLimit++):(n.once("finished",t.onCloseCardFinished,t),t.animalLimit++))})},showGeneral:function(e){var t=this.m_data.generals[e];t.sourceType=1,t.isShowMode=!0,app.pages.generalpage.showPage(t)},chooseGeneral:function(){var e=this;this.m_canClick=!1,app.player.sfGppvpChooseCard({pos:this.m_index},function(t){if(t)return app.showNotice(t),void(e.m_canClick=!0);app.gppvpData.insertGeneral(e.m_data.generals[e.m_index]),e.p_chooseSkeletonAni.node.x=240*(e.m_index-1)-10,e.p_chooseSkeletonAni.node.active=!0,e.p_chooseSkeletonAni.setAnimation(0,"animation",!1);var a=app.gppvpData.chooseGenerals.length-1,i=e.p_generalNodes[a],n=e.p_nodeCards[e.m_index].convertToWorldSpaceAR(cc.Vec2.ZERO);i.getComponent("gppvpChooseGeneralItem").beginMove(n,app.gppvpData.chooseGenerals[a],function(){10==app.gppvpData.generals.length?(e.onClose(),app.pages.gppvpchooseresultpage.showPage(),app.player.sfGppvpInfo(function(){})):e.refreshCard(0)})})},onShowCardFinished:function(){this.showOver++,this.showOver>=this.animalLimit&&(this.m_canClick=!0,this.p_nodeDes.active=!0)},onCloseCardFinished:function(){this.showOver++,this.showOver>=this.animalLimit&&(this.m_canClick=!0,this.refreshUI(),this.cardAni())},getGeneralItem:function(){return this.p_generalNodes[app.chooseGeneral.length-1]},onDestroy:function(){this._super()}});a.refreshRed=function(e){return e&&(e.active=!1),!1},a.showPage=function(){var t=this;app.player.sfGppvpCardInfo({force:0},function(a,i){e("basePage").showPage.call(t,i)})},cc._RF.pop()},{basePage:void 0}],gppvpChooseResultPage:[function(e,t){"use strict";cc._RF.push(t,"d81f5bX1OlKV7fyGCWS7Fvb","gppvpChooseResultPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"gppvpchooseresultpage",pageType:1},properties:{p_cardAni:[cc.Node],p_cardHero:[cc.Sprite],p_quailtyHero:[cc.Node]},onLoad:function(){a.instance=this,this.fitTopMenu(),this._super()},onEnable:function(){this._super()},onDisable:function(){this._super()},handleUI:function(){this._super()},onDestroy:function(){this._super()},setParam:function(){app.playSound("gpjjcresult"),this.refreshUI()},refreshUI:function(){var e=this;if(this.m_index=-1,app.gppvpData.generals.forEach(function(t,a){var i=t.gsid;if(e.p_cardHero[a]){var n=app.db.getGCardPathByGsid(i);app.loadTexture(n,e.p_cardHero[a],e.prefabPath,function(){})}if(e.p_quailtyHero[a]){var r=e.p_quailtyHero[a].getChildByName("GeneralNumLayout"),o=app.db.getGBaseByGsid(i);r.getComponent("num").init(o.TGRADE)}e.p_cardAni[a]&&e.scheduleOnce(function(){var t=e.p_cardAni[a].getComponent(cc.Animation);t&&t.play("animation_drawcard_open")},.3),e.m_index=a}),this.p_cardAni.length-1>this.m_index)for(var t=this.m_index+1;t<this.p_cardAni.length;t++)this.p_cardAni[t].active=!1}});a.refreshRed=function(e){return e&&(e.active=!1),!1},a.showPage=function(){e("basePage").showPage.call(this,!0)},cc._RF.pop()},{basePage:void 0}],gppvpChooseTutorPage:[function(e,t){"use strict";cc._RF.push(t,"91346r9/F5Cd4ykjvPHonUQ","gppvpChooseTutorPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"gppvpchoosetutorpage",pageType:1},properties:{p_tutorNodes:[cc.Node],p_nextChooseBtn:cc.Button,p_tutorItem:cc.Node},onLoad:function(){var e=this;a.instance=this,this.fitTopMenu(),this._super(),this.handleUI(),this.m_canClick=!1,this.roundList=[0,1,2,3,4],this.zIndexList=[40,30,20,10,30],this.nodeList=[],this.posList=[],this.scaleList=[],this.p_tutorNodes.forEach(function(t){e.nodeList.push(t),e.posList.push(t.position),e.scaleList.push(t.scale)})},onEnable:function(){this._super()},onDisable:function(){this._super()},handleUI:function(){var e=this;this._super(),this.p_tutorNodes.forEach(function(t,a){t.on("touchend",function(){e.m_canClick&&(app.playSound("interfaceopen02"),e.m_canClick=!1,e.chooseTutor(a))})}),this.p_nextChooseBtn.node.on("click",function(){if(e.m_canClick)if(app.playSound("click"),e.m_index<0)app.showNotice(langMgr.getString("gppvpChooseTutorPage",0));else{e.m_canClick=!1;var t=3==e.m_index?5:e.m_index;app.gppvpData.chooseTutorid=t,e.onClose(),app.pages.gppvpchoosefetterpage.showPage()}})},setParam:function(){this.m_index=0,this.m_canClick=!0,app.gppvpData.chooseTutorid>=0&&(this.m_index=5==app.gppvpData.chooseTutorid?3:app.gppvpData.chooseTutorid),this.initTutor(this.m_index),this.refreshUI()},initTutor:function(e){var t=this;if(this.p_tutorNodes.forEach(function(e){e.getChildByName("pick").active=!1}),!(e<0)&&(this.p_tutorNodes[e].getChildByName("pick").active=!0,0!=e)){this.indexKey=this.roundList.indexOf(this.m_index);var a=this.roundList[this.indexKey],i=this.indexKey+1>=5?this.roundList[this.indexKey-4]:this.roundList[this.indexKey+1],n=this.indexKey+2>=5?this.roundList[this.indexKey-3]:this.roundList[this.indexKey+2],r=this.indexKey+3>=5?this.roundList[this.indexKey-2]:this.roundList[this.indexKey+3],o=this.indexKey+4>=5?this.roundList[this.indexKey-1]:this.roundList[this.indexKey+4];this.roundList=[a,i,n,r,o],this.roundList.forEach(function(e,a){var i=t.p_tutorNodes[e];i.zIndex=t.zIndexList[a],i.position=t.posList[a],i.scale=t.scaleList[a]})}},chooseTutor:function(e){this.p_tutorNodes.forEach(function(e){e.getChildByName("pick").active=!1}),this.p_tutorNodes[e].getChildByName("pick").active=!0,this.m_index=e,this.roundList[0]!=e?this.roundBegin():(this.m_canClick=!0,this.refreshUI())},roundBegin:function(){this.isClockwise=3==this.roundList.indexOf(this.m_index)||4==this.roundList.indexOf(this.m_index),this.roundMove(this.isClockwise)},roundMove:function(e){var t=this,a=e?this.roundList[4]:this.roundList[1],i=e?this.roundList[0]:this.roundList[2],n=e?this.roundList[1]:this.roundList[3],r=e?this.roundList[2]:this.roundList[4],o=e?this.roundList[3]:this.roundList[0];this.roundList=[a,i,n,r,o],this.actionCount=0,this.roundList.forEach(function(e,a){var i=t.p_tutorNodes[e];i.zIndex=t.zIndexList[a],i.runAction(cc.sequence(cc.spawn(cc.moveTo(.3,t.posList[a]),cc.scaleTo(.3,t.scaleList[a])),cc.callFunc(t.roundComplete,t)))})},roundComplete:function(){this.actionCount++,this.actionCount>=5&&(this.roundList[0]!=this.m_index?this.roundBegin():(this.m_canClick=!0,this.refreshUI()))},refreshUI:function(){var e=3==this.m_index?5:this.m_index;this.p_tutorItem.getComponent("gppvpChooseTutorItem").refreshUI(e,this),this.p_tutorItem.getComponent("gppvpChooseTutorItem").setClick(!1)},onDestroy:function(){this._super()}});a.refreshRed=function(e){return e&&(e.active=!1),!1},a.showPage=function(){e("basePage").showPage.call(this,!0)},cc._RF.pop()},{basePage:void 0}],gppvpFightPage:[function(e,t){"use strict";cc._RF.push(t,"c59f2wgMH9D/IjQ21c88qlW","gppvpFightPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"gppvpfightpage",pageType:1},properties:{p_leftPlayerInfo:cc.Node,p_rightPlayerInfo:cc.Node,p_fightSkeletonAni:sp.Skeleton},onLoad:function(){var e=this;a.instance=this,this.fitTopMenu(),this._super(),this.p_fightSkeletonAni.setCompleteListener(function(){e.scheduleOnce(function(){e.onClose(),e.beginFight()},1)})},onEnable:function(){this._super()},onDisable:function(){this._super()},handleUI:function(){this._super()},onDestroy:function(){this._super()},setParam:function(){this.refreshUI()},refreshUI:function(){this.p_leftPlayerInfo.getComponent("gppvpRankItem").refreshUI(0,{rname:app.player.rname,headid:app.player.headid,iconid:app.player.iconid,imageid:app.player.imageid,point:app.gppvpData.point,level:app.player.level,vip:app.player.vip,sex:app.player.sex},!1),this.p_rightPlayerInfo.getComponent("gppvpRankItem").refreshUI(0,{rname:app.gppvpData.enemyPlayer.rname,headid:app.gppvpData.enemyPlayer.headid,level:app.gppvpData.enemyPlayer.level,point:app.gppvpData.enemyPlayer.point,vip:app.gppvpData.enemyPlayer.vip,sex:app.gppvpData.enemyPlayer.sex},!1),this.p_leftPlayerInfo.runAction(cc.moveTo(.3,cc.v2(-120,this.p_leftPlayerInfo.y))),this.p_rightPlayerInfo.runAction(cc.moveTo(.3,cc.v2(120,this.p_rightPlayerInfo.y))),app.playSound("gpjjcvs"),this.p_fightSkeletonAni.setAnimation(0,"animation",!1)},beginFight:function(){if(2==app.pages.gppvppage.getState()){app.battleType="gppvp";var e=app.gppvpData.gpeff||{id:2171};app.leftCards=[e],app.rightCards=[e],app.goToNormBattle()}else app.showNotice(langMgr.getString("gppvpPage",7))}});cc._RF.pop()},{basePage:void 0}],gppvpInfoPage:[function(e,t){"use strict";cc._RF.push(t,"4029emkDA5AdpOeQlFeFv9Z","gppvpInfoPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"gppvpinfopage",pageType:1},properties:{p_nodeGenerals:[cc.Node],p_btnReset:cc.Button,p_nodeBuffs:cc.Node,p_pfbBuffItem:cc.Node,p_tutorItem:cc.Node,p_buffItem:cc.Node},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.m_arrfetters=[],this.m_arrfetters.push(this.p_pfbBuffItem)},onEnable:function(){this._super()},onDisable:function(){this._super()},handleUI:function(){this._super(),this.p_btnReset.node.on("click",function(){app.playSound("click"),app.pages.gppvpresettippage.showPage()})},onDestroy:function(){this._super()},setParam:function(){this.refreshUI()},refreshUI:function(){var e=this;this.p_nodeGenerals.forEach(function(e,t){if(e.targetOff(),app.gppvpData.generals&&app.gppvpData.generals[t]){var a=app.db.getGBaseByGsid(app.gppvpData.generals[t].gsid);e.getComponent("generalPortraitItem").initReport(a,app.gppvpData.generals[t]),e.getComponent("generalPortraitItem").p_labName.string=a.NAME,e.getComponent("generalPortraitItem").p_labName.node.active=!0,e.on("touchend",function(){var e=app.gppvpData.generals[t];e.sourceType=1,e.isShowMode=!0,app.pages.generalpage.showPage(e)}),e.active=!0}else e.active=!1}),this.p_tutorItem.getComponent("gppvpChooseTutorItem").setColor("#038400"),this.p_tutorItem.getComponent("gppvpChooseTutorItem").refreshUI(app.gppvpData.chooseTutorid,this),this.p_tutorItem.getComponent("gppvpChooseTutorItem").setClick(!1),this.p_buffItem.getComponent("gppvpChooseBuffItem").setColor("#038400"),app.gppvpData.generals?function(){var t=app.gppvpData.getGeneralGsidArr(),a=app.getFettersByGsidArr(t);a.sort(function(e,t){return t.num-e.num});for(var i=0,n=function(t){if(a[t].level<=0)return"continue";var n=e.m_arrfetters[i];n||((n=cc.instantiate(e.p_pfbBuffItem)).parent=e.p_nodeBuffs,e.m_arrfetters.push(n)),n.active=!0,n.targetOff(),n.getComponent("fetterItem").initUI(a[t]),n.on("touchend",function(){e.onClickFetter(a[t])}),i++},r=0;r<a.length;++r)n(r);for(var o=i;o<e.m_arrfetters.length;++o)e.m_arrfetters[o].active=!1;e.p_nodeBuffs.active=!0}():this.p_nodeBuffs&&(this.p_nodeBuffs.active=!1),this.p_btnReset.node.active=2==app.pages.gppvppage.getState()},onClickFetter:function(e){e.camp?app.pages.windowspagetipscamp.showPage({camp:e.camp}):app.pages.windowspagetipsoccu.showPage({occu:e.occu})},onClose:function(){this._super()}});a.refreshRed=function(e){return e&&(e.active=!1),!1},a.showPage=function(){e("basePage").showPage.call(this,!0)},cc._RF.pop()},{basePage:void 0}],gppvpMissionPage:[function(e,t){"use strict";cc._RF.push(t,"0e489rA9uNDY4jKrVTLPOKw","gppvpMissionPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"gppvpmissionpage",pageType:1},properties:{p_tabvDaily:cc.tableView,p_labTime:cc.Label},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){this._super()},setParam:function(){this.m_arrShowData=this.setDailyData(),this.refreshUI()},setDailyData:function(){for(var e=[],t=app.db.dbGPMissionDaily,a=0;a<t.length;++a){var i=t[a];i.PMARK&&"all"!=i.PMARK&&(i.ID=a,e.push(i))}return e.sort(function(e,t){var a=app.player.getMissionState(e).state,i=app.player.getMissionState(t).state;return a<i?1:a==i&&e.ID>t.ID?1:-1}),e},refreshUI:function(){if(this.m_arrShowData){var e=this.m_arrShowData.length;this.p_tabvDaily.getComponent("tableView").initTableView(e,{array:this.m_arrShowData,target:this})}},reloadView:function(){this.m_arrShowData&&(this.m_arrShowData=this.setDailyData(),this.p_tabvDaily.getComponent("tableView").reload({array:this.m_arrShowData,target:this}))},refreshDailyAll:function(){}});a.refreshRed=function(e){for(var t=app.db.dbGPMissionDaily,a=!1,i=0;i<t.length;++i){var n=t[i];if(3==app.player.getMissionState(n).state){a=!0;break}}return e&&(e.active=a),a},cc._RF.pop()},{basePage:void 0}],gppvpPage:[function(e,t){"use strict";cc._RF.push(t,"81e5e+y3wRNqLvIsUJUKM0W","gppvpPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"gppvppage"},properties:{p_btnHelp:cc.Button,p_btnReward:cc.Button,p_btnAddCost:cc.Button,p_btnFight:cc.Button,p_btnInfo:cc.Button,p_btnRecord:cc.Button,p_btnSkinShop:cc.Button,p_btnMission:cc.Button,p_btnPreActivity:cc.Button,p_rankNode:cc.Node,p_buffNode:cc.Node,p_tipsNode:cc.Node,p_nodeView:cc.Node,p_selfRankNode:cc.Node,p_sprTxMatch:cc.Sprite,p_sprTxCreate:cc.Sprite,p_sprTxAuth:cc.Sprite,p_sprNoCompete:cc.Sprite,p_sprOtherPlayerBind:cc.Sprite,p_labCoinCount:cc.Label,p_nodeLoading:cc.Node,p_nodeMaskLoading:cc.Node,p_arrSprLoadPoint:[cc.Sprite],p_btnCancel:cc.Button,p_labTime:cc.Label,p_labTimeTip:cc.Label,p_labTimeCoin:cc.Label},onLoad:function(){a.instance=this,this.fitTopMenu(),this._super(),this.m_canClick=!1,this.p_nodeLoading.active=!1,this._bMatchLoading=!1,this._secTimer=0,this._timeCount=0,this._bMatchEnd=!1,this._lastState=0},onEnable:function(){this._super(),eventMgr.on(eventStr.gppvpEvent.RefreshInfo,this.refreshUI,this),eventMgr.on(eventStr.redEvent.RefreshGongPingPageRed,this.refreshRed,this),eventMgr.on(eventStr.commonEvent.RefreshTime,this.refreshTime,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.gppvpEvent.RefreshInfo,this.refreshUI,this),eventMgr.off(eventStr.redEvent.RefreshGongPingPageRed,this.refreshRed,this),eventMgr.off(eventStr.commonEvent.RefreshTime,this.refreshTime,this)},handleUI:function(){var e=this;this._super(),this.p_btnHelp.node.on("click",function(){e.m_canClick&&(app.playSound("click"),app.pages.windowspagetipshelp.showPage("1095"))}),this.p_btnReward.node.on("click",function(){e.m_canClick&&(app.playSound("click"),app.pages.gppvprewardpage.showPage())}),this.p_btnAddCost.node.on("click",function(){e.m_canClick&&(app.playSound("click"),e.onClickPlus())}),this.p_btnFight.node.on("click",function(){e.m_canClick&&(1==e.m_playerstate?2==app.pages.gppvppage.getState()?(app.playSound("click"),app.gppvpData.isCreatorCard()?e.matchEnemy():app.pages.gppvpchoosetutorpage.showPage()):(app.showNotice(langMgr.getString("gppvpPage",7)),e.refreshUI()):e.m_playerstate)}),this.p_btnInfo.node.on("click",function(){e.m_canClick&&(app.playSound("click"),app.gppvpData.isCreatorCard()?app.pages.gppvpinfopage.showPage():app.showNotice(langMgr.getString("gppvpPage",6)))}),this.p_btnRecord.node.on("click",function(){e.m_canClick&&(app.playSound("click"),app.pages.gppvpreplaypage.showPage())}),this.p_btnSkinShop.node.on("click",function(){e.m_canClick&&(app.playSound("click"),e.onClose(),app.pages.shoppage.showPage("skin"))}),this.p_btnMission.node.on("click",function(){e.m_canClick&&(app.playSound("click"),app.pages.gppvpmissionpage.showPage())}),this.p_btnCancel.node.on("click",function(){app.playSound("click"),e._timeCount=0,e._bMatchEnd=!1,e._bMatchLoading=!1,e.p_nodeLoading.active=!1}),this.p_btnPreActivity.node.on("click",function(){e.m_canClick&&(app.playSound("click"),app.pages.gppvpactivityyurepage.showPage())})},setParam:function(){this.m_canClick=!1,this.m_coinRefresh=!1,this.m_playerstate=0,this.initData(),this.refreshRed()},initData:function(){var e=this;app.player.sfGppvpInfo(function(t){if(app.pages.gppvppage.instance&&cc.isValid(app.pages.gppvppage.instance.node)){if(t)return app.showNotice(langMgr.getString("gppvpPage",1)),void app.pages.gppvppage.instance.onClose();e.refreshCoin(),!app.gppvpData.isCreatorCard()&&app.gppvpData.tutorid>=0&&app.pages.gppvpchoosepage.showPage()}},!0)},refreshUI:function(){this.m_canClick=!0,this.m_playerstate=app.pages.gppvppage.getPlayerState(),this.creatorCard=app.gppvpData.isCreatorCard();var e=2==app.pages.gppvppage.getState()&&this.creatorCard||3==app.pages.gppvppage.getState()||0==this.m_playerstate||2==this.m_playerstate||3==this.m_playerstate;this.p_rankNode.active=e;var t=2==app.pages.gppvppage.getState()&&!this.creatorCard&&1==this.m_playerstate;this.p_buffNode.active=t,this.p_labCoinCount.string=app.player.getCount(38016),e&&this.refreshRank(),t&&this.refreshBuff(),this.refreshBtn()},refreshRank:function(){var e=this;app.player.sfRankByType("pvpequal",function(t,a){if(cc.isValid(e.node))if(t)app.showNotice(langMgr.getString("gppvpPage",2));else{1==e.m_playerstate?(e.p_selfRankNode.parent.active=!0,e.p_nodeView.getComponent(cc.Widget).bottom=-364,e.p_nodeView.getComponent(cc.Widget).updateAlignment(),e.p_nodeView.getComponentInChildren(cc.Widget).updateAlignment()):(e.p_selfRankNode.parent.active=!1,e.p_nodeView.getComponent(cc.Widget).bottom=-540,e.p_nodeView.getComponent(cc.Widget).updateAlignment(),e.p_nodeView.getComponentInChildren(cc.Widget).updateAlignment());var i=1;a&&(app.gppvpData.rank=a,e.p_nodeView.getComponent("tableView").initTableView(app.gppvpData.rank.list.length,{array:app.gppvpData.rank.list,target:e}),i=app.gppvpData.rank.selfrank),e.p_tipsNode.active=!app.gppvpData||!app.gppvpData.rank||!app.gppvpData.rank.list||app.gppvpData.rank.list.length<=0,1==e.m_playerstate&&e.p_selfRankNode.getComponent("gppvpRankItem").refreshUI(i,{rname:app.player.rname,headid:app.player.headid,iconid:app.player.iconid,imageid:app.player.imageid,servid:app.player.servid,level:app.player.level,point:app.gppvpData.point,vip:app.player.vip,sex:app.player.sex,rid:app.player.id})}}),2==!app.pages.gppvppage.getState()&&1==this.m_playerstate&&app.player.sfGpSearchEnemy({refresh:0},function(e,t){t&&app.gppvpData.setEnemyPlayer(t)})},setRankData:function(e){var t=app.gppvpData.maxRankCount,a={list:[],selfrank:app.gppvpData.myRankInit},i=0;if(!e||!e.list||e.list.length<=0)return a;var n=e.list,r=e.selfrank,o=-1;if(n.length>t&&n[n.length-1].point>app.gppvpData.point)r=app.gppvpData.myRankInit;else{var s=-1;n.forEach(function(e,t){if(e.rid==app.player.id)return s=t,void(i=e.lastchangetime||0)}),s>=0&&n.splice(s,1),n.forEach(function(e,t){o<0&&e.point<=app.gppvpData.point&&(o=t)}),0!=app.gppvpData.point&&n.length<t&&o<0&&(o=n.length),r=o<0?app.gppvpData.myRankInit:o+1}return o>=0&&(n.splice(o,0,{rname:app.player.rname,headid:app.player.headid,iconid:app.player.iconid,imageid:app.player.imageid,servid:app.player.servid,level:app.player.level,point:app.gppvpData.point,vip:app.player.vip,sex:app.player.sex,rid:app.player.id,lastchangetime:i}),n.length>t&&n.pop()),a.list=n,a.selfrank=r,a},refreshRed:function(){app.pages.gppvpmissionpage.refreshRed(this.p_btnMission.node.getChildByName("rednotice"))},refreshBuff:function(){},refreshBtn:function(){this.p_sprTxMatch.node.active=this.creatorCard&&1==this.m_playerstate,this.p_sprTxCreate.node.active=!this.creatorCard&&1==this.m_playerstate,this.p_sprTxAuth.node.active=3==this.m_playerstate,this.p_btnFight.node.active=2==app.pages.gppvppage.getState()&&(1==this.m_playerstate||3==this.m_playerstate),this.p_btnAddCost.node.parent.active=2==app.pages.gppvppage.getState()&&1==this.m_playerstate,this.p_sprNoCompete.node.active=0==this.m_playerstate,this.p_sprOtherPlayerBind.node.active=2==this.m_playerstate,this.p_btnRecord.node.active=(2==app.pages.gppvppage.getState()||3==app.pages.gppvppage.getState())&&1==this.m_playerstate,this.p_btnMission.node.active=(2==app.pages.gppvppage.getState()||3==app.pages.gppvppage.getState())&&1==this.m_playerstate,this.p_btnInfo.node.active=(2==app.pages.gppvppage.getState()||3==app.pages.gppvppage.getState())&&1==this.m_playerstate},matchEnemy:function(){var e=this,t=0;if(app.gppvpData.enemyPlayer&&app.gppvpData.enemyPlayer.status){if(!(app.player.getCount(38016)>0))return void app.showNotice(langMgr.getString("gppvpPage",3));t=1}if(this._bMatchLoading=!0,this.p_nodeLoading.active=!0,this.p_arrSprLoadPoint.forEach(function(e){e.node.active=!1}),!app.gppvpData.enemyPlayer||0==Object.keys(app.gppvpData.enemyPlayer.battleset).length||app.gppvpData.enemyPlayer&&app.gppvpData.enemyPlayer.status){var a={refresh:t};app.player.sfGpSearchEnemy(a,function(a,i){if(a)return e._timeCount=0,e._bMatchEnd=!1,e._bMatchLoading=!1,e.p_nodeLoading.active=!1,void app.showNotice(langMgr.getString("gppvpPage",11));i&&(app.gppvpData.setEnemyPlayer(i),t&&app.player.reduceItem({gsid:38016,count:1}),e._bMatchEnd=!0)})}else this._bMatchEnd=!0},update:function(e){this._bMatchLoading&&(this._secTimer+=e,this._secTimer>=1&&(this._secTimer=0),this._timeCount+=e,this._bMatchEnd&&this._timeCount>=1&&(this._timeCount=0,this._bMatchEnd=!1,this._bMatchLoading=!1,this.p_nodeLoading.active=!1,this.showMatchPage()),this._timeCount>10&&(this._timeCount=0,this._bMatchEnd=!1,this._bMatchLoading=!1,this.p_nodeLoading.active=!1,app.showNotice("\u914d\u5f02\u5e38\uff0c\u8d85\u65f6\u9000\u51fa!")))},showMatchPage:function(){app.pages.gppvpfightpage.showPage()},onClickPlus:function(){var e=app.db.dbGPBuyCast[app.db.dbGPBuyCast.length-1];app.db.dbGPBuyCast[app.gppvpData.coin.buytime]&&(e=app.db.dbGPBuyCast[app.gppvpData.coin.buytime]);var t={title:langMgr.getString("gppvpPage",4),isprop:!0,cost:e.CAST[0],coin:38016,_buyNum:30,confirmcb:this.buyCb,target:this};app.pages.gppvpbuyticketpage.showPage(t)},buyCb:function(){app.player.sfGpBuyCoin({count:5},function(e,t){e?app.showNotice(e):(app.showNotice(langMgr.getString("gppvpPage",5)),app.player.reduceItem(t.castitems),app.player.sfGppvpInfo(function(){}))})},refreshTime:function(){if(this.p_labTimeCoin.node.activeInHierarchy){var e=app.player.getServerTime(),t=app.player.getDayTimeBySet(10,0,0,0);this.p_labTimeCoin.string=langMgr.getString("gppvpPage",10,gUtils.getCountDownStr(t-e))}if(app.gppvpData){this.refreshCoin(),this._lastState!=app.pages.gppvppage.getState()&&(3==app.pages.gppvppage.getState()?this.GpseasonOver():2==app.pages.gppvppage.getState()&&this.GpseasonStart());var a=app.lockFunConfig.getGppvpSettlementTime();switch(app.pages.gppvppage.getState()){case 1:this.p_labTimeTip.string=langMgr.getString("gppvpPage",8);var i=app.lockFunConfig.getPreCountDownByKey("GONGPING_PVP");this.p_labTime.string=gUtils.getCountDownStr(i);break;case 2:this.p_labTimeTip.string=langMgr.getString("gppvpPage",9),this.p_labTime.string=gUtils.getCountDownStr(a);break;case 3:this.p_labTimeTip.string=langMgr.getString("gppvpPage",9),this.p_labTime.string=langMgr.getString("gppvpPage",7);break;case 0:this.p_labTimeTip.string=langMgr.getString("gppvpPage",8),this.p_labTime.string=gUtils.getCountDownStr(0)}this._lastState=app.pages.gppvppage.getState()}},refreshCoin:function(){var e=this;if(!this.m_coinRefresh){var t=app.player.getServerTime(),a=new Date(t);app.gppvpData&&a.getHours()==app.gppvpData.coinRefreshHours&&(this.m_coinRefresh=!0,app.player.sfPlayerByParam(["others","hide","props"],function(){e.refreshUI()}))}},GpseasonStart:function(){this.refreshUI()},GpseasonOver:function(){this._bMatchLoading&&(this._timeCount=0,this._bMatchEnd=!1,this._bMatchLoading=!1,this.p_nodeLoading.active=!1),this.refreshUI(),["gppvpchoosepage","gppvpbuyticketpage","gppvpchoosetutorpage","gppvpchoosefetterpage"].forEach(function(e){app.pages[e].instance&&cc.isValid(app.pages[e].instance.node)&&app.pages[e].instance.onClose()})},onDestroy:function(){this._super()}});a.refreshRed=function(e){var t=!1;return!a.isOpen()||2!=a.getState()&&3!=a.getState()||(t=app.pages.gppvpmissionpage.refreshRed())||(t=!app.gppvpData),e&&(e.active=t),t},a.showPage=function(){var t=this;a.isOpen()&&(app.gppvpPreData?e("basePage").showPage.call(this,!0):app.player.sfGppvpPreInfo(function(){e("basePage").showPage.call(t,!0)}))},a.isOpen=function(){var e=!1;return e||(e=app.db.checkFuncUnLock("GONGPING_PVP")&&app.db.checkChannelShow("GONGPING_PVP")),e&&app.lockFunConfig&&(e=app.lockFunConfig.checkOpenByKey("GONGPING_PVP")),e},a.getState=function(){var e=0;return a.isOpen()&&(e=a.isPreShow()?1:a.isShowState()?3:2),e},a.isShowState=function(){return a.isOpen()&&app.lockFunConfig&&app.lockFunConfig.getGppvpSettlementTime()<=0},a.isPreShow=function(){return a.isOpen()&&app.lockFunConfig&&app.lockFunConfig.checkPreFuncByKey("GONGPING_PVP")},a.getPlayerState=function(){return app.gppvpPreData.issign?1==app.gppvpData.bindphone?1:2==app.gppvpData.bindphone?2:3:0},cc._RF.pop()},{basePage:void 0}],gppvpPlayerInfoPage:[function(e,t){"use strict";cc._RF.push(t,"0141542KL9L+LIsSnHE9zxL","gppvpPlayerInfoPage");var a=["\u524d\u519b","\u4e2d\u519b","\u540e\u519b"],i=cc.Class({extends:e("basePage"),statics:{prefabPath:"gppvpplayerinfopage",pageType:1},properties:{p_nodePlayer:cc.Node,p_nodeContent:cc.Node,p_battleItem:cc.Prefab,p_updateLayout:[cc.Layout],p_labPointTime:cc.Label},onLoad:function(){i.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.m_arrItems=[]},handleUI:function(){this._super()},setParam:function(e){this._playerInfo=e.playerInfo,this.isHide=!!e.playerInfo.isHide,this.m_title=e.title?e.title:"\u4e0a\u9635\u6b66\u5c06",this.refreshUI()},refreshUI:function(){if(this._playerInfo){this.p_nodePlayer.getComponent("playerPortraitItem").refreshUI(this._playerInfo,this);var e=this._playerInfo.battleset;e&&this.refreshTeam(e),this.updatePos()}},refreshTeam:function(e){var t=0;if(this.isHide){var i=[];e.forEach(function(e){i=i.concat(Object.values(e.team))}),i.sort(function(e,t){var a=e,i=t;if(a.star<i.star)return 1;if(a.star==i.star){if(a.level<i.level)return 1;if(a.level==i.level&&a.gsid>i.gsid)return 1}return-1});var n=this.m_arrItems[t++];n||((n=cc.instantiate(this.p_battleItem)).parent=this.p_nodeContent,this.m_arrItems.push(n)),n.active=!0,n.getComponent("kingpvpPlayerInfoItem").refreshUI({bset:{team:i},title:this.m_title},this)}else for(var r=0;r<e.length;r++){var o=e[r];if(o&&o.team){var s=this.m_arrItems[t++];s||((s=cc.instantiate(this.p_battleItem)).parent=this.p_nodeContent,this.m_arrItems.push(s)),s.active=!0,s.getComponent("kingpvpPlayerInfoItem").refreshUI({bset:o,title:a[r]},this)}}this.p_labPointTime&&this._playerInfo.lastchangetime?(this.p_labPointTime.string=gUtils.dateFormatter("YYYY-MM-DD HH:mm:ss",this._playerInfo.lastchangetime),this.p_labPointTime.node.parent.active=!0,this.p_labPointTime.node.parent.zIndex=999):this.p_labPointTime.node.parent.active=!1;for(var p=t;p<this.m_arrItems.length;++p)this.m_arrItems[p].active=!1},updatePos:function(){this.p_updateLayout.forEach(function(e){e.updateLayout()})}});cc._RF.pop()},{basePage:void 0}],gppvpReplayPage:[function(e,t){"use strict";cc._RF.push(t,"6b633wTxyFOUaC7pDilyz/x","gppvpReplayPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"gppvpreplaypage",pageType:1},properties:{p_nodeView:cc.ScrollView,p_pfbItem:cc.Prefab},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.m_arrItem=[]},setParam:function(){var e=this;app.player.sfGpPvpRecords(function(t){e._video=t,e.refreshUI()})},refreshUI:function(){for(var e=0;e<this._video.length;++e){var t=this.m_arrItem[e];t||((t=cc.instantiate(this.p_pfbItem)).parent=this.p_nodeView.content,this.m_arrItem.push(t)),t.active=!0,t.getComponent("gppvpReplayItem").refreshUI(this._video[e],this)}}});cc._RF.pop()},{basePage:void 0}],gppvpResetTipPage:[function(e,t){"use strict";cc._RF.push(t,"fff9ak1W61DipCn/162lRBb","gppvpResetTipPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"gppvpresettippage",pageType:1},properties:{p_btnConfirm:cc.Button,p_btnCancel:cc.Button,p_labLimitCount:cc.Label},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.creatMask()},handleUI:function(){var e=this;this._super(),this.p_btnConfirm.node.on("click",function(){app.playSound("click"),e.onClickReset()}),this.p_btnCancel.node.on("click",function(){app.playSound("cancel"),e.onClose()})},setParam:function(){this.refreshUI()},refreshUI:function(){var e=app.db.dbGPResetCast.length,t=app.gppvpData&&app.gppvpData.resetcount?app.gppvpData.resetcount:0;t=Math.min(e,t),this.p_labLimitCount.string=e-t+"/"+e},onClickReset:function(){var e=this;if(!app.pages.gppvppage.isOpen()||2!=app.pages.gppvppage.getState())return app.showNotice(langMgr.getString("gppvpPage",7)),void this.refreshUI();var t=app.db.dbGPResetCast[app.db.dbGPResetCast.length-1];if(app.db.dbGPResetCast[app.gppvpData.resetcount]&&(t=app.db.dbGPResetCast[app.gppvpData.resetcount]),app.player.getCount(t.CAST[0].GSID)<t.CAST[0].COUNT)app.showNotice(langMgr.getString("public",23));else{var a=app.db.dbGPResetCast.length;app.gppvpData&&app.gppvpData.resetcount&&app.gppvpData.resetcount>=a?app.showNotice(langMgr.getString("gppvpInfoPage",5)):app.player.sfGppvpResetCard(function(t){if(t)app.showNotice(t);else{app.showNotice(langMgr.getString("gppvpInfoPage",1));var a=app.db.dbGPResetCast[app.db.dbGPResetCast.length-1];app.db.dbGPResetCast[app.gppvpData.resetcount]&&(a=app.db.dbGPResetCast[app.gppvpData.resetcount]),app.player.reduceItem(a.CAST[0]),e.onClose(),app.gppvpData.reset(),eventMgr.emit(eventStr.gppvpEvent.RefreshInfo),app.pages.gppvpinfopage.instance&&cc.isValid(app.pages.gppvpinfopage.instance.node)&&app.pages.gppvpinfopage.instance.onClose(),app.player.sfGppvpInfo(function(){},!0)}})}}});cc._RF.pop()},{basePage:void 0}],gppvpRewardPage:[function(e,t){"use strict";cc._RF.push(t,"ae6f8anU39BXp+ct9NGpdDm","gppvpRewardPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"gppvprewardpage",pageType:1},properties:{p_srcView:cc.ScrollView,p_nodeItem:cc.Node},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.m_arrItem=[]},handleUI:function(){this._super()},setParam:function(){this.refreshUI()},refreshUI:function(){var e=app.db.dbGPReward,t=app.gppvpData&&app.gppvpData.rank&&app.gppvpData.rank.selfrank&&1==app.pages.gppvppage.getPlayerState()&&(2==app.pages.gppvppage.getState()||3==app.pages.gppvppage.getState())?app.gppvpData.rank.selfrank:9999999999;t=t||9999999999;for(var a=!1,i=0;i<e.length;++i){!a&&t<=e[i].MAX&&(this.p_nodeItem.getComponent("pvpRewardItem").refreshUI({MIN:t,MAX:t,REWARDS:e[i].REWARDS,bSelfRank:!0,TYPE:"gpvp"}),a=!0);var n=this.m_arrItem[i];n||((n=cc.instantiate(this.p_nodeItem)).parent=this.p_srcView.content,this.m_arrItem.push(n)),n.active=!0,n.getComponent("pvpRewardItem").refreshUI(e[i])}a||this.p_nodeItem.getComponent("pvpRewardItem").refreshUI({MIN:t,MAX:t,REWARDS:[],bSelfRank:!0,TYPE:"gpvp"}),this.p_nodeItem.active=9999999999!=t;for(var r=e.length;r<this.m_arrItem.length;++r)this.m_arrItem[r].active=!1}});cc._RF.pop()},{basePage:void 0}],groundPage:[function(e,t){"use strict";cc._RF.push(t,"76d35e9fnZHG6e7xJFjNkJ9","groundPage");var a={dungeonentrancepage:"p_nodeYiqi",ancientfieldpage:"p_nodeOldBattle",expeditionpage:"p_nodeExped",pvpentrancepage:"p_nodePvp",towermanagepage:"p_nodeTower",bigbattlepage:"p_nodeBbattle",itnmissionpage:"p_nodeItnMission"},i=cc.Class({extends:e("basePage"),statics:{prefabPath:"groundpage"},properties:{p_nodeBg:cc.Node,p_nodeYiqi:cc.Node,p_nodeExped:cc.Node,p_nodePvp:cc.Node,p_nodeTower:cc.Node,p_nodeBbattle:cc.Node,p_nodeItnMission:cc.Node,p_nodeOldBattle:cc.Node},onLoad:function(){i.instance=this,this.fitTopMenu(),this.stopBgNodeEvent(),this.handleUI()},onEnable:function(){this._super(),eventMgr.on(eventStr.redEvent.RefreshGroundRed,this.refreshCityRed,this),eventMgr.on(eventStr.unlockNewFuncEvent.RefreshNewFunc,this.refreshNewFunc,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.redEvent.RefreshGroundRed,this.refreshCityRed,this),eventMgr.off(eventStr.unlockNewFuncEvent.RefreshNewFunc,this.refreshNewFunc,this)},handleUI:function(){var e=this;this.p_nodeBg.on("touchmove",function(t){e.moveMapByTouch(t)}),this.p_nodeBg.on("touchend",function(){e.m_isMove=!1}),this.p_nodeYiqi.on("touchend",function(){e.m_isMove||(app.playSound("click"),e.p_nodeYiqi.getComponent("GroundItem").isLocked?app.showNotice(langMgr.getString("groundPage",2)):app.pages.dungeonentrancepage.showPage())}),this.p_nodeExped.on("touchend",function(){e.m_isMove||(app.playSound("click"),e.p_nodeExped.getComponent("GroundItem").isLocked?app.showNotice(langMgr.getString("groundPage",2)):app.pages.expeditionpage.showPage())}),this.p_nodePvp.on("touchend",function(){e.m_isMove||(app.playSound("click"),e.p_nodePvp.getComponent("GroundItem").isLocked?app.showNotice(langMgr.getString("groundPage",2)):app.pages.pvpentrancepage.showPage())}),this.p_nodeTower.on("touchend",function(){e.m_isMove||(app.playSound("click"),e.p_nodeTower.getComponent("GroundItem").isLocked?app.showNotice(langMgr.getString("groundPage",2)):app.pages.towermanagepage.showPage())}),this.p_nodeBbattle.on("touchend",function(){e.m_isMove||(app.playSound("click"),e.p_nodeBbattle.getComponent("GroundItem").isLocked?app.showNotice(langMgr.getString("groundPage",2)):app.pages.bigbattlepage.showPage())}),this.p_nodeItnMission.on("touchend",function(){e.m_isMove||(app.playSound("click"),e.p_nodeItnMission.getComponent("GroundItem").isLocked?app.showNotice(langMgr.getString("groundPage",2)):app.pages.itnmissionpage.showPage())}),this.p_nodeOldBattle.on("touchend",function(){e.m_isMove||(app.playSound("click"),e.p_nodeOldBattle.getComponent("GroundItem").isLocked?app.showNotice(langMgr.getString("groundPage",2)):app.pages.ancientfieldpage.showPage())})},setParam:function(){this.upLock(),this.refreshCityRed(),app.getUnlockGuideInfo(this.refreshNewFunc,this),this.p_nodeYiqi.active=app.db.checkChannelShow("DUNGEON")},upLock:function(){for(var e in a){var t=a[e];if(this[t])if(app.db.checkPageUnLock(e)){var i,n=app.db.getGroundPageCfgByPage(e),r=null!=(i=null==n?void 0:n.REWARD_LIST)?i:[],o=gConfig.getGroundPageDescriptionPath(n.DESCRIPTION);this[t].getComponent("GroundItem").renderUnlockView(r,o,this)}else{var s=app.db.getLevelByPage(e),p=langMgr.getString("groundPage",1,s);this[t].getComponent("GroundItem").renderLockView(p)}}},refreshNewFunc:function(){for(var e in this.m_arrNewFun||(this.m_arrNewFun=[]),a){var t=a[e];if(this[t]){var i=app.db.checkPageUnLock(e),n=app.db.getLockInfoByPage(e);i&&app.guideUnlockInfo[n.FUNCTION_ID]&&(cc.log("now handle id is ",n.FUNCTION_ID),n.FUNCTION_ID,"TOWER"==n.FUNCTION_ID&&app.db.checkFuncUnLock("TOWER_OCC")),cc.log("ground page func item",this[t].children)}}},moveMapByTouch:function(e){if(e.getLocation&&!(Math.abs(e.getLocation().y-e.getStartLocation().y)<=6)){this.m_isMove=!0;var t=this.p_nodeBg.y,a=e.getDelta();this.setNodeMove(t,a.y)}},setNodeMove:function(e,t){var a=0;cc.winSize.height/cc.winSize.width>2e3/1080&&(a=70);var i=this.p_nodeBg.height/2-cc.winSize.height/2,n=-this.p_nodeBg.height/2+cc.winSize.height/2-a;e+=1*t,e=Math.min(i,e),e=Math.max(n,e),this.p_nodeBg.y=e},refreshCityRed:function(){for(var e in a){var t=a[e];if(this[t]){var i=this[t].getChildByName("rednotice");app.pages[e]&&app.pages[e].refreshRed&&app.db.checkPageUnLock(e)?app.pages[e].refreshRed(i):cc.isValid(i)&&(i.active=!1)}}}});i.refreshRed=function(e){for(var t=!1,i=Object.keys(a),n=0;n<i.length&&!(app.pages[i[n]]&&app.pages[i[n]].refreshRed&&app.db.checkPageUnLock(i[n])&&(t=app.pages[i[n]].refreshRed()));n++);return e&&(e.active=t),t},i.showPage=function(t,a,i){e("basePage").showPage.call(this,t,a,i)},cc._RF.pop()},{basePage:void 0}],guanZhuPage:[function(e,t){"use strict";cc._RF.push(t,"42bc4SltrpEAK1mkbuQmPFT","guanZhuPage"),cc.Class({extends:e("basePage"),statics:{prefabPath:"guanzhupage"},properties:{},onLoad:function(){this.stopBgNodeEvent(),this.creatMask(!0)},handleUI:function(){this._super()}}),cc._RF.pop()},{basePage:void 0}],itnBossPage:[function(e,t){"use strict";cc._RF.push(t,"53b7dRQQFRKg74nQ78h7dCg","itnBossPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"itnbosspage",pageType:1},properties:{p_labBossName:cc.Label,p_barHp:cc.ProgressBar,p_labHp:cc.Label,p_sprGeneral:cc.Sprite,p_spGeneral:sp.Skeleton,p_animGeneral:cc.Animation,p_labTime:cc.Label,p_pfbRewardItem:cc.Prefab,p_nodeRewardContent:cc.Node,_rewardList:[],p_labRewardTips:cc.Label,p_labBossPhysic:cc.Label,p_btnBattle:cc.Button,p_btnMop:cc.Button,p_btnMidBattle:cc.Button},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},afterBattleFresh:function(){this.m_objData.lastdamage=app.bossDamage,this.m_objData.nowhp-=Math.min(this.m_objData.nowhp,app.bossDamage);var e=Math.ceil(this.m_objData.nowhp/this.m_objData.maxhp*100);this.p_barHp.progress=e/100,this.p_labHp.string=e>0?e+"%":langMgr.getString("itnBossPage",0),this.p_labBossPhysic.string=app.player.fbossphys+"/10",this.p_btnBattle.node.active=0===this.m_objData.lastdamage,this.p_btnMidBattle.node.parent.active=this.m_objData.lastdamage>0,this.afterBattle=!0},setParam:function(e){this.m_objData=e,this.afterBattle=!1,this.refreshUI(e)},handleUI:function(){var e=this;this._super(),this.p_btnBattle.node.on("click",function(){app.playSound("click"),e.onBattle()}),this.p_btnMidBattle.node.on("click",function(){app.playSound("click"),e.onBattle()}),this.p_btnMop.node.on("click",function(){app.playSound("click"),e.onMop()},this)},refreshUI:function(e){this.m_objData=e,this.p_labBossName.string=e.name,this.p_barHp.progress=e.nowhp/e.maxhp;var t=Math.ceil(e.nowhp/e.maxhp*100);this.p_labHp.string=t>0?t+"%":langMgr.getString("itnBossPage",0),app.loadGeneral(e.gsid,this.p_sprGeneral,this.p_spGeneral,this.p_animGeneral,null,this.prefabPath),this.refreshTime(),this.refreshReward(),this.p_labBossPhysic.string=app.player.fbossphys+"/10",this.p_btnBattle.node.active=0===this.m_objData.lastdamage,this.p_btnMidBattle.node.parent.active=this.m_objData.lastdamage>0},refreshTime:function(){var e=app.player.getServerTime(),t=(this.m_objData.etime-e)/1e3;this.p_labTime.string=gUtils.getHourMinSecTime(t)},refreshReward:function(){for(var e=0;e<this.m_objData.rewards.length;++e){var t=this._rewardList[e];cc.isValid(t)?t.active=!0:(t=cc.instantiate(this.p_pfbRewardItem),this.p_nodeRewardContent.addChild(t),this._rewardList[e]=t),t.getComponent("propItem").initForBag(this.m_objData.rewards[e])}for(var a=this.m_objData.rewards.length;a<this._rewardList.length;++a)cc.isValid(this._rewardList[a])&&(this._rewardList[a].active=!1)},refreshBossTime:function(){if(app.player.getServerTime()>=this.m_objData.etime)this.m_isBossTime=!1,this.m_contanfunc.apply(this.m_trane);else{var e=this.m_objData.etime-app.player.getServerTime();this.p_labDisappearBoss.string=gUtils.getHourMinSecTime(e/1e3)}},onBattle:function(){app.db.checkFuncUnLock("FRIENDTS",!0)&&(app.player.fbossphys<=0?app.showNotice(langMgr.getString("itnBossPage",1)):this.p_barHp.progress<=0?app.showNotice(langMgr.getString("itnBossPage",2)):(app.fbossOwnerId=this.m_objData.bid,app.goToBossBattle("friendboss",this.m_objData)))},onMop:function(){var e=this;if(app.db.checkFuncUnLock("FRIENDTS",!0))if(app.player.fbossphys<=0)app.showNotice(langMgr.getString("itnBossPage",1));else{var t={content:langMgr.getString("itnBossPage",3,this.m_objData.lastdamage),confirmcb:function(){app.player.sfFriendBossFarm(e.m_objData.bid,function(t,a){t?(cc.warn("mop friend boss error: ",JSON.stringify(t)),"boss is killed"==t&&app.showNotice(langMgr.getString("itnBossPage",4,e.m_objData.name))):(app.player.fbossphys--,e.m_objData=Object.assign(e.m_objData,{lastdamage:a.boss.lastdamges,last:a.boss.last,nowhp:a.boss.nowhp}),e.refreshUI(e.m_objData))})},target:this};app.pages.windowspagetipsmsg.showPage(t)}},onClose:function(){this._super(),this.afterBattle&&this.m_objData.target.m_target.afterBossCloseFresh()}});cc._RF.pop()},{basePage:void 0}],itnFriendChoicePage:[function(e,t){"use strict";cc._RF.push(t,"85d38OSs/RFrayWDswwe9oi","itnFriendChoicePage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"itnfriendchoicepage",pageType:1},properties:{p_labNumPick:cc.Label,p_pfbPowerDisplay:cc.Prefab,p_nodePickContent:cc.Node,p_nodeNeedContent:cc.Node,_nodePowerPick:null,_nodePowerNeed:null,p_labNameMission:cc.Label,p_listFriend:cc.Node,p_btnGo:cc.Button,p_nodePowerFire:cc.Node},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){var e=this;this._super(),this.p_btnGo.node.on("click",function(){app.playSound("click"),e.onClickStart()})},setParam:function(e){this.m_arrPick=[],this.m_numPowerPick=app.player.power,this.m_objInfo=e.info,this.m_arrData=e.friendlist,this.m_target=e.target,this.m_callBack=e.cb;for(var t=0;t<this.m_arrData.length;t++)this.m_arrData[t].isTick=!1;this.refreshUI()},refreshUI:function(){this.refreshView(),this.refreshMission(),this.refreshPick()},refreshView:function(){this.p_listFriend.getComponent("listViewCtrl").initListView(this.m_arrData.length,this.m_arrData,"up",this)},refreshMission:function(){var e=app.db.getAffairsFriendInfo(this.m_objInfo.id);if(e){var t=gConfig.getItnMissionSet(e.STAR);this.p_labNameMission.string=e.NAME;var a="#FFFFFF";t&&(a=t.COLOR),this.p_labNameMission.node.color=cc.color(a);var i=t?t.LOCOLOR:"#FFFFFF";this.p_labNameMission.node.getComponent(cc.LabelOutline).color=cc.color(i),cc.isValid(this._nodePowerNeed)||(this._nodePowerNeed=cc.instantiate(this.p_pfbPowerDisplay),this.p_nodeNeedContent.addChild(this._nodePowerNeed),this._nodePowerNeed.setPosition(cc.Vec2.ZERO)),this._nodePowerNeed.getComponent("PowerDisplay").init({val:this.m_objInfo.power})}},refreshPick:function(){var e=this.m_arrPick.length;this.p_labNumPick.string=langMgr.getString("itnFriendChoicePage",0,[e+1,3]),cc.isValid(this._nodePowerPick)||(this._nodePowerPick=cc.instantiate(this.p_pfbPowerDisplay),this.p_nodePickContent.addChild(this._nodePowerPick),this._nodePowerPick.setPosition(cc.Vec2.ZERO)),this._nodePowerPick.getComponent("PowerDisplay").init({val:this.m_numPowerPick}),this.p_nodePowerFire.opacity=this.m_numPowerPick>=this.m_objInfo.power?255:0},itemPick:function(e,t){if(cc.log(e,t),e){if(this.m_arrPick.length<2)return this.m_arrPick.push(t.id),this.m_numPowerPick+=t.power,this.refreshPick(),!0;app.showNotice(langMgr.getString("itnFriendChoicePage",3))}else{var a=this.m_arrPick.indexOf(t.id);a>=0&&(this.m_arrPick.splice(a,1),this.m_numPowerPick-=t.power)}return this.refreshPick(),!1},onClickStart:function(){var e=this;if(this.m_arrPick.length<2)app.showNotice(langMgr.getString("itnFriendChoicePage",1));else{var t=this.m_arrData.filter(function(t){return e.m_arrPick.includes(t.id)}).reduce(function(e,t){return t.power&&(e+=t.power),e},0);if(t+=app.player.power,cc.log("total power: ",t),t<this.m_objInfo.power)return app.showNotice(langMgr.getString("itnFriendChoicePage",2));app.player.sfAffairsStart(this.m_objInfo.mid,this.m_arrPick,"friend",function(t){for(var a=-1,i=0;i<e.m_arrData.length;i++)if(e.m_arrPick[0]==e.m_arrData[i].id){a=i;break}-1!=a&&e.m_arrData.splice(a,1);for(var n=-1,r=0;r<e.m_arrData.length;r++)if(e.m_arrPick[1]==e.m_arrData[r].id){n=r;break}-1!=n&&e.m_arrData.splice(n,1),e.m_callBack&&e.m_callBack.call(e.m_target,t),e.onClose(),app.player.sfPlayerByParam(["others","props"],function(){})})}}});cc._RF.pop()},{basePage:void 0}],itnFriendPickPage:[function(e,t){"use strict";cc._RF.push(t,"37773bolnRNpY3E59SImI/Y","itnFriendPickPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"itnfriendpickpage",pageType:1},properties:{p_labTitle:cc.Label,p_listMission:cc.Node,p_btnGo:cc.Button},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){var e=this;this._super(),this.p_btnGo.node.on("click",function(){app.playSound("click"),e.onClickStart()})},setParam:function(e){this.m_arrData=e.arr,this.m_target=e.target,this.m_callBack=e.cb,this.m_isOk=!1,this.m_canel=e.canel,this.refreshUI()},refreshUI:function(){this.refreshView()},refreshView:function(){this.p_listMission.getComponent("listViewCtrl").initListView(this.m_arrData.length,this.m_arrData,"up",this)},onClickStart:function(){var e=this;cc.log(this.m_arrData);for(var t={},a=0;a<this.m_arrData.length;++a){var i=this.m_arrData[a];if(i.pick&&i.pick.length>=2){for(var n=[],r=0;r<i.pick.length;++r)n.push(i.pick[r].id);t[i.mid]=n}}app.player.sfAffairsAutoStart("friend",t,function(t,a){t?cc.log(t):(e.m_isOk=!0,app.player.sfPlayerByParam(["props","books","others"],function(){app.checkPageValid("itnmissionpage")&&e.m_callBack&&e.m_callBack.call(e.m_target,a),e.onClose()}))})},onClose:function(){this._super(),app.checkPageValid("itnmissionpage")&&!this.m_isOk&&this.m_canel&&this.m_canel.call(this.m_target)}});cc._RF.pop()},{basePage:void 0}],itnMissionChoicePage:[function(e,t){"use strict";function a(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(a)return(a=a.call(e)).next.bind(a);if(Array.isArray(e)||(a=i(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function i(e,t){if(e){if("string"==typeof e)return n(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?n(e,t):void 0}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,i=new Array(t);a<t;a++)i[a]=e[a];return i}cc._RF.push(t,"71feavrBkhN0Y4FgIXWT80I","itnMissionChoicePage");var r=cc.Class({extends:e("basePage"),statics:{prefabPath:"itnmissionchoicepage",pageType:1,_forceCreateNewShot:!0},properties:{p_labTitle:cc.Label,p_nodeRewardContent:cc.Node,p_pfbPropItem:cc.Prefab,_nodeProp:null,p_labTitleList:cc.Label,p_nodeGeneralContent:cc.Node,p_pfbGeneralItem:cc.Prefab,_mGeneralList:[],p_nodeStar:cc.Node,p_labStar:cc.Label,p_arrNodeCond:[cc.Node],p_btnPick:cc.Button,p_btnStart:cc.Button,p_nodeList:cc.Node,p_tavGeneral:cc.Node,p_pfbMenuSelector:cc.Prefab,p_nodeMenuContent:cc.Node,_nodeMenuController:null},onLoad:function(){r.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.p_nodeList.on("touchstart",function(e){e.stopPropagation()}),this.p_nodeList.on("touchmove",function(e){e.stopPropagation()}),this.p_nodeList.on("touchend",function(e){e.stopPropagation()}),this._initMenu()},_initMenu:function(){var e=cc.instantiate(this.p_pfbMenuSelector);this.p_nodeMenuContent.addChild(e),e.setPosition(cc.Vec2.ZERO),this._nodeMenuController=e.getComponent("GeneralMenuSelector"),this._nodeMenuController.onCampClick(this.campMenuHandler,this),this._nodeMenuController.onProfessionClick(this.professionMenuHandler,this)},handleUI:function(){var e=this;this._super(),this.p_btnStart.node.on("click",function(){app.playSound("click"),e.onClickStart()}),this.p_btnPick.node.on("click",function(){app.playSound("click"),e.onClickQuick()})},setParam:function(e){this.m_objData=e.info,this.m_arrUsed=e.used,this.m_target=e.target,this.m_callBack=e.cb,this.m_arrPickedId=[],this.m_arrShowPickList=[],this.m_arrCond=[],this.m_arrShowData=this.setData(),this.refreshUI(e.info)},refreshUI:function(e){cc.log(e);var t=app.db.getAffairsInfo(e.id),a=gConfig.getItnMissionSet(t.STAR);this.p_labTitle.string=t.TITLE;var i="#FFFFFF";a&&(i=a.COLOR),this.p_labTitle.node.color=cc.color(i);var n=a?a.LOCOLOR:"#FFFFFF";this.p_labTitle.node.getComponent(cc.LabelOutline).color=cc.color(n),cc.isValid(this._nodeProp)||(this._nodeProp=cc.instantiate(this.p_pfbPropItem),this.p_nodeRewardContent.addChild(this._nodeProp),this._nodeProp.setPosition(cc.Vec2.ZERO)),this._nodeProp.getComponent("propItem").initForBag(e.reward[0]),this._nodeProp.getComponent("propItem").setClick(!0),this.p_labTitleList.string=langMgr.getString("itnMissionChoicePage",1),this.refreshCond(),this.refreshGPick(),this.refreshGView()},refreshGView:function(){if(this.m_arrShowData){var e=this.m_arrShowData.length;this.p_tavGeneral.getComponent("tableView").initTableView(e,{array:this.m_arrShowData,maxpick:this.m_objData.gnum,initfun:"initForBag",scale:1,target:this})}},refreshGPick:function(){var e=this;cc.log(this.m_arrShowPickList);for(var t=function(t){var a=e._mGeneralList[t];cc.isValid(a)?a.active=!0:(a=cc.instantiate(e.p_pfbGeneralItem),e.p_nodeGeneralContent.addChild(a),e._mGeneralList[t]=a,a.on("touchend",function(){e.onClickPicked(t)}));var i=e.m_arrShowPickList[t];i?a.getComponent("generalPortraitItem").initForBag(i):a.getComponent("generalPortraitItem").initForNone()},a=0;a<this.m_objData.gnum;++a)t(a);for(var i=this.m_objData.gnum;i<this._mGeneralList.length;++i)this._mGeneralList[i].active=!1;this.refreshCondState()},refreshCond:function(){var e=this;this.getCond(this.m_objData.cond),cc.log(this.m_arrCond);for(var t=null,a=[],i=0;i<this.m_arrCond.length;++i){var n=this.m_arrCond[i];"star"==n.type?t=n:a.push(n)}this.p_nodeStar.active=!!t,t&&(this.p_labStar.string=t.num),this.p_arrNodeCond.forEach(function(t,i){var n,r=a[i];r?(t.active=!0,"camp"==r.type&&(n=gConfig.getIconGCampPath(r.num-1)),"occu"==r.type&&(n=gConfig.getIconGOccuPath(r.num-1)),n&&app.loadTexture(n,t.getComponent(cc.Sprite),e.prefabPath)):t.active=!1}),this.refreshCondState()},refreshCondState:function(){for(var e=null,t=[],a=0;a<this.m_arrCond.length;++a){var i=this.m_arrCond[a];i.state=1;for(var n=0;n<this.m_arrShowPickList.length;++n){var r=this.m_arrShowPickList[n];if(r){var o=app.player.general[r];if("star"==i.type&&o[i.type]>=i.num){i.state=0;break}if(o[i.type]==i.num){i.state=0;break}}}"star"==i.type?e=i:t.push(i)}e&&(app.setSpriteState(this.p_nodeStar.getComponent(cc.Sprite),e.state),cc.isValid(this.p_nodeStar.getChildByName("Fulfill"))&&(this.p_nodeStar.getChildByName("Fulfill").opacity=e.state?0:255)),this.p_arrNodeCond.forEach(function(e,a){var i=t[a];i&&(app.setSpriteState(e.getComponent(cc.Sprite),i.state),cc.isValid(e.getChildByName("Fulfill"))&&(e.getChildByName("Fulfill").opacity=i.state?0:255))})},setData:function(e){var t=[],a=this._nodeMenuController.getCampIndex(),i=this._nodeMenuController.getProfessionIndex();for(var n in app.player.general){var r=app.player.general[n];if(!(this.m_arrUsed.indexOf(n)>=0||app.player.isTimeLimitGeneral(n))){var o=0==a||a==r.camp,s=0==i||i==r.occu||i==r.occu2;(o&&s||e)&&t.push(n)}}return t.sort(function(e,t){var a=app.player.general[e],i=app.player.general[t];if(a.star<i.star)return 1;if(a.star==i.star){if(a.level<i.level)return 1;if(a.level==i.level&&a.gsid>i.gsid)return 1}return-1}),t},itemClick:function(e,t){var a=!t.p_nodeMask.active;return this.setPickedList(e,a),this.refreshGPick(),a},onClickPicked:function(e){var t=this,a=this.m_arrShowPickList[e];if(!a){if(this.m_isShowList||this.m_isUping)return;return this._nodeMenuController.resetMenu(),this.m_isUping=!0,void cc.tween(this.p_nodeList).by(.25,{position:cc.v2(0,418)}).call(function(){t.m_isShowList=!0,t.m_isUping=!1}).start()}this.m_arrShowPickList[e]=null;var i=this.m_arrPickedId.indexOf(a);this.m_arrPickedId.splice(i,1);var n={array:this.m_arrShowData,maxpick:this.m_objData.gnum,initfun:"initForBag",target:this};this.p_tavGeneral.getComponent("tableView").reload(n),this.refreshGPick()},onClickStart:function(){var e=this;if(this.m_arrPickedId.length<this.m_objData.gnum)app.showNotice(langMgr.getString("itnMissionChoicePage",2));else{for(var t,i=a(this.m_arrCond);!(t=i()).done;)if(1==t.value.state)return void app.showNotice(langMgr.getString("itnMissionChoicePage",3));app.player.sfAffairsStart(this.m_objData.mid,this.m_arrPickedId,"solo",function(t){for(var a=0;a<e.m_arrShowPickList.length;++a)e.m_arrShowPickList[a]&&e.m_arrUsed.push(e.m_arrShowPickList[a]);"function"==typeof e.m_callBack&&e.m_callBack.call(e.m_target,t),cc.director.emit("EVT_UPDATE_REFRESH_BTN_STATE"),e.onClose(),app.player.sfPlayerByParam(["others","props"],function(){})})}},onClickQuick:function(){var e=[];this.m_arrAllGList=this.setData(!0);for(var t=0;t<this.m_arrCond.length;++t){var a=this.m_arrCond[t],i=this.checkCondFromGeneral(a);if(i.length<=0)return void app.showNotice(langMgr.getString("itnMissionChoicePage",4));for(var n=i.length-1;n>=0;--n){var r=i[n];if(e.indexOf(r)<0){e.push(r);break}}}if(e.length<this.m_objData.gnum)for(var o=this.m_arrAllGList.length-1;o>=0;--o){var s=this.m_arrAllGList[o];if(e.indexOf(s)<0){e.push(s);break}}this.m_arrShowPickList=[],this.m_arrPickedId=[];for(var p=0;p<this.m_objData.gnum;++p){var c=e[p];this.m_arrPickedId.push(c),this.m_arrShowPickList.push(c)}this.p_tavGeneral.getComponent("tableView").reload({array:this.m_arrShowData,maxpick:this.m_objData.gnum,initfun:"initForBag",scale:1,target:this}),this.refreshGPick()},checkCondFromGeneral:function(e){for(var t,i=[],n=a(this.m_arrAllGList);!(t=n()).done;){var r=t.value,o=app.player.general[r][e.type];o&&("star"==e.type?o>=e.num&&i.push(r):o==e.num&&i.push(r))}return i},campMenuHandler:function(){cc.log("handler camp menu"),this.m_arrShowData=this.setData(),this.refreshGView()},professionMenuHandler:function(){cc.log("handler profession menu"),this.m_arrShowData=this.setData(),this.refreshGView()},setPickedList:function(e){var t=this.m_arrShowPickList.indexOf(e);if(t<0){for(var a=0;a<this.m_objData.gnum;++a)if(!this.m_arrShowPickList[a]){this.m_arrShowPickList[a]=e;break}}else this.m_arrShowPickList[t]=null},getCond:function(e){cc.log(e),e||(e=[]),this.m_arrCond=[],-1!=this.m_objData.gstar&&this.m_arrCond.push({type:"star",num:this.m_objData.gstar}),e.length>1&&e.sort(function(e,t){return e-t});for(var t=0;t<e.length;++t)switch(e[t]){case 1:this.m_arrCond.push({type:"camp",num:1});break;case 2:this.m_arrCond.push({type:"camp",num:2});break;case 3:this.m_arrCond.push({type:"camp",num:3});break;case 4:this.m_arrCond.push({type:"camp",num:4});break;case 5:this.m_arrCond.push({type:"occu",num:1});break;case 6:this.m_arrCond.push({type:"occu",num:2});break;case 7:this.m_arrCond.push({type:"occu",num:3});break;case 8:this.m_arrCond.push({type:"occu",num:4});break;case 9:this.m_arrCond.push({type:"occu",num:5});break;case 10:this.m_arrCond.push({type:"occu",num:6})}},onClose:function(){this.m_isShowList=!1,this.p_nodeList.getComponent(cc.Widget).updateAlignment(),this._super()}});cc._RF.pop()},{basePage:void 0}],itnMissionLvPage:[function(e,t){"use strict";cc._RF.push(t,"4e8e3L4/vZKLJ0UVrh0Cy0F","itnMissionLvPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"itnmissionlevelpage",pageType:1},properties:{p_labTitleLv:cc.Label,p_labLvNow:cc.Label,p_labTipsL:cc.Label,p_arrNodeL:[cc.Node],p_labLvNext:cc.Label,p_arrNodeR:[cc.Node],p_labNoLv:cc.Label,p_nodeUp:cc.Node,p_sprQualityUp:cc.Sprite,p_labTipsUp:cc.Label,p_barTimesUp:cc.ProgressBar,p_labTimesUp:cc.Label,p_nodeDown:cc.Node,p_sprQualityDown:cc.Sprite,p_labTipsDown:cc.Label,p_barTimesDown:cc.ProgressBar,p_labTimesDown:cc.Label,nodeColor:[cc.Color],labelOutLineColor:[cc.Color]},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){this._super()},setParam:function(){this.refreshUI()},refreshUI:function(){var e=app.player.getCount(38012),t=e+1;this.p_labTitleLv.string=langMgr.getString("itnMissionLvPage",0,t);var a=app.db.getAffairsLvInfo(e);this.p_labLvNow.string=langMgr.getString("itnMissionLvPage",0,t),this.p_labTipsL.string=langMgr.getString("itnMissionLvPage",1);for(var i=0;i<this.p_arrNodeL.length;++i){var n=a.STAR_SOLO[i];if(n){this.p_arrNodeL[i].active=!0;var r=gConfig.getQualityNameIconPath(n);app.loadTexture(r,this.p_arrNodeL[i].getComponent(cc.Sprite),this.prefabPath)}else this.p_arrNodeL[i].active=!1}var o=t+1,s=app.db.getAffairsLvInfo(e+1);o>app.db.getAffairsMaxLv()?(this.p_labNoLv.stiring=langMgr.getString("itnMissionLvPage",2),this.p_labNoLv.node.active=!0,this.p_labLvNext.node.active=!1):(this.p_labNoLv.node.active=!1,this.p_labLvNext.node.active=!0,this.p_labTipsL.node.active=!0,this.p_labLvNext.string=langMgr.getString("itnMissionLvPage",0,t+1),this.p_labTipsL.string=langMgr.getString("itnMissionLvPage",1));for(var p=s?s.STAR_SOLO:[],c=0;c<this.p_arrNodeR.length;++c){var h=p[c];if(h){this.p_arrNodeR[c].active=!0;var l=gConfig.getQualityNameIconPath(h);app.loadTexture(l,this.p_arrNodeR[c].getComponent(cc.Sprite),this.prefabPath)}else this.p_arrNodeR[c].active=!1}if(o>app.db.getAffairsMaxLv())this.p_nodeUp.active=!1,this.p_nodeDown.active=!1,this.p_labTipsUp.node.opacity=0,this.p_labTimesUp.node.opacity=0,this.p_labTipsDown.node.opacity=0,this.p_labTimesDown.node.opacity=0;else{this.p_nodeUp.active=!0,this.p_nodeDown.active=!0,this.p_labTipsUp.node.opacity=255,this.p_labTimesUp.node.opacity=255,this.p_labTipsDown.node.opacity=255,this.p_labTimesDown.node.opacity=255;var g=app.player.getCount(90444),d=app.player.getCount(90445);this.p_labTipsUp.string=langMgr.getString("itnMissionLvPage",3,a.TIMES_0),this.p_labTipsDown.string=langMgr.getString("itnMissionLvPage",4,a.TIMES_1);var u=gConfig.getQualityNameIconPath(a.MISSION_0);app.loadTexture(u,this.p_sprQualityUp,this.prefabPath);var f=gConfig.getQualityNameIconPath(a.MISSION_1);app.loadTexture(f,this.p_sprQualityDown,this.prefabPath),this.p_barTimesUp.progress=g/a.TIMES_0,this.p_barTimesDown.progress=d/a.TIMES_1,this.p_labTimesUp.string=g+"/"+a.TIMES_0,this.p_labTimesDown.string=d+"/"+a.TIMES_1;var m=Boolean(g>=a.TIMES_0),_=Boolean(d>=a.TIMES_1);this.p_labTimesUp.node.color=this.nodeColor[Number(m)],this.p_labTimesUp.node.getComponent(cc.LabelOutline).color=this.labelOutLineColor[Number(m)],this.p_labTimesDown.node.color=this.nodeColor[Number(_)],this.p_labTimesDown.node.getComponent(cc.LabelOutline).color=this.labelOutLineColor[Number(_)]}},onClose:function(){this._super()}});cc._RF.pop()},{basePage:void 0}],itnMissionPageFriend:[function(e,t){"use strict";cc._RF.push(t,"4b11cALC1ZP96Kp5xAHWc+z","itnMissionPageFriend"),cc.Class({extends:cc.Component,properties:{p_labTitleF:cc.Label,p_labTime:cc.Label,p_tavMission:cc.Node,p_labTitleB:cc.Label,p_labTipsB:cc.Label,p_tavBoss:cc.Node,p_btnOneAccept:cc.Button,p_btnOneGet:cc.Button},onLoad:function(){this.handleUI(),this.schedule(this.refreshTime,1)},handleUI:function(){var e=this;this.p_btnOneAccept.node.on("click",function(){app.playSound("click"),e.newOnClickPick()}),this.p_btnOneGet.node.on("click",function(){app.playSound("click"),e.onClickGet()})},refreshUI:function(e,t,a){this.m_arrShowData=e||[],this.m_arrShowBossData=t||[],this.m_target=a,this.setData(),this.refreshArrTsList(),this.refreshView(),this.refreshTime(),this.refreshBoss()},refreshLv:function(){app.player.getCount(38012)},refreshView:function(){if(this.m_arrShowData){cc.log(this.m_arrShowData),app.setAffairsDataByType("flist",this.m_arrShowData);var e=this.m_arrShowData.length;this.p_tavMission.getComponent("tableView").initTableView(e,{array:this.m_arrShowData,friendlist:this.m_arrTsList,target:this})}},refreshTime:function(){var e=new Date(app.player.getServerTime()),t=new Date(e.getTime()+864e5).setHours(0,0,0,0)-app.player.getServerTime();this.p_labTime.string=langMgr.getString("itnMissionPageFriend",1,gUtils.getHourMinSecTime(t/1e3))},refreshBoss:function(){this.m_arrShowBossData&&(cc.log(this.m_arrShowBossData),app.setAffairsDataByType("blist",this.m_arrShowBossData),this.p_tavBoss.getComponent("listViewCtrl").initListView(this.m_arrShowBossData.length,this.m_arrShowBossData,"up",this))},setData:function(){},refreshArrTsList:function(){this.m_arrTsList=[];var e=gUtils.deepClone(app.arrFriend);e.sort(function(e,t){return e.power<t.power?1:-1});for(var t=[],a=0;a<this.m_arrShowData.length;++a){var i=this.m_arrShowData[a];if(i.friends)for(var n=0;n<i.friends.length;n++)t.push(i.friends[n].id)}for(var r=0;r<e.length;++r)-1==t.indexOf(e[r].id)&&this.m_arrTsList.push(e[r])},onClickPick:function(){for(var e=this,t=app.player.power,a=0;a<this.m_arrTsList.length;++a)for(var i=this.m_arrTsList[a],n=0;n<this.m_arrShowData.length;++n){var r=this.m_arrShowData[n];if(!(r.friends||r.pick&&r.pick.length>=2)){if(r.pick||(r.pick=[]),r.pick.length<=0){r.pick.push(i);break}if(t+r.pick[0].power+i.power>=r.power){r.pick.push(i);break}}}for(var o=[],s=0;s<this.m_arrShowData.length;++s){var p=this.m_arrShowData[s];p.pick&&p.pick.length<2&&(p.pick=null),p.friends||!p.pick||p.pick.length<2||o.push(p)}if(o.length<=0)app.showNotice(langMgr.getString("itnMissionPageFriend",2));else{var c={arr:o,target:this,cb:function(t){cc.log("friend pick cb",e.m_arrShowData,t);for(var a=0;a<t.length;a++)t[a].power=e.m_arrShowData[a].power;e.m_arrShowData=t,e.refreshArrTsList(),e.refreshView(),e.refreshBoss()},canel:function(){for(var t=0;t<e.m_arrShowData.length;++t){var a=e.m_arrShowData[t];a.endtime||(a.pick=null)}e.setData()}};app.pages.itnfriendpickpage.showPage(c)}},newOnClickPick:function(){for(var e=this,t=app.player.power,a=this.m_arrShowData.filter(function(e){return!e.friends}).map(function(e){var t=app.db.getAffairsFriendInfo(e.id);return e.quality=t.STAR,e}).sort(function(e,t){return t.quality-e.quality}),i=[],n=gUtils.deepClone(this.m_arrTsList),r=0;r<a.length;++r){var o=a[r];if(n.length<2)break;var s=n[0];o.pick||(o.pick=[]);var p,c,h=o.power-t-s.power,l=this.judgeConform(h,n);l>=1&&((p=o.pick).push.apply(p,n.splice(l,1)),(c=o.pick).push.apply(c,n.splice(0,1)),i[i.length]=o)}if(i.length<=0)this.m_arrTsList.length<2||a.length<=0?app.showNotice(langMgr.getString("itnMissionPageFriend",2)):app.showNotice(langMgr.getString("itnMissionPageFriend",4));else{var g={arr:i,target:this,cb:function(t){cc.log("friend pick cb",e.m_arrShowData,t);for(var a=0;a<t.length;a++)t[a].power=e.m_arrShowData[a].power;e.m_arrShowData=t,app.checkPageValid("itnmissionpage")&&(app.pages.itnmissionpage.instance.m_arrFriendData=t),e.refreshArrTsList(),e.refreshView(),e.refreshBoss()},canel:function(){for(var t=0;t<e.m_arrShowData.length;++t){var a=e.m_arrShowData[t];a.endtime||(a.pick=null)}e.setData()}};app.pages.itnfriendpickpage.showPage(g)}},judgeConform:function(e,t){for(var a=t.length-1;a>=1;--a)if(t[a].power>=e)return a;return-1},onClickGet:function(){for(var e=this,t=!0,a=app.player.getServerTime(),i=[],n=[],r=0;r<this.m_arrShowData.length;++r){var o=this.m_arrShowData[r];a>=o.etime?t=!1:i.push(o)}for(var s=0;s<this.m_arrShowBossData.length;++s){var p=this.m_arrShowBossData[s];a>=p.etime?t=!1:n.push(p)}t?app.showNotice(langMgr.getString("itnMissionPageFriend",3)):app.player.sfAffairsAutoReward("friend",function(t,a){if(t)app.showNotice(t);else{var r={showtype:1,reward:a.reward,confirmcb:function(){e.m_arrShowData=i,e.m_arrShowBossData=n,app.checkPageValid("itnmissionpage")&&(app.pages.itnmissionpage.instance.m_arrFriendData=i,app.pages.itnmissionpage.instance.m_arrBossData=n),e.setData(),e.refreshArrTsList(),e.refreshView(),e.refreshBoss(),eventMgr.emit(eventStr.redEvent.RefreshAffairRed)}};app.pages.windowspagereward.showPage(r),app.player.addItem(a.reward)}})}}),cc._RF.pop()},{}],itnMissionPagePerson:[function(e,t){"use strict";function a(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(a)return(a=a.call(e)).next.bind(a);if(Array.isArray(e)||(a=i(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function i(e,t){if(e){if("string"==typeof e)return n(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?n(e,t):void 0}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,i=new Array(t);a<t;a++)i[a]=e[a];return i}cc._RF.push(t,"04b1aGy1SJDerhvtzjUayVP","itnMissionPagePerson"),cc.Class({extends:cc.Component,properties:{p_tavMission:cc.Node,p_btnRefresh:cc.Button,p_labTime:cc.Label,p_btnOneAccept:cc.Button,p_btnOneGet:cc.Button,p_labReelLeft:cc.Label,p_btnReelLeft:cc.Button,p_btnItem1:cc.Button,p_labReelRight:cc.Label,p_btnReelRight:cc.Button,p_btnItem2:cc.Button,p_spConsumeL:cc.Sprite,p_spConsumeR:cc.Sprite},onLoad:function(){this.handleUI(),this.schedule(this.refreshTime,1),this.addEvent()},handleUI:function(){var e=this;this.p_btnRefresh.node.on("click",function(){app.playSound("click"),e.onClickRefresh()}),this.p_btnReelLeft.node.on("click",function(){app.playSound("click"),e.onClickReel("30021")}),this.p_btnReelRight.node.on("click",function(){app.playSound("click"),e.onClickReel("30022")}),this.p_btnOneAccept.node.on("click",function(){app.playSound("click"),e.onClickPick()}),this.p_btnOneGet.node.on("click",function(){app.playSound("click"),e.onClickGet()}),this.p_btnItem1.node.on("click",function(t){app.playSound("click"),e.onClickShowTips(30021,t)}),this.p_btnItem2.node.on("click",function(t){app.playSound("click"),e.onClickShowTips(30022,t)})},refreshUI:function(e){this.m_arrShowData=e,this.setData(),this.refreshView(),this.refreshReelNum(),this.refreshTime(),this.refreshBtnState()},refreshBtnState:function(){var e=this.m_arrShowData.reduce(function(e,t){return 2===t.state?++e:e},0),t=app.player.getCount(38005)>=50,a=Boolean(e)&&t;if(this.p_btnRefresh.enabled!==a){this.p_btnRefresh.enabled=a;var i=this.p_btnRefresh.node.getComponent(cc.Sprite);cc.isValid(i)&&app.setSpriteState(i,!a)}},refreshLv:function(){var e=app.player.getCount(38012)+1;this.p_lavLv.string=langMgr.getString("itnMissionPagePerson",0,e)},refreshView:function(e){if(void 0===e&&(e=!1),this.m_arrShowData){app.setAffairsDataByType("mlist",this.m_arrShowData),cc.log(this.m_arrShowData);var t=this.m_arrShowData.length;e?this.p_tavMission.getComponent("tableView").newReload(this.m_arrShowData.length,{array:this.m_arrShowData,target:this}):this.p_tavMission.getComponent("tableView").initTableView(t,{array:this.m_arrShowData,target:this})}},refreshReelNum:function(){var e,t,a=app.db.getPropsIconPath("30021"),i=app.db.getPropsIconPath("30022");app.loadTexture(a,this.p_spConsumeL,null==(e=app.pages.itnmissionpage.instance)?void 0:e.prefabPath),app.loadTexture(i,this.p_spConsumeR,null==(t=app.pages.itnmissionpage.instance)?void 0:t.prefabPath),this.p_labReelLeft.string=app.player.getCount("30021"),this.p_labReelRight.string=app.player.getCount("30022")},refreshTime:function(){var e=new Date(app.player.getServerTime()),t=new Date(e.getTime()+864e5).setHours(0,0,0,0)-app.player.getServerTime();this.p_labTime.string=langMgr.getString("itnMissionPagePerson",1,gUtils.getHourMinSecTime(t/1e3))},setTaskState:function(e){e&&(e.arrCond=this.setCond(e),e.etime?app.player.getServerTime()>=e.etime?e.state=3:app.player.getServerTime()<e.etime&&(e.state=1):e.state=2)},setData:function(){this.m_arrUsed=[];for(var e=0;e<this.m_arrShowData.length;++e)if(this.setTaskState(this.m_arrShowData[e]),this.m_arrShowData[e].arr&&this.m_arrShowData[e].arr.length>0)for(var t,i=a(this.m_arrShowData[e].arr);!(t=i()).done;){var n=t.value;this.m_arrUsed.push(n)}this.m_arrShowData.sort(function(e,t){var a=app.db.getAffairsInfo(e.id),i=app.db.getAffairsInfo(t.id);return e.state<t.state?1:e.state==t.state&&a.STAR<i.STAR?1:-1})},setCond:function(e){var t=[];-1!=e.gstar&&t.push({type:"star",num:e.gstar}),e.cond.length>1&&e.cond.sort(function(e,t){return e-t});for(var a=0;a<e.cond.length;++a)switch(e.cond[a]){case 1:t.push({type:"camp",num:1});break;case 2:t.push({type:"camp",num:2});break;case 3:t.push({type:"camp",num:3});break;case 4:t.push({type:"camp",num:4});break;case 5:t.push({type:"occu",num:1});break;case 6:t.push({type:"occu",num:2});break;case 7:t.push({type:"occu",num:3});break;case 8:t.push({type:"occu",num:4});break;case 9:t.push({type:"occu",num:5});break;case 10:t.push({type:"occu",num:6})}return t},setPickGData:function(e){for(var t in app.player.general)if(!(e.indexOf(t)>=0||app.player.isTimeLimitGeneral(t)))for(var a=app.player.general[t],i=!1,n=0;n<this.m_arrShowData.length;++n){var r=this.m_arrShowData[n];if(!(2!=r.state||r.pick&&r.pick.length>=r.gnum)){for(var o=0;o<r.arrCond.length;++o){var s=r.arrCond[o];if(!s.ispick){var p=a[s.type];if(r.pick||(r.pick=[]),"star"==s.type){if(p>=s.num){r.pick.push(t),s.ispick=!0,i=!0;break}}else if(p==s.num){r.pick.push(t),s.ispick=!0,i=!0;break}}}if(i)break}}},newSetPickGData:function(e,t){for(var a=t.length,i=(Object.keys(app.player.general).filter(function(t){return!e.includes(t)}),0);i<a;++i){var n=t[i];n.pick&&(n.pick.length,n.gnum)}for(var r in app.player.general)if(!(e.indexOf(r)>=0))for(var o=app.player.general[r],s=!1,p=0;p<t.length;++p){var c=t[p];if(!(2!=c.state||c.pick&&c.pick.length>=c.gnum)){for(var h=0;h<c.arrCond.length;++h){var l=c.arrCond[h];if(!l.ispick){var g=o[l.type];if(c.pick||(c.pick=[]),"star"==l.type){if(g>=l.num){c.pick.push(r),l.ispick=!0,s=!0;break}}else if(g==l.num){c.pick.push(r),l.ispick=!0,s=!0;break}}}if(s)break}}},addNewMisson:function(e){this.m_arrShowData.unshift(e),this.refreshView()},onClickRefresh:function(){for(var e=this,t=0,a=0;a<this.m_arrShowData.length;a++)this.m_arrShowData[a].etime||t++;var i=10*t;if(app.player.checkCount(38005,i)){var n={content:langMgr.getString("itnMissionPagePerson",6,i),confirmcb:function(){app.player.sfAffairsRefresh(function(t){app.player.sfPlayerByParam(["hide","props"],function(){e.refreshUI(t.missions)})})},target:this};app.pages.windowspagetipsmsg.showPage(n)}},onClickPick:function(){var e=this;this.setPickGData(this.m_arrUsed);for(var t=[],a=0;a<this.m_arrShowData.length;++a){var i=this.m_arrShowData[a];2==i.state&&i.pick&&i.pick.length>=i.gnum&&(cc.log(i),i.isTick=!0,t.push(i))}if(t.length<=0)app.showNotice(langMgr.getString("itnMissionPagePerson",2));else{var n={arr:t,target:this,cb:function(t){e.m_arrShowData=t,app.checkPageValid("itnmissionpage")&&(app.pages.itnmissionpage.instance.m_arrPersonData=t),e.setData(),e.refreshView()},canel:function(){for(var t=0;t<e.m_arrShowData.length;++t){var a=e.m_arrShowData[t];2==a.state&&(a.isTick=!1,a.pick=null)}e.setData()}};app.pages.itnpersonpickpage.showPage(n)}},newOnClickPick:function(){var e=this,t=this.m_arrShowData.filter(function(e){return 2==e.state}).map(function(e){var t=app.db.getAffairsInfo(e.id);return e.quality=t.STAR,e}).sort(function(e,t){return e.quality===t.quality?e.id-t.id:t.quality-e.quality});cc.log("===== after sort taskList: ",t),this.newSetPickGData(this.m_arrUsed,t);for(var a=[],i=0;i<this.m_arrShowData.length;++i){var n=this.m_arrShowData[i];2==n.state&&n.pick&&n.pick.length>=n.gnum&&(cc.log(n),n.isTick=!0,a.push(n))}if(a.length<=0)app.showNotice(langMgr.getString("itnMissionPagePerson",2));else{var r={arr:a,target:this,cb:function(t){e.m_arrShowData=t,app.checkPageValid("itnmissionpage")&&(app.pages.itnmissionpage.instance.m_arrPersonData=t),e.setData(),e.refreshView()},canel:function(){for(var t=0;t<e.m_arrShowData.length;++t){var a=e.m_arrShowData[t];2==a.state&&(a.isTick=!1,a.pick=null)}e.setData()}};app.pages.itnpersonpickpage.showPage(r)}},onClickGet:function(){for(var e=this,t=[],a=[],i=0;i<this.m_arrShowData.length;++i){var n=this.m_arrShowData[i];3!=n.state?t.push(n):a.push(n)}a.length<=0?app.showNotice(langMgr.getString("itnMissionPagePerson",3)):app.player.sfAffairsAutoReward("solo",function(a,i){if(a)app.showNotice(a);else{var n={showtype:1,reward:i.reward,confirmcb:function(){e.m_arrShowData=t,app.checkPageValid("itnmissionpage")&&(app.pages.itnmissionpage.instance.m_arrPersonData=t),e.setData(),e.refreshView(),eventMgr.emit(eventStr.redEvent.RefreshAffairRed)}};app.pages.windowspagereward.showPage(n),app.player.addItem(i.reward),app.player.updateItem(i.items),app.player.sfPlayerByParam(["others"],function(){}),cc.isValid(e)&&e.refreshBtnState()}})},onClickReel:function(e){var t=this;app.player.getCount(e)<=0?app.showNotice(langMgr.getString("itnMissionPagePerson",4)):app.player.sfAffairsReel(e,function(a){app.player.reduceItem({gsid:e,count:1}),t.addNewMisson(a),t.setTaskState(a),t.refreshReelNum(),cc.isValid(t)&&t.refreshBtnState();var i=app.db.getAffairsInfo(a.id);if(i){var n=gConfig.getItnMissionSet(i.STAR);n&&app.showNotice(langMgr.getString("itnMissionPagePerson",5,"<outline color="+n.LOCOLOR+" width=1><color="+n.COLOR+">"+i.TITLE+"</color></outline>"))}})},onClickShowTips:function(e){var t={};t.gsid=e,this.m_numCount&&(t.count=app.player.getCount(e)),this.m_strTipsType&&(t.tips="prop"),app.showPropTips(t)},addEvent:function(){cc.director.on("EVT_UPDATE_REFRESH_BTN_STATE",this.refreshBtnState,this)},removeEvent:function(){cc.director.targetOff(this)},onDestroy:function(){this.removeEvent()}}),cc._RF.pop()},{}],itnMissionPage:[function(e,t){"use strict";cc._RF.push(t,"87f2cWze+VEbp+6ZgAabCsZ","itnMissionPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"itnmissionpage"},properties:{p_btnHelp:cc.Button,p_nodePerson:cc.Node,p_nodeFriend:cc.Node,p_btnPrivilege:cc.Button,p_labPrivilegeTime:cc.Label,p_arrNode_Normal:[cc.Node],p_colTipNode:[cc.Color],p_colTipOutLine:[cc.Color]},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!1,255,"#000000"),this.handleUI(),this.fitTopMenu(),this.m_menu=this.node.getComponent("menu"),this.m_menu.init(this),this.refreshByPgts()},onEnable:function(){this._super(),eventMgr.on(eventStr.redEvent.RefreshAffairRed,this.refreshRed,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.redEvent.RefreshAffairRed,this.refreshRed,this)},handleUI:function(){var e=this;this._super(),this.p_btnHelp.node.on("click",function(){app.playSound("click"),app.pages.windowspagetipshelp.showPage("1009")}),this.p_btnPrivilege.node.on("click",function(){app.playSound("click"),e.refreshPrivilegeState(),e.activatePrivilege?app.goToPage(1047):app.pages.windowspagetipsmsg.showPage({content:langMgr.getString("itnMissionPage",4),target:e,confirmcb:function(){app.goToPage(1047)}})},this)},setParam:function(){var e=this;app.player.sfAffairsInfo(function(t,a){if(t)app.showNotice(t);else{if(e.m_arrPersonData=a.mlist||[],e.m_arrFriendData=a.flist||[],e.m_arrBossData=a.blist||[],e.m_menu.setMenuIndex(0),null==localDataUtils.GetValue("itnmissionred",null)){var i=app.player.getServerTime(),n=gUtils.getSecondDayTime(i);localDataUtils.SetValue("itnmissionred",1,n)}e.refreshRed()}}),this.refreshPrivilegeState(),app.runUnlockGuide("ITNMISSION")},refreshPrivilegeState:function(){var e=app.player.getServerTime(),t=app.player.special.specialqz;t||(t=0);var a=t-2592e6;this.activatePrivilege=t>e;var i=this.activatePrivilege?new Date(a).toLocaleDateString()==new Date(e).toLocaleDateString()?langMgr.getString("itnMissionPage",0):langMgr.getString("itnMissionPage",1,this.dealTime(t-e)):langMgr.getString("itnMissionPage",2);this.p_labPrivilegeTime.node.color=this.activatePrivilege?this.p_colTipNode[1]:this.p_colTipNode[0],this.p_labPrivilegeTime.getComponent(cc.LabelOutline).color=this.activatePrivilege?this.p_colTipOutLine[1]:this.p_colTipOutLine[0],i!==this.p_labPrivilegeTime.string&&(this.p_labPrivilegeTime.string=i)},dealTime:function(e){var t=e/1e3/86400|0;return langMgr.getString("itnMissionPage",3,t)},afterBossCloseFresh:function(){var e=this;app.player.sfAffairsInfo(function(t,a){t?app.showNotice(t):(e.m_arrPersonData=a.mlist,e.m_arrFriendData=a.flist,e.m_arrBossData=a.blist,e.m_menu.setMenuIndex(1),e.refreshRed())})},refreshUI:function(){},refreshRed:function(){this.m_menu.refreshRed()},menuHandler:function(e){if(0==e&&!app.db.checkFuncUnLock("ITNMISSION_PERS",!0))return!1;if(1==e&&!app.db.checkFuncUnLock("ITNMISSION_FRIEND",!0))return!1;switch(this.m_numShowMenuIndex=e,this.p_nodePerson.active=0==e,this.p_nodeFriend.active=1==e,e){case 0:this.p_nodePerson.getComponent("itnMissionPagePerson").refreshUI(this.m_arrPersonData);break;case 1:this.p_nodeFriend.getComponent("itnMissionPageFriend").refreshUI(this.m_arrFriendData,this.m_arrBossData,this)}return!0},refreshMenuRed:function(e){switch(e){case 0:return a.checkSolo();case 1:return a.checkFriend()||a.checkBoss()}return!1},onClose:function(){this._super()},refreshByPgts:function(){this.p_arrNode_Normal.forEach(function(e){e.active=!gSetting.checkReviewServ()})}});a.refreshRed=function(e){var t=!1;return t||(t=null==localDataUtils.GetValue("itnmissionred",null)),t||(t=a.checkSolo()),t||(t=a.checkFriend()),t||(t=a.checkBoss()),e&&(e.active=t),t},a.updateMissicon=function(){var e=a.refreshRed();void 0!==app.affairRed&&app.affairRed==e||(app.affairRed=e,eventMgr.emit(eventStr.redEvent.RefreshAffairRed),eventMgr.emit(eventStr.redEvent.RefreshGroundRed),eventMgr.emit(eventStr.redEvent.RefreshMainSceneRed))},a.checkSolo=function(){if(app.getAffairsDataByType("mlist")){var e=app.player.getServerTime(),t=app.getAffairsDataByType("mlist"),a=!1;for(var i in t)if(t[i].etime&&(a=e>=t[i].etime),a)break;return a}return app.getRedInfoByObj(["affair","solo"],0)>0},a.checkFriend=function(){if(app.getAffairsDataByType("flist")){var e=app.player.getServerTime(),t=app.getAffairsDataByType("flist"),a=!1;for(var i in t)if(t[i].etime&&(a=e>=t[i].etime),a)break;return a}return app.getRedInfoByObj(["affair","friend"],0)>0},a.checkBoss=function(){if(app.getAffairsDataByType("blist")){var e=app.player.getServerTime(),t=app.getAffairsDataByType("blist"),a=!1;for(var i in t)if(t[i].etime&&(a=e>=t[i].etime),a)break;return a}return app.getRedInfoByObj(["affair","boss"],0)>0},cc._RF.pop()},{basePage:void 0}],itnMissionReelPage:[function(e,t){"use strict";cc._RF.push(t,"02636pSuBRDlIxS5m423TV5","itnMissionReelPage");var a=[30021,30022,30030,30031],i=cc.Class({extends:e("basePage"),statics:{prefabPath:"itnmissionreelpage"},properties:{p_arrNodeReel:[cc.Node]},onLoad:function(){i.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){this._super()},setParam:function(){this.refreshUI()},refreshUI:function(){var e=this;this.p_arrNodeReel.forEach(function(t,i){t.getComponent("itnMissionReelItem").refreshUI(a[i],e)})},onClose:function(){this._super(),app.player.sfAffairsList(function(e){app.pages.itnmissionpage.instance.setData(e),app.pages.itnmissionpage.instance.refreshUI()})}});cc._RF.pop()},{basePage:void 0}],itnPersonPickPage:[function(e,t){"use strict";cc._RF.push(t,"c8b65mFLSZMyZnNHdkEEMz9","itnPersonPickPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"itnpersonpickpage",pageType:1},properties:{p_tavMission:cc.Node,p_btnConfirm:cc.Button},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){var e=this;this._super(),this.p_btnConfirm.node.on("click",function(){app.playSound("click"),e.onClickConfirm()})},setParam:function(e){this.m_target=e.target,this.m_cb=e.cb,this.m_canel=e.canel,this.m_isOk=!1,this.refreshGView(e.arr)},refreshGView:function(e){this.m_arrShowData=e;var t=this.m_arrShowData.length;this.p_tavMission.getComponent("tableView").initTableView(t,{array:this.m_arrShowData,target:this})},onClickConfirm:function(){var e=this;cc.log(this.m_arrShowData);for(var t={},a=0;a<this.m_arrShowData.length;++a){var i=this.m_arrShowData[a];i.isTick&&(t[i.mid]=i.pick)}cc.log(t),app.player.sfAffairsAutoStart("solo",t,function(t,a){t?cc.log(t):(e.m_isOk=!0,app.player.sfPlayerByParam(["props","books","others"],function(){app.checkPageValid("itnmissionpage")&&e.m_cb&&e.m_cb.call(e.m_target,a),cc.director.emit("EVT_UPDATE_REFRESH_BTN_STATE"),e.onClose()}))})},onClose:function(){this._super(),app.checkPageValid("itnmissionpage")&&!this.m_isOk&&this.m_canel&&this.m_canel.call(this.m_target)}});cc._RF.pop()},{basePage:void 0}],kingpvpFightPage:[function(e,t){"use strict";cc._RF.push(t,"b4a037XsoFF36um8SDwu0Eh","kingpvpFightPage");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=cc._decorator,o=r.ccclass,s=r.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_sprSelfHeadFrame=null,t.p_sprSelfHead=null,t.p_labSelfName=null,t.p_labSelfServer=null,t.p_nodeSelfPower=null,t.p_spSelfImage=null,t.p_arrNodeSelfSex=[],t.p_sprSelfStage=null,t.p_sprSelfStagebg=null,t.p_sprSelfStageLv=null,t.p_nodeSelf=null,t.p_sprEnemyHeadFrame=null,t.p_sprEnemyHead=null,t.p_labEnemyName=null,t.p_labEnemyServer=null,t.p_nodeEnemyPower=null,t.p_spEnemyImage=null,t.p_arrNodeEnemySex=[],t.p_sprEnemyStage=null,t.p_sprEnemyStagebg=null,t.p_sprEnemyStageLv=null,t.p_nodeEnemy=null,t.p_spFlag=null,t.p_spVS=null,t.p_pfbHeadItem=null,t.p_headSelf=null,t.p_headRight=null,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(),this.handleUI()},t.prototype.start=function(){},t.prototype.setParam=function(e){console.log(e),this._enemyInfo=e.playerInfo,this.refreshUI(e)},t.prototype.refreshUI=function(e){var t=this;this.refreshEnemyUI(e.playerInfo),this.refreshSelfUI(e.selfStage);var a=cc.moveTo(.4,cc.v2(-170,-144)),i=cc.moveTo(.4,cc.v2(170,-144));this.p_nodeSelf.runAction(a),this.p_nodeEnemy.runAction(i),this.scheduleOnce(function(){t.startFight()},2.5),app.playSound("kingpvp")},t.prototype.refreshEnemyUI=function(e){var t=this,i=cc.instantiate(this.p_pfbHeadItem);i.parent=this.p_headRight,i.getComponent("headItem").init({iconid:e.iconid,headid:e.headid,frameid:e.frameid,numLevel:e.level,target:this}),this.p_labEnemyName.string=e.rname,this.p_labEnemyServer.string="["+gUtils.getServNameForShow(e.servid)+"]",this.p_nodeEnemyPower.getComponent(cc.Label).string=gUtils.showNum(e.power);var n=e.iconid||10001;app.loadGeneral(n,null,this.p_spEnemyImage,null,function(){t.p_spEnemyImage.node.scaleX=.8,t.p_spEnemyImage.node.scaleY=.8},a.prefabPath),this.p_sprEnemyStage.node.active=!!e.stage;var r=parseInt(String(e.stage).charAt(0)),o=window.gConfig.getIconGStagePath(r-1);if(app.loadTexture(o,this.p_sprEnemyStage,function(){t.p_sprEnemyStage.node.active=!0}),r<=5){var s=parseInt(String(e.stage).charAt(2)),p=window.gConfig.getIconGStageLvlPath(r-1,s-1);app.loadTexture(p,this.p_sprEnemyStageLv,function(){t.p_sprEnemyStageLv.node.active=!0});var c=window.gConfig.getIconGStageLvBgPath(r-1);app.loadTexture(c,this.p_sprEnemyStagebg,this.prefabPath,function(){t.p_sprEnemyStagebg.node.active=!0})}},t.prototype.refreshSelfUI=function(e){var t=this,i=cc.instantiate(this.p_pfbHeadItem);i.parent=this.p_headSelf,i.getComponent("headItem").init({iconid:app.player.iconid,headid:app.player.headid,frameid:app.player.frameid,numLevel:app.player.level,target:this}),this.p_labSelfName.string=app.player.rname,this.p_labSelfServer.string="["+gUtils.getServNameForShow(app.player.servid)+"]",this.p_nodeSelfPower.getComponent(cc.Label).string=gUtils.showNum(app.player.power),app.loadGeneral(app.player.iconid,null,this.p_spSelfImage,null,function(){t.p_spSelfImage.node.scaleX=.8,t.p_spSelfImage.node.scaleY=.8},a.prefabPath),this.p_sprSelfStage.node.active=!!e;var n=parseInt(String(e).charAt(0)),r=window.gConfig.getIconGStagePath(n-1);if(app.loadTexture(r,this.p_sprSelfStage,function(){t.p_sprSelfStage.node.active=!0}),n<=5){var o=parseInt(String(e).charAt(2)),s=window.gConfig.getIconGStageLvlPath(n-1,o-1);app.loadTexture(s,this.p_sprSelfStageLv,function(){t.p_sprSelfStageLv.node.active=!0});var p=window.gConfig.getIconGStageLvBgPath(n-1);app.loadTexture(p,this.p_sprSelfStagebg,this.prefabPath,function(){t.p_sprSelfStagebg.node.active=!0})}},t.prototype.startFight=function(){app.battleType="kingpvpfight",this._enemyInfo.battleset&&(app.kpvpBattleInfo=this._enemyInfo.battleset,app.kpvpEnemyInfo={rname:this._enemyInfo.rname,rid:this._enemyInfo.rid,power:this._enemyInfo.power,iconid:this._enemyInfo.iconid,level:this._enemyInfo.level,stage:this._enemyInfo.stage,star:this._enemyInfo.star},this.onClose(),app.goToNormBattle())},t.prefabPath="kingpvpfightpage",t.pageType=1,n([s(cc.Sprite)],t.prototype,"p_sprSelfHeadFrame",void 0),n([s(cc.Sprite)],t.prototype,"p_sprSelfHead",void 0),n([s(cc.Label)],t.prototype,"p_labSelfName",void 0),n([s(cc.Label)],t.prototype,"p_labSelfServer",void 0),n([s(cc.Node)],t.prototype,"p_nodeSelfPower",void 0),n([s(sp.Skeleton)],t.prototype,"p_spSelfImage",void 0),n([s(cc.Node)],t.prototype,"p_arrNodeSelfSex",void 0),n([s(cc.Sprite)],t.prototype,"p_sprSelfStage",void 0),n([s(cc.Sprite)],t.prototype,"p_sprSelfStagebg",void 0),n([s(cc.Sprite)],t.prototype,"p_sprSelfStageLv",void 0),n([s(cc.Node)],t.prototype,"p_nodeSelf",void 0),n([s(cc.Sprite)],t.prototype,"p_sprEnemyHeadFrame",void 0),n([s(cc.Sprite)],t.prototype,"p_sprEnemyHead",void 0),n([s(cc.Label)],t.prototype,"p_labEnemyName",void 0),n([s(cc.Label)],t.prototype,"p_labEnemyServer",void 0),n([s(cc.Node)],t.prototype,"p_nodeEnemyPower",void 0),n([s(sp.Skeleton)],t.prototype,"p_spEnemyImage",void 0),n([s(cc.Node)],t.prototype,"p_arrNodeEnemySex",void 0),n([s(cc.Sprite)],t.prototype,"p_sprEnemyStage",void 0),n([s(cc.Sprite)],t.prototype,"p_sprEnemyStagebg",void 0),n([s(cc.Sprite)],t.prototype,"p_sprEnemyStageLv",void 0),n([s(cc.Node)],t.prototype,"p_nodeEnemy",void 0),n([s(sp.Skeleton)],t.prototype,"p_spFlag",void 0),n([s(sp.Skeleton)],t.prototype,"p_spVS",void 0),n([s(cc.Prefab)],t.prototype,"p_pfbHeadItem",void 0),n([s(cc.Node)],t.prototype,"p_headSelf",void 0),n([s(cc.Node)],t.prototype,"p_headRight",void 0),a=n([o],t)}(e("basePage"));t.exports=p,cc._RF.pop()},{basePage:void 0}],kingpvpFightResultPage:[function(e,t){"use strict";cc._RF.push(t,"4ae4dZVC3xE2ai7/nUtQRoH","kingpvpFightResultPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"kingpvpfightresultpage",pageType:1},properties:{p_nodeResult:cc.Node,p_nodeContent:cc.Node,p_nodeLeftPortriate:cc.Node,p_nodeRightPortriate:cc.Node,p_labScore:cc.Label,p_nodeSprWin:cc.Node,p_nodeSprLose:cc.Node},onLoad:function(){a.instance=this,this._arrItems=[],this._arrItems.push(this.p_nodeResult),this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){this._super()},setParam:function(e){e?(this.m_objData=e,this._arrVideoInfo=e.resultlist,this._pageFrom=e.pageFrom,app.kpResultPageParam=e,this.refreshUI()):app.showNotice(langMgr.getString("kingpvpFightResultPage",0))},refreshUI:function(){for(var e=0,t=0,a=0;e<this._arrVideoInfo.length;++e){var i=this._arrItems[e];i||((i=cc.instantiate(this.p_nodeResult)).setParent(this.p_nodeContent),this._arrItems.push(i)),i.active=!0,this.m_objData.leftInfo&&(this._arrVideoInfo[e].left.info=Object.assign(this._arrVideoInfo[e].left.info,this.m_objData.leftInfo)),this.m_objData.rightInfo&&(this._arrVideoInfo[e].right.info=Object.assign(this._arrVideoInfo[e].right.info,this.m_objData.rightInfo)),i.getComponent("kingpvpFightResultItem").refreshUI(this._arrVideoInfo,e,this._pageFrom,t,a,this),"win"==this._arrVideoInfo[e].result?a++:t++}for(var n=e;n<this._arrItems.length;++n)this._arrItems[n].active=!1},onClose:function(){this._super()}});cc._RF.pop()},{basePage:void 0}],kingpvpMatchHidePage:[function(e,t){"use strict";cc._RF.push(t,"83877Ke78pP0bDX9dJQm/w1","kingpvpMatchHidePage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"kingpvpmatchhidepage",pageType:1},properties:{p_labMoney:cc.Label,p_btnAdd:cc.Button,p_nodePlayer:cc.Node,p_btnFight:cc.Button,p_btnRematch:cc.Button,p_labTime:cc.Label},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this._rematchCd=9e5,this.rmCdCb=function(){this.refreshTime(),this._timeLeftSec<=0&&(this.unschedule(this.rmCdCb),this.p_labTime.node.active=!1,this.p_btnRematch.interactable=!0)}},handleUI:function(){var e=this;this._super(),this.p_btnAdd.node.on("touchend",function(){app.playSound("click"),e.onClickPlus()}),this.p_btnFight.node.on("click",function(){app.playSound("click"),app.player.getCount(30028)<=0?app.showNotice(langMgr.getString("kingpvpMatchHidePage",0)):!e._enemyInfo.battleset||!e._enemyInfo.battleset.team||gUtils.getTableLength(e._enemyInfo.battleset.team)<=0?app.showNotice(langMgr.getString("kingpvpMatchHidePage",1)):app.player.getCount(90335)<=0?app.player.sfExchange("kingpvp_fight_cost",1,0,function(){e.gotoBattleScene()}):e.gotoBattleScene()}),this.p_btnRematch.node.on("click",function(){app.playSound("click"),e._kingpvpPage.matchEnemy(1),e.onClose()})},gotoBattleScene:function(){app.battleType="kingpvp",app.kpvpBattleInfo=this._enemyInfo.battleset,app.kpvpEnemyInfo={rname:this._enemyInfo.rname,rid:this._enemyInfo.rid,power:this._enemyInfo.power,iconid:this._enemyInfo.iconid,headid:this._enemyInfo.headid,frameid:this._enemyInfo.frameid,level:this._enemyInfo.level,stage:this._enemyInfo.stage,star:this._enemyInfo.star},this.onClose(),app.goToNormBattle()},onClickPlus:function(){var e={gsid:30028,maxcount:Math.floor(app.player.getCount(38005)/20),coin:38005,price:20,type:"buy",confirmcb:this.buyCb,target:this};app.pages.windowspagesetnum.showPage(e)},buyCb:function(e){var t=this;app.player.sfExchange("pvpcoin",e,0,function(){app.showNotice(langMgr.getString("kingpvpMatchHidePage",2)),t.refreshUI()})},setParam:function(e){this._enemyInfo=e.playerInfo,this._bPromotion=e.bPromotion,this._kingpvpPage=e.target,this.refreshUI()},refreshUI:function(){this.p_nodePlayer.getComponent("playerPortraitItem").refreshUI(this._enemyInfo,this),this.p_labMoney.string=app.player.getCount(30028),this._bPromotion?(this.p_labTime.node.active=!1,this.p_btnRematch.interactable=!1):(new Date(app.player.getServerTime()).getTime()-this._enemyInfo.time)/1e3/60>=15?(this.p_labTime.node.active=!1,this.p_btnRematch.interactable=!0):(this.p_labTime.node.active=!0,this.p_btnRematch.interactable=!1,this.schedule(this.rmCdCb,1),this.refreshTime())},refreshTime:function(){var e=new Date(app.player.getServerTime());this._timeLeftSec=(this._rematchCd-(e.getTime()-this._enemyInfo.time))/1e3,this.p_labTime.string=gUtils.getHourMinSecTime(this._timeLeftSec)}});cc._RF.pop()},{basePage:void 0}],kingpvpMatchPage:[function(e,t){"use strict";cc._RF.push(t,"0965e6hBxFHb4GAinfU4jTW","kingpvpMatchPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"kingpvpmatchpage",pageType:1},properties:{p_labMoney:cc.Label,p_btnAdd:cc.Button,p_nodePlayer:cc.Node,p_nodeBattleArr:[cc.Node],p_nodeBattleArrContent:[cc.Node],p_nodeBattleArrItem:cc.Node,p_nodeAtlasPower:cc.Node,p_btnFight:cc.Button,p_btnRematch:cc.Button,p_labTime:cc.Label,p_updateLayout:[cc.Layout]},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.m_arrItems=[],this.m_arrItems.push(this.p_nodeBattleArrItem),this._rematchCd=9e5,this.rmCdCb=function(){this.refreshTime(),this._timeLeftSec<=0&&(this.unschedule(this.rmCdCb),this.p_labTime.node.active=!1,this.p_btnRematch.interactable=!0)},"JP"===gSetting.getLangName()&&(this.p_btnRematch.node.setContentSize(cc.size(235,67)),this.p_btnFight.node.setContentSize(cc.size(235,67)))},handleUI:function(){var e=this;this._super(),this.p_btnAdd.node.on("touchend",function(){app.playSound("click"),e.onClickPlus()}),this.p_btnFight.node.on("click",function(){app.playSound("click"),app.player.getCount(30028)<2?app.showNotice(langMgr.getString("kingpvpMatchPage",0)):!e._enemyInfo.battleset||e._enemyInfo.battleset.length<=0||gUtils.getTableLength(e._enemyInfo.battleset[0].team)<=0?app.showNotice(langMgr.getString("kingpvpMatchPage",1)):e.startFight()}),this.p_btnRematch.node.on("click",function(){app.playSound("click"),e._kingpvpPage.matchEnemy(1),e.onClose()})},startFight:function(){app.battleType="kingpvpfight",app.kpvpBattleInfo=this._enemyInfo.battleset,app.kpvpEnemyInfo={rname:this._enemyInfo.rname,rid:this._enemyInfo.rid,power:this._enemyInfo.power,iconid:this._enemyInfo.iconid,level:this._enemyInfo.level,stage:this._enemyInfo.stage,star:this._enemyInfo.star},this.onClose(),app.goToNormBattle()},onClickPlus:function(){var e=Math.floor(app.player.getCount(38005)/20);if(e<1)app.showNotice(langMgr.getString("public",23));else{var t={gsid:30028,maxcount:e,coin:38005,price:20,type:"buy",confirmcb:this.buyCb,target:this};app.pages.windowspagesetnum.showPage(t)}},buyCb:function(e){var t=this;app.player.sfExchange("pvpcoin",e,0,function(){app.showNotice(langMgr.getString("kingpvpMatchPage",2)),t.refreshUI()})},setParam:function(e){this._enemyInfo=e.playerInfo,this._bPromotion=e.bPromotion,this._kingpvpPage=e.target,this.refreshUI()},refreshUI:function(){if(this._enemyInfo){this.p_nodePlayer.getComponent("playerPortraitItem").refreshUI(this._enemyInfo,this),this.p_labMoney.string=app.player.getCount(30028),this.p_nodeAtlasPower&&this.p_nodeAtlasPower.getComponent("num").init(this._enemyInfo.power);var e=this._enemyInfo.battleset;this.refreshTeam(e);var t=!1;this._bPromotion?(this.p_labTime.node.active=!1,this.p_btnRematch.interactable=!1,t=!0):(new Date(app.player.getServerTime()).getTime()-this._enemyInfo.time)/1e3/60>=15?(this.p_labTime.node.active=!1,this.p_btnRematch.interactable=!0,app.setSpriteState(this.p_btnRematch.getComponentInChildren(cc.Sprite),!0)):(this.p_labTime.node.active=!0,this.p_btnRematch.interactable=!1,t=!0,this.schedule(this.rmCdCb,1),this.refreshTime()),app.setSpriteState(this.p_btnRematch.getComponentInChildren(cc.Sprite),t),this.updatePos()}},updatePos:function(){this.p_updateLayout.forEach(function(e){e.updateLayout()})},refreshTeam:function(e){for(var t=0,a=0;a<this.p_nodeBattleArr.length;a++){var i=this.p_nodeBattleArr[a];if(e[a]&&e[a].team){var n=this.p_nodeBattleArrContent[a],r=e[a].team;for(var o in r){var s=this.m_arrItems[t++];s||((s=cc.instantiate(this.p_nodeBattleArrItem)).parent=n,this.m_arrItems.push(s)),s.active=!0;var p=app.db.getGBaseByGsid(r[o].gsid);s.getComponent("generalPortraitItem").initReport(p,r[o])}}i.active=e[a]&&e[a].team}for(var c=t;c<this.m_arrItems.length;++c)this.m_arrItems[c].active=!1},refreshTime:function(){var e=new Date(app.player.getServerTime());this._timeLeftSec=(this._rematchCd-(e.getTime()-this._enemyInfo.time))/1e3,this.p_labTime.string=gUtils.getHourMinSecTime(this._timeLeftSec)}});cc._RF.pop()},{basePage:void 0}],kingpvpMissionPage:[function(e,t){"use strict";cc._RF.push(t,"fa5198/ffZE1rD+AWqe5b0f","kingpvpMissionPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"kingpvpmissionpage",pageType:1},properties:{p_tabvDaily:cc.tableView,p_labTime:cc.Label},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.schedule(this.refreshTime,1)},handleUI:function(){this._super()},refreshTime:function(){app.player.getServerTime();var e=app.pages.kingpvppage.getKingPvpState();e.state>0?this.p_labTime.string=gUtils.getCountDownStr(e.totalTime):this.p_labTime.string=langMgr.getString("prefab",256)},setParam:function(){this.m_arrShowData=this.setDailyData(),this.refreshUI()},setDailyData:function(){for(var e=[],t=app.db.dbKingMissionDaily,a=0;a<t.length;++a){var i=t[a];i.PMARK&&"all"!=i.PMARK&&(i.ID=a,e.push(i))}return e.sort(function(e,t){var a=app.player.getMissionState(e).state,i=app.player.getMissionState(t).state;return a<i?1:a==i&&e.ID>t.ID?1:-1}),e},refreshUI:function(){if(this.refreshTime(),this.m_arrShowData){var e=this.m_arrShowData.length;this.p_tabvDaily.getComponent("tableView").initTableView(e,{array:this.m_arrShowData,target:this})}},reloadView:function(){this.m_arrShowData&&(this.m_arrShowData=this.setDailyData(),this.p_tabvDaily.getComponent("tableView").reload({array:this.m_arrShowData,target:this}))},refreshDailyAll:function(){}});a.refreshRed=function(e){for(var t=app.db.dbKingMissionDaily,a=!1,i=0;i<t.length;++i){var n=t[i];if(3==app.player.getMissionState(n).state){a=!0;break}}return e&&(e.active=a),a},cc._RF.pop()},{basePage:void 0}],kingpvpPage:[function(e,t){"use strict";cc._RF.push(t,"a5627HPFBNGX6fytX1PKsEE","kingpvpPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"kingpvppage"},properties:{p_rankTabView:cc.tableView,p_labRankTips:cc.Label,p_nodeSelfinfo:cc.Node,p_arrSprFight:[cc.Sprite],p_labLocPromTitle:cc.Label,p_labMoney:cc.Label,p_btnAdd:cc.Button,p_btnMatch:cc.Button,p_btnTips:cc.Button,p_nodeStage:cc.Node,p_labKingTips:cc.Label,p_labKingpvpTime:cc.Label,p_labServGroupInfo:cc.Label,p_btnReward:cc.Button,p_btnRecord:cc.Button,p_btnMission:cc.Button,p_btnSetLineup:cc.Button,p_nodeLoading:cc.Node,p_nodeMaskLoading:cc.Node,p_arrSprLoadPoint:[cc.Sprite],p_btnCancel:cc.Button,p_nodeStageInfo:cc.Node,p_nodeMaskSpine:cc.Node,p_sprStageTxt:cc.Sprite,p_sprStageLvl:cc.Sprite,p_sprStageLvlBg:cc.Sprite,p_nodeSprStars:cc.Node,p_arrStar:[cc.Node],p_labStarMaster:cc.Label,p_animMaster:cc.Animation,p_sprCloseTitle:cc.Sprite,p_spLostStar:sp.Skeleton,p_spLostStarKing:sp.Skeleton,p_sprLocateFinish:cc.Sprite,p_sprPromotionSucc:cc.Sprite,p_sprPromotionFailed:cc.Sprite,p_sprPromotionActive:cc.Sprite,p_sprBattleSucc:cc.Sprite,p_sprBattleFail:cc.Sprite,p_testButton:cc.Button,p_loadMask:cc.Node,p_loadMasklab:cc.Label,p_loadMaskedit:cc.EditBox,p_spLiansheng:cc.Sprite,p_sprStage:cc.Sprite,p_spShineAnim:sp.Skeleton,p_nodeWangzheStar:cc.Node,p_labWangStarNum:cc.Label,p_nodeStageInfoBgSucc:cc.Node,p_nodeStageInfoBgFail:cc.Node,p_nodeStageInfoLvBgSucc:cc.Node,p_nodeStageInfoLvBgFail:cc.Node,p_arrStageInfoSprFight:[cc.Sprite]},m_isShowStage:!1,onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(),this.handleUI(),this.fitTopMenu(),this.stopNodePropagation(this.p_nodeMaskLoading),this.stopNodePropagation(this.p_nodeSelfinfo),this.stopNodePropagation(this.p_nodeStageInfo),this.stopNodePropagation(this.p_nodeMaskSpine),this._bMatchLoading=!1,this._secTimer=0,this._timeCount=0,this._bMatchEnd=!1,this._rankType=0,this._cantWatch=!1,this.p_nodeLoading.active=!1,this.p_nodeStageInfo.active=!1,this._bKpOpen=!1,this._bKpSeasonQuery=!1,this.nextTime=0},stopNodePropagation:function(e){e.on("touchstart",function(e){e.stopPropagation()}),e.on("touchmove",function(e){e.stopPropagation()}),e.on("touchend",function(e){e.stopPropagation()})},handleUI:function(){var e=this;this._super(),this.p_btnMatch.node.on("click",function(){app.playSound("click"),e.matchEnemy(0)}),this.p_btnTips.node.on("click",function(){app.playSound("click"),app.pages.windowspagetipshelp.showPage("1015")}),this.p_btnReward.node.on("click",function(){app.playSound("click"),app.pages.kingpvprewardpage.showPage(e._myStageInfo)}),this.p_btnRecord.node.on("click",function(){app.playSound("click"),app.pages.kingpvpreplaypage.showPage()}),this.p_btnMission.node.on("click",function(){app.playSound("click"),app.pages.kingpvpmissionpage.showPage()}),this.p_btnSetLineup.node.on("click",function(){app.playSound("click"),e._bKpOpen||app.db.checkBattleArrTeam("kingpvp1")&&app.db.checkGeneralExist("kingpvp1")?(app.playSound("click"),app.battleType="kingpvpsave",app.goToNormBattle()):app.showNotice(langMgr.getString("kingpvpPage",10))}),this.p_btnCancel.node.on("click",function(){app.playSound("click"),e._timeCount=0,e._bMatchEnd=!1,e._bMatchLoading=!1,app.kpMatchData=null,e.p_nodeLoading.active=!1}),this.p_nodeStage.on("touchend",function(){app.pages.kingpvpstageinfopage.showPage(e._myStageInfo)}),this.total=10,this.p_testButton.node.on("click",function(){if(cc.sys.isNative||"dev"!=gSetting.channel){app.playSound("click"),e.p_loadMask.active=!0;var t=Number(e.p_loadMaskedit.string);e.total=Math.max(t,1),e.goToBattle()}}),this.p_nodeStageInfo.on("touchend",function(){e.m_isShowStage||(e.p_nodeStageInfo.active=!1,e.p_spLiansheng.node.active=!1)})},goToBattle:function(){var e=this;this.p_loadMasklab.string=this._ind+"/"+this.total,app.kpMatchData?app.player.sfKpStart(function(t,a){t?e.refreshTest():app.player.sfKpEnd(a.battleid,function(t){t?e.refreshTest():(e._ind++,e._ind>=e.total?e.refreshTest():e.goToBattle())})}):app.player.sfKpSearchEnemy({force:0},function(t,a){if(t)return"time limit"==t?t=langMgr.getString("kingpvpPage",11):"not open"==t?t=langMgr.getString("kingpvpPage",12):"battleset nexist"==t?t=langMgr.getString("kingpvpPage",13):"no targets"==t&&(t=langMgr.getString("kingpvpPage",14)),app.showNotice(t),void e.refreshTest();app.kpMatchData=a,app.player.sfKpStart(function(t,a){t?e.refreshTest():app.player.sfKpEnd(a.battleid,function(t){t?e.refreshTest():(e._ind++,e._ind>=e.total?e.refreshTest():(app.kpMatchData=null,e.goToBattle()))})})})},refreshTest:function(){var e=this;this.p_loadMask.active=!1,app.kpMatchData=null;var t={uid:app.player.uid,servid:app.player.servid};app.player.sfKpStageInfo(t,function(t,a){t||cc.isValid(e)&&(app.KPSTAGEINFO=a,e.setParam(a))})},refreshYwl:function(){this.node.getComponent("currency").refreshCoin([{type:"ywl",gsid:30028}])},onEnable:function(){this._super(),eventMgr.on(eventStr.commonEvent.RefreshTime,this.refreshKpTime,this),eventMgr.on(eventStr.gsidCommon.ywl,this.refreshYwl,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.commonEvent.RefreshTime,this.refreshKpTime,this),eventMgr.off(eventStr.gsidCommon.ywl,this.refreshYwl,this),this.p_spLiansheng.node.active=!1},setParam:function(e){var t=this;this._myStageInfo=e,this._ind=0,this.p_loadMask.active=!1,this.refreshUI(),this.refreshRankStage("pvpstage"),app.crossServGroupInfo?this.setCrossServGroup():app.player.sfCsGetServinfo(function(e,a){e||(app.crossServGroupInfo=a,t.setCrossServGroup())}),localDataUtils.SetValue("kingpvpred",1,this.nextTime),app.runUnlockGuide("WANG_PVP")},setCrossServGroup:function(){var e=[];if(app.crossServGroupInfo.list.length>0)for(var t=0;t<app.crossServGroupInfo.list.length;t++){var a=gUtils.getServNameForShow(app.crossServGroupInfo.list[t].servid);e.push(a)}else{var i=gUtils.getServNameForShow(app.player.servid);e.push(i)}e=e.join(","),this.p_labServGroupInfo.string=langMgr.getString("kingpvpPage",0,e)},afterBattleFresh:function(){this.displayStageSpine(),this.refreshRankStage("pvpstage"),this.refreshRed(),this.refreshYwl()},getKpResonanceLineup:function(){app.kpResonanceLineup={};for(var e=0;e<gConfig.KPLINEUP.length;++e){var t=gConfig.KPLINEUP[e];if(app.player.battlearr[t]){app.kpResonanceLineup[t]=gUtils.deepClone(app.player.battlearr[t]);var a={};for(var i in app.kpResonanceLineup[t].team)if(app.player.general[app.kpResonanceLineup[t].team[i]]){a[i]=gUtils.deepClone(app.player.general[app.kpResonanceLineup[t].team[i]]);var n=a[i],r=!1;n.level<140&&(n.level=140,r=!0),n.star<6&&(n.star=6,r=!0),n.class<6&&(n.class=6,r=!0),n.bResonance=r}app.kpResonanceLineup[t].team=a;var o=app.db.getPveProperInfo(app.kpResonanceLineup[t].team);for(var s in app.kpResonanceLineup[t].team)app.kpResonanceLineup[t].team[s].power=o.team[s].power}}},displayStageSpine:function(){var e=this;app.kpvpStageInfo&&app.kpvpStageInfo.stageinfo&&(this._myStageInfo.stage=app.kpvpStageInfo.stageinfo.stage,this._myStageInfo.star=app.kpvpStageInfo.stageinfo.star,app.KPSTAGEINFO=app.kpvpStageInfo.stageinfo),this._myStageInfo.locate=app.kpvpStageInfo.locate;var t=null;if(app.kpvpStageInfo&&app.kpvpStageInfo.promotion&&app.kpvpStageInfo.stageinfo?(app.kpvpStageInfo.promotion&&app.kpvpStageInfo.promotion.length>=2&&0==app.kpvpStageInfo.stageinfo.star&&app.kpvpStageInfo.stageinfo.schange,app.kpvpStageInfo.promotion&&app.kpvpStageInfo.promotion.length>=2&&0!=app.kpvpStageInfo.stageinfo.star&&app.kpvpStageInfo.stageinfo.schange,t=app.kpvpStageInfo.promotion):t=app.kpvpStageInfo.promotion,app.KPSTAGEINFO.promotion=t,this._myStageInfo.promotion=t,this.refreshMyRankInfo(),app.kpvpStageInfo&&app.kpvpStageInfo.stageinfo){this.m_isShowStage=!0,this.scheduleOnce(function(){e.m_isShowStage=!1},1.5),this.p_nodeStageInfo.active=!0,this.p_sprCloseTitle.node.active=!1,this.p_spLiansheng.node.active=app.kpvpStageInfo.stageinfo.schange>1,this.p_nodeStageInfoBgSucc.active=!0,this.p_nodeStageInfoBgFail.active=!1,this.p_nodeStageInfoLvBgSucc.active=!0,this.p_nodeStageInfoLvBgFail.active=!1;var a=app.kpvpStageInfo.locate,i=app.kpvpStageInfo.promotion,n=app.kpvpStageInfo.stageinfo,r=parseInt(String(n.stage).charAt(0)),o=a&&5==a.length&&0==n.star&&0==n.schange;this.p_sprLocateFinish.node.active=o;var s=i&&i.length>=2&&0==n.star&&0==n.schange,p=i&&i.length>=2&&0!=n.star&&n.schange<0,c=5==n.star&&r<=5&&(!i||0==i.length);this.p_sprPromotionSucc.node.active=s,this.p_sprPromotionFailed.node.active=p,this.p_sprPromotionActive.node.active=c,(p||n.schange<0)&&(this.p_nodeStageInfoBgSucc.active=!1,this.p_nodeStageInfoBgFail.active=!0,this.p_nodeStageInfoLvBgSucc.active=!1,this.p_nodeStageInfoLvBgFail.active=!0);var h=this.checkPromotionSuccess(),l=this.checkLvlChange();this.refreshSpineStageInfo(h,l,r)}},checkPromotionSuccess:function(){return!(!app.kpvpStageInfo||!app.kpvpStageInfo.promotion)&&app.kpvpStageInfo.promotion&&app.kpvpStageInfo.promotion.length>0&&0==app.kpvpStageInfo.stageinfo.star},checkLvlChange:function(){return!(!app.kpvpStageInfo||!app.kpvpStageInfo.stageinfo)&&(1==app.kpvpStageInfo.stageinfo.star&&2==app.kpvpStageInfo.stageinfo.schange||0==app.kpvpStageInfo.stageinfo.star&&app.kpvpStageInfo.stageinfo.schange>0)},refreshSpineStageInfo:function(e,t,a){var i=this,n=parseInt(String(app.kpvpStageInfo.stageinfo.stage).charAt(0))-1,r=gConfig.getIconGStagePath(n);this.p_sprStage.node.active=!1,app.loadTexture(r,this.p_sprStage,this.prefabPath,function(){i.p_sprStage.node.active=!0}),parseInt(String(app.kpvpStageInfo.stageinfo.stage).charAt(2));var o=gConfig.getIconGStageLargePath(a-1);this.p_sprStageTxt.node.active=!1,app.loadTexture(o,this.p_sprStageTxt,this.prefabPath,function(){i.p_sprStageTxt.node.active=!0}),this.p_sprStageLvl.node.active=!1,this.p_sprStageLvlBg.node.active=!1;var s=parseInt(String(app.kpvpStageInfo.stageinfo.stage).charAt(2));if(a<=5){var p=gConfig.getIconGStageLvlPath(e?a-2:a-1,e?4:t?s-2:s-1);app.loadTexture(p,this.p_sprStageLvl,this.prefabPath,function(){i.p_sprStageLvl.node.active=!0}),this.p_sprStageLvlBg.node.active=!0}this.p_spShineAnim.node.active=!1,t&&(this.p_spShineAnim.node.active=!0,this.p_spShineAnim.setAnimation(0,"shengji01",!1),this.p_spShineAnim.setCompleteListener(function(){app.loadTexture(gConfig.getIconGStageLvlPath(a-1,s-1),i.p_sprStageLvl,i.prefabPath)}));var c=app.kpvpStageInfo.stageinfo.star,h=t&&1==app.kpvpStageInfo.stageinfo.star?1:app.kpvpStageInfo.stageinfo.schange;if(this.p_nodeWangzheStar.active=a>5,this.p_spLostStar.node.active=!1,this.p_spLostStarKing.node.active=!1,this.p_arrStar.map(function(e){e.active=!1,e.getChildByName("anim").active=!1,e.getChildByName("anim").getComponent(sp.Skeleton).clearTrack()}),this.p_arrStageInfoSprFight.map(function(e){return e.node.active=!1}),this.p_sprBattleFail.node.active=!1,this.p_sprBattleSucc.node.active=!1,a>5)this.p_nodeSprStars.active=!1,h<0?(this.p_sprBattleFail.node.active=!0,this.p_labWangStarNum.string=c):(this.p_sprBattleSucc.node.active=!0,this.p_labWangStarNum.string=c);else if(h<0)if(this.p_nodeSprStars.active=!0,c>=5)for(var l=0;l<c;l++)this.p_arrStar[l].active=!0,this.p_arrStar[l].getChildByName("anim").active=!0,this.p_arrStar[l].getChildByName("anim").getComponent(sp.Skeleton).setAnimation(0,"3",!1);else{for(var g=0;g<c;g++)this.p_arrStar[g].active=!0,this.p_arrStar[g].getChildByName("anim").active=!0,this.p_arrStar[g].getChildByName("anim").getComponent(sp.Skeleton).setAnimation(0,"3",!1);var d=this.p_arrStar[c];d&&(d.active=!0,d.getChildByName("anim").active=!0,d.getChildByName("anim").getComponent(sp.Skeleton).setAnimation(0,"2",!1),this.scheduleOnce(function(){d.active=!1},1))}else if(0==h&&app.kpvpStageInfo.promotion){this.p_nodeSprStars.active=!1;var u=app.db.dbKingStage.find(function(e){return e.ID==app.kpvpStageInfo.stageinfo.stage});u||(u=app.db.dbKingStage.find(function(e){return e.ID==app.kpvpStageInfo.stageinfo.stage-96}));for(var f=u.PROMNUM,m=gConfig.rootPath.uikppage+"stage/",_=function(e){var t;t=app.kpvpStageInfo.promotion&&app.kpvpStageInfo.promotion[e]?m+("win"==app.kpvpStageInfo.promotion[e]?"match_win":"match_lose"):m+"match_undo",app.loadTexture(t,i.p_arrStageInfoSprFight[e],i.prefabPath,function(){i.p_arrStageInfoSprFight[e].node.active=!0})},v=0;v<f;++v)_(v)}else{this.p_nodeSprStars.active=!0;for(var b=0;b<c-1;b++)this.p_arrStar[b].active=!0,this.p_arrStar[b].getChildByName("anim").active=!0,this.p_arrStar[b].getChildByName("anim").getComponent(sp.Skeleton).setAnimation(0,"3",!1);var y=this.p_arrStar[c-1];y&&(y.active=!0,y.getChildByName("anim").active=!0,y.getChildByName("anim").getComponent(sp.Skeleton).setAnimation(0,"1",!1))}},refreshKpTime:function(){if(app.PVPOPENTIME&&app.PVPOPENTIME.kingpvp){var e=app.player.getServerTime(),t=a.getKingPvpState();switch(t.state){case 0:if(this._bKpOpen){if(app.showNotice(langMgr.getString("kingpvpPage",16)),"expeditionpage"!==app.arrPages[app.arrPages.length-1]){var i=app.arrPages[app.arrPages.length-1];app.pages[i].instance&&app.pages[i].instance.onClose()}return void this.onClose()}this.p_labKingTips.string=langMgr.getString("kingpvpPage",1),this.p_labKingpvpTime.string=gUtils.getCountDownStr(t.totalTime),this.nextTime=null;break;case 1:this.p_labKingTips.string=langMgr.getString("kingpvpPage",2),this.p_labKingpvpTime.string=gUtils.getCountDownStr(t.totalTime),this.nextTime=e+t.totalTime,localDataUtils.GetValue("kingpvptime",null)||localDataUtils.SetValue("kingpvptime",this.nextTime);break;case 2:this.p_labKingpvpTime.string=langMgr.getString("kingpvpPage",3),this.p_labKingTips.string=langMgr.getString("kingpvpPage",4),this.nextTime=0}}},refreshUI:function(){this.refreshYwl(),this._bKpOpen=app.pages.pvpentrancepage.checkKingPvpOpen(),this.p_labKingTips.string=this._bKpOpen?langMgr.getString("kingpvpPage",2):langMgr.getString("kingpvpPage",1),this.refreshKpTime(),this.p_nodeSelfinfo.active=this._bKpOpen,this.p_btnMatch.node.active=this._bKpOpen,this.refreshRed()},menuHandler:function(e){switch(this._rankType=e,e){case 0:case 1:this.refreshRankStage("pvpstage")}},refreshRed:function(){app.pages.kingpvpmissionpage.refreshRed(this.p_btnMission.node.getChildByName("rednotice")),this.p_btnSetLineup.node.getChildByName("rednotice").active=app.pages.kingpvppage.checkLineupRed()},refreshRankStage:function(e){var t=this;if(!this._bKpOpen&&!app.pages.kingpvppage.checkCanEnter())return this.p_labRankTips.string=langMgr.getString("kingpvpPage",5),void(this.p_labRankTips.node.active=!0);app.player.sfRankByType(e,function(a,i){if(cc.isValid(t.node)){var n=i.list||[];i.list=n.map(function(e){var t=(e.score+100).toString();return e.stage=t.charAt(0)+"0"+(+t.charAt(1)+1),e.star=t.charAt(2),e}),t._rankInfo=i,a?("cant watch"==a?(t.p_labRankTips.string=langMgr.getString("kingpvpPage",6),t.p_labRankTips.node.active=!0,t._cantWatch=!0):app.showNotice(a),t.p_rankTabView.getComponent("tableView").clear()):"pvpking"==e&&0==t._rankInfo.list.length?(t.p_labRankTips.string=langMgr.getString("kingpvpPage",7),t.p_labRankTips.node.active=!0,t.p_rankTabView.getComponent("tableView").clear()):(t.p_labRankTips.node.active=!1,t._cantWatch=!1,t.p_rankTabView.getComponent("tableView").initTableView(t._rankInfo.list.length,{array:t._rankInfo.list,target:t})),t.refreshMyRankInfo()}})},refreshMyRankInfo:function(){var e=this;if(this._myStageInfo){this._bPromotion=!1,this._bLocate=!1;for(var t=0;t<5;++t)this.p_arrSprFight[t].node.active=!1;var a=parseInt(String(this._myStageInfo.stage).charAt(0)),i=parseInt(String(this._myStageInfo.stage).charAt(2)),n=gConfig.rootPath.uikppage+"stage/";if(this._myStageInfo.locate&&this._myStageInfo.locate.length<5){for(var r=function(t){var a;a=e._myStageInfo.locate&&e._myStageInfo.locate[t]?n+("win"==e._myStageInfo.locate[t]?"match_win":"match_lose"):n+"match_undo",app.loadTexture(a,e.p_arrSprFight[t],e.prefabPath,function(){e.p_arrSprFight[t].node.active=!0})},o=0;o<5;++o)r(o);this._bLocate=!0}else if(this._myStageInfo.promotion&&5==i){for(var s=app.db.dbKingStage.find(function(t){return t.ID==e._myStageInfo.stage}).PROMNUM||(5==a?5:3),p=function(t){var a;a=e._myStageInfo.promotion&&e._myStageInfo.promotion[t]?n+("win"==e._myStageInfo.promotion[t]?"match_win":"match_lose"):n+"match_undo",app.loadTexture(a,e.p_arrSprFight[t],e.prefabPath,function(){e.p_arrSprFight[t].node.active=!0})},c=0;c<s;++c)p(c);this._bPromotion=!0}this.p_labLocPromTitle.node.active=this._bPromotion||this._bLocate,this._bPromotion&&(this.p_labLocPromTitle.string=langMgr.getString("kingpvpPage",8)),this._bLocate&&(this.p_labLocPromTitle.string=langMgr.getString("kingpvpPage",9)),this.p_labLocPromTitle.node.x=this._bPromotion?183:276.469;for(var h={stage:this._myStageInfo.stage,ranktype:this._rankType,cantwatch:this._cantWatch,rname:app.player.rname,rid:app.player.rid,power:app.player.power,level:app.player.level,servid:app.player.servid,iconid:app.player.iconid,frameid:app.player.frameid,lname:app.player.legion},l=0,g=0;g<gConfig.pvpSysBattleForm.king.length;++g)if(app.player.battlearr[gConfig.pvpSysBattleForm.king[g]]){var d=app.player.battlearr[gConfig.pvpSysBattleForm.king[g]].team;for(var u in d){var f=app.player.general[d[u]];f&&(l+=f.power)}}h.power=l,this._rankInfo&&(h.rank=this._rankInfo.selfrank),!this._bPromotion&&(h.star=this._myStageInfo.star),h.headid=app.player.headid,this.p_nodeSelfinfo.getComponent("kingpvpRankItem").setRankInfo(h),this.p_nodeSelfinfo.getComponent("kingpvpRankItem").refreshUI()}},refreshLoadingPoint:function(){var e=this.p_arrSprLoadPoint;if(e[e.length-1].node.active)this.p_arrSprLoadPoint.forEach(function(e){e.node.active=!1});else for(var t=0;t<e.length;++t)if(!e[t].node.active){e[t].node.active=!0;break}},matchEnemy:function(e){var t=this;if(app.player.getCount(30028)<2)app.showNotice(langMgr.getString("kingpvpMatchPage",0));else if(app.kpMatchData&&0==e)this.showMatchPage(app.kpMatchData);else{this._bMatchLoading=!0,this.p_nodeLoading.active=!0,this.p_arrSprLoadPoint.forEach(function(e){e.node.active=!1});var a={force:e};app.player.sfKpSearchEnemy(a,function(a,i){if(a)return t._timeCount=0,t._bMatchEnd=!1,t._bMatchLoading=!1,t.p_nodeLoading.active=!1,"time limit"==a?a=langMgr.getString("kingpvpPage",11):"not open"==a?a=langMgr.getString("kingpvpPage",12):"battleset nexist"==a?a=langMgr.getString("kingpvpPage",13):"no targets"==a&&(a=langMgr.getString("kingpvpPage",14)),void app.showNotice(a);1==e?app.player.sfPlayerByParam(["others"],function(){app.kpMatchData=i,t._bMatchEnd=!0,!app.kpMatchData.rno&&(app.kpMatchData.rno=String(gUtils.getRandomInt(1e6,9999999)))}):(app.kpMatchData=i,t._bMatchEnd=!0,!app.kpMatchData.rno&&(app.kpMatchData.rno=String(gUtils.getRandomInt(1e6,9999999))))})}},update:function(e){this._bMatchLoading&&(this._secTimer+=e,this._secTimer>=1&&(this._secTimer=0),this._timeCount+=e,this._bMatchEnd&&this._timeCount>=1&&(this._timeCount=0,this._bMatchEnd=!1,this._bMatchLoading=!1,this.p_nodeLoading.active=!1,this.showMatchPage(app.kpMatchData)),this._timeCount>10&&(this._timeCount=0,this._bMatchEnd=!1,this._bMatchLoading=!1,this.p_nodeLoading.active=!1,app.showNotice(langMgr.getString("kingpvpPage",17))))},showMatchPage:function(e){var t=0;if(e.battleset)for(var a in e.battleset){var i=e.battleset[a];for(var n in i.team){var r=i.team[n];r.property&&(t+=app.db.getPropertyPower(r.property))}}0!=t&&(e.power=t);var o={playerInfo:e,bPromotion:this._bPromotion,pageType:"match",target:this,selfStage:this._myStageInfo.stage};app.pages.kingpvpfightpage.showPage(o)},onClose:function(){this._super(),eventMgr.emit(eventStr.redEvent.RefreshPVPEntranceRed)}});a.showPage=function(t,a,i){var n=this;if(app.PVPOPENTIME&&app.PVPOPENTIME.kingpvp){var r=app.pages.kingpvppage.getKingPvpState();if(app.KPSTAGEINFO)e("basePage").showPage.call(this,app.KPSTAGEINFO,a,i);else if(r.state>0){var o={uid:app.player.uid,servid:app.player.servid};app.player.sfKpStageInfo(o,function(t,r){if(cc.isValid(n))if(t){if("regist first"==t){t="\u9635\u5bb9\u4fe1\u606f\u5f02\u5e38\uff0c\u8bf7\u91cd\u65b0\u8bbe\u7f6e\u9635\u5bb9",app.player.battlearr.kingpvp1=null;var o={content:langMgr.getString("kingpvpPage",21),confirmcb:function(){app.battleType="kingpvpsave",app.goToNormBattle()},target:n};return void app.pages.windowspagetipsmsg.showPage(o)}"api lock"!=t&&app.showNotice(t)}else app.KPSTAGEINFO=r,e("basePage").showPage.call(n,r,a,i)})}else e("basePage").showPage.call(this,app.KPSTAGEINFO,a,i)}else app.showNotice(langMgr.getString("kingpvpPage",19))},a.refreshRed=function(e){var t=!1;return app.db.checkFuncUnLock("PVP_KING",!1)&&((t=app.pages.kingpvpmissionpage.refreshRed())||app.pages.pvpentrancepage.checkKingPvpOpen()&&null==localDataUtils.GetValue("kingpvpred",null)&&(t=!0)),e&&(e.active=t),t},a.checkLineupRed=function(){var e=!1;if(app.pages.pvpentrancepage.checkKingPvpOpen())for(var t=1;t>0;){if(!app.db.checkBattleArrTeam("kingpvp"+t)||!app.db.checkGeneralExist("kingpvp"+t)){e=!0;break}t--}return e},a.getKingPvpState=function(){var e={state:0,totalTime:0},t=app.PVPOPENTIME.kingpvp.open||[5,0,8],a=app.player.getServerTime(),i=gUtils.getTimeOfNowweekDay(t[0],t[1],0,0),n=gUtils.getTimeOfNowweekDay(t[0],t[2],0,0),r=a<i?i:gUtils.getTimeOfNextweekDay(t[0],t[1],0,0),o=-1;return n==i?(e.state=2,e.totalTime=-1):a>i&&a<n?o=n-a:(e.state=1,o=r-a),e.totalTime=o,e},a.checkCanEnter=function(){var e=a.getKingPvpState(),t=app.player.getServerTime(),i=app.PVPOPENTIME.kingpvp.open||[5,0,8];return 0==e.state&&t<gUtils.getTimeOfNowweekDay(i[0],i[1],0,0)+72e5},cc._RF.pop()},{basePage:void 0}],kingpvpPlayerInfoPage:[function(e,t){"use strict";cc._RF.push(t,"0d5e6pQ/X5FbqKJWdEos6N0","kingpvpPlayerInfoPage");var a=[0,1,2],i=cc.Class({extends:e("basePage"),statics:{prefabPath:"kingpvpplayerinfopage",pageType:1},properties:{p_nodePlayer:cc.Node,p_nodeContent:cc.Node,p_battleItem:cc.Prefab,p_updateLayout:[cc.Layout],p_nodeManager:cc.Node,p_nodeManageLayout:cc.Node,p_btnMore:cc.Button,p_btnAddFriend:cc.Button,p_btnBanFriend:cc.Button,p_scrollView:cc.ScrollView},onLoad:function(){i.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.m_arrItems=[],this.p_nodeManager.width=cc.winSize.width,this.p_nodeManager.height=cc.winSize.height},handleUI:function(){var e=this;this._super(),this.p_btnMore.node.on("click",function(){app.playSound("click");var t=e.p_btnMore.node.convertToWorldSpaceAR(cc.v2(0,0)),a=e.p_nodeManager.convertToNodeSpaceAR(t);e.p_nodeManageLayout.x=a.x,e.p_nodeManageLayout.y=a.y+20,e.p_nodeManager.active=!0}),this.p_nodeManager.on("touchend",function(){e.p_nodeManager.active=!1}),this.p_btnAddFriend.node.on("click",function(){if(app.playSound("click"),app.checkMaxFriend())app.showNotice(langMgr.getString("friendAddFriendItem",0));else{var t=[e._playerInfo.rid];app.player.sfApply(t,function(t){t||app.showNotice(langMgr.getString("friendAddFriendItem",1,e._playerInfo.rname))})}}),this.p_btnBanFriend.node.on("click",function(){app.showNotice(langMgr.getString("playerOtherInfoMorePage",0))})},setParam:function(e){this._playerInfo=e.playerInfo,this.isHide=!!e.playerInfo.isHide,this.m_title=e.title?e.title:"\u4e0a\u9635\u6b66\u5c06",this.refreshUI()},refreshUI:function(){if(this._playerInfo){this.p_nodePlayer.getComponent("playerPortraitItem").refreshUI(this._playerInfo,this);var e=this._playerInfo.battleset;e&&this.refreshTeam(e),this.updatePos()}},refreshTeam:function(e){var t=0;if(this.isHide){var i=[];e.forEach(function(e){i=i.concat(Object.values(e.team))}),i.sort(function(e,t){var a=e,i=t;if(a.star<i.star)return 1;if(a.star==i.star){if(a.level<i.level)return 1;if(a.level==i.level&&a.gsid>i.gsid)return 1}return-1});var n=this.m_arrItems[t++];n||((n=cc.instantiate(this.p_battleItem)).parent=this.p_nodeContent,this.m_arrItems.push(n)),n.active=!0,n.getComponent("kingpvpPlayerInfoItem").refreshUI({bset:{team:i},title:this.m_title},this)}else{this.p_scrollView.content.height=300*e.length;for(var r=0;r<e.length;r++){var o=e[r];if(o&&o.team){var s=this.m_arrItems[t++];s||((s=cc.instantiate(this.p_battleItem)).parent=this.p_nodeContent,this.m_arrItems.push(s)),s.active=!0,s.getComponent("kingpvpPlayerInfoItem").refreshUI({bset:o,title:langMgr.getString("kingpvpPlayerInfoPage",a[r])},this)}}}for(var p=t;p<this.m_arrItems.length;++p)this.m_arrItems[p].active=!1},updatePos:function(){this.p_updateLayout.forEach(function(){})}});cc._RF.pop()},{basePage:void 0}],kingpvpReplayPage:[function(e,t){"use strict";cc._RF.push(t,"9edf2OCybRJ3ZS764/EghOe","kingpvpReplayPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"kingpvpreplaypage",pageType:1},properties:{p_tabvReplay:cc.tableView},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},setParam:function(e){e?(this._record=e,this.refreshUI()):app.showNotice(langMgr.getString("kingpvpReplayPage",0))},refreshUI:function(){for(var e=[],t=0;t<this._record.length;++t)!this._record[t].version||this._record[t].version<gSetting.videoVersion||e.push(this._record[t]);this._record=e,this.p_tabvReplay.getComponent("tableView").initTableView(this._record.length,{array:this._record})}});a.showPage=function(t,a,i){var n=this;app.player.sfKpRecord(function(t,r){t?app.showNotice(t):e("basePage").showPage.call(n,r,a,i)})},cc._RF.pop()},{basePage:void 0}],kingpvpRewardPage:[function(e,t){"use strict";cc._RF.push(t,"9e7090iBVxBHK8/skrQy58X","kingpvpRewardPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"kingpvprewardpage",pageType:1},properties:{p_sprStage:cc.Sprite,p_sprStageTxt:cc.Sprite,p_labKingpvpTime:cc.Label,p_labKingTips:cc.Label,p_nodeMyStage:cc.Node,p_tabvReward:cc.tableView,p_sprStageLv:cc.Sprite,p_nodeStageLvBg:cc.Node},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},onEnable:function(){this._super(),eventMgr.on(eventStr.commonEvent.RefreshTime,this.refreshKpTime,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.commonEvent.RefreshTime,this.refreshKpTime,this)},handleUI:function(){this._super()},setParam:function(e){this._stageInfo=e,this.refreshUI()},refreshUI:function(){var e=this,t=gUtils.deepClone(app.db.dbKingStage).reverse();this.p_tabvReward.getComponent("tableView").initTableView(t.length,{array:t,target:this}),this.p_sprStage&&(this.p_sprStage.node.active=!1),this.p_sprStageTxt&&(this.p_sprStageTxt.node.active=!1),this.p_sprStageLv&&(this.p_sprStageLv.node.active=!1),this.p_nodeStageLvBg.active=!1;var a=parseInt(String(this._stageInfo.stage).charAt(0)),i=parseInt(String(this._stageInfo.stage).charAt(2));if(this.p_sprStage){var n=gConfig.getIconGStagePath(a-1,i-1);app.loadTexture(n,this.p_sprStage,this.prefabPath,function(){e.p_sprStage.node.active=!0})}if(this.p_sprStageTxt){var r=gConfig.getIconGStageLargePath(a-1);app.loadTexture(r,this.p_sprStageTxt,this.prefabPath,function(){e.p_sprStageTxt.node.active=!0})}if(this.p_sprStageLv&&a<=5){var o=gConfig.getIconGStageLvlPath(a-1,i-1);app.loadTexture(o,this.p_sprStageLv,this.prefabPath,function(){e.p_sprStageLv.node.active=!0,e.p_nodeStageLvBg.active=!0})}this.refreshKpTime()},refreshKpTime:function(){var e=this;if(app.PVPOPENTIME&&app.PVPOPENTIME.kingpvp){var t=app.player.getServerTime();if(app.seasonData.info.etime-t<0){if(this._bKpSeasonQuery)return;return this._bKpSeasonQuery=!0,void app.refreshSeason(this,function(){e._bKpSeasonQuery=!1,e.refreshKpTime()})}var a=app.pages.kingpvppage.getKingPvpState();switch(a.state){case 0:this.p_labKingTips.string=langMgr.getString("kingpvpRewardPage",0),this.p_labKingpvpTime.string=gUtils.getCountDownStr(a.totalTime);break;case 1:this.p_labKingTips.string=langMgr.getString("kingpvpRewardPage",1),this.p_labKingpvpTime.string=gUtils.getCountDownStr(a.totalTime);break;case 2:this.p_labKingpvpTime.string=langMgr.getString("kingpvpRewardPage",2),this.p_labKingTips.string=langMgr.getString("kingpvpRewardPage",3)}}}});cc._RF.pop()},{basePage:void 0}],kingpvpSelfLineupPage:[function(e,t){"use strict";cc._RF.push(t,"4f14bBkiWNNd4T4b+n5V3vx","kingpvpSelfLineupPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"kingpvpselflineuppage"},properties:{p_nodeGeneral:cc.Node,p_nodeContent:cc.Node,p_menu:e("menu"),p_labPower:cc.Label,p_btnSetLineup:cc.Button},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this._arrItems=[],this._arrItems.push(this.p_nodeGeneral),this.p_menu.init(this)},handleUI:function(){this._super(),this.p_btnSetLineup.node.on("click",function(){app.playSound("click"),app.battleType="kingpvpsave",app.goToNormBattle()})},setParam:function(e){this._playerInfo=e,this.refreshUI()},refreshUI:function(){if(this._playerInfo){var e=parseInt(String(this._playerInfo.stage).charAt(0));this._lineupNum=app.db.getKingLineupNum(e);for(var t=0;t<this.p_menu.p_arrBtnMenu.length;++t)this.p_menu.p_arrBtnMenu[t].node.active=t<this._lineupNum;this.p_menu.setMenuIndex(0)}},menuHandler:function(e){if(this._index=e,!app.kpResonanceLineup[gConfig.KPLINEUP[e]])return this.clearLineup(),void(this.p_labPower.node.active=!1);this.refreshGeneral(app.kpResonanceLineup[gConfig.KPLINEUP[e]]),this.p_labPower.node.active=!0,this.p_labPower.string=app.player.getBattleArrPower(null,app.kpResonanceLineup[gConfig.KPLINEUP[e]].team)},refreshGeneral:function(e){if(!e||!e.team||gUtils.getTableLength(e.team)<=0)this.clearLineup();else{var t=0;for(var a in e.team){var i=this._arrItems[t++];i||((i=cc.instantiate(this.p_nodeGeneral)).parent=this.p_nodeContent,this._arrItems.push(i)),i.active=!0,i.getComponent("generalPortraitItem").initForResonance(e.team[a])}for(var n=t;n<this._arrItems.length;++n)this._arrItems[n].active=!1}},clearLineup:function(){for(var e=0;e<this._arrItems.length;++e)this._arrItems[e].active=!1}});cc._RF.pop()},{basePage:void 0,menu:void 0}],kingpvpStageInfoPage:[function(e,t){"use strict";cc._RF.push(t,"ffd34UYUflIo6LNhH2tWLvg","kingpvpStageInfoPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"kingpvpstageinfopage",pageType:1},properties:{p_sprStage:cc.Sprite,p_sprStageTxt:cc.Sprite,p_sprStageLvl:cc.Sprite},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){this._super()},setParam:function(e){this._myRankInfo=e,this.refreshUI()},refreshUI:function(){var e=this;if(this.p_sprStage.node.active=!1,this.p_sprStageTxt.node.active=!1,this.p_sprStageLvl.node.active=!1,this._myRankInfo&&this._myRankInfo.stage){var t=parseInt(String(this._myRankInfo.stage).charAt(0)),a=gConfig.getIconGStagePath(t-1);app.loadTexture(a,this.p_sprStage,this.prefabPath,function(){e.p_sprStage.node.active=!0});var i=gConfig.getIconGStageTxtPath(t-1);if(app.loadTexture(i,this.p_sprStageTxt,this.prefabPath,function(){e.p_sprStageTxt.node.active=!0}),t<=5){var n=parseInt(String(this._myRankInfo.stage).charAt(2)),r=gConfig.getIconGStageLvlPath(t-1,n-1);app.loadTexture(r,this.p_sprStageLvl,this.prefabPath,function(){e.p_sprStageLvl.node.active=!0})}}}});cc._RF.pop()},{basePage:void 0}],legionApplyPage:[function(e,t){"use strict";cc._RF.push(t,"0ad33Pfb65JZoGwShSOs6NC","legionApplyPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"legionapplypage",pageType:1},properties:{p_tableView:cc.tableView,p_btnAllReject:cc.Button,p_btnAllAcc:cc.Button,p_nodeGirl:cc.Node},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){var e=this;this._super(),this.p_btnAllAcc.node.on("click",function(){app.playSound("click"),e.accAllPlayer()}),this.p_btnAllReject.node.on("click",function(){app.playSound("click"),e.rejectAllPlayer()})},setParam:function(e){this.m_applyList=e.applylist,this.refreshTableV()},refreshTableV:function(){this.p_btnAllAcc.interactable=this.p_btnAllReject.interactable=this.m_applyList.length;var e=this.m_applyList.length;app.redDataServer.legion.apply=e,this.p_nodeGirl.active=!e,this.p_tableView.initTableView(e,{array:this.m_applyList,target:this})},rejectAllPlayer:function(){var e=this.getPlayersKey();this.dealData(e,0,!0)},accAllPlayer:function(){var e=this.getPlayersKey();this.dealData(e,1,!0)},dealData:function(e,t,a){var i=this;app.player.legionApplyReview({arr:e,accept:t},function(t){var n=t.ret;if(a){for(var r=[],o=0;o<n.length;++o)n[o].error&&r.push(i.m_applyList[o]);i.m_applyList=r,i.m_applyList.length&&app.showNotice(langMgr.getString("legionApplyPage",0))}else{if(n[0].error)switch(n[0].error){case"already join":app.showNotice(langMgr.getString("legionApplyPage",1));break;case"cd nyet":app.showNotice(langMgr.getString("legionApplyPage",2));break;case"member full":app.showNotice(langMgr.getString("legionApplyPage",3));break;case"apply nexist":app.showNotice(langMgr.getString("legionApplyPage",4))}for(var s=0;s<i.m_applyList.length;++s)i.m_applyList[s].id==e[0]&&i.m_applyList.splice(s,1)}i.refreshTableV()})},getPlayersKey:function(){var e=[];return this.m_applyList.forEach(function(t){e.push(t.id)}),e},onClose:function(){this._super(),app.player.sfGetLegionInfo(function(e,t){e||app.pages.legionpage.instance.setParam(t)})}});cc._RF.pop()},{basePage:void 0}],legionBossPage:[function(e,t){"use strict";cc._RF.push(t,"9dc28566p5FA5SEzNJzwUix","legionBossPage");var a=e("dbLegionBoss"),i=cc.Class({extends:e("basePage"),statics:{prefabPath:"legionbosspage"},properties:{p_tableViewPassList:cc.tableView,p_btnFight:cc.Button,p_btnMop:cc.Button,p_fightSprite:cc.Sprite,p_mopSprite:cc.Sprite,p_fightWingNode:cc.Node,p_mopWingNode:cc.Node,p_arrBtnMopSpriteF:[cc.SpriteFrame],p_mopWordSprite:[cc.SpriteFrame],p_fightWordSprite:[cc.SpriteFrame],p_btnRankRewarsd:cc.Button,p_btnChangeL:cc.Button,p_btnChangeR:cc.Button,p_labBossInfo:cc.Label,p_labCount:cc.Label,p_labBossFlow:cc.Label,p_sprGeneral:cc.Sprite,p_spGeneral:sp.Skeleton,p_animGeneral:cc.Animation,p_probar:cc.ProgressBar,p_sprBossIcon:cc.Sprite,p_arrNodeRank:[cc.Node],p_arrNodeCost:[cc.Node],p_arrNodeType:[cc.Node],p_btnRank:cc.Button,p_btnHelp:cc.Button,p_btnBox:cc.Button,p_labBoxTime:cc.Label,p_btnRecord:cc.Button,p_nodeRankTip:cc.Node},onLoad:function(){i.instance=this,this.m_nowBoss=0,this.stopNodeEvent(),this.handleUI(),this.fitTopMenu()},handleUI:function(){var e=this;this._super(),this.p_btnFight.node.on("click",function(){app.playSound("click"),e.onFight()}),this.p_btnBox.node.on("click",function(){app.playSound("click"),app.pages.legionbossrewardpage.showPage({target:e,data:e.m_boxData})}),this.p_btnMop.node.on("click",function(){app.playSound("click"),e.onMop()}),this.p_btnRankRewarsd.node.on("click",function(){app.pages.legionbossrankpage.showPage({index:e.m_boss.chapter,target:e})}),this.p_btnRecord.node.on("click",function(){app.pages.legionbossrecordpage.showPage()}),this.p_btnRank.node.on("click",function(){var t={rank:{selfrank:e.m_selflist,damge:e.m_damge,list:e.m_passInfo.rank},rtype:"legion",title:"\u519b\u56e2BOSS\u6392\u884c"};app.pages.ranklistpage.showPage(t)}),this.p_btnChangeL.node.on("click",function(){var t=e.m_boss.chapter-1;e.changeBossInfo(t)}),this.p_btnChangeR.node.on("click",function(){var t=e.m_boss.chapter+1;e.changeBossInfo(t)}),this.p_btnHelp.node.on("click",function(){app.pages.windowspagetipshelp.showPage("1024")})},setParam:function(e){var t=this;this.m_passInfo=e,this.m_chapter=this.m_passInfo.boss.chapter,this.initPage(),this.refreshPassListTableV(),app.player.sfLegionBossReward(function(e,a){t.refreshBox(a)})},refreshBox:function(e){this.m_boxData=e,e&&0!=Object.keys(e).length?(this.refreshTime(),this.schedule(this.refreshTime,1),this.p_btnBox.node.active=!0):this.p_btnBox.node.active=!1},refreshTime:function(){var e=app.player.getServerTime(),t=app.legionInfo.legionjointime+2592e5,a=t-e;(!t||a<0)&&(a=0),this.p_labBoxTime.string=0==a?langMgr.getString("legionBossPage",8):langMgr.getString("legionBossPage",9,gUtils.getCountDownStr(a))},initPage:function(){this.refreshUI(),this.refreshRankTableV(),this.refreshBtnUI(),this.refreshMiniRankList(),this.refreshChangeBtnUI()},refreshUI:function(){this.m_boss=this.m_passInfo.boss;var e=this.m_boss.chapter,t=a.BOSS[e-1];this.p_labBossInfo.string=t.NAME;var i=app.db.getGHeadIconByGsid(t.ICON);app.loadTexture(i,this.p_sprBossIcon,this.prefabPath),app.loadGeneral(t.ICON,this.p_sprGeneral,this.p_spGeneral,this.p_animGeneral,null,this.prefabPath),this.upPassExperience()},upPassExperience:function(){var e=this.m_boss.nowhp||0==this.m_boss.nowhp?this.m_boss.nowhp/this.m_boss.maxhp:1;this.p_probar.progress=e,this.p_labBossFlow.string=e<.01?Math.ceil(100*e)+"%":Math.floor(100*e)+"%"},refreshRankTableV:function(){var e=this;this.isMop=this.m_passInfo.self&&this.m_passInfo.self.lastdamge;var t=this.m_passInfo.rank;if(this.p_btnRank.node.active=!!t.length,t.length){var a=app.player.rname;t.forEach(function(t,i){if(t.name==a)return e.m_selflist=i+1,void(e.m_damge=t.damge)})}},refreshPassListTableV:function(){var e=this,t=a.BOSS,i=t.length;this.m_nowBoss!==this.m_boss.chapter&&(this.m_nowBoss=this.m_boss.chapter,this.p_tableViewPassList.initTableView(i,{array:t,target:this},function(){e.m_boss=e.m_passInfo.boss;var t=e.m_boss.chapter,a=(e.p_tableViewPassList.getMaxScrollOffset().x+e.p_tableViewPassList._view.width)/i*(t-3.62);e.p_tableViewPassList.scrollToOffset(cc.v2(a,0),0),e.m_boss.nowhp<=0&&(e.p_btnFight.node.active=!1,e.p_btnMop.node.active=!1)}))},refreshMiniRankList:function(){for(var e=0;e<3;++e){var t=this.m_passInfo.rank[e],a=this.p_arrNodeRank[e];t?(a.active=!0,a.getChildByName("name").getComponent(cc.Label).string=t.name,a.getChildByName("damge").getComponent(cc.Label).string=gUtils.showNum(t.damge)):a.active=!1}this.p_nodeRankTip.active=this.m_passInfo.rank&&this.m_passInfo.rank.length},refreshBtnUI:function(){var e=app.player.getCount(90267),t=a.COST[e]||a.COST[a.COST.length-1],i=t.COST?t.COST:0;if(this.m_fightCost=i,this.m_passInfo.boss.chapter!=this.m_chapter)return this.p_btnFight.node.active=!1,void(this.p_btnMop.node.active=!1);this.m_boss.nowhp<=0?(this.p_btnFight.node.active=!1,this.p_btnMop.node.active=!1):(this.p_btnFight.node.active=!0,this.p_btnMop.node.active=!0),this.p_btnFight.interactable=!!t,!this.isMop||a.COST.length-e<=0||this.m_boss.nowhp<=0?this.p_btnMop.node.active=!1:this.p_btnMop.node.active=!0,this.p_labCount.string=langMgr.getString("legionBossPage",1,a.COST.length-e),this.p_btnMop.node.active?a.COST.length-e>2?(this.p_fightWingNode.active=!1,this.p_mopWingNode.active=!1,this.p_fightSprite.spriteFrame=this.p_fightWordSprite[1],this.p_mopSprite.spriteFrame=this.p_mopWordSprite[1]):a.COST.length-e<=2&&a.COST.length-e>0&&(this.p_fightWingNode.active=!0,this.p_mopWingNode.active=!0,this.p_fightWingNode.scale=1,this.p_mopWingNode.getChildByName("num").getComponent(cc.Label).string=a.COST[e].COST,app.loadTexture(app.db.getPropsIconPath(38005),this.p_mopWingNode.getChildByName("icon").getComponent(cc.Sprite),this.prefabPath),this.p_fightWingNode.getChildByName("num").getComponent(cc.Label).string=a.COST[e].COST,app.loadTexture(app.db.getPropsIconPath(38005),this.p_fightWingNode.getChildByName("icon").getComponent(cc.Sprite),this.prefabPath),this.p_fightSprite.spriteFrame=this.p_fightWordSprite[4],this.p_mopSprite.spriteFrame=this.p_mopWordSprite[0]):a.COST.length-e>2?(this.p_fightWingNode.active=!1,this.p_fightSprite.spriteFrame=this.p_fightWordSprite[0]):a.COST.length-e<=2&&a.COST.length-e>0?(this.p_fightWingNode.active=!0,this.p_fightWingNode.scale=1.2,this.p_fightWingNode.getChildByName("num").getComponent(cc.Label).string=a.COST[e].COST,app.loadTexture(app.db.getPropsIconPath(38005),this.p_fightWingNode.getChildByName("icon").getComponent(cc.Sprite),this.prefabPath),this.p_fightSprite.spriteFrame=this.p_fightWordSprite[4]):(this.p_fightWingNode.active=!1,this.p_fightSprite.spriteFrame=this.p_fightWordSprite[3]),e>=a.COST.length&&(this.p_btnFight.interactable=!1),this.p_btnFight.node.getComponent(cc.Sprite).spriteFrame=this.p_btnMop.node.active?this.p_arrBtnMopSpriteF[1]:this.p_arrBtnMopSpriteF[0]},refreshChangeBtnUI:function(){this.p_btnChangeL.node.active=!1,this.p_btnChangeR.node.active=!1;var e=this.m_boss.chapter,t=this.m_chapter;this.p_btnChangeL.node.active=e>1,this.p_btnChangeR.node.active=e<t},onFight:function(){app.player.getCount(38005)<this.m_fightCost?app.showNotice(langMgr.getString("legionBossPage",2)):(app.battleType="legionboss",app.bossId=this.m_boss.chapter,app.battleConfig=this.m_boss.bset,app.bossHp=this.m_boss.hp,app.goToNormBattle())},onMop:function(){var e=this;if(app.player.getCount(38005)<this.m_fightCost)app.showNotice(langMgr.getString("legionBossPage",2));else{var t=this.m_passInfo.self&&this.m_passInfo.self.lastdamge?this.m_passInfo.self.lastdamge:0,a=gUtils.showNum(t),i=this,n={content:langMgr.getString("legionBossPage",7,a),confirmcb:function(){app.player.sfLegionFarm({chapter:e.m_boss.chapter},function(e){app.player.reduceItem({gsid:38005,count:i.m_fightCost});for(var t=[{gsid:90267,count:1}],a=0;a<e.rewards.length;++a)t.push(e.rewards[a]);var n={showtype:1,reward:e.rewards};app.player.addItem(t),app.pages.windowspagereward.showPage(n),app.player.legionGetBossInfo(null,function(e){i.setParam(e)})})},target:this};app.pages.windowspagetipsmsg.showPage(n)}},afterBattleFresh:function(){var e=this;app.player.legionGetBossInfo(null,function(t){e.setParam(t)})},changeBossInfo:function(e){var t=this;if(e>this.m_chapter){var i=a.BOSS[e-1];return this.m_passInfo.rank=[],this.m_passInfo.boss.name=i.NAME,this.m_passInfo.boss.maxhp=i.BOSSHP,this.m_passInfo.boss.nowhp=i.BOSSHP,this.m_passInfo.boss.chapter=e,void this.initPage()}var n=null;e<this.m_chapter&&(n={index:e-1}),app.player.legionGetBossInfo(n,function(e){t.m_passInfo=e,t.initPage()})},onClose:function(){eventMgr.emit(eventStr.redEvent.RefreshLegionHomePageRed),this._super()}});i.showPage=function(t,a,i){var n=this;app.player.legionGetBossInfo(null,function(t){e("basePage").showPage.call(n,t,a,i)})},cc._RF.pop()},{basePage:void 0,dbLegionBoss:void 0}],legionBossRankPage:[function(e,t){"use strict";cc._RF.push(t,"ac2d3xQFfpBZrSx372HzaUE","legionBossRankPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"legionbossrankpage",pageType:1},properties:{p_btnRank:cc.Button,p_nodeRank:cc.Node,p_nodeFight:cc.Node,p_arrRank:[cc.Node],p_arrJoin:cc.Node,p_arrKill:cc.Node,p_pfbItem:cc.Prefab},onLoad:function(){a.instance=this,this.stopNodeEvent(),this.handleUI(),this.fitTopMenu(),this.creatMask(!0),this.m_menu=this.node.getComponent("menu"),this.m_menu.init(this)},handleUI:function(){var e=this;this._super(),this.p_btnRank.node.on("click",function(){app.playSound("click");var t={rank:{selfrank:e.m_target.m_selflist,damge:e.m_target.m_damge,list:e.m_target.m_passInfo.rank},rtype:"legion",title:"\u519b\u56e2BOSS\u6392\u884c"};app.pages.ranklistpage.showPage(t)})},setParam:function(e){console.log(e),this.m_target=e.target,this.m_bossIndex=e.index,this.m_menu.setMenuIndex(0)},menuHandler:function(e){switch(e){case 1:this.p_nodeRank.active=!0,this.p_nodeFight.active=!1;break;case 0:this.p_nodeRank.active=!1,this.p_nodeFight.active=!0}this.refreshUI(e)},refreshUI:function(e){var t=app.db.dbLegionBoss.BOSS[this.m_bossIndex-1].KREWARD,a=app.db.dbLegionBoss.RANK,i=app.db.dbLegionBoss.BOSS[this.m_bossIndex-1].REWARD;if(0==e){this.m_arrJoinItem=this.m_arrJoinItem||[];for(var n=0;n<i.length;n++){var r=this.m_arrJoinItem[n];this.p_arrJoin.children[n],r||((r=cc.instantiate(this.p_pfbItem)).parent=this.p_arrJoin,r.scale=.8,this.m_arrJoinItem.push(r));var o=i[n];r.active=!0,r.getComponent("propItem").initForBag(o),r.getComponent("propItem").setClick(!0)}for(var s=i.length;s<this.m_arrJoinItem.length;++s)this.m_arrJoinItem[s].active=!1;this.m_arrKillItem=this.m_arrKillItem||[];for(var p=0;p<t.length;p++){var c=this.m_arrKillItem[p];c||((c=cc.instantiate(this.p_pfbItem)).parent=this.p_arrKill,c.scale=.8,this.m_arrKillItem.push(c));var h=t[p];c.active=!0,c.getComponent("propItem").initForBag(h),c.getComponent("propItem").setClick(!0)}for(var l=t.length;l<this.m_arrKillItem.length;++l)this.m_arrKillItem[l].active=!1}else{this.m_arrRankItem=this.m_arrRankItem||[[],[],[]];for(var g=0;g<this.p_arrRank.length;g++)for(var d=a[g].RAND,u=this.p_arrRank[g].getChildByName("layout"),f=0;f<t.length;++f){var m=this.m_arrRankItem[g][f];m||((m=cc.instantiate(this.p_pfbItem)).parent=u,this.m_arrRankItem[g].push(m)),m.active=!0;var _=t[f],v={gsid:_.gsid,count:Math.floor(_.count*(d/100))};m.getComponent("propItem").initForBag(v),m.getComponent("propItem").setClick(!0)}}}});cc._RF.pop()},{basePage:void 0}],legionBossRecordPage:[function(e,t){"use strict";cc._RF.push(t,"2ddbbcI7ztFBas22ekm6LiB","legionBossRecordPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"legionbossrecordpage",pageType:1},properties:{p_tabNode:cc.Node},onLoad:function(){a.instance=this,this.m_nowBoss=0,this.stopNodeEvent(),this.handleUI(),this.creatMask(!0)},handleUI:function(){this._super()},setParam:function(){var e=this;app.player.sfLegionbossrecord(function(t,a){e.refreshUI(a)})},refreshUI:function(e){var t=e.length;this.p_tabNode.getComponent("tableView").initTableView(t,{array:e,target:this})}});cc._RF.pop()},{basePage:void 0}],legionBossRewardPage:[function(e,t){"use strict";cc._RF.push(t,"4796dgT9iBKJ4N5lVhLnUd4","legionBossRewardPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"legionbossrewardpage",pageType:1},properties:{p_btnConfirm:cc.Button,p_tabNode:cc.Node,p_labTime:cc.Label},onLoad:function(){a.instance=this,this.stopNodeEvent(),this.handleUI(),this.fitTopMenu(),this.creatMask(!0),this.schedule(this.refreshTime,1)},handleUI:function(){var e=this;this._super(),this.p_btnConfirm.node.on("click",function(){app.playSound("click"),e.m_get?app.player.sfGetbossreward(function(t,a){t||(app.player.addItem(a.rewards),app.pages.windowspagereward.showPage({reward:a.rewards,showtype:1}),e.m_target.refreshBox(),e.onClose())}):app.showNotice(langMgr.getString("legionBossRewardPage",0))})},setParam:function(e){this.m_target=e.target,this.setData(e.data),this.refreshUI()},refreshUI:function(){console.log(this.m_data);var e=this.m_data.length;this.p_tabNode.getComponent("tableView").initTableView(e,{array:this.m_data,target:this}),this.refreshTime()},refreshTime:function(){var e=app.player.getServerTime(),t=app.legionInfo.legionjointime+2592e5,a=t-e;(!t||a<0)&&(a=0),0==a?(this.m_get=!0,this.p_labTime.string=langMgr.getString("legionBossRewardPage",1)):(this.m_get=!1,this.p_labTime.string=langMgr.getString("legionBossRewardPage",2,gUtils.getCountDownStr(a)))},setData:function(e){var t=[];for(var a in e){var i={id:a,reward:e[a]};t.push(i)}this.m_data=t}});cc._RF.pop()},{basePage:void 0}],legionCreatePage:[function(e,t){"use strict";cc._RF.push(t,"a4f90ONbhJKtbYJ4vay1Oo/","legionCreatePage");var a=[0,30,60],i=cc.Class({extends:e("basePage"),statics:{prefabPath:"legioncreatepage",pageType:1},properties:{p_btnSure:cc.Button,p_btnCloseO:cc.Button,p_ebName:cc.EditBox,p_nodeCoin:cc.Node,p_labHintOfficial:cc.Label,p_btnReplace:cc.Button,p_sprIcon:cc.Sprite,p_spIconArr:[cc.Sprite]},onLoad:function(){var e=this;i.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI();var t=[38006];this.p_spIconArr.forEach(function(a,i){var n=gConfig.getCurrencyIconPath(t[i]);app.loadTexture(n,a,e.prefabPath)})},handleUI:function(){var e=this;this._super(),this.p_btnSure.node.on("click",function(){app.playSound("click"),e.onCreate()}),this.p_btnCloseO.node.on("click",function(){app.playSound("click"),e.onClose()}),this.p_btnReplace.node.on("click",function(){app.playSound("click"),app.pages.legioniconpage.showPage({lv:0,index:e.m_iconIndex,Confirm:function(t){e.m_iconIndex=t,e.refreshIconUI()}})})},setParam:function(){this.m_iconIndex=0,this.refreshCreateUI(),this.refreshIconUI()},refreshCreateUI:function(){this.m_verLv=0,this.p_ebName.enabled=!0;var e=this.p_nodeCoin.getChildByName("icon").getComponent(cc.Sprite),t=this.p_nodeCoin.getChildByName("num").getComponent(cc.Label),a=app.db.getPropsIconPath(38005);app.loadTexture(a,e,this.prefabPath),t.string=500;var i=app.db.dbOfficialItems[2].NAME;this.p_labHintOfficial.string=langMgr.getString("legionCreatePage",0,i),this.p_ebName.placeholder=langMgr.getString("legionCreatePage",1)},refreshIconUI:function(){var e=app.db.getLegionIconInfo(this.m_iconIndex);app.loadTexture(gConfig.rootPath.uilegionicon+e.PATH,this.p_sprIcon)},onCreate:function(){if(app.player.getCount(38005)<500)app.showNotice(langMgr.getString("legionCreatePage",2));else if(app.player.level<18)app.showNotice(langMgr.getString("legionCreatePage",3));else if(app.player.getCount(38004)<2){var e=langMgr.getString("legionCreatePage",4,app.db.getOfficialInfoByLv(2).NAME);app.showNotice(e)}else{var t=this.p_ebName.string;if(""!=t)if(-1==t.indexOf(" ")&&app.checkMatchStr(t)&&!gUtils.checkRNameStr(t)){var i={name:t,notice:"",minlv:a[0],ispass:0,flag:this.m_iconIndex},n=this,r={content:langMgr.getString("legionCreatePage",8,500),confirmcb:function(){app.player.sfLegionCreate(i,function(e){app.showNotice(langMgr.getString("legionCreatePage",7)),app.player.legion=e||"\u521b\u5efa\u6210\u529f",app.player.reduceItem({gsid:38005,count:500}),app.player.sfGetLegionInfo(function(e,t){if(!e){var a={info:t};n.onClose(),app.pages.legionrecommendpage.instance&&app.pages.legionrecommendpage.instance.onClose(),app.pages.legionhomepage.showPage(a)}})})}};app.pages.windowspagetipsmsg.showPage(r)}else app.showNotice(langMgr.getString("legionCreatePage",6));else app.showNotice(langMgr.getString("legionCreatePage",5))}}});cc._RF.pop()},{basePage:void 0}],legionCsRankPage:[function(e,t){"use strict";cc._RF.push(t,"a6099euAVFI+Ku6aSMVNgFw","legionCsRankPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"legioncsrankpage"},properties:{p_nodeView:cc.Node,p_nodeSelf:cc.Node,p_arrRankTop:[cc.Node]},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){var e=this;this.p_arrRankTop.forEach(function(t,a){t.on("touchend",function(){e._arr&&e._arr[a]||app.showNotice(langMgr.getString("legionCsRankPage",0))})})},setParam:function(e){this._self=e.selfrank,this._myLegion=e.mylegion,this._arr=e.list,this.refreshUI()},refreshUI:function(){if(this.p_nodeView.getComponent("tableView").initTableView(this._arr.length,{array:this._arr,target:this}),this.p_nodeSelf.getComponent("legionCsRankItem").refreshUI(this._self,this._myLegion),this._arr)for(var e=0;e<this.p_arrRankTop.length;++e)this._arr[e]&&(this._arr[e].target=this,this.p_arrRankTop[e].getComponent("teampvpPlayerPortraitItem").refreshUI(this._arr[e]))},onClose:function(){this._super()}});cc._RF.pop()},{basePage:void 0}],legionHomePage:[function(e,t){"use strict";cc._RF.push(t,"23c97wBUUdIhK0baKDbzssz","legionHomePage");var a=cc.Enum({sign:0,boss:1,mission:2}),i=(e("dbLegionBoss"),"legionpage"),n=["checkLobby","checkShop","checkBoss","checkPractice","checkFate","checkWar"],r={legionwarpage:{node:"p_sprWar",titlenode:"p_sprWarTitle",lockNode:"p_nodeWarLock",key:"LEGION_WAR",timenode:"p_nodeWarTime"},legionpracticepage:{node:"p_sprPractice",titlenode:"p_sprPracticeTitle",lockNode:"p_nodePracticeLock",key:"LEGION_PRACTICE",timenode:"p_nodePracticeTime"}},o=cc.Class({extends:e("basePage"),statics:{prefabPath:"legionhomepage"},properties:{p_arrRedNode:[cc.Node],p_labName:cc.Label,p_timeDown:cc.Label,p_nodeWeijihuo:cc.Node,p_sprTQ:cc.Sprite,p_sprPractice:cc.Sprite,p_sprWar:cc.Sprite,p_sprCom:cc.Sprite,p_sprPracticeTitle:cc.Sprite,p_sprComTitle:cc.Sprite,p_sprWarTitle:cc.Sprite,p_nodePracticeLock:cc.Node,p_nodeWarLock:cc.Node,p_nodeComLock:cc.Node,p_nodePracticeTime:cc.Node,p_nodeWarTime:cc.Node},onLoad:function(){o.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.fitTopMenu(),this.m_nowTime=0,this.canMission=!1,this.preTimeItems=[],this.refreshTQTime(),this.controlFunctionByChannel()},onEnable:function(){this._super(),eventMgr.on(eventStr.redEvent.RefreshLegionHomePageRed,this.refreshLegionRed,this),eventMgr.on(eventStr.commonEvent.RefreshMainSceneSpecialButton,this.refreshPreCityUI,this),eventMgr.on(eventStr.commonEvent.RefreshTime,this.refreshTQTime,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.redEvent.RefreshLegionHomePageRed,this.refreshLegionRed,this),eventMgr.off(eventStr.commonEvent.RefreshMainSceneSpecialButton,this.refreshPreCityUI,this),eventMgr.off(eventStr.commonEvent.RefreshTime,this.refreshTQTime,this)},handleUI:function(){var e=this;this._super(),this.p_sprTQ.node.active=!gSetting.checkReviewServ(),this.p_sprTQ.node.on("touchend",function(){app.playSound("click");var t=app.player.getServerTime(),a=app.player.special.speciallm;if(a||(a=0),a>=t)app.goToPage(1047);else{var i={content:langMgr.getString("legionHomePage",8),confirmcb:function(){app.goToPage(1047)},target:e};app.pages.windowspagetipsmsg.showPage(i)}}),this.p_sprCom.node.on("touchend",function(){app.playSound("click"),e.showCom()}),this.p_sprPractice.node.on("touchend",function(){app.playSound("click"),e.showPractice()}),this.p_sprWar.node.on("touchend",function(){app.playSound("click"),e.showWar()})},controlFunctionByChannel:function(){app.db.getChannelControlInfo(),this.p_sprPractice.node.active=!1,this.p_sprWar.node.active=!1},setParam:function(e){switch(this.m_legionData=e.info,app.legionInfo=e.info,e.type){case"lobby":this.showHome();break;case"boss":this.showPass();break;case"practice":this.showPractice()}this.refreshLegionRed(),this.refreshUI()},refreshPreCityUI:function(){for(var e in this.preTimeItems=[],r){var t=r[e];if(this[t.node]){var a=this[t.lockNode],i=this[t.timenode];a&&i&&(app.lockFunConfig&&app.lockFunConfig.checkPreFuncByKey(t.key)?(i.active=!0,a.active=!1,app.setSpriteState(this[t.node],a.active),app.setSpriteState(this[t.titlenode],a.active),app.lockFunConfig.getPreCountDownByKey(t.key)>0&&this.preTimeItems.push({label:i.getComponentInChildren(cc.Label),etime:app.lockFunConfig.getPreCountDownByKey(t.key)+app.player.getServerTime()})):i.active=!1)}}},refreshTQTime:function(){var e=app.player.getServerTime(),t=app.player.special.speciallm;if(t||(t=0),app.setSpriteState(this.p_sprTQ,!1),t>=e){this.p_timeDown.node.parent.active=!0,this.p_nodeWeijihuo.active=!1;var a=Math.floor((t-e)/1e3/60/60)||1,i=a>24?langMgr.getString("legionHomePage",6,Math.ceil(a/24)):langMgr.getString("legionHomePage",7,a);this.p_timeDown.string=langMgr.getString("legionHomePage",5,i)}else this.p_timeDown.node.parent.active=!1,this.p_nodeWeijihuo.active=!0,app.setSpriteState(this.p_sprTQ,!0);if(this.preTimeItems.length>0)for(var n=app.player.getServerTime(),r=0;r<this.preTimeItems.length;r++){var o=this.preTimeItems[r],s=o.etime-n;if(!(s>0)){this.preTimeItems=[],this.refreshUI();break}o.label&&(o.label.string=langMgr.getString("cityPage",5,gUtils.getCountDownStr(s)))}},showHome:function(){app.pages[i].showPage(this.m_legionData)},showFate:function(){app.pages.legionsignpage.showPage(this.m_legionData.score,null,function(){cc.log("\u6253\u5f00\u5355\u4e2a\u754c\u9762\u5b8c\u6210\u4efb\u52a1\u56de\u8c03")})},showPass:function(){cc.log("on showpass"),app.pages.legionbosspage.instance&&cc.isValid(app.pages.legionbosspage.instance.node)&&(app.pages.legionbosspage.instance.m_nowBoss=0,cc.log("\u519b\u56e2\u526f\u672c\u9875\u9762\u5df2\u521d\u59cb\u5316\u8fc7\u5e76\u4e14\u5bf9\u8c61\u53ef\u7528\uff0c\u5237\u65b0\u9876\u90e8\u6eda\u52a8\u6761\u4f4d\u7f6e")),app.pages.legionbosspage.showPage(null,null,function(){if(null==localDataUtils.GetValue("legionbossred",null)){var e=app.player.getServerTime(),t=gUtils.getSecondDayTime(e);localDataUtils.SetValue("legionbossred",1,t)}cc.log("\u6253\u5f00\u5355\u4e2a\u754c\u9762\u5b8c\u6210\u4efb\u52a1\u56de\u8c03")})},showCom:function(){cc.log("on showcom"),this.m_legionData.level<7?app.pages.windowspagetipslegionlock.showPage({index:1,level:7}):app.pages.legionshoppage.showPage()},showWar:function(){if(app.lockFunConfig&&app.lockFunConfig.checkPreFuncByKey("LEGION_WAR"))app.pages.prepagelegionwar.showPage();else{if(this.m_legionData.level<4)return void app.pages.windowspagetipslegionlock.showPage({index:0,level:4});app.pages.legionwarpage.showPage(null,null,function(){if(null==localDataUtils.GetValue("legionwarred",null)){var e=app.player.getServerTime(),t=gUtils.getSecondDayTime(e);localDataUtils.SetValue("legionwarred",1,t)}})}},showHelp:function(){cc.log("on showhelp"),app.showNotice(langMgr.getString("legionHomePage",2))},showSkill:function(){app.pages.legionskillpage.showPage(null,null,function(){cc.log("\u6253\u5f00\u5355\u4e2a\u754c\u9762\u5b8c\u6210\u4efb\u52a1\u56de\u8c03")})},showStore:function(){cc.log("on showstore"),app.pages.shoppage.showPage("legion")},showPractice:function(){app.lockFunConfig&&app.lockFunConfig.checkPreFuncByKey("LEGION_PRACTICE")?app.pages.prepagelegionpractice.showPage():(cc.log("on showpractice"),this.m_legionData.level>=11?app.pages.legionpracticepage.showPage(null,null,function(){if(null==localDataUtils.GetValue("legionpracticered",null)){var e=app.player.getServerTime(),t=gUtils.getSecondDayTime(e);localDataUtils.SetValue("legionpracticered",1,t)}}):app.pages.windowspagetipslegionlock.showPage({index:2,level:11}))},backMainScene:function(){app.mainScene.onMenu(0)},refreshLegionRed:function(){for(var e=0;e<this.p_arrRedNode.length;e++)this.p_arrRedNode[e].active=o[n[e]]()},refreshTime:function(){var e=43200-(app.player.getServerTime()-this.m_lastTime)/1e3;(e=Math.floor(e))<=0&&(this.p_arrRedNode[a.mission].active=!0)},refreshUI:function(){cc.log(this.m_legionData),this.p_labName.string=langMgr.getString("legionHomePage",0,this.m_legionData.name),app.setNodeState(this.p_sprCom.node,this.m_legionData.level<7),app.setNodeState(this.p_sprWar.node,this.m_legionData.level<4),app.setNodeState(this.p_sprPractice.node,this.m_legionData.level<11),app.setNodeState(this.p_sprComTitle.node,this.m_legionData.level<7),app.setNodeState(this.p_sprWarTitle.node,this.m_legionData.level<4),app.setNodeState(this.p_sprPracticeTitle.node,this.m_legionData.level<11),this.p_nodeComLock.active=this.m_legionData.level<7,this.p_nodePracticeLock.active=this.m_legionData.level<11,this.p_nodeWarLock.active=this.m_legionData.level<4,this.refreshPreCityUI()},update:function(e){this.m_nowTime+=e,this.m_nowTime>=1&&!this.canMission&&(this.m_nowTime=0,this.refreshTime())}});o.refreshRed=function(e){var t=!1;return t||(t=o.checkLobby()),t||(t=o.checkShop()),t||(t=o.checkBoss()),t||(t=o.checkPractice()),t||(t=o.checkFate()),t||(t=o.checkWar()),e&&(e.active=t),t},o.checkLobby=function(){var e=!1,t=app.getRedInfoByObj(["legion","apply"],null);return null!=t&&(e=t>0),e},o.checkShop=function(){if(null==app.getRedInfoByObj(["legion","lock","factory"],null)){if(null!=app.legionOrderInfo){var e=app.player.getServerTime(),t=app.legionOrderInfo,a=!1;for(var i in t)if(t[i].etime&&(a=e>=t[i].etime),a)break;return a}return app.getRedInfoByObj(["legion","lmission"],0)>0}return!1},o.checkBoss=function(){var e=!1;return null!=app.getRedInfoByObj(["legion","boss"],null)&&(e=null==localDataUtils.GetValue("legionbossred",null)),e},o.checkPractice=function(){var e=!1;return 1!=app.db.getChannelControlInfo().LEGION_PRACTICE&&(null==app.getRedInfoByObj(["legion","lock","secretplace"],null)&&(e=null==localDataUtils.GetValue("legionpracticered",null)),o.instance&&o.instance.m_legionData&&o.instance.m_legionData.level<11&&(e=!1)),e},o.checkWar=function(){return!1},o.checkFate=function(){return!app.player.getCount(90266)},o.updateLegion=function(){var e=o.checkShop();void 0!==app.legionShopRed&&app.legionShopRed==e||(app.legionShopRed=e,eventMgr.emit(eventStr.redEvent.RefreshLegionHomePageRed),eventMgr.emit(eventStr.redEvent.RefreshCityRed),eventMgr.emit(eventStr.redEvent.RefreshMainSceneRed))},cc._RF.pop()},{basePage:void 0,dbLegionBoss:void 0}],legionIconPage:[function(e,t){"use strict";cc._RF.push(t,"39b195+CeNCoYpwAVb45fAX","legionIconPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"legioniconpage",pageType:1},properties:{p_pfbIconItem:cc.Prefab,p_nodeContent:cc.Node,p_btnSure:cc.Button,p_btnCancel:cc.Button,p_labWarn:cc.Label},onLoad:function(){a.instance=this,this.creatMask(!0),this.stopBgNodeEvent(),this.handleUI()},handleUI:function(){var e=this;this._super(),this.p_btnSure.node.on("click",function(){app.playSound("click"),e.onSure()}),this.p_btnCancel.node.on("click",function(){app.playSound("click"),e.onClose()})},setParam:function(e){this.m_objData=e,this.refreshUI()},refreshUI:function(){var e=this.m_objData.lv,t=this.m_objData.index;this.p_labWarn.string=langMgr.getString("legionIconPage",0,e);for(var a=app.db.dbLegionIcon,i=0;i<a.length;++i){var n=this.p_nodeContent.children[i];n||(n=cc.instantiate(this.p_pfbIconItem),this.p_nodeContent.addChild(n)),n.getComponent("legionIconItem").initSelf(i,i==t,e,this.onClick.bind(this))}},onClick:function(e){this.m_objData.index!=e&&(this.m_objData.index=e,this.refreshUI())},onSure:function(){this.m_objData.Confirm(this.m_objData.index),this.onClose()}});cc._RF.pop()},{basePage:void 0}],legionInfoPage:[function(e,t){"use strict";cc._RF.push(t,"3f492i6NNNO7pwjql6R80po","legionInfoPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"legioninfopage",pageType:1},properties:{p_btnJion:cc.Button,p_legion_flag:cc.Sprite,p_legion_name:cc.Label,p_legion_level:cc.Label,p_legion_power:cc.Node,p_pfb_power:cc.Prefab,p_legion_announcement:cc.Label,p_legion_limit_level:cc.Label,p_legion_number:cc.Label,p_legion_voice:cc.Label,p_legion_validation:cc.Label,p_tableView:cc.Node},onLoad:function(){a.instance=this,this.creatMask(!0),this.stopBgNodeEvent(),this.handleUI(),this.m_nodePower=cc.instantiate(this.p_pfb_power),this.m_nodePower.parent=this.p_legion_power},handleUI:function(){var e=this;this._super(),this.p_btnJion.node.on("click",function(){app.playSound("click"),e.applyJoinLegion()},this)},setParam:function(e){this.legionInfo=e,this.refreshTableV(),this.refreshUI(e),this.refreshIconUI()},refreshIconUI:function(){var e=app.db.getLegionIconInfo(this.legionInfo.flag);app.loadTexture(gConfig.rootPath.uilegionicon+e.PATH,this.p_legion_flag)},refreshUI:function(e){this.p_legion_name.string=langMgr.getString("legionInfoPage",0,e.name),this.p_legion_level.string=langMgr.getString("legionInfoPage",1,e.level),this.p_legion_limit_level.string=e.minlv,this.p_legion_number.string=e.members.length+"/"+e.mpnum,e.notice&&""!=e.notice?this.p_legion_announcement.string=e.notice:this.p_legion_announcement.string=langMgr.getString("legionInfoPage",2),this.m_nodePower.getComponent("PowerDisplay").init(e.power),e.ispass?this.p_legion_validation.string=langMgr.getString("legionInfoPage",3):this.p_legion_validation.string=langMgr.getString("legionInfoPage",4),app.player.legion?this.p_btnJion.node.active=!1:this.p_btnJion.node.active=!0,this.p_btnJion.node.getChildByName("tx_check").active=!e.ispass,this.p_btnJion.node.getChildByName("tx_join").active=e.ispass},refreshTableV:function(){var e=this.setData(this.legionInfo.members);this.p_tableView.getComponent("tableView").initTableView(e.length,{array:e,target:this})},setData:function(e){var t=e;return t.sort(function(e,t){return e.power>t.power?-1:e.power<t.power?1:0}),t.sort(function(e,t){return e.pos>t.pos?-1:e.pos<t.pos?1:0}),t.sort(function(e,t){return e.pos!==t.pos?0:e.isonline&&!t.isonline?-1:!e.isonline&&t.isonline?1:0}),t},start:function(){},applyJoinLegion:function(){var e=this;app.player.legionApplyJoin({legionid:this.legionInfo.id},function(t){console.log("\u7533\u8bf7\u52a0\u5165"),t.id?(e.onClose(),app.showNotice(langMgr.getString("legionInfoPage",5)),app.pages.legionrecommendpage.instance&&cc.isValid(app.pages.legionrecommendpage.instance.node)&&app.pages.legionrecommendpage.instance.onClose(),app.player.sfPlayerByParam(["legion"],function(){app.player.legion?(ChatMsgMgr.joinLegionRoom(),app.player.sfGetLegionInfo(function(e,t){if(!e){var a={info:t};app.pages.legionhomepage.showPage(a)}})):app.pages.legionrecommendpage.showPage()})):(app.showNotice(langMgr.getString("legionInfoPage",6)),e.onClose())})}});cc._RF.pop()},{basePage:void 0}],legionLogPage:[function(e,t){"use strict";cc._RF.push(t,"171e7gi63lL/JREXdIzPr63","legionLogPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"legionlogpage",pageType:1},properties:{p_tableView:cc.tableView},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},setParam:function(e){this.m_legionLogList=e.list,this.refreshTableV()},handleUI:function(){this._super()},refreshTableV:function(){var e=this.m_legionLogList.length;this.p_tableView.initTableView(e,{array:this.m_legionLogList,target:this})}});cc._RF.pop()},{basePage:void 0}],legionLookRewardPage:[function(e,t){"use strict";cc._RF.push(t,"3e961jl4WFFJ5PLA3K79rFG","legionLookRewardPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"legionLookRewardPage"},properties:{},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){this._super()},setParam:function(){}});cc._RF.pop()},{basePage:void 0}],legionPage:[function(e,t){"use strict";cc._RF.push(t,"b2fb747oRxPxKr6AtzOoJa9","legionPage");var a=["\u8f6c\u8ba9\u519b\u56e2\u957f","\u89e3\u6563\u804c\u4f4d","\u8e22\u51fa\u519b\u56e2","\u4efb\u547d\u5b98\u5458","\u52a0\u597d\u53cb","\u67e5\u770b"],i=cc.Class({extends:e("basePage"),statics:{prefabPath:"legionpage",pageType:1},properties:{p_labName:cc.Label,p_labLevel:cc.Label,p_labCeo:cc.Label,p_labPlayerNum:cc.Label,p_nodePower:cc.Node,p_pfbPower:cc.Prefab,p_labIntro:cc.Label,p_labProgress:cc.Label,p_sprIcon:cc.Sprite,p_btnSet:cc.Button,p_btnFix:cc.Button,p_btnRecruit:cc.Button,p_btnMail:cc.Button,p_btnApply:cc.Button,p_btnExit:cc.Button,p_btnLog:cc.Button,p_btnHelp:cc.Button,p_btnLook:cc.Button,p_btnLookLegion:cc.Button,p_tableView:cc.tableView,p_sprExit:cc.Sprite,p_arrExitSpriteF:[cc.SpriteFrame],p_nodeMask:cc.Node,p_nodeManager:cc.Node,p_btnManager:cc.Button,p_arrBtnMgr:[cc.Button],p_progressBar:cc.ProgressBar},onLoad:function(){this.m_nodePower=cc.instantiate(this.p_pfbPower),this.m_nodePower.parent=this.p_nodePower,this.p_nodeManager.width=this.p_nodeMask.width=cc.winSize.width,this.p_nodeManager.height=this.p_nodeMask.height=cc.winSize.height,this.p_nodeMask.active=!1,i.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},onEnable:function(){this._super(),eventMgr.on(eventStr.redEvent.RefreshLegionPageRed,this.refreshRed,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.redEvent.RefreshLegionPageRed,this.refreshRed,this)},handleUI:function(){var e=this;this._super(),this.p_btnManager.node.on("click",function(){app.playSound("click"),e.p_nodeManager.active=!0}),this.p_btnSet.node.on("click",function(){app.playSound("click"),e.onSet()}),this.p_btnFix.node.on("click",function(){app.playSound("click"),e.onFix()}),this.p_btnRecruit.node.on("click",function(){app.playSound("click"),e.recruitShare()}),this.p_btnMail.node.on("click",function(){app.playSound("click"),e.onMail()}),this.p_btnApply.node.on("click",function(){app.playSound("click"),e.onApply()}),this.p_btnExit.node.on("click",function(){app.playSound("click"),e.onExit()}),this.p_btnLog.node.on("click",function(){app.playSound("click"),e.onLog()}),this.p_nodeMask.on("touchend",function(){e.p_nodeMask.active=!1}),this.p_nodeManager.on("touchend",function(){e.p_nodeManager.active=!1}),this.p_arrBtnMgr.forEach(function(t,a){t.node.on("click",function(){app.playSound("click"),e.managePlayer(a)})}),this.p_btnLookLegion.node.on("click",function(){app.playSound("click"),app.pages.legionrecommendpage.showPage("look")}),this.p_btnHelp.node.on("click",function(){app.pages.windowspagetipshelp.showPage("1023")}),this.p_sprIcon.node.on("touchend",function(){app.playSound("click"),e.onChangeIcon()})},onClose:function(){eventMgr.emit(eventStr.redEvent.RefreshLegionHomePageRed),this._super()},setParam:function(e){this.legionInfo=e,this.refreshUI(),this.refreshTableV(),this.refreshProbar(),this.refreshIconUI()},refreshUI:function(){var e=this.legionInfo;this.p_labName.string=langMgr.getString("legionPage",0,e.name),this.p_labLevel.string=langMgr.getString("legionPage",1,e.level),this.p_labPlayerNum.string=e.members.length+"/"+e.mpnum,this.m_nodePower.getComponent("PowerDisplay").init(e.power),this.p_labIntro.string=e.notice;var t=this.m_post=e.pos;this.p_sprExit.spriteFrame=2==t?this.p_arrExitSpriteF[1]:this.p_arrExitSpriteF[0],this.p_btnMail.node.active=2==t,this.p_btnApply.node.active=2==t||1==t,this.p_btnSet.node.active=2==t,this.p_btnFix.node.active=2==t,this.refreshRed()},refreshRed:function(){var e=app.pages.legionhomepage.checkLobby();this.p_btnManager.node.getChildByName("rednotice").active=(2==this.m_post||1==this.m_post)&&e,this.p_btnApply.node.getChildByName("rednotice").active=(2==this.m_post||1==this.m_post)&&e},refreshIconUI:function(){var e=this.legionInfo.flag,t=app.db.getLegionIconInfo(e);app.loadTexture(gConfig.rootPath.uilegionicon+t.PATH,this.p_sprIcon)},refreshTableV:function(){var e=this.setData(this.legionInfo.members);this.legionInfo.TIME=this.getCeoLastOLTime(),this.p_tableView.initTableView(e.length,{array:e,target:this,canClick:!0})},setData:function(e){var t=app.player.getServerTime(),a=e;return a.sort(function(e,t){return e.pos>t.pos?-1:e.pos<t.pos?1:0}),a.sort(function(e,a){return e.pos!==a.pos?0:(t-e.lastest)/1e3/60<=30?-1:(t-e.lastest)/1e3/60>30?1:0}),a.sort(function(e,a){return(t-e.lastest)/1e3/60<=30!=(t-a.lastest)/1e3/60<=30?0:e.pos!==a.pos?0:e.score>a.score?-1:e.score<a.score?1:0}),a},refreshProbar:function(){var e=this.legionInfo.exp,t=this.legionInfo.maxexp;this.p_labProgress.string=e+"/"+t,this.p_progressBar.progress=e/t},onApply:function(){app.player.getLegionApply(function(e){app.pages.legionapplypage.showPage(e)})},onExit:function(){2==this.m_post?this.legionDestroy():this.legionQuit()},onLog:function(){app.player.sfGetLegionLog(function(e){app.pages.legionlogpage.showPage(e)})},onMail:function(){if(app.player.getServerTime()<this.legionInfo.nextmail){var e=this.legionInfo.nextmail-app.player.getServerTime(),t=gUtils.getCountDownStr(e);app.showNotice(langMgr.getString("legionPage",2,t))}else app.pages.mailreplypage.showPage({type:2,target:this})},onSet:function(){var e={name:this.legionInfo.name,intro:this.legionInfo.notice,minlv:this.legionInfo.minlv,ispass:this.legionInfo.ispass,flag:this.legionInfo.flag};app.pages.legionsettingpage.showPage(e)},onFix:function(){var e={name:this.legionInfo.name,intro:this.legionInfo.notice,minlv:this.legionInfo.minlv,ispass:this.legionInfo.ispass};app.pages.windowspagelegionplacard.showPage(e)},showPlayerMgr:function(e,t){this.m_rid=e,this.p_nodeMask.active=!0;var i=this.m_post,n=[];2==i&&(n.push("\u8f6c\u8ba9\u519b\u56e2\u957f"),n.push("\u8e22\u51fa\u519b\u56e2")),n.push("\u52a0\u597d\u53cb"),n.push("\u67e5\u770b"),1==t&&2==i?n.push("\u89e3\u6563\u804c\u4f4d"):2==i&&0==t&&this.checkMgrCount()<3&&n.push("\u4efb\u547d\u5b98\u5458");var r=[];n.forEach(function(e){var t=a.indexOf(e);-1!=t&&r.push(t)}),this.p_arrBtnMgr.forEach(function(e,t){-1!=r.indexOf(t)?e.node.active=!0:e.node.active=!1})},checkMgrCount:function(){var e=this.legionInfo.members,t=0;return e.forEach(function(e){1==e.pos&&(t+=1)}),t},managePlayer:function(e){switch(cc.log(a[e]),e){case 0:this.appointPos(2);break;case 1:this.appointPos(0);break;case 2:this.dismissPlayer();break;case 3:this.appointPos(1);break;case 4:this.applyFriend();break;case 5:this.lookPlayerInfo()}},appointPos:function(e){var t=this;app.player.sfLegionAppoint({rid:this.m_rid,type:e},function(){app.player.sfGetLegionInfo(function(a,i){if(!a){var n=langMgr.getString("legionPage",3);2==e?n=langMgr.getString("legionPage",4):1==e&&(n=langMgr.getString("legionPage",5)),app.showNotice(n),t.setParam(i),t.p_nodeMask.active=!1}})})},dismissPlayer:function(){var e=this;app.player.sfLegionDismiss({rid:this.m_rid},function(){e.p_nodeMask.active=!1,app.showNotice(langMgr.getString("legionPage",6)),e.clearOncePlayer(),e.refreshUI(),e.refreshTableV()})},lookPlayerInfo:function(e,t){this.m_rid=e,app.pages.playerotherinfopage.showPage({rid:this.m_rid,battleset:"normal",pos:t,myPos:this.legionInfo.pos,target:this})},applyFriend:function(){var e=this;app.checkMaxFriend()?app.showNotice(langMgr.getString("legionPage",7)):app.player.sfApply([this.m_rid],function(t){e.p_nodeMask.active=!1,t?app.showNotice(t):app.showNotice(langMgr.getString("legionPage",8))})},clearOncePlayer:function(){for(var e=this.legionInfo.members,t=0;t<e.length;++t)e[t].id==this.m_rid&&e.splice(t,1)},legionDestroy:function(){var e=this,t={content:langMgr.getString("legionPage",13),confirmcb:function(){app.player.sfLegionDestroy(function(){e.clearLegionData()})},target:this};app.pages.windowspagetipsmsg.showPage(t)},legionQuit:function(){var e=(app.player.getCount(90371)||0)<1,t=e?langMgr.getString("legionPage",10):langMgr.getString("legionPage",11),a=this,i={content:t,confirmcb:function(){app.player.sfLegionQuit(function(){e&&app.player.addItem([{gsid:90371,count:1}]),a.clearLegionData()})},target:this};app.pages.windowspagetipsmsg.showPage(i)},onChangeIcon:function(){var e=this;app.pages.legioniconpage.showPage({lv:this.legionInfo.level,index:this.legionInfo.flag,Confirm:function(t){e.legionInfo.pos<2?app.showNotice(langMgr.getString("legionPage",9)):e.legionInfo.flag!=t&&app.player.sfLegionIcon(t,function(){e.legionInfo.flag=t,app.legionInfo.flag=t,e.refreshIconUI()})}})},clearLegionData:function(){app.player.legion=0,this.onClose(),app.closeAllPage()},getCeoLastOLTime:function(){for(var e=this.legionInfo.members,t=0;t<e.length;++t)if(2==e[t].pos)return e[t].lastest},recruitShare:function(){if(app.roomid_server){var e={guildid:this.legionInfo.id,guildname:this.legionInfo.name},t=langMgr.getString("chatItemPlayer",3,this.legionInfo.name);app.sendChatMsg(app.roomid_server,t,3,e)}}});i.showPage=function(){var t=this;app.player.sfGetLegionInfo(function(a,i){a||e("basePage").showPage.call(t,i)})},cc._RF.pop()},{basePage:void 0}],legionPracticeDebuffPage:[function(e,t){"use strict";cc._RF.push(t,"d305775Bj5PD7Cku/spMhWT","legionPracticeDebuffPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"legionpracticedebuffpage",pageType:1},properties:{},onLoad:function(){a.instance=this,this.creatMask(!0)},setParam:function(){}});cc._RF.pop()},{basePage:void 0}],legionPracticePage:[function(e,t){"use strict";cc._RF.push(t,"cb213R3YPNOVr1L2LfA7CH2","legionPracticePage");var a=["\u897f\u695a\u9738\u738b","\u7b2c\u516d\u5929\u9b54\u738b","\u4f4d\u9762\u4e4b\u5b50","\u8d8a\u540e\u4e4b\u9f99"],i=cc.Enum({"\u6311\u6218":0,"\u626b\u8361":1,"\u514d\u8d39\u6311\u6218":2,"\u514d\u8d39\u626b\u8361":3,"\u6311\u6218\u6b21\u6570\u5df2\u7528\u5b8c":4}),n=cc.Class({extends:e("basePage"),statics:{prefabPath:"legionpracticepage"},properties:{p_btnRank:cc.Button,p_btnDebuff:cc.Button,p_btnHelp:cc.Button,p_sprTitle:cc.Sprite,p_sprBG:cc.Sprite,p_nodeSkill:cc.Node,p_sprHero:cc.Sprite,p_sp_hero:sp.Skeleton,p_animHero:cc.Animation,p_labTime:cc.Label,p_bgTime:cc.Node,p_labNextTime:cc.Label,p_labNextName:cc.Label,p_labCanFightNum:cc.Label,p_btnReward:cc.Button,p_btnFight:cc.Button,p_btnFarm:cc.Button,p_btnBigFight:cc.Button,p_pfbGoodsItem:cc.Prefab,p_nodeContent:cc.Node,p_arrSfType:[cc.SpriteFrame]},onLoad:function(){n.instance=this,this.stopNodeEvent(),this.fitTopMenu(),this.handleUI(),this.schedule(this.refreshTime,1)},handleUI:function(){var e=this;this._super(),this.p_btnRank.node.on("click",function(){app.playSound("click"),app.pages.legionpracticerankpage.showPage(e.m_objPractice)}),this.p_btnReward.node.on("click",function(){app.playSound("click"),app.pages.legionpracticerewardpage.showPage(e.m_objPractice)}),this.p_btnDebuff.node.on("click",function(){app.playSound("click"),app.pages.legionpracticedebuffpage.showPage()}),this.p_btnHelp.node.on("click",function(){app.pages.windowspagetipshelp.showPage("1026")}),this.p_btnFight.node.on("click",function(){app.playSound("click"),e.onFight()}),this.p_btnBigFight.node.on("click",function(){app.playSound("click"),e.onFight()}),this.p_btnFarm.node.on("click",function(){app.playSound("click"),e.onFarm()}),this.p_nodeSkill.children.forEach(function(t,a){t.on("touchend",function(){app.playSound("click"),e.onClickSkill(a)})})},setParam:function(e){console.log(e),this.m_objPractice=e,this.refreshUI()},refreshUI:function(){var e,t=this,a=this.m_objPractice.boss.id,i=gConfig.getLegionPracticeTitlePath(a);switch(app.loadTexture(i,this.p_sprTitle,this.prefabPath),a){case 1:e=17029;break;case 2:e=18009;break;case 3:e=17129;break;case 4:e=18028}app.loadGeneral(e,this.p_sprHero,this.p_sp_hero,this.p_animHero,null,this.prefabPath),this.m_arrSkillGSID=app.db.dbLegionPractice.BOSS_INFO[a].SKILL,this.p_nodeSkill.children.forEach(function(e,a){var i=t.m_arrSkillGSID[a];i?(e.active=!0,e.getComponent("skillItem").initForShow(i,t)):e.active=!1}),this.refreshReward(),this.p_btnDebuff.node.active=0==this.m_objPractice.boss.hasgift,this.refreshBtnUI(),this.refreshTime()},onClickSkill:function(e){var t={type:"general",gsid:this.m_arrSkillGSID[e],index:e};app.pages.windowspagetipsskill.showPage(t)},refreshReward:function(){for(var e=this.m_objPractice.boss.id,t=app.db.dbLegionPractice.BOSS_INFO[e].FIGHT_REWARD,a=app.db.dbLegionPractice.BOSS_INFO[e].RANDOM_REWARD,i=[],n=0;n<t.length;++n){var r=t[n].GSID,o=t[n].COUNT+t[n].ADD*app.player.level;i.push({GSID:r,COUNT:o})}for(var s=0;s<a.length;++s){var p=a[s].GSID;i.push({GSID:p})}for(var c=0;c<i.length;++c){var h=i[c],l=this.p_nodeContent.children[c];l||(l=cc.instantiate(this.p_pfbGoodsItem),this.p_nodeContent.addChild(l)),l.active=!0,h.COUNT?l.getComponent("propItem").initForBag(h):l.getComponent("propItem").initForGsid(h.GSID),l.getComponent("propItem").setClick(!0)}for(var g=i.length;g<this.p_nodeContent.childrenCount;++g)this.p_nodeContent.children[g].active=!1},refreshBtnUI:function(){var e=this,t=app.player.getCount(90389),n=4-t,r=this.m_objPractice.boss.endtime;this.p_labCanFightNum.string=langMgr.getString("legionPracticePage",0,[n,4]);var o=app.db.dbLegionPractice.FIGHTING_COST[t],s=!!o,p=function(t,a){var n=t.node.getChildByName("layout");n.getChildByName("text").getComponent(cc.Sprite).spriteFrame=s?e.p_arrSfType[i[a]]:e.p_arrSfType[i["\u514d\u8d39"+a]];var r=n.getChildByName("cost");return r.active=s,s?(r.active=!0,r.getChildByName("num").getComponent(cc.Label).string=o):r.active=!1,!0};(this.p_labTime.node.active=!!r,this.p_bgTime.active=!!r,this.p_btnFight.node.active=!!r&&!!n&&p(this.p_btnFight,"\u6311\u6218")&&0!=this.m_objPractice.boss.lastdamage,this.p_btnFarm.node.active=!!r&&!!this.m_objPractice.boss.lastdamage&&!!n&&p(this.p_btnFarm,"\u626b\u8361"),this.p_btnBigFight.node.active=!!r&&!this.p_btnFarm.node.active,this.p_btnBigFight.interactable=!!n,this.p_btnBigFight.node.active)&&(this.p_btnBigFight.node.getChildByName("text").getComponent(cc.Sprite).spriteFrame=n?s?this.p_arrSfType[i["\u6311\u6218"]]:this.p_arrSfType[i["\u514d\u8d39\u6311\u6218"]]:this.p_arrSfType[i["\u6311\u6218\u6b21\u6570\u5df2\u7528\u5b8c"]]);this.p_labNextTime.node.active=!r,this.p_labNextName.node.active=!r;var c=this.m_objPractice.boss.id;c>=a.length&&(c=0),this.p_labNextName.string=a[c]+langMgr.getString("legionPracticePage",1)},refreshTime:function(){var e=this.m_objPractice.boss.endtime,t=this.m_objPractice.boss.nexttime,a=app.player.getServerTime();if(e){var i=e-a;i<=0?this.onClose():this.p_labTime.string=langMgr.getString("legionPracticePage",2)+gUtils.getHourMinSecTime(i/1e3)}else if(t){var n=t-a;n<=0?this.onClose():this.p_labNextTime.string=gUtils.getHourMinSecTime(n/1e3)}},onFight:function(){var e=app.player.getCount(90389),t=app.db.dbLegionPractice.FIGHTING_COST[e]?app.db.dbLegionPractice.FIGHTING_COST[e]:0;app.player.getCount(38005)<t?app.showNotice(langMgr.getString("legionPracticePage",3)):(app.bossId=this.m_objPractice.boss.id,app.goToBossBattle("legionwboss",this.m_objPractice.boss))},onFarm:function(){var e=this,t=app.player.getCount(90389),a=app.db.dbLegionPractice.FIGHTING_COST[t]?app.db.dbLegionPractice.FIGHTING_COST[t]:0;if(app.player.getCount(38005)<a)app.showNotice(langMgr.getString("legionPracticePage",3));else{var i=gUtils.showNum(this.m_objPractice.boss.lastdamage),n={content:langMgr.getString("legionPracticePage",4,i),confirmcb:function(){app.player.sfWorldBossFarm(function(t){app.player.reduceItem({gsid:38005,count:a}),app.player.addItem([{gsid:90389,count:1}]),app.player.addItem([t.rewards]),e.refreshUI();var i={showtype:1,reward:t.rewards};app.pages.windowspagereward.showPage(i)})},target:this};app.pages.windowspagetipsmsg.showPage(n)}},afterBattleFresh:function(){var e=this;app.player.sfGetWorldBossInfo(function(t){e.setParam(t)})},onClose:function(){eventMgr.emit(eventStr.redEvent.RefreshLegionHomePageRed),this._super()}});n.showPage=function(t,a,i){var n=this;1!=app.db.getChannelControlInfo().LEGION_PRACTICE&&app.player.sfGetWorldBossInfo(function(t){e("basePage").showPage.call(n,t,a,i)})},cc._RF.pop()},{basePage:void 0}],legionPracticeRankPage:[function(e,t){"use strict";cc._RF.push(t,"af1d8BkK9xCvpHfnGJnWx7Z","legionPracticeRankPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"legionpracticerankpage"},properties:{p_menu:cc.Node,p_nodePlayerRank:cc.Node,p_nodeLegionRank:cc.Node,p_nodeSelf:cc.Node,p_nodeSelfLegion:cc.Node,p_btnHelp:cc.Button,p_btnReward:cc.Button},onLoad:function(){var e=this;a.instance=this,this.stopNodeEvent(),this.handleUI(),this.fitTopMenu(),this.p_menu.getComponent("menu").init(this),this.p_btnHelp.node.on("click",function(){app.pages.windowspagetipshelp.showPage("1026")}),this.p_btnReward.node.on("click",function(){app.playSound("click"),app.pages.legionpracticerewardpage.showPage(e.m_objData)})},handleUI:function(){this._super()},menuHandler:function(e){var t;switch(e){case 0:this.p_nodeLegionRank.active=!0,this.p_nodeSelfLegion.parent.active=!0,this.p_nodePlayerRank.active=!1,this.p_nodeSelf.parent.active=!1,this.p_nodeLegionRank.getComponent("tableView").initTableView(this._arrLegion.length,{arr:this._arrLegion,target:this}),t=this._arrLegion[this._legion-1],this.p_nodeSelfLegion.getComponent("legionPRankItem").refreshUI(this._legion,t);break;case 1:this.p_nodeLegionRank.active=!1,this.p_nodeSelfLegion.parent.active=!1,this.p_nodePlayerRank.active=!0,this.p_nodeSelf.parent.active=!0,this.p_nodePlayerRank.getComponent("tableView").initTableView(this._arrDamage.length,{arr:this._arrDamage,target:this}),t=this._arrDamage[this._self-1],this.p_nodeSelf.getComponent("playerPRankItem").refreshUI(this._self,t)}console.log(this.p_nodePlayerRank)},setParam:function(e){console.log(e),this.m_objData=e,this._arrDamage=this.setData(e.rank),this._arrLegion=this.setData(e.worldrank),this._self=e.self.rank,this._legion=e.legion.rank,this.p_menu.getComponent("menu").setMenuIndex(0)},setData:function(e){for(var t=Math.ceil(.2*e.length)-1,a=0;a<e.length;a++)e[a].damge?(a<=t&&(e[a].rank=!0),e[a].damge=this.initNum(e[a].damge)):e[a].total&&(e[a].total=this.initNum(e[a].total));return e},initNum:function(e){var t=e;return e>1e8?t=Math.floor(e/1e7)/10+"\u4ebf":e>1e7?t=Math.floor(e/1e4)+"\u4e07":e>1e5&&(t=Math.floor(e/100)/100+"\u4e07"),t}});cc._RF.pop()},{basePage:void 0}],legionPracticeRewardPage:[function(e,t){"use strict";cc._RF.push(t,"548c9N4qoFPt7dfUfRu3HEj","legionPracticeRewardPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"legionpracticerewardpage",pageType:1},properties:{p_nodeRewardView:cc.tableView,p_pfbGoodsItem:cc.Prefab,p_nodeContent:cc.Node},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},setParam:function(e){this.m_objPractice=e,this.initSelf()},initSelf:function(){this.refreshDamageReward(),this.refreshRankRewardList()},refreshDamageReward:function(){for(var e=app.db.dbLegionPractice.LEGION_HARM_FIRST,t=[],a=0;a<e.length;++a){var i=e[a].GSID,n=e[a].COUNT;if(!i)break;t.push({GSID:i,COUNT:n})}for(var r=0;r<t.length;++r){var o=this.p_nodeContent.children[r];o||(o=cc.instantiate(this.p_pfbGoodsItem),this.p_nodeContent.addChild(o)),o.active=!0,o.getComponent("propItem").initForBag(t[r]),o.getComponent("propItem").setClick(!0)}for(var s=t.length;s<this.p_nodeContent.childrenCount;++s)this.p_nodeContent.children[s].active=!1},refreshRankRewardList:function(){var e=app.db.dbLegionPractice.LEGION_WORLD_REWARD;this.p_nodeRewardView.getComponent("tableView").initTableView(e.length,{array:e,target:this})}});cc._RF.pop()},{basePage:void 0}],legionRankPage:[function(e,t){"use strict";cc._RF.push(t,"61982WfeKpLApf+rtubpLSI","legionRankPage");var a=e("dbLegionBoss"),i=cc.Class({extends:e("basePage"),statics:{prefabPath:"legionrankpage",pageType:1},properties:{p_nodeContent:cc.Node,p_nodeRankItem:cc.Node,p_nodeRewardItem:cc.Node},onLoad:function(){var e=this;this.m_arrReward=[this.p_nodeRewardItem],this.m_arrItem=[this.p_nodeRankItem],i.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.node.on("touchend",function(){e.onClose()})},setParam:function(e){this.refreshUI(e)},refreshUI:function(e){for(var t=a.BOSS[e-1].KREWARD,i=a.RANK,n=a.BOSS[e-1].REWARD,r=0;r<i.length;++r){var o=this.m_arrItem[r];o||((o=cc.instantiate(this.p_nodeRankItem)).parent=this.p_nodeContent,this.m_arrItem.push(o)),o.getComponent("legionRankRewardItem").initSelf(i[r],t,this)}for(var s=0;s<n.length;++s){var p=this.m_arrReward[s],c=n[s];p||((p=cc.instantiate(this.p_nodeRewardItem)).parent=this.p_nodeRewardItem.parent,this.m_arrReward.push(p)),p.getComponent("propItem").initForBag(c),p.getComponent("propItem").setClick(!0)}}});cc._RF.pop()},{basePage:void 0,dbLegionBoss:void 0}],legionRecommendPage:[function(e,t){"use strict";cc._RF.push(t,"f8a332jMw5Dgq53BpOrIiFM","legionRecommendPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"legionrecommendpage"},properties:{p_btnCreate:cc.Button,p_btnSearch:cc.Button,p_nodeList:cc.Node,p_nodeListItem:cc.Node,p_btnRefresh:cc.Button,p_ebSearchName:cc.EditBox},onLoad:function(){a.instance=this,this.stopNodeEvent(),this.handleUI()},handleUI:function(){var e=this;this._super(),this.p_btnCreate.node.on("click",function(){app.playSound("click"),app.pages.legioncreatepage.showPage()}),this.p_btnRefresh.node.on("click",function(){app.playSound("click"),e.refreashList()}),this.p_btnSearch.node.on("click",function(){app.playSound("click"),e.searchLegionByName()})},setParam:function(){this.p_btnCreate.node.active=!app.player.legion,this.getLegionList(),app.runUnlockGuide("LEGION")},refreshListUI:function(){for(var e=this.m_arrList,t=0;t<e.length;++t){var a=this.p_nodeList.children[t];a||(a=cc.instantiate(this.p_nodeListItem),this.p_nodeList.addChild(a)),a.active=!0,a.getComponent("legionListItem").initSelf({pdata:e[t],target:this})}for(var i=e.length;i<this.p_nodeList.childrenCount;++i)this.p_nodeList.children[i].active=!1},refreashList:function(){var e=app.player.getServerTime();this.m_lastTime&&e-this.m_lastTime<3e3?app.showNotice(langMgr.getString("legionRecommendPage",0,3-Math.floor((e-this.m_lastTime)/1e3))):(this.m_lastTime=e,this.getLegionList())},getLegionList:function(){var e=this;app.player.sfGetLegionList(function(t){e.m_arrList=t.legionlist,e.refreshListUI()})},searchLegionByName:function(){var e=this,t=this.p_ebSearchName.string;if(""!=t){var a={name:t};app.player.sfLegionSearch(a,function(t){e.m_arrList=[t],e.refreshListUI()})}else app.showNotice(langMgr.getString("legionRecommendPage",1))}});a.showPage=function(t,a,i){var n=this;app.db.checkFuncUnLock("LEGION",!0)&&("look"!=t?app.player.sfPlayerByParam(["legion"],function(){app.player.legion?app.player.sfGetLegionInfo(function(e,t){if(!e){var a={info:t};app.pages.legionhomepage.showPage(a)}}):e("basePage").showPage.call(n,t,a,i)}):e("basePage").showPage.call(this,t,a,i))},a.refreshRed=function(e){var t=!1;return app.player.legion&&(t=app.pages.legionhomepage.refreshRed()),e&&(e.active=t),t},cc._RF.pop()},{basePage:void 0}],legionSettingPage:[function(e,t){"use strict";cc._RF.push(t,"ab52dUOnXBDFLJVZhdZWUBb","legionSettingPage");var a=[0,30,60],i=cc.Class({extends:e("basePage"),statics:{prefabPath:"legionsettingpage",pageType:1},properties:{p_ebName:cc.EditBox,p_ebIntro:cc.EditBox,p_labVer:cc.Label,p_labVerLv:cc.Label,p_btnSure:cc.Button,p_btnChange:cc.Button,p_sprFlag:cc.Sprite,p_arrBtnUp:[cc.Button],p_arrBtnDown:[cc.Button]},onLoad:function(){i.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){var e=this;this._super(),this.p_arrBtnUp.forEach(function(t,a){t.node.on("click",function(){app.playSound("click"),e.setData("ver",a)})}),this.p_arrBtnDown.forEach(function(t,a){t.node.on("click",function(){app.playSound("click"),e.setData("verlv",a)})}),this.p_btnSure.node.on("click",function(){app.playSound("click"),e.onFixInfo()}),this.p_btnChange.node.on("touchend",function(){app.playSound("click"),e.onChangeIcon()})},setParam:function(e){this.m_objData=e,console.log(this.m_objData),this.refreshCreateUI()},refreshCreateUI:function(){for(var e,t,i=this.m_objData,n=0;n<a.length;++n)if(a[n]==i.minlv){this.m_verLv=n;break}this.m_isVer=i.ispass,this.p_ebName.enabled=!1,e=i.name,t=i.intro,this.p_ebName.placeholder=e,this.p_ebIntro.placeholder=t,this.p_ebIntro.string="";var r=app.db.getLegionIconInfo(i.flag);app.loadTexture(gConfig.rootPath.uilegionicon+r.PATH,this.p_sprFlag),this.refreshIsVer(),this.refreshVerLv()},setData:function(e,t){"ver"==e?(this.m_isVer=!this.m_isVer,this.refreshIsVer()):(this.m_verLv=t?this.m_verLv+1:this.m_verLv-1,this.refreshVerLv())},refreshIsVer:function(){this.p_labVer.string=this.m_isVer?langMgr.getString("legionSettingPage",1):langMgr.getString("legionSettingPage",0)},refreshVerLv:function(){var e=a[this.m_verLv];this.p_labVerLv.string=e?langMgr.getString("legionSettingPage",2,e):langMgr.getString("legionSettingPage",3),this.p_arrBtnDown[1].interactable=!(this.m_verLv>=a.length-1),this.p_arrBtnDown[0].interactable=this.m_verLv},onFixInfo:function(){var e=this,t={},i=this.p_ebIntro.string,n=a[this.m_verLv],r=this.m_isVer;n!=this.m_objData.minlv&&(t.minlv=n),r!=this.m_objData.ispass&&(t.ispass=r?1:0),i==this.m_objData.intro||(t.notice=i,app.checkMatchStr(i))?"{}"!=JSON.stringify(t)?app.player.sfLegionSet(t,function(){app.showNotice(langMgr.getString("legionSettingPage",6)),e.onClose(),app.pages.legionpage.instance.onClose()}):app.showNotice(langMgr.getString("legionSettingPage",5)):app.showNotice(langMgr.getString("legionSettingPage",4))},onChangeIcon:function(){var e=this;app.pages.legioniconpage.showPage({lv:this.m_objData.minlv,index:this.m_objData.flag,Confirm:function(t){e.m_objData.flag!=t&&app.player.sfLegionIcon(t,function(){e.m_objData.flag=t,e.refreshCreateUI(),app.showNotice(langMgr.getString("legionSettingPage",8)),app.pages.legionpage.instance&&(app.pages.legionpage.instance.legionInfo.flag=t,app.legionInfo.flag=t,app.pages.legionpage.instance.refreshIconUI())})}})}});cc._RF.pop()},{basePage:void 0}],legionShopPage:[function(e,t){"use strict";cc._RF.push(t,"f9c57qVn9hFh7Zb5tcLFjWP","legionShopPage");var a=e("dbLegionFLevel"),i=cc.Class({extends:e("basePage"),statics:{prefabPath:"legionshoppage",pageType:1},properties:{p_tableView:cc.tableView,p_arrBtnType:[cc.Button],p_labTime:cc.Label,p_btnSure:cc.Button,p_labNum:cc.Label,p_nodeWarn:cc.Node,p_orderRed:cc.Node,p_arrNodeType:[cc.Node],p_nodeCost:cc.Node,p_arrNodeLv:[cc.Node],p_progressBar:cc.ProgressBar,p_labCanPayNum:cc.Label,p_labNormalPayNum:cc.Label,p_labHighPayNum:cc.Label,p_btnSure_1:cc.Button,p_btnSure_10:cc.Button,p_tableViewRank:cc.tableView,p_btnHelp:cc.Button,p_sprTx:cc.Sprite,p_spIconArr:[cc.Sprite]},onLoad:function(){var e=this;i.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.m_nowTime=0,this.nodeType=0,this.onSF=this.p_arrBtnType[0].node.getComponent(cc.Sprite).spriteFrame,this.offSF=this.p_arrBtnType[1].node.getComponent(cc.Sprite).spriteFrame;var t=[38006,38005];this.p_spIconArr.forEach(function(a,i){var n=gConfig.getCurrencyIconPath(t[i]);app.loadTexture(n,a,e.prefabPath)})},handleUI:function(){var e=this;this._super(),this.p_btnSure.node.on("click",function(){app.playSound("click"),e.getMissionList(!0)}),this.p_arrBtnType.forEach(function(t,a){t.node.on("click",function(){a!=e.nodeType&&(app.playSound("click"),e.nodeType=a,e.setViewType())})}),this.p_btnSure_1.node.on("click",function(){app.playSound("click"),e.sfShopLevel(1)}),this.p_btnSure_10.node.on("click",function(){app.playSound("click"),e.sfShopLevel(2)}),this.p_btnHelp.node.on("click",function(){app.pages.windowspagetipshelp.showPage("1025")})},setParam:function(){this.setViewType()},setViewType:function(){var e=this;switch(this.nodeType){case 0:this.getMissionList();break;case 1:this.sfShopLevel(0);break;case 2:this.getShopDonate()}this.p_arrBtnType.forEach(function(t,a){t.node.getChildByName("show icon").active=e.nodeType==a,e.nodeType==a?e.p_arrNodeType[a].active=!0:e.p_arrNodeType[a].active=!1})},refreshUI:function(){var e=this.m_listInfo.length;this.p_nodeWarn.active=!e,this.p_labNum.string=langMgr.getString("legionShopPage",0,e)},refreshTableV:function(){var e=this,t=this.m_listInfo.length;app.legionOrderInfo=this.m_listInfo,this.p_tableView.initTableView(t,{array:this.m_listInfo,target:this},function(){e.p_tableView.getCells(function(e){app.playVerticalListAction(e,["y","scale"])})}),this.p_orderRed.active=app.pages.legionhomepage.checkShop()},refreshTime:function(){var e=43200-(app.player.getServerTime()-this.m_lastTime)/1e3;(e=Math.floor(e))<=0?(this.p_labTime.string=langMgr.getString("legionShopPage",1),this.p_btnSure.interactable=!0,app.setSpriteState(this.p_sprTx,!1)):(this.p_btnSure.interactable=!1,app.setSpriteState(this.p_sprTx,!0),this.p_labTime.string=gUtils.getHourMinSecTime(e))},refreshLevelUI:function(){var e=this.m_lvInfo,t=app.player.getCount(90391),i=3-t;this.p_labCanPayNum.string=langMgr.getString("legionShopPage",2,i),this.p_btnSure_1.interactable=i>=1,this.p_btnSure_10.interactable=i>=1,e.newman>0&&(this.p_btnSure_1.interactable=!1,this.p_btnSure_10.interactable=!1,this.p_labCanPayNum.string=langMgr.getString("legionShopPage",3));var n=app.db.getLegionFLevelPay(1,t),r=app.db.getLegionFLevelPay(2,t),o=n?[n,r]:[];n&&(this.p_labNormalPayNum.string=gUtils.showNum(n.COUNT)),r&&(this.p_labHighPayNum.string=gUtils.showNum(r.COUNT));var s=a[e.lv-1],p=a[e.lv];this.p_progressBar.progress=p?e.exp/p.EXP:1,this.p_progressBar.node.getChildByName("num").getComponent(cc.Label).string=p?e.exp+"/"+p.EXP:langMgr.getString("legionShopPage",4),this.p_btnSure_1.node.active=this.p_btnSure_10.node.active=!!p,this.p_labCanPayNum.node.active=!!p,this.p_nodeCost.active=!!p,this.p_arrNodeLv.forEach(function(t,a){var i=a&&p||s,n=t.getChildByName("level"),r=t.getChildByName("num_1"),o=t.getChildByName("num_2");n.getComponent(cc.Label).string=p?langMgr.getString("legionShopPage",5,e.lv+a):langMgr.getString("legionShopPage",4),r.getComponent(cc.Label).string=langMgr.getString("legionShopPage",6,i.RADD),o.getComponent(cc.Label).string=langMgr.getString("legionShopPage",7,i.MNUM)});for(var c=0;c<o.length;++c){var h=this.p_nodeCost.children[c];h||(h=cc.instantiate(this.p_nodeCost.children[0]),this.p_nodeCost.addChild(h));var l=h.getChildByName("icon").getComponent(cc.Sprite),g=h.getChildByName("num").getComponent(cc.Label),d=o[c],u=app.db.getPropsIconPath(d.GSID);app.loadTexture(u,l,this.prefabPath),g.string=gUtils.showNum(d.COUNT)+"/"+gUtils.showNum(app.player.getCount(d.GSID))}},getMissionList:function(e){var t=this,a=!!e;app.player.sfGetLegionMissionList({isupdate:a},function(e){t.m_listInfo=e.list,t.m_lastTime=e.time||app.player.getServerTime(),t.refreshUI(),t.refreshTableV(),t.refreshTime()})},sfShopLevel:function(e){var t=this,a=app.player.getCount(90391),i=0,n=0,r=0;if(e>0&&(i=app.db.getLegionFLevelPay(e,a).COUNT,n=app.db.getLegionFLevelPay(e,a).GSID,r=app.db.getLegionFLevelGet(e,a),app.player.getCount(n)<i))app.showNotice(langMgr.getString("legionShopPage",8));else{var o={type:e};app.player.sfLegionFlevel(o,function(e){if(t.m_lastLevel=e.lv,r>0){var a=langMgr.getString("legionShopPage",9,r);e.lv>t.m_lastLevel&&(a+=langMgr.getString("legionShopPage",10,e.lv)),app.showNotice(a,null,!0),app.player.addItem([{gsid:90391,count:1}])}app.player.reduceItem({gsid:n,count:i}),t.m_lvInfo=e,t.refreshLevelUI()})}},getShopDonate:function(){var e=this;app.player.sfLegionDonate(function(t){e.m_donateInfo=t,e.refreshDonateTableV()})},refreshDonateTableV:function(){var e=this,t=this.m_donateInfo.length;this.p_tableViewRank.initTableView(t,{array:this.m_donateInfo,target:this},function(){e.p_tableViewRank.getCells(function(e){app.playVerticalListAction(e,["y","scale"])})})},clearItemData:function(e){for(var t=0;t<this.m_listInfo.length;++t)if(this.m_listInfo[t].key==e){this.m_listInfo.splice(t,1);break}this.refreshTableV(),this.refreshUI()},update:function(e){this.m_nowTime+=e,this.m_nowTime>=1&&(this.m_nowTime=0,this.refreshTime())},onClose:function(){eventMgr.emit(eventStr.redEvent.RefreshLegionHomePageRed),this._super()}});cc._RF.pop()},{basePage:void 0,dbLegionFLevel:void 0}],legionSignLogPage:[function(e,t){"use strict";cc._RF.push(t,"54043POS75CTr7o5UId4Wxo","legionSignLogPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"legionsignlogpage",pageType:1,_forceCreateNewShot:!0},properties:{p_tableView:cc.Node},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},setParam:function(e){this.m_legionLogList=e.log,this.refreshTableV()},handleUI:function(){this._super()},refreshTableV:function(){var e=this.m_legionLogList.length;this.p_tableView.getComponent("tableView").initTableView(e,{array:this.m_legionLogList,target:this})}});cc._RF.pop()},{basePage:void 0}],legionSignPage:[function(e,t){"use strict";function a(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(a)return(a=a.call(e)).next.bind(a);if(Array.isArray(e)||(a=i(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function i(e,t){if(e){if("string"==typeof e)return n(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?n(e,t):void 0}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,i=new Array(t);a<t;a++)i[a]=e[a];return i}cc._RF.push(t,"441525+wEFIcbkxARuZVnaq","legionSignPage");var r=cc.Class({extends:e("basePage"),statics:{prefabPath:"legionsignpage",pageType:1},properties:{p_arrBtnSign:[cc.Node],p_arrNodeReward:[cc.Node],p_pfbPropItem:cc.Prefab,p_labTime:cc.Label,p_spSgin:sp.Skeleton,p_btnHelp:cc.Button,p_labScore:cc.Label,p_barScore:cc.ProgressBar,p_arrReward:[cc.Node],P_btnStarcraft:cc.Button,p_labNum:cc.Label,p_arrSftSprF:[cc.SpriteFrame],p_spStarcraft:sp.Skeleton,p_sprFrameBoxOpen:cc.SpriteFrame,p_sprFrameBoxClose:cc.SpriteFrame,p_sprFrameBoxLastOpen:cc.SpriteFrame,p_sprFrameBoxLastClose:cc.SpriteFrame,p_btnRecord:cc.Button,p_spIconArr:[cc.Sprite]},onLoad:function(){var e=this;this.m_index=0,r.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.schedule(this.refreshUI,1),this.controlFunctionByChannel();var t=[38006,38006,38006];this.p_spIconArr.forEach(function(a,i){var n=gConfig.getCurrencyIconPath(t[i]);app.loadTexture(n,a,e.prefabPath)})},handleUI:function(){var e=this;this._super(),this.p_arrBtnSign.forEach(function(t,a){t.on("click",function(){app.playSound("click"),e.onSign(a+1)})}),this.p_btnRecord.node.on("click",function(){app.playSound("click"),app.player.sfLegionsignrecord(function(e){app.pages.legionsignlogpage.showPage(e)})}),this.p_arrReward.forEach(function(t,a){t.on("click",function(){app.playSound("click"),e.getBoxReward(a)})}),this.p_btnHelp.node.on("click",function(){app.pages.windowspagetipshelp.showPage("1073")}),this.P_btnStarcraft.node.on("click",function(){app.pages.windowspagetipslegionstarcraft.showPage(250)})},controlFunctionByChannel:function(){app.db.getChannelControlInfo(),this.P_btnStarcraft.node.active=!1},setParam:function(e){this.m_score=e||0,this.m_index++,this.refreshUI(),this.refeshBoxUI(),this.refeshSignReward()},refeshSignReward:function(){for(var e=app.db.dbLegionSign,t=0;t<3;t++){for(var a=e[t].REWARD,i=this.p_arrNodeReward[t],n=0;n<a.length;n++){var r=i.children[n];r||(r=cc.instantiate(this.p_pfbPropItem),i.addChild(r)),r.active=!0,r.getComponent("propItem").initForBag(a[n]),r.getComponent("propItem").setClick(!0)}for(var o=a.length;o<i.children.length;o++)i.children[o].active=!1}},refreshUI:function(){this.P_btnStarcraft.node.getComponent(cc.Sprite).spriteFrame=this.m_score>=250?this.p_arrSftSprF[1]:this.p_arrSftSprF[0],this.m_score>=250?(this.p_spStarcraft.node.active=!0,this.p_spStarcraft.setAnimation(0,"animation",!0)):this.p_spStarcraft.node.active=!1,this.p_labNum.string="250\u6d3b\u8dc3\u5ea6";for(var e=app.player.getCount(90266),t=app.db.dbLegionSign,a=0;a<this.p_arrBtnSign.length;a++){var i=this.p_arrBtnSign[a],n=t[a];if(i.getComponent(cc.Button).interactable=!e,i.getChildByName("rednotice").active=!e,n.COSUME_COUNT){i.getChildByName("windows_btn_tx_jisi").active=!1;var r=i.getChildByName("layout");r.active=!0;var o=r.getChildByName("coin").getComponent(cc.Sprite),s=gConfig.getCurrencyIconPath(n.COSUME_GSID);app.loadTexture(s,o,this.prefabPath),app.setSpriteState(o,e),i.getChildByName("layout").getChildByName("price").getComponent(cc.Label).string=n.COSUME_COUNT}else i.getChildByName("windows_btn_tx_jisi").active=!0,i.getChildByName("layout").active=!1}},refeshBoxUI:function(){var e=app.db.dbLegionSignScore;this.p_labScore.string=this.m_score;for(var t,a,i=this.m_score,n=this.p_barScore.totalLength/this.p_arrReward.length,r=e.length-1,o=0;o<e.length;++o){var s=e[o],p=e[o-1]||{SCORE:0};if(i<=s.SCORE){t=s.SCORE,a=p.SCORE,r=o;break}}var c;c=t||a?((i-a)/(t-a)+r)*n:this.p_barScore.totalLength,this.p_barScore.progress=Math.min(c/this.p_barScore.totalLength,1),this.m_boxState=[];for(var h=0;h<e.length;h++){var l=e[h].SCORE,g=this.p_arrReward[h],d=this.m_score>=l&&app.player.getCount(e[h].GSID)<1;this.m_score<l?this.m_boxState[h]=1:app.player.getCount(e[h].GSID)<1?this.m_boxState[h]=3:app.player.getCount(e[h].GSID)>0&&(this.m_boxState[h]=2);var u=g.getChildByName("light");u.stopAllActions(),u.active=!1;var f=void 0;switch(this.m_boxState[h]){case 1:f=h==e.length-1?this.p_sprFrameBoxLastOpen:this.p_sprFrameBoxOpen;break;case 2:f=h==e.length-1?this.p_sprFrameBoxLastClose:this.p_sprFrameBoxClose;break;case 3:f=h==e.length-1?this.p_sprFrameBoxLastOpen:this.p_sprFrameBoxOpen,u.active=!0,u.runAction(cc.repeatForever(cc.rotateBy(1,30)))}g.getChildByName("icon").getComponent(cc.Sprite).spriteFrame=f,g.getChildByName("num").getComponent(cc.Label).string=l,g.getChildByName("light").active=d,g.getChildByName("rednotice").active=d}},onSign:function(e){var t=this,a=app.db.dbLegionSign;if(e>1&&app.player.getCount(a[e-1].COSUME_GSID)<a[e-1].COSUME_COUNT){var i=app.db.getPropsInfoByGsid(a[e-1].COSUME_GSID).NAME;app.showNotice(langMgr.getString("legionSignPage",0,i))}else app.player.legionSign(e,function(i){app.player.reduceItem({gsid:a[e-1].COSUME_GSID,count:a[e-1].COSUME_COUNT}),app.player.addItem(i.reward),app.pages.legionhomepage.instance&&(app.pages.legionhomepage.instance.m_legionData=i.legion),t.m_score=i.legion.score||0,t.refeshBoxUI(),i.showtype=1,t.updateOther(),t.playRewardAnim(i)})},getBoxReward:function(e){var t=this,i=app.db.dbLegionSignScore[e];if(i.EXID)switch(this.m_boxState[e]){case 1:case 2:var n={worldPos:this.p_arrReward[e].convertToWorldSpaceAR(cc.v2(0,0)),arrReward:i.REWARD};app.pages.windowspagerewardtips.showPage(n);break;case 3:app.player.sfExchange(i.EXID,1,null,function(e){for(var n,r=[],o=a(e);!(n=o()).done;){var s=n.value;(s.gsid||s.GSID)!=i.GSID&&r.push(s)}var p={showtype:1,reward:r,confirmcb:function(){t.refeshBoxUI()},target:t};app.pages.windowspagereward.showPage(p)})}},updateOther:function(){var e=this;app.player.sfPlayerByParam(["others"],function(){e.m_signTime=gUtils.getSecondDayTime(app.player.getServerTime()),e.refreshUI()})},playRewardAnim:function(e){var t=this,a=this.m_index,i=this,n=function(){if(i.m_index==a)if(app.pages.windowspagereward.showPage(e),0==e.exp)app.showNotice(langMgr.getString("legionSignPage",1));else{var t=langMgr.getString("legionSignPage",2,e.exp);app.showNotice(t)}};this.p_spSgin.setCompleteListener(function(){n()}),app.loadSpine("game_ui_spine/level_up/shengji",this.p_spSgin,function(){cc.log("load succ"),t.p_spSgin.setAnimation(0,"animation",!1)},null,this.prefabPath)},onClose:function(){eventMgr.emit(eventStr.redEvent.RefreshLegionHomePageRed),this._super()}});cc._RF.pop()},{basePage:void 0}],legionSkillPage:[function(e,t){"use strict";function a(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(a)return(a=a.call(e)).next.bind(a);if(Array.isArray(e)||(a=i(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function i(e,t){if(e){if("string"==typeof e)return n(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?n(e,t):void 0}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,i=new Array(t);a<t;a++)i[a]=e[a];return i}cc._RF.push(t,"8ebf0RLfeNBMb+8cSulOnf4","legionSkillPage");var r=e("dbLegionTech"),o=e("dbProperty"),s=cc.Class({extends:e("basePage"),statics:{prefabPath:"legionskillpage"},properties:{p_nodeSkill:cc.Node,p_nodeSkillItem:cc.Node,p_arrBtnType:[cc.Button],p_arrSfSKillIcon:[cc.SpriteFrame],p_arrSkillDescribe:[cc.SpriteFrame],p_sprSkillDescribe:cc.Sprite,p_arrNodeAtt:[cc.Node],p_arrNodeCost:[cc.Node],p_sprSkillIcon:cc.Sprite,p_labSkillLevel:cc.Label,p_btnLevel:cc.Button,p_btnReset:cc.Button,p_spTxtUpgradeAnim:sp.Skeleton},onLoad:function(){s.instance=this,this.p_nodeSkillItem.active=!1,this.m_color=this.p_arrNodeCost[0].getChildByName("cost_num").color,this.m_arrSkill=[],this.m_nodeIndex=0,this.fitTopMenu(),this.stopNodeEvent(),this.initData(),this.handleUI(),this.setViewType(),this.longPress=this.node.getComponent("longPressBtn"),this.longPress.init(this,200)},handleUI:function(){var e=this;this._super(),this.p_arrBtnType.forEach(function(t,a){t.node.on("click",function(){a!=e.m_nodeIndex&&(app.playSound("click"),e.m_nodeIndex=a,e.setViewType(),e.refreshProperty(0),e.refreshUI())})}),this.p_btnReset.node.on("click",function(){app.playSound("click"),e.resetLevel()}),this.clickPressBtn=function(){e.onTechLevel()},this.longPressUpdate=function(){}},initData:function(){for(var e in this.m_dbSkill={},r){var t=r[e],a=this.m_dbSkill[t.OCCU]=this.m_dbSkill[t.OCCU]||[];t.GSID=e,a.push(t)}},setViewType:function(){var e=this;this.p_arrBtnType.forEach(function(t,a){a==e.m_nodeIndex&&(e.p_sprSkillIcon.spriteFrame=e.p_arrSfSKillIcon[a],e.p_sprSkillDescribe.spriteFrame=e.p_arrSkillDescribe[a]),t.node.getChildByName("is").active=a==e.m_nodeIndex})},setParam:function(){this.refreshUI(),this.refreshProperty(0)},refreshUI:function(){var e=this;this.p_btnReset.node.active=this.checkIsStudyTech();for(var t=this.m_dbSkill[this.m_nodeIndex+1],a=function(a){var i=e.m_arrSkill[a];if(!i){(i=cc.instantiate(e.p_nodeSkillItem)).parent=e.p_nodeSkill,e.m_arrSkill.push(i);var n=p(360/t.length*a+360/t.length/2,230);i.x=n.x,i.y=n.y,i.active=!0,i.on("touchend",function(){e.refreshProperty(a)})}e.setItemState(i,t[a])},i=0;i<t.length;++i)a(i)},setItemState:function(e,t){var a=app.player.tech[t.GSID],i=e.getChildByName("icon").getComponent(cc.Sprite),n=e.getChildByName("lab_level"),o=e.getChildByName("lock");n.active=!!a;var s="game_icon/icon_tech/"+t.GSID;app.loadTexture(s,i,this.prefabPath);var p=r[t.GSID],c=p.PRE,h=!1;if(c){var l=c.ID,g=c.LV;(app.player.tech[l]||0)<g&&(h=!0)}if(h)app.setSpriteState(i,!0),o.active=!0;else{var d=Object.keys(p.ATTR)[0],u=p.ATTR[d].length;n.getComponent(cc.Label).string=a+"/"+u,app.setSpriteState(i),o.active=!1}},refreshProperty:function(e){this.m_skilIndex="number"==typeof e?e:this.m_skilIndex,e=this.m_skilIndex;var t=this.m_nodeIndex,a=this.m_dbSkill[t+1][e];this.m_objPRE=a.PRE,this.m_TechId=a.GSID;for(var i=0;i<this.m_arrSkill.length;++i)this.m_arrSkill[i].getChildByName("is").active=e==i;var n=this.m_skillGsid=a.GSID,r=app.player.tech[n]||-1,o=a.ATTR,s=[];for(var p in o){var c=o[p],h={gsid:p,now:-1==r?0:c[r-1],next:-1==r?c[0]:c[r]};s.push(h)}var l=a.COST,g=Object.keys(l);this.m_arrCost=[];for(var d=0;d<this.p_arrNodeCost.length;++d){var u=this.p_arrNodeCost[d],f=g[d];if(f){u.active=!0;var m={gsid:f,count:-1==r?l[f][0]:l[f][r]};this.m_arrCost.push(m),this.refreshCostUI(u,m)}else u.active=!1}for(var _=0;_<this.p_arrNodeAtt.length;++_){var v=this.p_arrNodeAtt[_];s[_]?(v.active=!0,this.refreshSkillItemUI(v,s[_])):v.active=!1}var b=a.NAME+" ";s[0].next?b+=-1!=r?langMgr.getString("legionSkillPage",2,r):langMgr.getString("legionSkillPage",3):b+=langMgr.getString("legionSkillPage",1),this.p_labSkillLevel.string=b,0==this.checkTechOrCost()||this.checkTechOrCost()==langMgr.getString("legionSkillPage",6)?this.p_btnLevel.interactable||(this.p_btnLevel.interactable=!0):(this.p_btnLevel.interactable=!1,this.longPress.setStatus(!1))},refreshCostUI:function(e,t){if(!t.count)return e.active=!1,this.p_btnLevel.node.active=!1,void this.longPress.setStatus(!1);this.p_btnLevel.node.active||(this.p_btnLevel.node.active=!0),e.active=!0;var a=e.getChildByName("cost_icon").getComponent(cc.Sprite),i=e.getChildByName("cost_num").getComponent(cc.RichText),n=app.db.getPropsIconPath(t.gsid);app.loadTexture(n,a,this.prefabPath),i.string=t.count;var r=app.player.getCount(t.gsid),o=t.count,s=gUtils.showNum(o),p=gUtils.showNum(r);i.string=r<o?"<outline color=#2A150E width=2><color=#FF0000>"+p+"</c><color=#FFFADC>/"+s+"</color></outline>":"<outline color=#2A150E width=2><color=#FFFADC>"+p+"/"+s+"</color></outline>"},refreshSkillItemUI:function(e,t){var a=e.getChildByName("now").getComponent(cc.Label),i=e.getChildByName("next").getComponent(cc.Label),n=e.getChildByName("arrow"),r=o[t.gsid].NAME;a.string=cc.js.formatStr("%s + %s%",r,t.now/10),t.next?(n.active=!0,i.string=t.next/10+"%",i.node.active=!0):(n.active=!1,i.string="",i.node.active=!1)},checkTechOrCost:function(){var e=this.m_objPRE,t=this.m_arrCost;if(e){var i=e.ID,n=e.LV,o=r[i].NAME;if((app.player.tech[i]||0)<n)return langMgr.getString("legionSkillPage",7,[o,n])}for(var s,p=a(t);!(s=p()).done;){var c=s.value;if(app.player.getCount(c.gsid)<c.count)return langMgr.getString("legionSkillPage",6)}return 0},onTechLevel:function(){var e,t=this,a=this.m_TechId,i=this.checkTechOrCost();if(i)return app.showNotice(i),void this.longPress.setStatus(!1);this.p_spTxtUpgradeAnim.node.opacity=255,this.p_spTxtUpgradeAnim.setAnimation(0,"effect",!1);var n=null==(e=this.m_arrSkill[this.m_skilIndex].getChildByName("UpgradeAnim"))?void 0:e.getComponent(sp.Skeleton);app.player.legionTechLevel({id:a},function(e){e?t.longPress.setStatus(!1):(app.player.reduceItem(t.m_arrCost),t.refreshTech(),cc.isValid(n)&&(n.node.opacity=255,n.setAnimation(0,"effect2",!1)))})},checkIsStudyTech:function(){for(var e=this.m_dbSkill[this.m_nodeIndex+1],t=0;t<e.length;++t){var a=e[t];if(app.player.tech[a.GSID])return!0}return!1},resetLevel:function(){var e=this,t=(app.player.getCount(90349)||0)<1,a=app.player.getCount(38005);if(!t&&a<1e3)app.showNotice(langMgr.getString("legionSkillPage",0,1e3));else{var i=t?langMgr.getString("legionSkillPage",4):langMgr.getString("legionSkillPage",5,1e3),n=this,r={content:i,confirmcb:function(){app.player.legionTechReset({occu:e.m_nodeIndex+1},function(e){t?app.player.addItem([{gsid:90349,count:1}]):app.player.reduceItem([{gsid:38005,count:1e3}]),app.player.addItem(e.items);var a={reward:e.items,showtype:1};app.pages.windowspagereward.showPage(a),n.refreshTech()})},target:this};app.pages.windowspagetipsmsg.showPage(r)}},refreshTech:function(){var e=this;app.player.sfPlayerByParam(["tech"],function(){e.refreshUI(),e.refreshProperty()})},onClose:function(){this._super(),app.player.sfPlayerData(function(){app.mainScene.refreshCoin()})}});function p(e,t){var a=cc.misc.degreesToRadians(e);return cc.v2(0,t).rotate(a)}cc._RF.pop()},{basePage:void 0,dbLegionTech:void 0,dbProperty:void 0}],legionWarBattleSetPage:[function(e,t){"use strict";cc._RF.push(t,"76b24u/9ElP/Kyx80bLmdLQ","legionWarBattleSetPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"legionwarbattlesetpage",pageType:1},properties:{p_generalContent:cc.Node,p_pfbGeneralItem:cc.Prefab,p_btnSetLineup:cc.Button,p_btnSetCamp:cc.Button,p_btns:cc.Node,p_tipsNode:cc.Node,p_btnDissolve:cc.Button,p_btnUpdateName:cc.Button,p_labBsetName:cc.Label},onLoad:function(){a.instance=this,this.creatMask(!0),this.fitTopMenu(),this.stopBgNodeEvent(),this.handleUI(),this.m_arrGeneral=[],this.isJoinCamps=-1},onEnable:function(){this._super(),eventMgr.on(eventStr.legionWarEvent.RefreshBSet,this.refreshMainUI,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.legionWarEvent.RefreshBSet,this.refreshMainUI,this)},refreshMainUI:function(){this.setParam(app.LpvpIndex)},handleUI:function(){var e=this;this._super(),this.p_btnSetLineup.node.on("click",function(){app.playSound("click"),app.LpvpIndex=e.m_index,app.battleType="legionpvpsave",app.goToNormBattle()}),this.p_btnSetCamp.node.on("click",function(){if(app.playSound("click"),app.db.checkBattleArrTeam(gConfig.LEGIONPVPLINEUP[e.m_index])&&app.db.checkGeneralExist(gConfig.LEGIONPVPLINEUP[e.m_index]))if(e.isJoinCamps>=0){if(e.onClose(),0!=app.legionPvpErrState)return;app.pages.legionwarcampsitepage.showPage({type:e.isJoinCamps,list:app.legionPvpInfo.camps[gConfig.legionPvpCamps[e.isJoinCamps]]})}else e.onClose(),eventMgr.emit(eventStr.legionWarEvent.EnterCamps,e.m_index);else app.showNotice(langMgr.getString("legionWarBattleSetPage",0))}),this.p_btnUpdateName.node.on("click",function(){app.pages.lineupnamepage.showPage({index:e.m_index+1,name:"legionpvp"+(e.m_index+1),type:"legionpvp",funCb:function(){var t="legionpvp"+(e.m_index+1);e.refreshUI(app.player.battlearr[t])}})}),this.p_btnDissolve.node.on("click",function(){app.playSound("click"),app.db.checkBattleArrTeam(gConfig.LEGIONPVPLINEUP[e.m_index])&&app.db.checkGeneralExist(gConfig.LEGIONPVPLINEUP[e.m_index])?app.player.sfLegionPvpSaveBattleset({battleset:{team:{}}},e.m_index+1,function(t){t?app.showNotice(t):(app.showNotice(langMgr.getString("legionWarBattleSetPage",1)),app.player.battlearr[gConfig.LEGIONPVPLINEUP[e.m_index]]=null,eventMgr.emit(eventStr.legionWarEvent.RefreshMainUI,!0),e.onClose())}):app.showNotice(langMgr.getString("legionWarBattleSetPage",0))})},onClose:function(){this._super()},setParam:function(e){this.isJoinCamps=-1;var t={},a=!1;if(this.p_tipsNode.active=!0,"number"==typeof e){if(this.m_index=e,!app.db.checkBattleArrTeam(gConfig.LEGIONPVPLINEUP[this.m_index])||!app.db.checkGeneralExist(gConfig.LEGIONPVPLINEUP[this.m_index]))return app.LpvpIndex=this.m_index,app.battleType="legionpvpsave",app.goToNormBattle(),void this.onClose();t=app.player.battlearr[gConfig.LEGIONPVPLINEUP[this.m_index]];for(var i=0;i<gConfig.legionPvpCamps.length;i++)if(app.pages.legionwarpage.checkCampsBset(i,this.m_index)){this.p_tipsNode.active=!1,this.isJoinCamps=i;break}a=!0}else t=e;this.refreshUI(t),this.refreshBtns(a)},refreshUI:function(e){this.p_labBsetName.string=e.tname||"";var t=0;for(var a in e.team){var i=null;if("string"==typeof e.team[a]){if(!app.player.general[e.team[a]])continue;i=app.player.general[e.team[a]]}else i=e.team[a];var n=this.m_arrGeneral[t];n||((n=cc.instantiate(this.p_pfbGeneralItem)).parent=this.p_generalContent,this.m_arrGeneral.push(n)),n.getComponent("generalPortraitItem").initForTips(i),t++}for(var r=0;r<this.m_arrGeneral.length;r++)r>=t&&(this.m_arrGeneral[r].active=!1)},refreshBtns:function(e){this.p_btns.active=e,this.p_btnDissolve.node.active=e,this.p_btnUpdateName.node.active=e,e||(this.p_tipsNode.active=e)}});cc._RF.pop()},{basePage:void 0}],legionWarBossPage:[function(e,t){"use strict";cc._RF.push(t,"b261bOggs9AeJRTzHXv+85W","legionWarBossPage");var a=cc.color(43,255,33),i=(cc.color(0,75,0),cc.Class({extends:e("basePage"),statics:{prefabPath:"legionwarbosspage",pageType:1},properties:{p_spBoss:sp.Skeleton,p_spLongzhu:sp.Skeleton,p_labName:cc.Label,p_proHp:cc.ProgressBar,p_labPro:cc.Label,p_nodeBox:cc.Node,p_labStage:cc.Label,p_sprSeason:cc.Sprite,p_labIntro:cc.Label,p_btnChallenge:cc.Button,p_btnMop:cc.Button,p_btnSeeOther:cc.Button,p_sprSeeNodes:[cc.Node],p_labNoChallenge:cc.Label,p_labCount:cc.Label,p_labCosts:[cc.Label],p_labTx:[cc.Node],p_arrStep:[cc.Node],p_btnRank:cc.Button},onLoad:function(){i.instance=this,this.creatMask(!0),this.fitTopMenu(),this.stopBgNodeEvent(),this.handleUI(),this.isOther=!1},handleUI:function(){var e=this;this._super(),this.p_btnChallenge.node.on("click",function(){e.goBattle()}),this.p_btnMop.node.on("click",function(){e.doMop()}),this.p_btnRank.node.on("click",function(){var t={rank:{selfrank:e.m_selflist,damge:e.m_damge,list:e._boss.rank},rtype:"legion",title:"\u519b\u56e2BOSS\u6392\u884c",hideMy:e.isOther};app.pages.ranklistpage.showPage(t)}),this.p_nodeBox.on("touchend",function(){app.pages.legionwarrewardpage.showPage()}),this.p_btnSeeOther.node.on("click",function(){if(e.isOther)app.player.sfGetLegionPvpMobBossInfo({pos:0},function(t,a){t?app.showNotice(t):e.refreshBoss(a)});else{if(!(app.legionPvpInfo&&app.legionPvpInfo.opponent&&app.legionPvpInfo.opponent.legion))return void app.showNotice(langMgr.getString("legionWarBossPage",8));app.player.sfGetLegionPvpOpponentBossINfo({legion:app.legionPvpInfo.opponent.legion},function(t,a){t?app.showNotice(t):(a.isOther=!0,e.refreshBoss(a))})}}),this.m_arrSteps=[];for(var t=0;t<this.p_arrStep.length;++t)cc.isValid(this.p_arrStep[t])&&this.m_arrSteps.push(this.p_arrStep[t])},onEnable:function(){this._super(),eventMgr.on(eventStr.legionWarEvent.RefreshWboss,this.refreshBoss,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.legionWarEvent.RefreshWboss,this.refreshBoss,this)},onClose:function(){this._super()},setParam:function(e){this.refreshBoss(e)},refreshBoss:function(e){var t=this;if(e){this.isOther=!!e.isOther;var i=app.db.getLegionWarBossInfo(app.seasonData.info.season);i&&(this.p_labName.string=i.NAME,app.loadSpine(gConfig.rootPath.uispine+"legionwarboss/"+i.ICON+"/yingzheng",this.p_spBoss,function(){t.p_spBoss.setAnimation(0,"10",!0)},null,this.prefabPath),this.p_spLongzhu.setAnimation(0,i.SEASON.toString(),!0),app.loadTexture(gConfig.rootPath.uilegionicon+"icon_"+i.ICON,this.p_sprSeason),this.p_labIntro.string=i.INTRO),this._boss=e;var n=e.totaldamage/e.nextstagedamage;this.p_proHp.progress=n,this.p_labPro.string=n>=1?langMgr.getString("legionWarBossPage",3):gUtils.showNum(e.totaldamage)+"/"+gUtils.showNum(e.nextstagedamage),this.p_labStage.string=langMgr.getString("legionWarBossPage",4,e.step),this.p_labCount.string=langMgr.getString("legionWarBossPage",5,this._boss.chance.num),this.p_labCount.node.active=this._boss.chance.num>0&&!this.isOther,this.p_btnChallenge.node.active=this._boss.chance.num>0&&!this.isOther,this.p_labNoChallenge.node.active=this._boss.chance.num<=0&&!this.isOther,this.p_sprSeeNodes[0].active=this.isOther,this.p_sprSeeNodes[1].active=!this.isOther,this.p_btnMop.node.active=!!this._boss.lastdamage&&this._boss.chance.num>0&&!this.isOther;var r=this._boss.chance.cast||[];r.length>0?this.p_labCosts.forEach(function(e){e.string=t._boss.chance.cast[0].COUNT,e.node.parent.active=!0}):this.p_labCosts.forEach(function(e){e.string=0,e.node.parent.active=!1}),this.p_labTx.forEach(function(e){e.x=r.length>0?11:0});for(var o=0;o<this._boss.buffs.length;++o){var s=this.m_arrSteps[o];s||((s=cc.instantiate(this.p_arrStep[0])).parent=this.p_arrStep[0].parent,this.m_arrSteps.push(s)),s.active=!0;var p=this._boss.buffs[o].KEY;"hp"==this._boss.buffs[o].KEY&&(p="php");var c=this._boss.step-1>o||n>=1;s.getComponent(cc.Label).string=o+1+langMgr.getString("legionWarBossPage",6)+app.db.getPropertyCnByEn(p)+"+"+this._boss.buffs[o].VAL+"%",s.color=c?a:cc.Color.WHITE}for(var h=this._boss.buffs.length;h<this.m_arrSteps.length;++h)this.m_arrSteps[h].active=!1;this.getRankInfo()}},getRankInfo:function(){var e=this;this._boss.rank.forEach(function(t,a){if(t.name==app.player.rname)return e.m_selflist=a+1,void(e.m_damge=t.damage||t.damge)})},goBattle:function(){this.isCanChallenge()&&(app.battleParam={},app.battleParam.pos=0,app.goToBossBattle("legionwarb",this._boss))},doMop:function(){if(this.isCanChallenge()){var e=this._boss.chance.cast,t=this._boss.lastdamage,a={content:langMgr.getString("legionWarBossPage",7,t),confirmcb:function(){app.player.sfLegionPvpMobBossFarm({pos:0,times:1},function(t,a){var i={showtype:1,reward:a.items};app.player.addItem(a.items),app.player.reduceItem(e),app.pages.windowspagereward.showPage(i),app.player.sfGetLegionPvpMobBossInfo({pos:0},function(){})})},target:this};app.pages.windowspagetipsmsg.showPage(a)}},isCanChallenge:function(){if(!this._boss)return app.showNotice(langMgr.getString("legionWarBossPage",0)),!1;if(this._boss.chance.num<=0)return app.showNotice(langMgr.getString("legionWarBossPage",1)),!1;var e=this._boss.chance.cast||[];if(e.length>0)for(var t=0;t<e.length;++t)if(app.player.getCount(e[t].GSID)<e[t].COUNT){var a=app.db.getPropsInfoByGsid(e[t].GSID);return app.showNotice(langMgr.getString("legionWarBossPage",2,a.NAME)),!1}return!0}}));cc._RF.pop()},{basePage:void 0}],legionWarCampsitePage:[function(e,t){"use strict";cc._RF.push(t,"acf47b0FdZLgqD8LRk78oze","legionWarCampsitePage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"legionwarcampsitepage",pageType:1},properties:{p_labTitle:cc.Label,p_labMember:cc.Label,p_btnJoinCamp:cc.Button,p_btnChangeList:cc.Button,p_memberView:cc.Node},onLoad:function(){a.instance=this,this.creatMask(!0),this.fitTopMenu(),this.stopBgNodeEvent(),this.handleUI()},onEnable:function(){this._super()},onDisable:function(){this._super()},handleUI:function(){var e=this;this._super(),this.p_btnJoinCamp.node.on("click",function(){app.playSound("click"),app.pages.legionwarjoinpage.showPage(e.m_objData.type)}),this.p_btnChangeList.node.on("click",function(){app.playSound("click"),2==app.legionInfo.pos?(app.legionIsChange=!0,e.refreshView()):app.showNotice(langMgr.getString("legionWarCampsitePage",0))})},onClose:function(){this._super(),app.legionIsChange=!1,app.legionPvpChangeIndex=-1},setParam:function(e){cc.log(e),this.m_objData=e,this.refreshUI()},refreshUI:function(){this.p_labTitle.string=langMgr.getString("legionWarCampsitePage",1,gConfig.getLegionCampName(this.m_objData.type));var e=this.m_objData.list?this.m_objData.list.length:0;this.p_labMember.string=e+"/20",this.p_memberView.getComponent("tableView").initTableView(e,{array:this.m_objData.list,type:this.m_objData.type,target:this}),this.p_btnChangeList.node.active=2==app.legionInfo.pos&&1==app.legionPvpInfo.lockteam&&2==app.pages.legionwarpage.getLegionPvpState().state},refreshView:function(){var e=this.m_objData.list?this.m_objData.list.length:0;this.p_memberView.getComponent("tableView").initTableView(e,{array:this.m_objData.list,type:this.m_objData.type,target:this})}});cc._RF.pop()},{basePage:void 0}],legionWarDemonstrationPage:[function(e,t){"use strict";cc._RF.push(t,"45d01vxVxVMW7ohJz4TK/7X","legionWarDemonstrationPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"legionwardemonstrationpage",pageType:1},properties:{p_btnSure:cc.Button,p_edxName:cc.EditBox},onLoad:function(){a.instance=this,this.creatMask(!0),this.fitTopMenu(),this.stopBgNodeEvent(),this.handleUI()},onEnable:function(){this._super()},onDisable:function(){this._super()},handleUI:function(){var e=this;this._super(),this.p_btnSure.node.on("click",function(){if(e.p_edxName.string.length<=0)app.showNotice(langMgr.getString("legionWarDemonstrationPage",0));else if(app.checkMatchStr(e.p_edxName.string)){var t={};t.demonstrate=e.p_edxName.string,app.player.sfLegionSet(t,function(){app.showNotice(langMgr.getString("legionWarDemonstrationPage",2)),app.legionInfo.demonstrate=t.demonstrate,e.onClose()})}else app.showNotice(langMgr.getString("legionWarDemonstrationPage",1))})},onClose:function(){this._super()},setParam:function(){this.p_edxName.string=app.legionInfo.demonstrate}});cc._RF.pop()},{basePage:void 0}],legionWarJoinPage:[function(e,t){"use strict";cc._RF.push(t,"01fb4ABPQ9PvpoGJ6iFA8e9","legionWarJoinPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"legionwarjoinpage",pageType:1},properties:{p_sprTitle:cc.Sprite,p_spriteFrames:[cc.SpriteFrame],p_bsetNodes:[cc.Node],p_btnUpdateName:[cc.Button],p_btnJoinCamp:[cc.Button],p_btnBset:[cc.Button]},onLoad:function(){a.instance=this,this.creatMask(!0),this.fitTopMenu(),this.stopBgNodeEvent(),this.handleUI()},onEnable:function(){this._super(),eventMgr.on(eventStr.legionWarEvent.RefreshJoinPageUI,this.refreshUI,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.legionWarEvent.RefreshJoinPageUI,this.refreshUI,this)},handleUI:function(){var e=this;this._super(),this.p_btnUpdateName.forEach(function(t,a){app.playSound("click"),t.node.on("click",function(){app.db.checkBattleArrTeam(gConfig.LEGIONPVPLINEUP[a])&&app.db.checkGeneralExist(gConfig.LEGIONPVPLINEUP[a])&&app.pages.lineupnamepage.showPage({index:a+1,name:"legionpvp"+(a+1),type:"legionpvp",funCb:function(){e.refreshUI()}})})}),this.p_btnJoinCamp.forEach(function(t,a){app.playSound("click"),t.node.on("click",function(){if(!app.db.checkBattleArrTeam(gConfig.LEGIONPVPLINEUP[a])||!app.db.checkGeneralExist(gConfig.LEGIONPVPLINEUP[a]))return app.LpvpIndex=a,app.battleType="legionpvpsave",void app.goToNormBattle();if(app.pages.legionwarpage.checkCanJoinCamps(e.m_index,a).status){var t=gUtils.deepClone(app.player.battlearr[gConfig.LEGIONPVPLINEUP[a]]);t.camp=gConfig.legionPvpCamps[e.m_index];var i={battleset:t};app.player.sfLegionPvpSaveBattleset(i,a+1,function(i){i?"no legion cant set camp"==i?app.showNotice(langMgr.getString("legionWarJoinPage",0)):"camp full"==i?app.showNotice(langMgr.getString("legionWarJoinPage",1)):app.showNotice(i):(app.player.battlearr[gConfig.LEGIONPVPLINEUP[a]]=t,app.showNotice(langMgr.getString("legionWarJoinPage",2)),e.refreshUI(),app.pages.legionwarpage.refreshWarInfo(function(){eventMgr.emit(eventStr.legionWarEvent.RefreshMainUI),app.pages.legionwarcampsitepage.instance.setParam({type:e.m_index,list:app.legionPvpInfo.camps[gConfig.legionPvpCamps[e.m_index]]})}))})}else app.showNotice(app.pages.legionwarpage.checkCanJoinCamps(e.m_index,a).string)})}),this.p_btnBset.forEach(function(e,t){e.node.on("click",function(){if(!app.db.checkBattleArrTeam(gConfig.LEGIONPVPLINEUP[t])||!app.db.checkGeneralExist(gConfig.LEGIONPVPLINEUP[t]))return app.playSound("click"),app.LpvpIndex=t,app.battleType="legionpvpsave",void app.goToNormBattle()})})},onClose:function(){this._super()},setParam:function(e){this.m_index=e,this.refreshUI()},refreshUI:function(){var e=this;this.p_bsetNodes.forEach(function(t,a){var i={};if(app.db.checkBattleArrTeam(gConfig.LEGIONPVPLINEUP[a])&&app.db.checkGeneralExist(gConfig.LEGIONPVPLINEUP[a])){var n=gUtils.deepClone(app.player.battlearr[gConfig.LEGIONPVPLINEUP[a]]);for(var r in n.team)n.team[r]=app.player.general[n.team[r]];i.bset=n}for(var o=-1,s=0;s<gConfig.legionPvpCamps.length;s++)if(app.pages.legionwarpage.checkCampsBset(s,a)){i.des="\u6240\u5c5e"+gConfig.getLegionCampName(s),o=s;break}i.bset?o>=0?o==e.m_index?e.setBtnStatus(a,2):e.setBtnStatus(a,1):e.setBtnStatus(a,0):e.setBtnStatus(a,3),t.getComponent("legionWarGeneralItem").refreshUI(i,a,e),t.getComponent("legionWarGeneralItem").setClick(!1)}),this.p_sprTitle.spriteFrame=this.p_spriteFrames[this.m_index]},setBtnStatus:function(e,t){this.p_btnJoinCamp[e].node.getChildByName("icon_join").active=0==t||2==t,this.p_btnJoinCamp[e].node.getChildByName("icon_change").active=1==t,this.p_btnJoinCamp[e].node.getChildByName("icon_battlearr").active=3==t;var a=2==t;this.p_btnJoinCamp[e].node.getComponent(cc.Button).interactable=!a,app.setSpriteState(this.p_btnJoinCamp[e].node.getChildByName("icon_join").getComponent(cc.Sprite),a),app.setSpriteState(this.p_btnJoinCamp[e].node.getChildByName("icon_change").getComponent(cc.Sprite),a),app.setSpriteState(this.p_btnJoinCamp[e].node.getComponent(cc.Sprite),a)}});cc._RF.pop()},{basePage:void 0}],legionWarMobPage:[function(e,t){"use strict";cc._RF.push(t,"3d4a531bZ9NoaI1O2n1pksu","legionWarMobPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"legionwarmobpage",pageType:1},properties:{p_animBoss:cc.Animation,p_spBoss:sp.Skeleton,p_sprBoss:cc.Sprite,p_labName:cc.Label,p_proHp:cc.ProgressBar,p_labPro:cc.Label,p_nodeReward:cc.Node,p_pfbItem:cc.Prefab,p_labBuff:cc.Label,p_btnChallenge:cc.Button,p_btnMop:cc.Button},onLoad:function(){a.instance=this,this.creatMask(!0),this.fitTopMenu(),this.stopBgNodeEvent(),this.handleUI()},handleUI:function(){var e=this;this._super(),this.p_btnChallenge.node.on("click",function(){e.goBattle()}),this.p_btnMop.node.on("click",function(){e.doMop()})},onEnable:function(){this._super(),eventMgr.on(eventStr.legionWarEvent.RefreshWmob,this.refreshWild,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.legionWarEvent.RefreshWmob,this.refreshWild,this)},onClose:function(){this._super()},setParam:function(e){this.refreshWild(e)},refreshWild:function(e){if(e){this._boss=e;var t=e.nowhp/e.maxhp;this.p_proHp.progress=t,this.p_labPro.string=t<=0?langMgr.getString("legionWarMobPage",3):gUtils.showNum(e.nowhp)+"/"+gUtils.showNum(e.maxhp),this.p_btnMop.node.active=!!this._boss.lastdamage;var a=app.pages.legionwarpage.getConfigByPos(this._boss.pos);if(a){this.p_labName.string=a.NAME,app.loadGeneral(a.ICON,this.p_sprBoss,this.p_spBoss,this.p_animBoss,null,this.prefabPath),this.m_arrItems||(this.m_arrItems=[]);for(var i=0;i<a.KREWARD.length;++i){var n=this.m_arrItems[i];n||((n=cc.instantiate(this.p_pfbItem)).parent=this.p_nodeReward,n.setPosition(0,0),n.scale=.9,this.m_arrItems.push(n)),n.active=!0,n.getComponent("propItem").initForBag(a.KREWARD[i]),n.getComponent("propItem").setClick(!0)}for(var r=a.KREWARD.length;r<this.m_arrItems.length;++r)this.m_arrItems[r].active=!1}for(var o=this._boss.buffs,s="",p=0;p<o.length;++p){var c=o[p];"hp"==c.KEY?s+=app.db.getPropertyCnByEn("php")+"+"+c.VAL+"%":"_streak_buff"==c.KEY?s+=langMgr.getString("legionWarMobPage",4,c.VAL):s+=app.db.getPropertyCnByEn(c.KEY)+"+"+c.VAL+"%"}this.p_labBuff.string=s}},goBattle:function(){this.isCanChallenge()&&(app.battleParam={},app.battleParam.pos=this._boss.pos,app.goToBossBattle("legionwarm",this._boss))},doMop:function(){var e=this;if(this.isCanChallenge()){var t=Math.ceil(this._boss.nowhp/this._boss.lastdamage),a={gsid:30024,maxcount:Math.min(t,app.player.getCount(30024)),type:"nums",tips:langMgr.getString("legionWarMobPage",5),coin:30024,confirmcb:function(t){app.player.sfLegionPvpMobFarm({pos:e._boss.pos,times:t},function(a,i){var n={showtype:1,reward:i.items};app.player.addItem(i.items),app.player.reduceItem({GSID:30024,COUNT:t}),app.pages.windowspagereward.showPage(n),app.player.sfGetLegionPvpMobInfo({pos:e._boss.pos},function(){})})},target:this};app.pages.windowspagesetnum.showPage(a)}},isCanChallenge:function(){return app.player.getCount(30024)<=0?(app.showNotice(langMgr.getString("legionWarMobPage",0)),!1):!(this._boss.nowhp<=0&&(app.showNotice(langMgr.getString("legionWarMobPage",1)),1))}});a.showPage=function(t){var a=this;app.player.sfGetLegionPvpMobInfo({pos:t},function(t,i){t?app.showNotice(langMgr.getString("legionWarMobPage",2)):e("basePage").showPage.call(a,i)})},cc._RF.pop()},{basePage:void 0}],legionWarPage:[function(e,t){"use strict";function a(){return(a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e}).apply(this,arguments)}cc._RF.push(t,"f85daaBclpKqq40cZrSsEls","legionWarPage");var i=cc.Class({extends:e("basePage"),statics:{prefabPath:"legionwarpage"},properties:{p_btnShop:cc.Button,p_btnRecord:cc.Button,p_btnDemonstration:cc.Button,p_btnHelp:cc.Button,p_tipNode:cc.Node,p_leftInfo:cc.Node,p_rightInfo:cc.Node,p_lunkong:cc.Node,p_labTime:cc.Label,p_labTip:cc.Label,p_mapNode:cc.Node,p_wildNodes:[cc.Node],p_bossNode:cc.Node,p_labBossStep:cc.Label,p_sprBoss:cc.Sprite,p_sprFrameBoss:[cc.SpriteFrame],p_bsetNodes:[cc.Node],p_campNodes:[cc.Node],p_enemyCampNodes:[cc.Node],p_buffNode:cc.Node,p_buffItemNode:cc.Node,p_labDemonstrate:cc.Label,p_showTipNode:cc.Node,p_btnTipNode:cc.Button,p_spYunAnimation:sp.Skeleton,p_btnReward:cc.Button,p_btnAuction:cc.Button,p_btnLegionAuction:cc.Button},onLoad:function(){i.instance=this,this.creatMask(!0),this.fitTopMenu(),this.stopBgNodeEvent(),this.handleUI(),this.m_isMove=!1,this.m_joinBsetIndex=0,this.m_isJoinCamp=!1,this.isGetStart=!1,this.m_arrBuffs=[],this.m_arrBuffs.push(this.p_buffItemNode),this.m_buff={atk:langMgr.getString("legionWarPage",2),def:langMgr.getString("legionWarPage",3),hp:langMgr.getString("legionWarPage",4),pcri:langMgr.getString("legionWarPage",5),pcrid:langMgr.getString("legionWarPage",6),pasp:langMgr.getString("legionWarPage",7),prdc:langMgr.getString("legionWarPage",8),pdam:langMgr.getString("legionWarPage",9),dex:langMgr.getString("legionWarPage",10),pdex:langMgr.getString("legionWarPage",11),ppthr:langMgr.getString("legionWarPage",12),pmthr:langMgr.getString("legionWarPage",13),_streak_buff:langMgr.getString("legionWarPage",14)}},onEnable:function(){this._super(),eventMgr.on(eventStr.commonEvent.RefreshTime,this.refreshTime,this),eventMgr.on(eventStr.legionWarEvent.EnterCamps,this.joinCamps,this),eventMgr.on(eventStr.legionWarEvent.RefreshMainUI,this.refreshMainUI,this),eventMgr.on(eventStr.legionWarEvent.RefreshWboss,this.refreshBoss,this),eventMgr.on(eventStr.legionWarEvent.RefreshWmob,this.refreshWilds,this),eventMgr.on(eventStr.auctionEvent.RefreshLegionRewardBtn,this.refreshRewardBtn,this),eventMgr.on(eventStr.commonEvent.RefreshTime,this.legionAuctionBtnState,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.commonEvent.RefreshTime,this.refreshTime,this),eventMgr.off(eventStr.legionWarEvent.EnterCamps,this.joinCamps,this),eventMgr.off(eventStr.legionWarEvent.RefreshMainUI,this.refreshMainUI,this),eventMgr.off(eventStr.legionWarEvent.RefreshWboss,this.refreshBoss,this),eventMgr.off(eventStr.legionWarEvent.RefreshWmob,this.refreshWilds,this),eventMgr.off(eventStr.auctionEvent.RefreshLegionRewardBtn,this.refreshRewardBtn,this),eventMgr.off(eventStr.commonEvent.RefreshTime,this.legionAuctionBtnState,this)},handleUI:function(){var e=this;this._super(),this.p_mapNode.on("touchmove",function(t){e.moveMapByTouch(t)}),this.p_mapNode.on("touchend",function(t){e.m_isMove=!1,e.moveMapByTouch(t)}),this.p_btnHelp.node.on("click",function(){app.pages.windowspagetipshelp.showPage("1080")}),this.p_btnRecord.node.on("click",function(){app.playSound("click"),eventMgr.emit(eventStr.legionWarEvent.EnterCamps,-1),app.pages.legionwarrecordpage.showPage()}),this.p_btnDemonstration.node.on("click",function(){app.playSound("click"),eventMgr.emit(eventStr.legionWarEvent.EnterCamps,-1),app.pages.legionwardemonstrationpage.showPage()}),this.p_bossNode.on("touchend",function(){e.m_isMove||(eventMgr.emit(eventStr.legionWarEvent.EnterCamps,-1),e._bossData?app.pages.legionwarbosspage.showPage(e._bossData):app.showNotice(langMgr.getString("legionWarPage",0)))}),this.p_wildNodes.forEach(function(t,a){t.getChildByName("touch").on("touchend",function(){if(!e.m_isMove){eventMgr.emit(eventStr.legionWarEvent.EnterCamps,-1);var t=app.legionPvpInfo.boss[a].pos;app.pages.legionwarmobpage.showPage(t)}})}),this.p_btnTipNode.node.on("click",function(){app.playSound("click"),e.p_showTipNode.active=!1}),this.p_btnReward.node.on("click",function(){app.playSound("click"),app.pages.windowsPageLegionWarRewardDisplay.showPage()},this),this.p_btnAuction.node.on("click",function(){app.playSound("click"),app.player.sfAuctionList(0).then(function(t){var i=a({},t);if(i.auctions.length<=0)return app.showNotice(langMgr.getString("legionWarPage",1)),void e.refreshRewardBtn();app.pages.windowsPageWarRewardList.showPage({auctionList:i.auctions,type:0})}).catch(function(e){cc.warn("auction error: ",JSON.stringify(e))})},this),this.p_btnLegionAuction.node.on("click",function(){app.playSound("click"),app.player.sfAuctionList(0).then(function(e){var t=a({},e);t.type=0,app.pages.windowsPageAuction.showPage(t)}).catch(function(e){cc.warn("auction error: ",JSON.stringify(e))})},this)},moveMapByTouch:function(e){if(e.getLocation&&!(Math.abs(e.getLocation().y-e.getStartLocation().y)<=6)){this.m_isMove=!0;var t=this.p_mapNode.x,a=this.p_mapNode.y,i=e.getDelta();this.setNodeMove(t,a,i.x,i.y)}},setNodeMove:function(e,t,a,i){var n=this.p_mapNode.width/2-cc.winSize.width/2,r=-this.p_mapNode.width/2+cc.winSize.width/2,o=this.p_mapNode.height/2-cc.winSize.height/2,s=-this.p_mapNode.height/2+cc.winSize.height/2;e+=a,t+=i,e=Math.min(n,e),e=Math.max(r,e),t=Math.min(o,t),t=Math.max(s,t),this.p_mapNode.x=e,this.p_mapNode.y=t},setParam:function(){this.refreshRewardBtn(),3==app.pages.legionwarpage.getLegionPvpState().state?app.pages.summitpvppreflagpage.showPage({target:this,time:app.legionPvpInfo.startpvptime}):-1==app.pages.legionwarpage.getLegionPvpState().state&&(this.clearCampBattleArr(),app.legionPvpInfo.report&&new Date(app.legionPvpInfo.startpvptime).toDateString()===(new Date).toDateString()&&(app.player.sfPlayerByParam(["battlearr","legion"],function(){app.player.sfGetLegionInfo(function(e,t){e||(app.legionInfo=t,eventMgr.emit(eventStr.legionWarEvent.RefreshMainUI))})}),app.pages.legionwarresultpage.showPage({data:app.legionPvpInfo,isFirst:!0}))),this.initMapPos(),this.createMap(),this.refreshUI(),this.showError()},initMapPos:function(){var e=-this.p_mapNode.width/2+cc.winSize.width/2,t=-this.p_mapNode.height/2+cc.winSize.height/2;this.p_mapNode.x=e,this.p_mapNode.y=t},createMap:function(){this.setWilds(),this.setBoss(),this.setCamps(),this.setEnemyCamps(),this.setDemonstrate()},showError:function(){this.p_showTipNode.active=2==app.legionPvpErrState},setWilds:function(){this.p_wildNodes.forEach(function(e,t){if(app.legionPvpInfo&&app.legionPvpInfo.boss&&app.legionPvpInfo.boss[t]&&1==app.pages.legionwarpage.getLegionPvpState().state){e.active=!0;var a=app.legionPvpInfo.boss[t],i=app.pages.legionwarpage.getConfigByPos(a.pos);app.loadBattleGeneral(i.ICON,e,"f_stand",app.pages.legionwarpage.prefabPath);var n=a.totalHp-a.totaldamage,r=n<=0?0:n/a.totalHp;e.getChildByName("bar").getComponent(cc.Sprite).fillRange=r,e.getChildByName("bar").active=r>0,e.getChildByName("bar_bg").active=r>0,e.getChildByName("die").active=r<=0}else e.active=!1})},refreshWilds:function(e){var t=this;this.p_wildNodes.forEach(function(a,i){if(app.legionPvpInfo&&app.legionPvpInfo.boss&&app.legionPvpInfo.boss[i]&&1==app.pages.legionwarpage.getLegionPvpState().state){if(a.active=!0,app.legionPvpInfo.boss[i].pos==e.pos){var n=e.nowhp<=0?0:e.nowhp/e.maxhp;n<=0&&t.refreshMainUI(!0),a.getChildByName("bar").getComponent(cc.Sprite).fillRange=n}}else a.active=!1})},setBoss:function(){this.p_sprBoss.spriteFrame=this.p_sprFrameBoss[app.seasonData.info.season-1],app.player.sfGetLegionPvpMobBossInfo({pos:0},function(e,t){e?app.showNotice(e):eventMgr.emit(eventStr.legionWarEvent.RefreshWboss,t)})},refreshBoss:function(e){1==app.pages.legionwarpage.getLegionPvpState().state?(this._bossData=e,this.p_labBossStep.string=langMgr.getString("legionWarPage",15,["\u96f6","\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d","\u4e03","\u516b","\u4e5d","\u5341"][this._bossData.step])):this.p_bossNode.active=!1},setCamps:function(){var e=this;this.p_campNodes.forEach(function(t,a){if(app.legionPvpInfo&&app.legionPvpInfo.camps){var i=app.legionPvpInfo.camps[gConfig.legionPvpCamps[a]];t.getComponent("legionWarCampItem").refreshUI(i,a,e)}else t.getComponent("legionWarCampItem").refreshUI(null,a,e),t.getComponent("legionWarCampItem").setClick(!1);t.getComponent("legionWarCampItem").setArrow(),t.getComponent("legionWarCampItem").setJoin();var n=0;if(app.legionPvpInfo&&app.legionPvpInfo.report){var r=app.legionPvpInfo.report,o=r[gConfig.legionPvpCamps[a]].winner;r._legion_.left==app.legionInfo.servid+"_"+app.legionInfo.id&&"left"==o||r._legion_.left!=app.legionInfo.servid+"_"+app.legionInfo.id&&"right"==o?n=1:o&&(n=-1)}t.getComponent("legionWarCampItem").setStatus(n)})},setEnemyCamps:function(){var e=this;this.p_enemyCampNodes.forEach(function(t,a){var i=null;app.legionPvpInfo&&app.legionPvpInfo.opponent&&app.legionPvpInfo.opponent.camps&&(i=app.legionPvpInfo.opponent.camps[gConfig.legionPvpCamps[a]]),t.getComponent("legionWarCampItem").refreshUI(i,a,e),t.getComponent("legionWarCampItem").setClick(!1),t.getComponent("legionWarCampItem").setArrow(),t.getComponent("legionWarCampItem").setJoin();var n=0;if(app.legionPvpInfo&&app.legionPvpInfo.report){var r=app.legionPvpInfo.report,o=r[gConfig.legionPvpCamps[a]].winner;r._legion_.left==app.legionInfo.servid+"_"+app.legionInfo.id&&"left"==o||r._legion_.left!=app.legionInfo.servid+"_"+app.legionInfo.id&&"right"==o?n=-1:o&&(n=1)}t.getComponent("legionWarCampItem").setStatus(n)})},joinCamps:function(e){var t=this;if(e<0)this.endCamps();else{this.m_joinBsetIndex=e;var a=!1;this.p_campNodes.forEach(function(e,i){app.pages.legionwarpage.checkCanJoinCamps(i,t.m_joinBsetIndex).status&&(e.getComponent("legionWarCampItem").setArrow(!0),e.getComponent("legionWarCampItem").setJoin(!0,t.m_joinBsetIndex),a=!0)}),this.m_isJoinCamp=!!a}},endCamps:function(){this.m_isJoinCamp=!1,this.p_campNodes.forEach(function(e){e.getComponent("legionWarCampItem").setArrow(),e.getComponent("legionWarCampItem").setJoin()})},setDemonstrate:function(){if(app.legionPvpInfo&&app.legionPvpInfo.opponent&&app.legionPvpInfo.opponent&&app.legionPvpInfo.opponent.demonstrate){if(this.p_labDemonstrate.node.parent.active=!0,this.p_labDemonstrate.string=app.legionPvpInfo.opponent.demonstrate,this.runingAction)return;this.runingAction=!0,this.p_labDemonstrate.node.parent.runAction(cc.repeatForever(cc.sequence(cc.scaleTo(.3,1),cc.delayTime(3),cc.scaleTo(.2,0),cc.delayTime(10))))}else this.runingAction=!1,this.p_labDemonstrate.node.parent.active=!1,this.p_labDemonstrate.node.parent.stopAllActions()},refreshRewardBtn:function(){this.p_btnAuction.node.active=app.legionPvpInfo&&app.legionPvpInfo.report&&cc.isValid(app.mainScene)&&app.mainScene.getAuctionVisible(0)&&app.db.checkChannelShow("LEGION_AUCTION")},refreshMainUI:function(e){var t=this;void 0===e&&(e=!1),e?app.pages.legionwarpage.refreshWarInfo(function(){t.createMap(),t.refreshUI()}):(this.createMap(),this.refreshUI())},refreshUI:function(){var e=this,t=!1,a={},i={};if(app.legionPvpInfo&&app.legionPvpInfo.report){var n=app.legionPvpInfo.report;n._legion_.left==app.legionInfo.servid+"_"+app.legionInfo.id?(a.totalscore=n.score.left,i.totalscore=n.score.right,"left"==n.winner?(a.ret=1,i.ret=0):"right"==n.winner?(a.ret=0,i.ret=1):(a.ret=-1,i.ret=-1)):(a.totalscore=n.score.right,i.totalscore=n.score.left,"left"==n.winner?(a.ret=0,i.ret=1):"right"==n.winner?(a.ret=1,i.ret=0):(a.ret=-1,i.ret=-1))}if(a.name=app.legionInfo.name,a.flag=app.legionInfo.flag,a.score=app.legionInfo.pvpscore,a.legion=app.legionInfo.servid+"_"+app.legionInfo.id,a.servid=gUtils.getServNameForShow(app.legionInfo.servid),this.p_lunkong.active=!1,app.legionPvpInfo&&app.legionPvpInfo.opponent){i.name=app.legionPvpInfo.opponent.name,i.flag=app.legionPvpInfo.opponent.flag,i.score=app.legionPvpInfo.opponent.pvpscore,i.legion=app.legionPvpInfo.opponent.legion;var r=app.legionPvpInfo.opponent.legion.split("_")[0];i.servid=gUtils.getServNameForShow(Number(r)),this.p_rightInfo.getComponent("legionWarInfoItem").refreshUI(i)}else this.p_rightInfo.active=!1,this.p_lunkong.active=0==app.legionPvpErrState;this.p_leftInfo.getComponent("legionWarInfoItem").refreshUI(a),this.p_leftInfo.getComponent("legionWarInfoItem").setClick(!1),this.p_bsetNodes.forEach(function(a,i){var n={};if(app.db.checkBattleArrTeam(gConfig.LEGIONPVPLINEUP[i])&&app.db.checkGeneralExist(gConfig.LEGIONPVPLINEUP[i])){var r=gUtils.deepClone(app.player.battlearr[gConfig.LEGIONPVPLINEUP[i]]);for(var o in r.team)r.team[o]=app.player.general[r.team[o]];n.bset=r}for(var s=0;s<gConfig.legionPvpCamps.length;s++)if(app.pages.legionwarpage.checkCampsBset(s,i)){n.des=langMgr.getString("legionWarPage",25,gConfig.getLegionCampName(s));break}t||(t=!!n.des),a.getComponent("legionWarGeneralItem").refreshUI(n,i,e),a.getComponent("legionWarGeneralItem").setClick(!0)});var o=0;if(app.legionPvpInfo&&app.legionPvpInfo.ownerbuff)for(var s=function(){var t=e.m_arrBuffs[o];t||((t=cc.instantiate(e.p_buffItemNode)).parent=e.p_buffNode,e.m_arrBuffs.push(t)),t.active=!0,t.getComponentInChildren(cc.Label).string=e.m_buff[app.legionPvpInfo.ownerbuff[o].KEY],t.getChildByName("talk").active=!1,t.targetOff(),t.on("touchend",function(){t.getChildByName("talk").active=!0,t.getChildByName("talk").getComponent(cc.Sprite).scheduleOnce(function(){t.getChildByName("talk").active=!1},2)}),app.loadTexture(gConfig.rootPath.uilegionicon+app.legionPvpInfo.ownerbuff[o].KEY,t.getComponent(cc.Sprite))};o<app.legionPvpInfo.ownerbuff.length;o++)s();for(var p=0;p<this.m_arrBuffs.length;p++)p>=o&&(this.m_arrBuffs[p].active=!1);this.p_btnDemonstration.node.active=2==app.legionInfo.pos,this.p_tipNode.active=!t,this.p_spYunAnimation.node.active=1==app.pages.legionwarpage.getLegionPvpState().state||2==app.pages.legionwarpage.getLegionPvpState().state||3==app.pages.legionwarpage.getLegionPvpState().state||2==app.legionPvpErrState},refreshTime:function(){var e=this;if(app.pages.legionwarpage.isOpen()){var t;if(2==app.legionPvpErrState)return this.p_labTip.node.active=!1,void(this.p_labTime.node.active=!1);switch((t=1==app.legionPvpErrState?{state:-1,locktime:0,time:0}:app.pages.legionwarpage.getLegionPvpState()).state){case-1:if(this.p_labTip.string=langMgr.getString("legionWarPage",16),app.legionPvpStartNextTime){var a=app.player.getServerTime(),i=app.legionPvpStartNextTime-a;i<0?(app.legionPvpStartNextTime=0,this.p_labTip.string="00:00:00"):this.p_labTime.string=gUtils.getCountDownStr(i)}else this.isGetStart||(this.isGetStart=!0,app.player.sfGetLegionPvpTime(function(t,a){t?cc.log(t):(app.legionPvpStartNextTime=a.next,e.isGetStart=!1)}));break;case 1:this.p_labTip.string=langMgr.getString("legionWarPage",17),this.p_labTime.string=gUtils.getCountDownStr(t.locktime);break;case 2:this.p_labTip.string=langMgr.getString("legionWarPage",18),this.p_labTime.string=gUtils.getCountDownStr(t.time);break;case 3:this.p_labTip.string=langMgr.getString("legionWarPage",19),this.p_labTime.string="00:00:00"}}},clearCampBattleArr:function(){for(var e=0;e<gConfig.LEGIONPVPLINEUP.length;e++)app.player.battlearr[gConfig.LEGIONPVPLINEUP[e]]&&app.player.battlearr[gConfig.LEGIONPVPLINEUP[e]].camp&&(app.player.battlearr[gConfig.LEGIONPVPLINEUP[e]]={team:app.player.battlearr[gConfig.LEGIONPVPLINEUP[e]].team,tname:app.player.battlearr[gConfig.LEGIONPVPLINEUP[e]].tname})},onClose:function(){this._super(),eventMgr.emit(eventStr.legionWarEvent.EnterCamps,-1),eventMgr.emit(eventStr.redEvent.RefreshLegionHomePageRed)},legionAuctionBtnState:function(){if(cc.isValid(this.p_btnLegionAuction)&&app.redDataServer.auction){var e=app.redDataServer.auction.legion_time.start,t=app.redDataServer.auction.legion_time.etime,a=app.player.getServerTime(),i="",n=!0;switch(!0){case a<e:i=""+gUtils.getCountDownStr(e-a);break;case a<=t:i=""+gUtils.getCountDownStr(t-a);break;case a>t+18e5:case 0===e:n=!1}var r=this.p_btnLegionAuction.node.getChildByName("CountDown"),o=this.p_btnLegionAuction.node.getChildByName("TxtBg");n?(cc.isValid(r)&&(r.getComponent(cc.Label).string=i),cc.isValid(o)&&(o.opacity=""===i?0:255)):(cc.isValid(r)&&(r.getComponent(cc.Label).string=""),cc.isValid(o)&&(o.opacity=0))}}});i.getConfigByPos=function(e){if(!app.legionPvpInfo||!app.legionPvpInfo.boss)return null;for(var t=0;t<app.legionPvpInfo.boss.length;t++){var a=app.legionPvpInfo.boss[t];if(a.pos==e)return app.db.dbLegionWarMob[a.mobid]}},i.showPage=function(t,a,n){var r=this;1!=app.db.getChannelControlInfo().LEGION_WAR&&(i.isOpen()?(app.legionPvpStartNextTime||app.player.sfGetLegionPvpTime(function(e,t){app.legionPvpStartNextTime=t.next}),app.pages.legionwarpage.refreshWarInfo(function(){e("basePage").showPage.call(r,t,a,n)})):n&&n())},i.isOpen=function(){return!0},i.getLegionPvpState=function(){var e=app.player.getServerTime(),t={time:0,locktime:0,state:0};if(i.isOpen()){if(new Date(e),!app.legionPvpInfo)return t;t.time=app.legionPvpInfo.startpvptime-e,t.locktime=app.legionPvpInfo.locktime-e,t.time<0?(t.time=0,t.locktime=0,t.state=3):app.legionPvpInfo.lockteam&&t.time>0?(t.state=2,t.locktime=0):t.time>0&&!app.legionPvpInfo.lockteam&&(t.state=1),app.legionPvpInfo.report&&(t.time=0,t.locktime=0,t.state=-1)}else t.state=-1;return t},i.checkCampsBset=function(e,t){if(!app.db.checkBattleArrTeam(gConfig.LEGIONPVPLINEUP[t])||!app.db.checkGeneralExist(gConfig.LEGIONPVPLINEUP[t]))return!1;var a=app.player.battlearr[gConfig.LEGIONPVPLINEUP[t]];return!(!a.camp||a.camp!=gConfig.legionPvpCamps[e])},i.checkCanJoinCamps=function(e,t){var a={status:!0,string:langMgr.getString("legionWarPage",24)};return 2==app.legionPvpErrState&&(a.status=!1,a.string=langMgr.getString("legionWarPage",20)),i.checkCampsBset(e,t)&&(a.status=!1,a.string=langMgr.getString("legionWarPage",21)),(!app.legionPvpInfo||app.legionPvpInfo.camps[gConfig.legionPvpCamps[e]].length>=20)&&(a.status=!1,a.string=langMgr.getString("legionWarPage",22)),1!=i.getLegionPvpState().state&&(a.status=!1,a.string=langMgr.getString("legionWarPage",23)),a},i.changeCampIndex=function(e,t,a){var i=app.legionPvpInfo.camps[gConfig.legionPvpCamps[e]][t];app.legionPvpInfo.camps[gConfig.legionPvpCamps[e]][t]=app.legionPvpInfo.camps[gConfig.legionPvpCamps[e]][a],app.legionPvpInfo.camps[gConfig.legionPvpCamps[e]][a]=i},i.refreshWarInfo=function(e){app.player.sfGetLegionPvpInfo({pvpDate:""},function(t,a){if("not start"==t)app.legionPvpErrState=1;else if("no register legion"==t||"not register"==t)app.legionPvpErrState=2;else{if(t)return void app.showNotice(langMgr.getString("legionWarJoinPage",0));app.legionPvpErrState=0}app.legionPvpInfo=a,e&&e()})},cc._RF.pop()},{basePage:void 0}],legionWarPlayerinfoPage:[function(e,t){"use strict";cc._RF.push(t,"6d5c8Vy3MtD/7QHjcbWOEwq","legionWarPlayerinfoPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"legionwarplayerinfopage",pageType:1},properties:{p_legionInfoNode:cc.Node,p_memberView:cc.Node},onLoad:function(){a.instance=this,this.creatMask(!0),this.fitTopMenu(),this.stopBgNodeEvent(),this.handleUI()},onEnable:function(){this._super()},onDisable:function(){this._super()},handleUI:function(){this._super()},onClose:function(){this._super()},setParam:function(e){this.m_data=e,this.refreshUI()},refreshUI:function(){var e=app.legionPvpInfo.opponent.legion.split("_")[0];e=gUtils.getServNameForShow(Number(e)),this.p_legionInfoNode.getComponent("legionWarInfoItem").refreshUI({name:langMgr.getString("legionWarPlayerinfoPage",0,this.m_data.name),flag:this.m_data.flag,level:this.m_data.level,servid:e,score:app.legionPvpInfo.opponent.pvpscore,legion:app.legionPvpInfo.opponent.legion,power:app.legionPvpInfo.opponent.power,prople:this.m_data.members&&this.m_data.members.length||0}),this.p_legionInfoNode.getComponent("legionWarInfoItem").setClick(!1),this.p_memberView.getComponent("tableView").initTableView(this.m_data.members.length,{array:this.m_data.members,target:this})}});cc._RF.pop()},{basePage:void 0}],legionWarRecordPage:[function(e,t){"use strict";cc._RF.push(t,"b44d8zI40NHE4aDLJ/iVLvU","legionWarRecordPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"legionwarrecordpage",pageType:1},properties:{p_nodetab:cc.Node,p_pfbItem:cc.Prefab},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.m_arrItem=[]},setParam:function(){var e=this,t=new Date,a=t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate();app.player.sfLegionPvpRecord({startPvpDate:a,limit:20},function(t,a){t?app.showNotice(t):(e._video=a,e.refreshUI())})},refreshUI:function(){var e=this._video.history.length;this.p_nodetab.getComponent("tableView").initTableView(e,{array:this._video.history,target:this})}});cc._RF.pop()},{basePage:void 0}],legionWarResultPage:[function(e,t){"use strict";function a(){return(a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e}).apply(this,arguments)}cc._RF.push(t,"8a908NNcM9JdYESNmNUlpBn","legionWarResultPage");var i=e("../utils/events/eventMgr"),n=cc.Class({name:"legionWarResultItem",properties:{p_sprFlag:cc.Node,p_labLegionName:cc.Label,p_labScore:cc.Label,p_labAddScore:cc.Label},refreshUI:function(e){if(!e)return this.initEmpty();e.score;var t=e.addScore,a=e.rawScore,i=e.legionName,n=e.legionFlag;if(this.p_labLegionName.string=i,this.p_labScore.string=langMgr.getString("legionWarResultPage",0,a),this.p_labAddScore.string=t>=0?"(+"+t+")":"("+t+")",this.p_labAddScore.node.color=t>=0?cc.Color.WHITE.fromHEX("#76DA27"):cc.Color.WHITE.fromHEX("#FF5C1D"),this.p_labAddScore.node.getComponent(cc.LabelOutline).color=t>=0?cc.Color.WHITE.fromHEX("#0A5004"):cc.Color.WHITE.fromHEX("#631414"),this.p_sprFlag&&void 0!==n){var r=app.db.getLegionIconInfo(n);app.loadTexture(gConfig.rootPath.uilegionicon+r.PATH,this.p_sprFlag.getComponent(cc.Sprite))}},initEmpty:function(){this.p_sprFlag&&(this.p_sprFlag.active=!1),this.p_labScore&&(this.p_labScore.node.active=!1),this.p_labLegionName&&(this.p_labLegionName.node.active=!1),this.p_labAddScore&&(this.p_labAddScore.node.active=!1)}}),r=["top","mid","down"],o=cc.Class({extends:e("basePage"),statics:{prefabPath:"legionwarresultpage"},properties:{p_winNode:cc.Node,p_loseNode:cc.Node,p_drawNode:cc.Node,p_arrBtnMenu:[cc.Node],p_leftInfo:n,p_rightInfo:n,scoreCompare:cc.Label,teamContainer:cc.Node,p_spWinAnimation:sp.Skeleton,p_spLoseAnimation:sp.Skeleton},onLoad:function(){o.instance=this,this.creatMask(!0),this.fitTopMenu(),this.stopBgNodeEvent(),this.handleUI()},onEnable:function(){this._super()},onDisable:function(){this._super()},handleUI:function(){var e=this;this._super(),this.p_arrBtnMenu.forEach(function(t,a){t.on("click",function(){app.playSound("click"),e._onClickMenu(a)})}),this.p_spWinAnimation&&this.p_spWinAnimation&&this.p_spWinAnimation.setCompleteListener(function(t){"start"==t.animation.name&&e.p_spWinAnimation.setAnimation(0,"loop",!0)}),this.p_spLoseAnimation&&this.p_spLoseAnimation&&this.p_spLoseAnimation.setCompleteListener(function(t){"start"==t.animation.name&&e.p_spLoseAnimation.setAnimation(0,"loop",!0)})},onClose:function(){this._super(),this.m_isFirstIn&&app.legionPvpInfo===this.m_data&&app.player.sfAuctionList(0).then(function(e){var t=a({},e);t.auctions.length<=0||(i.emit(eventStr.auctionEvent.RefreshLegionRewardBtn),app.pages.windowsPageWarRewardList.showPage({auctionList:t.auctions,type:0}))}).catch(function(e){cc.warn("auction error: ",JSON.stringify(e))})},setParam:function(e){this.m_data=e.data,this.m_isFirstIn=e.isFirst,this.refreshUI(),this._onClickMenu(0)},refreshUI:function(){var e=this;if(app.legionInfo&&this.m_data.report){var t=app.legionInfo.servid+"_"+app.legionInfo.id,a="",i="";for(var n in this.m_data.report._legion_)this.m_data.report._legion_.hasOwnProperty(n)&&(this.m_data.report._legion_[n]===t?a=n:i=n);var o={score:this.m_data.report.score[a],addScore:this.m_data.report.pvpscore[a],rawScore:this.m_data.pvpscore,legionName:app.legionInfo.name,legionFlag:app.legionInfo.flag},s=this.m_data.opponent?{score:this.m_data.report.score[i],addScore:this.m_data.report.pvpscore[i],rawScore:this.m_data.opponent.pvpscore,legionName:this.m_data.opponent.name,legionFlag:this.m_data.opponent.flag}:null;if(this.scoreCompare.string=o.score+":"+(s?s.score:0),this.p_leftInfo.refreshUI(o),this.p_rightInfo.refreshUI(s),this.m_data.report.winner){var p=a===this.m_data.report.winner;this.p_winNode.active=p,this.p_loseNode.active=!p,p?this.p_spWinAnimation&&this.p_spWinAnimation.setAnimation(0,"start","false"):this.p_spLoseAnimation&&this.p_spLoseAnimation.setAnimation(0,"start","false"),this.p_drawNode.active=!1}else this.p_winNode.active=!1,this.p_loseNode.active=!1,this.p_drawNode.active=!0;r.forEach(function(t,i){var n=e.m_data.report[t],r=e.p_arrBtnMenu[i];n&&cc.isValid(r)&&r.getComponent("menuBtnLegionPvpItem").refreshUI({ret:n.winner?n.winner===a?1:-1:0,score:n.score})}),this.dataMap=r.reduce(function(t,n){var r=e.m_data.report[n];if(!r)return[];var o=0,s=r.detail.map(function(t,s){var p=t[a],c=t[i];o=r.winner===a?p:c,o++;var h={resultState:t.winner?t.winner===a?1:-1:0,teamInfo:e.m_data.camps[n][p]},l=e.m_data.opponent?{resultState:t.winner?t.winner===i?1:-1:0,teamInfo:e.m_data.opponent.camps[n][c]}:null;return{video:t.video,itemID:s,streak:t.streak,selfInfo:h,otherInfo:l}});return t[n]=s,(r.winner===a?e.m_data.camps[n].slice(o):e.m_data.opponent.camps[n].slice(o)).forEach(function(e){var i={resultState:1,teamInfo:e},o={video:null,itemID:t[n].length,streak:1,selfInfo:r.winner===a?i:null,otherInfo:r.winner===a?null:i};t[n].push(o)}),t},{}),cc.log("=== dataMap: ",this.dataMap)}},_onClickMenu:function(e){if(!1!==this.menuHandler(e)){this.m_numMenuIndex=e;var t=r[this.m_numMenuIndex],a=this.dataMap[t];this.teamContainer.getComponent("tableView").initTableView(a.length,{array:a,target:this}),this.p_arrBtnMenu.forEach(function(t,a){t.getComponent("menuBtnLegionPvpItem")&&t.getComponent("menuBtnLegionPvpItem").select(a==e)})}},menuHandler:function(){},setData:function(){}});cc._RF.pop()},{"../utils/events/eventMgr":void 0,basePage:void 0}],legionWarRewardPage:[function(e,t){"use strict";cc._RF.push(t,"daba7hL40pFAL9PR1xRngnB","legionWarRewardPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"legionwarrewardpage",pageType:1},properties:{p_nodeTab:cc.Node},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},setParam:function(){this.m_data=app.db.getLegionWarBossInfo(app.seasonData.info.season),this.refreshUI()},refreshUI:function(){if(this.m_data){var e=this.m_data.STAGE.length;this.p_nodeTab.getComponent("tableView").initTableView(e,{array:this.m_data.STAGE,target:this})}}});cc._RF.pop()},{basePage:void 0}],lineupNamePage:[function(e,t){"use strict";cc._RF.push(t,"9f6d9h1I21IEKsR5k/cYAck","lineupNamePage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"lineupnamepage",pageType:1},properties:{p_btnSure:cc.Button,p_edxName:cc.EditBox},onLoad:function(){a.instance=this,this._super()},handleUI:function(){var e=this;this._super(),this.p_btnSure.node.on("click",function(){if(e.p_edxName.string.length<=0)app.showNotice(langMgr.getString("lineupNamePage",0));else if(app.checkMatchStr(e.p_edxName.string))if(e._oldName!=e.p_edxName.string)switch(e._setType){case"pre":app.player.sfSetLineup(e._index,null,e.p_edxName.string,function(){app.player.battlearr["pre"+e._index].tname=e.p_edxName.string,e.onClose(),e._funCb&&e._funCb()});break;case"legionpvp":if(e.p_edxName.string.length>6)return void app.showNotice(langMgr.getString("lineupNamePage",3));var t=gUtils.deepClone(app.player.battlearr[e._bSetName]);t.tname=e.p_edxName.string;var a={battleset:t};app.player.sfLegionPvpSaveBattleset(a,e._index,function(a){a?app.showNotice(a):(app.player.battlearr[e._bSetName]=t,e.onClose(),e._funCb&&e._funCb())})}else app.showNotice(langMgr.getString("lineupNamePage",2));else app.showNotice(langMgr.getString("lineupNamePage",1))})},setParam:function(e){this._index=e.index,this._funCb=e.funCb,this._bSetName=e.name,this._setType=e.type,this._oldName=app.player.battlearr[this._bSetName]&&app.player.battlearr[this._bSetName].tname?app.player.battlearr[this._bSetName].tname:null,this._oldName&&(this.p_edxName.string=this._oldName)}});cc._RF.pop()},{basePage:void 0}],lookstarPage:[function(e,t){"use strict";function a(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(a)return(a=a.call(e)).next.bind(a);if(Array.isArray(e)||(a=i(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function i(e,t){if(e){if("string"==typeof e)return n(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?n(e,t):void 0}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,i=new Array(t);a<t;a++)i[a]=e[a];return i}cc._RF.push(t,"11014QzHjBEa6yuzv8lBTga","lookstarPage");var r=[30010,30025],o=[[-66,156],[-156,66],[-156,-66],[-66,-156],[66,-156],[156,-66],[156,66],[66,156]],s=[22.5,67.5,112.5,157.5,202.5,247.5,292.5,337.5],p=cc.Class({extends:e("basePage"),statics:{prefabPath:"lookstarpage",showAnim:!0},properties:{p_arrNodeMenu:[cc.Node],p_arrNodePickMenu:[cc.Node],p_btnShop:cc.Button,p_btnGoto:cc.Button,p_btnGotoTime:cc.Label,p_labScore:cc.Label,p_barScore:cc.ProgressBar,p_arrNodeBox:[cc.Node],p_nodeSpin:cc.Node,p_centerSpin:cc.Node,p_centerSpinPro:cc.Node,p_pfbReward:cc.Prefab,p_sprCoin:[cc.Sprite],p_labCoin:[cc.Label],p_btnPlus:cc.Button,p_btnDrawOne:cc.Button,p_sprDrawOne:cc.Sprite,p_labDrawOne:cc.Label,p_btnDrawTen:cc.Button,p_sprDrawTen:cc.Sprite,p_labDrawTen:cc.Label,p_btnRefresh:cc.Button,p_nodeRefreshPay:cc.Node,p_labRefresh:cc.Label,p_sprRefreshLab:cc.Sprite,p_arrLabSpriteFrame:[cc.SpriteFrame],p_nodeReTime:cc.Node,p_labReTime:cc.Label,p_lookstar_eff:cc.Animation,p_btnHelp:cc.Button,p_mask:cc.Node,p_arrNode:[cc.Node],p_nodeTen:cc.Node,p_nodeOne:cc.Node,p_labRewardNode:cc.Node,p_labRewardTime:cc.Label,p_skPlay:sp.Skeleton,p_checkboxNoAnim:cc.Toggle},onLoad:function(){p.instance=this,this.stopBgNodeEvent(),this.creatMask(),this.fitTopMenu(),this.handleUI(),this.schedule(this.refreshTime,1),this.playAnimSpin()},onEnable:function(){this._super(),this.p_mask.active=!1,eventMgr.on(eventStr.zhdPage.XYGX_REFRESH_INFO,this.initReward,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.zhdPage.XYGX_REFRESH_INFO,this.initReward,this)},handleUI:function(){var e=this;this._super(),this.p_arrNodeMenu.forEach(function(t,a){t.on("touchend",function(){e.onClickMenu(a)})}),this.p_arrNodeBox.forEach(function(t,a){t.on("click",function(){e.onClickBox(a)})}),this.p_btnDrawOne.node.on("click",function(){app.playSound("click"),e.extract(1)}),this.p_btnDrawTen.node.on("click",function(){app.playSound("click"),e.extract(10)}),this.p_btnRefresh.node.on("click",function(){app.playSound("click"),e.onClickRefresh()}),this.p_btnShop.node.on("click",function(){app.playSound("click"),app.pages.shoppage.showPage("star")}),this.p_btnGoto.node.on("click",function(){app.playSound("click"),app.goToPage(1068)}),this.p_btnPlus.node.on("click",function(){e.onClickPlus()}),this.p_btnHelp.node.on("click",function(){e.p_arrNodePickMenu[0].active?app.pages.windowspagetipshelp.showPage("1019"):app.pages.windowspagetipshelp.showPage("1020")}),this.p_checkboxNoAnim.node.on("toggle",this.checkboxClickHandle.bind(this)),this.p_checkboxNoAnim.isChecked=!p.showAnim},start:function(){"JP"==gSetting.getLangName()?(this.p_nodeTen.scale=.8,this.p_nodeOne.scale=.8):(this.p_nodeTen.scale=1,this.p_nodeOne.scale=1)},setParam:function(e){e||(e=0),this.m_arrData=[],1!=e||app.db.checkFuncUnLock("LOOKSTAR_PREMIUM",!0)||(e=0),app.db.checkFuncUnLock("LOOKSTAR_PREMIUM")||app.setSpriteState(this.p_arrNodeMenu[1].getComponent(cc.Sprite),!0),this.onClickMenu(e,!0),app.runUnlockGuide("LOOK")},getNewData:function(e,t){var a=this;if(this.m_arrData[this.m_numShowMenuIndex])return this.m_objData=this.m_arrData[this.m_numShowMenuIndex],this.refreshReward(),this.p_btnRefresh.interactable=!0,this.refreshReBtn(),void(t&&t());app.player.sfSpinGet(e,0,function(i,n){if(i)return a.p_mask.active=!1,void app.showNotice(i);n&&(a.m_objData=n,a.m_arrData[e-1]=n,a.refreshReward(),a.initReward(),a.p_btnRefresh.interactable=!0,a.refreshReBtn(),t&&t())})},refreshUI:function(e){var t=app.db.dbSpin[this.m_numShowMenuIndex];this.refreshScore();var a=!1,i=app.player.getServerTime(),n=app.arrZhdTime.XYGX?app.arrZhdTime.XYGX.time:[];this.p_btnGotoTime.string=gUtils.getCountDownStr(n[1]-i),n[0]<=i&&i<=n[1]&&(a=!0),this.p_btnGoto.node.active=a&&app.db.checkFuncUnLock("ACTIVITY_ZHD")&&app.db.checkChannelShow("ACTIVITY_ZHD");var r=t.REFRESH.COUNT;this.p_labRefresh.string=r;var o=app.db.getPropsIconPath(t.REFRESH.GSID);app.loadTexture(o,this.p_nodeRefreshPay.getComponent(cc.Sprite),this.prefabPath),this.refreshCoin(t),this.getNewData(this.m_numShowMenuIndex+1,e),this.refreshTime(),this.initReward()},refreshCoin:function(e){var t=gConfig.getCurrencyIconPath(e[1].GSID),a=gConfig.getCurrencyIconPath(e.BUYCOIN.GSID),i=[e[1].GSID,e.BUYCOIN.GSID];this.node.getComponent("currency").refreshCoin(i);var n=app.player.getCount(e[1].GSID),r=e[1].COUNT;n>=e[10].COUNT?(app.loadTexture(t,this.p_sprDrawOne,this.prefabPath),app.loadTexture(t,this.p_sprDrawTen,this.prefabPath),this.p_labDrawOne.string=e[1].COUNT,this.p_labDrawTen.string=e[10].COUNT):n>=r?(app.loadTexture(t,this.p_sprDrawOne,this.prefabPath),app.loadTexture(a,this.p_sprDrawTen,this.prefabPath),this.p_labDrawOne.string=e[1].COUNT,this.p_labDrawTen.string=10*e.BUYCOIN.COUNT):n<r&&(app.loadTexture(a,this.p_sprDrawOne,this.prefabPath),app.loadTexture(a,this.p_sprDrawTen,this.prefabPath),this.p_labDrawOne.string=e.BUYCOIN.COUNT,this.p_labDrawTen.string=10*e.BUYCOIN.COUNT)},refreshTitleRed:function(){for(var e=app.db.dbSpin[0].SCORE,t=app.db.dbSpin[1].SCORE,a=app.player.getCount(r[0]),i=app.player.getCount(r[1]),n=!1,o=0;o<e.length;++o){var s=e[o].SIGN,p=e[o].COUNT;if(app.player.getCount(s)<=0&&a>=p){n=!0;break}}for(var c=!1,h=0;h<t.length;++h){var l=t[h].SIGN,g=t[h].COUNT;if(app.player.getCount(l)<=0&&i>=g){c=!0;break}}this.p_arrNodeMenu[0].getChildByName("rednotice").active=n,this.p_arrNodeMenu[1].getChildByName("rednotice").active=c&&app.db.checkFuncUnLock("LOOKSTAR_PREMIUM")},initReward:function(){return!1},refreshReward:function(){var e=this;if(this.m_objData){if(this.p_arrNode.forEach(function(t,a){t.active=a?1==e.m_objData.items[7].SELL:0==e.m_objData.items[7].SELL}),0==this.m_objData.items[7].SELL&&app.player.safe.spin){var t=app.player.safe.spin.normal+"";0!=this.m_numShowMenuIndex&&(t=app.player.safe.spin.premium+""),this.p_labRewardTime.string=t}var a=this.m_objData.items;this.m_arrNodeReward||(this.m_arrNodeReward=[]);for(var i=0;i<a.length;++i){var n=this.m_arrNodeReward[i];if(!n){if(!o[i])break;(n=cc.instantiate(this.p_pfbReward)).parent=this.p_nodeSpin;var r=cc.v2(o[i][0],o[i][1]);n.setPosition(r),n.angle=s[i],n.setScale(cc.v2(.7,.7)),this.m_arrNodeReward.push(n)}var p={GSID:a[i].GSID,COUNT:a[i].COUNT};n.getComponent("propItem").initForBag(p),n.getComponent("propItem").setClick(!0),a[i].SELL&&!a[i].REPEAT?app.setNodeState(n,1):app.setNodeState(n,0)}}},refreshScore:function(){this.refreshTitleRed();var e=app.db.dbSpin[this.m_numShowMenuIndex].SCORE,t=app.player.getCount(r[this.m_numShowMenuIndex]);app.db.getMaxScore(this.m_numShowMenuIndex+1),this.p_labScore.string=t;for(var a,i,n=this.p_barScore.totalLength/this.p_arrNodeBox.length,o=e.length-1,s=0;s<e.length;++s){var p=e[s],c=e[s-1]||{COUNT:0};if(t<=p.COUNT){a=p.COUNT,i=c.COUNT,o=s;break}}var h;h=a||i?((t-i)/(a-i)+o)*n:this.p_barScore.totalLength,this.p_barScore.progress=Math.min(h/this.p_barScore.totalLength,1);for(var l=0;l<this.p_arrNodeBox.length;++l){var g=e[l],d=this.p_arrNodeBox[l],u=app.player.getCount(g.SIGN),f=(l+1)/this.p_arrNodeBox.length*this.p_barScore.node.width-267,m=u>0?1:0;d.getComponent("lookstarScoreItem").refreshBox(g.COUNT,u,f,t,m)}},refreshTime:function(){if(this.m_objData&&this.m_objData.free){var e=this.m_objData.free-app.player.getServerTime()+108e5;this.m_boolFree=!(e>0),this.p_labReTime.string=gUtils.getHourMinSecTime(e/1e3);var t=app.player.getServerTime(),a=app.arrZhdTime.XYGX?app.arrZhdTime.XYGX.time:[];this.p_btnGotoTime.string=gUtils.getCountDownStr((a[1]||0)-t),this.p_nodeReTime.active=!!(e>0)}},refreshReBtn:function(){var e=this.m_objData.free-app.player.getServerTime()+108e5;this.m_boolFree=!(e>0),this.m_boolFree?(this.p_nodeRefreshPay.active=!1,this.p_sprRefreshLab.spriteFrame=this.p_arrLabSpriteFrame[1]):this.m_boolFree||(this.p_nodeRefreshPay.active=!0,this.p_sprRefreshLab.spriteFrame=this.p_arrLabSpriteFrame[0]),this.p_nodeReTime.active=1===this.m_numShowMenuIndex,this.p_btnRefresh.node.active=1===this.m_numShowMenuIndex},onClickMenu:function(e,t){(this.m_numShowMenuIndex!=e||t)&&(1!=e||app.db.checkFuncUnLock("LOOKSTAR_PREMIUM",!0))&&(this.p_btnRefresh.interactable=!1,this.m_numShowMenuIndex=e,this.p_arrNodePickMenu.forEach(function(t,a){t.active=a==e}),this.p_centerSpin.opacity=0===this.m_numShowMenuIndex?255:0,this.p_centerSpinPro.opacity=0!==this.m_numShowMenuIndex?255:0,this.p_labRewardNode.active=1===e,this.refreshUI())},onClickRefresh:function(){var e=this;if(!this.isSpin){var t=50,a=langMgr.getString("lookstarPage",7);if(1==this.m_numShowMenuIndex&&(t=100,a=langMgr.getString("lookstarPage",8)),!this.m_boolFree&&app.player.getCount(38005)<t)return app.showNotice(langMgr.getString("lookstarPage",0)),void(this.p_mask.active=!1);var i=this.m_boolFree,n=this.m_numShowMenuIndex+1,r=langMgr.getString("lookstarPage",3);"JP"==gSetting.getLangName()&&(r="");var o={content:r+(this.m_boolFree?langMgr.getString("lookstarPage",4):langMgr.getString("lookstarPage",5,t))+langMgr.getString("lookstarPage",6,a),confirmcb:function(){app.player.sfSpinGet(n,1,function(a,r){a?app.showNotice(a):(e.m_objData=r,e.m_arrData[n-1]=r,i||app.player.reduceItem({gsid:38005,count:t}),app.player.sfPlayerByParam(["others","safe"],function(){e.refreshUI()}))})},target:this};app.pages.windowspagetipsmsg.showPage(o)}},onClickDarw:function(e){var t=this;if(!this.isSpin){var a=this.m_numShowMenuIndex+1;this.p_mask.active=!0,this.isSpin=!0,app.mainScene.p_nodeWait.show({isShow:!1}),app.player.sfSpinRoll(a,e,function(i,n){if(i)return app.showNotice(i),t.isSpin=!1,t.p_mask.active=!1,void app.mainScene.p_nodeWait.hide();p.showAnim||app.playSound("lookstar");var r={reward:t.setRewardData(n.items,a,e),confirmcb:function(){t.isAgain?t.isAgain=!1:t.p_mask.active=!1,t.isSpin=!1,t.playAnimSpin(),t.refreshUI()},againname:e,againcb:function(e){t.isAgain=!0,cc.log("again look star"),t.isSpin=!1,t.playAnimSpin(),t.refreshUI(function(){t.extract(e)})},againparm:[e],target:t};t.p_nodeSpin.stopAllActions();var o=t.p_nodeSpin.angle%360,s=45*-n.pos-22.5-o,c=function(){var e=n.items||[],t=n.castitems||[];app.player.addItem(e),app.player.reduceItem(t),app.player.sfPlayerByParam(["others","safe"],function(){app.pages.windowspagereward.showPage(r,null,function(){app.mainScene.p_nodeWait.hide()})})};p.showAnim?(app.loadEff("guanxing",t.p_lookstar_eff,2,2.1),t.p_skPlay.node.active=!0,t.p_skPlay.setAnimation(0,"animation",!1),cc.tween(t.p_nodeSpin).by(3,{angle:1800+s+10},{easing:"cubicInOut"}).by(1,{angle:-10},{easing:"cubicOut"}).call(function(){c(),t.p_lookstar_eff.node.active=!1,t.p_skPlay.node.active=!1}).start()):c()})}},checkboxClickHandle:function(e){p.showAnim=!e.isChecked},extract:function(e){var t=this,a=this.m_numShowMenuIndex+1,i=app.db.dbSpin[a-1],n=0,r=i[e].COUNT,o=app.player.getCount(i[e].GSID),s=i.BUYCOIN.COUNT*e,p=app.player.getCount(i.BUYCOIN.GSID);switch(o>=r?n=1:p>=s&&(n=2),n){case 0:var c=app.db.getPropsName(i.BUYCOIN.GSID);app.showNotice(langMgr.getString("lookstarPage",1,c)),this.p_mask.active=!1;break;case 1:this.onClickDarw(e);break;case 2:var h=1==this.m_numShowMenuIndex?langMgr.getString("lookstarPage",10):langMgr.getString("lookstarPage",9),l={content:langMgr.getString("lookstarPage",11,[s,e,h]),confirmcb:function(e){t.onClickDarw(e)},confirmparm:[e],cancelcb:function(){t.p_mask.active=!1,t.isSpin=!1},target:this};app.pages.windowspagetipsmsg.showPage(l)}},playAnimSpin:function(){cc.tween(this.p_nodeSpin).by(1,{angle:-5}).repeatForever().start()},onClickPlus:function(){var e=this.m_numShowMenuIndex,t=app.db.dbSpin[e],a=t.BUYCOIN;if(a){this.m_buyExid=a.EXID;var i=Math.floor(app.player.getCount(a.GSID)/a.COUNT),n={gsid:t[1].GSID,maxcount:i,coin:a.GSID,price:a.COUNT,type:"buy",confirmcb:this.buyCb,target:this};app.player.getCount(a.GSID)<a.COUNT?app.showNotice(langMgr.getString("lookstarPage",2,a.COUNT)):app.pages.windowspagesetnum.showPage(n)}},onClickBox:function(e){var t=this;if(!this.isOpenBox){this.isOpenBox=!0;var a=this.m_numShowMenuIndex+1,i=app.db.dbSpin[a-1].SCORE[e],n=app.player.getCount(r[this.m_numShowMenuIndex]);if(app.player.getCount(i.SIGN)>0||i.COUNT>n){var o={worldPos:this.p_arrNodeBox[e].convertToWorldSpaceAR(cc.v2(0,0)),arrReward:i.REWARD,closeCb:function(){t.isOpenBox=!1}};app.pages.windowspagerewardtips.showPage(o)}else{var s="spinscore_"+a+"_"+i.COUNT,p="spinrset_"+a,c=[];c.push({exid:s,times:1}),c.push({exid:p,times:1}),app.player.sfExchangeMore({batch:c,ignore:!0},function(e){var a={showtype:1,reward:e,confirmcb:function(){cc.isValid(t)&&(t.isOpenBox=!1,t.refreshScore())},target:t};app.pages.windowspagereward.showPage(a)})}}},setRewardData:function(e,t,a){for(var i=[],n=0;n<e.length;++n){var r=e[n],o=r.GSID||r.gsid;this.checkRepeat(o,!0),this.checkDrop(o,t,a)||i.push(r)}return i},buyCb:function(e,t){var a=this,i=this.m_numShowMenuIndex,n=app.db.dbSpin[i].BUYCOIN;n&&(this.m_buyExid=n.EXID,app.player.sfExchange(this.m_buyExid,e,0,function(){a.refreshUI(),t&&t()}))},checkDrop:function(e,t,i){var n=app.db.dbSpin[t-1][i].DROP;n||(n=[]);for(var r,o=a(n);!(r=o()).done;)if(e==r.value)return!0;return!1},checkRepeat:function(e,t){for(var a=0;a<this.m_objData.items.length;++a){var i=this.m_objData.items[a];if((i.GSID||i.gsid)==e)return 1==i.REPEAT||(t&&(i.SELL=1),cc.log(this.m_objData.items),!1)}},checkScore:function(e){var t=app.db.dbSpin[e-1].SCORE;if(app.player.getCount(r[e-1])<t[t.length-1].COUNT)return!1;for(var a=0;a<t.length;++a){var i=t[a];if(app.player.getCount(i.SIGN)<=0)return!1}return!0},onClose:function(){this.isSpin=!1,this.p_mask.active=!1,this._super()}});p.refreshRed=function(e){for(var t=app.db.dbSpin[0].SCORE,a=app.db.dbSpin[1].SCORE,i=app.player.getCount(r[0]),n=app.player.getCount(r[1]),o=!1,s=0;s<t.length;++s){var p=t[s].SIGN,c=t[s].COUNT;if(app.player.getCount(p)<=0&&i>=c){o=!0;break}}var h=!1;if(app.db.checkFuncUnLock("LOOKSTAR_PREMIUM"))for(var l=0;l<a.length;++l){var g=a[l].SIGN,d=a[l].COUNT;if(app.player.getCount(g)<=0&&n>=d){h=!0;break}}var u=!1;return(o||h)&&(u=!0),e&&(e.active=u),u},cc._RF.pop()},{basePage:void 0}],mailAnnoPage:[function(e,t){"use strict";cc._RF.push(t,"bd094ydjAdD5KTlAP2gYC/u","mailAnnoPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"mailannopage",pageType:1},properties:{p_labTitle:cc.Label,p_labContent:cc.Label,p_labSend:cc.Label,p_labETime:cc.Label,p_btnDel:cc.Button,p_btnAnno:cc.Button},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){var e=this;this._super(),this.p_btnAnno.node.on("click",function(){app.playSound("click"),e.onClickAnno()}),this.p_btnDel.node.on("click",function(){app.playSound("click"),e.onClickDel()})},setParam:function(e){cc.log(e),this.m_objData=e,this.setRead()},refreshUI:function(e){this.p_labTitle.string=e.title,this.p_labContent.string=e.content,this.p_labETime.string=langMgr.getString("mailAnnoPage",0,app.pages.mailpage.setETime(e.etime)),"sys"==e.from.type?this.p_labSend.string=langMgr.getString("mailAnnoPage",1):"role"==e.from.type?this.p_labSend.string=langMgr.getString("mailAnnoPage",2,e.title):"legion"==e.from.type?this.p_labSend.string=langMgr.getString("mailAnnoPage",3):"anno"==e.from.type&&(this.p_labSend.string=langMgr.getString("mailAnnoPage",4))},setRead:function(){var e=this,t=this.m_objData.type,a=this.m_objData.state;2!=t&&1!=a?app.player.sfSetMailRead([this.m_objData.id],function(){e.m_objData.state=1,e.refreshUI(e.m_objData);for(var t=[],a=0;a<app.mailData.length;++a){var i=app.mailData[a];i.id==e.m_objData.id&&(i.state=1),2==i.type&&0==i.state&&t.push(i.id)}app.getRedInfoByObj(["mail","mail"],0)!=t.length&&(app.redDataServer.mail.mail=t.length,eventMgr.emit(eventStr.redEvent.RefreshMainSceneRed))}):this.refreshUI(this.m_objData)},onClickAnno:function(){var e={url:app.annourl||""};app.annourl?app.pages.annowebpage.showPage(e):app.player.sfMaintain(function(t,a){t?app.showNotice(t):(e.url=a.url,app.pages.annowebpage.showPage(e))})},onClickDel:function(){var e=this;app.player.sfDelMail([this.m_objData.id],function(){app.showNotice(langMgr.getString("mailAnnoPage",5)),e.onClose()})},onClose:function(){this._super(),app.pages.mailpage.instance.refreshData()}});cc._RF.pop()},{basePage:void 0}],mailInfoPage:[function(e,t){"use strict";cc._RF.push(t,"cebb8UwQzlFAqVKu/L+Dc6S","mailInfoPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"mailinfopage",pageType:1},properties:{p_labTitle:cc.Label,p_contentLayout:cc.Node,p_labNode:cc.Node,p_labSend:cc.RichText,p_labETime:cc.RichText,p_nodeGift:cc.Node,p_layoutItems:cc.Node,p_pfbItem:cc.Prefab,p_btnHandle:cc.Button,p_nodeDel:cc.Node,p_nodeGet:cc.Node,p_nodeReply:cc.Node},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.m_arrNodeGift=[]},handleUI:function(){var e=this;this._super(),this.p_btnHandle.node.on("click",function(){app.playSound("click"),e.onClickBtn()})},setParam:function(e){cc.log(e),this.m_objData=e.info,this.m_target=e.target,this.setRead()},refreshUI:function(e){this.p_labTitle.string=e.title;for(var t=e.content.split("|"),a=0;a<t.length;a++){var i=this.p_contentLayout.children[a];i||(i=cc.instantiate(this.p_labNode),this.p_contentLayout.addChild(i)),i.active=!0,i.getComponent(cc.Label).string=t[a]}1==e.type||e.type,this.p_labETime.string=langMgr.getString("mailInfoPage",0,app.pages.mailpage.setETime(e.etime)),"sys"==e.from.type?(this.p_labSend.string=langMgr.getString("mailInfoPage",1),this.p_labSend.node.y=-108,this.p_labETime.node.y=-145):"role"==e.from.type?(this.p_labSend.string=langMgr.getString("mailInfoPage",2,e.title),this.p_labSend.node.y=-251,this.p_labETime.node.y=-288):"legion"==e.from.type&&(this.p_labSend.string=langMgr.getString("mailInfoPage",3),this.p_labSend.node.y=-251,this.p_labETime.node.y=-288),"Array"!=gUtils.getType(e.reward)||e.reward.length<=0?this.p_nodeGift.active=!1:this.p_nodeGift.active=!0;for(var n=0;n<e.reward.length;n++){if(!e.reward[n].count&&!e.reward[n].COUNT)return;var r=this.m_arrNodeGift[n];r||((r=cc.instantiate(this.p_pfbItem)).scale=.8,r.parent=this.p_layoutItems,this.m_arrNodeGift.push(r)),r.active=!0;var o={gsid:e.reward[n].gsid||e.reward[n].GSID,count:e.reward[n].count||e.reward[n].COUNT};r.getComponent("propItem").initForBag(o),r.getComponent("propItem").setClick(!0);var s=0!==this.m_objData.state;r.getComponent("propItem").setGray(s)}for(var p=e.reward.length;p<this.m_arrNodeGift.length;++p)this.m_arrNodeGift[p].active=!1;this.refreshBtn()},refreshBtn:function(){switch(this.m_objData.from.type){case"role":this.p_btnHandle.node.active=!0,this.p_nodeDel.active=!1,this.p_nodeGet.active=!1,this.p_nodeReply.active=!0,this.m_strType="reply";break;default:2==this.m_objData.type&&0==this.m_objData.state?(this.p_btnHandle.node.active=!0,this.m_strType="get",this.p_nodeDel.active=!1,this.p_nodeGet.active=!0,this.p_nodeReply.active=!1):1==this.m_objData.type&&0==this.m_objData.state?(this.p_btnHandle.node.active=!1,this.m_strType="cancel"):(this.p_btnHandle.node.active=!0,this.p_nodeDel.active=!0,this.p_nodeGet.active=!1,this.p_nodeReply.active=!1,this.m_strType="del")}},setRead:function(){var e=this,t=this.m_objData.type,a=this.m_objData.state;2!=t&&1!=a?app.player.sfSetMailRead([this.m_objData.id],function(){e.m_objData.state=1,e.refreshUI(e.m_objData);for(var t=[],a=0;a<app.mailData.length;++a){var i=app.mailData[a];i.id==e.m_objData.id&&(i.state=1),2==i.type&&0==i.state&&t.push(i.id)}app.getRedInfoByObj(["mail","mail"],0)!=t.length&&(app.redDataServer.mail.mail=t.length,eventMgr.emit(eventStr.redEvent.RefreshMainSceneRed))}):this.refreshUI(this.m_objData)},onClickBtn:function(){var e=this;switch(this.m_strType){case"get":app.player.sfgetMailReward([this.m_objData.id],function(t,a){t||app.player.sfPlayerData(function(){e.m_objData.state=2,app.redDataServer.mail.mail--,e.refreshUI(e.m_objData);var t={showtype:1,reward:a};app.pages.windowspagereward.showPage(t),app.pages.mailpage.instance.refreshView()})});break;case"del":app.player.sfDelMail([this.m_objData.id],function(){app.showNotice(langMgr.getString("mailInfoPage",5)),app.pages.mailpage.instance.refreshData(),e.onClose()});break;case"reply":var t=app.checkIsFriend(this.m_objData.from.fid),a=app.player.legion&&this.m_objData.from.legion==app.player.legion;if(!t&&!a)return void app.showNotice(langMgr.getString("mailInfoPage",6));var i={type:1,id:this.m_objData.from.fid,rname:this.m_objData.title};app.pages.mailreplypage.showPage(i)}},onClose:function(){this._super(),this.m_target.refreshUI(this.m_objData)}});cc._RF.pop()},{basePage:void 0}],mailPage:[function(e,t){"use strict";cc._RF.push(t,"43bf0KjRqBFybOFhqYrt5oY","mailPage");var a=e("async"),i=cc.Class({extends:e("basePage"),statics:{prefabPath:"mailpage",pageType:0,setSTime:function(e){var t=app.player.getServerTime()-e,a=gUtils.getDayHourMinSecTime(t);return a[0]>0?langMgr.getString("mailPage",3,a[0]):a[1]>0?langMgr.getString("mailPage",4,a[1]):a[2]>0?langMgr.getString("mailPage",5,a[2]):langMgr.getString("mailPage",6)},setETime:function(e){var t=e-app.player.getServerTime(),a=gUtils.getDayHourMinSecTime(t);return a[0]>0?a[0]+langMgr.getString("public",12):a[1]>0?a[1]+langMgr.getString("public",7):a[2]>0?a[2]+langMgr.getString("public",8):langMgr.getString("mailPage",7)}},properties:{p_tabvMail:cc.Node,p_labNum:cc.Label,p_btnDel:cc.Button,p_btnGet:cc.Button,p_nodeEmptyTip:cc.Node},onLoad:function(){i.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){var e=this;this._super(),this.p_btnDel.node.on("click",function(){app.playSound("click"),e.onClickBtnDel()}),this.p_btnGet.node.on("click",function(){app.playSound("click"),e.onClickBtnGet()})},onEnable:function(){this._super(),eventMgr.on(eventStr.mailPageEvent.AddNewMail,this.addNewMail,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.mailPageEvent.AddNewMail,this.addNewMail,this)},setParam:function(){this.m_clickStr="sys",this.refreshData()},addNewMail:function(){this.refreshUI(app.mailData)},refreshData:function(){var e=this;app.player.sfGetMailList(!1,function(t){app.mailData=t;for(var a=[],i=0;i<app.mailData.length;++i){var n=app.mailData[i];0==n.state&&a.push(n.id)}app.getRedInfoByObj(["mail","mail"],0)!=a.length&&(app.redDataServer.mail.mail=a.length),e.refreshUI(app.mailData)})},refreshUI:function(e){this.refreshView(e)},refreshView:function(e){var t=this;if(e){this.setData();var a=app.mailData.length;this.p_labNum&&(this.p_labNum.string=a+"/50"),this.p_nodeEmptyTip.active=a<=0,this.p_tabvMail.getComponent("tableView").initTableView(a,{array:app.mailData,target:this},function(){cc.isValid(t)&&t.p_tabvMail.getComponent("tableView").getCells(function(e){app.playVerticalListAction(e,["y","scale"])})})}else this.p_labNum&&(this.p_labNum.string="0/50")},setData:function(){app.mailData.sort(function(e,t){return e.state-t.state})},onClickBtnDel:function(){var e=this;if(app.mailData){for(var t=[],a=0;a<app.mailData.length;++a){var i=app.mailData[a];1!=i.state&&2!=i.state||t.push(i.id)}if(t.length<=0)app.showNotice(langMgr.getString("mailPage",0));else{var n=t.length;app.player.sfDelMail(t,function(){app.showNotice(langMgr.getString("mailPage",1,n)),e.refreshData()})}}},onClickBtnGet:function(){var e=this;if(app.mailData){for(var t=[],i=[],n=0;n<app.mailData.length;++n){var r=app.mailData[n];2==r.type&&0==r.state&&t.push(r.id),1==r.type&&0==r.state&&i.push(r.id)}t.length<=0&&i.length<=0?app.showNotice(langMgr.getString("mailPage",2)):a.series([function(e){i.length>0?app.player.sfSetMailRead(i,function(){e()}):e()},function(e){t.length>0?app.player.sfgetMailReward(t,function(t,a){e(a)}):e()}],function(a){a&&a.length?app.player.sfPlayerData(function(){var i={showtype:1,reward:a};app.getRedInfoByObj(["mail","mail"],0)!=t.length&&(app.redDataServer.mail.mail=t.length),app.pages.windowspagereward.showPage(i),e.refreshData()}):e.refreshData()})}},onClose:function(){this._super()}});i.refreshRed=function(e){var t=!1,a=app.getRedInfoByObj(["mail","mail"],null);return null!=a&&(t=a>0),e&&(e.active=t),t},cc._RF.pop()},{async:void 0,basePage:void 0}],mailReplyPage:[function(e,t){"use strict";cc._RF.push(t,"16489ToeyhEJIxfH0PlA0eR","mailReplyPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"mailreplypage",pageType:1},properties:{p_eboxSendMail:cc.EditBox,p_labTitleDesc:cc.Label,p_btnSendMail:cc.Button},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},setParam:function(e){this.m_mailType=e.type,this.m_title=e.title,this.m_id=e.id,this.m_rname=e.rname,this.m_level=e.level,this.m_legionTarget=e.target,this.initUI(),this.refreshUI()},refreshUI:function(){this.upLabTitle()},initUI:function(){this.p_labTitleDesc.string="",this.p_eboxSendMail.string=""},upLabTitle:function(){this.m_title?this.p_labTitleDesc.string=this.m_title:1==this.m_mailType?this.p_labTitleDesc.string=this.m_rname:2==this.m_mailType&&(this.p_labTitleDesc.string=langMgr.getString("mailReplyPage",0))},handleUI:function(){this._super();var e=this;this.p_btnSendMail.node.on("click",function(){e.onClickBtnSend()})},onClickBtnSend:function(){var e=this;if(app.playSound("click"),app.player.getCount(38004)<3){var t=langMgr.getString("mailReplyPage",6,app.db.getOfficialInfoByLv(3).NAME);return app.showNotice(t),void(this.p_eboxSendMail.string="")}for(var a=!0,i=this.p_eboxSendMail.string,n=0;n<i.length;n++){var r=i.substr(n,1);"\n"!=r&&" "!=r&&(a=!1)}if(i.length<=0||a)app.showNotice(langMgr.getString("mailReplyPage",1));else if(app.checkMatchStr(i)){if(1==this.m_mailType){if(!app.db.checkFuncUnLock("PRIVATEMAIL",!0))return;var o=this.m_id,s=app.player.rname;app.player.sfSendMail(o,s,i,function(t){if(t)if("lv limit"==t)app.showNotice(langMgr.getString("mailReplyPage",3));else if("rank limit"==t){var a=langMgr.getString("mailReplyPage",6,app.db.getOfficialInfoByLv(3).NAME);app.showNotice(a)}else app.showNotice(langMgr.getString("mailReplyPage",4));else app.showNotice(langMgr.getString("mailReplyPage",5)),e.onClose()})}else if(2==this.m_mailType){var p=this.p_labTitleDesc.string;app.player.sfLegionSendMail(p,i,function(t){if(t)if("rank limit"==t){var a=langMgr.getString("mailReplyPage",6,app.db.getOfficialInfoByLv(3).NAME);app.showNotice(a)}else app.showNotice(langMgr.getString("mailReplyPage",4));else e.m_legionTarget.legionInfo.nextmail=app.player.getServerTime()+24e4,app.showNotice(langMgr.getString("mailReplyPage",5)),e.onClose()})}}else app.showNotice(langMgr.getString("mailReplyPage",2))}});cc._RF.pop()},{basePage:void 0}],manorAchievePage:[function(e,t){"use strict";cc._RF.push(t,"4ab64prDtJAoKlL0auUbY75","manorAchievePage");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=this&&this.__spreadArrays||function(){for(var e=0,t=0,a=arguments.length;t<a;t++)e+=arguments[t].length;var i=Array(e),n=0;for(t=0;t<a;t++)for(var r=arguments[t],o=0,s=r.length;o<s;o++,n++)i[n]=r[o];return i},o=cc._decorator,s=o.ccclass,p=o.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_tableview=null,t.m_achieveData=[],t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},t.prototype.handleUI=function(){e.prototype.handleUI.call(this)},t.prototype.setParam=function(){this.setAchieveData(),this.refreshUI()},t.prototype.reloadView=function(){this.setAchieveData(),cc.isValid(this.p_tableview)&&this.p_tableview.getComponent("tableView").reload({array:this.m_achieveData,target:this})},t.prototype.setAchieveData=function(){var e=r(app.db.dbmanorachieve);e.sort(function(e,t){var a=app.player.getMissionState(e).state,i=app.player.getMissionState(t).state;return a<i?1:a==i&&e.LV>t.LV?1:-1}),this.m_achieveData=e},t.prototype.refreshUI=function(){var e=this;cc.isValid(this.p_tableview)&&this.p_tableview.getComponent("tableView").initTableView(this.m_achieveData.length,{array:this.m_achieveData,target:this},function(){e.p_tableview.getComponent("tableView").getCells(function(e){app.playVerticalListAction(e,["y","scale"])})})},t.refreshRed=function(){return app.db.dbmanorachieve.some(function(e){return 3==app.player.getMissionState(e).state})},t.prefabPath="manorachievepage",t.pageType=1,n([p(cc.Node)],t.prototype,"p_tableview",void 0),a=n([s],t)}(e("basePage"));t.exports=c,cc._RF.pop()},{basePage:void 0}],manorBossPage:[function(e,t){"use strict";cc._RF.push(t,"3c21elqRbJF0IG/ucY0vSw2","manorBossPage");var a={gsid:38007,count:1},i=cc.Class({extends:e("basePage"),statics:{prefabPath:"manorbosspage",pageType:1},properties:{p_labTime:cc.Label,p_labfood:cc.Label,p_nodeBossPortrait:cc.Node,p_progBossHP:cc.ProgressBar,p_labBossHP:cc.Label,p_nodeLayout:cc.Node,p_pfbRewardItem:cc.Prefab,p_btnQuickFight:cc.Button,p_btnTeamFight:cc.Button,p_labTeamFight:cc.Label,p_btnFight:cc.Button,p_spFightIcon:cc.Sprite,p_spBtnIcons:[cc.Sprite]},onLoad:function(){var e=this;i.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.m_arrIconReward=[],this.schedule(this.refreshTime,1),app.loadTexture(gConfig.getCurrencyIconPath(a.gsid),this.p_spFightIcon,this.prefabPath),this.p_spBtnIcons.forEach(function(t){app.loadTexture(gConfig.getCurrencyIconPath(a.gsid),t,e.prefabPath)})},handleUI:function(){var e=this;this._super(),this.p_btnQuickFight.node.on("click",function(){app.playSound("click"),2!=app.pages.manorsiegepage.instance.m_objData.mop?e.onQuickFight():app.showNotice(langMgr.getString("manorBossPage",0))}),this.p_btnTeamFight.node.on("click",function(){app.playSound("click"),2!=app.pages.manorsiegepage.instance.m_objData.mop?e.onTeamFight():app.showNotice(langMgr.getString("manorBossPage",0))}),this.p_btnFight.node.on("click",function(){app.playSound("click"),2!=app.pages.manorsiegepage.instance.m_objData.mop?e.onFight():app.showNotice(langMgr.getString("manorBossPage",0))})},setParam:function(e){app.manorboss=null,this.m_objEnemyData=e.data,this.m_objParam=e.objParam,this.refreshUI()},refreshUI:function(){this.m_blnBtnInteractable=!0,this.refreshBoss(),this.refreshReward(),this.refreshBtn(),this.refreshTime()},refreshTime:function(){var e=app.player.getServerTime(),t=this.m_objParam.rtime-e;t<=0?this.onClose():this.p_labTime.string=gUtils.getHourMinSecTime(t/1e3)},refreshBoss:function(){var e=this,t=app.db.getManorInfo(this.m_objParam.lv).UPITEM[0],a=app.player.getCount(t.GSID),i=app.pages.manorpage.instance&&app.pages.manorpage.instance.getFoodMax();this.p_labfood.string=a+"/"+i;var r=n(this.m_objEnemyData.boss.bset),o=app.db.getGBaseByGsid(r.gsid);cc.isValid(this._nodeBossPortrait)?this._nodeBossPortrait.getComponent("generalPortraitItem").initReport(o,r):app.loadGeneralPortrait().then(function(t){cc.isValid(e)&&(e._nodeBossPortrait=cc.instantiate(t),e.p_nodeBossPortrait.addChild(e._nodeBossPortrait),e._nodeBossPortrait.setPosition(cc.Vec2.ZERO),e._nodeBossPortrait.getComponent("generalPortraitItem").initReport(o,r))}).catch(function(e){return cc.warn(e)}),this.p_progBossHP.progress=this.m_objEnemyData.boss.nowhp/this.m_objEnemyData.boss.maxhp,this.p_labBossHP.string=Math.ceil(this.m_objEnemyData.boss.nowhp/this.m_objEnemyData.boss.maxhp*100)+"%",0==this.m_objEnemyData.boss.nowhp?(this.m_blnBtnInteractable=!1,this.p_nodeBossPortrait.getComponent("generalPortraitItem").setGray(!0)):this.p_nodeBossPortrait.getComponent("generalPortraitItem").setGray(!1)},refreshReward:function(){for(var e=app.db.getManorBossReward(this.m_objParam.lv),t=0;t<e.length;++t){var a=this.m_arrIconReward[t];a||((a=cc.instantiate(this.p_pfbRewardItem)).parent=this.p_nodeLayout,this.m_arrIconReward.push(a)),a.active=!0,a.getComponent("propItem").initForBag(e[t]),a.getComponent("propItem").setClick(!0)}for(var i=e.length;i<this.m_arrIconReward.length;++i)this.m_arrIconReward[i].active=!1},refreshBtn:function(){this.p_btnQuickFight.node.active=!!this.m_objParam.damge,this.p_btnQuickFight.interactable=this.m_blnBtnInteractable,this.p_btnQuickFight.node.active?(this.p_btnTeamFight.node.x=-200,this.p_btnFight.node.x=0,this.p_btnQuickFight.x=200):(this.p_btnTeamFight.node.x=-120,this.p_btnFight.node.x=120);var e=app.player.getCount(90365);this.p_labTeamFight.string=2-e+"/2",this.p_btnTeamFight.interactable=e<2&&this.m_blnBtnInteractable,this.p_btnFight.interactable=this.m_blnBtnInteractable},onQuickFight:function(){var e=this;if(app.player.getCountEnough(a)){var t=gUtils.showNum(this.m_objParam.damge),i={content:langMgr.getString("manorBossPage",3,t),confirmcb:function(){app.player.sfManorMop({times:1},function(t){app.player.reduceItem(a),app.player.addItem(t.reward);var i={reward:t.reward,showtype:1};app.pages.windowspagereward.showPage(i),t.nowhp=t.nowhp<=0?0:t.nowhp,e.m_objEnemyData.boss.nowhp=t.nowhp,e.refreshUI(),app.pages.manorsiegepage.instance&&app.pages.manorsiegepage.instance.refreshUI(),e.onQuickFightWin(t.nowhp)})},target:this};app.pages.windowspagetipsmsg.showPage(i)}else app.showNotice(langMgr.getString("manorBossPage",1))},onTeamFight:function(){app.pages.manorteampage.showPage({iconid:n(this.m_objEnemyData.boss.bset).gsid,headid:n(this.m_objEnemyData.boss.bset).headid,frameid:n(this.m_objEnemyData.boss.bset).frameid,level:n(this.m_objEnemyData.boss.bset).level})},onFight:function(){app.player.getCountEnough(a)?(this.m_objParam.index,app.manorboss="boss",app.manorIndex=null,app.goToBossBattle("manor",this.m_objEnemyData.boss)):app.showNotice(langMgr.getString("manorBossPage",2))},onQuickFightWin:function(e){this.m_objParam.target.changeBossState(e)},afterBattleFresh:function(){switch(app.battleOverType){case"manor":"boss"==app.manorboss&&this.getBossInfo()}},getBossInfo:function(){var e=this;app.player.sfGetManorEnemyInfo({},function(t,a){t||(e.onQuickFightWin(a.boss.nowhp),e.m_objEnemyData=a,e.m_objParam.damge=a.boss.lastdamage,e.refreshUI(),app.pages.manorsiegepage.instance&&app.pages.manorsiegepage.instance.node.active&&(app.pages.manorsiegepage.instance.m_objData.boss=a.boss,app.pages.manorsiegepage.instance.refreshHay()))})}});function n(e){for(var t in e)return e[t]}i.showPage=function(t,a,i){var n=this,r={};void 0!==t.index&&(r={index:t.index}),app.player.sfGetManorEnemyInfo(r,function(r,o){r||e("basePage").showPage.apply(n,[{data:o,objParam:t},a,i])})},cc._RF.pop()},{basePage:void 0}],manorBuildInfoPage:[function(e,t){"use strict";cc._RF.push(t,"e7fb1RU7JlEeIqlFEXbD9hD","manorBuildInfoPage");var a=e("dbProperty"),i=cc.Class({extends:e("basePage"),statics:{prefabPath:"manorbuildinfopage"},properties:{p_sprHouse:cc.Sprite,p_labHouse:cc.Label,p_arrNodeInfo:[cc.Node]},onLoad:function(){i.instance=this,this.stopBgNodeEvent(),this.creatMask(!0)},setParam:function(e){this.m_type=e,this.refreshUI()},refreshUI:function(){var e=this,t=this.m_type,a=gConfig.getManorBuildingIconPath(t);app.loadTexture(a,this.p_sprHouse,this.prefabPath);var i=app.db.getManorBuildingInfo(t);this.p_labHouse.string=i.NAME,this.p_arrNodeInfo.forEach(function(a,i){var n=e.getShowProperty(t,i,1);n?(a.active=!0,a.string=n.intro+n.num,a.getChildByName("lab_intro").getComponent(cc.Label).string=n.intro,a.getChildByName("lab_num").getComponent(cc.Label).string=n.num):a.active=!1}),this.p_sprHouse.node.scale=2!=i.TYPE?.65:.75},getShowProperty:function(e,t,i){var n=null,r=0,o=app.db.getManorBuildingInfo(e).INFO[i];if(o){var s=o.RES?o.RES[0]:null,p=o.ATT?o.ATT[0]:null;switch(t){case 0:if(s)n=app.db.getPropsName(s.ID)+"\u4ea7\u51fa\u6570\u91cf/\u5929: ",r=24/(s.TIME/60/60)*s.COUNT,r=38007==s.ID?Math.floor(100*r)/100:gUtils.showNum(Math.floor(r));else if(p){var c=p.ID,h=p.NUM;n="mout"==c?"\u5c01\u5730\u4ea7\u51fa\u52a0\u6210: ":a[c].NAME+" + ",r=h/10+"%"}break;case 1:s&&(n="\u5355\u6b21\u4ea7\u51fa\u6570\u91cf: ",r=s.COUNT);break;case 2:s&&(n="\u8d44\u6e90\u7d2f\u79ef\u4e0a\u9650: ",r=gUtils.showNum(s.MAX))}if(n)return{intro:n,num:r}}}});cc._RF.pop()},{basePage:void 0,dbProperty:void 0}],manorBuildPage:[function(e,t){"use strict";cc._RF.push(t,"e6ba4ZN3QNBZ4zB+VXz7JHp","manorBuildPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"manorbuildpage"},properties:{p_nodeBuildItem:cc.Node,p_arrCostNode:[cc.Node],p_btnBuild:cc.Button},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){var e=this;this._super(),this.p_btnBuild.node.on("click",function(){app.playSound("click"),e.onBuild()})},setParam:function(e){this.m_chosseId=null,this.m_numPos=e.index,this.m_buildCb=e.onBuild,this.refreshUI(),this.refreshLevelUI()},refreshUI:function(){var e=app.pages.manorpage.instance.m_objData,t=e.list,a=e.manorlv,i=app.db.getManorInfo(a).POS[this.m_numPos];this.m_arrBuild=this.m_arrBuild||[this.p_nodeBuildItem];for(var n=0;n<i.length;++n){var r=this.m_arrBuild[n];r||((r=cc.instantiate(this.p_nodeBuildItem)).parent=this.p_nodeBuildItem.parent,this.m_arrBuild.push(r));var o=i[n],s=0;for(var p in t)t[p].id==o&&s++;r.getComponent("manorBuildInfoItem").initSelf(o,s,this,this.m_chosseId),r.active=!0}for(var c=this.m_arrBuild.length;c<i.length;++c)this.m_arrBuild[c].active=!1},refreshLevelUI:function(){var e=this,t=this.m_chosseId;this.p_btnBuild.node.active=!!t,this.p_arrCostNode[0].parent.active=!!t,t&&(this.m_arrCost=app.db.getManorBuildingInfo(t).INFO[0].COST,this.p_arrCostNode.forEach(function(t,a){var i=e.m_arrCost[a];if(t.active=!!i,i){var n=i.GSID,r=i.COUNT,o=t.getChildByName("icon").getComponent(cc.Sprite);t.getChildByName("num").getComponent(cc.Label).string=gUtils.showNum(r);var s=app.db.getPropsIconPath(n);app.loadTexture(s,o,e.prefabPath)}}))},chooseBuild:function(e){this.m_chosseId=e,this.refreshLevelUI(),this.refreshUI()},onBuild:function(){for(var e=this,t=0;t<this.m_arrCost.length;++t){var a=this.m_arrCost[t];if(app.player.getCount(a.GSID)<a.COUNT)return void app.showNotice(langMgr.getString("manorBuildPage",0))}app.player.sfManorBuild({pos:this.m_numPos,bid:this.m_chosseId},function(){app.player.reduceItem(e.m_arrCost),app.player.sfPlayerData(),e.onClose(),e.m_buildCb(e.m_chosseId)})}});cc._RF.pop()},{basePage:void 0}],manorEnemyPage:[function(e,t){"use strict";cc._RF.push(t,"16372uEoqhFFqkP1G1lh7yD","manorEnemyPage");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=this&&this.__awaiter||function(e,t,a,i){return new(a||(a=Promise))(function(n,r){function o(e){try{p(i.next(e))}catch(t){r(t)}}function s(e){try{p(i.throw(e))}catch(t){r(t)}}function p(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(o,s)}p((i=i.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var a,i,n,r,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(e){return function(t){return p([e,t])}}function p(r){if(a)throw new TypeError("Generator is already executing.");for(;o;)try{if(a=1,i&&(n=2&r[0]?i.return:r[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,r[1])).done)return n;switch(i=0,n&&(r=[2&r[0],n.value]),r[0]){case 0:case 1:n=r;break;case 4:return o.label++,{value:r[1],done:!1};case 5:o.label++,i=r[1],r=[0];continue;case 7:r=o.ops.pop(),o.trys.pop();continue;default:if(!(n=(n=o.trys).length>0&&n[n.length-1])&&(6===r[0]||2===r[0])){o=0;continue}if(3===r[0]&&(!n||r[1]>n[0]&&r[1]<n[3])){o.label=r[1];break}if(6===r[0]&&o.label<n[1]){o.label=n[1],n=r;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(r);break}n[2]&&o.ops.pop(),o.trys.pop();continue}r=t.call(e,o)}catch(s){r=[6,s],i=0}finally{a=n=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}},s=cc._decorator,p=s.ccclass,c=s.property,h=e("basePage"),l=e("../model/manorSiegeModel"),g={gsid:38007,count:1},d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_labfood=null,t.p_nodeEnemy=null,t.p_pfbEnemy=null,t.p_nodeLayout=null,t.p_pfbRewardItem=null,t.p_btnFight=null,t.p_spCostArr=[],t.p_nodeBossPortrait=null,t.p_progBossHP=null,t.p_labBossHP=null,t.p_btnQuickFight=null,t.p_btnTeamFight=null,t.p_btnBossFight=null,t.p_sprGeneral=null,t.p_spGeneral=null,t.p_animGeneral=null,t.p_labTeamFight=null,t.p_nodeEnemyArr=[],t.p_nodeBossArr=[],t.p_nodeMask=null,t.p_skeFighting=null,t.p_sprTitleArr=[],t.m_target=null,t.m_arrItems=[],t.m_arrIconReward=[],t.m_isBoss=!1,t}var a;return i(t,e),a=t,t.prototype.onEnable=function(){eventMgr.on(eventStr.ManorSiegePage.BattleFinish,this.battleFinish,this)},t.prototype.onDisable=function(){eventMgr.off(eventStr.ManorSiegePage.BattleFinish,this.battleFinish,this)},t.prototype.onLoad=function(){var e=this;a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.p_spCostArr.forEach(function(t){cc.isValid(t)&&app.loadTexture(gConfig.getCurrencyIconPath(""+g.gsid),t,e.prefabPath)})},t.prototype.handleUI=function(){e.prototype.handleUI.call(this),this.p_btnFight.node.on("click",this.onEnemyFight.bind(this)),this.p_btnQuickFight.node.on("click",this.onQuickFight.bind(this)),this.p_btnTeamFight.node.on("click",this.onTeamFight.bind(this)),this.p_btnBossFight.node.on("click",this.onBossFight.bind(this)),this.p_skeFighting.setCompleteListener(this.sweepRequest.bind(this))},t.prototype.setParam=function(e){app.manorboss=null,this.m_modelData=new l.ManorBattleSetModel(e.data),this.m_objParam=e.objParam,this.m_target=e.objParam.target,this.m_isBoss=!("index"in e.objParam),this.p_bgNode.height=this.m_isBoss?900:800,this.refreshUI()},t.prototype.refreshUI=function(){this.refreshGrain(),this.refreshShowNode(),this.refreshReward()},t.prototype.refreshShowNode=function(){var e=this;this.p_bgNode.getChildByName("ImgTitle").getComponent(cc.Sprite).spriteFrame=this.m_isBoss?this.p_sprTitleArr[1]:this.p_sprTitleArr[0],this.p_nodeEnemyArr.forEach(function(t){return cc.isValid(t)&&(t.active=!e.m_isBoss)}),this.p_nodeBossArr.forEach(function(t){return cc.isValid(t)&&(t.active=e.m_isBoss)}),!this.m_isBoss&&this.refreshEnemy(),this.m_isBoss&&this.refreshBoss(),this.m_isBoss&&this.refreshBtn()},t.prototype.refreshGrain=function(){var e=app.db.getManorConfig().FOOD_MAX,t=app.player.getCount(g.gsid);this.p_labfood.string=t+"/"+e},t.prototype.refreshEnemy=function(){var e=this;this.m_arrItems.forEach(function(e){return cc.isValid(e)&&(e.active=!1)}),Object.keys(this.m_modelData.enemy).forEach(function(t,a){var i=e.m_arrItems[a];i||((i=cc.instantiate(e.p_pfbEnemy)).parent=e.p_nodeEnemy,e.m_arrItems.push(i)),i.active=!0,i.getComponent("generalPortraitItem").refreshForAncient(e.m_modelData.enemy[t])})},t.prototype.refreshBoss=function(){var e=this.getObjFirst(this.m_modelData.boss.bset);app.loadGeneral(e.gsid,this.p_sprGeneral,this.p_spGeneral,this.p_animGeneral,null,this.prefabPath),this.p_progBossHP.progress=this.m_modelData.boss.nowhp/this.m_modelData.boss.maxhp,this.p_labBossHP.string=Math.ceil(this.m_modelData.boss.nowhp/this.m_modelData.boss.maxhp*100)+"%"},t.prototype.refreshBtn=function(){var e=0==this.m_modelData.boss.nowhp,t=app.db.getManorConfig();this.p_btnQuickFight.node.active=!!this.m_modelData.boss.lastdamage,this.p_btnQuickFight.interactable=!e,this.p_btnBossFight.interactable=!e;var a=app.player.getCount(90365);this.p_labTeamFight.string=t.FRIEND_BOSS_HELP-a+"/"+t.FRIEND_BOSS_HELP,this.p_btnTeamFight.interactable=t.FRIEND_BOSS_HELP-a>0&&!e},t.prototype.refreshReward=function(){var e=this,t=this.m_isBoss?app.db.getManorBossReward(this.m_objParam.lv):app.db.getManorEnemyRewardV2(this.m_objParam.enemyData.id);this.m_arrIconReward.forEach(function(e){return cc.isValid(e)&&(e.active=!1)}),t.forEach(function(t,a){var i=e.m_arrIconReward[a];i||((i=cc.instantiate(e.p_pfbRewardItem)).parent=e.p_nodeLayout,e.m_arrIconReward.push(i)),i.active=!0,i.getComponent("propItem").initForBag(t),i.getComponent("propItem").setClick(!0)})},t.prototype.onEnemyFight=function(){if(app.playSound("click"),app.player.getCountEnough(g)){var e=this.m_objParam.index;app.manorboss=e,app.battleType="manor",app.manorIndex=e,app.battleConfig=this.m_modelData.enemy,app.goToNormBattle()}else app.showNotice(langMgr.getString("manorNormalEnemyPage",1))},t.prototype.onBossFight=function(){app.playSound("click"),app.player.getCountEnough(g)?(app.manorboss="boss",app.manorIndex=null,app.goToBossBattle("manor",this.m_modelData.boss)):app.showNotice(langMgr.getString("manorBossPage",2))},t.prototype.onQuickFight=function(){var e=this;if(app.playSound("click"),app.player.getCountEnough(g)){var t=gUtils.showNum(this.m_modelData.boss.lastdamage),a={content:langMgr.getString("manorBossPage",3,t),confirmcb:function(){e.sweepRequest()},target:this};app.pages.windowspagetipsmsg.showPage(a)}else app.showNotice(langMgr.getString("manorBossPage",1))},t.prototype.sweepRequest=function(){var e=this;this.p_nodeMask.active=!1,app.player.sfManorMop({times:1},function(t){app.player.reduceItem(g),app.player.addItem(t.reward),app.pages.windowspagereward.showPage({reward:t.reward,showtype:1,confirmcb:function(){3==t.kill?app.player.sfPlayerByParam(["others","hide","props"],function(){e.m_target.killBoss(),e.m_target.getFieldInfo(),eventMgr.emit(eventStr.ManorSiegePage.RefreshRed),e.onClose()}):(t.nowhp=t.nowhp<=0?0:t.nowhp,e.m_modelData.setBossNowHp(t.nowhp),e.refreshGrain(),e.m_target.refreshGrain(),e.refreshBoss(),e.refreshBtn(),e.m_target.getFieldInfo(),eventMgr.emit(eventStr.ManorSiegePage.RefreshRed))},target:e})})},t.prototype.onTeamFight=function(){app.playSound("click"),app.pages.manorteampage.showPage({iconid:this.getObjFirst(this.m_modelData.boss.bset).gsid,headid:this.getObjFirst(this.m_modelData.boss.bset).headid,frameid:this.getObjFirst(this.m_modelData.boss.bset).frameid,level:this.getObjFirst(this.m_modelData.boss.bset).level})},t.prototype.reduceInvitecount=function(){this.m_objParam.bossInfo.invitecount--,this.refreshBtn()},t.prototype.getObjFirst=function(e){for(var t in e)return e[t]},t.prototype.battleFinish=function(e){this.getBattleSetInfo(e)},t.prototype.getBattleSetInfo=function(e){return r(this,void 0,Promise,function(){var t,i;return o(this,function(n){switch(n.label){case 0:return cc.isValid(this.node)?e?(this.m_isBoss?this.m_target.killBoss():this.m_target.killEnemy(this.m_objParam.index),this.m_target.refreshGrain(),eventMgr.emit(eventStr.ManorSiegePage.RefreshRed),this.onClose(),[3,3]):[3,1]:[2];case 1:return this.refreshGrain(),this.m_target.refreshGrain(),this.m_isBoss?(t=this.m_isBoss?{}:{index:this.m_objParam.index},[4,a.getServerData(t)]):[3,3];case 2:i=n.sent(),this.m_modelData=new l.ManorBattleSetModel(i),this.refreshBoss(),this.refreshBtn(),this.m_target.getFieldInfo(),n.label=3;case 3:return[2]}})})},t.prefabPath="manorenemypage",t.pageType=1,n([c(cc.Label)],t.prototype,"p_labfood",void 0),n([c(cc.Node)],t.prototype,"p_nodeEnemy",void 0),n([c(cc.Prefab)],t.prototype,"p_pfbEnemy",void 0),n([c(cc.Node)],t.prototype,"p_nodeLayout",void 0),n([c(cc.Prefab)],t.prototype,"p_pfbRewardItem",void 0),n([c(cc.Button)],t.prototype,"p_btnFight",void 0),n([c([cc.Sprite])],t.prototype,"p_spCostArr",void 0),n([c(cc.Node)],t.prototype,"p_nodeBossPortrait",void 0),n([c(cc.ProgressBar)],t.prototype,"p_progBossHP",void 0),n([c(cc.Label)],t.prototype,"p_labBossHP",void 0),n([c(cc.Button)],t.prototype,"p_btnQuickFight",void 0),n([c(cc.Button)],t.prototype,"p_btnTeamFight",void 0),n([c(cc.Button)],t.prototype,"p_btnBossFight",void 0),n([c(cc.Sprite)],t.prototype,"p_sprGeneral",void 0),n([c(sp.Skeleton)],t.prototype,"p_spGeneral",void 0),n([c(cc.Animation)],t.prototype,"p_animGeneral",void 0),n([c(cc.Label)],t.prototype,"p_labTeamFight",void 0),n([c([cc.Node])],t.prototype,"p_nodeEnemyArr",void 0),n([c([cc.Node])],t.prototype,"p_nodeBossArr",void 0),n([c(cc.Node)],t.prototype,"p_nodeMask",void 0),n([c(sp.Skeleton)],t.prototype,"p_skeFighting",void 0),n([c([cc.SpriteFrame])],t.prototype,"p_sprTitleArr",void 0),a=n([p],t)}(h);d.getServerData=function(e){return new Promise(function(t,a){app.player.sfGetManorEnemyInfo(e,function(e,i){e&&a(),t(i)})})},d.showPage=function(t,a,i){var n="undefined"==t.index?{}:{index:t.index};d.getServerData(n).then(function(n){e("basePage").showPage.call(d,{data:n,objParam:t},a,i)})},t.exports=d,cc._RF.pop()},{"../model/manorSiegeModel":void 0,basePage:void 0}],manorFuyaPage:[function(e,t){"use strict";cc._RF.push(t,"b3d1dph24lPtaU035l9kouE","manorFuyaPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"manorfuyapage",pageType:1},properties:{p_btnLevelUp:cc.Button,p_arrLabelInfo:[cc.Label],p_arrLabLvUpCurrent:[cc.Label],p_arrLabLvUpNeed:[cc.Label],p_arrSprCost:[cc.Sprite],p_nodeCostInfo:cc.Node,p_animLevel:cc.Animation,p_labelLevel:cc.Label,p_infoArrItem:[cc.Node],p_labelLock:cc.RichText,p_labelMaxLv:cc.Label,p_skeLvUpAnim:sp.Skeleton},onLoad:function(){a.instance=this,this.m_homeProperty=[langMgr.getString("manorFuyaPage",0),langMgr.getString("manorFuyaPage",3)],this.m_colorCost=this.p_arrLabLvUpNeed[0].node.color.clone(),this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){var e=this;this._super(),this.p_btnLevelUp.node.on("click",function(){app.playSound("click"),e.onLevelUp()}),this.p_skeLvUpAnim.setCompleteListener(function(){e.p_skeLvUpAnim.node.active=!1}),this.p_infoArrItem.forEach(function(e){var t=e.getChildByName("anim");cc.isValid(t)&&t.getComponent(sp.Skeleton).setCompleteListener(function(){t.active=!1})})},setParam:function(e){this.m_objHouse=e,this.refreshUI()},refreshUI:function(){var e=this.m_objHouse.id,t=this.m_objHouse.lv,a=app.db.getManorBuildingInfo(e).INFO[t];this._isMaxLv=0==a.COST[0].COUNT,this.p_labelMaxLv.node.active=this._isMaxLv,this.refreshInfo(),this.refreshCost(a)},getShowProperty:function(e,t,a){var i,n=0;if(app.pages.manorpage.getMout(app.pages.manorpage.instance.m_objData.list),app.db.getManorInfo(a)){i=this.m_homeProperty[t]+": ";var r="";switch(t){case 0:this._isMaxLv?r=langMgr.getString("manorPage",10):(n=a,r=""+a+langMgr.getString("public",26));break;case 1:break;case 2:r=i+(n=app.db.getManorConfig().FOOD_MAX)}return{intro:i,num:n,desc:r}}},refreshInfo:function(){var e=this,t=this.m_objHouse.id,a=this.m_objHouse.lv,i=app.db.getManorInfo(a),n=app.db.getManorInfo(a+1);this.p_arrLabelInfo.forEach(function(i,n){var r=e.getShowProperty(t,n,a);r?(i.active=!0,i.string=r.desc):i.active=!1}),this.p_infoArrItem.forEach(function(t,a){var r=t.getChildByName("num"),o=t.getChildByName("next_num");if(t.getChildByName("max").active=e._isMaxLv,0==a)r.getComponent(cc.Label).string=i.UPMAX,o.active=!e._isMaxLv,n&&(o.getComponent(cc.Label).string="\u4e0b\u4e00\u7ea7: "+n.UPMAX);else if(1==a||2==a||3==a){var s=[null,"2","3","4"][a],p=1==a?"COUNT":"TIME",c=app.db.getManorBuildingInfo(s).INFO,h=i.BUILDING[s];if(h){t.active=!0;var l=c[h].RES[0][p],g=c[1].RES[0][p];if(r.getComponent(cc.Label).string=Math.abs((l-g)/g*100).toFixed(1)+"%",o.active=n&&!e._isMaxLv,n){var d=c[n.BUILDING[s]].RES[0][p],u=Math.abs((d-g)/g*100).toFixed(1)+"%";o.getComponent(cc.Label).string="\u4e0b\u4e00\u7ea7: "+u}}else t.active=!1}}),this.p_infoArrItem[2].active=!1,n&&app.player.getCount(97054)<n.MIN_LV-1&&(this.p_labelLock.string=langMgr.getString("manorPage",13,n.MIN_LV))},refreshCost:function(e){this.m_objHouse.id;var t=this.m_objHouse.lv;cc.log(e);var a=!e.COST[0].COUNT&&0==e.COST[0].COUNT,i=!0;if(!a)for(var n=0;n<this.p_arrLabLvUpCurrent.length;++n){var r=e.COST[n].COUNT,o=app.player.getCount(e.COST[n].GSID);this.p_arrLabLvUpCurrent[n].string=gUtils.showNum(o),this.p_arrLabLvUpNeed[n].string="/ "+gUtils.showNum(r),o>=r?this.p_arrLabLvUpCurrent[n].node.color=this.m_colorCost:(this.p_arrLabLvUpCurrent[n].node.color=cc.Color.RED,i=!1);var s=gConfig.getCurrencyIconPath(e.COST[n].GSID);app.loadTexture(s,this.p_arrSprCost[n],this.prefabPath)}this.p_nodeCostInfo.active=!a,this.p_btnLevelUp.node.active=!a;var p=app.db.getManorInfo(t+1),c=i&&!this._isMaxLv&&p&&app.player.getCount(97054)>=p.MIN_LV-1;this.p_btnLevelUp.interactable=c,this.p_labelLock.node.active=!this._isMaxLv&&p&&app.player.getCount(97054)<p.MIN_LV-1,app.setNodeState(this.p_btnLevelUp.node,!c)},onLevelUp:function(){var e=this,t=this.m_objHouse.id,a=this.m_objHouse.lv,i=app.db.getManorBuildingInfo(t).INFO[a].COST;app.player.sfManorBuild({bid:t},function(){app.player.sfPlayerByParam(["others","props"],function(){e.p_skeLvUpAnim.node.active=!0,e.p_skeLvUpAnim.setAnimation(0,"animation",!1),app.player.reduceItem(i),cc.isValid(e)&&(e.m_objHouse.lv++,e.m_objHouse.target.onLevel(t),e.refreshUI(),e.p_infoArrItem.forEach(function(e){var t=e.getChildByName("anim");cc.isValid(t)&&(t.active=!0,t.getComponent(sp.Skeleton).setAnimation(0,"shengji01",!1))}),e.playUpAnim())})})},playUpAnim:function(){app.loadEff("shengji_01",this.p_animLevel,1,1)},onClose:function(){app.player.sfPlayerData(),this._super()}});cc._RF.pop()},{basePage:void 0}],manorGrainPage:[function(e,t){"use strict";cc._RF.push(t,"83b12heEQNBjpaZ4aE2T7Jx","manorGrainPage");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=cc._decorator,o=r.ccclass,s=r.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_nodeGrainOne=null,t.p_nodeGrainTwo=null,t.p_btnReceiveOne=null,t.p_btnReceiveTwo=null,t.p_pfbPropItem=null,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,this.stopBgNodeEvent(),this.handleUI()},t.prototype.handleUI=function(){var t=this;e.prototype.handleUI.call(this),this.p_btnReceiveOne.node.on("click",function(){return t.receiveClickHandle(1)}),this.p_btnReceiveTwo.node.on("click",function(){return t.receiveClickHandle(2)})},t.prototype.setParam=function(){this.refreshUI(),this.refreshBtn()},t.prototype.refreshUI=function(){var e=app.db.getManorConfig();if(!(e.REFRESH_TIMES.length<2)){var t=a.getRefreshData();this.p_nodeGrainOne.getChildByName("time").getComponent(cc.Label).string=t[0].f+":00:00 - "+t[0].t+":00:00",this.p_nodeGrainTwo.getChildByName("time").getComponent(cc.Label).string=t[1].f+":00:00 - "+t[1].t+":00:00";var i=this.p_nodeGrainOne.getChildByName("prop");i.children.length||((n=cc.instantiate(this.p_pfbPropItem)).parent=i,n.getComponent("propItem").initForBag({gsid:a.grainGsid,count:e.FRESH_COUNT}),n.getComponent("propItem").setClick(!0));var n,r=this.p_nodeGrainTwo.getChildByName("prop");r.children.length||((n=cc.instantiate(this.p_pfbPropItem)).parent=r,n.getComponent("propItem").initForBag({gsid:a.grainGsid,count:e.FRESH_COUNT}),n.getComponent("propItem").setClick(!0))}},t.prototype.refreshBtn=function(){var e=a.getRefreshData();this.p_btnReceiveOne.interactable=e[0].ok,this.p_btnReceiveTwo.interactable=e[1].ok,this.p_btnReceiveOne.node.getChildByName("received").active=app.player.getCount(97051)>0,this.p_btnReceiveOne.node.getChildByName("can_receive").active=0==app.player.getCount(97051),this.p_btnReceiveTwo.node.getChildByName("received").active=app.player.getCount(97052)>0,this.p_btnReceiveTwo.node.getChildByName("can_receive").active=0==app.player.getCount(97052)},t.prototype.receiveClickHandle=function(){app.playSound("click")},t.getRefreshData=function(){var e=app.db.getManorConfig(),t=(new Date).getHours(),a=e.REFRESH_TIMES[0],i=e.REFRESH_TIMES[0]+e.CONTINUE_HOUR,n=e.REFRESH_TIMES[1],r=e.REFRESH_TIMES[1]+e.CONTINUE_HOUR;return[{f:a,t:i,ok:t>=a&&t<i&&0==app.player.getCount(97051)},{f:n,t:r,ok:t>=n&&t<r&&0==app.player.getCount(97052)}]},t.refreshRed=function(){return this.getRefreshData().some(function(e){return e.ok})},t.prefabPath="manorgrainpage",t.pageType=1,t.grainGsid=38007,n([s(cc.Node)],t.prototype,"p_nodeGrainOne",void 0),n([s(cc.Node)],t.prototype,"p_nodeGrainTwo",void 0),n([s(cc.Button)],t.prototype,"p_btnReceiveOne",void 0),n([s(cc.Button)],t.prototype,"p_btnReceiveTwo",void 0),n([s(cc.Prefab)],t.prototype,"p_pfbPropItem",void 0),a=n([o],t)}(e("basePage"));t.exports=p,cc._RF.pop()},{basePage:void 0}],manorHousePage:[function(e,t){"use strict";cc._RF.push(t,"68924XqqOBKjaJon/YwX6i5","manorHousePage");var a=e("dbProperty"),i=["\u7b49\u7ea7","\u8d44\u6e90\u5efa\u7b51","\u529f\u80fd\u5efa\u7b51","\u5c71\u8d3c\u8425\u5730","\u7cae\u8349\u4e0a\u9650"],n=cc.Class({extends:e("basePage"),statics:{prefabPath:"manorhousepage"},properties:{p_sprTitle:cc.Sprite,p_arrTitleSpriteF:[cc.SpriteFrame],p_sprHouse:cc.Sprite,p_nodeRes:cc.Node,p_progRes:cc.ProgressBar,p_sprRes:cc.Sprite,p_labRes:cc.Label,p_btnResGet:cc.Button,p_arrNodeInfo:[cc.Node],p_nodeCost:cc.Node,p_arrSprCost:[cc.Sprite],p_arrLabCost:[cc.Label],p_nodeLvNoEnough:cc.Node,p_nodeLvMaxLab:cc.Node,p_btnDismantle:cc.Button,p_btnLevelUp:cc.Button,p_animLevel:cc.Animation},onLoad:function(){n.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){var e=this;this.p_btnLevelUp.node.on("click",function(){app.playSound("click"),e.onLevelUp()}),this.p_btnDismantle.node.on("click",function(){app.playSound("click")}),this.p_btnResGet.node.on("click",function(){app.playSound("click"),e.onResGet()})},setParam:function(){},refreshUI:function(){var e=this.m_objHouse.id,t=this.m_objHouse.lv,a=app.db.getManorBuildingInfo(e).INFO[t];this.p_sprTitle.spriteFrame=this.p_arrTitleSpriteF[e-1];var i=gConfig.getManorBuildingIconPath(e);app.loadTexture(i,this.p_sprHouse,this.prefabPath),this.refreshRes(a),this.refreshInfo(),this.refreshCost(a)},refreshRes:function(e){var t=e.RES?e.RES[0]:null;if(t){this.p_nodeRes.active=!0;var a=app.db.getPropsIconPath(t.ID);app.loadTexture(a,this.p_sprRes,this.prefabPath);var i=0;this.m_objHouse.items.length>0&&this.m_objHouse.items[0].count>0?(this.p_btnResGet.interactable=!0,i=this.m_objHouse.items[0].count):this.p_btnResGet.interactable=!1;var n=t.MAX;this.p_progRes.progress=i/n,this.p_labRes.string=i+"/"+n}else this.p_nodeRes.active=!1},getShowProperty:function(e,t,n){var r=null,o=0,s=app.pages.manorpage.getMout(app.pages.manorpage.instance.m_objData.list);if(1==e){var p=app.db.getManorInfo(n);if(!p)return;switch(r=i[t]+": ",t){case 0:o=n;break;case 1:for(var c in p.POS)gConfig.getManorBuildType(c)||o++;break;case 2:var h=p.POS;for(var l in h)gConfig.getManorBuildType(l)&&o++;break;case 3:o=p.COUNT;break;case 4:o=app.db.getManorConfig().FOOD_MAX;break;case 5:o=p.UPMAX}}else{var g=app.db.getManorBuildingInfo(e).INFO[n];if(!g)return;var d=g.RES?g.RES[0]:null,u=g.ATT?g.ATT[0]:null;switch(t){case 0:r="\u7b49\u7ea7: ",o=n;break;case 1:if(d)r=app.db.getPropsName(d.ID)+"\u4ea7\u51fa\u6570\u91cf/\u5929: ",o=24/(d.TIME/60/60)*d.COUNT*s,o=38007==d.ID?Math.floor(100*o)/100:gUtils.showNum(Math.floor(o));else if(u){var f=u.ID,m=u.NUM;r="mout"==f?"\u5c01\u5730\u4ea7\u51fa\u52a0\u6210":"\u6b66\u5c06"+a[f].NAME+"\u589e\u52a0",r+=": ",o=m/10+"%"}break;case 2:d&&(r="\u5355\u6b21\u4ea7\u51fa\u6570\u91cf: ",o=d.COUNT);break;case 3:d&&(r="\u8d44\u6e90\u7d2f\u79ef\u4e0a\u9650: ",o=gUtils.showNum(d.MAX))}if(!r)return}return{intro:r,num:o}},refreshInfo:function(){var e=this,t=this.m_objHouse.id,a=this.m_objHouse.lv;this.p_arrNodeInfo.forEach(function(i,n){var r=e.getShowProperty(t,n,a);if(r){i.active=!0;var o=i.getChildByName("now"),s=i.getChildByName("next"),p=o.getChildByName("tx").getComponent(cc.Label),c=o.getChildByName("num_now").getComponent(cc.Label);p.string=r.intro,c.string=r.num;var h=e.getShowProperty(t,n,a+1);h?(s.getChildByName("num_next").getComponent(cc.Label).string=h.num,s.active=!0):s.active=!1}else i.active=!1})},refreshCost:function(e){var t=this.m_objHouse.id,a=this.m_objHouse.lv,i=!e.COST,n=!0;if(!i)for(var r=0;r<this.p_arrLabCost.length;++r){var o=e.COST[r].COUNT,s=app.player.getCount(e.COST[r].GSID);this.p_arrLabCost[r].string=gUtils.showNum(s)+"/"+gUtils.showNum(o),s>=o?this.p_arrLabCost[r].node.color=this.m_colorCost:(this.p_arrLabCost[r].node.color=cc.Color.RED,n=!1);var p=app.db.getPropsIconPath(e.COST[r].GSID);app.loadTexture(p,this.p_arrSprCost[r],this.prefabPath)}this.p_nodeCost.active=!i,this.p_nodeLvMaxLab.active=i,this.p_btnLevelUp.node.active=!i;var c=app.pages.manorpage.instance.m_objData.manorlv,h=app.db.getManorInfo(c).UPMAX;h&&a>=h?(this.p_nodeLvNoEnough.active=!0,n=!1):this.p_nodeLvNoEnough.active=!1,this.p_btnLevelUp.interactable=n,this.p_btnDismantle.node.active=t>1},onLevelUp:function(){var e=this,t=this.m_objHouse.id,a=this.m_objHouse.lv,i=app.db.getManorBuildingInfo(t).INFO[a].COST;app.player.sfManorBuild({id:t},function(){app.player.reduceItem(i),e.m_objHouse.lv++,e.m_objHouse.target.onLevel(t),e.refreshUI(),e.playUpAnim()})},onDismantle:function(){var e=this,t=app.db.getManorBuildingMax(this.m_objHouse.id).NAME,a={content:langMgr.getString("manorHousePage",0,[t,this.m_objHouse.lv]),confirmcb:function(){app.player.sfManorReset({pos:e.m_objHouse.pos},function(t){e.onClose(),app.player.addItem(t.items);var a={reward:t.items,showtype:1};app.pages.windowspagereward.showPage(a),e.m_objHouse.target.onReset()})}};app.pages.windowspagetipsmsg.showPage(a)},onResGet:function(){var e=this;app.player.sfGetManorReward({id:this.m_objHouse.id},function(t){app.player.addItem(t.items);var a={reward:t.items,showtype:1};app.pages.windowspagereward.showPage(a),e.m_objHouse.items=[],e.m_objHouse.target.getRewardEnd(),e.refreshUI()})},playUpAnim:function(){app.loadEff("shengji_01",this.p_animLevel,1,1)},onClose:function(){app.player.sfPlayerData(),this._super()}});cc._RF.pop()},{basePage:void 0,dbProperty:void 0}],manorMilitaryBuildingPage:[function(e,t){"use strict";cc._RF.push(t,"908d85iBvlLpIjLe/GT2its","manorMilitaryBuildingPage");var a=e("dbProperty"),i=cc.Class({extends:e("basePage"),statics:{prefabPath:"manormilitarybuildingpage",pageType:1},properties:{p_btnLevelUp:cc.Button,p_sprHouse:cc.Sprite,p_arrLabelInfo:[cc.Label],p_arrSprLvUpIcon:[cc.Sprite],p_arrLabLvUpCurrent:[cc.Label],p_arrLabLvUpNeed:[cc.Label],p_nodeCostInfo:cc.Node,p_labelLvNoEnough:cc.Label,p_animLevel:cc.Animation,p_arrTitleFrame:[cc.SpriteFrame],p_spTitle:cc.Sprite,p_labelMaxLv:cc.Label,p_infoArrItem:[cc.Node],p_skeLvUpAnim:sp.Skeleton},onLoad:function(){i.instance=this,this.m_colorCost=this.p_arrLabLvUpNeed[0].node.color.clone(),this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){var e=this;this._super(),this.p_btnLevelUp.node.on("click",function(){app.playSound("click"),e.onLevelUp()}),this.p_skeLvUpAnim.setCompleteListener(function(){e.p_skeLvUpAnim.node.active=!1}),this.p_infoArrItem.forEach(function(e){var t=e.getChildByName("anim");cc.isValid(t)&&t.getComponent(sp.Skeleton).setCompleteListener(function(){t.active=!1})})},setParam:function(e){this.m_objHouse=e,this.refreshUI()},refreshUI:function(){var e=this.m_objHouse.id,t=this.m_objHouse.lv,a=app.db.getManorBuildingInfo(e),i=a.INFO[t];cc.log(i),this.p_spTitle.spriteFrame=this.p_arrTitleFrame[e-6];var n=gConfig.getManorBuildingIconPath(e);app.loadTexture(n,this.p_sprHouse,this.prefabPath),this._isMaxLv=t>=a.INFO.length-1,this.p_labelMaxLv.node.active=this._isMaxLv,this.refreshInfo(),this.refreshCost(i)},getShowProperty:function(e,t,i){var n=null,r=0,o="",s=app.pages.manorpage.getMout(app.pages.manorpage.instance.m_objData.list),p=app.db.getManorBuildingInfo(e).INFO[i];if(p){var c=p.RES?p.RES[0]:null,h=p.ATT?p.ATT[0]:null;switch(t){case 0:n=langMgr.getString("manorMilitaryBuildingPage",1),r=i,o=this._isMaxLv?langMgr.getString("manorPage",10):langMgr.getString("manorMilitaryBuildingPage",2,i);break;case 1:if(c){var l=app.db.getPropsName(c.ID);n=langMgr.getString("manorMilitaryBuildingPage",3,l),r=24/(c.TIME/60/60)*c.COUNT*s,o=r=38007==c.ID?Math.floor(100*r)/100:gUtils.showNum(Math.floor(r))}else if(h){var g=h.ID,d=h.NUM;n="mout"==g?langMgr.getString("manorMilitaryBuildingPage",4):langMgr.getString("manorMilitaryBuildingPage",5,a[g].NAME),o=r=9===e?d/10+"%":d}break;case 2:c&&(o=(n=langMgr.getString("manorMilitaryBuildingPage",6))+(r=c.COUNT));break;case 3:c&&(o=(n=langMgr.getString("manorMilitaryBuildingPage",7))+(r=gUtils.showNum(c.MAX)))}if(n)return{intro:n,num:r,desc:o}}},refreshInfo:function(){var e=this,t=this.m_objHouse.id,a=this.m_objHouse.lv;this.p_arrLabelInfo.forEach(function(i,n){var r=e.getShowProperty(t,n,a);r?(i.active=!0,i.string=r.desc):i.active=!1}),this.p_infoArrItem.forEach(function(i){var n=e.getShowProperty(t,1,a);i.getChildByName("title").getComponent(cc.Label).string=n.intro,i.getChildByName("num").getComponent(cc.Label).string=n.desc;var r=i.getChildByName("next_num"),o=i.getChildByName("max");r.active=!e._isMaxLv,o.active=e._isMaxLv;var s=e.getShowProperty(t,1,a+1);s&&(r.getComponent(cc.Label).string="\u4e0b\u4e00\u7ea7: "+s.desc)})},refreshCost:function(e){this.m_objHouse.id;var t=this.m_objHouse.lv,a=this._isMaxLv,i=!0;if(!a)for(var n=0;n<this.p_arrLabLvUpCurrent.length;++n){var r=e.COST[n].COUNT,o=app.player.getCount(e.COST[n].GSID);this.p_arrLabLvUpCurrent[n].string=gUtils.showNum(o),this.p_arrLabLvUpNeed[n].string="/ "+gUtils.showNum(r),o>=r?this.p_arrLabLvUpCurrent[n].node.color=this.m_colorCost:(this.p_arrLabLvUpCurrent[n].node.color=cc.Color.RED,i=!1);var s=gConfig.getCurrencyIconPath(e.COST[n].GSID);app.loadTexture(s,this.p_arrSprLvUpIcon[n],this.prefabPath)}if(this.p_nodeCostInfo.active=!a,this.p_btnLevelUp.node.active=!a,a)this.p_labelLvNoEnough.node.active=!1;else{var p=app.pages.manorpage.instance.m_objData.manorlv,c=app.db.getManorInfo(p).UPMAX;c&&t>=c?(this.p_labelLvNoEnough.node.active=!0,this.p_labelLvNoEnough.string=langMgr.getString("manorMilitaryBuildingPage",0,this.getNextManorUPMAX(p,c)),i=!1):this.p_labelLvNoEnough.node.active=!1,this.p_btnLevelUp.interactable=i}},getNextManorUPMAX:function(e,t){var a=app.db.getManorInfo(e+1);return a?a.UPMAX>t?e+1:this.getNextManorUPMAX(e+1,t):lv},onLevelUp:function(){var e=this,t=this.m_objHouse.id,a=this.m_objHouse.lv,i=app.db.getManorBuildingInfo(t).INFO[a].COST;app.player.sfManorBuild({bid:t},function(){e.p_skeLvUpAnim.node.active=!0,e.p_skeLvUpAnim.setAnimation(0,"animation",!1),e.p_infoArrItem.forEach(function(e){var t=e.getChildByName("anim");cc.isValid(t)&&(t.active=!0,t.getComponent(sp.Skeleton).setAnimation(0,"shengji01",!1))}),app.player.reduceItem(i),e.m_objHouse.lv++,e.m_objHouse.target.onLevel(t),e.refreshUI(),e.playUpAnim()})},playUpAnim:function(){app.loadEff("shengji_01",this.p_animLevel,1,1)},onClose:function(){app.player.sfPlayerData(),this._super()}});cc._RF.pop()},{basePage:void 0,dbProperty:void 0}],manorNormalEnemyPage:[function(e,t){"use strict";cc._RF.push(t,"d3e1cz7EWtHbbNII+7OnZO2","manorNormalEnemyPage");var a={gsid:38007,count:1},i=cc.Class({extends:e("basePage"),statics:{prefabPath:"manornormalenemypage",pageType:1},properties:{p_labTime:cc.Label,p_labfood:cc.Label,p_nodeEnemy:cc.Node,p_pfbEnemy:cc.Prefab,p_nodeLayout:cc.Node,p_pfbRewardItem:cc.Prefab,p_btnFight:cc.Button,p_spCostArr:[cc.Sprite]},onLoad:function(){var e=this;i.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.m_arrItems=[],this.m_arrIconReward=[],this.schedule(this.refreshTime,1),this.p_spCostArr.forEach(function(t){app.loadTexture(gConfig.getCurrencyIconPath(38007),t,e.prefabPath)})},handleUI:function(){var e=this;this._super(),this.p_btnFight.node.on("click",function(){app.playSound("click"),2!=app.pages.manorsiegepage.instance.m_objData.mop?e.onFight():app.showNotice(langMgr.getString("manorNormalEnemyPage",0))})},setParam:function(e){app.manorboss=null,this.m_objEnemyData=e.data,this.m_objParam=e.objParam;var t=this.isEnemyDown(this.m_objEnemyData);this.m_blnBtnInteractable=!t,this.refreshUI()},refreshUI:function(){this.refreshEnemy(),this.refreshReward(),this.refreshBtn(),this.refreshTime()},refreshTime:function(){var e=app.player.getServerTime(),t=this.m_objParam.rtime-e;t<=0?this.onClose():this.p_labTime.string=gUtils.getHourMinSecTime(t/1e3)},refreshEnemy:function(){var e=app.db.getManorInfo(this.m_objParam.lv).UPITEM[0],t=e.COUNT,a=app.player.getCount(e.GSID);this.p_labfood.string=a+"/"+t;var i=0;for(var n in this.m_objEnemyData.enemy){var r=this.m_arrItems[i];r||((r=cc.instantiate(this.p_pfbEnemy)).parent=this.p_nodeEnemy,this.m_arrItems.push(r)),r.active=!0;var o={gsid:this.m_objEnemyData.enemy[n].gsid,level:this.m_objEnemyData.enemy[n].level,hppercent:this.m_objEnemyData.enemy[n].nowhp,exhp:this.m_objEnemyData.enemy[n].exhp,blngray:!0};r.getComponent("generalExpedItem").refreshUI(o,this),i++}for(var s=i;s<this.m_arrItems.length;++s)this.m_arrItems[s].active=!1},refreshReward:function(){for(var e=app.db.getManorEnemyReward(this.m_objParam.lv),t=0;t<e.length;++t){var a=this.m_arrIconReward[t];a||((a=cc.instantiate(this.p_pfbRewardItem)).parent=this.p_nodeLayout,this.m_arrIconReward.push(a)),a.active=!0,a.getComponent("propItem").initForBag(e[t]),a.getComponent("propItem").setClick(!0)}for(var i=e.length;i<this.m_arrIconReward.length;++i)this.m_arrIconReward[i].active=!1},refreshBtn:function(){this.p_btnFight.interactable=this.m_blnBtnInteractable},onFight:function(){if(app.player.getCountEnough(a)){var e=this.m_objParam.index;app.manorboss=e,app.battleType="manor",app.manorIndex=e,app.battleConfig=this.m_objEnemyData.enemy,app.goToNormBattle()}else app.showNotice(langMgr.getString("manorNormalEnemyPage",1))},afterBattleFresh:function(){switch(app.battleOverType){case"manor":this.getBossInfo()}},getBossInfo:function(){var e=this;app.player.sfGetManorEnemyInfo({index:this.m_objParam.index},function(t,a){if(!t&&cc.isValid(e.node)){e.m_objEnemyData=a;var i=e.isEnemyDown(e.m_objEnemyData);e.m_blnBtnInteractable=!i,e.refreshUI(),e.m_objParam.target&&i&&e.m_objParam.target.updateNormalEnemyState(e.m_objParam.index,a),app.pages.manorsiegepage.instance&&app.pages.manorsiegepage.instance.node.active&&app.pages.manorsiegepage.instance.refreshHay()}})},isEnemyDown:function(e){var t=!0;for(var a in e.enemy)if(e.enemy[a].nowhp>0){t=!1;break}return t}});i.showPage=function(t,a,i){var n=this,r={};void 0!==t.index&&(r={index:t.index}),app.player.sfGetManorEnemyInfo(r,function(r,o){r||e("basePage").showPage.apply(n,[{data:o,objParam:t},a,i])})},cc._RF.pop()},{basePage:void 0}],manorOfficePage:[function(e,t){"use strict";function a(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(a)return(a=a.call(e)).next.bind(a);if(Array.isArray(e)||(a=i(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function i(e,t){if(e){if("string"==typeof e)return n(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?n(e,t):void 0}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,i=new Array(t);a<t;a++)i[a]=e[a];return i}cc._RF.push(t,"c51cawVEG5PkLo8ypU398G4","manorOfficePage");var r=cc.Class({extends:cc.Component,properties:{p_arrNowAttrNameLabel:[cc.Label],p_arrNowAttrNumLabel:[cc.Label],p_labNoneTitle:cc.Label,p_labLevel:cc.Label,p_sprIcon:cc.Sprite,p_sprName:cc.Sprite,p_arrMissionNode:[cc.Node],p_nodeNotFullLevel:cc.Node,p_nodeFullLevel:cc.Node,p_btnUp:cc.Button,p_btnSalary:cc.Button,p_arrSprF:[cc.SpriteFrame],p_arrBtnSprF:[cc.SpriteFrame],p_labelTimer:cc.Label,p_NodeTimer:cc.Node,p_btnShop:cc.Button,p_btnHelp:cc.Button,p_pfbPropItem:cc.Prefab,p_nodeNextReward:cc.Node,p_layoutNextReward:cc.Node},onLoad:function(){var e=this;r.instance=this,this.m_arrIconReward=[],this.m_arrNextReward=[],this.p_btnUp.node.on("click",function(){app.playSound("click"),e.onClickBtnUp()}),this.p_btnSalary.node.on("click",function(){app.playSound("click"),e.onClickBtnSalary()}),this.p_btnShop.node.on("click",function(){app.playSound("click"),app.pages.shoppage.showPage("offical")}),this.p_btnHelp.node.on("click",function(){app.playSound("click"),app.pages.officerewardshowpage.showPage()}),this.p_arrMissionNode.forEach(function(t,i){t.getChildByName("btn_get").on("click",function(){if(e.m_isPass[i]){var t=e.m_arrMission[i].EXID;app.player.sfExchange(t,1,null,function(t){for(var n,r=[],o=a(t);!(n=o()).done;){var s=n.value;(s.gsid||s.GSID)!=e.m_arrMission[i].GETMARK&&r.push(s)}GodGuide.addGuideProgress("guide_office_reward_end"),app.player.sfPlayerData(function(){e.refreshUI(),app.pages.officepage.instance.refreshUI()});var p={showtype:1,reward:r,target:e};app.pages.windowspagereward.showPage(p)})}else app.goToPage(e.m_arrMission[i].PAGE)})}),this.p_sprIconPos=this.p_sprIcon.node.getPosition()},onEnable:function(){},refreshUI:function(){var e=this;this.schedule(this.refreshBtnSalary,1);var t=app.player.getCount(38004);this.m_isPass=[],this.p_labLevel.string=t;var a=app.db.dbOfficialItems.length-1;t=Math.min(a,t),app.db.dbOfficialItems[t].ATTR;var i=gConfig.getOfficialIconPath(t);i?app.loadTexture(i,this.p_sprIcon,this.prefabPath,function(){e.p_sprIcon.node.active=!0}):this.p_sprIcon.node.active=!1,this.p_sprIcon.node.stopAllActions(),this.p_sprIcon.node.setPosition(this.p_sprIconPos),this.p_sprIcon.node.runAction(cc.repeatForever(cc.sequence(cc.moveBy(2,cc.v2(0,30)),cc.moveBy(2,cc.v2(0,-30)),cc.delayTime(0))));var n=gConfig.getOfficialNamePath(t);if(n?app.loadTexture(n,this.p_sprName,this.prefabPath,function(){e.p_sprName.node.active=!0}):this.p_sprName.node.active=!1,t>=app.db.dbOfficialItems.length-1)this.p_nodeNotFullLevel.active=!1,this.p_nodeFullLevel.active=!0,this.switchUpOrSalaryBtn(!0);else{this.p_nodeNotFullLevel.active=!0,this.p_nodeFullLevel.active=!1;var r=t>=app.db.dbOfficial.length?app.db.dbOfficial.length-1:t;this.m_arrMission=app.db.dbOfficial[r];for(var o=0;o<this.p_arrMissionNode.length;o++){var s=this.m_arrMission[o];this.refreshMissionItem(this.p_arrMissionNode[o],s)}this.refreshBtn()}var p=app.db.getOfficialInfoByLv(app.player.getCount(38004)+1);this.p_nodeNextReward.active=!!p,p&&p.REWARD.forEach(function(t,a){var i=e.m_arrNextReward[a];i||((i=cc.instantiate(e.p_pfbPropItem)).parent=e.p_layoutNextReward,e.m_arrNextReward[a]=i),i.active=!0,i.scale=.8,i.getComponent("propItem").initForBag(t),i.getComponent("propItem").setClick(!0)}),this.refreshBtnSalary()},refreshMissionItem:function(e,t){if(t){e.active=!0;var a=e.getChildByName("name_label"),i=e.getChildByName("count_label"),n=e.getChildByName("btn_get"),r=e.getChildByName("yilingqu"),o=e.getChildByName("PropContent"),s=o.getChildByName("porp_item");cc.isValid(s)||(s=cc.instantiate(this.p_pfbPropItem),o.addChild(s),s.setPosition(cc.Vec2.ZERO)),a.getComponent(cc.Label).string=t.NAME;var p=app.player.getMissionState(t),c=p.now,h=p.end;s.getComponent("propItem").initForBag(t.REWARD[0]),i.getComponent(cc.Label).string=c+"/"+h;var l=c>=h;this.m_isPass.push(l);var g=n.getChildByName("tx_lingqujiangli").getComponent(cc.Sprite);l?(n.getComponent(cc.Button).interactable=app.player.getCount(t.GETMARK)<1,g.spriteFrame=app.player.getCount(t.GETMARK)<1?this.p_arrBtnSprF[0]:this.p_arrBtnSprF[1],n.getComponent(cc.Sprite).spriteFrame=this.p_arrSprF[0],r.active=!(app.player.getCount(t.GETMARK)<1),n.active=app.player.getCount(t.GETMARK)<1,n.getChildByName("rednotice").active=app.player.getCount(t.GETMARK)<1):(r.active=!1,n.active=!0,n.getComponent(cc.Button).interactable=!0,g.spriteFrame=this.p_arrBtnSprF[1],n.getComponent(cc.Sprite).spriteFrame=this.p_arrSprF[1],n.getChildByName("rednotice").active=!1)}else e.active=!1},refreshBtn:function(){for(var e=app.player.getCount(38004),t=e>=app.db.dbOfficial.length?app.db.dbOfficial.length-1:e,a=app.db.dbOfficial[t],i=0;i<a.length;++i){var n=a[i];if(app.player.getCount(n.GETMARK)<1)return void this.switchUpOrSalaryBtn(!0)}this.switchUpOrSalaryBtn(!1)},switchUpOrSalaryBtn:function(e){this.p_btnUp.node.active=!e,this.p_NodeTimer.active=e},refreshBtnSalary:function(){if(this.p_btnSalary.node.active){var e=app.player.getCount(90162),t=app.player.getCount(38004),a=!(e>0),i=!a,n=a;if(this.p_NodeTimer.active=i,t<=0&&(n=!1),this.p_btnSalary.node.getChildByName("rednotice").active=n,this.m_salary=n,i)if(this.m_signTime){var r=this.m_signTime-app.player.getServerTime();!r<0?this.updateOther():(r/=1e3,this.p_labelTimer.string=gUtils.getHourMinSecTime(r))}else this.m_signTime=gUtils.getSecondDayTime(app.player.getServerTime())}},updateOther:function(){var e=this;app.player.sfPlayerByParam(["others"],function(){e.m_signTime=gUtils.getSecondDayTime(app.player.getServerTime()),e.refreshBtnSalary()})},onClickBtnUp:function(){var e=this,t="official_upgrade"+(app.player.getCount(38004)+1);app.player.sfExchange(t,1,null,function(t){for(var i,n=[],r=a(t);!(i=r()).done;){var o=i.value;38004!=(o.gsid||o.GSID)&&n.push(o)}GodGuide.addGuideProgress("guide_office_up_end"),app.player.sfPlayerData(function(){e.refreshUI(),app.pages.officepage.officeGrade(),app.pages.officepage.instance.refreshUI()});var s={showtype:1,reward:n,confirmcb:function(){var e={showtype:1,reward:n,confirmcb:function(){}};app.pages.windowspagereward.showPage(e)},target:e};app.pages.windowsPageOfficeRaised.showPage({call:function(){app.pages.windowspageofficeup.showPage(s)}})})},onClickBtnSalary:function(){this.m_salary?this.onSalary():app.pages.officerewardshowpage.showPage(1)},onSalary:function(){var e=this,t=app.player.getCount(90162);app.player.getCount(38004)?t>0?app.showNotice(langMgr.getString("manorOfficePage",1)):app.player.sfOfficialSalary(function(t,a){if(t)app.showNotice(t);else{var i={showtype:1,reward:a,confirmcb:function(){},target:e};app.pages.windowspagereward.showPage(i),app.player.sfPlayerData(function(){cc.isValid(e)&&e.refreshUI(),cc.isValid(app.pages.officepage.instance)&&app.pages.officepage.instance.refreshUI(),cc.isValid(app.pages.manorpage.instance)&&app.pages.manorpage.instance.refreshRed()})}}):app.showNotice(langMgr.getString("manorOfficePage",0))}});cc._RF.pop()},{}],manorPage:[function(e,t){"use strict";cc._RF.push(t,"b162382qJJPGqnwgoNui7Kr","manorPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"manorpage",pageType:0},properties:{p_btnFight:cc.Button,p_btnGet:cc.Button,p_nodeContent:cc.Node,p_arrRewardItem:[cc.Node],p_btnHelp:cc.Button,p_arrBuild:[cc.Node],p_arrBuildLock:[cc.Node],p_material:[cc.Material],p_aKeyGet:cc.Button},onEnable:function(){this._super(),eventMgr.on(eventStr.ManorSiegePage.RefreshRed,this.refreshRed,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.ManorSiegePage.RefreshRed,this.refreshRed,this)},onLoad:function(){a.instance=this,this.stopNodeEvent(),this.handleUI(),this.fitTopMenu(100)},handleUI:function(){var e=this;this._super(),this.p_arrBuild.forEach(function(t){t.on("touchend",function(){app.playSound("click"),e.clickedBuild(t.name)})});for(var t=function(t){var a,i;null==(a=e.p_arrBuild[t])||null==(i=a.getChildByName("res_base"))||i.on("touchend",function(){e.onResGet(t+1)})},a=1;a<5;a++)t(a);this.p_btnFight.node.on("click",function(){app.playSound("click"),app.pages.newmanorsiegepage.showPage()}),this.p_aKeyGet.node.on("click",function(){app.playSound("click"),e.onGetAllRewards()}),this.p_btnHelp.node.on("click",function(){app.pages.windowspagetipshelp.showPage("1029")})},clickedBuild:function(e){if(!this.m_objData)return app.showNotice(langMgr.getString("manorPage",1));switch(cc.log("clicked building name : "+e),e){case"1":app.pages.manorfuyapage.showPage({id:1,lv:this.m_objData.manorlv,target:this});break;case"2":case"3":case"4":case"5":var t=this.m_objData.list[e];if(!t){var a={type:"nocancel",budID:Number(e)};return void app.pages.windowspagemanorlock.showPage(a)}app.pages.manorresourcebuildingpage.showPage({id:t.id,manorlv:this.m_objData.manorlv,lv:t.lv,pos:this.m_numIndex,items:t.items||[],target:this});break;case"6":case"7":case"8":case"9":case"10":var i=this.m_objData.list[e];if(!i){var n={type:"nocancel",budID:Number(e)};return void app.pages.windowspagemanorlock.showPage(n)}app.pages.manormilitarybuildingpage.showPage({id:i.id,lv:i.lv,pos:this.m_numIndex,items:i.items||[],target:this});break;case"tianlao":this.onCaptive();break;default:var r=this.m_objData.list[e];if(!r)return app.showNotice(langMgr.getString("manorPage",2));app.pages.manorhousepage.showPage({id:r.id,lv:r.lv,pos:this.m_numIndex,items:r.items||[],target:this})}},setParam:function(){this.getManorInfo(),app.runUnlockGuide("MANOR")},getManorInfo:function(){var e=this;app.player.sfGetManorInfo(function(t){app.MANOR_INFO=t,t.items&&t.items.length>=1&&app.player.addItem(t.items),cc.isValid(e.node)&&(e.m_objData=t,e.refreshUI(),app.mainScene.refreshCoin())})},refreshUI:function(){var e,t=[-16,-15,-20,-20,-18,-30,-25,-30,-28,-15];null==(e=this.p_aKeyGet.node.getComponent(sp.Skeleton))||e.setAnimation(0,"B",!0);for(var a=0;a<this.p_arrBuild.length;++a){var i,n,r;if("JP"===gSetting.getLangName()){var o=this.p_arrBuild[a].getChildByName("title").getChildByName("level");cc.isValid(o)&&void 0!==t[a]&&(o.y=t[a])}if(0==a){var s,p,c,h=null==(s=this.p_arrBuild[a].getChildByName("ImgTitleBg"))?void 0:null==(p=s.getChildByName("title"))?void 0:null==(c=p.getChildByName("level"))?void 0:c.getComponent(cc.Label);cc.isValid(h)&&(h.string=this.m_objData.manorlv)}if(0!=a&&10!=a){var l=this.p_arrBuild[a],g=l.name;l.active=Boolean(this.m_objData.list[g]);var d=this.p_arrBuildLock[a].getChildByName("lock_tip");d&&this.getLockLv(g)&&(d.getComponent(cc.Label).string=langMgr.getString("manorPage",14,[app.db.getManorBuildingMax(g).NAME,this.getLockLv(g)])),this.p_arrBuildLock[a].active=!Boolean(this.m_objData.list[g])&&this.getLockLv(g);var u=null==(i=l.getChildByName("ImgTitleBg"))?void 0:null==(n=i.getChildByName("title"))?void 0:null==(r=n.getChildByName("level"))?void 0:r.getComponent(cc.Label);if(this.m_objData.list[g]&&(u.string=this.m_objData.list[g].lv,"2"==g||"3"==g||"4"==g||"5"==g)){var f;u.node.active=!1;var m=l.getChildByName("res_base"),_=null==m?void 0:null==(f=m.getChildByName("icon"))?void 0:f.getComponent(cc.Sprite),v=m.getChildByName("sp"),b=app.db.getManorBuildingInfo(this.m_objData.list[g].id).INFO[this.m_objData.list[g].lv],y=b.RES?b.RES[0]:null;if(y){var P=y.MAX,w=0;this.m_objData.list[g].items&&this.m_objData.list[g].items.length>0&&(w=this.m_objData.list[g].items[0].count);var I=w/P;if(m.active=Boolean(I),v.active=I>=1,m.active){var S,C,N;null==(S=this.p_aKeyGet.node.getComponent(sp.Skeleton))||S.setAnimation(0,"A",!0);var k=null==(C=this.m_objData.list[g])?void 0:null==(N=C.items[0])?void 0:N.gsid,T=gConfig.getCurrencyIconPath(k);app.loadTexture(T,_,this.prefabPath),m.runAction(cc.repeatForever(cc.sequence(cc.moveBy(1,cc.v2(0,5)),cc.moveBy(2,cc.v2(0,-10)),cc.moveBy(2,cc.v2(0,10)),cc.moveBy(2,cc.v2(0,-10)),cc.moveBy(1,cc.v2(0,5)),cc.delayTime(0))))}}}}}this.refreshDailyRewardInfo(),this.refreshRed()},getLockLv:function(e){var t,a=app.db.getManorHome();return"2"==e||"3"==e||"4"==e||"5"==e?a.some(function(a){var i=a.BUILDING[e];if(i&&i>0)return t=a.LV,!0}):"6"!=e&&"7"!=e&&"8"!=e&&"9"!=e&&"10"!=e||a.some(function(a){if(a.UNLOCK&&a.UNLOCK.indexOf(+e)>=0)return t=a.LV,!0}),t},refreshRed:function(){this.p_aKeyGet.node.getChildByName("rednotice").active=this.checkIsHaveRewards(!0),this.p_btnFight.node.getChildByName("rednotice").active=a.checkManorSeigeRed()},refreshDailyRewardInfo:function(){for(var e=0;e<this.p_arrRewardItem.length;++e){var t=this.p_arrRewardItem[e],a=this.m_objData.list[e+2];if(a){var i=this.getResourceBuildingDailyProperty(a.id,a.lv);if(i){t.active=!0;var n=t.getChildByName("num"),r=t.getChildByName("icon");n.getComponent(cc.Label).string=i.desc;var o=app.db.getPropsIconPath(i.resID);app.loadTexture(o,r.getComponent(cc.Sprite),this.prefabPath),cc.log(r)}else t.active=!1}else t.active=!1}},getResourceBuildingDailyProperty:function(e,t){var a=0,i=app.pages.manorpage.getMout(this.m_objData.list),n=app.db.getManorBuildingInfo(e).INFO[t];if(n){var r=n.RES?n.RES[0]:null;if(r)return app.db.getPropsName(r.ID),a=24/(r.TIME/60/60)*r.COUNT*i,{desc:""+(a=38007==r.ID?Math.floor(100*a)/100:gUtils.showNum(Math.floor(a)))+langMgr.getString("manorPage",9),resID:r.ID}}},refreshOfficeTime:function(){var e=app.player.getCount(90162),t=(app.player.getCount(38004),!!(e>0));if(this.p_nodeOfficeTime.active=t,t)if(this.m_signTime){var a=this.m_signTime-app.player.getServerTime();!a<0?this.updateOther():a>0?(a/=1e3,this.p_labelOfficeTime.string=gUtils.getHourMinSecTime(a)):this.p_nodeOfficeTime.active=!1}else this.m_signTime=gUtils.getSecondDayTime(app.player.getServerTime())},updateOther:function(){var e=this;app.player.sfPlayerByParam(["others"],function(){e.m_signTime=gUtils.getSecondDayTime(app.player.getServerTime())})},getResourceRewardEnd:function(e){this.m_objData.list[e].items=[]},onLevel:function(e){switch(e){case 1:this.m_objData.manorlv+=1,this.getManorInfo();break;default:this.m_objData.list[e].lv+=1}this.refreshUI()},onGetAllRewards:function(){var e=this;this.checkIsHaveRewards(!0)?app.player.sfGetManorReward(null,function(t){app.player.addItem(t.items);var a={reward:t.items,showtype:1};app.pages.windowspagereward.showPage(a),e.checkIsHaveRewards(),e.getManorInfo()}):app.showNotice(langMgr.getString("manorPage",3))},onResGet:function(e){var t=this;app.player.sfGetManorReward({pos:e},function(e){app.player.addItem(e.items);var a={reward:e.items,showtype:1};app.pages.windowspagereward.showPage(a),t.getManorInfo()})},onOffice:function(){app.pages.officepage.showPage({type:1})},onCaptive:function(){app.pages.officepage.showPage({type:2})},checkIsHaveRewards:function(e){var t=this.m_objData.list,a=0;for(var i in t){var n=t[i],r=n.items?n.items[0]:null;if(e){if(r&&(a+=r.count),a>=1)return!0}else r&&r.count>=1&&(n.items=[],n.lastgain=app.player.getServerTime())}if(e)return!1},getFoodMax:function(){return this.m_objData?app.db.getManorConfig().FOOD_MAX:(cc.log("get manor info failed"),0)},getFood:function(e){var t=app.player.getCount(38005),a=(app.player.getCount(38007),30-(app.player.getCount(90392)||0)),i=a<=0?langMgr.getString("manorPage",11):""+langMgr.getString("manorPage",12)+a,n=(app.db.getManorInfo(this.m_objData.manorlv),app.db.getManorConfig().FOOD_MAX);if(n<=0)app.showNotice(langMgr.getString("manorPage",4));else{var r=Math.floor(t/100);if(r<=0)app.showNotice(langMgr.getString("manorPage",5));else{var o={gsid:38007,coin:38005,maxcount:n=(n=n<=r?n:r)<=a?n:a,price:100,type:"buy",tips:i,confirmcb:function(t){app.player.sfGetFood({count:t},function(t,a){t?"food max"==t?(app.showNotice(langMgr.getString("manorPage",6)),app.player.sfPlayerByParam(["hide"])):"buy limit"==t?(app.showNotice(langMgr.getString("manorPage",7)),app.player.sfPlayerByParam(["hide"])):app.showNotice(t):(app.player.sfPlayerByParam(["hide","others"]),app.pages.windowspagereward.showPage({reward:a.items,showtype:1,confirmcb:e}))})}};app.pages.windowspagesetnum.showPage(o)}}}});a.refreshRed=function(e){var t=!1,i=a.checkHaveReward(),n=a.checkManorSeigeRed();return(i||n)&&(t=!0),e&&(e.active=t),t},a.getMout=function(e){var t=e,a=1;for(var i in t){var n=app.db.getManorBuildingInfo(t[i].id).INFO[t[i].lv],r=n.ATT?n.ATT[0]:null;r&&r.ID&&"mout"===r.ID&&(a+=r.NUM/1e3)}return a},a.checkHaveReward=function(){if(!app.MANOR_INFO)return!1;app.MANOR_INFO;var e=app.MANOR_INFO.list,t=0;for(var a in e){var i=e[a],n=i.items?i.items[0]:null;if(n&&(t+=n.count),t>=1)return!0}return!1},a.checkFirstTime=function(){var e=gUtils.dateFormatter("YYYY-MM-DD",(new Date).getTime()),t=localDataUtils.GetValue("manorred",null);return!t||e!==t},a.checkManorSeigeRed=function(){return app.pages.newmanorsiegepage.refreshRed()},cc._RF.pop()},{basePage:void 0}],manorPrisonHomePage:[function(e,t){"use strict";function a(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(a)return(a=a.call(e)).next.bind(a);if(Array.isArray(e)||(a=i(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function i(e,t){if(e){if("string"==typeof e)return n(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?n(e,t):void 0}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,i=new Array(t);a<t;a++)i[a]=e[a];return i}cc._RF.push(t,"a00c31forxMy5Wm04NwJMuA","manorPrisonHomePage");var r=cc.Class({extends:e("basePage"),statics:{prefabPath:"manorprisonhomepage",pageType:0},properties:{p_tabvGeneral:cc.tableView,p_nodeNone:cc.Node,p_btnHelp:cc.Button,p_btnShop:cc.Button},onLoad:function(){r.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.fitTopMenu()},handleUI:function(){this._super(),this.p_btnShop.node.on("click",function(){app.playSound("click"),app.pages.shoppage.showPage("offical")}),this.p_btnHelp.node.on("click",function(){app.playSound("click"),app.pages.windowspagetipshelp.showPage("1028")})},setParam:function(e){this.getNewData(e);var t=gUtils.dateFormatter("YYYY-MM-DD",(new Date).getTime());localDataUtils.SetValue("prisonRed",t)},getNewData:function(e){this.m_arrData=this.getPrisonData(e),this.m_arrShowData=this.getShowData(this.m_arrData),this.refreshUI()},getPrisonData:function(e){for(var t,i=[],n=a(e);!(t=n()).done;){var r=t.value;0==r.state&&i.push(r)}return i},getShowData:function(e){var t=[];if(e.length<3)for(var a=0;a<3;++a){var i=e[a]?e[a]:{};t.push(i)}else t=e;return t},itemClick:function(e,t){return cc.log("prison click data is",e,t),app.pages.manorprisonpage.showPage({array:this.m_arrData,index:e}),!0},onEnable:function(){eventMgr.on(eventStr.manorPrisonPage.init_data,this.getNewData,this)},onDisable:function(){eventMgr.off(eventStr.manorPrisonPage.init_data,this.getNewData,this)},refreshUI:function(){var e=this.m_arrShowData&&this.m_arrShowData.length>0;this.p_nodeNone.active=!e,this.p_tabvGeneral.node.active=e,this.refreshView()},refreshView:function(){if(this.m_arrShowData&&!(this.m_arrShowData.length<=0)){var e=this.m_arrShowData.length;this.p_tabvGeneral.initTableView(e,{array:this.m_arrShowData,target:this})}},onClose:function(){this._super(),app.pages.newworldmappage.instance&&app.pages.newworldmappage.instance.refreshPrison()}});r.showPage=function(t){var a=this;app.player.sfSrenderList(function(i,n){if(i)return t&&t(),app.showNotice(i);e("basePage").showPage.call(a,n),t&&t()})},cc._RF.pop()},{basePage:void 0}],manorPrisonPage:[function(e,t){"use strict";cc._RF.push(t,"761bbszNKRJvaqh+mn+dJJ2","manorPrisonPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"manorprisonpage",pageType:0},properties:{p_nodeList:cc.Node,p_tabvGeneral:cc.tableView,p_nodePick:cc.Node,p_labGName:cc.Label,p_sprGeneral:cc.Sprite,p_spGeneral:sp.Skeleton,p_animGeneral:cc.Animation,p_barLoyal:cc.ProgressBar,p_labLoyal:cc.Label,p_btnKill:cc.Button,p_btnSurrender:cc.Button,p_nodeCost:cc.Node,p_nodeHave:cc.Node,p_nodeNone:cc.Node,p_nodeSucc:cc.Node,p_btnHelp:cc.Button,p_generalInfoNode:cc.Node,p_nodeMask:cc.Node,p_sprTalk:cc.Sprite,p_labTalk:cc.Label,p_spLvUp:sp.Skeleton,p_btnShop:cc.Button,p_skill:cc.Node,p_generalQuality:cc.Node,p_pfbQualityItem:cc.Prefab,p_spKill:sp.Skeleton,p_nodeLoseParent:cc.Node,p_nodeLoseItem:cc.Node,p_nodeCgMask:cc.Node,p_nodeZxcg:cc.Node,p_btnLeft:cc.Button,p_btnRight:cc.Button,p_sprZhenying:cc.Sprite,p_sprZhiye:cc.Sprite,p_sprStar:[cc.Sprite],p_anim:sp.Skeleton},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(),this.handleUI(),this.fitTopMenu(),this.m_pool=new cc.NodePool,this.m_isAnim=!1},handleUI:function(){var e=this;this._super(),this.p_btnKill.node.on("click",function(){app.playSound("click"),e.onClickBtnKill()}),this.p_btnSurrender.node.on("click",function(){app.playSound("click"),e.m_isAnim||(e.m_isAnim=!0,e.p_anim.node.active=!0,e.p_anim.setAnimation(0,"animation",!1),e.onClickBtnSurrender())}),this.p_nodeMask.on("touchend",function(){e.stopWjTalk()}),this.p_btnShop.node.on("click",function(){app.playSound("click"),app.pages.shoppage.showPage("offical")}),this.p_btnHelp.node.on("click",function(){app.playSound("click"),app.pages.windowspagetipshelp.showPage("1028")}),this.p_skill.children.forEach(function(t,a){t.on("touchend",function(){e.onClickSkill(a)})}),this.p_btnLeft.node.on("click",function(){if(!(e.m_index<=0)){var t=e.m_arrData[e.m_index-1];e.m_index=e.m_index-1,e.refreshPick(t)}}),this.p_btnRight.node.on("click",function(){if(!(e.m_index>=e.m_arrData.length-1)){var t=e.m_arrData[e.m_index+1];e.m_index=e.m_index+1,e.refreshPick(t)}}),this.p_anim.setCompleteListener(function(){e.m_isAnim=!1,e.p_anim.node.active=!1})},setParam:function(e){cc.log("manorPrisonPage data is",e),this.m_arrData=e.array,this.m_index=e.index,this.p_nodeMask.active=!1,this.refreshPick(this.m_arrData[this.m_index])},refreshBtn:function(){this.p_btnLeft.node.active=!(this.m_index<=0),this.p_btnRight.node.active=!(this.m_index>=this.m_arrData.length-1)},playWjTalk:function(e,t,a){var i=this;if(this.m_seqAction&&this.stopWjTalk(),3==e)this.p_spKill.node.active=!0,this.p_spKill.setAnimation(0,"animation2",!1),this.p_spGeneral.node.runAction(cc.sequence(cc.moveBy(.25,cc.v2(50,50)),cc.moveBy(.25,cc.v2(-50,-50))));else if(1==e){this.p_nodeZxcg.opacity=255,this.p_nodeCgMask.active=!0,this.p_nodeZxcg.scale=0,this.p_nodeZxcg.runAction(cc.scaleTo(.5,1));var n=cc.sequence(cc.fadeOut(.5),cc.callFunc(function(){i.p_nodeCgMask.active=!1}));this.scheduleOnce(function(){i.p_nodeZxcg.runAction(n)},2)}else 2==e&&this.playLoseAnim();this.p_nodeMask.active=!0,this.p_sprTalk.node.opacity=255,this.p_sprTalk.node.scale=.1,this.m_isCallFunc=!1,this.m_isCallBack=!1,this.m_callBack=t,this.m_callFunc=a,this.p_labTalk.string=app.db.getStrTalkByType(e),this.m_seqAction=cc.sequence(cc.scaleTo(.2,1,1),cc.callFunc(function(){i.m_isCallFunc=!0,a&&a()}),cc.delayTime(1.5),cc.fadeOut(.3),cc.callFunc(function(){i.m_isCallBack=!0,i.stopWjTalk(),t&&t()})),this.p_sprTalk.node.runAction(this.m_seqAction)},stopWjTalk:function(){this.p_nodeMask.active=!1,this.m_seqAction&&(this.m_isCallFunc||this.m_callFunc&&this.m_callFunc(),this.m_isCallBack||this.m_callBack&&this.m_callBack(),this.p_sprTalk.node.stopAction(this.m_seqAction),this.m_seqAction=null)},getNewData:function(){this.m_index=0;var e=this.m_arrData[this.m_index];this.refreshPick(e)},refreshUI:function(){},refreshPick:function(e){if(!e)return this.p_generalInfoNode.active=!1,this.p_nodePick.active=!1,this.p_nodeList.active=!1,void(this.p_nodeNone.active=!0);this.p_generalInfoNode.active=!0,this.p_nodePick.active=!0,this.p_nodeList.active=!0,this.p_nodeNone.active=!1,this.refreshBtn();var t=app.db.getGBaseByGsid(e.gsid);this.p_labGName.string=t.NAME,this.m_arrSkill=t.SKILL;for(var a=0;a<this.p_skill.children.length;a++){var i=t.SKILL[a];i?(this.p_skill.children[a].active=!0,this.p_skill.children[a].getComponent("skillItem").initForShow(i,app.pages.manorPrisonPage,!1)):this.p_skill.children[a].getComponent("skillItem").hideItem()}this.p_generalQuality.opacity=Boolean(t.TGRADE)?255:0,t.TGRADE&&(cc.isValid(this._gQualityItem)||(this._gQualityItem=cc.instantiate(this.p_pfbQualityItem),this.p_generalQuality.addChild(this._gQualityItem),this._gQualityItem.setPosition(cc.Vec2.ZERO)),this._gQualityItem.getComponent("GeneralQualityItem").init(t.TGRADE)),app.loadGeneral(t.GSID,this.p_sprGeneral,this.p_spGeneral,this.p_animGeneral,null,this.prefabPath),this.p_sprStar.forEach(function(e,a){e.node.active=t.STAR>a}),app.loadTexture(gConfig.getIconGCampPath(t.CAMP-1),this.p_sprZhenying,this.prefabPath),app.loadTexture(gConfig.getIconPOccuPath(t.OCCU-1),this.p_sprZhiye,this.prefabPath),this.refreshLoyal(e.loyal);var n=e.cost[0];this.p_nodeCost.getComponent("costItem").refreshUI(n.GSID,n.COUNT,this)},refreshLoyal:function(e){var t=e;this.p_barLoyal.progress=t/100,this.p_labLoyal.string=t+"/100"},onClickBtnSurrender:function(){var e=this,t=this.m_arrData[this.m_index];if(t){var a=t.cost[0].COUNT;if(app.player.getCount(t.cost[0].GSID)<a)app.showNotice(langMgr.getString("manorPrisonPage",0));else if(app.player.gnum+1>app.player.bagspace){var i={content:langMgr.getString("manorPrisonPage",6),confirmcb:function(){app.goToPage(1018)},target:this};app.pages.windowspagetipsmsg.showPage(i)}else app.player.sfSrenderPersua(t.id,function(a,i){if(a){if("cant behead"==a)return void app.showNotice(langMgr.getString("manorPrisonPage",1));if("nomore bag"==a){var n={content:langMgr.getString("manorPrisonPage",6),confirmcb:function(){app.goToPage(1018)},target:e};return void app.pages.windowspagetipsmsg.showPage(n)}app.showNotice(a)}else{var r=t.cost[0];app.player.reduceItem({gsid:r.GSID,count:r.COUNT}),e.p_nodeCost.getComponent("costItem").refreshUI(r.GSID,r.COUNT,e),app.player.sfPlayerData(function(){if(i.loyal)e.playWjTalk(2,function(){e.p_barLoyal.getComponent("proBar_Extend").stop(),e.refreshLoyal(e.m_arrData[e.m_index].loyal),e.p_nodeCost.getComponent("costItem").refreshPlayerCoinNum()},function(){var t=e.m_arrData[e.m_index].loyal;e.m_arrData[e.m_index].loyal=i.loyal;var a=i.loyal;e.p_barLoyal.getComponent("proBar_Extend").initLabChange(t,a,100,1,null,!1,!0),e.p_barLoyal.getComponent("proBar_Extend").play(),app.showNotice("\u62db\u964d\u5931\u8d25\uff0c\u5fe0\u8bda\u5ea6\u4e0b\u964d"+(t-a))});else if(i.reward)return GodGuide.addGuideProgress("guide_surrender_end"),app.showNotice("\u62db\u964d\u6210\u529f\uff01"),void e.playWjTalk(1,function(){e.p_nodeSucc.active=!0;var t=i.reward.gsid;e.p_nodeSucc.getComponent("officePageSurrenderSucc").refreshUI(t,e),cc.director.emit("EVT_SHOW_SURRENDER_SUCCESS_PAGE"),app.redDataServer&&app.redDataServer.official&&app.redDataServer.official.srender&&app.redDataServer.official.srender--,app.pages.newworldmappage.instance&&app.pages.newworldmappage.instance.refreshPrison(),e.m_arrData.splice(e.m_index,1),e.m_arrData.length<=0?e.refreshPick():(e.m_index=0,e.refreshPick(e.m_arrData[e.m_index])),eventMgr.emit(eventStr.manorPrisonPage.init_data,e.m_arrData)},function(){e.showGeneralEffAnim()})})}})}},playLoseAnim:function(){var e=this,t=this.m_pool.get();t||(t=cc.instantiate(this.p_nodeLoseItem)),t.setParent(this.p_nodeLoseParent),t.active=!0,t.opacity=255,t.setPosition(cc.v2(0,-55));var a=cc.sequence(cc.fadeOut(1),cc.callFunc(function(){e.m_pool.put(t)}));t.runAction(a),t.runAction(cc.moveTo(1,cc.v2(0,300)))},showGeneralEffAnim:function(){var e=this;app.loadSpine("game_ui_spine/level_up/shengji",this.p_spLvUp,function(){cc.log("load succ"),e.p_spLvUp.setAnimation(0,"animation",!1)},null,this.prefabPath)},onClickBtnKill:function(){var e=this.m_arrData[this.m_index].kill,t={content:langMgr.getString("manorPrisonPage",7),props:e,confirmcb:this.killCb,target:this};app.pages.windowspagepreview.showPage(t)},killCb:function(){var e=this,t=this.m_arrData[this.m_index];app.player.sfSrenderBehead(t.id,function(t,a){if(t)return"cant behead"==t?void app.showNotice(langMgr.getString("manorPrisonPage",4)):void app.showNotice(t);e.playWjTalk(3,function(){var t={showtype:1,reward:a,confirmcb:function(){app.player.sfPlayerData(function(){app.redDataServer&&app.redDataServer.official&&app.redDataServer.official.srender&&app.redDataServer.official.srender--,app.pages.newworldmappage.instance&&app.pages.newworldmappage.instance.refreshPrison(),e.m_arrData.splice(e.m_index,1),e.m_arrData.length<=0?e.refreshPick():(e.m_index=0,e.refreshPick(e.m_arrData[e.m_index])),eventMgr.emit(eventStr.manorPrisonPage.init_data,e.m_arrData)})},target:e};app.pages.windowspagereward.showPage(t)})})},onClickSkill:function(e){var t=this.m_arrSkill[e];if(t){var a={type:"general",gsid:t,index:e,lock:!0};app.pages.windowspagetipsskill.showPage(a)}}});cc._RF.pop()},{basePage:void 0}],manorResourceBuildingPage:[function(e,t){"use strict";cc._RF.push(t,"af433wU7QFHxpkalRguSSE6","manorResourceBuildingPage");var a=e("dbProperty"),i=cc.Class({extends:e("basePage"),statics:{prefabPath:"manorresourcebuildingpage",pageType:1},properties:{p_btnLevelUp:cc.Button,p_sprHouse:cc.Sprite,p_arrLabelInfo:[cc.Label],p_nodeRes:cc.Node,p_labRes:cc.Label,p_proBar:cc.ProgressBar,p_btnResGet:cc.Button,p_spNode:cc.Node,p_arrSprLvUpIcon:[cc.Sprite],p_arrLabLvUpCurrent:[cc.Label],p_arrLabLvUpNeed:[cc.Label],p_nodeCostInfo:cc.Node,p_labelLvNoEnough:cc.Label,p_animLevel:cc.Animation,p_arrTitleFrame:[cc.SpriteFrame],p_spTitle:cc.Sprite,p_infoArrItem:[cc.Node]},onLoad:function(){i.instance=this,this.m_colorCost=this.p_arrLabLvUpNeed[0].node.color.clone(),this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){var e=this;this._super(),this.p_btnResGet.node.on("click",function(){app.playSound("click"),e.onResGet()})},setParam:function(e){this.m_objHouse=e,this.refreshUI(),this.p_btnLevelUp.node.active=!1},refreshUI:function(){var e=this.m_objHouse.id,t=this.m_objHouse.lv,a=app.db.getManorBuildingInfo(e),i=a.INFO[t];console.log(i),this.p_spTitle.spriteFrame=this.p_arrTitleFrame[e-2];var n=gConfig.getManorBuildingIconPath(e);app.loadTexture(n,this.p_sprHouse,this.prefabPath),this.refreshRes(i),this._isMaxLv=t>=a.INFO.length-1,this.refreshInfo()},refreshRes:function(e){var t=e.RES?e.RES[0]:null;if(t){this.p_nodeRes.active=!0;var a=app.db.getPropsIconPath(t.ID);app.loadTexture(a,this.p_btnResGet,this.prefabPath);var i=0;if(this.m_objHouse.items.length>0&&this.m_objHouse.items[0].count>0){this.p_btnResGet.interactable=!0,i=this.m_objHouse.items[0].count;var n=this.p_spNode.getComponent(sp.Skeleton);n.paused=!1,n.setAnimation(0,"zhuangtai3",!0)}else{this.p_btnResGet.interactable=!1;var r=this.p_spNode.getComponent(sp.Skeleton);r.paused=!0,r.setAnimation(0,"zhuangtai1",!1)}var o=t.MAX;this.p_proBar.progress=i/o,this.p_labRes.string=langMgr.getString("manorResourceBuildingPage",0,[i,o])}else this.p_nodeRes.active=!1},getShowProperty:function(e,t,i){var n=null,r=0,o="",s=app.pages.manorpage.getMout(app.pages.manorpage.instance.m_objData.list),p=app.db.getManorBuildingInfo(e).INFO[i];if(p){var c=p.RES?p.RES[0]:null,h=p.ATT?p.ATT[0]:null;switch(t){case 1:break;case 0:if(c){var l=app.db.getPropsName(c.ID);n=langMgr.getString("manorResourceBuildingPage",4,l),r=24/(c.TIME/60/60)*c.COUNT*s,o=r=38007==c.ID?Math.floor(100*r)/100:gUtils.showNum(Math.floor(r))}else if(h){var g=h.ID,d=h.NUM;n="mout"==g?langMgr.getString("manorResourceBuildingPage",5):langMgr.getString("manorResourceBuildingPage",6,a[g].NAME),n+=": ",o=r=d/10+"%"}break;case 2:c&&(o=(n=langMgr.getString("manorResourceBuildingPage",7))+(r=c.COUNT));break;case 3:c&&(o=(n=langMgr.getString("manorResourceBuildingPage",8))+(r=gUtils.showNum(c.MAX)))}if(n)return{intro:n,num:r,desc:o}}},refreshInfo:function(){var e=this,t=this.m_objHouse.id,a=this.m_objHouse.lv,i=app.db.getManorInfo(this.m_objHouse.manorlv);this.p_arrLabelInfo.forEach(function(i,n){var r=e.getShowProperty(t,n,a);r?(i.active=!0,i.string=r.desc):i.active=!1});var n={5:"\u94dc\u94b1\u4ea7\u51fa:",3:"\u5143\u5b9d\u4ea7\u51fa:",4:"\u7075\u97f5\u4e39\u4ea7\u51fa:",2:"\u94dc\u94b1\u4ea7\u51fa:"};this.p_infoArrItem.forEach(function(r,o){var s=r.getChildByName("num"),p=r.getChildByName("title");r.active=o<=2;var c="5"==t||"2"==t?"COUNT":"TIME";if(0==o){p.getComponent(cc.Label).string=n[t];var h=e.getShowProperty(t,o,a);s.getComponent(cc.Label).string=h.desc+"/\u5929"}else if(1==o){p.getComponent(cc.Label).string="\u50a8\u5b58\u4e0a\u9650:";var l=app.db.getManorBuildingInfo(t).INFO[a];s.getComponent(cc.Label).string=l.RES[0].MAX}else if(2==o){p.getComponent(cc.Label).string="\u4ea7\u51fa\u52a0\u6210:";var g=app.db.getManorBuildingInfo(t).INFO,d=i.BUILDING[t];if(r.active=!!d,d){var u=g[d].RES[0][c],f=g[1].RES[0][c];s.getComponent(cc.Label).string=Math.abs((u-f)/f*100).toFixed(1)+"%"}3==t&&(r.active=!1)}})},refreshCost:function(){},onLevelUp:function(){var e=this,t=this.m_objHouse.id,a=this.m_objHouse.lv,i=app.db.getManorBuildingInfo(t).INFO[a].COST;app.player.sfManorBuild({bid:t},function(){app.player.reduceItem(i),e.m_objHouse.lv++,e.m_objHouse.target.onLevel(t),e.refreshUI(),e.playUpAnim(),app.player.refreshMostGeneral()})},onResGet:function(){var e=this;app.player.sfGetManorReward({pos:this.m_objHouse.id},function(t){app.player.addItem(t.items);var a={reward:t.items,showtype:1};app.pages.windowspagereward.showPage(a),e.m_objHouse.items=[],e.m_objHouse.target.getResourceRewardEnd(e.m_objHouse.id),e.refreshUI(),app.pages.manorpage.instance&&cc.isValid(app.pages.manorpage.instance.node)&&app.pages.manorpage.instance.node.active&&app.pages.manorpage.instance.getManorInfo()})},playUpAnim:function(){app.loadEff("shengji_01",this.p_animLevel,1,1)},onClose:function(){app.player.sfPlayerData(),this._super()}});cc._RF.pop()},{basePage:void 0,dbProperty:void 0}],manorSiegePage:[function(e,t){"use strict";cc._RF.push(t,"fa9bbqA+vdL4YHy6hj0bWlL","manorSiegePage");var a=[{GSID:38005,COUNT:100},{GSID:38005,COUNT:100},{GSID:38005,COUNT:100},{GSID:38005,COUNT:100},{GSID:38005,COUNT:100}],i=cc.Class({extends:e("basePage"),statics:{prefabPath:"manorsiegepage"},properties:{p_nodeEnemy:cc.Node,p_nodeNormal:cc.Node,p_nodeBoss:cc.Node,p_btnAutoFight:cc.Button,p_btnPatrol:cc.Button,p_spBoss:sp.Skeleton,p_barBlood:cc.ProgressBar,p_spAutoFight:sp.Skeleton,p_nodeMask:cc.Node,p_btnHelp:cc.Button,p_animNode:cc.Animation,p_btnAdd:cc.Button,p_labHay:cc.Label,p_spr38007:cc.Sprite},onLoad:function(){i.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.fitTopMenu(),this.p_nodeMask.active=!1,this.schedule(this.refreshBossTime,1)},handleUI:function(){var e=this;this._super(),this.p_nodeBoss.on("touchend",function(){app.playSound("click"),e.showBossPage()}),this.p_btnAutoFight.node.on("click",function(){app.playSound("click"),e.autoFight()}),this.p_btnPatrol.node.on("touchend",function(){app.playSound("click"),e.onPatrol()}),this.p_spAutoFight.setCompleteListener(function(t){cc.isValid(e)&&"animation2"==t.animation.name&&(e.p_nodeMask.active=!1,e.m_animEnd&&e.m_animEnd(),e.m_animEnd=null)}),app.loadTexture(gConfig.getIconNPropPath("38007"),this.p_spr38007),this.p_btnHelp.node.on("click",function(){app.pages.windowspagetipshelp.showPage("1030")}),this.p_btnAdd.node.on("click",function(){app.playSound("click"),e.onAddHay()})},setParam:function(){this.getFieldInfo();var e=gUtils.dateFormatter("YYYY-MM-DD",(new Date).getTime());localDataUtils.SetValue("manorred",e)},refreshUI:function(){var e=this.m_objData.enemy;this.m_arrEnemyItem=this.m_arrEnemyItem||[this.p_nodeEnemy],this.m_arrNormalItem=this.m_arrNormalItem||[this.p_nodeNormal];for(var t=0,a=0;a<gConfig.getManorMonsterCountV3();++a){var i=gConfig.getManorMonsterPointV3(a);if(a<e.length){var n=this.m_arrEnemyItem[a];n||((n=cc.instantiate(this.p_nodeEnemy)).parent=this.p_nodeEnemy.parent,this.m_arrEnemyItem.push(n)),n.setPosition(cc.v2(i.x,i.y)),n.getComponent("manorEnemyItem").initSelf(a,this.m_objData,this),cc.director.emit("EVT_ENEMY_INIT_COMPLETE")}else{var r=this.m_arrNormalItem[t];r||((r=cc.instantiate(this.p_nodeNormal)).parent=this.p_nodeNormal.parent,this.m_arrNormalItem.push(r)),r.setPosition(cc.v2(i.x,i.y)),t++}}for(var o=t;o<this.m_arrNormalItem.length;++o)this.m_arrNormalItem[o].active=!1;this.refreshHay()},refreshHay:function(){var e=app.pages.manorpage.instance&&app.pages.manorpage.instance.getFoodMax();this.p_labHay.string=e?gUtils.showCoinNum(app.player.getCount(38007))+"/"+e:gUtils.showCoinNum(app.player.getCount(38007))},refreshBossUI:function(){var e=this,t=this.m_objData.boss;1==t.state?(this.p_barBlood.node.active=!1,this.p_spBoss.node.active=!0,app.loadSpine(gConfig.rootPath.uispine+"manor_smog/yanwu",this.p_spBoss,function(){e.p_spBoss.setAnimation(0,"animation",!0)},null,this.prefabPath)):(this.p_barBlood.node.active=!0,this.p_barBlood.progress=t.nowhp/t.maxhp,this.p_spBoss.node.active=!1)},updateNormalEnemyState:function(e){cc.log("normal enemy battle over, index: "+e),this.m_objData.enemy[e].state=1;var t=this.m_arrEnemyItem[e];t?t.getComponent("manorEnemyItem").initSelf(e,this.m_objData,this):cc.log("can not find enemy node, something is wrong!!!")},refreshBossTime:function(){if(this.m_numBTime&&this.m_numETime){var e=app.player.getServerTime();(this.m_numBTime<=e||this.m_numETime<=e)&&(this.m_numBTime&&(this.m_numBTime=null),this.m_numETime&&(this.m_numETime=null),this.getFieldInfo())}},getFieldInfo:function(){var e=this;app.player.sfGetManorFieldInfo(function(t){if(e.m_objData&&2==e.m_objData.mop&&e.m_objData.mop==t.mop)return e.p_nodeMask.active=!0,void e.getFightInfo();switch(e.m_objData=t,e.m_numLv=t.blv,e.m_numBTime=t.btime,e.m_numETime=t.etime,e.refreshBossUI(),e.refreshBossTime(),t.mop){case 2:e.showAutoFightStart(),e.getFightInfo();break;case 3:t.items.length>=1&&(e.m_animEnd=function(){app.pages.windowspagereward.showPage({reward:t.items,showtype:1,confirmcb:function(){},target:e})}),app.player.sfPlayerByParam(["hide","others"],function(){e.refreshUI()}),e.showAutoFightEnd();break;default:e.refreshUI()}})},autoFight:function(){var e=this;this.m_numBTime?2!=this.m_objData.mop?app.player.getCount(38007)<1?app.showNotice(langMgr.getString("manorSiegePage",3)):n(this.m_objData.enemy)?app.pages.windowspagetipsmsg.showPage({content:langMgr.getString("manorSiegePage",8),confirmcb:function(){var t=gUtils.deepClone(app.player.battlearr[gConfig.battleForm.manor]);if(t)if(gUtils.getTableLength(t.team)<=0)app.showNotice(langMgr.getString("manorTeamPage",2));else{for(var a in t.team)app.player.general[t.team[a]]||delete t.team[a];gUtils.getTableLength(t.team)<=0?app.showNotice(langMgr.getString("manorTeamPage",2)):(console.log(t),app.player.sfManorAutoFight({battleset:t},function(){e.m_objData.mop=2,e.showAutoFightStart(),e.getFightInfo()}))}else app.showNotice(langMgr.getString("manorTeamPage",2))}}):app.showNotice(langMgr.getString("manorSiegePage",4)):app.showNotice(langMgr.getString("manorSiegePage",2)):app.showNotice(langMgr.getString("manorSiegePage",1))},getFightInfo:function(){this.scheduleOnce(this.getFieldInfo,3)},onPatrol:function(){var e=this;if(app.player.vip<3)app.showNotice(langMgr.getString("manorSiegePage",5));else{var t=app.player.getCount(90393)||0;if(t>=a.length)app.showNotice(langMgr.getString("manorSiegePage",6));else{var i=a[t].COUNT;if(app.player.getCount(a[t].GSID)<i)app.showNotice(langMgr.getString("manorSiegePage",7));else{var n={content:langMgr.getString("manorSiegePage",9,a[t].COUNT),confirmcb:function(){app.player.sfManorPatrol(function(){app.player.addItem([{gsid:90393,count:1}]),app.player.reduceItem([{gsid:a[t].GSID,count:a[t].COUNT}]),e.getFieldInfo(),e.p_animNode&&e.p_animNode.play("animation_switch_cloud_half")})},target:this};app.pages.windowspagetipsmsg.showPage(n)}}}},showBossPage:function(){var e=this.m_objData.boss;app.pages.manorbosspage.showPage({lv:this.m_numLv,damge:e.lastdamage,rtime:this.m_numBTime,target:this})},changeBossState:function(e){this.m_objData.boss.nowhp=e,e<=0&&(this.m_objData.boss.state=1),this.refreshBossUI()},jumpPage:function(){"boss"==app.manorboss&&this.showBossPage()},showAutoFightStart:function(){this.m_isHideMask=!1,this.p_nodeMask.active=!0,this.p_spAutoFight.setAnimation(0,"animation",!0)},showAutoFightEnd:function(){this.m_isHideMask=!0,this.p_nodeMask.active=!0,this.p_spAutoFight.setAnimation(0,"animation2",!1)},onAddHay:function(){var e=this;app.pages.manorpage.instance&&app.pages.manorpage.instance.getFood(function(){e.refreshHay()})},onClose:function(){this.p_nodeMask.activeInHierarchy||(this._super(),this.p_nodeMask.active=!1,app.pages.manorpage.instance&&app.pages.manorpage.instance.refreshRed())},shotErr:function(){}});function n(e){for(var t=0;t<e.length;++t)if(2==e[t].state)return!0;return!1}cc._RF.pop()},{basePage:void 0}],manorSweepPage:[function(e,t){"use strict";cc._RF.push(t,"d63d6qTY9VCxakKbmk2lXuU","manorSweepPage");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,a=1,i=arguments.length;a<i;a++)for(var n in t=arguments[a])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},r=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},o=cc._decorator,s=o.ccclass,p=o.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_rewardContent=null,t.p_pfbPropItem=null,t.p_btnConfirm=null,t.p_btnCancel=null,t.p_skeFighting=null,t.p_nodeMask=null,t.p_labGrain=null,t.p_sprGrainIcon=null,t.p_sliderNode=null,t.p_proBar=null,t.p_sliderCount=null,t.p_totalCount=null,t.p_btnUp=null,t.p_btnDown=null,t.m_manorlv=null,t.m_target=null,t.m_arrReward=[],t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,this.stopBgNodeEvent(),this.handleUI()},t.prototype.handleUI=function(){var t=this;e.prototype.handleUI.call(this),this.p_btnConfirm.node.on("click",this.confirmClickHandle.bind(this)),this.p_btnCancel.node.on("click",this.cancelClickHandle.bind(this)),this.p_skeFighting.setCompleteListener(this.request.bind(this)),this.p_sliderNode.on("slide",this.sliderHandle.bind(this)),this.p_btnUp.node.on("click",function(){app.playSound("click"),t.setNumUse(t.m_numEx+1)}),this.p_btnDown.node.on("click",function(){app.playSound("click"),t.setNumUse(t.m_numEx-1)})},t.prototype.setParam=function(e){this.m_manorlv=e.manorlv,this.m_target=e.target,this.resetNum(),this.refreshUI()},t.prototype.resetNum=function(){this.m_numMaxEx=app.player.getCount(a.grainGsid),this.m_numEx=this.m_numMaxEx>0?1:0},t.prototype.refreshUI=function(){this.refreshBtn(),this.setNumUse(this.m_numEx),app.loadTexture(gConfig.getIconNPropPath(a.grainGsid),this.p_sprGrainIcon),this.p_labGrain.string=app.player.getCount(a.grainGsid).toString()},t.prototype.refreshReward=function(){var e=this;app.db.getManorFarmsItemInfo(this.m_manorlv).forEach(function(t,a){var i=e.m_arrReward[a];i||((i=cc.instantiate(e.p_pfbPropItem)).scale=.9,e.p_rewardContent.addChild(i),e.m_arrReward.push(i)),i.active=!0;var r=n({},t);r.COUNT=t.COUNT*e.m_numEx,i.getComponent("propItem").initForBag(r),i.getComponent("propItem").setClick(!0)})},t.prototype.refreshBtn=function(){this.p_btnConfirm.interactable=app.player.getCount(a.grainGsid)>0},t.prototype.confirmClickHandle=function(){app.playSound("click"),app.player.getCount(a.grainGsid)<=0?app.showNotice(langMgr.getString("manorSiegePage",12)):(this.p_bgNode.opacity=0,this.p_nodeMask.active=!0,this.p_skeFighting.setAnimation(0,"animation",!1))},t.prototype.request=function(){var e=this;this.p_nodeMask.active=!1,app.player.sfManorAutoFight({times:this.m_numEx},function(t){var a=t.reward.filter(function(e){return!!app.db.getTypeByGsid(e.gsid||e.GSID)});app.player.addItem(a),app.player.sfPlayerByParam(["others","vip","hide","props"],function(){e.m_target.refreshGrain(),eventMgr.emit(eventStr.ManorSiegePage.RefreshRed),e.onClose(),app.pages.windowspagereward.showPage({showtype:1,reward:a,confirmcb:function(){}})})})},t.prototype.sliderHandle=function(){var e=this.p_sliderNode.getComponent(cc.Slider).progress,t=Math.round(this.m_numMaxEx*e),a=this.m_numMaxEx<=0?0:1;t=cc.misc.clampf(t,a,this.m_numMaxEx),this.setNumUse(t)},t.prototype.setNumUse=function(e){e||0==e||(e=this.m_numMaxEx),this.m_numMaxEx<=0?e=0:(e=Math.max(1,e),e=Math.min(this.m_numMaxEx,e)),this.m_numEx=e;var t=this.m_numMaxEx<=0?0:e/this.m_numMaxEx;this.p_sliderNode.getComponent(cc.Slider).progress=t,this.p_proBar.progress=t,this.p_sliderCount.string=e+"/"+this.m_numMaxEx,this.p_totalCount.string=langMgr.getString("manorSiegePage",13,[""+e]),this.refreshSetNum(),this.refreshReward()},t.prototype.refreshSetNum=function(){this.p_btnUp.interactable=app.player.getCount(a.grainGsid)>this.m_numEx,this.p_btnDown.interactable=this.m_numEx>1},t.prototype.cancelClickHandle=function(){app.playSound("cancel"),this.onClose()},t.prefabPath="manorsweeppage",t.pageType=1,t.grainGsid=38007,r([p(cc.Node)],t.prototype,"p_rewardContent",void 0),r([p(cc.Prefab)],t.prototype,"p_pfbPropItem",void 0),r([p(cc.Button)],t.prototype,"p_btnConfirm",void 0),r([p(cc.Button)],t.prototype,"p_btnCancel",void 0),r([p(sp.Skeleton)],t.prototype,"p_skeFighting",void 0),r([p(cc.Node)],t.prototype,"p_nodeMask",void 0),r([p(cc.Label)],t.prototype,"p_labGrain",void 0),r([p(cc.Sprite)],t.prototype,"p_sprGrainIcon",void 0),r([p(cc.Node)],t.prototype,"p_sliderNode",void 0),r([p(cc.ProgressBar)],t.prototype,"p_proBar",void 0),r([p(cc.Label)],t.prototype,"p_sliderCount",void 0),r([p(cc.RichText)],t.prototype,"p_totalCount",void 0),r([p(cc.Button)],t.prototype,"p_btnUp",void 0),r([p(cc.Button)],t.prototype,"p_btnDown",void 0),a=r([s],t)}(e("basePage"));t.exports=c,cc._RF.pop()},{basePage:void 0}],manorTeamPage:[function(e,t){"use strict";cc._RF.push(t,"8c7c9YY+C9GEbNDRcjwlDOQ","manorTeamPage");var a={gsid:38007,count:1},i=cc.Class({extends:e("basePage"),statics:{prefabPath:"manorteampage",pageType:1},properties:{p_listMission:cc.Node,mask:cc.Node,p_btnGo:cc.Button},onLoad:function(){i.instance=this,this.selectFriendIndex=-1,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){this._super()},setParam:function(e){this.m_target=e.target,this.m_callBack=e.cb,this.m_arrData=e.data,this.m_bossInfo=e.objParam;for(var t=0;t<this.m_arrData.length;t++)this.m_arrData[t].isTick=!1;this.refreshUI()},refreshUI:function(){this.mask.active=!1,this.refreshView()},refreshView:function(){cc.log(this.m_arrData),this.p_listMission.getComponent("listViewCtrl").initListView(this.m_arrData.length,this.m_arrData,"up",this)},setItemUnPick:function(e){this.selectFriendIndex=-1,this.m_arrData[e].isTick=!1,this.p_listMission.getComponent("listViewCtrl").reloadListView()},itemPick:function(e,t){var a=t.itemIndex;return e?(this.selectFriendIndex>=0&&this.setItemUnPick(this.selectFriendIndex),this.selectFriendIndex=a,!0):(a==this.selectFriendIndex&&(this.selectFriendIndex=-1),!1)},onClickStart:function(){if(cc.log("select friend index : "+this.selectFriendIndex),this.selectFriendIndex>=0&&this.selectFriendIndex<this.m_arrData.length){if(!app.player.getCountEnough(a))return app.showNotice(langMgr.getString("manorTeamPage",0)),void(this.mask.active=!1);this.quickFight()}else app.showNotice(langMgr.getString("manorTeamPage",1)),this.mask.active=!1},choose:function(){},quickFight:function(){var e=this;if(!this.checkNormalBset())return app.showNotice(langMgr.getString("manorTeamPage",2)),void(this.mask.active=!1);var t={friendid:this.m_arrData[this.selectFriendIndex].id},a={left:{iconid:this.m_arrData[this.selectFriendIndex].iconid,headid:this.m_arrData[this.selectFriendIndex].headid,frameid:this.m_arrData[this.selectFriendIndex].frameid,level:this.m_arrData[this.selectFriendIndex].level},right:this.m_bossInfo};app.player.sfManorFightStart(t,function(t,i){if(t)return"not bset"==t?app.showNotice(langMgr.getString("manorTeamPage",3)):app.showNotice(t),void(e.mask.active=!1);app.player.sfManorFightEnd({battleid:i.battleid},function(t,i){if(t)return app.pages.quickbattleloadpage.instance&&cc.isValid(app.pages.quickbattleloadpage.instance.node)&&app.pages.quickbattleloadpage.instance.onClose(),app.showNotice(t),void(e.mask.active=!1);app.player.sfPlayerByParam(["others","hide","props"],function(){app.pages.quickbattleresultpage.showPage({type:"manor",info:a,result:i,refreshCb:function(){e.mask.active=!1,e.onClose(),app.pages.manorenemypage.instance&&app.pages.manorenemypage.instance.refreshBtn(),app.pages.manorenemypage.instance&&cc.isValid(app.pages.manorenemypage.instance.node)&&app.pages.manorenemypage.instance.battleFinish(3==i.kill)}})})})})},checkNormalBset:function(){var e=app.player.battlearr.normal.team;for(var t in e)return!0;return!1}});i.showPage=function(t,a,i){var n=this;app.player.sfGetManorFriendList({battleset:"normal"},function(r,o){if(r)return cc.log(r),void app.showNotice(r);e("basePage").showPage.apply(n,[{data:o,objParam:t},a,i])})},cc._RF.pop()},{basePage:void 0}],mapEvent:[function(e,t){"use strict";cc._RF.push(t,"980c0dnJCJDSJRZsrLTzyaD","mapEvent");var a=e("dbESpring");cc.Class({extends:cc.Component,properties:{p_nodeEventTips:cc.Node,p_sprLv:cc.Sprite,p_sprIcon:cc.Sprite,p_labIntro:cc.Label,p_pfbEventItem:cc.Prefab,p_nodeSpringItem:cc.Node},onLoad:function(){app.mapEvent=this,this.p_nodeSpringItem.active=!1,this.m_objCityPos=app.db.getJsonData("citypos"),this.handleUI()},handleUI:function(){var e=this;this.p_nodeEventTips.on("touchend",function(){app.playSound("click"),e.m_goToCb&&e.m_goToCb(),e.m_goToCb||app.showNotice(langMgr.getString("mapEvent",0))})},initEvent:function(e){this.refreshEvent(e)},refreshEvent:function(e){if(this.m_numCity=app.db.getMapInfo(app.player.maxmapid).CITY,this.m_numCity>104){this.m_objEventItems=this.m_objEventItems||{},this.m_eventData=e;var t=[];for(var a in e){t.push(a);var i=e[a],n=app.db.getMapEventInfo(i.type,i.eid);n.type=i.type,i.info=n;var r=this.m_objCityPos[a];this.m_objEventItems[a]=this.m_objEventItems[a]||{};var o=this.m_objEventItems[a].node;o||((o=cc.instantiate(this.p_pfbEventItem)).parent=this.node,o.setPosition(r.x,r.y),this.m_objEventItems[a].node=o,this.m_objEventItems[a].info=n),o.getComponent("mapEventItem").initSelf(a,i,this)}for(var s in this.m_objEventItems)-1==t.indexOf(s)&&(this.m_objEventItems[s].node.destroy(),delete this.m_objEventItems[s]);this.refreshSpringEvent()}else this.refreshSpringEvent()},refreshSpringBattle:function(){var e=this,t=this.m_numCity,i=app.player.getCount(90330);if(t<=106||i>=a.queue.length||app.springEventTime&&app.player.getServerTime()>app.springEventTime)return this.m_objSEvent=null,this.p_nodeSpringItem.active=!1,void this.setRecEvent();app.player.sfSpringEvent(function(t){t.pos?e.p_nodeSpringItem.getComponent("eventSpringItem").refreshHp({nowhp:t.info.nowhp,damage:t.info.damage}):(e.p_nodeSpringItem.active=!1,app.checkPageValid("bigbattlebossinfopage")&&app.pages.bigbattlebossinfopage.instance.node.active&&app.pages.bigbattlebossinfopage.instance.onClose(),app.pages.windowspagetalk.showPage({result:function(){info.to?app.pages.windowspagenoticebingo.showPage({str:info.to,cb:e.getSpringReward.bind(e)}):e.getSpringReward()},talk:info.talk}))})},refreshSpringEvent:function(){this.m_lastBossPos=app.sBossPos,app.sBossPos=null;var e=this.m_numCity,t=app.player.getCount(90330);if(e<=106||t>=a.queue.length||app.springEventTime&&app.player.getServerTime()>app.springEventTime)return this.m_objSEvent=null,this.p_nodeSpringItem.active=!1,void this.setRecEvent();this.getSpringEvent(t)},getSpringEvent:function(e){var t=this,i=app.db.getEventSpringInfo(e),n=i.type,r=i.mid,o=i.icon;app.player.sfSpringEvent(function(e){var i=e.pos,s=e.info,p=e.stime,c=e.etime;app.springEventTime=c;var h=app.player.getServerTime();if(h<=p||h>=c)return t.m_objSEvent=null,t.p_nodeSpringItem.active=!1,void t.setRecEvent();var l=a.event[n][r];t.m_objSEvent={pos:i,type:n,mid:r,icon:o,bossinfo:s,info:l},i?(t.p_nodeSpringItem.setPosition(t.m_objCityPos[i].x,t.m_objCityPos[i].y),t.p_nodeSpringItem.getComponent("eventSpringItem").initSelf(t.m_objSEvent,t,t.m_lastBossPos)):(t.p_nodeSpringItem.active=!1,app.pages.windowspagetalk.showPage({result:function(){l.to?app.pages.windowspagenoticebingo.showPage({str:l.to,cb:t.getSpringReward.bind(t)}):t.getSpringReward()},talk:l.talk})),t.setRecEvent()})},getSpringReward:function(){var e=this;app.player.sfSpringFinish(function(t){var i=t;if(i.push({gsid:90330,count:1}),app.player.addItem(i),i.length>=2){var n=app.player.getCount(90330)>=a.queue.length;app.pages.windowspagereward.showPage({showtype:1,reward:i,confirmcb:e.refreshSpringEvent,target:e,isShowSpring:n})}else e.refreshSpringEvent()})},setRecEvent:function(){var e=this;if(this.m_goToCb=null,this.m_objSEvent){var t=this.m_objSEvent.pos;if(t){this.m_goToCb=function(){e.p_nodeSpringItem.getComponent("eventSpringItem").goToSpringEvent()};var a="";switch(this.m_objSEvent.type){case 1:gConfig.rootPath.uimapevent,a=app.db.getGNameByGsid(this.m_objSEvent.icon);break;case 2:var i=this.m_objSEvent.icon;a=app.db.getGNameByGsid(i),app.db.getGHeadIconByGsid(i);break;case 3:var n=this.m_objSEvent.info.ggsid;a=this.m_objSEvent.info.gname,n?app.db.getGHeadIconByGsid(n):gConfig.rootPath.uimapevent}gConfig.rootPath.uimapevent;var r=app.db.getMapEventCity(t).NAME;cc.js.formatStr("%s\u4f3c\u4e4e\u5728%s\u9644\u8fd1\u51fa\u73b0...",a,r)}else this.p_nodeEventTips.active=!1}else{var o=null,s=function(t){var a=e.m_objEventItems[t].info;(!o||a.lv>o.lv)&&((o=a).id=t,e.m_goToCb=function(){e.m_objEventItems[t].node.getComponent("mapEventItem").openPage()})};for(var p in this.m_objEventItems)s(p);if(o){var c=o.type;1==c?app.db.getGHeadIconByGsid(o.icon):gConfig.rootPath.uimapevent;var h=app.db.getMapEventCity(o.id).NAME;gConfig.rootPath.uimapevent,o.lv,cc.js.formatStr("%s\u9644\u8fd1\u4f3c\u4e4e\u6709\u4e8b\u60c5\u53d1\u751f...",h)}else this.p_nodeEventTips.active=!1}},refreshEventTipsUI:function(e,t,a){this.p_nodeEventTips.active=!0,app.loadTexture(e,this.p_sprIcon,app.pages.newworldmappage.prefabPath),app.loadTexture(a,this.p_sprLv,app.pages.newworldmappage.prefabPath),this.p_labIntro.string=t},destroyEventItem:function(e){this.m_objEventItems[e].node.destroy(),delete this.m_objEventItems[e],this.setRecEvent()}}),cc._RF.pop()},{dbESpring:void 0}],missionPage:[function(e,t){"use strict";cc._RF.push(t,"fcf56roS2BPp7FHs8WyAphA","missionPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"missionpage",pageType:1},properties:{p_nodeAll:cc.Node,p_nodeBgDaily:cc.Node,p_tabvDaily:cc.tableView,p_nodeBgAchieve:cc.Node,p_tabvAchieve:cc.tableView},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!1),this.handleUI(),this.m_menu=this.node.getComponent("menu"),this.m_menu.init(this)},handleUI:function(){this._super()},setParam:function(e){switch(e||(e="daily"),this.m_strShowType=e,this.m_strShowType){case"daily":this.m_menu.setMenuIndex(0);break;case"achieve":this.m_menu.setMenuIndex(1)}},refreshUI:function(){"daily"==this.m_strShowType?(this.p_nodeAll.active=!0,this.p_nodeBgDaily.active=!0,this.p_nodeBgAchieve.active=!1,this.refreshDailyAll()):(this.p_nodeAll.active=!1,this.p_nodeBgDaily.active=!1,this.p_nodeBgAchieve.active=!0),this.refreshView()},refreshMenuRed:function(e){var t=!1;return 0==e&&(t=app.pages.missionpage.checkDailyRed()),1==e&&(t=app.pages.missionpage.checkAchieve()),t},refreshDailyAll:function(){for(var e=gUtils.deepClone(app.db.dbMissionDailyScore),t=0;t<e.length;t++)for(var a=e[t],i=0;i<a.REWARD.length;i++)a.REWARD[i].PARAM&&(a.REWARD[i].COUNT=a.REWARD[i].PARAM*app.player.level+a.REWARD[i].COUNT);this.p_nodeAll.getComponent("missionAllItem").refreshUI(e)},refreshView:function(){var e=this;if(this.m_arrShowData){var t=this.m_arrShowData.length;this.m_tabvShowView.initTableView(t,{array:this.m_arrShowData,target:this},function(){e.m_tabvShowView.getCells(function(e){app.playVerticalListAction(e,["y","scale"])})}),this.refreshRed()}},reloadView:function(){this.m_arrShowData&&(this.m_arrShowData="daily"==this.m_strShowType?this.setDailyData():this.setAchieveData(),this.m_tabvShowView.getComponent("tableView").reload({array:this.m_arrShowData,target:this}),this.refreshRed())},refreshRed:function(){this.m_menu.refreshRed()},setDailyData:function(){for(var e=[],t=app.db.dbMissionDaily,a=0;a<t.length;++a){var i=t[a];i.PMARK&&(i.ID=a,e.push(i))}return e.sort(function(e,t){var a=app.player.getMissionState(e).state,i=app.player.getMissionState(t).state;return a<i?1:a==i&&e.ID>t.ID?1:-1}),e},setAchieveData:function(){for(var e=[],t=app.db.dbMissionAchieve,a=0;a<t.length;++a){var i=t[a];if(i){var n=app.player.getCount(i.GETMARK),r=i.MISSION[n];r||(r=i.MISSION[i.MISSION.length-1]),r.PMARK&&(r.SERIES=a,e.push(r))}}return e.sort(function(e,t){var a=app.player.getMissionState(e).state,i=app.player.getMissionState(t).state;return a<i?1:a==i&&e.SERIES>t.SERIES?1:-1}),e},menuHandler:function(e){switch(e){case 0:this.m_strShowType="daily",this.m_arrShowData=this.setDailyData(),this.m_tabvShowView=this.p_tabvDaily;break;case 1:this.m_strShowType="achieve",this.m_arrShowData=this.setAchieveData(),this.m_tabvShowView=this.p_tabvAchieve}this.refreshUI()},getNumDailyEnd:function(){var e=0;if(this.m_arrShowData){for(var t=0;t<this.m_arrShowData.length;++t){var a=this.m_arrShowData[t];app.player.getCount(a.GETMARK)>0&&++e}return e}},onClose:function(){this._super()}});a.showPage=function(t){var a=this;app.player.sfPlayerByParam(["others"],function(){e("basePage").showPage.call(a,t)})},a.refreshRed=function(e){var t=a.checkDailyRed(),i=a.checkAchieve();cc.log(t,i);var n=!1;return(t||i)&&(n=!0),e&&(e.active=n),n},a.checkDailyRed=function(){for(var e=[],t=app.db.dbMissionDaily,a=0;a<t.length;++a){var i=t[a];if(i.PMARK){var n=app.player.getMissionState(i).state;if(3==n)return!0;e.push(i)}}for(var r=app.db.dbMissionDailyScore,o=0;o<5;++o){var s=r[o];if(3==app.player.getMissionState(s).state)return!0}return!1},a.checkAchieve=function(){for(var e=[],t=app.db.dbMissionAchieve,a=0;a<t.length;++a){var i=t[a];if(i){var n=app.player.getCount(i.GETMARK),r=i.MISSION[n];r||(r=i.MISSION[i.MISSION.length-1]),r.PMARK&&(r.SERIES=a,e.push(r))}}for(var o=0;o<e.length;++o){var s=e[o];if(3==app.player.getMissionState(s).state)return!0}return!1},cc._RF.pop()},{basePage:void 0}],nationWarRankPage:[function(e,t){"use strict";cc._RF.push(t,"ebe3aCGn0ZJ8aWEVL/hqTD7","nationWarRankPage");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=e("basePage"),o=cc._decorator,s=o.ccclass,p=o.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_playerRankTableView=null,t.p_countryRankTableView=null,t.p_nodeTitle=[],t.p_playerItem=null,t.p_countryItem=null,t.p_labTip=null,t.curIndex=0,t.m_rankdata=null,t.isCreate=[!1,!1],t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,e.prototype.onLoad.call(this),this.m_menu=this.node.getComponent("menu"),this.m_menu.init(this)},t.prototype.onEnable=function(){e.prototype.onEnable.call(this)},t.prototype.onDisable=function(){e.prototype.onDisable.call(this)},t.prototype.onDestroy=function(){e.prototype.onDestroy.call(this)},t.prototype.onClose=function(){e.prototype.onClose.call(this)},t.prototype.handleUI=function(){e.prototype.handleUI.call(this)},t.prototype.setParam=function(){var e=this;this.curIndex=-1,this.isCreate=[!1,!1],this.p_countryRankTableView.active=this.p_countryItem.active=!1,this.p_playerRankTableView.active=this.p_playerItem.active=!1,this.p_nodeTitle.forEach(function(e){e.active=!1}),app.player.sfGetFiveWarRank({areamark:app.fiveWarInfo.myareamark},function(t,a){t?app.showNotice(t):(e.m_rankdata=a,e.m_rankdata.servers.sort(function(e,t){return t.wincount-e.wincount}),e.m_menu.setMenuIndex(0))})},t.prototype.refreshData=function(){var e=this;if(this.p_nodeTitle.forEach(function(t,a){t.active=e.curIndex==a}),this.p_labTip.string=langMgr.getString("nationwarrankpage",this.curIndex),this.m_rankdata){this.p_countryRankTableView.active=this.p_countryItem.active=1==this.curIndex,this.p_playerRankTableView.active=this.p_playerItem.active=0==this.curIndex;var t=1==this.curIndex?this.p_countryRankTableView:this.p_playerRankTableView,a=1==this.curIndex?this.p_countryItem:this.p_playerItem,i=1==this.curIndex?"nationWarRankCountryItem":"nationWarRankPlayerItem",n=1==this.curIndex?this.m_rankdata.servers:this.m_rankdata.user,r=this.getMyRankInfo();this.isCreate[this.curIndex]||(t.getComponent("tableView").initTableView(n.length,{array:n,target:this}),this.isCreate[this.curIndex]=!0,a.getComponent(i).refreshUI(r.rank,r.index,this))}},t.prototype.menuHandler=function(e){return this.curIndex=e,this.refreshData(),!0},t.prototype.getMyRankInfo=function(){var e={rank:{},index:-1};return 1==this.curIndex?this.m_rankdata.servers&&this.m_rankdata.servers.length>0&&this.m_rankdata.servers.forEach(function(t,a){t.areamark==app.fiveWarInfo.myareamark&&(e.rank=t,e.index=a)}):(this.m_rankdata.my.servid=app.player.servid,e.rank=this.m_rankdata.my,this.m_rankdata.user.forEach(function(t,a){t.rid==app.player.id&&(e.index=a)})),e},t.prefabPath="nationwarrankpage",n([p(cc.Node)],t.prototype,"p_playerRankTableView",void 0),n([p(cc.Node)],t.prototype,"p_countryRankTableView",void 0),n([p([cc.Node])],t.prototype,"p_nodeTitle",void 0),n([p(cc.Node)],t.prototype,"p_playerItem",void 0),n([p(cc.Node)],t.prototype,"p_countryItem",void 0),n([p(cc.Label)],t.prototype,"p_labTip",void 0),a=n([s],t)}(r);c.refreshRed=function(e){var t=!1;return app.player.getCount(38020)>0&&(t=!0),e&&(e.active=t),t},t.exports=c,cc._RF.pop()},{basePage:void 0}],nationWarRewardFinalPage:[function(e,t){"use strict";cc._RF.push(t,"85c35RTg0lEBpf9znbchPG8","nationWarRewardFinalPage");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=e("basePage"),o=cc._decorator,s=o.ccclass,p=o.property,c=function(){function e(){this.p_sprFlag=null,this.p_labServ=null,this.p_labCountry=null,this.p_labKingName=null,this.p_labTeam=null,this.m_data=null}return e.prototype.refreshUI=function(e){this.m_data=e;var t=app.db.getCountryFlagByIndex(e.icon);app.loadTexture(t,this.p_sprFlag,app.pages.nationwarrewardfinalpage.prefabPath),this.p_labCountry&&(this.p_labCountry.string=e.name||""),this.p_labKingName&&(this.p_labKingName.string=e.kingname||""),this.p_labServ&&(this.p_labServ.string=gUtils.getServNameForShow(e.servid));var a=0;for(var i in e.team)e.team[i].forEach(function(e){a+=Number(e)});this.p_labTeam&&(this.p_labTeam.string=a.toString())},n([p(cc.Sprite)],e.prototype,"p_sprFlag",void 0),n([p(cc.Label)],e.prototype,"p_labServ",void 0),n([p(cc.Label)],e.prototype,"p_labCountry",void 0),n([p(cc.Label)],e.prototype,"p_labKingName",void 0),n([p(cc.Label)],e.prototype,"p_labTeam",void 0),n([s("nationWarRewardFinalItem")],e)}(),h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_nodeSkills=[],t.p_sprBox=null,t.p_nodeBox=null,t.m_data=null,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,e.prototype.onLoad.call(this),e.prototype.stopBgNodeEvent.call(this),e.prototype.creatMask.call(this,!0)},t.prototype.onEnable=function(){e.prototype.onEnable.call(this)},t.prototype.onDisable=function(){e.prototype.onDisable.call(this)},t.prototype.onDestroy=function(){e.prototype.onDestroy.call(this)},t.prototype.onClose=function(){e.prototype.onClose.call(this)},t.prototype.handleUI=function(){var t=this;e.prototype.handleUI.call(this),this.isGet=!1,this.p_sprBox.node.on("touchend",function(){if(t.isGet)app.showNotice(langMgr.getString("nationwarrewardfinalpage",0));else{if(!t.isCanGet())return app.showNotice(langMgr.getString("nationwarrewardfinalpage",1)),void e.prototype.onClose.call(t);app.playSound("click"),app.player.sfGetFiveWarReward({type:"final"},function(e,a){if(e)app.showNotice(e);else{t.isGet=!0;var i={showtype:1,reward:a.rewards,target:t};app.player.addItem(a.rewards),app.pages.windowspagereward.showPage(i)}})}})},t.prototype.setParam=function(){app.fiveWarInfo&&(this.m_data=gUtils.deepClone(app.fiveWarInfo.areas),this.m_data.sort(function(e,t){return 0==e.isout&&0==t.isout?e.nowhp==t.nowhp?e.servid-t.servid:t.nowhp-e.nowhp:0==e.isout||0==t.isout?e.isout-t.isout:t.isout-e.isout}),this.refreshData())},t.prototype.refreshData=function(){var e=this;this.p_nodeSkills.forEach(function(t,a){e.m_data[a]&&t.refreshUI(e.m_data[a])}),this.p_nodeBox.active=app.fiveWarInfo.rewards&&app.fiveWarInfo.rewards.length>0&&app.fiveWarInfo.rewards.indexOf("final")>=0},t.prototype.isCanGet=function(){return 3==app.fiveWarInfo.getState()},t.prefabPath="nationwarrewardfinalpage",t.pageType=1,n([p({type:[c]})],t.prototype,"p_nodeSkills",void 0),n([p(cc.Sprite)],t.prototype,"p_sprBox",void 0),n([p(cc.Node)],t.prototype,"p_nodeBox",void 0),a=n([s],t)}(r);h.refreshRed=function(e){var t=!1;return app.player.getCount(38020)>0&&(t=!0),e&&(e.active=t),t},t.exports=h,cc._RF.pop()},{basePage:void 0}],nationWarRewardOpenPage:[function(e,t){"use strict";cc._RF.push(t,"c14edXYVJNLpKy0ILSKAPFK","nationWarRewardOpenPage");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=e("basePage"),o=cc._decorator,s=o.ccclass,p=o.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_arrPropItem=[],t.p_btnGet=null,t.m_data=null,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,e.prototype.onLoad.call(this),e.prototype.stopBgNodeEvent.call(this),e.prototype.creatMask.call(this,!0)},t.prototype.onEnable=function(){e.prototype.onEnable.call(this)},t.prototype.onDisable=function(){e.prototype.onDisable.call(this)},t.prototype.onDestroy=function(){e.prototype.onDestroy.call(this)},t.prototype.onClose=function(){e.prototype.onClose.call(this)},t.prototype.handleUI=function(){var t=this;e.prototype.handleUI.call(this),this.p_btnGet.node.on("click",function(){t.isGet?app.showNotice(langMgr.getString("nationwarrewardfinalpage",0)):(app.playSound("click"),app.player.sfGetFiveWarReward({type:"open"},function(e,a){if(e)app.showNotice(e);else{t.isGet=!0,t.refreshData();var i={showtype:1,reward:a.rewards,target:t};app.player.addItem(a.rewards),app.pages.windowspagereward.showPage(i)}}))})},t.prototype.setParam=function(e){this.isGet=!1,this.m_data=e,this.refreshData()},t.prototype.refreshData=function(){for(var e=app.db.dbNationWarRewards.OPEN_REWARD,t=0;t<this.p_arrPropItem.length;t++)if(e[t]){var a=this.p_arrPropItem[t];a.active=!0,a.getComponent("propItem").initForBag(e[t]),a.getComponent("propItem").setClick(!0)}else this.p_arrPropItem[t].active=!1;this.p_btnGet.interactable=!this.isGet},t.prefabPath="nationwarrewardopenpage",t.pageType=1,n([p([cc.Node])],t.prototype,"p_arrPropItem",void 0),n([p(cc.Button)],t.prototype,"p_btnGet",void 0),a=n([s],t)}(r);c.refreshRed=function(e){var t=!1;return app.player.getCount(38020)>0&&(t=!0),e&&(e.active=t),t},t.exports=c,cc._RF.pop()},{basePage:void 0}],nationWarRewardPage:[function(e,t){"use strict";cc._RF.push(t,"8c9c5xcQPNN35iVlOMSS2X8","nationWarRewardPage");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=e("basePage"),o=cc._decorator,s=o.ccclass,p=o.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_rewardTableView=null,t.p_joinReward=null,t.p_seeReward=null,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,e.prototype.onLoad.call(this),e.prototype.stopBgNodeEvent.call(this),e.prototype.creatMask.call(this,!0)},t.prototype.onEnable=function(){e.prototype.onEnable.call(this)},t.prototype.onDisable=function(){e.prototype.onDisable.call(this)},t.prototype.onDestroy=function(){e.prototype.onDestroy.call(this)},t.prototype.onClose=function(){e.prototype.onClose.call(this)},t.prototype.handleUI=function(){e.prototype.handleUI.call(this)},t.prototype.setParam=function(){this.refreshData()},t.prototype.refreshData=function(){var e=app.db.dbNationWarRewards.RANK_REWARD;this.p_rewardTableView.getComponent("tableView").initTableView(e.length,{array:e,target:this}),this.p_joinReward.getComponent("nationWarRewardItem").refreshUI({REWARDS:app.db.dbNationWarRewards.ROUND_REWARD.match}),this.p_seeReward.getComponent("nationWarRewardItem").refreshUI({REWARDS:app.db.dbNationWarRewards.ROUND_REWARD.audi})},t.prefabPath="nationwarrewardpage",t.pageType=1,n([p(cc.Node)],t.prototype,"p_rewardTableView",void 0),n([p(cc.Node)],t.prototype,"p_joinReward",void 0),n([p(cc.Node)],t.prototype,"p_seeReward",void 0),a=n([s],t)}(r);c.refreshRed=function(e){var t=!1;return app.player.getCount(38020)>0&&(t=!0),e&&(e.active=t),t},t.exports=c,cc._RF.pop()},{basePage:void 0}],nationWarRewardRoundPage:[function(e,t){"use strict";cc._RF.push(t,"c445fNz0G1ArKj4lPo5AH6E","nationWarRewardRoundPage");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=e("basePage"),o=cc._decorator,s=o.ccclass,p=o.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_sprframeRounds=[],t.p_sprRound=null,t.p_labOutServ=null,t.p_btnGet=null,t.m_type=null,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,e.prototype.onLoad.call(this),e.prototype.stopBgNodeEvent.call(this),e.prototype.creatMask.call(this,!0)},t.prototype.onEnable=function(){e.prototype.onEnable.call(this)},t.prototype.onDisable=function(){e.prototype.onDisable.call(this)},t.prototype.onDestroy=function(){e.prototype.onDestroy.call(this)},t.prototype.onClose=function(){e.prototype.onClose.call(this)},t.prototype.handleUI=function(){var t=this;e.prototype.handleUI.call(this),this.isGet=!1,this.p_btnGet.node.on("click",function(){if(t.isGet)app.showNotice(langMgr.getString("nationwarrewardfinalpage",0));else{if(!t.isCanGet())return app.showNotice(langMgr.getString("nationwarrewardfinalpage",1)),void e.prototype.onClose.call(t);app.playSound("click"),app.player.sfGetFiveWarReward({type:t.m_type},function(e,a){if(e)app.showNotice(e);else{t.isGet=!0;var i={showtype:1,reward:a.rewards,target:t};app.player.addItem(a.rewards),app.pages.windowspagereward.showPage(i)}})}})},t.prototype.setParam=function(e){this.m_type=e,this.refreshData()},t.prototype.refreshData=function(){var e=this;this.p_sprRound.spriteFrame=this.p_sprframeRounds[app.fiveWarInfo.round-1],this.p_labOutServ.string="",app.fiveWarInfo.areas.forEach(function(t){t.isout==app.fiveWarInfo.round&&(e.p_labOutServ.string=gUtils.getServNameForShow(t.servid))})},t.prototype.isCanGet=function(){return 3==app.fiveWarInfo.getState()},t.prefabPath="nationwarrewardroundpage",t.pageType=1,n([p([cc.SpriteFrame])],t.prototype,"p_sprframeRounds",void 0),n([p(cc.Sprite)],t.prototype,"p_sprRound",void 0),n([p(cc.Label)],t.prototype,"p_labOutServ",void 0),n([p(cc.Button)],t.prototype,"p_btnGet",void 0),a=n([s],t)}(r);c.refreshRed=function(e){var t=!1;return app.player.getCount(38020)>0&&(t=!0),e&&(e.active=t),t},t.exports=c,cc._RF.pop()},{basePage:void 0}],newExpeditionAutobattlePage:[function(e,t){"use strict";cc._RF.push(t,"c44fcLAUsVPLoLyTtoJNBNM","newExpeditionAutobattlePage");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=e("basePage"),o=cc._decorator,s=o.ccclass,p=o.property,c="newexpeditionautobattlestar",h="newexpeditionautobattlecard",l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_toggleStar=null,t.p_toggleItemStar=[],t.p_toggleCard=null,t.p_toggleItemCard=[],t.p_btnConfirm=null,t.m_target=null,t.m_indexStar=1,t.m_indexCard=1,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,e.prototype.onLoad.call(this),e.prototype.stopBgNodeEvent.call(this),e.prototype.creatMask.call(this,!0)},t.prototype.onEnable=function(){e.prototype.onEnable.call(this)},t.prototype.onDisable=function(){e.prototype.onDisable.call(this)},t.prototype.onDestroy=function(){e.prototype.onDestroy.call(this)},t.prototype.onClose=function(){e.prototype.onClose.call(this)},t.prototype.handleUI=function(){var t=this;e.prototype.handleUI.call(this),this.p_toggleItemStar.forEach(function(e,a){e.node.on("toggle",function(){t.m_indexStar=a})}),this.p_toggleItemCard.forEach(function(e,a){e.node.on("toggle",function(){t.m_indexCard=a})}),this.p_btnConfirm.node.on("click",function(){app.playSound("click"),localDataUtils.SetValue(c,t.m_indexStar+1),localDataUtils.SetValue(h,t.m_indexCard+1),t.m_target.autoBattleStart({starIndex:t.m_indexStar,cardIndex:t.m_indexCard}),t.onClose()})},t.prototype.setParam=function(e){this.m_target=e,this.refreshData()},t.prototype.refreshData=function(){this.m_indexStar=localDataUtils.GetValue(c,1)-1,this.p_toggleItemStar[this.m_indexStar].check(),this.m_indexCard=localDataUtils.GetValue(h,1)-1,this.p_toggleItemCard[this.m_indexCard].check()},t.prefabPath="newexpeditionautobattlepage",t.pageType=1,n([p(cc.ToggleContainer)],t.prototype,"p_toggleStar",void 0),n([p([cc.Toggle])],t.prototype,"p_toggleItemStar",void 0),n([p(cc.ToggleContainer)],t.prototype,"p_toggleCard",void 0),n([p([cc.Toggle])],t.prototype,"p_toggleItemCard",void 0),n([p(cc.Button)],t.prototype,"p_btnConfirm",void 0),a=n([s],t)}(r);l.refreshRed=function(e){return e&&(e.active=!1),!1},t.exports=l,cc._RF.pop()},{basePage:void 0}],newExpeditionBoxPage:[function(e,t){"use strict";cc._RF.push(t,"50bfdy21o5KXJArOMwt5Xw9","newExpeditionBoxPage");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=e("basePage"),o=cc._decorator,s=o.ccclass,p=o.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_nodeReward=null,t.p_titleAnim=null,t.m_target=null,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,e.prototype.onLoad.call(this),e.prototype.stopBgNodeEvent.call(this)},t.prototype.onEnable=function(){e.prototype.onEnable.call(this)},t.prototype.onDisable=function(){e.prototype.onDisable.call(this)},t.prototype.onDestroy=function(){e.prototype.onDestroy.call(this)},t.prototype.onClose=function(){e.prototype.onClose.call(this)},t.prototype.handleUI=function(){var t=this;e.prototype.handleUI.call(this),this.p_nodeReward.on("touchend",function(){app.playSound("click"),app.player.sfNewExpeditionGetReward({index:0}).then(function(){var e={showtype:1,reward:app.newExpeditionInfo.boxreward,confirmcb:function(){app.newExpeditionInfo.ispass&&eventMgr.emit(eventStr.newExpeditionEvent.RefreshNewExpeditionShopAnimal)},target:t};app.pages.windowspagereward.showPage(e),app.player.addItem(app.newExpeditionInfo.boxreward),app.newExpeditionInfo.getBoxFinish(),eventMgr.emit(eventStr.newExpeditionEvent.RefreshNewExpeditionInfo),t.onClose()})})},t.prototype.setParam=function(e){this.m_target=e,this.refreshData()},t.prototype.refreshData=function(){},t.prefabPath="newexpeditionboxpage",t.pageType=1,n([p(cc.Node)],t.prototype,"p_nodeReward",void 0),n([p(sp.Skeleton)],t.prototype,"p_titleAnim",void 0),a=n([s],t)}(r);c.refreshRed=function(e){return e&&(e.active=!1),!1},t.exports=c,cc._RF.pop()},{basePage:void 0}],newExpeditionBuffPage:[function(e,t){"use strict";cc._RF.push(t,"3c462nghM1JV6uit1ktn9JJ","newExpeditionBuffPage");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=e("basePage"),o=cc._decorator,s=o.ccclass,p=o.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_title=null,t.p_itemContent=null,t.p_itemNode=null,t.p_tipNode=null,t.m_arrItems=[],t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,e.prototype.onLoad.call(this),e.prototype.stopBgNodeEvent.call(this),e.prototype.creatMask.call(this,!0)},t.prototype.onEnable=function(){e.prototype.onEnable.call(this)},t.prototype.onDisable=function(){e.prototype.onDisable.call(this)},t.prototype.onDestroy=function(){e.prototype.onDestroy.call(this)},t.prototype.onClose=function(){e.prototype.onClose.call(this)},t.prototype.handleUI=function(){e.prototype.handleUI.call(this)},t.prototype.setParam=function(e){void 0===e&&(e={type:"expedition"}),this.refreshData(e)},t.prototype.refreshData=function(e){var t=[];switch(e.type){case"stone":this.p_title.string=1==e.m_type?"\u5149\u5c5e\u6027\u9884\u89c8":"\u6697\u5c5e\u6027\u9884\u89c8",t=app.db.dbSoulStoneInfo.ATTR[1==e.m_type?30005:40005].map(function(e){var t,a,i=null!==(t=e.key)&&void 0!==t?t:e.KEY,n=null!==(a=e.val)&&void 0!==a?a:e.VAL,r=n,o=app.db.getPropertyIdByEn(i);return n&&o&&2==app.db.dbProperty[o].NUMTYPE&&(r=r/10+"%"),{title:app.db.getPropertyCnByEn(i),num:r}});break;case"expedition":default:t=app.newExpeditionInfo.cardbag.filter(function(e){return!!e&&!!app.db.dbCard[e]}).map(function(e){var t=app.db.dbCard[e];return{title:""+t.TITLE.split("+")[0],num:t.TITLE.replace(/[^0-9]/gi,""),isCon:!0}})}var a={};t.forEach(function(e){if(e.isCon){var t=Number(e.num);a[e.title]&&(t+=Number(a[e.title].replace(/[^0-9]/gi,""))),a[e.title]="+"+t+"%"}else a[e.title]=e.num}),cc.log(a),this.p_tipNode.active=t.length<=0,(!this.m_arrItems||this.m_arrItems.length<=0)&&(this.m_arrItems=[this.p_itemNode]);for(var i=0;i<6;i++)(o=this.m_arrItems[i])||((o=cc.instantiate(this.p_itemNode)).parent=this.p_itemContent,this.m_arrItems.push(o)),o.active=!0;var n=0;for(var r in a){var o;(o=this.m_arrItems[n])||((o=cc.instantiate(this.p_itemNode)).parent=this.p_itemContent,this.m_arrItems.push(o)),o.active=!0,o.children[0].getChildByName("title").getComponent(cc.Label).string=r,o.children[0].getChildByName("num").getComponent(cc.Label).string=""+a[r],n++}for(var s=n;s<this.m_arrItems.length;++s)this.m_arrItems[s].children[0].getChildByName("title").getComponent(cc.Label).string="",this.m_arrItems[s].children[0].getChildByName("num").getComponent(cc.Label).string="",n>=6&&(this.m_arrItems[s].active=!1)},t.prefabPath="newexpeditionbuffpage",t.pageType=1,n([p(cc.Label)],t.prototype,"p_title",void 0),n([p(cc.Node)],t.prototype,"p_itemContent",void 0),n([p(cc.Node)],t.prototype,"p_itemNode",void 0),n([p(cc.Node)],t.prototype,"p_tipNode",void 0),a=n([s],t)}(r);c.refreshRed=function(e){var t=!1;return app.player.getCount(38020)>0&&(t=!0),e&&(e.active=t),t},t.exports=c,cc._RF.pop()},{basePage:void 0}],newExpeditionCardPage:[function(e,t){"use strict";cc._RF.push(t,"b9153ZM/ixDw4MyW1hMJBKD","newExpeditionCardPage");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=e("basePage"),o=cc._decorator,s=o.ccclass,p=o.property,c=function(){function e(){this.p_sprIcon=null,this.p_labname=null,this.p_labDes=null,this.p_nodeLight=null,this.p_node=null,this.p_SpLight=null,this.m_target=null,this.m_index=0}return e.prototype.handleUI=function(e,t){var a=this;this.m_target=e,this.m_index=t,this.p_node.on("touchend",function(){app.playSound("click"),a.m_target.clickCard(a.m_index)})},e.prototype.refreshUI=function(e){var t=app.db.dbCard[e];this.p_labname.string=t.NAME,this.p_labDes.string=t.TITLE,app.loadTexture(gConfig.getNewExpedition2IconPath("icon_yz_"+t.ICON),this.p_sprIcon,app.getPrefabPathFrom(this.m_target))},e.prototype.setLight=function(e){this.p_nodeLight.active=e},e.prototype.playSjAnimal=function(e){var t=this;this.p_SpLight.node.active=!0,this.p_SpLight.scheduleOnce(function(){t.p_SpLight.node.active=!1,e&&e()},this.p_SpLight.skeletonData.getRuntimeData().animations[0].duration),this.p_SpLight.setAnimation(0,"effect",!1)},n([p(cc.Sprite)],e.prototype,"p_sprIcon",void 0),n([p(cc.Label)],e.prototype,"p_labname",void 0),n([p(cc.Label)],e.prototype,"p_labDes",void 0),n([p(cc.Node)],e.prototype,"p_nodeLight",void 0),n([p(cc.Node)],e.prototype,"p_node",void 0),n([p(sp.Skeleton)],e.prototype,"p_SpLight",void 0),n([s("newExpeditionCardItem")],e)}(),h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_bossItems=[],t.p_cardPrefab=null,t.p_cardContent=null,t.p_btnChoose=null,t.m_index=-1,t.m_target=null,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,e.prototype.onLoad.call(this),e.prototype.stopBgNodeEvent.call(this),this.m_cards=[]},t.prototype.onEnable=function(){e.prototype.onEnable.call(this)},t.prototype.onDisable=function(){e.prototype.onDisable.call(this)},t.prototype.onDestroy=function(){e.prototype.onDestroy.call(this)},t.prototype.onClose=function(){e.prototype.onClose.call(this)},t.prototype.handleUI=function(){var t=this;e.prototype.handleUI.call(this),this.p_bossItems.map(function(e,a){return e.handleUI(t,a)}),this.p_btnChoose.node.on("click",function(){app.playSound("click"),t.m_index<0||app.player.sfNewExpeditionGetReward({index:t.m_index}).then(function(){var e=function(){t.onClose(),app.newExpeditionInfo.getCardFinish(t.m_index),eventMgr.emit(eventStr.newExpeditionEvent.RefreshNewExpeditionInfo),t.m_target.FlyPoint()};t.m_cards[t.m_index]?t.m_cards[t.m_index].getComponent("expeditionCardItem").playSjAnimal(function(){e()}):e()})})},t.prototype.setParam=function(e){this.m_target=e,this.refreshData()},t.prototype.refreshData=function(){for(var e=this,t=0,a=function(){var a=t,n=i.m_cards[t],r=app.newExpeditionInfo.cardlist[t];n||((n=cc.instantiate(i.p_cardPrefab)).position=cc.v2(),n.parent=i.p_cardContent,n.on("touchend",function(){app.playSound("click"),e.clickCard(a)}),i.m_cards.push(n)),n.active=!0,n.getComponent("expeditionCardItem").refreshUI(r,i),n.getComponent("expeditionCardItem").setClick(!1),n.getComponent("expeditionCardItem").setCountry(!1)},i=this;t<app.newExpeditionInfo.cardlist.length;t++)a();for(var n=t;n<this.m_cards.length;++n)this.m_cards[n].active=!1},t.prototype.clickCard=function(e){this.m_index=e,this.m_cards.map(function(t,a){a==e?t.getComponent("expeditionCardItem").select(!0):t.getComponent("expeditionCardItem").select(!1)})},t.prefabPath="newexpeditioncardpage",t.pageType=1,n([p([c])],t.prototype,"p_bossItems",void 0),n([p(cc.Prefab)],t.prototype,"p_cardPrefab",void 0),n([p(cc.Node)],t.prototype,"p_cardContent",void 0),n([p(cc.Button)],t.prototype,"p_btnChoose",void 0),a=n([s],t)}(r);h.refreshRed=function(e){return e&&(e.active=!1),!1},t.exports=h,cc._RF.pop()},{basePage:void 0}],newExpeditionFirstPage:[function(e,t){"use strict";cc._RF.push(t,"0e276YTyyVB+pgWXeLs3BLt","newExpeditionFirstPage");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=e("basePage"),o=cc._decorator,s=o.ccclass,p=(o.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,e.prototype.onLoad.call(this),e.prototype.stopBgNodeEvent.call(this)},t.prototype.onEnable=function(){e.prototype.onEnable.call(this)},t.prototype.onDisable=function(){e.prototype.onDisable.call(this)},t.prototype.onDestroy=function(){e.prototype.onDestroy.call(this)},t.prototype.onClose=function(){e.prototype.onClose.call(this)},t.prototype.handleUI=function(){e.prototype.handleUI.call(this)},t.prototype.setParam=function(){this.refreshData()},t.prototype.refreshData=function(){},t.prefabPath="newexpeditionfirstpage",t.pageType=1,a=n([s],t)}(r));p.refreshRed=function(e){return e&&(e.active=!1),!1},t.exports=p,cc._RF.pop()},{basePage:void 0}],newExpeditionPage:[function(e,t){"use strict";cc._RF.push(t,"d46b8ALW91PPZxVttwHg+wl","newExpeditionPage");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=e("basePage"),o=cc._decorator,s=o.ccclass,p=o.property,c=["\u6765\u77a7\u4e00\u77a7~\u770b\u4e00\u770b\u5566~","\u8d70\u8fc7\u8def\u8fc7~\u4e0d\u8981\u9519\u8fc7\uff01","\u7269\u7f8e\u4ef7\u5ec9\uff0c\u7ae5\u53df\u65e0\u6b3a\uff01","\u8d85\u503c\u4f18\u60e0\uff01\u673a\u4e0d\u53ef\u5931\uff01"],h=function(){function e(){this.p_node=null,this.p_Sphero=null,this.p_SpFight=null,this.p_Spherochange=null,this.p_labservname=null,this.p_labname=null,this.p_powerNode=null,this.p_btnFight=null,this.m_data=null,this.m_powernode=null}return e.prototype.refreshUI=function(e){var t=this;this.m_data=e,app.loadGeneral(this.m_data.imageid,null,this.p_Sphero,null,null,this.m_data.target.prefabPath),this.p_labname.string=this.m_data.name,this.p_labservname.string="["+this.m_data.sername+"]",this.m_powernode||(this.m_powernode=cc.instantiate(this.m_data.powerprefab),this.m_powernode.parent=this.p_powerNode,this.m_powernode.setPosition(cc.Vec2.ZERO)),this.m_powernode.getComponent("PowerDisplay").init({val:this.m_data.power}),this.p_Spherochange.node.active=!0,this.p_Spherochange.scheduleOnce(function(){t.p_Spherochange.node.active=!1},this.p_Spherochange.skeletonData.getRuntimeData().animations[0].duration),this.p_Spherochange.setAnimation(0,"1",!1)},e.prototype.playSjAnimal=function(e){var t=this;this.p_SpFight.node.active=!0,this.p_SpFight.scheduleOnce(function(){t.p_SpFight.node.active=!1,e&&e()},this.p_SpFight.skeletonData.getRuntimeData().animations[0].duration),this.p_SpFight.setAnimation(0,"effect",!1)},n([p(cc.Node)],e.prototype,"p_node",void 0),n([p(sp.Skeleton)],e.prototype,"p_Sphero",void 0),n([p(sp.Skeleton)],e.prototype,"p_SpFight",void 0),n([p(sp.Skeleton)],e.prototype,"p_Spherochange",void 0),n([p(cc.Label)],e.prototype,"p_labservname",void 0),n([p(cc.Label)],e.prototype,"p_labname",void 0),n([p(cc.Node)],e.prototype,"p_powerNode",void 0),n([p(cc.Button)],e.prototype,"p_btnFight",void 0),n([s("newExpeditionBossItem")],e)}(),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_pfbPower=null,t.p_bossItems=[],t.p_nodeBossParent=null,t.p_nodeShopParent=null,t.p_nodeShop=null,t.p_labScore=null,t.p_barScore=null,t.p_arrNodeBox=[],t.p_sprTitle=null,t.p_btnChange=null,t.p_btnChangeCost=null,t.p_sprChangeCost=null,t.p_labChangeCost=null,t.p_btnAotoBattle=null,t.p_btnShop=null,t.p_btnTip=null,t.p_labTime=null,t.p_labCount=null,t.p_sprFree=null,t.p_maskNode=null,t.p_battleloseNode=null,t.p_shopAniNode=null,t.p_btnExpeditionShop=null,t.p_shopTalk=null,t.p_btnBuff=null,t.p_SpSjBuff=null,t.p_lightFlyParentNode=null,t.p_lightFlyPrefab=null,t.isCanClick=!1,t.isShowShopAni=!1,t.timeLoad=!1,t.m_autoBattleOver=!0,t.m_autoBattleStarIndex=0,t.m_autoBattleCardIndex=0,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,e.prototype.onLoad.call(this),e.prototype.stopBgNodeEvent.call(this),e.prototype.creatMask.call(this,!0),this.FlyCom=this.node.addComponent("nodeFlyToWallet")},t.prototype.onEnable=function(){e.prototype.onEnable.call(this),eventMgr.on(eventStr.commonEvent.RefreshTime,this.RefreshTime,this),eventMgr.on(eventStr.newExpeditionEvent.RefreshNewExpeditionInfo,this.refreshData,this),eventMgr.on(eventStr.newExpeditionEvent.RefreshNewExpeditionShopAnimal,this.ShowShopComeAni,this)},t.prototype.onDisable=function(){e.prototype.onDisable.call(this),eventMgr.off(eventStr.commonEvent.RefreshTime,this.RefreshTime,this),eventMgr.off(eventStr.newExpeditionEvent.RefreshNewExpeditionInfo,this.refreshData,this),eventMgr.off(eventStr.newExpeditionEvent.RefreshNewExpeditionShopAnimal,this.ShowShopComeAni,this)},t.prototype.onDestroy=function(){e.prototype.onDestroy.call(this)},t.prototype.onClose=function(){e.prototype.onClose.call(this)},t.prototype.handleUI=function(){var t=this;e.prototype.handleUI.call(this),this.p_bossItems.map(function(e,a){e.p_node.on("touchend",function(){t.isCanClick&&(app.playSound("click"),t.goToBattle(a))}),e.p_btnFight.node.on("click",function(){t.isCanClick&&(app.playSound("click"),t.goToBattle(a))})}),this.p_btnChange.node.on("click",function(){t.isCanClick&&(app.playSound("click"),t.refreshBoss())}),this.p_btnChangeCost.node.on("click",function(){t.isCanClick&&(app.playSound("click"),t.refreshBoss())}),this.p_btnAotoBattle.node.on("click",function(){t.isCanClick&&(app.playSound("click"),app.pages.newexpeditionautobattlepage.showPage(t))}),this.p_btnShop.node.on("click",function(){t.isCanClick&&(app.playSound("click"),app.pages.shoppage.showPage("kill"))}),this.p_btnBuff.node.on("click",function(){t.isCanClick&&(app.playSound("click"),app.pages.newexpeditionbuffpage.showPage())}),this.p_btnTip.node.on("click",function(){t.isCanClick&&(app.playSound("click"),app.pages.windowspagetipshelp.showPage("1021"))}),this.p_arrNodeBox.forEach(function(e,a){e.on("click",function(){if(t.isCanClick){var e=app.newExpeditionInfo.config.STAR[a];app.newExpeditionInfo.star<e?app.showNotice("\u672a\u8fbe\u5230\u9886\u53d6\u6761\u4ef6"):app.newExpeditionInfo.isGetStar(a)>0||(t.isCanClick=!1,app.player.sfNewExpeditionGetstarReward({star:e}).then(function(a){t.isCanClick=!0;var i={showtype:1,reward:a.items};app.pages.windowspagereward.showPage(i),app.player.addItem(a.items),app.newExpeditionInfo.getStarFinish(e),eventMgr.emit(eventStr.newExpeditionEvent.RefreshNewExpeditionInfo)}).catch(function(){t.isCanClick=!0}))}})}),this.p_nodeShop.on("touchend",function(){t.isCanClick&&(app.playSound("click"),app.pages.newexpeditionshoppage.showPage())}),this.p_btnExpeditionShop.node.on("click",function(){t.isCanClick&&(app.playSound("click"),app.pages.newexpeditionshoppage.showPage())})},t.prototype.setParam=function(){var e=this;this.initPage(),this.isCanClick=!1,this.isShowShopAni=!1,this.p_shopTalk.stopAllActions(),app.player.sfNewExpeditionInfo({force:0}).then(function(){e.isCanClick=!0,null==localDataUtils.GetValue("newexpeditionred",null)&&(localDataUtils.SetValue("newexpeditionred",1,app.newExpeditionInfo.next_refresh_time),app.pages.newexpeditionfirstpage.showPage()),app.runUnlockGuide("MAZE")}).catch(function(){e.onClose()})},t.prototype.initPage=function(){this.p_nodeBossParent.active=!1,this.p_nodeShopParent.active=!1,this.m_autoBattleOver=!0},t.prototype.refreshData=function(){var e=this;if(app.newExpeditionInfo){if(app.newExpeditionInfo.isCanBattle()?this.m_autoBattleOver||(app.newExpeditionInfo.ispass?this.autoBattleFinish():this.goToBattle(this.m_autoBattleStarIndex,!0)):this.openOtherPage(),this.p_nodeBossParent.active=!app.newExpeditionInfo.ispass,this.p_nodeShopParent.active=!!app.newExpeditionInfo.ispass,this.refreshBtns(),app.newExpeditionInfo.ispass){if(this.p_shopTalk.scaleX=0,this.p_shopTalk.scaleY=0,!this.isShowShopAni){var t=cc.repeatForever(cc.sequence(cc.scaleTo(.3,-1,1),cc.delayTime(3),cc.scaleTo(.3,0,0),cc.delayTime(5),cc.callFunc(function(){var t=c[Math.floor(Math.random()*c.length)];e.p_shopTalk.getComponentInChildren(cc.Label).string=t})));this.p_shopTalk.runAction(t),this.isShowShopAni=!0}}else this.p_bossItems.map(function(t,a){var i=app.newExpeditionInfo.bosslist[a],n=0;for(var r in i.battleset.team)n+=i.battleset.team[r].power;t.refreshUI({target:e,imageid:i.imageid,sername:gUtils.getServNameForShow(i.servid),name:i.rname,power:n,powerprefab:e.p_pfbPower})});var a=app.newExpeditionInfo.config.STAR,i=a[a.length-1],n=app.newExpeditionInfo.star||0,r=-1;this.p_arrNodeBox.map(function(e,t){var i=a[t],o=app.newExpeditionInfo.isGetStar(t);n>=i&&(r=t);var s=o>0?1:0;e.getComponent("lookstarScoreItem").refreshBox(i,o,e.x,n,s)}),this.p_labScore.string=n+"/"+i;var o=a[r+1]?a[r+1]-(a[r]?a[r]:0):36,s=n-(a[r]?a[r]:0),p=.25*(r+1+s/o);this.p_barScore.progress=Math.min(1,p);var h=Math.max(app.newExpeditionInfo.config.FREE_TIME-app.newExpeditionInfo.refresh_times,0);this.p_btnChange.node.active=h>0,this.p_btnChangeCost.node.active=h<=0,this.p_labChangeCost.string=app.newExpeditionInfo.config.REFRESH_FEE,app.loadTexture(app.db.getPropsIconPath("38005"),this.p_sprChangeCost,this.prefabPath),this.p_labCount.string=""+h;var l=app.newExpeditionInfo.getTitlePath();app.loadTexture(gConfig.getNewExpedition2IconPath(l),this.p_sprTitle,this.prefabPath)}else this.m_autoBattleOver||this.autoBattleFinish()},t.prototype.refreshBtns=function(){var e=!!app.newExpeditionInfo.ispass;app.setSpriteState(this.p_btnAotoBattle.getComponent(cc.Sprite),e),app.setSpriteState(this.p_btnChange.getComponent(cc.Sprite),e),app.setSpriteState(this.p_btnChangeCost.getComponent(cc.Sprite),e),app.setSpriteState(this.p_sprFree,e),app.setSpriteState(this.p_btnChange.getComponentInChildren(cc.Sprite),e),app.setSpriteState(this.p_btnChangeCost.getComponentInChildren(cc.Sprite),e),app.setSpriteState(this.p_labChangeCost.getComponent(cc.Label),e),app.setSpriteState(this.p_labCount.getComponent(cc.Label),e),app.setSpriteState(this.p_labCount.node.parent.getComponent(cc.Label),e),app.setSpriteState(this.p_sprChangeCost.getComponent(cc.Sprite),e),this.p_btnAotoBattle.interactable=!e,this.p_btnChange.interactable=!e,this.p_btnChangeCost.interactable=!e},t.prototype.openOtherPage=function(){var e=this;if(app.newExpeditionInfo.boxreward&&app.newExpeditionInfo.boxreward.length>0)this.m_autoBattleOver?app.pages.newexpeditionboxpage.showPage(this):app.player.sfNewExpeditionGetReward({index:0}).then(function(){e.autoBattleGetReward(app.newExpeditionInfo.boxreward),app.newExpeditionInfo.getBoxFinish(),e.goToBattle(e.m_autoBattleStarIndex,!0)});else if(app.newExpeditionInfo.cardlist&&app.newExpeditionInfo.cardlist.length>0)if(this.m_autoBattleOver)app.pages.newexpeditioncardpage.showPage(this);else if(1==this.m_autoBattleCardIndex)this.autoBattleFinish(),app.pages.newexpeditioncardpage.showPage(this);else{var t=Math.floor(Math.random()*app.newExpeditionInfo.cardlist.length);app.player.sfNewExpeditionGetReward({index:t}).then(function(){app.newExpeditionInfo.getCardFinish(t),e.FlyPoint(function(){e.goToBattle(e.m_autoBattleStarIndex,!0)})})}},t.prototype.refreshBoss=function(){var e=this,t=null;if(app.newExpeditionInfo.refresh_times>=app.newExpeditionInfo.config.FREE_TIME){var a=app.newExpeditionInfo.config.REFRESH_FEE,i="";if(a>app.player.getCount(38005))return i+="\u3010"+app.db.getPropsName(38005)+"\u3011",void app.showNotice(langMgr.getString("expeditionShopItem",0,i));t={gsid:38005,count:a}}this.isCanClick=!1,app.player.sfNewExpeditionInfo({force:1}).then(function(){e.isCanClick=!0,t&&app.player.reduceItem(t)}).catch(function(){e.isCanClick=!0})},t.prototype.ShowBattleLoseAni=function(){var e=this;this.p_battleloseNode.active=!0,this.p_battleloseNode.position=cc.v3(0,171,0);var t=cc.sequence(cc.spawn(cc.fadeIn(.3),cc.moveTo(.3,cc.v2(0,271))),cc.delayTime(1),cc.fadeOut(.5),cc.callFunc(function(){e.p_battleloseNode.opacity=0}));this.p_battleloseNode.runAction(t)},t.prototype.ShowShopComeAni=function(){var e=this;this.p_shopAniNode.active=!0,this.p_shopAniNode.position=cc.v3(0,40,0);var t=cc.sequence(cc.spawn(cc.fadeIn(.3),cc.moveTo(.3,cc.v2(0,140))),cc.delayTime(1),cc.fadeOut(.5),cc.callFunc(function(){e.p_shopAniNode.opacity=0}));this.p_shopAniNode.runAction(t)},t.prototype.RefreshTime=function(){if(app.newExpeditionInfo&&app.newExpeditionInfo.next_refresh_time&&!this.timeLoad){if(app.newExpeditionInfo.next_refresh_time<=app.player.getServerTime())return this.timeLoad=!0,app.player.sfNewExpeditionInfo({force:0}),void(this.p_labTime.string="00-00-00");this.timeLoad=!1;var e=app.newExpeditionInfo.next_refresh_time-app.player.getServerTime();this.p_labTime.string=gUtils.getCountDownStr(e)}},t.prototype.afterBattleFresh=function(){app.player.sfNewExpeditionInfo({force:0}).then(function(){})},t.prototype.goToBattle=function(e,t){var a=this;if(void 0===t&&(t=!1),app.newExpeditionInfo.isCanBattle())return t?app.newExpeditionInfo.ispass&&12==app.newExpeditionInfo.mapid?(this.autoBattleFinish(),this.ShowShopComeAni(),void this.refreshData()):(cc.log("\u4e00\u952e\u6311\u6218\u4e2d\u5173\u5361:"+app.newExpeditionInfo.mapid+" - "+e),app.db.checkBattleArrTeam("normal")&&app.db.checkGeneralExist("normal")?void this.p_bossItems[e].playSjAnimal(function(){app.player.sfNewExpeditionBattleStart({battleset:app.player.battlearr.normal,mapid:app.newExpeditionInfo.mapid,index:e}).then(function(e){app.player.sfNewExpeditionBattleEnd({battleid:e.battleid,mapid:app.newExpeditionInfo.mapid}).then(function(e){e?"win"==e.result.ret?(e.items&&a.autoBattleGetReward(e.items),app.player.sfNewExpeditionInfo({force:0})):(a.ShowBattleLoseAni(),a.autoBattleFinish()):a.autoBattleError()}).catch(function(e){a.autoBattleError(e)})}).catch(function(e){a.autoBattleError(e)})}):void this.autoBattleError()):(app.battleParam={mapid:app.newExpeditionInfo.mapid,index:e},app.battleType="newexpedition",app.battleConfig=gUtils.deepClone(app.newExpeditionInfo.bosslist[e].battleset),app.leftCards=app.newExpeditionInfo.cardbag.filter(function(e){return!!e}).map(function(e){return{id:e}}),void app.goToNormBattle());this.openOtherPage()},t.prototype.autoBattleStart=function(e){cc.log(e),this.m_autoBattleStarIndex=e.starIndex,this.m_autoBattleCardIndex=e.cardIndex,this.p_maskNode.active=!0,this.m_autoBattleOver=!1,this.goToBattle(this.m_autoBattleStarIndex,!0)},t.prototype.autoBattleFinish=function(){this.m_autoBattleOver=!0,this.p_maskNode.active=!1},t.prototype.autoBattleError=function(e){cc.error(e),app.player.sfNewExpeditionInfo({force:0}),this.m_autoBattleOver=!0,this.p_maskNode.active=!1},t.prototype.autoBattleGetReward=function(e){if(e){var t=gUtils.deepClone(e);app.player.addItem(t),t.filter(function(e){return!!e}).map(function(e){app.showNoticeReward([e],null,"\u606d\u559c\u83b7\u5f97")})}},t.prototype.FlyPoint=function(e){var t=this,a=this.p_btnBuff.node,i=this.FlyCom,n=this.p_lightFlyParentNode,r=a,o=a;i.init(this.p_lightFlyPrefab,n,r,o),i.playAnim(1,0,.2),this.scheduleOnce(function(){t.p_SpSjBuff.node.active=!0,t.p_SpSjBuff.setAnimation(0,"effect",!1),t.scheduleOnce(function(){t.p_SpSjBuff.node.active=!1,e&&e()},t.p_SpSjBuff.skeletonData.getRuntimeData().animations[0].duration)},.2+.1)},t.prototype.update=function(){this.m_autoBattleOver},t.prefabPath="expeditionpage",n([p(cc.Prefab)],t.prototype,"p_pfbPower",void 0),n([p([h])],t.prototype,"p_bossItems",void 0),n([p(cc.Node)],t.prototype,"p_nodeBossParent",void 0),n([p(cc.Node)],t.prototype,"p_nodeShopParent",void 0),n([p(cc.Node)],t.prototype,"p_nodeShop",void 0),n([p(cc.Label)],t.prototype,"p_labScore",void 0),n([p(cc.ProgressBar)],t.prototype,"p_barScore",void 0),n([p([cc.Node])],t.prototype,"p_arrNodeBox",void 0),n([p(cc.Sprite)],t.prototype,"p_sprTitle",void 0),n([p(cc.Button)],t.prototype,"p_btnChange",void 0),n([p(cc.Button)],t.prototype,"p_btnChangeCost",void 0),n([p(cc.Sprite)],t.prototype,"p_sprChangeCost",void 0),n([p(cc.Label)],t.prototype,"p_labChangeCost",void 0),n([p(cc.Button)],t.prototype,"p_btnAotoBattle",void 0),n([p(cc.Button)],t.prototype,"p_btnShop",void 0),n([p(cc.Button)],t.prototype,"p_btnTip",void 0),n([p(cc.Label)],t.prototype,"p_labTime",void 0),n([p(cc.Label)],t.prototype,"p_labCount",void 0),n([p(cc.Sprite)],t.prototype,"p_sprFree",void 0),n([p(cc.Node)],t.prototype,"p_maskNode",void 0),n([p(cc.Node)],t.prototype,"p_battleloseNode",void 0),n([p(cc.Node)],t.prototype,"p_shopAniNode",void 0),n([p(cc.Button)],t.prototype,"p_btnExpeditionShop",void 0),n([p(cc.Node)],t.prototype,"p_shopTalk",void 0),n([p(cc.Button)],t.prototype,"p_btnBuff",void 0),n([p(sp.Skeleton)],t.prototype,"p_SpSjBuff",void 0),n([p(cc.Node)],t.prototype,"p_lightFlyParentNode",void 0),n([p(cc.Prefab)],t.prototype,"p_lightFlyPrefab",void 0),a=n([s],t)}(r);l.refreshRed=function(e){var t=!1;if(app.db.checkFuncUnLock("MAZE",!1)&&(null==localDataUtils.GetValue("newexpeditionred",null)&&(t=!0),!t))if(app.newExpeditionInfo)t=app.newExpeditionInfo.checkRed();else{var a=app.getRedInfoByObj(["maze"],null);null!=a&&(t=a>0)}return e&&(e.active=t),t},t.exports=l,cc._RF.pop()},{basePage:void 0}],newExpeditionShopPage:[function(e,t){"use strict";cc._RF.push(t,"ef5bb/tJRJM+qFSgKdthoDC","newExpeditionShopPage");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=e("basePage"),o=cc._decorator,s=o.ccclass,p=o.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_shopTableView=null,t.p_labPlayerHave=null,t.p_sprIcon=null,t.m_arrShowData=null,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,e.prototype.onLoad.call(this),e.prototype.stopBgNodeEvent.call(this),e.prototype.creatMask.call(this,!0)},t.prototype.onEnable=function(){e.prototype.onEnable.call(this),eventMgr.on(eventStr.newExpeditionEvent.RefreshNewExpeditionShop,this.refreshData,this)},t.prototype.onDisable=function(){e.prototype.onDisable.call(this),eventMgr.off(eventStr.newExpeditionEvent.RefreshNewExpeditionShop,this.refreshData,this)},t.prototype.onDestroy=function(){e.prototype.onDestroy.call(this)},t.prototype.onClose=function(){e.prototype.onClose.call(this)},t.prototype.handleUI=function(){e.prototype.handleUI.call(this)},t.prototype.setParam=function(){this.refreshData()},t.prototype.refreshData=function(){var e,t=this;app.player.sfShopGet("maze",function(e,a){e?app.showNotice(e):(t.m_arrShowData=a.goods,t.p_shopTableView.getComponent("tableView").initTableView(t.m_arrShowData.length,{array:t.m_arrShowData,target:t}))});var a=null!==(e=gConfig.getCurrencyIconPath("30003"))&&void 0!==e?e:app.db.getPropsIconPath("30003");app.loadTexture(a,this.p_sprIcon,app.getPrefabPathFrom(this));var i=app.player.getCount(30003);this.p_labPlayerHave.string=gUtils.showCoinNum(i)},t.prefabPath="newexpeditionshoppage",t.pageType=1,n([p(cc.Node)],t.prototype,"p_shopTableView",void 0),n([p(cc.Label)],t.prototype,"p_labPlayerHave",void 0),n([p(cc.Sprite)],t.prototype,"p_sprIcon",void 0),a=n([s],t)}(r);c.refreshRed=function(e){var t=!1;return app.player.getCount(38020)>0&&(t=!0),e&&(e.active=t),t},t.exports=c,cc._RF.pop()},{basePage:void 0}],newHandChoosePage:[function(e,t){"use strict";cc._RF.push(t,"72228Bmr1tKA7Ejw2fWK23+","newHandChoosePage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"newhandchoosepage"},properties:{p_arrGeneral:[cc.Node],p_btnSure:cc.Button,p_nodeHand:cc.Node},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(),this.handleUI(),this.m_arrChoose=[0,0,0,0,0,0,0,0,0],this.m_arrGuid=["caocao","xuchu","simayi","zhugeliang","machao","zhaoyun","sunjian","luxun","sunquan"]},handleUI:function(){var e=this;this._super(),this.p_btnSure.node.on("click",function(){e.onSure()}),this.p_arrGeneral.forEach(function(t,a){t.on("touchend",function(){e.onClickItem(a)})})},setParam:function(e){this._scene=e.scene,this.initUI()},initUI:function(){this.p_arrGeneral.forEach(function(e){e.getChildByName("choose").active=!1})},onClickItem:function(e){if(this.m_arrChoose[e]>0)this.p_arrGeneral[e].getChildByName("choose").active=!1,this.m_arrChoose[e]=0;else{for(var t=0,a=0;a<this.m_arrChoose.length;++a)this.m_arrChoose[a]>0&&t++;if(7==t)return void app.showNotice(langMgr.getString("newHandChoosePage",0));this.p_arrGeneral[e].getChildByName("choose").active=!0,this.m_arrChoose[e]=1,3==e&&this.p_nodeHand.active&&(this.p_nodeHand.active=!1),t+1==7&&(this.p_nodeHand.active=!0,this.p_nodeHand.setPosition(this.p_btnSure.node.x,this.p_btnSure.node.y))}},onSure:function(){for(var e,t=[],a=0;a<this.m_arrChoose.length;++a)this.m_arrChoose[a]>0&&t.push(this.m_arrGuid[a]);t.length<7?app.showNotice(langMgr.getString("newHandChoosePage",1)):t.length>7?app.showNotice(langMgr.getString("newHandChoosePage",2)):(this.onClose(),this._scene.setNewGeneral(t),e=[{step:17,time:Date.now(),mark:{desc:"9\u90097\u5b8c\u6210",taskid:17}}],app.player.sfGuideSave(e,function(e){e&&cc.log("\u6b65\u9aa4\u5b58\u50a8\u9519\u8bef",17,"9\u90097\u5b8c\u6210")}))}});cc._RF.pop()},{basePage:void 0}],newManorSiegePage:[function(e,t){"use strict";cc._RF.push(t,"eb751vk44dAp5jIeLzPFoNH","newManorSiegePage");var a,i,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),r=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},o=cc._decorator,s=o.ccclass,p=o.property,c=e("basePage"),h=e("../model/manorSiegeModel");(function(e){e[e.first=0]="first",e[e.boss=1]="boss",e[e.newEnemy=2]="newEnemy",e[e.box=3]="box"})(i||(i={}));var l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_nodeEnemy=null,t.p_nodeBoss=null,t.p_spBoss=null,t.p_barBlood=null,t.p_btnAutoFight=null,t.p_btnHelp=null,t.p_labGrain=null,t.p_sprIconGrain=null,t.p_labLv=null,t.p_nodeMask=null,t.p_btnGotoBoss=null,t.p_btnAchieve=null,t.p_btnGrain=null,t.p_btnRight=null,t.p_sprFmeArr=[],t.m_modelData=null,t.m_arrEnemyNode=null,t.isRTime=!0,t.time=0,t}var a;return n(t,e),a=t,t.prototype.onEnable=function(){e.prototype.onEnable.call(this),eventMgr.on(eventStr.ManorSiegePage.RefreshRed,this.refreshRed,this)},t.prototype.onDisable=function(){e.prototype.onDisable.call(this),eventMgr.off(eventStr.ManorSiegePage.RefreshRed,this.refreshRed,this)},t.prototype.onClose=function(){e.prototype.onClose.call(this),this.isRTime=!1},t.prototype.onLoad=function(){a.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.fitTopMenu(),cc.isValid(this.p_nodeMask)&&(this.p_nodeMask.active=!1)},t.prototype.handleUI=function(){var t=this;e.prototype.handleUI.call(this),app.loadTexture(gConfig.getIconNPropPath(a.grainGsid),this.p_sprIconGrain),this.p_btnHelp.node.on("click",this.helpClickHandle.bind(this)),this.p_nodeBoss.getChildByName("icon_boss").on("touchend",this.bossNodeClickHandle.bind(this)),this.p_btnGotoBoss.node.on("click",function(){return cc.isValid(t.p_nodeMask)&&(t.p_nodeMask.active=!1)}),this.p_btnAchieve.node.on("click",this.achieveClickHandle.bind(this)),this.p_btnGrain.node.on("click",this.grainClickHandle.bind(this)),this.p_nodeMask.getChildByName("box").getChildByName("btn_box").on("click",this.dailyBoxClickHandle.bind(this)),this.p_btnAutoFight.node.on("click",this.autoFightClickHandle.bind(this)),this.p_btnRight.node.on("click",this.rightClickHandle.bind(this))},t.prototype.setParam=function(){this.getFieldInfo(!1),this.refreshTime()},t.prototype.refreshUI=function(){this.refreshLV(),this.refreshGrain(),this.refreshRed(),this.refreshBossUI(),this.refreshEnemyUI(),this.refreshQuickUI(),this.refreshRightUI()},t.prototype.getFieldInfo=function(e,t){var n=this;void 0===e&&(e=!0),void 0===t&&(t=!1),app.player.sfGetManorFieldInfo(function(r){var o=new h.ManorSiegeModel(r);if(e)return t&&n.showMaskTip(i.newEnemy),n.m_modelData=o,void n.refreshUI();n.m_modelData=o,localDataUtils.GetValue(a.redPointKey,null)?n.m_modelData.hasBoxItem&&n.showMaskTip(i.box):(n.showMaskTip(i.first),localDataUtils.SetValue(a.redPointKey,1)),n.refreshUI(),cc.director.emit("EVT_ENEMY_INIT_COMPLETE")})},t.prototype.refreshGrain=function(){var e=app.db.getManorConfig().FOOD_MAX;this.p_labGrain.string=gUtils.showCoinNum(app.player.getCount(a.grainGsid))+"/"+e},t.prototype.refreshLV=function(){this.p_labLv.string="LV"+this.m_modelData.lv},t.prototype.refreshQuickUI=function(){var e=app.db.getManorConfig();this.p_btnAutoFight.node.active=app.player.getCount(97054)>=e.SWEEP_LOCK},t.prototype.refreshRightUI=function(){this.p_btnRight.node.active=!gSetting.checkReviewServ();var e=app.player.getServerTime(),t=app.player.special.specialfd,a=this.p_btnRight.node.getChildByName("tip_bg"),i=this.p_btnRight.node.getChildByName("anim");t||(t=0),t<e?(a.getChildByName("no_active").active=!0,a.getChildByName("can_receive").active=!1,a.getChildByName("received").active=!1,i.active=!1):0==app.player.getCount(97199)?(a.getChildByName("no_active").active=!1,a.getChildByName("can_receive").active=!0,a.getChildByName("received").active=!1,i.active=!0):(a.getChildByName("no_active").active=!1,a.getChildByName("can_receive").active=!1,a.getChildByName("received").active=!0,i.active=!1)},t.prototype.refreshRed=function(){var e=app.db.getManorConfig().FOOD_MAX;this.p_btnAutoFight.node.getChildByName("rednotice").active=app.player.getCount(a.grainGsid)>=e,this.p_btnAchieve.node.getChildByName("rednotice").active=app.pages.manorachievepage.refreshRed(),this.p_btnGrain.node.getChildByName("rednotice").active=app.pages.manorgrainpage.refreshRed(),this.p_btnGrain.node.getChildByName("receive").active=app.pages.manorgrainpage.refreshRed(),this.p_btnGrain.node.getChildByName("not_receive").active=!app.pages.manorgrainpage.refreshRed()},t.prototype.refreshBossUI=function(){var e=this.m_modelData.bossInfo;this.m_modelData.allEnemyDone?(this.p_nodeBoss.active=!0,this.m_modelData.isEnemySurvival(this.m_modelData.bossInfo)?(this.p_barBlood.node.active=!0,this.p_spBoss.node.active=!0,this.p_barBlood.progress=e.nowhp/e.maxhp):(this.p_barBlood.node.active=!1,this.p_spBoss.node.active=!1)):this.p_nodeBoss.active=!1},t.prototype.refreshEnemyUI=function(){var e=this;this.m_arrEnemyNode=this.m_arrEnemyNode||[this.p_nodeEnemy],this.p_nodeEnemy.parent.active=!this.m_modelData.allEnemyDone,this.m_modelData.enemyInfo.forEach(function(t,a){var i=gConfig.getManorMonsterPointV4(a),n=e.m_arrEnemyNode[a];n||((n=cc.instantiate(e.p_nodeEnemy)).parent=e.p_nodeEnemy.parent,e.m_arrEnemyNode.push(n)),n.setPosition(cc.v2(i.x,i.y)),n.getComponent("newManorEnemyItem").init(a,e.m_modelData,e)})},t.prototype.helpClickHandle=function(){app.playSound("click"),app.pages.windowspagetipshelp.showPage("1030")},t.prototype.bossNodeClickHandle=function(){app.playSound("click"),app.player.getCount(a.grainGsid)<=0?app.showNotice(langMgr.getString("manorSiegePage",12)):this.showBossPage()},t.prototype.achieveClickHandle=function(){app.playSound("click"),app.pages.manorachievepage.showPage()},t.prototype.grainClickHandle=function(){app.playSound("click"),app.pages.manorgrainpage.showPage()},t.prototype.dailyBoxClickHandle=function(){var e=this;app.playSound("click"),app.player.sfManorGetBox({index:0},function(t){var a=t.items.filter(function(e){return!!app.db.getTypeByGsid(e.gsid||e.GSID)});app.player.addItem(a),e.p_nodeMask.getChildByName("box").getChildByName("btn_box").getComponent(cc.Sprite).spriteFrame=e.p_sprFmeArr[1],app.pages.windowspagereward.showPage({showtype:1,reward:a,confirmcb:function(){e.p_nodeMask.active=!1,e.m_modelData.resetBoxInfo([])},target:e})})},t.prototype.autoFightClickHandle=function(){app.playSound("click"),app.pages.manorsweeppage.showPage({manorlv:this.m_modelData.lv,target:this})},t.prototype.rightClickHandle=function(){var e=this;app.playSound("click");var t=app.player.getServerTime(),a=app.player.special.specialfd;if(a||(a=0),a>=t){if(app.player.getCount(97199))return void app.showNotice(langMgr.getString("manorSiegePage",15));app.player.sfRightGetFood(function(t,a){if(t)"need cast"==t&&app.showNotice(langMgr.getString("manorSiegePage",16));else{var i=a.items.filter(function(e){return!!app.db.getTypeByGsid(e.gsid||e.GSID)});app.player.addItem(i),app.player.sfPlayerByParam(["others","hide","props"],function(){e.refreshGrain(),e.refreshRed(),e.refreshRightUI()}),app.pages.windowspagereward.showPage({showtype:1,reward:i})}})}else app.pages.windowspagetipsmsg.showPage({content:langMgr.getString("manorSiegePage",14),confirmcb:function(){return app.goToPage(1047)}})},t.prototype.killEnemy=function(e){this.m_modelData.killEnemyByPos(e),this.refreshEnemyUI(),this.m_modelData.allEnemyDone&&(this.refreshBossUI(),this.showMaskTip(i.boss))},t.prototype.killBoss=function(){this.getFieldInfo(!0,!0)},t.prototype.showMaskTip=function(e){var t=this;this.p_nodeMask.active=!0,this.p_nodeMask.opacity=255,this.p_nodeMask.getChildByName("boss").active=e==i.boss,this.p_nodeMask.getChildByName("new_enemy").active=e==i.newEnemy||e==i.first,this.p_nodeMask.getChildByName("box").active=e==i.box;var a=langMgr.getString("manorSiegePage",e==i.first?10:11);if(this.p_nodeMask.getChildByName("new_enemy").getChildByName("tip").getComponent(cc.Label).string=a,e==i.boss){this.p_nodeMask.opacity=0;var n=this.p_nodeMask.getChildByName("boss").y;this.p_nodeMask.getChildByName("boss").setPosition(cc.v2(-600,n)),this.p_nodeMask.getChildByName("boss").runAction(cc.sequence(cc.moveTo(.2,cc.v2(0,n)),cc.delayTime(1.3),cc.moveTo(.2,cc.v2(600,n)))),this.p_nodeMask.runAction(cc.sequence(cc.fadeIn(.2),cc.delayTime(1.3),cc.fadeOut(.2),cc.callFunc(function(){t.p_nodeMask.active=!1})))}else e==i.newEnemy?(this.p_nodeMask.getChildByName("new_enemy").scale=.6,this.p_nodeMask.getChildByName("new_enemy").runAction(cc.sequence(cc.scaleTo(.183,1.08).easing(cc.easeOut(.4)),cc.scaleTo(.15,1)))):e==i.box&&(this.p_nodeMask.getChildByName("box").getChildByName("btn_box").getComponent(cc.Sprite).spriteFrame=this.p_sprFmeArr[0])},t.prototype.update=function(e){this.isRTime&&(this.time>10?this.time=0:this.time+=e)},t.prototype.refreshTime=function(){var e=this;app.player.sfPlayerByParam(["others","hide","props"],function(){e.refreshGrain(),e.refreshRed()})},t.prototype.showBossPage=function(){app.pages.manorenemypage.showPage({lv:this.m_modelData.lv,bossInfo:this.m_modelData.bossInfo,target:this})},t.refreshRed=function(){var e=app.db.getManorConfig(),t=e.FOOD_MAX,i=app.player.getCount(a.grainGsid)>=t,n=app.player.getCount(97054)>=e.SWEEP_LOCK,r=app.pages.manorachievepage.refreshRed();return i&&n||r||!1},t.prefabPath="newmanorsiegepage",t.redPointKey="manorsiegered",t.grainGsid=38007,r([p(cc.Node)],t.prototype,"p_nodeEnemy",void 0),r([p(cc.Node)],t.prototype,"p_nodeBoss",void 0),r([p(sp.Skeleton)],t.prototype,"p_spBoss",void 0),r([p(cc.ProgressBar)],t.prototype,"p_barBlood",void 0),r([p(cc.Button)],t.prototype,"p_btnAutoFight",void 0),r([p(cc.Button)],t.prototype,"p_btnHelp",void 0),r([p(cc.Label)],t.prototype,"p_labGrain",void 0),r([p(cc.Sprite)],t.prototype,"p_sprIconGrain",void 0),r([p(cc.Label)],t.prototype,"p_labLv",void 0),r([p(cc.Node)],t.prototype,"p_nodeMask",void 0),r([p(cc.Button)],t.prototype,"p_btnGotoBoss",void 0),r([p(cc.Button)],t.prototype,"p_btnAchieve",void 0),r([p(cc.Button)],t.prototype,"p_btnGrain",void 0),r([p(cc.Button)],t.prototype,"p_btnRight",void 0),r([p([cc.SpriteFrame])],t.prototype,"p_sprFmeArr",void 0),a=r([s],t)}(c);t.exports=l,cc._RF.pop()},{"../model/manorSiegeModel":void 0,basePage:void 0}],newWorldMapPage:[function(e,t){"use strict";cc._RF.push(t,"a33b8GRk7ND1IPCmp2A7TXT","newWorldMapPage");var a,i=(a=e("../model/OnHookAnimal"))&&a.__esModule?a:{default:a},n=[38006,30001,38006],r=cc.Class({extends:e("basePage"),statics:{prefabPath:"newworldmappage"},properties:{p_pfbGeneralItem:cc.Prefab,p_hangNode:cc.Node,p_hangTimeNode:cc.Node,p_hangTimeNum:cc.Label,p_hangMaxLab:cc.Label,p_hangTipsNode:cc.Node,p_btneGet:cc.Button,p_nodeRewardRed:cc.Node,p_btnFightCity:cc.Button,p_btnDrameBoss:cc.Button,p_nodeEvent:cc.Node,p_btnEvent:cc.Button,p_eventNum:cc.Label,p_eventRed:cc.Node,p_btnQuickReward:cc.Button,p_quickRed:cc.Node,p_btnAchive:cc.Button,p_sprIcon:cc.Sprite,p_labIconNum:cc.Label,p_sprGeneral:cc.Sprite,p_sprName:cc.Sprite,p_labIntro:cc.Label,p_nodeNum:cc.Node,p_nodeIntro:cc.Node,p_btnGetHelp:cc.Button,p_btnOnline:cc.Node,p_arrSprf:[cc.SpriteFrame],btnAnimNode:cc.Node,p_nodeShowReap:cc.Node,p_btnPrison:cc.Button,p_arrItem:[cc.Node],p_labwarringInfo:cc.Label,p_arrNodeReward:[cc.Node],p_testNode:cc.Node,p_testMap:[cc.Node],p_nodeOnhookSpine:sp.Skeleton,p_nodeOnhookDragon:dragonBones.ArmatureDisplay,p_btnBossJianTou:cc.Node,p_chaptersBar:cc.ProgressBar,p_chaptersBarDes:cc.Label,p_chaptersNum:cc.Label,p_chaptersTitle:cc.Label,p_chapterPassTip:cc.Node,p_chapterPassLayout:cc.Node,p_chapterName:cc.Sprite,p_btnChapter:cc.Button,p_spCameraRender:cc.Sprite,p_skeBoxAnim:sp.Skeleton,p_nodeOnlineHelp:cc.Node,p_pfbOnlineHelp:cc.Prefab,p_btnXFZH:cc.Button,p_labTime:cc.Label,p_arrSpfTxtFight:[cc.SpriteFrame],p_pfbProp:cc.Prefab,p_rewardsFlyParent:cc.Node,p_lightSp:[sp.Skeleton],p_maskSprite:cc.SpriteFrame,p_sprShowOnlineHelp:cc.SpriteFrame},onLoad:function(){var e,t=this;r.instance=this,app.campaignData=app.campaignData||{},this.m_arrCacheDot=[],this.m_arrMapGeneral=[],this._changeStatus=!1,this._lastStatus=null,this.nextEventTime=null,this.eventMapCount=0,this.creatMask(),this.fitTopMenu(),this.handleUI(),this.p_btnOnline.active=!0,this.m_showBoss=!1,this.generalArrs=[],this.bindingCamera(null==(e=Camera)?void 0:e.getComponent(cc.Camera)),this.p_lightSp.forEach(function(e){e.setCompleteListener(function(){e.node.active=!1})}),this.allFlyCom=[],n.forEach(function(){t.allFlyCom.push(t.node.addComponent("nodeFlyToWallet"))})},onEnable:function(){var e=this;this._super(),eventMgr.on(eventStr.redEvent.RefreshNewWorldRed,this.refreshRed,this),eventMgr.on(eventStr.commonEvent.RefreshTime,this.refreshHangTime,this),app.isGuide()&&(this._isNeedClear=!0,cc.director.on("EVT_HELP_MOVE_IN",function(){if(cc.isValid(e.m_nodeOnlineHelp)){e.m_nodeOnlineHelp.active=!0,e.m_nodeOnlineHelp.scale=.2;var t=e.p_nodeManager.convertToNodeSpaceAR(cc.v2(0,0));e.m_nodeOnlineHelp.x=t.x,e.m_nodeOnlineHelp.y=t.y,cc.tween(e.m_nodeOnlineHelp).to(.2,{scale:1}).start()}},this))},onDisable:function(){this._super(),eventMgr.off(eventStr.redEvent.RefreshNewWorldRed,this.refreshRed,this),eventMgr.off(eventStr.commonEvent.RefreshTime,this.refreshHangTime,this),this._isNeedClear&&(this._isNeedClear=!1,cc.director.off("EVT_HELP_MOVE_IN",null,this))},start:function(){app.runGuide(),cc.isValid(this.btnAnimNode)&&cc.tween(this.btnAnimNode).repeatForever(cc.tween().to(1,{opacity:40}).to(1,{opacity:0})).start()},handleUI:function(){var e=this;this.p_btneGet.node.on("click",function(){app.playSound("click"),e.getHangProfit()}),this.p_btnAchive.node.on("click",function(){app.playSound("click"),app.pages.windowspageachieve.showPage()}),this.p_btnPrison.node.on("click",function(){app.playSound("click"),app.pages.manorprisonhomepage.showPage()}),this.p_btnChapter.node.on("click",function(){app.playSound("click"),app.pages.chapterpage.showPage()}),this.p_btnFightCity.node.on("touchend",function(){app.playSound("click"),e.p_btnFightCity.CITY;var t=app.db.getMapInfo(app.player.maxmapid);app.player.level<t.LIMIT?app.pages.windowspageayzz.showPage(t.LIMIT-1):(app.battleType="normal",app.oldLevel=app.player.level,app.player.sfChapterInfo(function(t,a){t?app.showNotice(langMgr.getString("newWorldMapPage",15)):(app.battleConfig=a.chapter,e.m_newMaxmapid=app.player.maxmapid,e.m_newMaxChapter=app.db.getMapInfo(app.player.maxmapid).CITY,app.levelFactor=a.levelfactor,app.goToNormBattle())}))}),this.p_btnEvent.node.on("click",function(){!e.m_eventData||e.m_eventData.length<=0||(app.playSound("click"),e.initEventPage({list:e.m_eventData,next:e.nextEventTime,max:e.eventMapCount}))},this),this.p_btnDrameBoss.node.on("click",function(){app.playSound("click"),app.pages.dramabosslistpage.showPage()},this),this.p_btnQuickReward.node.on("click",function(){app.playSound("click"),app.pages.windowspagequickreward.showPage()}),this.p_skeBoxAnim.setCompleteListener(function(){e._changeStatus&&(e._changeStatus=!1,e.refreshBoxAnim())}),this.p_btnXFZH.node.on("click",function(){app.playSound("click"),e.p_btnXFZH.node.getChildByName("rednotice").active=!1,app.player.getCount(93127)?app.pages.activitypagexfzh.showPage():app.pages.activitypagexfzhto.showPage()})},updateCityOpacity:function(){this.p_nodeCitys.length>0&&this.p_nodeCitys.forEach(function(e){e.opacity=Camera.isInView(e)?255:0})},refreshLockBtn:function(){this.p_btnQuickReward.node.active=app.db.checkFuncUnLock("WORLD_QUICK")},initMap:function(){app.onhookanimal||(app.onhookanimal=new i.default({camera:Camera,maparr:this.p_testMap,generalnode:this.p_testNode,prefab:this.p_pfbGeneralItem,onhookanimaldr:this.p_nodeOnhookDragon,target:this}));var e=app.db.getMapInfo(app.player.maxmapid).CITY,t=app.db.getCityInfo(e);app.onhookanimal.setMapBg(t.MAPBG),app.onhookanimal.initMap()},playFlyAnim:function(){var e=this;n.forEach(function(t,a){var i=e.p_btneGet.node,n=e.allFlyCom[a],r=e.p_rewardsFlyParent,o=i,s=i;n.init(e.p_pfbProp,r,o,s);var p=Math.floor(20*Math.random());p=Math.max(p,5),n.playAnim(p,100,.6,t)}),this.scheduleOnce(function(){var t=[3,4,5],a=t[Math.floor(Math.random()*t.length)];e.getRomLightIndex([],a).forEach(function(t,a){var i=e.p_lightSp[t];i.node.active=!0;var n=0==a?0:.5*Math.random();e.scheduleOnce(function(){i.setAnimation(0,"sj01",!1)},n)})},.7)},getRomLightIndex:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=1);var a=Math.floor(Math.random()*this.p_lightSp.length);return e.indexOf(a)<0&&(e.push(a),e.length>=t)?e:this.getRomLightIndex(e,t)},update:function(){},refreshDramaBoss:function(){var e=app.loginReset.dramaList,t=app.dBossId;for(var a in this.m_arrDBossNode=this.m_arrDBossNode||{},this.m_arrDBossNode)this.m_arrDBossNode[a].active=!1;e.sort(function(e,t){return 0!=e.undoneCount&&0==t.undoneCount?-1:0});for(var i=this.m_showBoss?e.length:1,n=0,r=0;r<e.length;++r){var o=e[r];o.undoneCount>0&&n++;var s=o.boss,p=this.m_arrDmItem[r];r<i?(p||((p=cc.instantiate(this.p_nodeDramaItem)).parent=this.p_nodeDramaItem.parent,this.m_arrDmItem.push(p)),p.active=!0,p.getComponent("dramaBossItem").initSelf(o,this)):p&&(p.active=!1),s==app.dBossId&&(app.dBossId=null)}for(var c=e.length;c<this.p_nodeDramaItem.parent.children.length;c++)this.p_nodeDramaItem.parent.children[c].active=!1;if(this.p_btnBossJianTou.active=n>1,t&&app.dBossId){app.dBossId=null;var h=app.db.getDramaBossInfo(t);cc.director.emit("loading_end",function(){app.showNotice(langMgr.getString("newWorldMapPage",13,h.GNAME))})}for(var l=e.length;l<this.m_arrDmItem.length;++l)this.m_arrDmItem[l].active=!1},refreshAchive:function(){var e=app.player.getCount(93199),t=app.db.dbMapAchive[e];t?(this.p_btnAchive.node.active=!app.isGuide(),this.p_btnAchive.node.getChildByName("redpoint").active=app.player.maxmapid>t.MAPID):this.p_btnAchive.node.active=!1},refreshDramaBossIcon:function(){this.p_btnDrameBoss.node.active=app.player.level>=18;var e=this.p_btnDrameBoss.node.getChildByName("redpoint"),t=gUtils.dateFormatter("YYYY-MM-DD",(new Date).getTime()),a=localDataUtils.GetValue("dramabossred",null);e.active=!a||t!==a},setParam:function(e){e&&(this.closeCb=e.closeCb),this.initMap(),this.initEventMap(),this.refreshPrison(),this.refreshHangTime(),this.refreshAchive(),this.refreshRed(),this.refreshLockBtn(),this.refreshChapters(),this.refreshTip(),this.refreshOnlineHelp(),this.refreshXFZH(),this.refreshDramaBossIcon(),localDataUtils.GetValue("GUIDE_OVER",null)&&this.goGuideOnlineHelp(!1)},refreshTip:function(){var e,t=app.player.getServerTime()-app.player.lastreap,a=Math.floor(t/1e3/60);app.player.level,this.p_hangTipsNode.active=!app.isGuide()&&a>=120,a>=app.db.dbVip[app.player.vip].RIGHT.HANG_TIME?e=langMgr.getString("newWorldMapPage",22):a>=480?e=langMgr.getString("newWorldMapPage",23):a>=120&&(e=langMgr.getString("newWorldMapPage",24)),this.p_hangTipsNode.getChildByName("New Label").getComponent(cc.Label).string=e,this.p_hangTipsNode.active&&this.p_hangTipsNode.runAction(cc.sequence(cc.delayTime(3),cc.fadeOut(1)))},refreshBoxAnim:function(){this.p_skeBoxAnim.setAnimation(0,"zhuangtai"+this._lastStatus,!0)},afterBattleFresh:function(){switch(app.battleOverType){case"normal":if(this.initMap(),this.initEventMap(),this.refreshAchive(),this.refreshLockBtn(),this.refreshRed(),this.showReward(),this.refreshChapters(),this.showChapterPassTip(),this.refreshOnlineHelp(),this.refreshXFZH(),this.refreshDramaBossIcon(),(app.player.getCount(90471)>=10||app.player.getCount(90213)||app.player.level>=30)&&!this.p_btnOnline.active){var e=app.player.getCount(app.db.dbOnlineGift.GIVE_SIGN),t=app.db.dbOnlineGift.REWARD.length;this.p_btnOnline.active=e<t}}},showReward:function(){var e=this,t=0;this.schedule(function(){var a=e.p_arrNodeReward[t];a.stopAllActions();var i=a.getChildByName("old").getComponent(cc.Label),n=a.getChildByName("new").getComponent(cc.Label);i.string=app.objOldReapData[t].COUNT,n.string=langMgr.getString("windowsPageNoticeReap",0,app.player.reap_config[t].COUNT),a.opacity=255,a.setPosition(cc.v2(0,0)),a.runAction(cc.moveTo(3,cc.v2(0,300))),a.runAction(cc.fadeOut(3)),t++},.8,2)},refreshOnlineHelp:function(){this.m_nodeOnlineHelp||(this.m_nodeOnlineHelp=cc.instantiate(this.p_pfbOnlineHelp),this.m_nodeOnlineHelp.parent=this.p_nodeOnlineHelp,this.m_nodeOnlineHelp.setPosition(0,0));var e=app.player.getCount(90309);cc.log(e);var t=app.db.dbCampaignHelp[e];t&&this.m_nodeOnlineHelp.getComponent("OnlineHelpItem").refreshUI(e),this.m_nodeOnlineHelp.active=!!t&&!app.isGuide()},goGuideOnlineHelp:function(e){var t=this;void 0===e&&(e=!0),app._mask||this.creatMask(),e&&this.refreshOnlineHelp(),this.m_nodeOnlineHelp.active&&this.scheduleOnce(function(){localDataUtils.RemoveValue("GUIDE_OVER"),app._mask.active=!0;var e=t.m_nodeOnlineHelp.position;t.m_nodeOnlineHelp.scale=.2;var a=t.m_nodeOnlineHelp.parent,i=a.convertToNodeSpaceAR(cc.v2(cc.winSize.width/2,cc.winSize.height/2+100));t.m_nodeOnlineHelp.parent=app._mask;var n=new cc.Node("mask");n.addComponent(cc.Sprite).spriteFrame=t.p_maskSprite,n.parent=app._mask,n.color=cc.color(0,0,0),n.opacity=150,n.width=app._mask.width,n.height=app._mask.height,n.position=cc.v2(0,0),n.zIndex=1;var r=new cc.Node;r.addComponent(cc.Sprite).spriteFrame=t.p_sprShowOnlineHelp,r.position=cc.v2(0,60),r.parent=t.m_nodeOnlineHelp,t.m_nodeOnlineHelp.zIndex=2,t.m_nodeOnlineHelp.x=0,t.m_nodeOnlineHelp.y=100,r.scale=.7,t.m_nodeOnlineHelp.runAction(cc.sequence(cc.scaleTo(.4,1.4),cc.delayTime(1),cc.callFunc(function(){n.destroy(),t.m_nodeOnlineHelp.parent=a,t.m_nodeOnlineHelp.x=i.x,t.m_nodeOnlineHelp.y=i.y,r.destroy(),app._mask.active=!1}),cc.spawn(cc.scaleTo(.5,1),cc.moveTo(.5,cc.v2(e.x,e.y))),cc.callFunc(function(){app.runUnlockGuide("ONLINE_HELP")})))},.1)},refreshXFZH:function(){this.p_btnXFZH.node.active=app.pages.activitypagexfzh.isOpen()},refreshChapters:function(){var e=app.db.getMapInfo(app.player.maxmapid).CITY,t=app.db.getCityInfo(e),a=t.MAP.length,i=t.MAP.indexOf(app.player.maxmapid)+1,n=i/a;this.p_chaptersTitle.string=t.NAME,this.p_chaptersBar.progress=n,this.p_chaptersBarDes.string="\u901a\u5173\u8fdb\u5ea6\uff1a"+t.ORDER+"-"+i,this.p_chaptersNum.string=t.CHAPTER_NO,this.p_btnFightCity.node.getChildByName("windows_btn_tx_gongcheng").getComponent(cc.Sprite).spriteFrame=i===a?this.p_arrSpfTxtFight[1]:this.p_arrSpfTxtFight[0],app.loadTexture(gConfig.rootPath.uiiconnewworldmap+"chapter/"+t.ICON_PIC,this.p_btnChapter.node.getChildByName("icon").getComponent(cc.Sprite),this.prefabPath)},showChapterPassTip:function(){var e=this;if(this.m_newMaxChapter&&this.m_newMaxChapter<app.db.getMapInfo(app.player.maxmapid).CITY){var t={"\u96f6":"icon_zzzj_0_lang","\u4e00":"icon_zzzj_1_lang","\u4e8c":"icon_zzzj_2_lang","\u4e09":"icon_zzzj_3_lang","\u56db":"icon_zzzj_4_lang","\u4e94":"icon_zzzj_5_lang","\u516d":"icon_zzzj_6_lang","\u4e03":"icon_zzzj_7_lang","\u516b":"icon_zzzj_8_lang","\u4e5d":"icon_zzzj_9_lang","\u5341":"icon_zzzj_10_lang","\u7b2c":"icon_zzzj_di_lang","\u7ae0":"icon_zzzj_zhang_lang"},a=app.db.getMapInfo(app.player.maxmapid),i=app.db.getCityInfo(a.CITY),n=String(i.CHAPTER_NO).split("");this.p_chapterPassLayout.removeAllChildren();var r=0,o=function(){if(++r>=n.length){e.p_chapterPassTip.active=!0,e.p_chapterPassLayout.getComponent(cc.Layout).updateLayout(),e.p_chapterPassTip.position=cc.v2(0,0);var t=cc.sequence(cc.spawn(cc.fadeIn(.3),cc.moveTo(.3,cc.v2(0,100))),cc.delayTime(1),cc.fadeOut(.5),cc.callFunc(function(){e.p_chapterPassTip.opacity=0}));e.p_chapterPassTip.runAction(t)}};app.loadTexture(gConfig.rootPath.uiiconnewworldmap+"chapter/"+i.NAMR_PIC,this.p_chapterName,this.prefabPath,function(){for(var a=function(a){if(!t[n[a]])return o(),"continue";var i=gConfig.rootPath.uiiconnewworldmap+t[n[a]],r=new cc.Node("number");e.p_chapterPassLayout.addChild(r);var s=r.addComponent(cc.Sprite),p={pagePath:assetMsg.cacheNoReleaseKey.Public};assetMsg.Load(i,cc.SpriteFrame,null,function(e,t){if(e)return cc.log(e),void o();s&&cc.isValid(s.node)&&(s.spriteFrame=t,o())},"resources",p)},i=0;i<n.length;i++)a(i)})}},refreshPrison:function(e){var t=app.getRedInfoByObj(["official","srender"],null),a=localDataUtils.GetValue("prisonRed",null),i=gUtils.dateFormatter("YYYY-MM-DD",(new Date).getTime());this.p_btnPrison&&(this.p_btnPrison.node.getChildByName("redpoint").active=!(!(t&&t>0)||i&&i===a),e&&(this.p_btnPrison.node.getChildByName("redpoint").active=!0),this.p_btnPrison.node.active=GodGuide.checkGuideProgress("showPrison"))},refreshHangTime:function(){if(app.player.lastreap){this.p_hangNode.active=GodGuide.checkGuideProgress("showReap"),this.p_btneGet.node.active=GodGuide.checkGuideProgress("showReap");var e=app.player.getServerTime()-app.player.lastreap,t=(Math.floor(e/1e3/60),app.player.level,app.db.dbVip[app.player.vip].RIGHT.HANG_TIME),a=gUtils.getHourMinTime(e),i=a[0],n=a[1],r=1,o=Math.floor(e/1e3);o/1e3<=20||(r=o<=1200?2:o<=7200?3:o<=21600?4:5),r!==this._lastStatus&&(this._lastStatus=r,this._changeStatus=!0,this.refreshBoxAnim());var s=langMgr.getString("newWorldMapPage",18)+t+langMgr.getString("newWorldMapPage",19),p=(i>9?i:"0"+i)+langMgr.getString("public",7)+(n>9?n:"0"+n)+langMgr.getString("public",8);a[0]>=t?(this.p_hangMaxLab.node.active=!0,this.p_hangTimeNode.active=!1,this.p_hangMaxLab.string=s):(this.p_hangMaxLab.node.active=!1,this.p_hangTimeNode.active=!0,this.p_hangTimeNum.string=p);var c=Math.floor((app.player.getServerTime()-app.player.lastreap)/1e3);this.m_isGetReward=c>=5}},getHangProfit:function(){var e=this;this.m_isGetReward?app.player.sfChapterReap(function(t,a){if(t)app.showNotice(t);else{var i=app.player.level,n=a.reaptime,r=app.player.exp;a.global_gifts&&app.setNewRecommendGift(a.global_gifts),app.player.sfPlayerData(function(){GodGuide.addGuideProgress("guide_hang_reward_end");var t=a.config.reduce(function(e,t){return e[t.GSID]=t.COUNT,e},{}),o={data:a.items,oldlv:i,oldexp:r,last:n,config:t};e.refreshHangTime(),app.pages.autobattleresultpage.showPage(o),app.playSound("campaigncollect")})}}):app.showNotice(langMgr.getString("newWorldMapPage",12))},playGoldAnim:function(){this.m_arrGoldAnim=this.m_arrGoldAnim||[this.p_shuiju_money.node];for(var e=null,t=0;t<this.m_arrGoldAnim.length;++t){var a=this.m_arrGoldAnim[t];a.isPlay||(e=a)}e||((e=cc.instantiate(this.p_shuiju_money.node)).parent=this.p_shuiju_money.node.parent,e.setPosition(this.p_shuiju_money.node.position),this.m_arrGoldAnim.push(e)),app.loadEff("money_shuishou",e.getComponent(cc.Animation),1,1,1)},creatMask:function(){if(!app._mask){var e=new cc.Node;e.parent=cc.director.getScene(),e.zIndex=999,e.x=cc.winSize.width/2,e.y=cc.winSize.height/2,e.width=cc.winSize.width+20,e.height=cc.winSize.height+20,e.on("touchstart",function(e){e.stopPropagation()}),e.on("touchmove",function(e){e.stopPropagation()}),e.on("touchend",function(e){e.stopPropagation()}),cc.game.addPersistRootNode(e),app._mask=e,app._mask.active=!1}},initEventMap:function(){this.getEvent()},refreshSpringBoss:function(){this.p_nodeEvent.getComponent("mapEvent").refreshSpringBattle()},getEvent:function(){var e=this;return new Promise(function(t){app.db.checkFuncUnLock("WORLD_EVENT")?app.player.sfMapEventList(function(a){e.setEventData(a.list),e.nextEventTime=a.next,e.eventMapCount=a.max,e.refreshEvent(),e.refreshRed(),t(a)}):(e.refreshEvent(),e.refreshRed(),t())})},setEventData:function(e){for(var t in this.m_eventData=e,this.m_eventData){var a=this.m_eventData[t],i=app.db.getMapEventInfo(a.type,a.eid);i.type=a.type,a.info=i}},updateEventDataByKey:function(e,t){this.m_eventData[e]=t},getEventData:function(){return this.m_eventData},refreshEvent:function(){var e=[];for(var t in this.m_eventData)e.push(t);this.p_btnEvent.node.active=e.length>0&&app.db.checkFuncUnLock("WORLD_EVENT");var a=gUtils.dateFormatter("YYYY-MM-DD",(new Date).getTime()),i=localDataUtils.GetValue("expeditioneventred",null);this.p_btnEvent.node.getChildByName("rednotice").active=e.length>0&&(!i||a!==i),app.getRedInfoByObj(["maplist","event"],0)>=1&&(app.redDataServer.maplist.event=e.length),this.p_eventNum.string=""+e.length},initEventPage:function(e){app.pages.expeditioneventpage.showPage(e)},destroyEventItem:function(e){delete this.m_eventData[e],this.refreshEvent(),this.refreshRed()},onClose:function(){--app.numPrefabZindex,app.popPage(),this.node.active=!1,this.closeCb&&this.closeCb()},refreshRed:function(){this.p_quickRed.active=r.checkQuickRed();var e=gUtils.dateFormatter("YYYY-MM-DD",(new Date).getTime()),t=localDataUtils.GetValue("expeditioneventred",null),a=app.getRedInfoByObj(["maplist","event"],null);this.p_eventRed.active=null!=a&&a>0&&(!t||e!==t),eventMgr.emit(eventStr.redEvent.RefreshMainSceneRed)},bindingCamera:function(e){if(cc.isValid(e)){var t=new cc.RenderTexture;t.initWithSize(cc.visibleRect.width+10,cc.visibleRect.height+10,cc.gfx.RB_FMT_S8),e.targetTexture=t;var a=new cc.SpriteFrame;a.setTexture(t),this.p_spCameraRender.spriteFrame=a,this.p_spCameraRender.node.scaleY=-1}},relieveCamera:function(e){cc.isValid(e)&&(e.targetTexture=null,this.p_spCameraRender.spriteFrame=null)},setRenderNodeVisible:function(e){this.p_spCameraRender.node.opacity=e?255:0}});r.refreshRed=function(e){var t=!1;if(t||(t=r.checkQuickRed()),!t){var a=Math.min(app.player.getCount(90309),app.db.dbCampaignHelp.length-1);t=!(app.player.getCount(90309)>a)&&app.player.maxmapid>=app.db.dbCampaignHelp[a].MINMAP}if(!t){var i=app.player.getServerTime()-app.player.lastreap;t=gUtils.getDayHourMinSecTime(i)[0]>=1}var n=gUtils.dateFormatter("YYYY-MM-DD",(new Date).getTime()),o=localDataUtils.GetValue("expeditioneventred",null);if(!t){var s=app.getRedInfoByObj(["maplist","event"],null);null!=s&&(t=s>=0&&(!o||n!==o))}return e&&(e.active=t),t},r.checkQuickRed=function(){var e=!1;if(app.db.getVipQuickRewardCount(app.player.vip)>0&&app.db.checkFuncUnLock("WORLD_QUICK")){var t=app.player.getCount(90165),a=app.db.getQuickRewardCost(t);e=(a[0]?a[0].COUNT:0)<=0}return e},cc._RF.pop()},{"../model/OnHookAnimal":void 0,basePage:void 0}],normalRecruitPage:[function(e,t){"use strict";cc._RF.push(t,"066b8j/lE9I+KOSv/nqftjG","normalRecruitPage");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=cc._decorator,o=r.ccclass,s=(r.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,e.prototype.onLoad.call(this)},t.prototype.getOneTimeCost=function(){return{count:"x"+app.db.dbDraw[1][1].COST[0].COUNT,iconPath:app.db.getPropsIconPath("30005"),freeTime:app.player.recruitfree.normal}},t.prototype.getTenTimesCost=function(){return{count:"x"+app.db.dbDraw[1][10].COST[0].COUNT,iconPath:app.db.getPropsIconPath("30005")}},t.prototype.oneTimeClickHandle=function(){app.playSound("click"),this.extract(1,1)},t.prototype.tenTimesClickHandle=function(){app.playSound("click"),this.extract(1,10)},t.prototype.showXuyuan=function(){return!1},t.prototype.showTianyun=function(){return!1},t.refreshRed=function(){return!app.comeInNormalRecruit},t.prefabPath="normalrecruitpage",a=n([o],t)}(e("./cardpubBasePage").CardpubBasePage));t.exports=s,cc._RF.pop()},{"./cardpubBasePage":"cardpubBasePage"}],northBattleSetPage:[function(e,t){"use strict";cc._RF.push(t,"f1c36FOKt5Bo5GaAv5blnY5","northBattleSetPage"),e("../utils/gameUtils");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"northbattlesetpage",pageType:1},properties:{p_generalContent:cc.Node,p_pfbGeneralItem:cc.Prefab,p_labTips:cc.Label,p_labTeamPower:cc.Label,p_labBsetName:cc.Label,p_labPower:cc.Label},onLoad:function(){a.instance=this,this.creatMask(!0),this.fitTopMenu(),this.stopBgNodeEvent(),this.handleUI(),this.m_arrGeneral=[]},onEnable:function(){this._super()},onDisable:function(){this._super()},handleUI:function(){this._super()},onClose:function(){this._super()},setParam:function(e){this.m_teamType=e,this.m_data=app.northInfo.battlearr.get(this.m_teamType),this.refreshUI()},refreshUI:function(){if(this.m_data){this.m_data.power?this.p_labTeamPower.string=gUtils.showNum(this.m_data.power):this.p_labTeamPower.node.active=!1,this.p_labBsetName&&(this.p_labBsetName.string=langMgr.getString("palacePage",19,this.m_teamType)),this.p_labPower&&(this.p_labPower.string=langMgr.getString("palacePage",18,[this.m_data.vit||0,this.m_data.max_vit||5])),this.p_labTips&&(this.p_labTips.string=langMgr.getString("palacePage",27,this.m_data.per_hour||3));var e=this.m_data.generals,t=0;for(var a in e){var i=e[a],n=this.m_arrGeneral[t];n||((n=cc.instantiate(this.p_pfbGeneralItem)).parent=this.p_generalContent,this.m_arrGeneral.push(n)),n.getComponent("generalPortraitItem").initForTips(i),t++}for(var r=0;r<this.m_arrGeneral.length;r++)r>=t&&(this.m_arrGeneral[r].active=!1)}}});cc._RF.pop()},{"../utils/gameUtils":void 0,basePage:void 0}],northBossInfoPage:[function(e,t){"use strict";cc._RF.push(t,"84418tU7ztLdYixA/4U/65r","northBossInfoPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"northbossinfopage",pageType:1},properties:{p_labName:cc.Label,p_spGeneral:sp.Skeleton,p_animGeneral:cc.Animation,p_nodeLeave:cc.Node,p_labLeaveTime:cc.Label,p_proHp:cc.ProgressBar,p_labHp:cc.Label,p_btnReward:cc.Button,p_btnFight:cc.Button,p_btnMap:cc.Button,p_pfbRewardItem:cc.Prefab,p_nodeRewardContent:cc.Node,p_nodeKill:cc.Node,p_nodeLeaveTitle:cc.Node,p_nodeCampItems:[cc.Node]},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.m_arrItems=[]},onEnable:function(){this._super(),eventMgr.on(eventStr.commonEvent.RefreshTime,this.refreshTime,this),eventMgr.on(eventStr.palaceEvent.RefreshNorthInfo,this.refreshNorth,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.commonEvent.RefreshTime,this.refreshTime,this),eventMgr.off(eventStr.palaceEvent.RefreshNorthInfo,this.refreshNorth,this)},handleUI:function(){var e=this;this._super(),this.p_btnReward.node.on("click",function(){app.playSound("click"),app.pages.northbossrewardpage.showPage(e._bossInfo)}),this.p_btnFight.node.on("click",function(){app.playSound("click"),e.onFight()}),this.p_btnMap.node.on("click",function(){app.playSound("click"),e.onMop()})},refreshNorth:function(){app.northInfo.bosses&&app.northInfo.bosses[this.m_index]?(this._bossInfo=app.northInfo.bosses[this.m_index],this._bossInfo._id==this._desBossId?this.refreshUI():this.onClose()):this.onClose()},setParam:function(e){this.m_index=e,this._bossInfo=app.northInfo.bosses[this.m_index],this._desBossId=app.northInfo.bosses[this.m_index]._id,this.checkTeamno=0,this.refreshUI()},afterBattleFresh:function(){},refreshUI:function(){var e=this;this.m_status=this._bossInfo.getStatus(),app.loadGeneral(this._bossInfo.imageid,this.p_sprGeneral,this.p_spGeneral,this.p_animGeneral,null,this.prefabPath),this.p_proHp.progress=this._bossInfo.getBloodBar(),this.p_labHp.string=(100*this._bossInfo.getBloodBar()).toFixed(2)+"%",this.p_labName.string=this._bossInfo.name,this.p_nodeLeave.active=this._bossInfo.isLeave()&&1==this.m_status,this.p_nodeKill.active=2==this.m_status,this.p_nodeLeaveTitle.active=3==this.m_status,this.p_proHp.node.active=1==this.m_status;var t=0;this.p_nodeCampItems.forEach(function(a,i){a.active=!0;var n=i+1;a.getComponent("northCampItem").refreshUI(n,e);var r=app.northInfo.battlearr.get(n);r&&!t&&(t=n),!e.checkTeamno&&r&&r.vit>0&&(e.checkTeamno=n)}),this.refreshBtn(),!this.checkTeamno&&t&&(this.checkTeamno=t),this.checkTeamno&&this.selectTeamno(this.checkTeamno)},selectTeamno:function(e){var t=this;1!==this._bossInfo.getStatus()?this.p_nodeCampItems.forEach(function(e){e.getComponent("northCampItem").selected(!1)}):(this.checkTeamno=e,this.p_nodeCampItems.forEach(function(e,a){var i=a+1;e.getComponent("northCampItem").selected(i==t.checkTeamno)}),this.refreshBtn())},refreshBtn:function(){this.p_btnMap.node.active=this._bossInfo.lastdamge&&this._bossInfo.lastdamge[this.checkTeamno]&&1==this._bossInfo.getStatus(),this.p_btnFight.node.active=this.checkTeamno>0&&1==this._bossInfo.getStatus()},refreshTime:function(){if(this._bossInfo&&this._bossInfo.isLeave())if(1==this._bossInfo.getStatus()){var e=this._bossInfo.isLeave()-app.player.getServerTime();this.p_labLeaveTime.string=gUtils.getCountDownStr(e)}else this.p_nodeLeave.activeInHierarchy&&(this.p_nodeLeave.active=!1,this.refreshUI())},onFight:function(){var e=this;app.northInfo.battlearr.get(this.checkTeamno).vit<=0?app.showNotice(langMgr.getString("palacePage",22)):2!=this._bossInfo.getStatus()?3!=this._bossInfo.getStatus()?app.player.sfNorthBossInfo({point:this._bossInfo.point,mapid:this._bossInfo.mapid},function(t,a){if(t)return"boss run"==t?(t=langMgr.getString("palacePage",24),app.player.sfNorthInfo()):"boss is killed"==t&&(t=langMgr.getString("palacePage",23),app.player.sfNorthInfo()),void app.showNotice(t);app.rightCards=[];for(var i=0;i<app.northInfo.buff.length;++i)app.rightCards.push({id:app.northInfo.buff[i].id});app.northTeamIndex=e.checkTeamno;var n=1;for(var r in a){n=a[r].level;break}app.battleParam={point:e._bossInfo.point,mapid:e._bossInfo.mapid};var o={gsid:e._bossInfo.icon,rname:e._bossInfo.rname,level:n,bset:a};app.goToBossBattle("northfight",o)}):app.showNotice(langMgr.getString("palacePage",24)):app.showNotice(langMgr.getString("palacePage",23))},onConfirmMop:function(){var e=this;app.northInfo.battlearr.get(this.checkTeamno).vit<=0?app.showNotice(langMgr.getString("palacePage",22)):2!=this._bossInfo.getStatus()?3!=this._bossInfo.getStatus()?app.player.sfNorthBossFightWipe({point:this._bossInfo.point,mapid:this._bossInfo.mapid,teamno:this.checkTeamno,times:1},function(t,a){if(t)return"boss run"==t?(t=langMgr.getString("palacePage",24),app.player.sfNorthInfo()):"boss is killed"==t&&(t=langMgr.getString("palacePage",23),app.player.sfNorthInfo()),void app.showNotice(t);var i={showtype:1,reward:a.items,target:e};app.player.addItem(a.items),app.pages.windowspagereward.showPage(i),app.player.sfNorthInfo()}):app.showNotice(langMgr.getString("palacePage",24)):app.showNotice(langMgr.getString("palacePage",23))},onMop:function(){var e={content:langMgr.getString("palacePage",25,this._bossInfo.lastdamge[this.checkTeamno]),confirmcb:this.onConfirmMop,target:this};app.pages.windowspagetipsmsg.showPage(e)},onClose:function(){this._super(),app.pages.palacepage.instance&&app.pages.palacepage.instance.CheckOverLevel()}});cc._RF.pop()},{basePage:void 0}],northBossRewardPage:[function(e,t){"use strict";cc._RF.push(t,"caf65QHN9BLd5PiXdPq7/ip","northBossRewardPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"northbossrewardpage",pageType:1},properties:{p_tabViewProp:cc.Node,p_pfbRewardItem:cc.Prefab,p_nodeRewardContent:cc.Node},onLoad:function(){a.instance=this,this.handleUI(),this.creatMask(!0),this.m_arrItems=[]},handleUI:function(){this._super()},setParam:function(e){this.m_arrRewards=e.rewards||[],this.m_arrAucRewards=e.auction_pool||[],this.refreshUI()},refreshUI:function(){for(var e=0;e<this.m_arrRewards.length;++e){var t=this.m_arrItems[e];t||((t=cc.instantiate(this.p_pfbRewardItem)).parent=this.p_nodeRewardContent,this.m_arrItems.push(t)),t.active=!0,t.getComponent("propItem").initForBag(this.m_arrRewards[e]),t.getComponent("propItem").setClick(!0)}for(var a=this.m_arrRewards.length;a<this.m_arrItems.length;++a)this.m_arrItems[a].active=!1;var i=this.m_arrAucRewards;this.p_tabViewProp.getComponent("tableView").initTableView(i.length,{array:i,initfun:"initForGsid",target:this}),this.p_tabViewProp.getComponent("tableView").getCells(function(e){e.forEach(function(e){e.getComponentInChildren("propItem")&&e.getComponentInChildren("propItem").setClick(!0)})})}});cc._RF.pop()},{basePage:void 0}],northRewardPage:[function(e,t){"use strict";cc._RF.push(t,"17c84iMpnxD56g1aNE7NrJs","northRewardPage");var a=[{title:0,rewardTitle:1},{title:2,rewardTitle:3},{title:4,rewardTitle:5}],i=cc.Class({extends:e("basePage"),statics:{prefabPath:"northrewardpage",pageType:1},properties:{p_rankRewardTitle:cc.Node,p_auctionsRewardTitle:cc.Node,p_killRewardTitle:cc.Node,p_labRewardTitle:cc.Label,p_nodePropTableView:cc.Node,p_nodeRankTableView:cc.Node,p_labTime:cc.Label,p_rankRewardTip:cc.Node,p_auctionsRewardTip:cc.Node,p_killRewardTip:cc.Node,p_currlevel:cc.Label,p_labKillLeaveBoss:cc.Label,p_labKillnormalBoss:cc.Label,p_labKilllowBoss:cc.Label},onLoad:function(){i.instance=this,this.handleUI(),this.creatMask(!0),this.isCanClick=!0,this.m_menu=this.node.getComponent("menu"),this.m_menu.init(this)},handleUI:function(){this._super()},onEnable:function(){this._super(),eventMgr.on(eventStr.commonEvent.RefreshTime,this.refreshNorthCountDown,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.commonEvent.RefreshTime,this.refreshNorthCountDown,this)},setParam:function(e){this.m_objData=e,this.isCanClick=!0,this.m_index=-1,this.m_menu.setMenuIndex(0)},menuHandler:function(e){if(!this.isCanClick)return!1;switch(this.p_rankRewardTip.active=0==e,this.p_auctionsRewardTip.active=1==e,this.p_killRewardTip.active=2==e,this.p_rankRewardTitle.active=0==e,this.p_auctionsRewardTitle.active=1==e,this.p_killRewardTitle.active=2==e,this.p_labRewardTitle.string=langMgr.getString("northRewardPage",a[e].rewardTitle),this.p_nodePropTableView.active=0!=e,this.p_nodeRankTableView.active=0==e,this.m_index=e,this.isCanClick=!1,e){case 0:this.refreshRankReward();break;case 1:this.refreshAuctionsReward();break;case 2:this.refreshKillReward();break;default:this.isCanClick=!0}},refreshRankReward:function(){this.isCanClick=!0;var e=app.db.dbNorthRankReward;this.p_nodeRankTableView.getComponent("tableView").initTableView(e.length,{array:e,target:this})},refreshAuctionsReward:function(){var e=this;if(!app.northInfo)return this.isCanClick=!0,void this.initViewProp([]);app.player.sfNorthKillReward(function(t,a){e.isCanClick=!0;var i=[];a&&(i=a.auctions.map(function(e){return e.item})),e.initViewProp(i)})},refreshKillReward:function(){var e=this;if(!app.northInfo)return this.isCanClick=!0,this.p_currlevel.string=0,this.p_labKillLeaveBoss.string=0,this.p_labKillnormalBoss.string=0,this.p_labKilllowBoss.string=0,void this.initViewProp([]);var t=app.northInfo.curlevel+1,a=app.northInfo.ispass?app.northInfo.curlevel+1:app.northInfo.curlevel;this.p_currlevel.string=t,this.p_labKillLeaveBoss.string=app.northInfo.killleaveboss,this.p_labKillnormalBoss.string=4*a,this.p_labKilllowBoss.string=a,app.player.sfNorthReportRank(function(t,a){e.isCanClick=!0;var i=[];a&&(i=a.killrewards),e.initViewProp(i)})},initViewProp:function(e){void 0===e&&(e=[]),this.p_nodePropTableView.getComponent("tableView").initTableView(e.length,{array:e,target:this}),this.p_nodePropTableView.getComponent("tableView").getCells(function(e){e.forEach(function(e){e.getComponentInChildren("propItem")&&e.getComponentInChildren("propItem").setClick(!0)})})},refreshNorthCountDown:function(){var e=app.lockFunConfig.getEndTimeByKey("EXPEDITION_HUN");this.p_labTime.string=langMgr.getString("northRewardPage",6,gUtils.getCountDownStr(e))}});cc._RF.pop()},{basePage:void 0}],noticePage:[function(e,t){"use strict";cc._RF.push(t,"91cbfmEjQlC4LbS0QZKzDpI","noticePage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"noticepage"},properties:{p_labContent:cc.Label,p_menu:e("menu")},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.p_menu.init(this)},handleUI:function(){this._super()},setParam:function(e){if(this.m_strContent=e,gSetting.funofhide&&(this.m_strContent="\u6b22\u8fce\u60a8\u7684\u5230\u6765\uff0c\u795d\u60a8\u6e38\u620f\u6109\u5feb*/*\u6b22\u8fce\u60a8\u7684\u5230\u6765\uff0c\u795d\u60a8\u6e38\u620f\u6109\u5feb*/*\u6b22\u8fce\u60a8\u7684\u5230\u6765\uff0c\u795d\u60a8\u6e38\u620f\u6109\u5feb*/*\u6b22\u8fce\u60a8\u7684\u5230\u6765\uff0c\u795d\u60a8\u6e38\u620f\u6109\u5feb"),this.m_arrNoticeData=this.m_strContent.split("*/*"),this.m_arrNoticeData){for(var t=0;t<this.m_arrNoticeData.length;t++){for(var a=this.m_arrNoticeData[t].split("\n"),i="",n=0;n<a.length;n++)i+=a[n],n!=a.length-1&&(i+="\n");this.m_arrNoticeData[t]=i}this.p_menu.setMenuIndex(0)}},menuHandler:function(e){cc.log("numIndex  = "+e),this.m_showData=this.m_arrNoticeData[e],this.refreshUI()},refreshUI:function(){this.p_labContent.string=this.m_showData||""}});cc._RF.pop()},{basePage:void 0,menu:void 0}],occThalentPage:[function(e,t){"use strict";cc._RF.push(t,"0302fYD/KpJVqw0UPC1qeXz","occThalentPage");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=e("basePage"),o=cc._decorator,s=o.ccclass,p=o.property,c=function(){function e(){this.MAXROW=5,this.MINROW=1,this.MAXOCC=5,this.MINOCC=1,this.MAXLIMIT=25,this.Config={},this.playerData={};for(var e=this.MINOCC;e<=this.MAXOCC;e++){this.Config[e]||(this.Config[e]={});for(var t=this.MINROW;t<=this.MAXROW;t++)this.Config[e][t]||(this.Config[e][t]={SKILLS:[],ATTRS:[]})}}return e.prototype.insertSkillConfig=function(e){this.Config[e.OCC][e.ROW].SKILLS.push(e)},e.prototype.insertAttrConfig=function(e){this.Config[e.OCC][e.ROW].ATTRS.push(e)},e.prototype.insertPlayerData=function(e){this.playerData=e},e.prototype.getConfigByOCC=function(e){return this.Config[e]},e.prototype.getSkillConfigByOCC=function(e){var t=[];for(var a in this.Config[e]){var i=this.Config[e][a];t=t.concat(i.SKILLS)}return t},e.prototype.getTotalUseThalentScore=function(e){var t=0;for(var a in this.playerData)app.db.dbOCCThalentAttr[a]&&app.db.dbOCCThalentAttr[a].OCC==e&&(t+=Number(this.playerData[a]));return t},e.prototype.getAllTotalUseThalentScore=function(){var e=0;for(var t in this.playerData)e+=Number(this.playerData[t]);return e},e.prototype.getTotalThalentScore=function(e){var t=0;if(this.Config&&this.Config[e]){var a=this.Config[e];for(var i in a)a[i].ATTRS.forEach(function(e){t+=e.COST*e.MAXLV})}return t},e.prototype.getThalentLv=function(e){return this.playerData&&this.playerData[e]?this.playerData[e]:0},e.prototype.getTotalThalentAttrs=function(e){var t={},a=function(a){var n=i.playerData[a];app.db.dbOCCThalentAttr[a]&&app.db.dbOCCThalentAttr[a].OCC==e&&app.db.dbOCCThalentAttr[a].ATTRS.forEach(function(e){t[e.ID]||(t[e.ID]=0),t[e.ID]+=e.NUM+e.GROWNUM*(n-1)})},i=this;for(var n in this.playerData)a(n);return t},e.prototype.isLocked=function(e){return this.getTotalUseThalentScore(e.OCC)<e.LIMIT},e.prototype.isLimitUp=function(e){return this.getTotalUseThalentScore(e)>=this.MAXLIMIT},e}(),h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.m_skillNodes=[],t.m_attrNodes={},t.p_nodeAttrsParent=[],t.p_nodeLines=[],t.p_nodeBlocks=[],t.p_nodeSkillsParent=null,t.p_prefabSkill=null,t.p_barCost=null,t.p_btnHelp=null,t.p_btnShowTotal=null,t.p_btnReset=null,t.p_labUseCost=null,t.p_labSurplusCost=null,t.p_animNode=null,t.p_animPower_01=null,t.p_animPower_02=null,t.p_animPower_03=null,t.p_nodePowerNum=null,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,e.prototype.onLoad.call(this),e.prototype.fitTopMenu.call(this),this.m_menu=this.node.getComponent("menu"),this.m_menu.init(this),this.initConfig()},t.prototype.onEnable=function(){e.prototype.onEnable.call(this),eventMgr.on(eventStr.occThalentPageEvent.RefreshPlayerData,this.refreshPlayerData,this),eventMgr.on(eventStr.occThalentPageEvent.RefreshThalentView,this.refreshThalentView,this)},t.prototype.onDisable=function(){e.prototype.onDisable.call(this),eventMgr.off(eventStr.occThalentPageEvent.RefreshPlayerData,this.refreshPlayerData,this),eventMgr.off(eventStr.occThalentPageEvent.RefreshThalentView,this.refreshThalentView,this)},t.prototype.onDestroy=function(){e.prototype.onDestroy.call(this),this.TConfig=null},t.prototype.onClose=function(){e.prototype.onClose.call(this),eventMgr.emit(eventStr.redEvent.RefreshNationWarMainRed)},t.prototype.refreshPlayerData=function(){var e={};for(var t in app.player.military){if(app.player.military[t].talent)for(var a in app.player.military[t].talent)e[a]=app.player.military[t].talent[a];if(app.player.military[t].skill)for(var i in app.player.military[t].skill)e[i]=app.player.military[t].skill[i]}this.TConfig.insertPlayerData(e)},t.prototype.initConfig=function(){for(var e in this.TConfig=new c,app.db.dbOCCThalentSkill)(a=app.db.dbOCCThalentSkill[e]).ROW&&(a.ID=e,a.LIMIT=a.COST,this.TConfig.insertSkillConfig(a));for(var t in app.db.dbOCCThalentAttr){var a;(a=app.db.dbOCCThalentAttr[t]).ROW&&(a.ID=t,a.LIMIT=5*(a.ROW-1),this.TConfig.insertAttrConfig(a))}},t.prototype.handleUI=function(){var t=this;e.prototype.handleUI.call(this),this.p_btnHelp.node.on("click",function(){app.playSound("click"),app.pages.windowspagetipshelp.showPage("1123")}),this.p_btnShowTotal.node.on("click",function(){app.playSound("click"),app.pages.windowspageoccthalenttotal.showPage(t.m_index+1)}),this.p_btnReset.node.on("click",function(){if(app.playSound("click"),app.player.getCount(38005)<100)app.showNotice(langMgr.getString("occthalentpage",0));else{var e={content:langMgr.getString("occthalentpage",1,100),confirmcb:function(){var e=app.player.power;app.player.sfOccThalentReset({occ:t.m_index+1},function(a,i){a?"empty talent"==a&&app.showNotice(langMgr.getString("occthalentpage",4)):(app.showNotice(langMgr.getString("occthalentpage",2)),app.player.military={},app.player.power=i.power,t.animPower(app.player.power,e),app.player._refreshGeneral(i.generals),app.player.sfPlayerByParam(["hide","props","others","military"],function(){eventMgr.emit(eventStr.occThalentPageEvent.RefreshPlayerData),eventMgr.emit(eventStr.occThalentPageEvent.RefreshThalentView)}))})},target:t};app.pages.windowspagetipsmsg.showPage(e)}})},t.prototype.setParam=function(){this.refreshPlayerData(),this.createThalentView(0),this.m_menu.setMenuIndex(0)},t.prototype.createThalentView=function(e){var t=this,a=e+1,i=this.TConfig.getConfigByOCC(a);this.p_nodeSkillsParent.removeAllChildren();var n=function(e){var a=i[e],n=Number(e)-1;r.p_nodeAttrsParent[n].removeAllChildren(),a.SKILLS.forEach(function(){var e=cc.instantiate(t.p_prefabSkill);e.parent=t.p_nodeSkillsParent,t.m_skillNodes.push(e)}),a.ATTRS.forEach(function(){var a=cc.instantiate(t.p_prefabSkill);a.parent=t.p_nodeAttrsParent[n],t.m_attrNodes[e]||(t.m_attrNodes[e]=[]),t.m_attrNodes[e].push(a)})},r=this;for(var o in i)n(o)},t.prototype.animPower=function(e,t){cc.log("beforePower"+t+", curPower: "+e)},t.prototype.refreshThalentView=function(){var e=this,t=this.m_index+1,a=this.TConfig.getConfigByOCC(t),i=-1,n=function(t){var n=a[t],o=Number(t)-1,s=-1;n.SKILLS.forEach(function(t){e.m_skillNodes[o]&&e.m_skillNodes[o].getComponent("occThalentSkillItem").refreshUI(t),i++}),n.ATTRS.forEach(function(a,i){e.m_attrNodes[t][i]&&e.m_attrNodes[t][i].getComponent("occThalentSkillItem").refreshUI(a),s++});for(var p=s+1;p<r.m_attrNodes[t].length;p++)r.m_attrNodes[t][p].active=!1},r=this;for(var o in a)n(o);for(var s=i+1;s<this.m_skillNodes.length;s++)this.m_skillNodes[s].active=!1;var p=this.TConfig.getTotalUseThalentScore(t),c=(p-5)/20;c=Math.max(0,c),this.p_barCost.progress=c,this.p_nodeBlocks.forEach(function(t,a){var i=p>=5*(a+1)?"tianfu_bg_light":"tianfu_bg_dark";app.loadTexture(gConfig.getOccThalentPath(i),t.getComponent(cc.Sprite),e.prefabPath)}),this.p_nodeLines.forEach(function(t,a){var i=p>=5*(a+1)?"tianfu_line_light":"tianfu_line_dark";app.loadTexture(gConfig.getOccThalentPath(i),t.getComponent(cc.Sprite),e.prefabPath)}),this.p_labUseCost.string=this.TConfig.getTotalUseThalentScore(t)+"/"+this.TConfig.MAXLIMIT,this.p_labSurplusCost.string=app.player.getCount(38020).toString()},t.prototype.refreshMenuRed=function(){return!1},t.prototype.menuHandler=function(e){return this.m_menu.refreshRed(),this.m_index=e,this.refreshThalentView(),!0},t.prefabPath="occthalentpage",n([p([cc.Node])],t.prototype,"p_nodeAttrsParent",void 0),n([p([cc.Sprite])],t.prototype,"p_nodeLines",void 0),n([p([cc.Sprite])],t.prototype,"p_nodeBlocks",void 0),n([p(cc.Node)],t.prototype,"p_nodeSkillsParent",void 0),n([p(cc.Prefab)],t.prototype,"p_prefabSkill",void 0),n([p(cc.ProgressBar)],t.prototype,"p_barCost",void 0),n([p(cc.Button)],t.prototype,"p_btnHelp",void 0),n([p(cc.Button)],t.prototype,"p_btnShowTotal",void 0),n([p(cc.Button)],t.prototype,"p_btnReset",void 0),n([p(cc.Label)],t.prototype,"p_labUseCost",void 0),n([p(cc.Label)],t.prototype,"p_labSurplusCost",void 0),n([p(cc.Animation)],t.prototype,"p_animNode",void 0),n([p(cc.Animation)],t.prototype,"p_animPower_01",void 0),n([p(cc.Animation)],t.prototype,"p_animPower_02",void 0),n([p(cc.Animation)],t.prototype,"p_animPower_03",void 0),n([p(cc.Node)],t.prototype,"p_nodePowerNum",void 0),a=n([s],t)}(r);h.refreshRed=function(e){var t=!1;return app.player.getCount(38020)>0&&(t=!0),e&&(e.active=t),t},t.exports=h,cc._RF.pop()},{basePage:void 0}],officePageOfficial:[function(e,t){"use strict";cc._RF.push(t,"b2d99ZlR8BJCqTHAF2u6MWp","officePageOfficial"),cc.Class({extends:cc.Component,properties:{p_labNowAttr:cc.Label,p_sprIcon:cc.Sprite,p_sprName:cc.Sprite,p_nodeList:cc.Node,p_arrMissionNode:[cc.Node],p_btnUp:cc.Button,p_btnSalary:cc.Button,p_arrSpNode:[cc.Node],p_btnShop:cc.Button},onLoad:function(){var e=this;this.p_btnUp.node.on("click",function(){app.playSound("click"),e.onClickBtnUp()}),this.p_btnSalary.node.on("click",function(){app.playSound("click"),e.onClickBtnSalary()}),this.p_btnShop.node.on("click",function(){app.playSound("click"),app.pages.shoppage.showPage("offical")})},refreshUI:function(){var e,t=this,a=app.player.getCount(38004);e=app.db.dbOfficialItems[a].ATTR;for(var i="",n=0;n<e.length;++n){var r=e[n],o=app.db.dbProperty[r.KEY].NAME,s=r.VAL;2==app.db.dbProperty[r.KEY].NUMTYPE&&(s=s/10+"%"),i+=o+" +"+s+" "}this.p_labNowAttr.string=""==i?langMgr.getString("officePageOfficial",3):i;var p=gConfig.getOfficialIconPath(a);p?app.loadTexture(p,this.p_sprIcon,app.pages.officepage.prefabPath,function(){t.p_sprIcon.node.active=!0}):this.p_sprIcon.node.active=!1;var c=gConfig.getOfficialNamePath(a);c?app.loadTexture(c,this.p_sprName,app.pages.officepage.prefabPath,function(){t.p_sprName.node.active=!0}):this.p_sprName.node.active=!1;var h=app.pages.officepage.checkReward();if(this.p_btnSalary.node.getChildByName("rednotice").active=h,a>=app.db.dbOfficialItems.length)return this.p_nodeList.active=!1,void(this.p_btnUp.node.active=!1);this.p_nodeList.active=!0,this.p_btnUp.node.active=!0;var l=a>=app.db.dbOfficial.length?app.db.dbOfficial.length-1:a,g=app.db.dbOfficial[l];this.p_arrMissionNode.forEach(function(e,t){var a=g[t];e.getComponent("officialMissionItem").refreshUI(a)}),this.refreshBtn()},refreshBtn:function(){for(var e=app.player.getCount(38004),t=e>=app.db.dbOfficial.length?app.db.dbOfficial.length-1:e,a=app.db.dbOfficial[t],i=0;i<a.length;++i){var n=a[i];if(app.player.getCount(n.GETMARK)<=0)return void(this.p_btnUp.node.active=!1)}this.p_btnUp.node.active=!0},onClickBtnUp:function(){var e=this;app.player.sfOfficialPromo(function(t,a){if(t)app.showNotice(t);else{var i={showtype:1,reward:a,confirmcb:function(){app.player.sfPlayerData(function(){app.pages.windowsPageOfficeRaised.showPage(),e.refreshUI(),app.pages.officepage.instance.refreshUI(),app.pages.manorpage.instance&&cc.isValid(app.pages.manorpage.instance.node)&&app.pages.manorpage.instance.refreshRed()})},target:e};app.pages.windowspagereward.showPage(i)}})},onClickBtnSalary:function(){app.pages.windowspageofficereward.showPage(this)},onSalary:function(){var e=this,t=app.player.getCount(90162);app.player.getCount(38004)?t>0?app.showNotice(langMgr.getString("officePageOfficial",2)):app.player.sfOfficialSalary(function(t,a){if(t)app.showNotice(t);else{var i={showtype:1,reward:a,confirmcb:function(){app.player.sfPlayerData(function(){e.refreshUI(),app.pages.officepage.instance.refreshUI(),app.pages.manorpage.instance&&cc.isValid(app.pages.manorpage.instance.node)&&app.pages.manorpage.instance.refreshRed()})},target:e};app.pages.windowspagereward.showPage(i)}}):app.showNotice(langMgr.getString("officePageOfficial",1))}}),cc._RF.pop()},{}],officePageSurrenderSucc:[function(e,t){"use strict";cc._RF.push(t,"6430c9zJZVB65SRNSA8Ww7h","officePageSurrenderSucc"),cc.Class({extends:cc.Component,properties:{general:e("generalSample"),btnConfirm:cc.Button,intro:cc.Label,anim:sp.Skeleton},onLoad:function(){var e=this;this.node.on("touchstart",function(e){e.stopPropagation()}),this.node.on("touchmove",function(e){e.stopPropagation()}),this.node.on("touchend",function(e){e.stopPropagation()}),this.btnConfirm.node.on("click",function(){app.playSound("click"),e.node.active=!1,app.showRecommendGift()}),this.node.on("touchstart",function(e){e.stopPropagation()}),this.node.on("touchmove",function(e){e.stopPropagation()}),this.node.on("touchend",function(e){e.stopPropagation()})},refreshUI:function(e,t){this.general.setGeneralSample(e,t),this.intro.string=app.db.getStrTalkByType(1);var a=app.db.getGBaseByGsid(e).STAR;this.anim.setAnimation(0,""+a,!1)}}),cc._RF.pop()},{generalSample:void 0}],officePageSurrender:[function(e,t){"use strict";cc._RF.push(t,"6bbf5Ovo0dCSYXb3Oz26P7t","officePageSurrender"),cc.Class({extends:cc.Component,properties:{p_nodeList:cc.Node,p_tabvGeneral:cc.tableView,p_nodePick:cc.Node,p_labGName:cc.Label,p_sprGeneral:cc.Sprite,p_spGeneral:sp.Skeleton,p_animGeneral:cc.Animation,p_barLoyal:cc.ProgressBar,p_labLoyal:cc.Label,p_btnKill:cc.Button,p_btnSurrender:cc.Button,p_labCast:cc.Label,p_nodeHave:cc.Node,p_nodeNone:cc.Node,p_nodeSucc:cc.Node,p_btnQ:cc.Button},onLoad:function(){var e=this;this.p_btnKill.node.on("click",function(){app.playSound("click"),e.onClickBtnKill()}),this.p_btnSurrender.node.on("click",function(){app.playSound("click"),e.onClickBtnSurrender()}),this.p_btnQ.node.on("click",function(){app.playSound("click");var t={type:2,gsid:e.m_arrSrenderData[e.m_selectGsid].gsid};app.pages.generalpage.showPage(t,app.mainScene.p_nodeBg)})},getNewData:function(){var e=this;app.player.sfSrenderList(function(t,a){t?app.showNotice(t):(e.m_arrShowData=e.setData(a),e.refreshView())})},refreshUI:function(){},refreshPick:function(e){if(!e)return this.p_nodePick.active=!1,void(this.p_nodeList.active=!1);this.m_objData=e,this.p_nodePick.active=!0,this.p_nodeList.active=!0;var t=app.db.getGBaseByGsid(e.gsid);this.p_labGName.string=t.NAME,app.loadGeneral(t.GSID,this.p_sprGeneral,this.p_spGeneral,this.p_animGeneral,null,app.pages.manorprisonpage.prefabPath);var a=e.loyal;this.p_barLoyal.progress=a/100,this.p_labLoyal.string=a+"/100";var i=app.db.dbSurrender[this.m_selectGsid].CAST;this.p_labCast.string=i},refreshView:function(){var e=this;if(this.m_arrShowData){var t=this.m_arrShowData.length;if(this.p_tabvGeneral.initTableView(t,{array:this.m_arrShowData,maxpick:1,initfun:"initForSurrender",scale:.8,target:this},function(){!e.m_selectGsid&&t>0&&e.p_tabvGeneral.getContentChildByTag(0).children[0].getComponent("generalTabvItem").clicked()}),t<=0)return this.m_selectGsid=null,this.m_selectBtn=null,this.refreshPick(),this.p_nodeHave.active=!1,void(this.p_nodeNone.active=!0);this.p_nodeHave.active=!0,this.p_nodeNone.active=!1}},itemClick:function(e,t){if(this.m_selectGsid==e)return!0;var a=this.m_arrSrenderData[e];return this.m_selectBtn&&this.m_selectBtn.selected(!1,this.m_selectGsid),this.m_selectBtn=t,this.m_selectGsid=e,this.refreshPick(a),!0},setData:function(e){var t=[];for(var a in this.m_arrSrenderData={},e)"__verify"!=a&&(0==e[a].state&&t.push(a),this.m_arrSrenderData=e);return cc.log(t,this.m_arrSrenderData),t},onClickBtnSurrender:function(){var e=this;if(this.m_arrSrenderData[this.m_selectGsid]){var t=app.db.dbSurrender[this.m_selectGsid].CAST;app.player.getCount(38006)<t?app.showNotice(langMgr.getString("officePageSurrender",0)):app.player.sfSrenderPersua(this.m_selectGsid,function(t,a){if(t)return"cant behead"==t?void app.showNotice(langMgr.getString("officePageSurrender",1)):void app.showNotice(t);app.player.sfPlayerData(function(){return a.loyal?(app.showNotice(langMgr.getString("officePageSurrender",2)),e.m_arrSrenderData[e.m_selectGsid].loyal=a.loyal,void e.refreshPick(e.m_arrSrenderData[e.m_selectGsid])):a.reward?(e.p_nodeSucc.active=!0,e.p_nodeSucc.getComponent("officePageSurrenderSucc").refreshUI(e.m_arrSrenderData[e.m_selectGsid].gsid,e),e.refreshPick(),e.m_selectGsid=null,e.m_selectBtn=null,e.m_arrPickedId=[],void e.getNewData()):void 0})})}},onClickBtnKill:function(){var e=app.db.dbSurrender[this.m_selectGsid].KILL,t={content:langMgr.getString("officePageSurrender",4),props:e,confirmcb:this.killCb,target:this};app.pages.windowspagepreview.showPage(t)},killCb:function(){var e=this;this.m_arrSrenderData[this.m_selectGsid],app.player.sfSrenderBehead(this.m_selectGsid,function(t,a){if(t)return"cant behead"==t?void app.showNotice(langMgr.getString("officePageSurrender",3)):void app.showNotice(t);var i={showtype:1,reward:a,confirmcb:function(){app.player.sfPlayerData(function(){e.refreshPick(),e.m_selectGsid=null,e.m_selectBtn=null,e.m_arrPickedId=[],e.getNewData()})},target:e};app.pages.windowspagereward.showPage(i)})}}),cc._RF.pop()},{}],officePage:[function(e,t){"use strict";cc._RF.push(t,"8619eaMVJFHaKmPyRLUMcAs","officePage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"officepage"},properties:{p_menu:e("menu"),p_nodeOfficial:cc.Node,p_nodeOfficialAppoint:cc.Node,p_btnBack:cc.Button,p_arrNode_Special:[cc.Node]},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(),this.handleUI(),this.fitTopMenu(),this.p_menu.init(this),this.refreshByPgts()},onEnable:function(){this._super(),eventMgr.on(eventStr.officeEvent.Refresh,this.onRefresh,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.officeEvent.Refresh,this.onRefresh,this)},onRefresh:function(){this.p_nodeOfficial.getComponent("manorOfficePage").refreshUI()},handleUI:function(){var e=this;this.p_btnBack.node.on("click",function(){app.playSound("click"),e.onClose()})},setParam:function(e){var t;console.log(e),e&&(t=e.type,this.m_adapter=e.adapter),this.m_blnOnManorPage=!!t,t=t||1,this.p_menu.setMenuIndex(t-1),this.refreshUI()},refreshUI:function(){var e=0,t=this.node.getComponent(cc.Widget);eventMgr.emit(eventStr.redEvent.RefreshMainSceneRed),this.m_adapter&&(e=100),this.p_btnBack.node.active=!this.m_adapter,t.bottom=e,t.updateAlignment(),this.p_menu.refreshRed()},refreshMenuRed:function(e){var t=!1;if(0==e){var a=app.pages.officepage.checkUp(),i=app.pages.officepage.checkReward();t=a||i}return 1==e&&(t=app.pages.officepage.checkGeneralAppoint()),t},menuHandler:function(e){var t=this;switch(e){case 0:this.p_nodeOfficial.active=!0,this.p_nodeOfficialAppoint.active=!1,this.p_nodeOfficial.getComponent("manorOfficePage").refreshUI();break;case 1:var a=app.db.getOfficialInfoByLv(4);if(app.player.getCount(38004)<4)return app.showNotice(langMgr.getString("officePage",0,a.NAME)),!1;app.player.sfGetOfficialInfo().then(function(e){t.p_nodeOfficial.active=!1,t.p_nodeOfficialAppoint.active=!0,t.p_nodeOfficialAppoint.getComponent("GeneralAppoint").refreshUI(e)}).catch(function(e){cc.warn("sfGetOfficialInfo error",e)})}},onClose:function(){this._super()},refreshByPgts:function(){this.p_arrNode_Special.forEach(function(e){e.active=gSetting.checkReviewServ()})}});a.refreshRed=function(e){var t=!1;return(a.checkUp()||a.checkReward()||a.checkGeneralAppoint()||a.checkMissionReward())&&(t=!0),e&&(e.active=t),t},a.checkMissionReward=function(e){var t=!0,a=app.player.getCount(38004);if(app.db.getOfficeMaxLv()<=a&&(t=!1),t){for(var i=!1,n=app.db.getOfficialMissionInfoByLv(a),r=0;r<n.length;++r){var o=n[r],s=app.player.getMissionState(o);if(s.now>=s.end){var p=app.player.getCount(o.GETMARK)<1;i=i||p}}t=t&&i}return cc.isValid(e)&&(e.active=t),t},a.checkUp=function(){var e=app.db.dbOfficial.length,t=app.player.getCount(38004),a=Math.min(e,t);if(a==e)return!1;for(var i=app.db.dbOfficial[a],n=4,r=0;r<i.length;++r){var o=i[r],s=app.player.getMissionState(o);if(2!==s.state&&app.player.getCount(o.GETMARK)<1&&t>0)return!0;s.now<s.end&&n--}return!(n<4)},a.checkReward=function(){var e=app.player.getCount(90162);return!(!app.player.getCount(38004)||e>0)},a.checkSurrender=function(){return!1},a.checkGeneralAppoint=function(){if(app.redDataServer){var e=app.redDataServer.official;return!!e&&(e.general_official>0||e.general_retinue>0)}},a.officeGrade=function(){app.player.sfRedInfo(function(e,t){e||(app.redDataServer=t,eventMgr.emit(eventStr.redEvent.RefreshMainSceneRed),cc.isValid(app.pages.officepage.instance)&&app.pages.officepage.instance.p_menu.refreshRed())})},cc._RF.pop()},{basePage:void 0,menu:void 0}],officeRewardShowPage:[function(e,t){"use strict";cc._RF.push(t,"e858cUh5K5AIon1NOtDCQv2","officeRewardShowPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"officerewardshowpage",pageType:1},properties:{p_nodeSalary:cc.Node,p_nodeAddition:cc.Node,p_nodeUp:cc.Node,p_tabSalaryNode:cc.Node,p_tabAdditionNode:cc.Node,p_tabUpNode:cc.Node,p_spTitle:cc.Sprite,p_spfTitleFrame:[cc.SpriteFrame]},onLoad:function(){a.instance=this,this.handleUI(),this.stopBgNodeEvent(),this.creatMask(!0),this.m_menu=this.node.getComponent("menu"),this.m_menu.init(this)},setParam:function(e){void 0===e&&(e=0),this.m_data=app.db.dbOfficialItems,this.m_length=this.m_data.length,this.m_menu.setMenuIndex(e)},start:function(){},menuHandler:function(e){var t=this.p_spfTitleFrame[e];switch(cc.isValid(t)&&(this.p_spTitle.spriteFrame=t),e){case 0:this.p_nodeAddition.active=!0,this.p_nodeSalary.active=!1,this.p_nodeUp.active=!1,this.p_tabAdditionNode.getComponent("tableView").initTableView(this.m_length,{array:this.m_data,target:this});break;case 1:this.p_nodeAddition.active=!1,this.p_nodeSalary.active=!0,this.p_nodeUp.active=!1,this.p_tabSalaryNode.getComponent("tableView").initTableView(this.m_length,{array:this.m_data,salary:!0,target:this});break;case 2:this.p_nodeAddition.active=!1,this.p_nodeSalary.active=!1,this.p_nodeUp.active=!0,this.p_tabUpNode.getComponent("tableView").initTableView(this.m_length,{array:this.m_data,up:!0,target:this})}}});cc._RF.pop()},{basePage:void 0}],palaceGiftPage:[function(e,t){"use strict";cc._RF.push(t,"bc6328pSl9PQJa0Z60Pzcb4","palaceGiftPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"palacegiftpage",pageType:1},properties:{p_labName:cc.Label,p_labNameBig:cc.Label,p_labLegion:cc.Label,p_propContent:cc.Node,p_pfbPropItem:cc.Prefab,p_btnGet:cc.Button},onLoad:function(){a.instance=this,this.creatMask(!0),this.fitTopMenu(),this.stopBgNodeEvent(),this.handleUI(),this.m_arrItem=[]},handleUI:function(){var e=this;this._super(),this.p_btnGet.node.on("click",function(){e.onGet()})},onEnable:function(){this._super()},setParam:function(e){if(app.palaceData&&!(app.palaceData.gifts<=0))for(var t=0;t<app.palaceData.gifts.length;++t)if(e==app.palaceData.gifts[t].id){this._obj=app.palaceData.gifts[t],this.refreshUI();break}},refreshUI:function(){this.p_labName.string=app.palaceData.king.rname,this.p_labNameBig.string=app.palaceData.king.rname;var e=app.palaceData.king.legion||{};e.name?this.p_labLegion.string="\u3010"+e.name+"\u3011":this.p_labLegion.string=langMgr.getString("palaceGiftPage",2);for(var t=0;t<this._obj.rewards.length;++t)this.m_arrItem[t]||(this.m_arrItem[t]=cc.instantiate(this.p_pfbPropItem),this.m_arrItem[t].parent=this.p_propContent,this.m_arrItem[t].active=!0),this.m_arrItem[t].getComponent("propItem").initForBag(this._obj.rewards[t]),this.m_arrItem[t].getComponent("propItem").setClick(!0);for(var a=this._obj.rewards.length;a<this.m_arrItem.length;++a)this.m_arrItem[a].active=!1;this.p_btnGet.node.getChildByName("rednotice").active=!0},onGet:function(){var e=this;!app.palaceData||app.palaceData.checkGiftExistById(this._obj.id)?app.player.sfGetKrewards({id:this._obj.id},function(t,a){if(t)app.showNotice(langMgr.getString("palaceGiftPage",1));else{var i={showtype:1,reward:a.rewards};app.pages.windowspagereward.showPage(i),app.player.addItem(a.rewards),e.p_btnGet.interactable=!1,e.p_btnGet.node.getChildByName("rednotice").active=!1}}):app.showNotice(langMgr.getString("palaceGiftPage",0))},scrollAnim:function(){}});cc._RF.pop()},{basePage:void 0}],palaceIconPage:[function(e,t){"use strict";cc._RF.push(t,"4ea90sih6NBraQL3CmHNHJ4","palaceIconPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"palaceiconpage",pageType:1},properties:{p_labKname:cc.Label,p_btnChange:cc.Button,p_nodeItem:cc.Node,p_nodeChoose:cc.Node,p_btnCancel:cc.Button,p_btnSure:cc.Button},onLoad:function(){a.instance=this,this.creatMask(!0),this.fitTopMenu(),this.stopBgNodeEvent(),this.handleUI()},handleUI:function(){var e=this;this._super(),this.p_btnChange.node.on("click",function(){e.onChangeName()}),this.p_btnCancel.node.on("click",function(){e.onClose()}),this.p_btnSure.node.on("click",function(){e.onSure()}),this.p_nodeItem.on("touchend",function(){e.chooseItem(e.p_nodeItem)})},onEnable:function(){this._super(),eventMgr.on(eventStr.palaceEvent.RefreshKname,this.refreshKname,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.palaceEvent.RefreshKname,this.refreshKname,this)},setParam:function(){this.refreshUI()},refreshUI:function(){this.refreshKname(),this.refreshView()},refreshKname:function(){var e,t;this.p_labKname.string=null!=(e=null==(t=app.palaceData)?void 0:t.name)?e:""},refreshView:function(){var e=this,t=app.palaceData.icon||1,a=app.db.dbKingdom.FLAGICON;t=(t=t||1)>=1&&t<=a.length?t:1,this.m_arrItems||(this.m_arrItems=[this.p_nodeItem]);for(var i=function(i){var n=e.m_arrItems[i];n||((n=cc.instantiate(e.p_nodeItem)).parent=e.p_nodeItem.parent,n.on("touchend",function(){e.chooseItem(n)})),n.flag=i,t==i+1&&e.scheduleOnce(function(){e.chooseItem(n)},.03),n.active=!0,app.loadTexture(a[i],n.getComponent(cc.Sprite),e.prefabPath)},n=0;n<a.length;++n)i(n)},chooseItem:function(e){if(this._chooseIndex!=e.flag){this._chooseIndex=e.flag;var t=e.convertToWorldSpaceAR(cc.v2(0,0)),a=e.parent.parent.convertToNodeSpaceAR(t);this.p_nodeChoose.setPosition(a)}},onChangeName:function(){var e=this,t={cost:app.palaceData.editcast.name[0],titletips:langMgr.getString("palaceIconPage",3),limit:1,confirmCb:function(t){e.changeName(t.strname,t.cb)}};app.pages.windowspagenamechange.showPage(t)},changeName:function(e,t){app.palaceData.isKing&&(app.palaceData.editcast.name.length>0&&app.player.getCount(app.palaceData.editcast.name[0].GSID)<app.palaceData.editcast.name[0].COUNT?app.showNotice(langMgr.getString("palaceIconPage",0)):app.player.sfChangeKname({name:e},function(e,a){e?app.showNotice(langMgr.getString("palaceIconPage",1)):(t&&t(),app.player.reduceItem(app.palaceData.editcast.name),app.palaceData.editcast.name=a.name||[])}))},onSure:function(){app.player.sfSetPalaceFlag({icon:this._chooseIndex+1},function(e){e||app.showNotice(langMgr.getString("palaceIconPage",2))})}});cc._RF.pop()},{basePage:void 0}],palaceKingShangPage:[function(e,t){"use strict";cc._RF.push(t,"2859b7tgSBDqbLO28Puq83/","palaceKingShangPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"palacekingshangpage",pageType:1},properties:{p_nodeReward:cc.Node,p_pfbItem:cc.Prefab,p_btnFresh:cc.Button,p_btnSure:cc.Button,p_sprCost:cc.Sprite,p_sprCostTitle:cc.Sprite,p_labCost:cc.Label,p_labCountDown:cc.Label},onLoad:function(){a.instance=this,this.creatMask(!0),this.fitTopMenu(),this.stopBgNodeEvent(),this.handleUI()},handleUI:function(){var e=this;this._super(),this.p_btnFresh.node.on("click",function(){e.onFresh()}),this.p_btnSure.node.on("click",function(){e.onSure()})},onEnable:function(){this._super(),eventMgr.on(eventStr.palaceEvent.RefreshRewards,this.refreshRewards,this),eventMgr.on(eventStr.commonEvent.RefreshTime,this.refreshShangCountDown,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.palaceEvent.RefreshRewards,this.refreshRewards,this),eventMgr.off(eventStr.commonEvent.RefreshTime,this.refreshShangCountDown,this)},setParam:function(){app.palaceData.shang?this.refreshRewards(app.palaceData.shang.rewards):app.player.sfPalaceRewards({force:0},function(){}),this.refreshCostLabel()},refreshCostLabel:function(){var e=app.palaceData.shang.times||0,t=app.db.getKingTreasureCost(e);this._cost=t[0]?t[0].COUNT:0,app.loadTexture(app.db.getPropsIconPath(t[0]?t[0].GSID:38005),this.p_sprCost,this.prefabPath),this.p_labCost.string=this._cost<=0?"":this._cost,this.p_sprCostTitle.node.x=this._cost<=0?0:16},refreshRewards:function(e){if(e){this.m_arrItems||(this.m_arrItems=[]);for(var t=0;t<e.length;++t){var a=this.m_arrItems[t];a||((a=cc.instantiate(this.p_pfbItem)).parent=this.p_nodeReward,a.setPosition(0,0),a.scale=.8,this.m_arrItems.push(a)),a.active=!0,a.getComponent("propItem").initForBag(e[t]),a.getComponent("propItem").setClick(!0)}for(var i=e.length;i<this.m_arrItems.length;++i)this.m_arrItems[i].active=!1}},refreshShangCountDown:function(){if(app.palaceData){if(!app.palaceData.isKing)return this.p_labCountDown.string="",void eventMgr.off(eventStr.commonEvent.RefreshTime,this.refreshFaCountDown,this);if(app.palaceData.shang)if(app.palaceData.shang.issend){var e=gUtils.getSecondDayTime(app.player.getServerTime())-app.player.getServerTime();this.p_labCountDown.string=langMgr.getString("palaceKingShangPage",3,gUtils.getCountDownStr(e))}else this.p_labCountDown.string="";else this.p_labCountDown.string=""}else this.p_labCountDown.string=""},onFresh:function(){var e=this;if(app.palaceData.shang.issend)app.showNotice(langMgr.getString("palaceKingShangPage",0));else{var t=app.palaceData.shang.times||0,a=app.db.getKingTreasureCost(t),i=a[0]?a[0].COUNT:0,n=a[0]?a[0].GSID:38005;app.player.getCount(n)<i?app.showNotice(langMgr.getString("palaceKingShangPage",1)):app.player.sfPalaceRewards({force:1},function(t){t||(app.showNotice(langMgr.getString("palaceKingShangPage",2)),app.player.sfPlayerByParam(["others","hide","props"],function(){e.refreshCostLabel()}))})}},onSure:function(){app.palaceData&&app.palaceData.shang&&app.palaceData.shang.rewards&&(app.palaceData.shang.issend?app.showNotice(langMgr.getString("palaceKingShangPage",0)):app.player.sfSureRewards(function(e){if(!e){for(var t=[],a=0;a<app.palaceData.shang.rewards.length;++a){var i=app.palaceData.shang.rewards[a];t.push({GSID:i.GSID,COUNT:2*i.COUNT})}var n={showtype:1,reward:t};app.pages.windowspagereward.showPage(n),app.player.sfPlayerByParam(["others","hide","props"],function(){})}}))}});cc._RF.pop()},{basePage:void 0}],palaceNewkingPage:[function(e,t){"use strict";cc._RF.push(t,"fb3b17XkrdKyZWhWkes7wyV","palaceNewkingPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"palacenewkingpage",pageType:1},properties:{p_labName:cc.Label,p_labNameMiddle:cc.Label,p_labLegion:cc.Label,p_propContent:cc.Node,p_pfbPropItem:cc.Prefab,p_btnGet:cc.Button,p_spScroll:sp.Skeleton,p_nodeLab:cc.Node},onLoad:function(){a.instance=this,this.creatMask(!0),this.fitTopMenu(),this.stopBgNodeEvent(),this.handleUI(),this.m_arrItem=[]},handleUI:function(){var e=this;this._super(),this.p_btnGet.node.on("click",function(){e.onGet()})},onEnable:function(){this._super()},setParam:function(){app.palaceData?this.refreshUI():this.onClose()},refreshUI:function(){this.p_labName.string=this.p_labNameMiddle.string=app.palaceData.king.rname;var e=app.palaceData.king.legion||{};e.name?this.p_labLegion.string="\u3010"+e.name+"\u3011":this.p_labLegion.string=langMgr.getString("palaceNewkingPage",2);for(var t=app.db.dbKingdom.CROWN_REWARD,a=0;a<t.length;++a)this.m_arrItem[a]||(this.m_arrItem[a]=cc.instantiate(this.p_pfbPropItem),this.m_arrItem[a].parent=this.p_propContent,this.m_arrItem[a].active=!0),this.m_arrItem[a].getComponent("propItem").initForBag(t[a]),this.m_arrItem[a].getComponent("propItem").setClick(!0);for(var i=t.length;i<this.m_arrItem.length;++i)this.m_arrItem[i].active=!1},onGet:function(){var e=this;app.palaceData?app.player.sfBecomeKingReward(function(t,a){if(t)"already take"==t&&app.showNotice(langMgr.getString("palaceNewkingPage",1));else{var i={showtype:1,reward:a.rewards};app.pages.windowspagereward.showPage(i),app.player.addItem(a.rewards),e.p_btnGet.interactable=!1,e.p_btnGet.node.getChildByName("rednotice").active=!1,app.player.sfPlayerByParam(["others"],function(){eventMgr.emit(eventStr.palaceEvent.Refreshdjdd)})}}):app.showNotice(langMgr.getString("palaceNewkingPage",0))},scrollAnim:function(){this.p_spScroll.node.active=!0,this.p_spScroll.setAnimation(0,"animation",!1)},labAnim:function(){this.p_nodeLab.runAction(cc.fadeIn(.7,255))}});cc._RF.pop()},{basePage:void 0}],palacePage:[function(e,t){"use strict";cc._RF.push(t,"d939fKBKApAuIcNXt7+MzPL","palacePage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"palacepage"},properties:{p_kingTitle:cc.Node,p_expeditionTitle:cc.Node,p_kingNode:cc.Node,p_expeditionNode:cc.Node,p_arrNodeKing:[cc.Node],p_sprGuoHao:cc.Sprite,p_labGuohao:cc.Label,p_nodeWangStart:cc.Node,p_nodeWangTip:[cc.Label],p_btnGotoWangpvp:cc.Button,p_nodeWangRed:cc.Node,p_nodeResPectRed:cc.Node,p_btnRespect:cc.Button,p_btnReward:cc.Button,p_btnPunish:cc.Button,p_btnWangpvp:cc.Button,p_btnHelp:cc.Button,p_labCountDown:cc.Label,p_labShange:cc.Label,p_labFa:cc.Label,p_btnNorth:cc.Button,p_mapNode:cc.Node,p_nodeNorthPass:cc.Node,p_labLevel:cc.Label,p_labNorthTime:cc.Label,p_nodeTipsTime:cc.Node,p_bossNodes:[cc.Node],p_btnDamgeRank:cc.Button,p_btnExpeditionReward:cc.Button,p_btnAuction:cc.Button,p_btnEnemyBuff:cc.Button,p_arrCampNodes:[cc.Node],p_nodeCampTip:cc.Node,p_btnTestGuozhan:cc.Button,p_spOpenScreen:sp.Skeleton},onLoad:function(){a.instance=this,this._super(),this.fitTopMenu(),this.m_menu=this.node.getComponent("menu"),this.m_menu.init(this)},handleUI:function(){var e=this;this._super(),this.p_btnTestGuozhan.node.active="dev"==gSetting.channel,this.p_btnTestGuozhan.node.on("click",function(){app.pages.fivewarmainpage.showPage()}),this.p_sprGuoHao.node.on("touchend",function(){e.openModifyPage()}),this.p_arrNodeKing.forEach(function(e,t){e.on("touchend",function(){app.pages.palacerightinfopage.showPage(t)})}),this.p_btnRespect.node.on("click",function(){e.onRespect()}),this.p_btnReward.node.active=app.palaceData.isKing,this.p_btnReward.node.on("click",function(){app.palaceData.isKing?app.pages.palacekingshangpage.showPage():app.showNotice(langMgr.getString("palacePage",6))}),this.p_btnPunish.node.active=app.palaceData.isKing,this.p_btnPunish.node.on("click",function(){app.palaceData.isKing?app.pages.palacepunishpage.showPage():app.showNotice(langMgr.getString("palacePage",6))}),this.p_btnWangpvp.node.on("click",function(){app.playSound("click"),app.pages.wangpvppage.showPage()}),this.p_btnGotoWangpvp.node.on("click",function(){app.playSound("click"),app.pages.wangpvppage.showPage()}),this.p_btnHelp.node.on("click",function(){app.playSound("click"),0==e.m_index?app.pages.windowspagetipshelp.showPage("1084"):app.pages.windowspagetipshelp.showPage("1105")}),this.p_btnDamgeRank.node.on("click",function(){app.playSound("click"),app.player.sfNorthReportRank(function(e,t){e&&app.showNotice(langMgr.getString("palacePage",17));var a=t.rank,i={rank:{selfrank:t.ownerrank,damge:t.ownerdamge||0,list:a},rtype:"north",title:"\u5317\u4f10\u4f24\u5bb3\u6392\u884c"};app.pages.ranklistpage.showPage(i)})}),this.p_btnExpeditionReward.node.on("click",function(){app.playSound("click"),app.pages.northrewardpage.showPage()}),this.p_btnAuction.node.on("click",function(){app.playSound("click"),a.isAuction()?e.showAuctionPage():app.showNotice("\u5317\u4f10\u62cd\u5356\u5df2\u7ed3\u675f")}),this.p_btnEnemyBuff.node.on("click",function(){app.playSound("click"),app.pages.windowspagenorthbuff.showPage()}),localDataUtils.GetValue("palacefirsttime",null)||localDataUtils.SetValue("palacefirsttime",1)},onEnable:function(){this._super(),eventMgr.on(eventStr.redEvent.RefreshPalacePageRed,this.refreshRed,this),eventMgr.on(eventStr.palaceEvent.RefreshInfo,this.refreshUI,this),eventMgr.on(eventStr.palaceEvent.RefreshKname,this.refreshKname,this),eventMgr.on(eventStr.palaceEvent.RefreshKicon,this.refreshKicon,this),eventMgr.on(eventStr.palaceEvent.RefreshNorthInfo,this.refreshNorth,this),eventMgr.on(eventStr.commonEvent.RefreshTime,this.refreshCountDown,this),eventMgr.on(eventStr.commonEvent.RefreshTime,this.refreshShangCountDown,this),eventMgr.on(eventStr.commonEvent.RefreshTime,this.refreshFaCountDown,this),eventMgr.on(eventStr.commonEvent.RefreshTime,this.refreshNorthCountDown,this),eventMgr.on(eventStr.commonEvent.RefreshTime,this.refreshAuctionBtn,this),eventMgr.on(eventStr.redEvent.RefreshNorthTime,this.showAuctionPage,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.redEvent.RefreshPalacePageRed,this.refreshRed,this),eventMgr.off(eventStr.palaceEvent.RefreshInfo,this.refreshUI,this),eventMgr.off(eventStr.palaceEvent.RefreshKname,this.refreshKname,this),eventMgr.off(eventStr.palaceEvent.RefreshKicon,this.refreshKicon,this),eventMgr.off(eventStr.palaceEvent.RefreshNorthInfo,this.refreshNorth,this),eventMgr.off(eventStr.commonEvent.RefreshTime,this.refreshCountDown,this),eventMgr.off(eventStr.commonEvent.RefreshTime,this.refreshShangCountDown,this),eventMgr.off(eventStr.commonEvent.RefreshTime,this.refreshFaCountDown,this),eventMgr.off(eventStr.commonEvent.RefreshTime,this.refreshNorthCountDown,this),eventMgr.off(eventStr.commonEvent.RefreshTime,this.refreshAuctionBtn,this),eventMgr.off(eventStr.redEvent.RefreshNorthTime,this.showAuctionPage,this)},setParam:function(){app.palaceData?this.refreshUI():app.player.sfPalaceInfo(),this.p_btnNorth.node.active=app.pages.palacepage.isNorthOpen(),this.m_menu.setMenuIndex(0),this.m_levelNum=0,app.runUnlockGuide("PALACE")},refreshMenuRed:function(e){var t=!1;return 1==e&&(t=a.isNorthOpen()&&!app.isOpenNorthPage),t},refreshRed:function(){this.p_nodeWangRed.active=app.pages.wangpvppage.refreshRed(),this.p_nodeResPectRed.active=app.pages.palacepage.checkCanRespect()},menuHandler:function(e){var t=this;if(1==e){if(!a.isNorthOpen())return void app.showNotice("\u5317\u4f10\u5308\u5974\u4e8e\u6bcf\u5468\u516d8\u70b9\u5f00\u542f");app.isOpenNorthPage=!0,this.initNorthUI(),app.player.sfNorthInfo(function(e){e?t.refreshNorth():t.m_levelNum=app.northInfo.curlevel+1})}this.m_menu.refreshRed(),this.m_index=e,this.p_kingTitle.active=this.p_kingNode.active=0==e,this.p_expeditionTitle.active=this.p_expeditionNode.active=1==e,this.p_spOpenScreen.active=1==e,1==e&&this.p_spOpenScreen.setAnimation(0,"animation",!1)},refreshUI:function(){if(!app.palaceData||app.palaceData.wait){this.p_btnRespect.node.active=!1,this.p_labGuohao.string=langMgr.getString("palacePage",3),this.p_labCountDown.string=langMgr.getString("palacePage",4),this.p_arrNodeKing.forEach(function(e){e.getComponent("publicHeadItem").setRankNull()}),this.p_nodeWangStart.active=!0;var e=app.pages.wangpvppage.getSummitPvpState();if(this.p_nodeWangTip.forEach(function(e){e.node.active=!1}),1!=app.wangPvpInfo.type)this.p_nodeWangTip[0].node.active=!0,2==e.type&&3==e.turn?this.p_nodeWangTip[0].string=langMgr.getString("palacePage",16):this.p_nodeWangTip[0].string=gConfig.getSummitpvpTurnNameByType(e.type+1,e.turn)+langMgr.getString("palacePage",12);else{var t=!1;app.pages.wangpvppage.checkWangPvpCanSetBattle().isCanSet?(t=!0,this.p_nodeWangTip[2].node.active=!0):this.p_nodeWangTip[1].node.active=!0,2==e.type&&3==e.turn?this.p_nodeWangTip[2].string=langMgr.getString("palacePage",15):t?this.p_nodeWangTip[2].string=langMgr.getString("palacePage",14)+gConfig.getSummitpvpTurnNameByType(e.type+1,e.turn):this.p_nodeWangTip[1].string=langMgr.getString("palacePage",13)}}else this.p_nodeWangStart.active=!1,this.refreshKname(),this.refreshKicon(),this.refreshRank(),this.refreshBtnRespect(),this.refreshCountDown(),this.refreshShangCountDown(),this.refreshFaCountDown(),app.palaceData.isKing?app.player.sfPalaceRewards({force:0},function(){}):app.player.getCount(90521)<=0&&app.pages.palacenewkingpage.showPage();this.refreshRed()},refreshRank:function(){var e=this;app.palaceData&&this.p_arrNodeKing.forEach(function(t,a){t.getComponent("publicHeadItem").refreshUI(app.palaceData.standings[a],e)})},refreshBtnRespect:function(){this.p_btnRespect.node.active=!app.palaceData.isKing,this.p_btnRespect.interactable=app.player.getCount(90523)<=0},refreshKname:function(){this.p_labGuohao.string=langMgr.getString("palacePage",5,app.palaceData.name)},refreshKicon:function(){var e=app.db.getCountryFlagByIndex(app.palaceData.icon);app.loadTexture(e,this.p_sprGuoHao,this.prefabPath)},onRespect:function(){var e=this;app.palaceData&&(app.palaceData.isKing||app.player.sfRespectKing(function(t,a){if(t)"no data"==t?app.showNotice(langMgr.getString("palacePage",8)):app.showNotice(langMgr.getString("palacePage",9));else{var i={showtype:1,reward:a.rewards};app.pages.windowspagereward.showPage(i),app.player.addItem({GSID:90523,COUNT:1}),app.player.addItem(a.rewards),e.refreshBtnRespect(),e.refreshRed()}}))},onGuohao:function(){app.palaceData.isKing||app.showNotice(langMgr.getString("palacePage",7))},openModifyPage:function(){app.palaceData?app.palaceData.isKing&&app.pages.palaceiconpage.showPage():app.showNotice(langMgr.getString("palacePage",10))},refreshCountDown:function(){if(app.palaceData&&!app.palaceData.wait){var e=app.palaceData.endtime-app.player.getServerTime();if(e<0)return this.p_labCountDown.string="\u7b49\u5019\u65b0\u7687\u767b\u57fa",app.palaceData=null,void eventMgr.emit(eventStr.palaceEvent.RefreshInfo);this.p_labCountDown.string=gUtils.getCountDownStr(e)}},refreshShangCountDown:function(){if(app.palaceData&&!app.palaceData.wait){if(!app.palaceData.isKing)return this.p_labShange.string="",void eventMgr.off(eventStr.commonEvent.RefreshTime,this.refreshFaCountDown,this);if(app.palaceData.shang)if(app.palaceData.shang.issend){var e=gUtils.getSecondDayTime(app.player.getServerTime())-app.player.getServerTime();this.p_labShange.string=gUtils.getCountDownStr(e)}else this.p_labShange.string="";else this.p_labShange.string=""}else this.p_labShange.string=""},refreshFaCountDown:function(){if(app.palaceData&&!app.palaceData.wait){if(!app.palaceData.isKing)return this.p_labFa.string="",void eventMgr.off(eventStr.commonEvent.RefreshTime,this.refreshFaCountDown,this);if(app.palaceData.youjie){var e=app.palaceData.youjie.endtime-app.player.getServerTime();this.p_labFa.string=gUtils.getCountDownStr(e)}else this.p_labFa.string=""}else this.p_labFa.string=""},initNorthUI:function(){this.p_arrCampNodes.forEach(function(e){e.active=!1}),this.p_bossNodes.forEach(function(e){e.active=!1}),this.p_nodeCampTip.active=!1,this.p_labLevel.string="",this.p_nodeNorthPass.active=!1,this.p_labNorthTime.string="00:00:00",app.lockFunConfig.getEndTimeByKey("EXPEDITION_HUN")<=0&&(this.p_labNorthTime.string="\u5df2\u7ed3\u675f",this.p_nodeTipsTime.active=!1)},afterBattleFresh:function(){1==this.m_index&&this.CheckOverLevel()},CheckOverLevel:function(){app.northInfo.curlevel+1>this.m_levelNum&&(this.p_spOpenScreen.setAnimation(0,"animation",!1),this.m_levelNum=app.northInfo.curlevel+1)},refreshNorth:function(){app.northInfo&&(this.p_labLevel.string=langMgr.getString("palacePage",21,app.northInfo.curlevel+1),this.p_nodeNorthPass.active=!!app.northInfo.ispass,app.northInfo.ispass||(this.refreshMap(),this.refreshBottomCamp())),a.isAuction()&&this.showAuctionPage()},refreshBottomCamp:function(){var e=this,t=app.lockFunConfig.checkOpenByKey("EXPEDITION_HUN");this.p_arrCampNodes.forEach(function(a,i){a.active=!0;var n=i+1;a.getComponent("northCampItem").refreshUI(n,e),a.active=t}),this.p_nodeCampTip.active=app.northInfo.battlearr.size<3&&t},refreshMap:function(){var e=this;this.p_bossNodes.forEach(function(t,a){app.northInfo.bosses[a]?(t.active=!0,t.getComponent("northBossItem").refreshUI(a,e),t.getComponent("northBossItem").setClick(!0)):t.active=!1})},refreshNorthCountDown:function(){if(this.p_expeditionNode.active){var e=app.lockFunConfig.getEndTimeByKey("EXPEDITION_HUN");e>0?(this.p_labNorthTime.string=gUtils.getCountDownStr(e),this._state=!0):this._state&&(this._state=!1,this.p_labNorthTime.string="\u5df2\u7ed3\u675f",this.p_nodeTipsTime.active=!1,eventMgr.off(eventStr.commonEvent.RefreshTime,this.refreshNorthCountDown,this),app.player.sfNorthInfo())}},refreshAuctionBtn:function(){this.p_expeditionNode.active},showAuctionPage:function(){var e=this;app.player.sfNorthKillReward(function(t,a){t||a.auctions.length<=0?app.showNotice("\u62cd\u5356\u5df2\u7ed3\u675f"):(e.isCanClick=!0,a&&a.auctions.map(function(e){return e.item}),app.pages.windowsPageWarRewardList.showPage({auctionList:a.auctions,type:1,otherInfo:{rname:app.palaceData.king.rname,chapter:(app.northInfo&&app.northInfo.curlevel||-1)+1,rewardnum:a.auctions.length}}))})},onClose:function(){this._super(),app.northInfo=null}});a.showPage=function(){var t=this;if(1!=app.db.getChannelControlInfo().PALACE&&app.db.checkFuncUnLock("PALACE",!0))if(app.wangPvpInfo&&app.wangPvpInfo.groupdata&&app.wangPvpInfo.groupdata.length>0)e("basePage").showPage.call(this);else{var a=app.wangPvpInfo.time-app.player.getServerTime();if(a<0)app.pages.wangpvppage.dealData(function(){e("basePage").showPage.call(t)},!0,!0);else{var i=langMgr.getString("palacePage",11,gUtils.getCountDownStr(a));app.showNotice(i)}}},a.checkCanRespect=function(){return!(!app.palaceData||app.palaceData.wait||app.palaceData.isKing||!(app.player.getCount(90523)<=0))},a.refreshRed=function(e){var t=!1;return app.db.checkFuncUnLock("PALACE")&&((t=a.checkCanRespect())||(t=app.pages.wangpvppage.refreshRed()),t||(t=!!app.lockFunConfig&&a.isNorthOpen()&&!app.isOpenNorthPage)),e&&(e.active=t),t},a.isNorthOpen=function(){var e=!1;if(e||(e=app.db.checkFuncUnLock("EXPEDITION_HUN")&&app.db.checkChannelShow("EXPEDITION_HUN")),e&&(e=app.lockFunConfig.EXPEDITION_HUN.start<=app.player.getServerTime()),e){if(!app.getRedInfoByObj(["aution","north_time"],!1))return!1;e=app.getRedInfoByObj(["aution","north_time","etime"],0)>0||app.lockFunConfig.EXPEDITION_HUN.etime>=app.player.getServerTime()}return e},a.isAuction=function(){if(!app.getRedInfoByObj(["aution","north_time"],!1))return!0;if(!app.lockFunConfig.EXPEDITION_HUN)return!0;var e=app.lockFunConfig.EXPEDITION_HUN.etime,t=app.getRedInfoByObj(["aution","north_time","etime"],0),a=!1;return app.player.getServerTime()>=e&&t>0&&(a=!0),a},a.isAucOver=function(){if(!app.getRedInfoByObj(["aution","north_time"],!1))return!0;var e=!1;return app.getRedInfoByObj(["aution","north_time","etime"],0)>0&&(e=!0),e},cc._RF.pop()},{basePage:void 0}],palacePunishPage:[function(e,t){"use strict";cc._RF.push(t,"bd546oG4K5GeaZWpcOaHvuf","palacePunishPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"palacepunishpage",pageType:1},properties:{p_nodePlayer:cc.Node,p_labCountDown:cc.Label,p_nodeHead:cc.Node,p_btnConfirm:cc.Button},onLoad:function(){a.instance=this,this.creatMask(!0),this.fitTopMenu(),this.stopBgNodeEvent(),this.handleUI()},onEnable:function(){this._super(),eventMgr.on(eventStr.palaceEvent.RefreshYoujie,this.showPunishPeople,this),eventMgr.on(eventStr.commonEvent.RefreshTime,this.refreshTime,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.palaceEvent.RefreshYoujie,this.showPunishPeople,this),eventMgr.off(eventStr.commonEvent.RefreshTime,this.refreshTime,this)},handleUI:function(){var e=this;this._super(),this.node.getComponent("modPlayerInfo").p_nodeHead.on("touchend",function(){app.palaceData&&(app.palaceData.isNowPeopleYoujie()?app.showNotice(langMgr.getString("palacePunishPage",0)):app.pages.palacesearchplayerpage.showPage())}),this.p_nodeHead.on("touchend",function(){app.pages.palacesearchplayerpage.showPage()}),this.p_btnConfirm.node.on("click",function(){e.onConfirm()})},setParam:function(){app.palaceData&&app.palaceData.isNowPeopleYoujie()?eventMgr.emit(eventStr.palaceEvent.RefreshYoujie,app.palaceData.youjie.player):(this.p_btnConfirm.interactable=!0,this.setNull())},showPunishPeople:function(e){this.p_btnConfirm.interactable=!app.palaceData.isNowPeopleYoujie(),e?(this._player=e,this.node.getComponent("modPlayerInfo").init(e,this)):this.setNull()},setNull:function(){this._player=null,this.node.getComponent("modPlayerInfo").setNull(),this.p_labCountDown.string=langMgr.getString("palacePunishPage",3)},refreshTime:function(){if(app.palaceData&&app.palaceData.isNowPeopleYoujie()){if(app.palaceData.youjie.endtime<app.player.getServerTime())return app.palaceData.isNowPeopleYoujie(),void this.setNull();var e=app.palaceData.youjie.endtime-app.player.getServerTime();this.p_labCountDown.string=langMgr.getString("palacePunishPage",4,gUtils.getCountDownStr(e))}},onConfirm:function(){this._player?app.palaceData&&app.palaceData.isNowPeopleYoujie()?app.showNotice(langMgr.getString("palacePunishPage",2)):app.pages.palaceyoujieconfirmpage.showPage({obj:this._player}):app.showNotice(langMgr.getString("palacePunishPage",1))}});cc._RF.pop()},{basePage:void 0}],palaceRightInfoPage:[function(e,t){"use strict";cc._RF.push(t,"16e9f+Rs1NEypC4Q8Zncf1N","palaceRightInfoPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"palacerightinfopage",pageType:1},properties:{p_labTitle:cc.Sprite,p_arrTequan:[cc.Label],p_nodeContent:cc.Node,p_pfbItem:cc.Prefab,p_pfbPower:cc.Prefab,p_nodePowerParent:cc.Node,p_sprFmeTitle:[cc.SpriteFrame]},onLoad:function(){a.instance=this,this.creatMask(!0),this.fitTopMenu(),this.stopBgNodeEvent(),this.handleUI()},setParam:function(e){this.node.getComponent("modPlayerInfo").init(e.data,this);for(var t=app.db.getPosInfoByPos(e.pos),a=t.INTRO.split(";"),i=0;i<a.length&&i<this.p_arrTequan.length;++i)this.p_arrTequan[i].node.active=!0,this.p_arrTequan[i].string=a[i];for(var n=a.length;n<this.p_arrTequan.length;++n)this.p_arrTequan[n].node.active=!1;this.m_arrItems||(this.m_arrItems=[]);for(var r=0;r<t.TAX.length;++r){var o=this.m_arrItems[r];o||((o=cc.instantiate(this.p_pfbItem)).parent=this.p_nodeContent,o.scale=.8),o.active=!0,o.getComponent("propItem").initForBag(t.TAX[r]),o.getComponent("propItem").setClick(!0)}for(var s=t.TAX.length;s<this.m_arrItems.length;++s)this.m_arrItems[s].active=!1;cc.isValid(this.m_power)||(this.m_power=cc.instantiate(this.p_pfbPower),this.m_power.parent=this.p_nodePowerParent,this.m_power.position=cc.Vec2.ZERO),this.m_power.getComponent("PowerDisplay").init({val:e.data.power})}});a.showPage=function(t,a,i){var n=this;if(app.palaceData&&app.palaceData.standings&&app.palaceData.standings[t]){var r=app.palaceData.standings[t];r&&app.player.sfGetRolesInfo({rids:[r.rid+"|"+r.servid]},function(r){e("basePage").showPage.call(n,{pos:t,data:r[0]},a,i)})}},cc._RF.pop()},{basePage:void 0}],palaceSearchPlayerPage:[function(e,t){"use strict";cc._RF.push(t,"c8fc1XCUm5HoYEZUI1SsBCZ","palaceSearchPlayerPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"palacesearchplayerpage",pageType:1},properties:{p_btnSearch:cc.Button,p_nodePlayer:cc.Node,p_editName:cc.EditBox,p_nodeSure:cc.Node,p_nodeChange:cc.Node,p_btnSure:cc.Button},onLoad:function(){a.instance=this,this.creatMask(!0),this.fitTopMenu(),this.stopBgNodeEvent(),this.handleUI()},handleUI:function(){var e=this;this._super(),this.p_btnSearch.node.on("click",function(){e.onSearch()}),this.p_btnSure.node.on("click",function(){e.onSure()})},setParam:function(){this.p_nodePlayer.active=!1},onSearch:function(){var e=this,t=this.p_editName.string;this.p_nodePlayer.active=!1,app.player.rname!=t?this.p_editName.string.length<=0?app.showNotice(langMgr.getString("friendAddFriendPage",3)):app.player.sfGetSearch(t,function(t,a){if(t||a.length<=0)app.showNotice(langMgr.getString("palaceSearchPlayerPage",1));else{e.p_nodePlayer.active=!0,e._player=a[0],e.p_nodePlayer.getComponent("modPlayerInfo").init(a[0],e);var i=app.palaceData.isNowPeopleYoujie();e.p_nodeSure.active=!i,e.p_nodeChange.active=i}}):app.showNotice(langMgr.getString("palaceSearchPlayerPage",0))},onSure:function(){var e=this._player;eventMgr.emit(eventStr.palaceEvent.RefreshYoujie,e),this.onClose()}});cc._RF.pop()},{basePage:void 0}],palaceYoujieConfirmPage:[function(e,t){"use strict";cc._RF.push(t,"d8cd71ZO8BE+4sZ0oyohSPz","palaceYoujieConfirmPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"palaceyoujieconfirmpage",pageType:1},properties:{p_btnSure:cc.Button,p_nodePlayer:cc.Node,p_nodeTips:cc.Node},onLoad:function(){a.instance=this,this.creatMask(!0),this.fitTopMenu(),this.stopBgNodeEvent(),this.handleUI()},handleUI:function(){var e=this;this._super(),this.p_btnSure.node.on("click",function(){e.onSure()})},setParam:function(e){this._player=e.obj,this.p_nodePlayer.getComponent("modPlayerInfo").init(this._player,this),this.p_nodeTips.active=app.checkIsFriend(this._player.id)},onSure:function(){var e=this;app.player.sfConfirmYoujie({rid:this._player.id},function(t){t?app.showNotice(langMgr.getString("palaceYoujieConfirmPage",0)):(app.player.sfPalaceInfo(),e.onClose())})}});cc._RF.pop()},{basePage:void 0}],palaceYoujiePage:[function(e,t){"use strict";cc._RF.push(t,"db610kSEL9LuZzBpJcC2Jx7","palaceYoujiePage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"palaceyoujiepage",pageType:1},properties:{p_labNameTip:cc.Label,p_labName:cc.Label,p_labLegion:cc.Label,p_labCountDown:cc.Label,p_btnTips:cc.Button,p_arrBtnSneer:[cc.Button],p_labCount:cc.Label,p_spCramer:sp.Skeleton},onLoad:function(){a.instance=this,this.creatMask(!0),this.fitTopMenu(),this.stopBgNodeEvent(),this.handleUI()},onEnable:function(){this._super(),eventMgr.on(eventStr.commonEvent.RefreshTime,this.refreshFaCountDown,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.commonEvent.RefreshTime,this.refreshFaCountDown,this)},handleUI:function(){var e=this;this._super(),this.p_btnTips.node.on("click",function(){app.pages.palaceyoujiestatisticpage.showPage()}),this.p_arrBtnSneer.forEach(function(t,a){t.node.on("click",function(){e.doSneer(a)})}),this.p_spCramer.setCompleteListener(function(){e._bAnim=!1,e.p_spCramer.node.active=!1})},setParam:function(){this.refreshUI()},refreshUI:function(){if(app.palaceData&&app.palaceData.isNowPeopleYoujie()){this.p_labName.string=this.p_labNameTip.string=app.palaceData.youjie.player.rname;var e=app.palaceData.youjie.player.legion||{};e.name?this.p_labLegion.string="\u3010"+e.name+"\u3011":this.p_labLegion.string=langMgr.getString("palaceYoujiePage",3),this.refreshFaCountDown(),this.refreshCount()}else this.onClose()},refreshCount:function(){this.p_labCount.string=Math.max(0,3-app.player.getCount(90525))},refreshFaCountDown:function(){if(app.palaceData)if(app.palaceData.youjie){var e=app.palaceData.youjie.endtime-app.player.getServerTime();this.p_labCountDown.string=langMgr.getString("palaceYoujiePage",4,gUtils.getCountDownStr(e))}else this.p_labCountDown.string="";else this.p_labCountDown.string=""},doSneer:function(e){var t=this;app.palaceData.isYoujie?app.showNotice(langMgr.getString("palaceYoujiePage",0)):app.palaceData&&app.palaceData.isNowPeopleYoujie()?app.player.getCount(90525)>=3?app.showNotice(langMgr.getString("palaceYoujiePage",2)):this._bAnim||(this.freeSneer(e),app.player.sfBadYoujie({type:e,_id:app.palaceData.youjie._id},function(e,a){if(e)app.showNotice(e);else{var i={showtype:1,reward:a.rewards};app.player.addItem(a.rewards),t.scheduleOnce(function(){app.pages.windowspagereward.showPage(i)},.5),app.player.sfPlayerByParam(["others"],function(){t.refreshCount()})}})):app.showNotice(langMgr.getString("palaceYoujiePage",1))},freeSneer:function(){this._bAnim=!0,this.p_spCramer.node.active=!0,this.p_spCramer.setAnimation(0,"animation",!1)},resetIndex:function(){this._lastIndex=null},onClose:function(){this._bAnim||this._super()}});cc._RF.pop()},{basePage:void 0}],palaceYoujieStatisticPage:[function(e,t){"use strict";cc._RF.push(t,"3ab87vJfLRLOYGl7bP7ZBnv","palaceYoujieStatisticPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"palaceyoujiestatisticpage",pageType:1},properties:{p_labName:cc.Label,p_labHour:cc.Label,p_arrLabSneer:[cc.Label]},onLoad:function(){a.instance=this,this.creatMask(!0),this.fitTopMenu(),this.stopBgNodeEvent(),this.handleUI()},setParam:function(){this.refreshUI()},refreshUI:function(){this.p_labName.string=app.palaceData.youjie.player.rname;var e=app.palaceData.youjie.endtime-app.player.getServerTime(),t=Math.floor(e/36e5);this.p_labHour.string=langMgr.getString("palaceYoujieStatisticPage",0,24-t),this.p_arrLabSneer.forEach(function(e,t){e.string=app.palaceData.youjie.actions[t]||0})}});cc._RF.pop()},{basePage:void 0}],playVideoPage:[function(e,t){"use strict";cc._RF.push(t,"67aa5dVYmRNjbr3lsILhR+2","playVideoPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"playvideopage",pageType:1},properties:{p_nodeVedio:cc.VideoPlayer,p_nodeCircle:cc.Node},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.p_nodeCircle.runAction(cc.repeatForever(cc.rotateBy(1,360)))},handleUI:function(){this._super()},setParam:function(e){this.p_nodeVedio.remoteURL=e,this.p_nodeVedio.play()},onDestroy:function(){this.p_nodeVedio.stop(),this._super()}});cc._RF.pop()},{basePage:void 0}],playerOtherInfoMorePage:[function(e,t){"use strict";cc._RF.push(t,"8b8a8cxi0dFnIfTKskPBrNZ","playerOtherInfoMorePage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"playerotherinfomoregage",pageType:1},properties:{p_btnTransfer:cc.Button,p_btnRenming:cc.Button,p_useSprNode:[cc.Node],p_btnOut:cc.Button,p_btnAddBlack:cc.Button},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){var e=this;this._super(),this.p_btnTransfer.node.on("click",function(){e.m_target&&(e.m_target.appointPos(2),e.onClose())}),this.p_btnRenming.node.on("click",function(){if(e.m_target){for(var t=0;t<e.p_useSprNode.length;t++)e.p_useSprNode[t].active&&e.m_target.appointPos(e.p_useSprNode.length-1-t);e.onClose()}}),this.p_btnOut.node.on("click",function(){e.m_target&&(e.m_target.dismissPlayer(),e.onClose())}),this.p_btnAddBlack.node.on("click",function(){app.showNotice(langMgr.getString("playerOtherInfoMorePage",0))})},setParam:function(e){this.m_obj=e,console.log(e),this.m_target=e.target,this.refreshBtn()},refreshBtn:function(){var e=this.m_obj.pos,t=this.m_obj.myPos;if(t)if(2==t){this.p_btnOut.node.active=!0,this.p_btnTransfer.node.active=!0,this.p_btnRenming.node.active=!0;for(var a=0;a<this.p_useSprNode.length;a++)this.p_useSprNode[a].active=e==a}else this.p_btnTransfer.node.active=!1,this.p_btnRenming.node.active=!1,this.p_btnOut.node.active=!1;else this.p_btnTransfer.node.active=!1,this.p_btnRenming.node.active=!1,this.p_btnOut.node.active=!1}});cc._RF.pop()},{basePage:void 0}],playerOtherInfoPage:[function(e,t){"use strict";cc._RF.push(t,"c01c68OT8VC+rlGWyHC+e7a","playerOtherInfoPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"playerotherinfopage",pageType:1},properties:{p_nodeHead:cc.Node,p_labName:cc.Label,p_nodePower:cc.Node,p_labID:cc.Label,p_btnAdd:cc.Button,p_labLegion:cc.Label,p_btnMore:cc.Button,p_btnBlacklist:cc.Button,p_btnTalk:cc.Button,p_nodeContent:cc.Node,p_pfbItem:cc.Prefab,p_btnDelete:cc.Button,p_labLevel:cc.Label,p_nodeSexF:cc.Node,p_nodeSexM:cc.Node,p_labVip:cc.Label,p_pfbPower:cc.Prefab,p_pfbPlayer:cc.Prefab},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.m_arrItems=[],this.m_nodePower=cc.instantiate(this.p_pfbPower),this.m_nodePower.parent=this.p_nodePower,this.m_nodePower.x=0,this.m_nodePower.y=0,this.m_player=cc.instantiate(this.p_pfbPlayer),this.m_player.parent=this.p_nodeHead},handleUI:function(){var e=this;this._super();var t=this;this.p_btnAdd.node.on("click",function(){if(app.checkMaxFriend())app.showNotice(langMgr.getString("playerOtherInfoPage",1));else{var e=[];e.push(t._obj.rid),app.player.sfApply(e,function(e){e||(app.showNotice(langMgr.getString("playerOtherInfoPage",2)),t.p_btnAdd.node.active=!1)})}}),this.p_btnMore.node.on("click",function(){var t={pos:e.m_obj.pos,myPos:e.m_obj.myPos,target:e.m_obj.target};app.pages.playerotherinfomoregage.showPage(t),e.onClose()}),this.p_btnBlacklist.node.active=!1,this.p_btnBlacklist.node.on("click",function(){}),this.p_btnTalk.node.on("click",function(){var e={type:1,id:t._obj.rid,rname:t._obj.rname};app.pages.mailreplypage.showPage(e)}),this.p_btnDelete.node.on("click",function(){switch(e.m_type){case"manor":return void app.showNotice(langMgr.getString("playerOtherInfoPage",3))}app.player.sfDeleteFriend(t._obj.rid,function(a){if(a);else{app.showNotice(langMgr.getString("playerOtherInfoPage",4));var i=app.getFriendNum(t._obj.rid);i>=0&&app.arrFriend.splice(i,1),app.pages.friendpage.instance&&app.pages.friendpage.instance.refreshFriendList(),e.onClose()}})})},setParam:function(e){var t=this;if(this.m_obj=e,(e.rid||e.rname)&&e.rid!=app.player.id&&e.rname!=app.player.rname){var a={};e.rid&&(a.rids=[e.rid]),e.rname&&(a.rnames=[e.rname]),e.battleset&&(a.battleset=e.battleset),this.m_type=e.type,this.m_battlest=e.battleset,app.player.sfGetRolesInfo(a,function(e){cc.isValid(t)&&(t._obj=e[0],t.refreshUI())})}else this.onClose()},refreshUI:function(){var e=this._obj,t=Boolean(e.set&&e.set.vipHide),a={iconid:e.iconid,headid:e.headid,frameid:e.frameid,numLevel:e.level,target:this};t||(a.vip=e.vip),this.m_player&&this.m_player.getComponent("headItem").init(a),this.p_labName.string=this._obj.rname,this.m_nodePower&&this.m_nodePower.getComponent("PowerDisplay").init(this._obj.power),this.p_labLevel.string=this._obj.level,this._obj.legion=this._obj.legion||{},this._obj.legion.name?this.p_labLegion.string=this._obj.legion.name:this.p_labLegion.string=langMgr.getString("playerOtherInfoPage",0),this.p_labID.string=this._obj.rno,this.p_nodeHead&&this.p_nodeHead.getComponent("headItem").init({iconid:this._obj.iconid,headid:this._obj.headid,frameid:this._obj.frameid,target:this});var i=0;if(this._obj.battleset&&this._obj.battleset.team)for(var n in this._obj.battleset.team){var r=this._obj.battleset.team[n],o=this.m_arrItems[i];o||((o=cc.instantiate(this.p_pfbItem)).scale=.9,o.parent=this.p_nodeContent,this.m_arrItems.push(o)),o.active=!0;var s=app.db.getGBaseByGsid(r.gsid);o.getComponent("generalPortraitItem").initReport(s,r),i++,r.power}else if(this._obj.bestgeneral&&this._obj.bestgeneral.length>0)for(var p=0;p<this._obj.bestgeneral.length;++p){var c=this._obj.bestgeneral[p],h=this.m_arrItems[i];h||((h=cc.instantiate(this.p_pfbItem)).scale=.9,h.parent=this.p_nodeContent,this.m_arrItems.push(h)),h.active=!0;var l=app.db.getGBaseByGsid(c.gsid);h.getComponent("generalPortraitItem").initReport(l,c),i++,c.power}for(var g=i;g<this.m_arrItems.length;++g)this.m_arrItems[g].active=!1;if("summitpvp"==this.m_type||"generalRankPreview"==this.m_type||"cross"==this.m_type||"wstzboss"==this.m_type||"nation_war"===this.m_type)return this.p_btnAdd.node.active=!1,this.p_btnMore.node.active=!1,this.p_btnBlacklist.node.active=!1,this.p_btnTalk.node.active=!1,void(this.p_btnDelete.node.active=!1);var d=app.checkIsFriend(this._obj.rid),u=!1;app.player.legion&&this._obj.legion.id==app.player.legion&&(u=!0),this.p_btnTalk.node.active=d||u,this.p_btnAdd.node.active=!d,this.p_btnDelete.node.active=d,this._obj.rid==app.player.id&&(this.p_btnAdd.node.active=!1,this.p_btnDelete.node.active=!1),this.refreshBtn()},refreshBtn:function(){var e=this.m_obj;this.target=e.target;var t=app.checkIsFriend(e.rid);this.p_btnAdd.node.active=!t,this.p_btnDelete.node.active=t}});cc._RF.pop()},{basePage:void 0}],playerinfoDecoratePageHead:[function(e,t){"use strict";cc._RF.push(t,"3c212n+VfNEXYyCE4vqIkRh","playerinfoDecoratePageHead"),cc.Class({extends:cc.Component,properties:{p_nodeHead:cc.Node,p_tabvHeadicon:cc.Node,p_btnChange:cc.Button,p_btnCancel:cc.Button},onLoad:function(){this.handleUI(),this.m_arrChooseIndex=[]},handleUI:function(){var e=this;this.p_btnChange.node.on("click",function(){app.playSound("click"),e.onClickBtnChange()}),this.p_btnCancel.node.on("click",function(){app.playSound("click"),e.onClickBtnCancel()})},getNewData:function(e){this.m_numHeadId=app.player.headid,this.m_target=e,this.refreshUI()},refreshUI:function(){this.m_arrShowData=this.setData(),cc.log(this.m_arrShowData),this.refreshView()},refreshView:function(){var e=this.m_arrShowData.length;this.p_tabvHeadicon.getComponent("tableView").initTableView(e,{array:this.m_arrShowData,maxpick:1,target:this});var t=this.m_arrShowData[0];this.p_nodeHead&&this.p_nodeHead.getComponent("headItem").init({iconid:t.ICONID,headid:t.HEADID,frameid:t.FRAMEID,target:this.m_target})},itemClick:function(e,t){return e==this.m_strNowPickGsid?(this.m_chooseItem=t,!0):(this.m_chooseItem&&(cc.log("handle choose item"),this.m_chooseItem.selected(!1,this.m_strNowPickGsid)),this.m_chooseItem=t,this.m_strNowPickGsid=e,!0)},setData:function(){var e=app.db.dbHeadIcon,t=[],a=[];for(var i in e)e[i].VISIBLE&&(e[i].ETIME=app.player._heads[i],this.m_numHeadId==i?t.unshift(e[i]):null!=e[i].ETIME?t.push(e[i]):a.push(e[i]));return t.concat(a)},onClickBtnChange:function(){var e=this;void 0!==this.m_strNowPickGsid&&this.m_strNowPickGsid!=this.m_numHeadId?null!=app.player._heads[this.m_strNowPickGsid]?-1!=app.player._heads[this.m_strNowPickGsid]&&app.player._heads[this.m_strNowPickGsid]<=app.player.getServerTime()?app.showNotice(langMgr.getString("playerinfoDecoratePageHead",2)):app.player.sfChangeHeadId(this.m_strNowPickGsid,function(t){t?"expireTime is not defined"==t&&app.showNotice(langMgr.getString("playerinfoDecoratePageHead",1)):app.player.sfPlayerByParam(["headid","iconid"],function(){app.pages.playerinfopage.instance.refreshUI(),cc.isValid(e)&&(e.m_arrChooseIndex.length=0,e.getNewData()),app.showNotice(langMgr.getString("playerinfoDecoratePageHead",3))})}):app.showNotice(langMgr.getString("playerinfoDecoratePageHead",1)):app.showNotice(langMgr.getString("playerinfoDecoratePageHead",0))},onClickBtnCancel:function(){app.pages.playerinfodecoratepage.instance.onClose()}}),cc._RF.pop()},{}],playerinfoDecoratePageImage:[function(e,t){"use strict";cc._RF.push(t,"98483QtIhJL969mXfFwrRIe","playerinfoDecoratePageImage"),cc.Class({extends:cc.Component,properties:{p_tabView:cc.tableView,p_btnReplace:cc.Button,p_btnCancel:cc.Button,p_labJiesuo:cc.Label,p_sprGeneral:cc.Sprite,p_spGeneral:sp.Skeleton,p_animGeneral:cc.Animation},onLoad:function(){this.handleUI(),this.m_menu=this.getComponent("menu"),this.m_menu.init(this),this.m_arrChooseIndex=[]},handleUI:function(){var e=this;this.p_btnReplace.node.on("click",function(){app.playSound("click"),e.onClickBtnChange()}),this.p_btnCancel.node.on("click",function(){app.playSound("click"),e.onClickBtnCancel()})},getNewData:function(e){this.m_imageid=app.player.imageid,this.m_index=0,this.m_objData=e,this.refreshUI()},refreshUI:function(){this.m_arrData=this.setData(),this.m_arrShowData=this.m_arrData[this.m_index],this.m_menu.setMenuIndex(this.m_index),this.m_strNowPickGsid=this.m_imageid,this.refreshLabJiesuo(),this.refreshHeroAmin(),this.refreshView()},refreshView:function(){var e=this.m_arrShowData.length;this.p_tabView.getComponent("tableView").initTableView(e,{array:this.m_arrShowData,maxpick:1,target:this})},setData:function(){var e=[],t=app.db.dbHeadImage;for(var a in t)if(t[a].VISIBLE){var i=t[a].TYPE-1;t[a].ETIME=app.player._images[a],null==e[i]&&(e[i]=[]),a==this.m_imageid?this.m_index=i:null!=t[a].ETIME?e[i].unshift(t[a]):e[i].push(t[a])}return null!=this.m_index&&e[this.m_index]&&e[this.m_index].unshift(t[this.m_imageid]),e},refreshLabJiesuo:function(){this.m_strNowPickGsid&&app.db.dbHeadImage[this.m_strNowPickGsid]&&(this.p_labJiesuo.string=langMgr.getString("playerinfoDecoratePageImage",0,app.db.dbHeadImage[this.m_strNowPickGsid].INTRO),this.p_labJiesuo.node.parent.opacity=app.player._images[this.m_strNowPickGsid]?0:255)},refreshHeroAmin:function(){if(this.m_strNowPickGsid&&app.db.dbHeadImage[this.m_strNowPickGsid]){var e=4==app.db.dbHeadImage[this.m_strNowPickGsid].TYPE;app.loadHeadGeneral(this.m_strNowPickGsid,this.p_sprGeneral,this.p_spGeneral,this.p_animGeneral,null,app.pages.playerinfodecoratepage.prefabPath,e)}},menuHandler:function(e){this.m_index=e,this.m_arrShowData=this.m_arrData[this.m_index]||[],this.refreshView()},itemClick:function(e,t){return e==this.m_strNowPickGsid?(this.m_chooseItem=t,!0):(this.m_chooseItem&&(cc.log("handle choose item"),this.m_chooseItem.selected(!1,this.m_strNowPickGsid)),this.m_chooseItem=t,this.m_strNowPickGsid=e,this.refreshLabJiesuo(),this.refreshHeroAmin(),!0)},onClickBtnChange:function(){var e=this;this.m_strNowPickGsid!=this.m_imageid?null!=app.player._images[this.m_strNowPickGsid]?-1!=app.player._images[this.m_strNowPickGsid]&&app.player._images[this.m_strNowPickGsid]<=app.player.getServerTime()?app.showNotice(langMgr.getString("playerinfoDecoratePageImage",4)):app.player.sfChangeImageId(this.m_strNowPickGsid,function(t){t?"expireTime is not defined"==t&&app.showNotice(langMgr.getString("playerinfoDecoratePageImage",5)):(app.player.imageid=e.m_strNowPickGsid,app.pages.playerinfopage.instance.refreshUI(),cc.isValid(e)&&e.getNewData(),app.showNotice(langMgr.getString("playerinfoDecoratePageImage",6)))}):app.showNotice(langMgr.getString("playerinfoDecoratePageImage",3)):app.showNotice(langMgr.getString("playerinfoDecoratePageImage",2))},onClickBtnCancel:function(){app.pages.playerinfodecoratepage.instance.onClose()}}),cc._RF.pop()},{}],playerinfoDecoratePageTxk:[function(e,t){"use strict";cc._RF.push(t,"9d1c4IJ6zVEXIAVACLJapZj","playerinfoDecoratePageTxk"),cc.Class({extends:cc.Component,properties:{p_tabView:cc.Node,p_btnChange:cc.Button,p_btnCancel:cc.Button,p_sprFrame:cc.Sprite,p_labTimeLimit:cc.Label,p_labLock:cc.RichText,p_labAtt:cc.Label,p_nodeSelectInfo:cc.Node,p_nodeLock:cc.Node,p_nodeTipBg:cc.Sprite},onLoad:function(){this.schedule(this.refreshTime,1),this.handleUI(),this.p_nodeSelectInfo.active=!1},handleUI:function(){var e=this;this.p_btnChange.node.on("click",function(){app.playSound("click"),e.onClickBtnChange()}),this.p_btnCancel.node.on("click",function(){app.playSound("click"),e.onClickBtnCancel()}),cc.isValid(this.p_nodeSelectInfo)&&this.p_nodeSelectInfo.on("touchend",function(){e.p_nodeSelectInfo.active=!1},this)},getNewData:function(){this.m_numFrameId=app.player.frameid,this.refreshUI()},refreshUI:function(){this.m_arrShowData=this.setData(),this.m_strNowPickGsid=this.m_numFrameId,this.refreshHeadFrame(),this.refreshView()},refreshView:function(){var e=this.m_arrShowData.length;this.m_arrChooseIndex=[],this.p_tabView.getComponent("tableView").initTableView(e,{array:this.m_arrShowData,maxpick:1,target:this})},setData:function(){var e=app.db.dbHeadFrame,t=[],a=[];for(var i in e)e[i].ETIME=app.player._frames[i],this.m_numFrameId==i?t.unshift(e[i]):null==e[i].ETIME||-1!=e[i].ETIME&&e[i].ETIME<app.player.getServerTime()?a.push(e[i]):t.push(e[i]);return t.concat(a.sort(function(e,t){return e.PRIORITY&&t.PRIORITY?e.PRIORITY-t.PRIORITY:e.FRAMEID-t.FRAMEID}))},refreshTime:function(){var e=this;if(this.m_isEtime){var t=app.player.getServerTime(),a=this.m_etime||0,i=a-t;(!a||i<0)&&(i=0);var n=langMgr.getString("playerinfoDecoratePageTxk",10);if(0==i)return this.p_labTimeLimit.string=n+"00:00:00",this.m_isEtime=!1,void app.player.sfPlayerData(function(){e.getNewData(),app.pages.playerinfopage.instance.refreshUI()});this.p_labTimeLimit.string=n+langMgr.getString("playerinfoDecoratePageTxk",0,gUtils.getCountDownStr(i))}},itemClick:function(e,t){return e==this.m_strNowPickGsid?(cc.isValid(this.p_nodeSelectInfo)&&(this.p_nodeSelectInfo.active=!0),this.m_chooseItem=t,!0):(this.m_chooseItem&&(cc.log("handle choose item"),this.m_chooseItem.selected(!1,this.m_strNowPickGsid)),this.m_chooseItem=t,this.m_strNowPickGsid=e,this.refreshHeadFrame(),cc.isValid(this.p_nodeSelectInfo)&&(this.p_nodeSelectInfo.active=!0),!0)},refreshHeadFrame:function(){this.refreshSprFrame(),this.refreshLabTimeLimit(),this.refreshLabAtt(),this.refreshLabLock()},refreshSprFrame:function(){if(this.m_strNowPickGsid&&app.db.getHeadFrameByGsid(this.m_strNowPickGsid)){var e=app.db.getHeadFrameByGsid(this.m_strNowPickGsid),t=e.FRAMEICON,a=gConfig.getIconGHeadFramePath(t);app.loadTexture(a,this.p_sprFrame,app.pages.playerinfodecoratepage.prefabPath),app.loadTexture(gConfig.getIconGHeadFrameNamePath(e.NAMEICON),this.p_nodeTipBg,assetMsg.cacheNoReleaseKey.Public)}},refreshLabTimeLimit:function(){if(this.m_strNowPickGsid&&app.db.getHeadFrameByGsid(this.m_strNowPickGsid)){var e=app.db.getHeadFrameByGsid(this.m_strNowPickGsid).TIMELIMIT,t=app.db.getHeadFrameByGsid(this.m_strNowPickGsid).ETIME,a=langMgr.getString("playerinfoDecoratePageTxk",10);null==t||-1!=t&&t<app.player.getServerTime()?(e<=0&&(this.p_labTimeLimit.string=a+langMgr.getString("playerinfoDecoratePageTxk",1)),e>0&&(this.p_labTimeLimit.string=a+langMgr.getString("playerinfoDecoratePageTxk",2,e))):this.p_labTimeLimit.string=a+langMgr.getString("playerinfoDecoratePageTxk",3)}},refreshLabAtt:function(){if(this.m_strNowPickGsid&&app.db.getHeadFrameByGsid(this.m_strNowPickGsid)){var e=app.db.getHeadFrameByGsid(this.m_strNowPickGsid).ARRATT;if(!e||e.length<=0)this.p_labAtt.node.active=!1;else{var t="";this.p_labAtt.node.active=!0;for(var a=0;a<e.length;a++){var i=app.db.getPropertyIdByCn(e[a].ATT)||langMgr.getString("playerinfoDecoratePageTxk",9);t=a==e.length-1?t+i+"+"+e[a].COUNT/10+"%":t+i+"+"+e[a].COUNT/10+"%\uff0c"}this.p_labAtt.string=t}}},refreshLabLock:function(){if(this.m_strNowPickGsid&&app.db.getHeadFrameByGsid(this.m_strNowPickGsid)){var e=app.db.getHeadFrameByGsid(this.m_strNowPickGsid).ETIME;this.m_isEtime=!1,this.p_labLock.string=app.db.getHeadFrameByGsid(this.m_strNowPickGsid).INTRO,null==e||-1!=e&&e<app.player.getServerTime()||-1==e||(this.m_etime=e,this.m_isEtime=!0,this.refreshTime())}},onClickBtnChange:function(){var e=this;this.m_strNowPickGsid!=this.m_numFrameId?null!=app.player._frames[this.m_strNowPickGsid]?-1!=app.player._frames[this.m_strNowPickGsid]&&app.player._frames[this.m_strNowPickGsid]<=app.player.getServerTime()?app.showNotice(langMgr.getString("playerinfoDecoratePageTxk",6)):app.player.sfChangeFrameId(this.m_strNowPickGsid,function(t){t?"expireTime is not defined"==t&&app.showNotice(langMgr.getString("playerinfoDecoratePageTxk",7)):app.player.sfPlayerData(function(){app.pages.playerinfopage.instance.refreshUI(),cc.isValid(e)&&(e.getNewData(),e.p_nodeSelectInfo.active=!1),app.showNotice(langMgr.getString("playerinfoDecoratePageTxk",8))})}):app.showNotice(langMgr.getString("playerinfoDecoratePageTxk",5)):app.showNotice(langMgr.getString("playerinfoDecoratePageTxk",4))},onClickBtnCancel:function(){app.pages.playerinfodecoratepage.instance.onClose()}}),cc._RF.pop()},{}],playerinfoDecoratePage:[function(e,t){"use strict";cc._RF.push(t,"370e6EmPFlK1IYMh2hYscx3","playerinfoDecoratePage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"playerinfodecoratepage",pageType:1},properties:{p_pfbHead:cc.Prefab,p_pfbTxk:cc.Prefab,p_pfbImage:cc.Prefab,p_nodeParent:cc.Node},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.m_menu=this.getComponent("menu"),this.m_menu.init(this)},handleUI:function(){this._super()},setParam:function(e){this.m_index=e?e.index:0,this.m_menu.setMenuIndex(this.m_index),this.refreshUI()},refreshUI:function(){},menuHandler:function(e){switch(e){case 0:this.m_nodeHead||(this.m_nodeHead=cc.instantiate(this.p_pfbHead),this.m_nodeHead.parent=this.p_nodeParent),this.m_nodeHead.getComponent("playerinfoDecoratePageHead").getNewData(this);break;case 1:this.m_nodeTxk||(this.m_nodeTxk=cc.instantiate(this.p_pfbTxk),this.m_nodeTxk.parent=this.p_nodeParent),this.m_nodeTxk.getComponent("playerinfoDecoratePageTxk").getNewData();break;case 2:this.m_nodeImage||(this.m_nodeImage=cc.instantiate(this.p_pfbImage),this.m_nodeImage.parent=this.p_nodeParent),this.m_nodeImage.getComponent("playerinfoDecoratePageImage").getNewData()}this.m_nodeHead&&(this.m_nodeHead.active=0==e),this.m_nodeTxk&&(this.m_nodeTxk.active=1==e),this.m_nodeImage&&(this.m_nodeImage.active=2==e)},onClose:function(){this._super()}});a.showPage=function(t){var a=this;app.player.sfPlayerByParam(["_heads","_frames","_images"],function(){e("basePage").showPage.call(a,t)})},cc._RF.pop()},{basePage:void 0}],playerinfoHeadiconPage:[function(e,t){"use strict";cc._RF.push(t,"16f3cYDIv9AN4nQqCl/svLK","playerinfoHeadiconPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"playerinfoheadiconpage"},properties:{p_tabvHeadicon:cc.tableView,p_btnChange:cc.Button},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){var e=this;this._super(),this.p_btnChange.node.on("click",function(){app.playSound("click"),e.onClickBtnChange()})},setParam:function(e){this.m_numIconId=e,this.refreshUI()},refreshUI:function(){this.m_arrShowData=this.setData(),this.m_strNowPickGsid,this.m_numIconId,this.refreshView()},refreshView:function(){var e=this.m_arrShowData.length;this.p_tabvHeadicon.getComponent("tableView").initTableView(e,{array:this.m_arrShowData,maxpick:1,initfun:"initForHeadIcon",target:this})},setData:function(){for(var e=[],t=app.player._icons.split("|"),a=0;a<t.length;++a){var i=t[a];app.db.dbGHeadIcon[i]&&e.push(i)}return e},itemClick:function(e,t){return e==this.m_strNowPickGsid||(this.m_chooseItem&&(cc.log("handle choose item"),this.m_chooseItem.selected(!1,this.m_strNowPickGsid)),this.m_chooseItem=t,this.m_strNowPickGsid=e,!0)},onClickBtnChange:function(){var e=this;this.m_strNowPickGsid!=this.m_numIconId&&app.player.sfChangeIconId(this.m_strNowPickGsid,function(){app.player.sfPlayerData(function(){app.pages.playerinfopage.instance.refreshUI(),e.onClose()})})},onClose:function(){this._super()}});cc._RF.pop()},{basePage:void 0}],playerinfoNamePage:[function(e,t){"use strict";cc._RF.push(t,"8462e6dam9ONaKD+onOtwBP","playerinfoNamePage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"playerinfonamepage",pageType:1},properties:{p_editName:cc.EditBox,p_nodeCancelTips:cc.Node,p_btnConfirm:cc.Button,p_btnRandom:cc.Button,p_nodeTips:cc.Node,p_labTx:cc.Label,p_nodeCost:cc.Node},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(),this.handleUI()},handleUI:function(){var e=this;this._super(),this.p_btnConfirm.node.on("click",function(){app.playSound("click"),e.onClickBtnConfirm()}),this.p_btnRandom.node.on("click",function(){app.playSound("click"),e.setRandomName()})},setParam:function(e){e||(e="change"),this.m_showType=e,this.refreshUI()},refreshUI:function(){this.p_editName.string="","change"==this.m_showType&&(this.bmaskclose=!0,this.p_btnConfirm.node.active=!0,this.p_nodeCancelTips.active=!0,this.p_nodeTips.active=!0,!app.player.getCount(90157)||app.player.level>=30?(this.p_labTx.string=langMgr.getString("playerinfoNamePage",16),this.p_nodeCost.active=!0):(this.p_labTx.string=langMgr.getString("playerinfoNamePage",17),this.p_nodeCost.active=!1)),"create"==this.m_showType&&(this.bmaskclose=!1,this.p_btnConfirm.node.active=!0,this.p_nodeCancelTips.active=!1,this.p_nodeTips.active=!1)},setRandomName:function(){this.p_editName.string="",this.p_editName.string=app.db.getRandomName()},onClickBtnConfirm:function(){var e=this,t=this.p_editName.string,a=app.player.getCount(90157);if(t!=app.player.rname)if(""!=t&&t){var i=t.length,n=i;if(n>12)app.showNotice(langMgr.getString("playerinfoNamePage",11));else{for(var r=0;r<i;++r)t.charCodeAt(r)>127&&++n;if(n>12)app.showNotice(langMgr.getString("playerinfoNamePage",11));else{if(!app.checkMatchStr(t))return app.showNotice(langMgr.getString("playerinfoNamePage",12)),void(this.p_editName.string="");if(gUtils.checkRNameStr(t))app.showNotice(langMgr.getString("playerinfoNamePage",13));else if(!a||app.player.level>=30){if(app.player.getCount(38005)<500)return void app.showNotice(langMgr.getString("playerinfoNamePage",14));var o={content:langMgr.getString("playerinfoNamePage",18),confirmcb:function(){app.player.sfChangeName(t,function(t){t.castitems&&app.player.reduceItem(t.castitems),app.showNotice(langMgr.getString("playerinfoNamePage",15)),app.player.sfPlayerData(function(){app.pages.playerinfopage.instance&&cc.isValid(app.pages.playerinfopage.instance.node)&&app.pages.playerinfopage.instance.node.active&&app.pages.playerinfopage.instance.refreshUI(),"scenes_main"==cc.director.getScene().name&&app.mainScene.refreshTopUI(),e.onClose()})})},target:this};app.pages.windowspagetipsmsg.showPage(o)}else app.player.sfChangeName(t,function(t){t.castitems&&app.player.reduceItem(t.castitems),app.showNotice(langMgr.getString("playerinfoNamePage",15)),app.player.sfPlayerData(function(){app.pages.playerinfopage.instance&&cc.isValid(app.pages.playerinfopage.instance.node)&&app.pages.playerinfopage.instance.node.active&&app.pages.playerinfopage.instance.refreshUI(),"scenes_main"==cc.director.getScene().name&&app.mainScene.refreshTopUI(),e.onClose(),GodGuide.addGuideProgress("guide_change_name_end"),GodGuide.checkGuideProgress("changename")&&app.runGuide(),cc.director.emit("change_name_end")})})}}}else app.showNotice(langMgr.getString("playerinfoNamePage",10));else app.showNotice(langMgr.getString("playerinfoNamePage",9))},onClose:function(){this._super(),app.isGuide()&&app.runGuide()}});cc._RF.pop()},{basePage:void 0}],playerinfoPage:[function(e,t){"use strict";cc._RF.push(t,"8b0ca9bRotEoJrcEDZsqJks","playerinfoPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"playerinfopage",pageType:1,createShot:!0},properties:{p_nodeHead:cc.Node,p_nodeHeadIcon:cc.Node,p_sprVip:cc.Sprite,p_labName:cc.Label,p_nodeChangeName:cc.Node,p_labGuildName:cc.Label,p_labRid:cc.Label,p_labLevel:cc.Label,p_barLevel:cc.ProgressBar,p_labLvTx:cc.Label,p_nodePower:cc.Node,p_layoutGeneral:cc.Node,p_pfbGeneral:cc.Prefab,p_nodeMusic:cc.Node,p_nodeMusicPick:cc.Node,p_nodeSound:cc.Node,p_nodeSoundPick:cc.Node,p_labServer:cc.Label,p_btnSwithcServ:cc.Button,p_btnSwitchAccount:cc.Button,p_btnCode:cc.Button,p_btnAnno:cc.Button,p_btnExit:cc.Button,p_btnReplace:cc.Button,p_nodeSignature:cc.Node,p_labSignature:cc.Label,p_nodeGender:cc.Node,p_nodeGenderSelect:cc.Node,p_nodeGenderMask:cc.Node,p_nodeGenderMen:cc.Node,p_nodeGenderWoman:cc.Node,btnVIPVisible:cc.Node,vipVisibleCheck:cc.Node,p_nodeSexSelect:cc.Node,p_arrNodeSex:[cc.Node],p_nodeTexSelect:cc.Node,p_arrNodeTex:[cc.Node],p_pfbPower:cc.Prefab,p_pfbHead:cc.Prefab,_powerItem:null},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){var e=this;this._super(),this.p_btnSwitchAccount.node.on("click",function(){app.playSound("click"),CANGLONG.upRoleData({eventType:5}),"dev"!=window.gSetting.channel?CANGLONG.loginOut():(app.clearServInfo(),app.NetWotk.switchAccount())}),this.p_btnExit&&this.p_btnExit.node.on("click",function(){app.playSound("cancel");var t={content:langMgr.getString("playerinfoPage",3),confirmcb:function(){CANGLONG.upRoleData({eventType:5}),cc.game.end()},target:e};app.pages.windowspagetipsmsg.showPage(t)}),this.p_btnSwithcServ.node.on("click",function(){app.playSound("click"),app.pages.chooseserverpage.showPage(app.serverlist)}),this.p_btnCode.node.on("click",function(){app.playSound("click"),app.pages.windowspagecode.showPage()}),this.p_btnAnno.node.on("click",function(){app.playSound("click"),app.pages.annowebpage.showPage()}),this.p_nodeHead.on("touchend",function(){app.pages.playerinfodecoratepage.showPage()}),this.p_btnReplace.node.on("click",function(){app.pages.playerinfodecoratepage.showPage()}),this.p_nodeChangeName.on("touchend",function(){app.pages.playerinfonamepage.showPage()}),this.p_nodeSignature.on("touchend",function(){app.pages.playerinfosignaturepage.showPage()}),this.p_nodeGender.on("touchend",function(){e.p_nodeGenderSelect.active=!0}),this.p_nodeGenderMask.on("touchend",function(){e.p_nodeGenderSelect.active=!1}),this.p_nodeGenderMen.on("touchend",function(){e.setGender(0)}),this.p_nodeGenderWoman.on("touchend",function(){e.setGender(1)}),this.p_arrNodeSex.forEach(function(t,a){t.on("touchend",function(){e.setGender(a)})}),this.p_arrNodeTex.forEach(function(t,a){t.on("touchend",function(){e.setTexTure(a)})}),this.p_nodeMusic.on("touchend",function(){e.onMusic()}),this.p_nodeSound.on("touchend",function(){e.onSound()}),this.btnVIPVisible.on("click",function(){app.playSound("click"),app.player.set.vipHide=!app.player.set.vipHide,app.player.sfSetVipHide(app.player.set.vipHide).then(function(){e.vipVisibleCheck.active=!!app.player.set.vipHide}).catch(function(e){cc.warn(e)})},this)},setParam:function(){this.refreshUI(),this.getLegionInfo(),this.p_nodeSexSelect.x=0==app.player.sex?-45:45,this.p_arrNodeSex.forEach(function(e,t){e.opacity=t==app.player.sex?255:130});var e=cc.sys.localStorage.getItem("fpsVal")?Number(cc.sys.localStorage.getItem("fpsVal"))-1:0;this.p_nodeTexSelect.x=0==e?-45:45,this.p_arrNodeTex.forEach(function(t,a){t.opacity=a==e?255:130})},refreshUI:function(){this.m_playerHead||(this.m_playerHead=cc.instantiate(this.p_pfbHead),this.m_playerHead.parent=this.p_nodeHead),this.m_playerHead.getComponent("headItem").init({headid:app.player.headid,frameid:app.player.frameid,vip:app.player.vip,numLevel:app.player.level,target:this}),this.p_labName.string=app.player.rname,this.p_labSignature.string=app.player.mood||langMgr.getString("playerinfoPage",2),this.p_labRid.string=app.player.rno,this.p_labLevel.string=app.player.level;var e=app.player.power;cc.isValid(this._powerItem)||(this._powerItem=cc.instantiate(this.p_pfbPower),this.p_nodePower.addChild(this._powerItem),this._powerItem.setPosition(cc.Vec2.ZERO)),this._powerItem.getComponent("PowerDisplay").init({val:e});var t=app.db.getPlayerNextExpByLv(app.player.level-1)||0,a=app.db.getPlayerNextExpByLv(app.player.level);if(cc.log(app.db.getPlayerMaxLv()),app.player.level<app.db.getPlayerMaxLv()){var i=(app.player.exp-t)/(a-t);this.p_barLevel&&(this.p_barLevel.progress=Math.min(i,1));var n=app.player.exp-t,r=a-t;this.p_labLvTx&&(this.p_labLvTx.string=n+"/"+r)}else this.p_barLevel&&(this.p_barLevel.progress=1),this.p_labLvTx&&(this.p_labLvTx.string=langMgr.getString("playerinfoPage",0));var o=this.getBestGeneral(),s=Math.min(10,o.length);this.m_arrNodeGeneral||(this.m_arrNodeGeneral=[]);for(var p=0;p<s;++p){var c=this.m_arrNodeGeneral[p];c||((c=cc.instantiate(this.p_pfbGeneral)).parent=this.p_layoutGeneral,this.m_arrNodeGeneral.push(c)),c.active=!0,c.getComponent("generalPortraitItem").initForBag(o[p])}this.p_layoutGeneral.getComponent(cc.Layout).updateLayout(),this.p_layoutGeneral.getComponent(cc.Layout).enabled=!1,app.playGridListAction(this.m_arrNodeGeneral.slice(0,o.length));for(var h=o.length;h<this.m_arrNodeGeneral.length;++h)this.m_arrNodeGeneral[h].active=!1;this.refreshMusic(),this.refreshSound(),app.servername;var l=app.serverarea||"",g=app.serverserv||"";this.p_labServer.string=l+" "+g,this.vipVisibleCheck.active=!!app.player.set.vipHide},refreshSound:function(){this.p_nodeSoundPick.active=1==app.bPlaySound},refreshMusic:function(){this.p_nodeMusicPick.active=1==app.bPlayMusic},refreshLegionName:function(){this.p_labGuildName.string=this.m_legion},onSound:function(){app.bPlaySound=1==app.bPlaySound?0:1,cc.sys.localStorage.setItem("bsound",app.bPlaySound),this.refreshSound()},onMusic:function(){app.bPlayMusic=1==app.bPlayMusic?0:1,cc.sys.localStorage.setItem("bmusic",app.bPlayMusic),audioMsg.reloadBgMusic(),this.refreshMusic()},getBestGeneral:function(){var e=[];for(var t in app.player.general)e.push(t);return e.sort(function(e,t){return app.player.general[e].power<app.player.general[t].power?1:-1}),e},getLegionInfo:function(){var e=this;if(!app.player.legion)return this.m_legion="\u65e0",void this.refreshLegionName();app.db.checkFuncUnLock("LEGION")&&app.player.sfGetLegionInfo(function(t,a){e.m_legion=t?"\u65e0":a.name,e.refreshLegionName()})},onDestroy:function(){this._super()},setGender:function(e){var t=this;this.p_nodeSexSelect.x=0==e?-45:45,this.p_arrNodeSex.forEach(function(t,a){t.opacity=a==e?255:130}),app.player.sfChangeSex(e,function(){app.player.sfPlayerByParam(["sex"],function(){app.showNotice(langMgr.getString("playerinfoPage",1)),app.pages.playerinfopage.instance&&cc.isValid(app.pages.playerinfopage.instance.node)&&app.pages.playerinfopage.instance.node.active&&app.pages.playerinfopage.instance.refreshUI(),t.p_nodeGenderSelect.active=!1})})},setTexTure:function(e){this.p_nodeTexSelect.x=0==e?-45:45,this.p_arrNodeTex.forEach(function(t,a){t.opacity=a==e?255:130}),app.fpsVal=e+1,cc.sys.localStorage.setItem("fpsVal",e+1)}});cc._RF.pop()},{basePage:void 0}],playerinfoSignaturePage:[function(e,t){"use strict";cc._RF.push(t,"50babJmmx1AoIxSGojBje+2","playerinfoSignaturePage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"playerinfosignaturepage",pageType:1},properties:{p_editSignature:cc.EditBox,p_btnConfirm:cc.Button},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){var e=this;this._super(),this.p_btnConfirm.node.on("click",function(){app.playSound("click"),e.onClickBtnConfirm()})},setParam:function(e){e||(e="change"),this.m_showType=e,this.refreshUI()},refreshUI:function(){this.p_editSignature.string=""},onClickBtnConfirm:function(){var e=this,t=this.p_editSignature.string;if(t!=app.player.mood)if(""!=t&&t){var a=t.length,i=a;if(i>64)app.showNotice(langMgr.getString("playerinfoSignaturePage",2));else{for(var n=0;n<a;++n)t.charCodeAt(n)>127&&++i;if(i>64)app.showNotice(langMgr.getString("playerinfoSignaturePage",2));else{if(!app.checkMatchStr(t))return app.showNotice(langMgr.getString("playerinfoSignaturePage",3)),void(this.p_editSignature.string="");gUtils.checkRNameStr(t)?app.showNotice(langMgr.getString("playerinfoSignaturePage",4)):app.player.sfChangeSignature(t,function(){app.showNotice(langMgr.getString("playerinfoSignaturePage",6)),app.player.sfPlayerData(function(){app.pages.playerinfopage.instance&&cc.isValid(app.pages.playerinfopage.instance.node)&&app.pages.playerinfopage.instance.node.active&&app.pages.playerinfopage.instance.refreshUI(),e.onClose()})})}}}else app.showNotice(langMgr.getString("playerinfoSignaturePage",1));else app.showNotice(langMgr.getString("playerinfoSignaturePage",0))}});cc._RF.pop()},{basePage:void 0}],practiceTowerPage:[function(e,t){"use strict";cc._RF.push(t,"78323tFO4xOPqSm8lK7e2WE","practiceTowerPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"practicetowerpage"},properties:{p_sprGeneral:cc.Sprite,p_spGeneral:sp.Skeleton,p_animGeneral:cc.Animation,p_btnReward:cc.Button,p_labCoin:cc.Label,p_labTime:cc.Label,p_btnPlus:cc.Button,p_labFloor:cc.Label,p_btnRank:cc.Button,p_labTalk:cc.Label,p_btnVideo:cc.Button,p_arrFreward:[cc.Node],p_labMoney:cc.Label,p_btnAdd:cc.Button,p_btnFight:cc.Button,p_btnQuick:cc.Button,p_nodeChoose:cc.Node,p_animFire:cc.Animation,p_animHero:cc.Animation,p_btnHelp:cc.Button},onLoad:function(){a.instance=this,this._super(),this.fitTopMenu(),this.refreshUI(),app.loadEff("tower_02",this.p_animFire,2,2),app.loadEff("tower_01",this.p_animHero,2,2)},handleUI:function(){var e=this;this._super(),this.p_btnRank.node.on("click",function(){app.playSound("click"),app.player.sfRankByType("tower",function(e,t){e?app.showNotice(e):app.pages.practicetowerrankpage.showPage(t)})}),this.p_btnVideo.node.on("click",function(){app.playSound("click"),e.getReplay()}),this.p_btnReward.node.on("touchend",function(){app.pages.practicetowerrewardpage.showPage()}),this.p_btnFight.node.on("click",function(){app.playSound("click"),e.goFight()}),this.p_btnHelp.node.on("click",function(){app.pages.windowspagetipshelp.showPage("\u8bd5\u7ec3\u5854",app.mainScene.p_nodeBg)}),this.p_btnQuick.node.on("click",function(){e.onSetQuick()}),this.p_btnPlus.node.on("click",function(){e.onBuy()})},setParam:function(){this._bQuick=Number(cc.sys.localStorage.getItem(app.player.id+"tower")),this.refreshQuick()},refreshUI:function(){var e=app.db.getTowerInfoByFloor(app.player.tower);if(!e)return app.showNotice(langMgr.getString("practiceTowerPage",1)),void this.onClose();this._pGsid=e.GENERAL,app.loadGeneral(e.GENERAL,this.p_sprGeneral,this.p_spGeneral,this.p_animGeneral,null,this.prefabPath),this.playGeneralTalk(),this.p_labFloor.string=langMgr.getString("practiceTowerPage",0,app.player.tower),this.p_labTalk.string=e.TALK;for(var t=0;t<e.REWARDS.length;++t)this.p_arrFreward[t].active=!0,this.p_arrFreward[t].getComponent("propItem").initForBag(e.REWARDS[t]),this.p_arrFreward[t].getComponent("propItem").setClick(!0);for(var a=e.REWARDS.length;a<this.p_arrFreward.length;++a)this.p_arrFreward[a].active=!1;this.refreshRewardRed()},refreshTowerCoin:function(){var e=this;this._getCoinIng=!0,app.player.sfTowerToken(function(t,a){e._getCoinIng=!1,t?app.showNotice(t):(e._coinNum=a.num,e.p_labCoin.string=a.num+"/20",e._lastTime=a.last,e.refreshTime())})},refreshTime:function(){if(this._lastTime){if(this._coinNum>=20)return void(this.p_labTime.string="");var e=app.player.getServerTime()-this._lastTime;e>9e5&&this.refreshTowerCoin(),e=9e5-e;var t=gUtils.getHourMinSecTime(e/1e3);this.p_labTime.string=t}else this.p_labTime.string=""},playGeneralTalk:function(){var e=this;if(app.isLoading){var t=app.db.getSoundByGsid(this._pGsid);t&&app.playGeneralSound(t,1)}else cc.director.once("loading_end",function(){e.playGeneralTalk()})},refreshRewardRed:function(){app.pages.practicetowerrewardpage.refreshRed(this.p_btnReward.node.getChildByName("rednotice"))},goFight:function(){var e=this;app.battleType="tower",app.player.sfTowerInfo(function(t,a){t?app.showNotice(langMgr.getString("practiceTowerPage",4)):(app.battleConfig=a,app.player.level>=50&&e._bQuick?app.pages.quickbattleformpage.showPage({battletype:"tower",sureCb:function(){app.goToNormBattle()},refreshCb:function(){e.refreshUI()}}):app.goToNormBattle())})},getReplay:function(){app.pages.practicetowerreplaypage.showPage()},refreshQuick:function(){this.p_btnQuick.node.active=app.player.level>=50,this.p_nodeChoose.active=!!this._bQuick},onSetQuick:function(){cc.sys.localStorage.setItem(app.player.id+"tower",this._bQuick?0:1),this._bQuick=this._bQuick?0:1,this.refreshQuick()},onBuy:function(){var e=this;if(this._coinNum>=20)app.showNotice(langMgr.getString("practiceTowerPage",5));else if(app.player.getCount(38005)<10)app.showNotice(langMgr.getString("practiceTowerPage",6));else{var t={gsid:30032,maxcount:Math.min(20-this._coinNum,Math.floor(app.player.getCount(38005)/10)),type:"buy",coin:38005,price:10,confirmcb:function(t){app.player.sfTowerBuy(t,function(a,i){if(a)return"too much"==a&&(a=langMgr.getString("practiceTowerPage",7)),void app.showNotice(a);e._coinNum=i.num,e.p_labCoin.string=i.num+"/20",e._lastTime=i.last,e.refreshTime(),app.player.reduceItem({GSID:38005,COUNT:10*t})})},target:this};app.pages.windowspagesetnum.showPage(t)}},onClose:function(){this._super()}});a.refreshRed=function(e){e&&(e.active=app.pages.practicetowerrewardpage.refreshRed(null)||!1)},a.showPage=function(t,a,i){app.db.getTowerInfoByFloor(app.player.tower)?e("basePage").showPage.call(this,t,a,i):app.showNotice(langMgr.getString("practiceTowerPage",8))},cc._RF.pop()},{basePage:void 0}],practiceTowerRankPage:[function(e,t){"use strict";cc._RF.push(t,"6e2bf519I5DiYr+l9mzOQQs","practiceTowerRankPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"practicetowerrankpage"},properties:{p_nodeView:cc.Node,p_labMyrank:cc.Label,p_labSelfNum:cc.Label},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},setParam:function(e){this._self=e.selfrank,this._arr=e.list,this.showTowerRank()},showTowerRank:function(){this.p_labMyrank.string=this._self?this._self:"500+",this.p_labSelfNum.string=app.player.tower,this.p_nodeView.getComponent("tableView").initTableView(this._arr.length,{array:this._arr,target:this})}});cc._RF.pop()},{basePage:void 0}],practiceTowerReplayPage:[function(e,t){"use strict";cc._RF.push(t,"56f44MCApJMv4Yz4TuagA74","practiceTowerReplayPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"practicetowerreplaypage",pageType:1},properties:{p_arrRep:[cc.Node],p_nodeCont:cc.Node,p_pfbProp:cc.Prefab,p_labReward:cc.Label},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){this._super()},setParam:function(e){var t=this;this._type=e.type,this._floor=e.floor,e.status&&(this._status=e.status),this.refreshUI(),-1==this._type?app.player.sfTowerReplay({floor:this._floor,needvideo:1},function(e,a){t._reparr=a||[],t.refreshUIRank()}):app.player.sfOccTowerVideo({floor:this._floor,type:this._type,needvideo:1},function(e,a){t._reparr=a||[],t.refreshUIRank()})},refreshUIRank:function(){for(var e=0;e<this._reparr.length&&e<3;++e)this.p_arrRep[e].active=!0,this.p_arrRep[e].getComponent("towerReplayItem").refreshUI(this._reparr[e],this);for(var t=this._reparr.length;t<this.p_arrRep.length;++t)this.p_arrRep[t].active=!1},refreshUI:function(){var e,t=[];-1==this._type?(this.p_labReward.string=langMgr.getString("practiceTowerReplayPage",0),t=(e=app.db.getTowerInfoByFloor(this._floor)).REWARDS||[]):(e=app.db.getOccTowerInfoByFloor(this._type,this._floor),2==this._status?(this.p_labReward.string=langMgr.getString("practiceTowerReplayPage",1),t=e.FARM_REWARDS||[]):(this.p_labReward.string=langMgr.getString("practiceTowerReplayPage",0),t=e.KILL_REWARDS||[]));for(var a=0;a<t.length;++a){var i=this.p_nodeCont.children[a];i||(i=cc.instantiate(this.p_pfbProp),this.p_nodeCont.addChild(i)),i.active=!0,i.getComponent("propItem").initForBag(t[a]),i.getComponent("propItem").setClick(!0)}for(var n=t.length;n<this.p_nodeCont.children.length;++n)this.p_nodeCont.children[n].active=!1}});cc._RF.pop()},{basePage:void 0}],practiceTowerRewardPage:[function(e,t){"use strict";cc._RF.push(t,"8377aLpxf9FJ41hbNdiMJ/e","practiceTowerRewardPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"practicetowerrewardpage"},properties:{p_pfbItem:cc.Prefab,p_nodeView:cc.Node,p_nodeContent:cc.Node},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.m_arrItem=[]},setParam:function(){this.refreshUI()},refreshUI:function(){for(var e=app.db.dbTowerAchieve.ACHIEVE,t=app.player.getCount(app.db.dbTowerAchieve.GETMARK),a=[],i=t;i<e.length;++i)a.push(e[i]);this.p_nodeView.getComponent("tableView").initTableView(a.length,{array:a,start:t,target:this})}});a.refreshRed=function(e){var t=app.player.getCount(app.db.dbTowerAchieve.GETMARK),a=app.db.dbTowerAchieve.ACHIEVE;return app.player.tower>a[t].TOWER?(e&&(e.active=!0),!0):(e&&(e.active=!1),!1)},cc._RF.pop()},{basePage:void 0}],prePageLegionpractice:[function(e,t){"use strict";cc._RF.push(t,"81a4aXk+51MeJxO77nLLL+f","prePageLegionpractice");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"prepagelegionpractice",pageType:1},properties:{p_labTime:cc.Label,p_labLevel:cc.Label},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},onEnable:function(){this._super(),eventMgr.on(eventStr.commonEvent.RefreshTime,this.refreshTime,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.commonEvent.RefreshTime,this.refreshTime,this)},handleUI:function(){this._super()},setParam:function(){this.refreshTime(),this.p_labLevel.string=langMgr.getString("legionSettingPage",2,11)},refreshTime:function(){app.lockFunConfig&&(this.p_labTime.string=gUtils.getCountDownStr(app.lockFunConfig.getPreCountDownByKey("LEGION_PRACTICE")))}});cc._RF.pop()},{basePage:void 0}],prePageLegionwar:[function(e,t){"use strict";cc._RF.push(t,"5f067CJXn1I3YzP6yEPXfhb","prePageLegionwar");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"prepagelegionwar",pageType:1},properties:{p_labTime:cc.Label,p_labLevel:cc.Label},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},onEnable:function(){this._super(),eventMgr.on(eventStr.commonEvent.RefreshTime,this.refreshTime,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.commonEvent.RefreshTime,this.refreshTime,this)},handleUI:function(){this._super()},setParam:function(){this.refreshTime(),this.p_labLevel.string=langMgr.getString("legionSettingPage",2,4)},refreshTime:function(){app.lockFunConfig&&(this.p_labTime.string=gUtils.getCountDownStr(app.lockFunConfig.getPreCountDownByKey("LEGION_WAR")))}});cc._RF.pop()},{basePage:void 0}],prePagePalace:[function(e,t){"use strict";cc._RF.push(t,"bf756srhqNEebQuUHrBL6cT","prePagePalace");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"prepagepalace",pageType:1},properties:{p_labTime:cc.Label,p_labLevel:cc.Label},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},onEnable:function(){this._super(),eventMgr.on(eventStr.commonEvent.RefreshTime,this.refreshTime,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.commonEvent.RefreshTime,this.refreshTime,this)},handleUI:function(){this._super()},setParam:function(){this.refreshTime(),this.p_labLevel.string=langMgr.getString("legionSettingPage",2,app.db.getLevelByFunc("PALACE"))},refreshTime:function(){app.lockFunConfig&&(this.p_labTime.string=gUtils.getCountDownStr(app.lockFunConfig.getPreCountDownByKey("PALACE")))}});cc._RF.pop()},{basePage:void 0}],prePageSummitpvp:[function(e,t){"use strict";cc._RF.push(t,"4bdd7gX4X1ECocdEeu46f+F","prePageSummitpvp");var a="PVP_SUMMIT",i=cc.Class({extends:e("basePage"),statics:{prefabPath:"prepagesummitpvp",pageType:1},properties:{p_labTime:cc.Label,p_labLevel:cc.Label},onLoad:function(){i.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},onEnable:function(){this._super(),eventMgr.on(eventStr.commonEvent.RefreshTime,this.refreshTime,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.commonEvent.RefreshTime,this.refreshTime,this)},handleUI:function(){this._super()},setParam:function(){this.refreshTime(),this.p_labLevel.string=langMgr.getString("legionSettingPage",2,app.db.getLevelByFunc(a))},refreshTime:function(){app.lockFunConfig&&(this.p_labTime.string=gUtils.getCountDownStr(app.lockFunConfig.getPreCountDownByKey(a)))}});cc._RF.pop()},{basePage:void 0}],premiumPage:[function(e,t){"use strict";cc._RF.push(t,"2bb07hnAVNE3pqJT7V5iTFb","premiumPage");var a=[{name:"yk",uiPatch:"premium_page",iconPath:"btn_czfl_yueka01",iconPickPath:"btn_czfl_yueka02",labelPath:"txt_czfl_yueka_lang",page:"rechargewelfarepageyk",pageParam:null,coin:[38005,38006],funcId:"CARD"},{name:"mrlb",uiPatch:"premium_page",iconPath:"btn_czfl_rlb01",iconPickPath:"btn_czfl_rlb02",labelPath:"txt_czfl_rlbj_lang",page:"rechargenormalpagemrxg",pageParam:null,coin:[38005,38006],funcId:"GIFT_DAY"},{name:"jthl",uiPatch:"premium_page",iconPath:"btn_czfl_ljcz01",iconPickPath:"btn_czfl_ljcz02",labelPath:"txt_czfl_ljcz_lang",page:"rechargewelfarepagejthl",pageParam:null,coin:[38005,38006],funcId:"JTHL"},{name:"mrlc",uiPatch:"premium_page",iconPath:"btn_czfl_mrlc01",iconPickPath:"btn_czfl_mrlc02",labelPath:"txt_czfl_mrlc_lang",page:"rechargewelfarepagemrlc",pageParam:null,coin:[38005,38006],funcId:"MRLC"},{name:"czjj",uiPatch:"premium_page",iconPath:"btn_czfl_czjj01",iconPickPath:"btn_czfl_czjj02",labelPath:"txt_czfl_czjj_lang",page:"rechargewelfarepageczjj",pageParam:null,coin:[38005,38006],funcId:"FUND_CZ"},{name:"sljj",uiPatch:"premium_page",iconPath:"btn_czfl_sljj01",iconPickPath:"btn_czfl_sljj02",labelPath:"txt_czfl_sljj_lang",page:"rechargewelfarepagesljj",pageParam:null,coin:[38005,38006],funcId:"FUND_SL"}],i=cc.Class({extends:e("basePage"),statics:{prefabPath:"premiumpage"},properties:{p_nodeBg:cc.Node,p_top:cc.Node,p_menu:cc.Node,p_scrView:cc.ScrollView},onLoad:function(){i.instance=this,this.stopBgNodeEvent(),this.creatMask(),this.fitTopMenu(),this.handleUI(),this.canSelectMenu=!0,this.m_menu=this.p_menu.getComponent("menuV2")},onEnable:function(){this._super(),eventMgr.on(eventStr.redEvent.RefreshPremiumRed,this.refreshRed,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.redEvent.RefreshPremiumRed,this.refreshRed,this)},handleUI:function(){this._super()},setParam:function(e){var t=this,i=e||"yk",n=this.getMenuData();this.m_arrMenuData=n.arr,this.m_arrMenuName=n.arrName,this.m_menu.init(this.m_arrMenuData.length,this.menuHandler,this.refreshMenuUI,this.refreshMenuRed,this),this.m_menu.refreshMenu(),this.m_menu._arrBtnMenu.forEach(function(e,t){var i=a[t];e.active=!!i,"jthl"==i.name&&1==app.player.jthl_end&&(e.active=!1)}),this.setMenu(i),this.scheduleOnce(function(){t.refershMenuView()},.1)},refershMenuView:function(){var e=this.m_arrMenuData.length,t=this.m_menu.p_menuBtnTemp.width,a=this.p_scrView.content.getComponent(cc.Layout).spacingX,i=this.m_menu.m_numMenuIndex;if(cc.log(e),e<=5){var n=t*e+a*(e-1);this.p_scrView.content.x=-n-this.p_scrView.content.getComponent(cc.Layout).paddingLeft,cc.log(n,this.p_scrView.content.width,this.p_scrView.content.x)}else{var r=i<5?0:i-5+3,o=0==r?0:(t+a)*r;this.p_scrView.scrollToOffset(cc.Vec2(o,0))}this.p_scrView.elastic=!!(e>5)},refreshCoinUI:function(){this.p_top.getComponent("currency").refreshCoin(this.currentPageData.coin),this.refreshRed()},openShopPage:function(){var e=this;if(this.currentPageData&&this.currentPageData.page){this.canSelectMenu=!1;var t=app.pages[this.currentPageData.page],a=function(){t.showPage(e.currentPageData.pageParam,e.p_nodeBg,function(a){a?e.canSelectMenu=!0:(e.m_showPage=t.instance,t.instance.p_bgNode?(e.m_showPageNode=e.m_showPage.p_bgNode,e.m_showPageNode.opacity=0,e.m_showPageNode.runAction(cc.sequence(cc.fadeIn(.15),cc.callFunc(function(){e.canSelectMenu=!0})))):e.canSelectMenu=!0)})};if(this.m_showPage){if(this.m_showPage.node.active=!0,this.m_showPageNode=this.m_showPage.p_bgNode,!this.m_showPageNode)return this.m_showPage.onClose(),this.m_showPage=null,void a();this.m_showPageNode.runAction(cc.sequence(cc.fadeOut(.1),cc.callFunc(function(){e.m_showPage.onClose(),e.m_showPage=null,a()})))}else a();this.refreshCoinUI()}},menuHandler:function(e){if(!this.canSelectMenu)return!1;this.currentPageData=this.m_arrMenuData[e],this.openShopPage()},refreshRed:function(){this.m_menu.refreshRed()},refreshMenuUI:function(e){return this.m_arrMenuData[e]||{}},refreshMenuRed:function(e){var t=this.getMenuData().arr[e];return!!(t&&t.page&&app.pages[t.page]&&app.pages[t.page].refreshRed)&&app.pages[t.page].refreshRed()},getMenuData:function(){for(var e=[],t=[],i=0;i<a.length;++i){var n=a[i],r=app.db.checkFuncUnLock(n.funcId),o=app.db.checkChannelShow(n.funcId),s=!1;"sjg"===a[i].name&&(s=app.player.getCount(93366)>0||app.player.getCount(94100)>0),(r&&o||s)&&(e.push(n),t.push(n.name))}return{arr:e,arrName:t}},setMenu:function(e){var t=this.m_arrMenuName.indexOf(e);t>=0&&this.m_menu.setMenuIndex(t)},onClose:function(){app.pages[this.currentPageData.page].instance&&cc.isValid(app.pages[this.currentPageData.page].instance.node)&&app.pages[this.currentPageData.page].instance.onClose(),this._super()}});i.refreshRed=function(e){for(var t=!1,i=0;i<a.length;i++){var n=a[i],r=app.db.checkFuncUnLock(n.funcId),o=app.db.checkChannelShow(n.funcId);if(n.page&&app.pages[n.page]&&app.pages[n.page].refreshRed&&r&&o&&(t=app.pages[n.page].refreshRed()),t)break}return e&&(e.active=t),t},cc._RF.pop()},{basePage:void 0}],propbagPage:[function(e,t){"use strict";cc._RF.push(t,"64deaPwbSZBYKtnVqcycjQ2","propbagPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"propbagpage"},properties:{p_tabvPropBag:cc.Node,p_tabvChipBag:cc.Node,p_btnTreas:cc.Button,p_nodeCampMenu:cc.Node},onLoad:function(){a.instance=this,this.node.getComponent("menu").init(this),this.p_nodeCampMenu.getComponent("campMenu").init(this),this.stopBgNodeEvent(),this.fitTopMenu(45),this.handleUI(),this.creatMask()},handleUI:function(){this._super(),this.p_btnTreas.node.on("click",function(){app.playSound("click"),app.pages.propbagtreasurehandbookpage.showPage()})},setParam:function(e){e||0==e||(e=1),this.refershData(),this.node.getComponent("menu").setMenuIndex(e)},refershData:function(){this.setData()},refreshMenuRed:function(e){var t=!1;switch(e){case 0:break;case 1:for(var a=0;a<this.m_arrProp.length&&!t;a++)"reap"==app.db.getTypeByGsid(this.m_arrProp[a].gsid)&&(t=!0);break;case 2:t=!1;break;case 3:for(var i=0;i<this.m_arrChip.length;i++)if(!t){var n=app.db.getPropsInfoByGsid(this.m_arrChip[i].gsid);if(!n||!n.CHIP)break;if(this.m_arrChip[i].count>=n.CHIP){t=!0;break}}this.m_arrChip}return t},menuHandler:function(e){var t=2===e&&this.m_numShowMenuIndex===e;return this.m_numShowMenuIndex=e,this.p_btnTreas.node.active=0==e,this.p_nodeCampMenu.active=2==e,this.setViewSize(e),this.refreshView(e,t),this.node.getComponent("menu").refreshRed(),!0},campMenuHandler:function(e,t){var a=this;if(void 0===t&&(t=!1),2!=this.m_numShowMenuIndex)return!1;for(var i=[],n=0;n<this.m_arrEquip.length;++n)if(0==e)app.db.getPropsInfoByGsid(this.m_arrEquip[n].gsid)&&i.push(this.m_arrEquip[n]);else{var r=app.db.getPropsInfoByGsid(this.m_arrEquip[n].gsid);r&&r.POS==e&&i.push(this.m_arrEquip[n])}return this.m_arrShowData=i,this.p_tabvPropBag.active=!0,this.p_tabvPropBag.opacity=255,this.p_tabvChipBag.active=!1,this.p_tabvChipBag.opacity=0,this.p_tabvPropBag.getComponent("tableView").initTableView(i.length,{array:this.m_arrShowData,isPropBag:!0,target:this},function(){cc.isValid(a)&&a.p_tabvPropBag.getComponent("tableView").getCells(function(e){app.playGridListAction(e)})}),!0},setViewSize:function(e){cc.winSize.height/cc.winSize.width>2e3/1080?2==e||0==e?(this.p_tabvPropBag.getComponent(cc.Widget).top=120,this.p_tabvPropBag.getComponent(cc.Widget).bottom=153):1==e?(this.p_tabvPropBag.getComponent(cc.Widget).top=120,this.p_tabvPropBag.getComponent(cc.Widget).bottom=50):(this.p_tabvChipBag.getComponent(cc.Widget).top=120,this.p_tabvChipBag.getComponent(cc.Widget).bottom=50):2==e||0==e?(this.p_tabvPropBag.getComponent(cc.Widget).top=80,this.p_tabvPropBag.getComponent(cc.Widget).bottom=153):1==e?(this.p_tabvPropBag.getComponent(cc.Widget).top=80,this.p_tabvPropBag.getComponent(cc.Widget).bottom=50):(this.p_tabvChipBag.getComponent(cc.Widget).top=80,this.p_tabvChipBag.getComponent(cc.Widget).bottom=50),this.p_tabvPropBag.getComponent(cc.Widget).updateAlignment()},refreshView:function(e,t){var a=this;switch(e){case 0:this.m_arrShowData=this.m_arrTreas;break;case 1:this.m_arrShowData=this.m_arrProp;break;case 2:this.p_nodeCampMenu.getComponent("campMenu").setMenuIndex(0,t);break;case 3:this.m_arrShowData=this.m_arrChip;break;default:this.m_arrShowData=[]}if(2!=e){var i=this.m_arrShowData.length;3==e?(this.p_tabvPropBag.active=!1,this.p_tabvPropBag.opacity=0,this.p_tabvChipBag.active=!0,this.p_tabvChipBag.opacity=255,this.p_tabvChipBag.getComponent("tableView").initTableView(i,{array:this.m_arrShowData,isChipBag:!0,target:this},function(){cc.isValid(a)&&a.p_tabvChipBag.getComponent("tableView").getCells(function(e){app.playGridListAction(e)})})):(this.p_tabvPropBag.active=!0,this.p_tabvPropBag.opacity=255,this.p_tabvChipBag.active=!1,this.p_tabvChipBag.opacity=0,this.p_tabvPropBag.getComponent("tableView").initTableView(i,{array:this.m_arrShowData,isPropBag:!0,target:this},function(){cc.isValid(a)&&a.p_tabvPropBag.getComponent("tableView").getCells(function(e){app.playGridListAction(e)})}))}},setData:function(){this.m_arrProp=[],this.m_arrEquip=[],this.m_arrTreas=[];var e=[],t=[],a=[],i=[];for(var n in app.player.props){var r=app.player.props[n].gsid?app.player.props[n].gsid:n,o={gsid:n,count:app.player.props[n].count};if(o.count||24==n.length)switch(app.db.getTypeByGsid(r)){case"prop":case"skinchip":var s=app.db.getPropsInfoByGsid(n);s&&!s.HIDE&&this.m_arrProp.push(o);break;case"box":case"rbox":case"cbox":case"crbox":case"reap":this.m_arrProp.push(o);break;case"equip":if(33990==n||33991==n){this.m_arrProp.push(o);break}o.tips=3,this.m_arrEquip.push(o);break;case"treas":o.tips=3,o.upcb=function(){app.pages.propbagpage.instance.refershData(),app.pages.propbagpage.instance.refreshView(0)},this.m_arrTreas.push(o);break;case"generalchip":case"grandomchip":var p=app.db.getPropsInfoByGsid(n);if(!p||!p.CHIP)break;o.count>=p.CHIP?e.push(o):t.push(o);break;case"treaschip":case"trandomchip":var c=app.db.getPropsInfoByGsid(n);if(!c||!c.CHIP)break;o.count>=c.CHIP?a.push(o):i.push(o)}}e.sort(function(e,t){var a=app.db.getPropsInfoByGsid(e.gsid).QUALITY||1,i=app.db.getPropsInfoByGsid(t.gsid).QUALITY||1,n=app.db.getPropsInfoByGsid(e.gsid).STAR||1,r=app.db.getPropsInfoByGsid(t.gsid).STAR||1;return a!=i?i-a:n!=r?r-n:e.gsid-t.gsid}),this.m_arrEquip.sort(function(e,t){var a=1,i=1;return app.db.getPropsInfoByGsid(e.gsid)?a=app.db.getPropsInfoByGsid(e.gsid).QUALITY||1:cc.log(e.gsid),app.db.getPropsInfoByGsid(t.gsid)?i=app.db.getPropsInfoByGsid(t.gsid).QUALITY||1:cc.log(t.gsid),a<i?1:a==i&&e.gsid<t.gsid?1:-1}),this.m_arrChip=e.concat(a).concat(t).concat(i),cc.log(this.m_arrTreas)},itemPorpClick:function(e){var t=2===this.m_numShowMenuIndex?this.m_arrEquip:this.m_arrShowData;if(!t[e])return!1;var a={};if(t[e].gsid.length>5){var i=app.player.treas[t[e].gsid];a.guid=i.guid,a.gsid=i.gsid,a.count=1}else a=t[e];return app.showPropTips(a,function(){app.pages.propbagpage.instance.refershData(),app.pages.propbagpage.instance.refreshView(app.pages.propbagpage.instance.m_numShowMenuIndex),app.pages.propbagpage.instance.node.getComponent("menu").refreshRed()}),!1},onClose:function(){cc.isValid(this.node)&&this.node.active&&(--app.numPrefabZindex,app.popPage(),cc.director.emit("page_close_end"),this.node.active=!1)}});a.refreshRed=function(e){var t=!1;for(var a in app.player.props){var i={gsid:a,count:app.player.props[a].count};if(i.count)switch(app.db.getTypeByGsid(a)){case"generalchip":case"grandomchip":case"treaschip":case"trandomchip":var n=app.db.getPropsInfoByGsid(a);if(!n||!n.CHIP)break;i.count>=n.CHIP&&(t||(t=!0));break;case"reap":t||(t=!0)}}return e&&(e.active=t),t},cc._RF.pop()},{basePage:void 0}],propbagTreasureHandbookPage:[function(e,t){"use strict";cc._RF.push(t,"fdbd20XF5xL6rwS96PlWPZb","propbagTreasureHandbookPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"propbagtreasurehandbookpage",pageType:1},properties:{p_tabvTreas:cc.Node,p_arrBtnChoose:[cc.Node],p_arrBtnChoosePick:[cc.Node]},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){var e=this;this._super(),this.p_arrBtnChoose.forEach(function(t,a){t.on("touchend",function(){e.onClickBtnChoose(a+1)})})},setParam:function(e){e||(e=0),this.refreshUI(e)},refreshUI:function(e){this.onClickBtnChoose(e)},refreshData:function(){},refreshView:function(){var e=this.m_arrShowData.length;this.p_tabvTreas.getComponent("tableView").initTableView(e,{array:this.m_arrShowData,target:this})},onClickBtnChoose:function(e){cc.log("now click type index: ",e),this.m_numShowTpye==e&&(e=0),this.m_numShowTpye=e,this.p_arrBtnChoosePick.forEach(function(t,a){t.active=a+1==e}),this.m_arrShowData=this.setData(),this.refreshView()},setData:function(){var e=[],t=app.db.dbTreasure,a=app.db.dbTreasureBook;for(var i in t){var n=t[i];if("34000"!=i){var r={gsid:i,type:"treas",quality:n.QUALITY};a.indexOf(Number(i))<0||(this.m_numShowTpye&&0!=this.m_numShowTpye?n.QUALITY==this.m_numShowTpye?e.push(r):7==n.QUALITY&&6==this.m_numShowTpye&&e.push(r):e.push(r))}}return e.sort(function(e,t){return e.quality>t.quality?1:e.quality==t.quality&&e.gsid>t.gsid?1:-1}),cc.log("now showdata is ",e),e},itemPorpClick:function(e){if(!this.m_arrShowData[e])return!1;var t=this.m_arrShowData[e];return app.showPropTips(t),!1},onClose:function(){this._super()}});cc._RF.pop()},{basePage:void 0}],pvpBuyTicketPage:[function(e,t){"use strict";cc._RF.push(t,"0311c0lrphLho4pHHv+w/lG","pvpBuyTicketPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"pvpbuyticketpage",pageType:1},properties:{p_pfbPropItem:cc.Prefab,p_nodePropContent:cc.Node,_mPropItem:null,p_labCoin:cc.Label,p_btnConfirm:cc.Button,p_sprIcon:cc.Sprite,p_sprBtnIcon:cc.Sprite},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this._buyNum=5},handleUI:function(){var e=this;this._super(),this.p_btnConfirm.node.on("click",function(){e.onClickConfirm()})},onClickConfirm:function(){this.onClose(),this._data.confirmcb&&this._data.confirmcb.call(this._data.target,this._buyNum)},setParam:function(e){this._data=e,e._buyNum&&(this._buyNum=e._buyNum),this.refreshUI()},refreshUI:function(){var e={gsid:this._data.gsid,count:this._buyNum};cc.isValid(this._mPropItem)||(this._mPropItem=cc.instantiate(this.p_pfbPropItem),this.p_nodePropContent.addChild(this._mPropItem),this._mPropItem.setPosition(cc.Vec2.ZERO)),this._mPropItem.getComponent("propItem").initForBag(e),this.p_labCoin.string=app.player.getCount(this._data.coin),app.loadTexture(app.db.getPropsIconPath(38005),this.p_sprIcon,this.prefabPath),app.loadTexture(app.db.getPropsIconPath(38005),this.p_sprBtnIcon,this.prefabPath)}});cc._RF.pop()},{basePage:void 0}],pvpChampionPage:[function(e,t){"use strict";cc._RF.push(t,"eb07ebVh2BJLowqGEHFix3a","pvpChampionPage"),cc.Class({extends:cc.Component,properties:{},start:function(){}}),cc._RF.pop()},{}],pvpCrossServicePage:[function(e,t){"use strict";cc._RF.push(t,"a3e35M78QVCQr1lqOGIX2W2","pvpCrossServicePage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"pvpcrossservicepage"},properties:{p_nodeGate:cc.Node,p_nodeSelfLayout:cc.Node,p_nodeLayout:cc.Node,p_btnCrossService:cc.Button,p_btnRank:cc.Button,p_btnTips:cc.Button},onLoad:function(){a.instance=this,this._arrSelfItems=[],this._arrItems=[],this._arrSelfItems.push(this.p_nodeGate),this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){this._super(),this.p_btnCrossService.node.on("click",function(){app.playSound("click"),app.pages.pvpentrancepage.showPage(null,app.mainScene.p_nodeBg)}),this.p_btnRank.node.on("click",function(){app.playSound("click"),app.pages.rankmainpage.showPage(1,app.mainScene.p_nodeBg)}),this.p_btnTips.node.on("click",function(){app.playSound("click"),app.pages.windowspagetipshelp.showPage("\u8de8\u670d\u4e89\u9738",app.mainScene.p_nodeBg)})},setParam:function(e){this._serverData=e.list,this.refreshUI()},refreshUI:function(){for(var e=null,t=0;t<this._serverData.length;++t)if(this._serverData[t].servid==app.player.servid){e=this._serverData[t],this._serverData.splice(t,1);break}e&&(e.bSelf=!0,this._serverData.unshift(e));for(var a=0,i=this._serverData.length>5?2:1;a<i;++a){var n=this._arrSelfItems[a];n||(n=cc.instantiate(this.p_nodeGate),this._arrSelfItems.push(n),n.setParent(this.p_nodeSelfLayout)),n.active=!0,n.getComponent("pvpCrossServiceItem").refreshUI(this._serverData[a])}for(var r=a;r<this._arrSelfItems.length;++r)this._arrSelfItems[r].active=!1;for(var o=a,s=0;o<this._serverData.length;++o,++s){var p=this._arrItems[s];p||(p=cc.instantiate(this.p_nodeGate),this._arrItems.push(p),p.setParent(this.p_nodeLayout)),p.active=!0,p.getComponent("pvpCrossServiceItem").refreshUI(this._serverData[o])}for(var c=s;c<this._arrItems.length;++c)this._arrItems[c].active=!1},onClose:function(){this._super()}});a.showPage=function(t,a,i){var n=this;app.player.sfCsGetServinfo(function(t,a){if(t)app.showNotice(t);else if(app.crossServGroupInfo=a,a.list.length<=1){var r,o=a.opentime+24192e5,s=app.seasonData.info.etime+6048e5*(gConfig.CLOSESEASON-app.seasonData.info.season),p=app.player.getServerTime();r=s<o?s+24192e5-p:s-p;var c=gUtils.getDayHourMinSecTime(r);app.showNotice(langMgr.getString("pvpCrossServicePage",8,c[0]+1))}else e("basePage").showPage.call(n,a,app.mainScene.p_nodeBg,i)})},cc._RF.pop()},{basePage:void 0}],pvpEntrancePage:[function(e,t){"use strict";cc._RF.push(t,"8c27c7xDbhDCqt+7RsoDRh6","pvpEntrancePage");var a=["PVP_TEAM","PVP_KING","PVP_SUMMIT"],i=cc.Class({extends:e("basePage"),statics:{prefabPath:"pvpentrancepage"},properties:{p_sprCompetition:cc.Sprite,p_sprTeampvp:cc.Sprite,p_sprKingpvp:cc.Sprite,p_sprSummitpvp:cc.Sprite,p_summitpvpTurn:cc.Node,p_labTurn:cc.Label,p_labCompetitionTips:cc.Label,p_labTeamTips:cc.Label,p_labKingTips:cc.Label,p_labSummitTips:cc.Label,p_labCompetitionTime:cc.Label,p_labTeamTime:cc.Label,p_labKingpvpTime:cc.Label,p_labSummitpvpTime:cc.Label,p_nodeTeamRank:cc.Node,p_nodeKingRank:cc.Node,p_nodeTeamUnlock:cc.Node,p_nodeKingUnlock:cc.Node,p_nodeSummitUnlock:cc.Node,p_sprTeamTitle:cc.Sprite,p_sprKingTitle:cc.Sprite,p_sprSummitTitle:cc.Sprite,p_nodeTeamTime:cc.Node,p_nodeKingTime:cc.Node,p_nodeSummitTime:cc.Node,p_nodePvpSystem:[cc.Node],p_btnTest:cc.Button},onLoad:function(){i.instance=this,this._super(),this.fitTopMenu(),app._bTpOpen||(app._bTpOpen=!1),this._bTpEnter=!1,this._bKpOpen=!1,this._bKpSeasonQuery=!1},onEnable:function(){this._super(),eventMgr.on(eventStr.redEvent.RefreshPVPEntranceRed,this.refreshUI,this),eventMgr.on(eventStr.commonEvent.RefreshTime,this.refreshTime,this),eventMgr.on(eventStr.commonEvent.RefreshTime,this.refreshTpTime,this),eventMgr.on(eventStr.commonEvent.RefreshTime,this.refreshKpTime,this),"9001"!=app.player.servid&&eventMgr.on(eventStr.commonEvent.RefreshTime,this.refreshSpTime,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.redEvent.RefreshPVPEntranceRed,this.refreshUI,this),eventMgr.off(eventStr.commonEvent.RefreshTime,this.refreshTime,this),eventMgr.off(eventStr.commonEvent.RefreshTime,this.refreshTpTime,this),eventMgr.off(eventStr.commonEvent.RefreshTime,this.refreshKpTime,this),"9001"!=app.player.servid&&eventMgr.off(eventStr.commonEvent.RefreshTime,this.refreshSpTime,this)},handleUI:function(){var e=this;this._super(),this.p_sprCompetition.node.on("touchend",function(){app.playSound("click"),e.competitionOnTouch()},this),this.p_sprTeampvp.node.on("touchend",function(){app.playSound("click"),app.db.checkFuncUnLock("PVP_TEAM",!0)&&e.teampvpOnTouch()},this),this.p_sprKingpvp.node.on("touchend",function(){app.playSound("click"),app.db.checkFuncUnLock("PVP_KING",!0)&&e.kingpvpOnTouch()},this),this.p_sprSummitpvp.node.on("touchend",function(){app.playSound("click"),app.db.checkFuncUnLock("PVP_SUMMIT",!0)&&e.summitpvpOnTouch()},this),this.p_btnTest.node.active="dev"==gSetting.channel,this.p_btnTest.node.on("click",function(){cc.director.loadScene("scenes_test")})},competitionOnTouch:function(){var e=!0,t=app.player.getServerTime(),a=new Date(t),i=a.getDay();if(4==i?e=t<a.setHours(23,0,0,0):5==i&&(e=t>a.setHours(0,5,0,0)),e)if(app.db.checkBattleArrTeam("pvpdef")&&app.db.checkGeneralExist("pvpdef"))app.pages.pvppage.showPage();else{var n={content:langMgr.getString("pvpEntrancePage",13),confirmcb:function(){app.battleType="pvpdef",app.goToNormBattle()},target:this};app.pages.windowspagetipsmsg.showPage(n)}else app.showNotice(langMgr.getString("pvpEntrancePage",8))},teampvpOnTouch:function(){if(app._bTpOpen)if(app.db.checkBattleArrTeam("teampvp")&&app.db.checkGeneralExist("teampvp"))app.pages.teampvppage.showPage();else{var e={content:langMgr.getString("pvpEntrancePage",14),confirmcb:function(){app.battleType="teampvp",app.goToNormBattle()},target:this};app.pages.windowspagetipsmsg.showPage(e)}else this._bTpEnter?app.pages.teampvppage.showPage():app.showNotice(langMgr.getString("pvpEntrancePage",9))},kingpvpOnTouch:function(){if(!this._bKpOpen||app.db.checkBattleArrTeam("kingpvp1")&&app.db.checkGeneralExist("kingpvp1"))app.pages.kingpvppage.showPage();else{var e={content:langMgr.getString("pvpEntrancePage",15),confirmcb:function(){app.battleType="kingpvpsave",app.goToNormBattle()},target:this};app.pages.windowspagetipsmsg.showPage(e)}},summitpvpOnTouch:function(){app.lockFunConfig&&app.lockFunConfig.checkPreFuncByKey("PVP_SUMMIT")?app.pages.prepagesummitpvp.showPage():app.pages.summitpvppage.dealData(function(){var e=app.pages.summitpvppage.getSummitPvpState();if(-1==e.state)app.pages.summitpvppage.showPage();else if(1==e.type){if(new Date(app.player.getServerTime()).getHours()<6)return void app.showNotice(langMgr.getString("pvpEntrancePage",12));if(1!=app.summitPvpInfo.type)return void app.showNotice(langMgr.getString("pvpEntrancePage",10));if(app.summitPvpInfo.seadata.length<=0)return void app.showNotice(langMgr.getString("pvpEntrancePage",11));app.pages.summitpvpprepage.showPage()}else app.pages.summitpvppage.showPage()},!0,!0)},refreshPvpEntrItem:function(e){var t=gConfig.PVPSYSTEM.indexOf(gConfig.PVPTYPE[e]);this.p_nodePvpSystem[t].getComponent("pvpEntranceItem").refreshUI(gConfig.PVPSYSTEM[t],app.PVPRANKDATA[gConfig.PVPTYPE[e]])},refreshRankData:function(e){var t=this;e>=gConfig.PVPTYPE.length||(!app.PVPRANKDATA[gConfig.PVPTYPE[e]]||Date.now()>app.PVPRANKDATA[gConfig.PVPTYPE[e]].time+gConfig.RANK_REFRESH_TIME?app.player.sfRankByType(gConfig.PVPTYPE[e],function(a,i){cc.isValid(t.node)&&(a&&(i={list:[]}),cc.isValid(t)&&(app.PVPRANKDATA[gConfig.PVPTYPE[e]]=i,app.PVPRANKDATA[gConfig.PVPTYPE[e]].time=Date.now(),t.refreshPvpEntrItem(e),t.refreshRankData(e+1)))}):(this.refreshPvpEntrItem(e),this.refreshRankData(e+1)))},refreshSelfInfo:function(){var e=this;this.refreshRankData(0);for(var t=!1,a=0;a<gConfig.KPLINEUP.length;++a)t=t||app.db.checkBattleArrTeam(gConfig.KPLINEUP[a]);var i=gConfig.PVPSYSTEM.indexOf("king");if(t){var n={uid:app.player.uid,servid:app.player.servid};app.player.sfKpStageInfo(n,function(t,a){cc.isValid(e)&&(t&&(a=null),app.KPSTAGEINFO=a,e.p_nodePvpSystem[i].getComponent("pvpEntranceItem").refreshUI(gConfig.PVPSYSTEM[i],a))})}else this.p_nodePvpSystem[i].getComponent("pvpEntranceItem").refreshUI(gConfig.PVPSYSTEM[i],null)},setParam:function(){var e=this;app.PVPOPENTIME?this.refreshUI():app.player.sfPvpOpentime(function(t,a){app.PVPOPENTIME=a,cc.isValid(e)&&e.refreshUI()}),this.refreshSelfInfo(),app.crossServGroupInfo&&app.getCrossServGroupInfo(),app.runUnlockGuide("PVP")},refreshUI:function(){this.checkTypeIsUnlock(),this.refreshEntranceUI(),app.pages.pvppage.refreshRed(this.p_sprCompetition.node.getChildByName("rednotice")),app.pages.teampvppage.refreshRed(this.p_sprTeampvp.node.getChildByName("rednotice")),app.pages.kingpvppage.refreshRed(this.p_sprKingpvp.node.getChildByName("rednotice")),this.refreshTime(),this.refreshTpTime(),this.refreshKpTime(),this.refreshSpTime()},checkTypeIsUnlock:function(){this._bLock={};for(var e=0;e<a.length;++e)this._bLock[a[e]]=!app.db.checkFuncUnLock(a[e],!1);var t=app.player.getServerTime(),i=new Date(t).getDay();app.PVPOPENTIME.teampvp.open.indexOf(i)>=0?app._bTpOpen=!0:(app._bTpOpen=!1,app.PVPOPENTIME.teampvp.enter.indexOf(i)>=0?this._bTpEnter=!0:this._bTpEnter=!1);var n=app.pages.kingpvppage.getKingPvpState();this._bKpOpen=!(0==n.state)},refreshEntranceUI:function(){for(var e={PVP_TEAM:{labtip:"p_labTeamTips",labtime:"p_labTeamTime",spricon:"p_sprTeampvp",sprtitle:"p_sprTeamTitle",hidenode:"p_nodeTeamRank",unlocknode:"p_nodeTeamUnlock",timenode:"p_nodeTeamTime"},PVP_KING:{labtip:"p_labKingTips",labtime:"p_labKingpvpTime",spricon:"p_sprKingpvp",sprtitle:"p_sprKingTitle",hidenode:"p_nodeKingRank",unlocknode:"p_nodeKingUnlock",timenode:"p_nodeKingTime"},PVP_SUMMIT:{labtip:"p_labSummitTips",labtime:"p_labSummitpvpTime",spricon:"p_sprSummitpvp",sprtitle:"p_sprSummitTitle",unlocknode:"p_nodeSummitUnlock",timenode:"p_nodeSummitTime"}},t=0;t<a.length;++t){var i=this._bLock[a[t]],n=e[a[t]];if(i){if(app.setSpriteState(this[n.spricon],!0),app.setSpriteState(this[n.sprtitle],!0),this[n.labtip]&&(this[n.labtip].string=langMgr.getString("pvpEntrancePage",0)),this[n.labtime]&&(this[n.labtime].node.active=!1),this[n.nodeover]&&(this[n.nodeover].active=!1),this[n.hidenode]&&(this[n.hidenode].active=!1),this[n.timenode]&&(this[n.timenode].active=!1),this[n.unlocknode]){this[n.unlocknode].active=!0;var r=this[n.unlocknode].getChildByName("unlock"),o=this[n.unlocknode].getChildByName("unOpen");r.active=!0;var s=app.db.dbFuncLock[a[t]];r.getChildByName("lockLevel").getComponent(cc.Label).string=langMgr.getString("pvpEntrancePage",16,s.LEVEL),o.active=!1}"PVP_SUMMIT"==a[t]&&(this.p_summitpvpTurn.active=!1)}else app.setSpriteState(this[n.spricon],!1),app.setSpriteState(this[n.sprtitle],!1),this[n.hidenode]&&(this[n.hidenode].active=!0),this[n.unlocknode]&&(this[n.unlocknode].active=!1),this[n.timenode]&&(this[n.timenode].active=!0),"PVP_SUMMIT"!=a[t]||app.lockFunConfig&&app.lockFunConfig.checkPreFuncByKey("PVP_SUMMIT")||(this.p_summitpvpTurn.active=!0)}},refreshTpTime:function(){if(!this._bLock.PVP_TEAM&&app.PVPOPENTIME&&app.PVPOPENTIME.teampvp){var e=app.player.getServerTime(),t=new Date(e).getDay(),a=app.PVPOPENTIME.teampvp.open.indexOf(t);if(app.PVPOPENTIME.teampvp.open.lenth>=7)this.p_labTeamTime.string=langMgr.getString("pvpEntrancePage",1),this.p_labTeamTips.string=langMgr.getString("pvpEntrancePage",2);else{var i=(t+1)%7,n=1;if(a>=0){for(this.p_nodeTeamUnlock.active=!1,this.p_nodeTeamRank.active=!0;app.PVPOPENTIME.teampvp.open.indexOf(i)>=0;)i=(i+1)%7,n++;this.p_labTeamTips.string=langMgr.getString("pvpEntrancePage",3)}else{for(;app.PVPOPENTIME.teampvp.open.indexOf(i)<0;)i=(i+1)%7,n++;this.p_labTeamTips.string=langMgr.getString("pvpEntrancePage",4),this.p_nodeTeamRank.active=!1,this.p_nodeTeamUnlock.active=!0,this.p_nodeTeamUnlock.getChildByName("unlock").active=!1,this.p_nodeTeamUnlock.getChildByName("unOpen").active=!0}var r=gUtils.getTimeByDay(e,n)-e;this.p_labTeamTime.string=gUtils.getCountDownStr(r)}}},refreshTime:function(){var e=!0,t=0,a=app.player.getServerTime(),i=new Date(a),n=i.getDay();4==n?e=a<i.setHours(23,0,0,0):5==n&&(e=a>i.setHours(0,5,0,0)),t=e?app.player.getTimeDay(23,0,0,0,4)-a:app.player.getTimeDay(0,5,0,0,5)-a,this.p_labCompetitionTips.string=e?langMgr.getString("pvpEntrancePage",3):langMgr.getString("pvpEntrancePage",4),this.p_labCompetitionTime.string=gUtils.getCountDownStr(t)},refreshKpTime:function(){if(!this._bLock.PVP_KING&&app.PVPOPENTIME&&app.PVPOPENTIME.kingpvp){var e=app.pages.kingpvppage.getKingPvpState();2==e.state?(this.p_labKingpvpTime.string=langMgr.getString("pvpEntrancePage",1),this.p_labKingTips.string=langMgr.getString("pvpEntrancePage",2)):1==e.state?(this.p_labKingTips.string=langMgr.getString("pvpEntrancePage",3),this.p_nodeKingUnlock.active=!1,this.p_nodeKingRank.active=!0):(this.p_labKingTips.string=langMgr.getString("pvpEntrancePage",4),this.p_nodeKingRank.active=!1,this.p_nodeKingUnlock.active=!0,this.p_nodeKingUnlock.getChildByName("unlock").active=!1,this.p_nodeKingUnlock.getChildByName("unOpen").active=!0),this.p_labKingpvpTime.string=gUtils.getCountDownStr(e.totalTime)}},refreshSpTime:function(){var e=this;if(!this._bLock.PVP_SUMMIT){if(app.lockFunConfig&&app.lockFunConfig.checkPreFuncByKey("PVP_SUMMIT"))return this.p_labSummitTips.string=langMgr.getString("pvpEntrancePage",4),void(this.p_labSummitpvpTime.string=gUtils.getCountDownStr(app.lockFunConfig.getPreCountDownByKey("PVP_SUMMIT")));if(app.PVPOPENTIME&&app.PVPOPENTIME.summitpvp){var t=app.player.getServerTime();if(app.seasonData.info.season,app.seasonData.info.etime-t<0){if(this._bSpSeasonQuery)return;return this._bSpSeasonQuery=!0,void app.refreshSeason(this,function(){e._bSpSeasonQuery=!1,e.refreshSpTime()})}this.p_nodeSummitUnlock.active=!app.pages.summitpvppage.isOpen(),app.pages.summitpvppage.isOpen()||(this.p_nodeSummitUnlock.getChildByName("unlock").active=!1,this.p_nodeSummitUnlock.getChildByName("unOpen").active=!0);var a=app.pages.summitpvppage.getSummitPvpState();switch(this.p_labTurn.string=gConfig.getSummitpvpTurnNameByType(a.type,a.turn),this.p_summitpvpTurn.active=!0,a.state){case-1:this.p_labSummitTips.string=langMgr.getString("pvpEntrancePage",5),this.p_labSummitpvpTime.string=gUtils.getCountDownStr(a.time),this.p_summitpvpTurn.active=!1;break;case 1:case 2:this.p_labSummitTips.string=langMgr.getString("pvpEntrancePage",6),this.p_labSummitpvpTime.string=gUtils.getCountDownStr(a.time);break;case 3:this.p_labSummitTips.string=langMgr.getString("pvpEntrancePage",7),this.p_labSummitpvpTime.string="00:00:00"}}}},onClose:function(){this._super()}});i.refreshRed=function(e){var t=app.pages.pvppage.refreshRed()||app.pages.teampvppage.refreshRed()||app.pages.kingpvppage.refreshRed()||app.pages.summitpvppage.refreshRed();return e&&(e.active=t),t},i.checkKingPvpOpen=function(e){return app.PVPOPENTIME&&app.PVPOPENTIME.kingpvp?app.pages.kingpvppage.getKingPvpState().state>0:(e&&e(),!1)},i.checkTeamPvpOpen=function(e){var t=app.player.getServerTime(),a=new Date(t).getDay();return app.PVPOPENTIME&&app.PVPOPENTIME.teampvp?app.PVPOPENTIME.teampvp.open.indexOf(a)>=0:(e&&e(),!1)},i.checkSummitPvpOpen=function(){if(app.seasonData&&app.seasonData.info&&app.seasonData.info.season){if(4==app.seasonData.info.season){var e=app.player.getServerTime();return app.seasonData.info.etime-e<6048e5}return!1}return!1},cc._RF.pop()},{basePage:void 0}],pvpMatchPage:[function(e,t){"use strict";cc._RF.push(t,"568d72DhxdOz7lR+sV18RRi","pvpMatchPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"pvpmatchpage",pageType:1},properties:{p_labMoney:cc.Label,p_nodeContent:cc.Node,p_prefbItem:cc.Prefab,p_btnRfresh:cc.Button,p_btnAdd:cc.Button,p_nodeCheck:cc.Node,p_nodeQuickFight:cc.Node,p_spFightWin:sp.Skeleton,p_spFightLose:sp.Skeleton,p_nodeQuickUI:cc.Node,p_labRingTip:cc.Label},onLoad:function(){a.instance=this,this._super(),this.creatMask(!0,50),this.stopBgNodeEvent(),this._btnTime=0,this._arrItems=[];var e=localDataUtils.GetValue("bQuickPvpFight_"+app.player.id,null);this._bQuickFight=null!=e&&1==e},onEnable:function(){eventMgr.on(eventStr.ringPvp.REFRESH_CHALLENGE_LIST,this.refreshAll,this)},onDisable:function(){eventMgr.off(eventStr.ringPvp.REFRESH_CHALLENGE_LIST,this.refreshAll,this)},handleUI:function(){var e=this;this._super(),this.p_btnAdd.node.on("click",function(){e.m_btnLock||(app.playSound("click"),app.getPvpInfoIng?app.showNotice(langMgr.getString("pvpMatchPage",0)):e.onClickPlus())}),this.p_btnRfresh.node.on("click",function(){e.m_btnLock||(app.playSound("click"),app.getPvpInfoIng?app.showNotice(langMgr.getString("pvpMatchPage",0)):(e._btnTime=3,e.p_btnRfresh.interactable=!1,"ringpvp"===e._type?e.queryOpponentInfoList():e.refreshAgainst(1)))}),this.p_nodeQuickFight.on("touchend",function(){e.m_btnLock||(app.playSound("click"),e.p_nodeCheck.active=!e._bQuickFight,e._bQuickFight=!e._bQuickFight,localDataUtils.GetValue("bQuickPvpFight_"+app.player.id,null),localDataUtils.SetValue("bQuickPvpFight_"+app.player.id,e._bQuickFight))})},setParam:function(e){this._type=e.type,this.p_spFightWin.node.active=!1,this.p_spFightLose.node.active=!1,this.m_btnLock=!1,this.refreshUI(),"ringpvp"===this._type?this.queryOpponentInfoList():this.refreshAgainst(1)},afterBattleFresh:function(){this.refreshAll(),app.pages.pvppage.instance&&cc.isValid(app.pages.pvppage.instance.node)&&app.pages.pvppage.instance.refreshRed(),eventMgr.emit(eventStr.redEvent.RefreshPVPEntranceRed),eventMgr.emit(eventStr.redEvent.RefreshNewWorldRed)},afterQuickBattleFresh:function(e){var t=this,a="win"==e.result.ret?this.p_spFightWin:this.p_spFightLose,i=(e.result.ret,"effect");a.node.active=!0,this.m_btnLock=!0,this.p_bgNode.active=!1,a.setAnimation(0,i,!1),app.player.sfPlayerData(function(){t.afterBattleFresh(),app.pages.pvppage.instance&&cc.isValid(app.pages.pvppage.instance.node)&&app.pages.pvppage.instance.afterBattleFresh()}),a.setEndListener(function(){t.m_btnLock=!1,a.node.active=!1,t.p_bgNode.active=!0,e.reward&&(app.battleType=null,app.pages.windowspageturn.showPage(e.reward))})},refreshAll:function(){this.refreshUI(),this._btnTime=3,this.p_btnRfresh.interactable=!1,"ringpvp"===this._type?this.queryOpponentInfoList():this.refreshAgainst(1)},refreshUI:function(){this.p_labMoney.string=app.player.getCount(30028),this.p_nodeCheck.active=this._bQuickFight,this.p_nodeQuickUI.active=!1,this.p_labRingTip.node.opacity="ringpvp"!==this._type?0:255,this.p_bgNode.height="ringpvp"!==this._type?740:720},refreshAgainst:function(e){var t=this;app.getPvpInfoIng=!0,app.player.sfGetPvpAgainst(e,function(e,a){if(e)return app.getPvpInfoIng=!1,"no targets"==e&&app.showNotice(langMgr.getString("pvpMatchPage",1)),cc.log(e),void t.clearEnemyItems();var i={pvpdef:1};i.rids=a,app.player.sfGetRolesInfo(i,function(e){if(cc.isValid(t.node,!0)){for(var i=0;i<e.length;++i){var n=t._arrItems[i];n||((n=cc.instantiate(t.p_prefbItem)).setParent(t.p_nodeContent),t._arrItems.push(n)),n.active=!0,n.getComponent("pvpEnemyItem").initUI(i,a[i],e[i],t)}app.getPvpInfoIng=!1}})})},clearEnemyItems:function(){for(var e=0;e<this._arrItems.length;++e)this._arrItems[e].active=!1},refreshBtnTime:function(){this._btnTime<=0&&(this.p_btnRfresh.interactable=!0)},onClickPlus:function(){var e={gsid:30028,coin:38005,confirmcb:this.buyCb,target:this};app.pages.pvpbuyticketpage.showPage(e)},buyCb:function(e){var t=this;app.player.getCount(38005)<20*e?app.showNotice(langMgr.getString("pvpMatchPage",2)):app.player.sfExchange("pvpcoin",e,0,function(){app.showNotice(langMgr.getString("pvpMatchPage",3)),t.refreshUI()})},update:function(e){this._btnTime>0&&(this._btnTime-=e,this.refreshBtnTime())},onClose:function(){this.m_btnLock||this._super()},queryOpponentInfoList:function(){var e=this;app.getPvpInfoIng=!0,app.player.sfRingMatchOppo().then(function(t){if(app.getPvpInfoIng=!1,cc.isValid(e))for(var a=0;a<(null!=(i=t.opponents)?i:[]).length;++a){var i,n=e._arrItems[a];cc.isValid(n)||((n=cc.instantiate(e.p_prefbItem)).setParent(e.p_nodeContent),e._arrItems.push(n)),n.active||(n.active=!0),n.getComponent("pvpEnemyItem").renderRingOpponent({index:a,opponent:t.opponents[a],target:e})}}).catch(function(t){cc.warn("\u64c2\u53f0\u8d5b\u5339\u914d\u5bf9\u624b\u5931\u8d25",t),"ring finished"===t&&(app.showNotice(langMgr.getString("windowsPageRingRank",1)),e.onClose()),app.getPvpInfoIng=!1,cc.isValid(e)&&e.clearEnemyItems()})}});cc._RF.pop()},{basePage:void 0}],pvpPage:[function(e,t){"use strict";cc._RF.push(t,"c7562Ue3HlIW7RdDdLjGi2R","pvpPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"pvppage"},properties:{p_nodeRule:cc.Node,p_nodeView:cc.Node,p_nodeSelf:cc.Node,p_labTimeTips:cc.Label,p_labTime:cc.Label,p_btnHelp:cc.Button,p_btnReward:cc.Button,p_btnMatch:cc.Button,p_matchRed:cc.Node,p_btnDef:cc.Button,p_btnRecord:cc.Button},onLoad:function(){a.instance=this,this._super(),this._time=0,this._btnTime=0,this.fitTopMenu(),this.refreshTime(),cc.isValid(this.p_nodeRule)&&(this.p_nodeRule.opacity=app.db.checkChannelShow("PALACE")?255:0)},handleUI:function(){var e=this;this._super(),this.p_btnDef.node.on("click",function(){app.playSound("click"),app.battleType="pvpdef",app.goToNormBattle()}),this.p_btnReward.node.on("click",function(){app.playSound("click"),app.pages.pvprewardpage.showPage()}),this.p_btnRecord.node.on("click",function(){app.playSound("click"),e.showRecord()}),this.p_btnHelp.node.on("click",function(){app.pages.windowspagetipshelp.showPage("1013")}),this.p_btnMatch.node.on("click",function(){app.playSound("click"),app.pages.pvpmatchpage.showPage({type:"pvp"})})},onEnable:function(){this._super(),eventMgr.on(eventStr.commonEvent.RefreshTime,this.refreshTime,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.commonEvent.RefreshTime,this.refreshTime,this)},setParam:function(){this.refreshUI()},afterBattleFresh:function(){var e=this;app.player.sfRankByType("pvp",function(t,a){app.PVPRANKDATA.pvp=a,a&&(app.PVPRANKDATA.pvp.time=Date.now()),e&&cc.isValid(e.node)&&(e.refreshUI(),eventMgr.emit(eventStr.redEvent.RefreshGroundRed))})},refreshUI:function(){a.setData();var e=app.PVPRANKDATA.pvp;this.p_nodeView.getComponent("tableView").initTableView(e.list.length,{array:e.list,target:this,isDefPvp:!0});var t={rname:app.player.rname,power:app.player.power,level:app.player.level,iconid:app.player.iconid,headid:app.player.headid,frameid:app.player.frameid,score:app.player.pvpscore,vip:app.player.vip,target:this};if(!this.p_nodeSelf.children[0]){var i=cc.instantiate(this.p_nodeView.getComponent("tableView").cell);this.p_nodeSelf.addChild(i),i.active=!0}this.p_nodeSelf.children[0].getComponent("pvpRankItem").refreshUI(e.selfrank,t),cc.isValid(this.p_nodeHead)&&this.p_nodeHead.getComponent("headItem").initFor({headid:app.player.headid,frameid:app.player.frameid,target:this}),this.refreshRed()},refreshRed:function(){this.p_matchRed.active=app.player.getCount(90151)<3},getRankInfo:function(e){this.p_labRank.string=app.PVPRANKDATA.pvp.selfrank||"500+",e&&e()},refreshRankTopThree:function(e){if(e)for(var t=0;t<3;++t)e[t]&&(e[t].target=this,this.p_arrRankTop[t].getComponent("teampvpPlayerPortraitItem").refreshUI(e[t]))},showRecord:function(){app.player.sfPvpRecords(function(e){app.pages.pvpreplaypage.showPage({videoList:e,type:0})})},refreshTime:function(){var e=!0,t=0,a=app.player.getServerTime(),i=new Date(a),n=i.getDay();4==n?e=a<i.setHours(23,0,0,0):5==n&&(e=a>i.setHours(0,5,0,0)),t=e?app.player.getTimeDay(23,0,0,0,4)-a:app.player.getTimeDay(0,5,0,0,5)-a,this.p_labTimeTips.string=e?langMgr.getString("pvpPage",0):langMgr.getString("pvpPage",1),this.p_labTime.string=gUtils.getCountDownStr(t)},refreshBtnTime:function(){this._btnTime>0?this.p_labBtnTime.string="("+Math.ceil(this._btnTime)+")":(this.p_labBtnTime.node.active=!1,this.p_labBtnTime.string=langMgr.getString("pvpPage",2),this.p_btnRfresh.interactable=!0,this.p_btnRfresh.node.getChildByName("pvp_tx").active=!0)},onClickPlus:function(){var e={gsid:30028,maxcount:Math.floor(app.player.getCount(38005)/20),coin:38005,price:20,type:"buy",confirmcb:this.buyCb,target:this};app.pages.windowspagesetnum.showPage(e)},buyCb:function(e){var t=this;app.player.sfExchange("pvpcoin",e,0,function(){app.showNotice(langMgr.getString("pvpPage",7)),t.refreshUI()})},refreshQuick:function(){this.p_btnQuick.node.active=app.player.level>=50,this.p_nodeChoose.active=!!this._bQuick},onSetQuick:function(){cc.sys.localStorage.setItem(app.player.id+"pvpatt",this._bQuick?0:1),this._bQuick=this._bQuick?0:1,this.refreshQuick()},update:function(e){this._btnTime>0&&(this._btnTime-=e,this.refreshBtnTime())},onDestroy:function(){app.rankInfo=null,app.rankTime=null,this._super()}});a.showPage=function(t,a,i){var n=this;app.PVPRANKDATA.pvp?e("basePage").showPage.call(this,t,a,i):app.player.sfRankByType("pvp",function(r,o){app.PVPRANKDATA.pvp=o,o&&(app.PVPRANKDATA.pvp.time=Date.now()),e("basePage").showPage.call(n,t,a,i)})},a.refreshRed=function(e){var t=app.player.getCount(90151)<3;return e&&(e.active=t),t},a.setData=function(){var e=app.PVPRANKDATA.pvp;if(e){var t,a=e.selfrank,i={frameid:app.player.frameid,headid:app.player.headid,iconid:app.player.iconid,level:app.player.level,power:app.player.power,rid:app.player.id,rname:app.player.rname,score:app.player.pvpscore};if(e.selfrank&&a<51){if(a>1&&e.list[a-2]&&app.player.pvpscore>e.list[a-2].score)for(var n=a-2;n>-1&&app.player.pvpscore>e.list[n].score;n--)t=n+1;else if(a<e.list.length-1&&e.list[a]&&app.player.pvpscore<e.list[a].score)for(var r=a;r<e.list.length-1&&app.player.pvpscore<e.list[r].score;r++)t=r+1;t?(e.list.splice(a-1,1),e.list.splice(t-1,0,i),e.selfrank=t):e.list[a-1]=i}else{for(var o=e.list.length-1;o>-1&&app.player.pvpscore>e.list[o].score;o--)t=o+1;t?(e.list.splice(t-1,0,i),e.list.pop(),e.selfrank=t):e.list.length<50&&(e.list.push(i),e.selfrank=e.list.length)}app.PVPRANKDATA.pvp=e,console.log(app.PVPRANKDATA.pvp)}},cc._RF.pop()},{basePage:void 0}],pvpRankPage:[function(e,t){"use strict";cc._RF.push(t,"df8bfjwFMVNEJAKmkN5311c","pvpRankPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"pvprankpage"},properties:{p_nodeView:cc.Node,p_nodeSelf:cc.Node},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},setParam:function(e){this._self=e.selfrank,this._arr=e.list,this.refreshUI()},refreshUI:function(){this.p_nodeView.getComponent("tableView").initTableView(this._arr.length,{array:this._arr,target:this});var e={rname:app.player.rname,power:app.player.power,level:app.player.level,iconid:app.player.iconid,headid:app.player.headid,frameid:app.player.frameid,score:app.player.pvpscore};this.p_nodeSelf.getComponent("pvpRanktabvItem").refreshUI(this._self,e)}});cc._RF.pop()},{basePage:void 0}],pvpReplayPage:[function(e,t){"use strict";cc._RF.push(t,"b6177Ke7thHhZ/tTCxtlhuw","pvpReplayPage");var a=cc.Enum({Pvp:0,RingPvp:1}),i=cc.Class({extends:e("basePage"),statics:{prefabPath:"pvpreplaypage",pageType:1},properties:{p_nodeView:cc.ScrollView,p_pfbItem:cc.Prefab},onLoad:function(){i.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.m_arrItem=[]},setParam:function(e){this._video=e.videoList,this._type=e.type,this.refreshUI()},refreshUI:function(){for(var e=0;e<this._video.length;++e){var t=this.m_arrItem[e];t||((t=cc.instantiate(this.p_pfbItem)).parent=this.p_nodeView.content,this.m_arrItem.push(t)),t.active||(t.active=!0),this._type===a.RingPvp?t.getComponent("pvpReplayItem").renderRingReplay(this._video[e],this):t.getComponent("pvpReplayItem").refreshUI(this._video[e],this)}}});cc._RF.pop()},{basePage:void 0}],pvpRewardPage:[function(e,t){"use strict";cc._RF.push(t,"6e06eK+4v9HoYHED/zVj+qv","pvpRewardPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"pvprewardpage",pageType:1},properties:{p_btnDay:cc.Button,p_nodeDayCh:cc.Node,p_btnWeek:cc.Button,p_nodeWeekCh:cc.Node,p_srcView:cc.ScrollView,p_nodeItem:cc.Node,p_labTime:cc.RichText},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.m_arrItem=[],this.time=1,this.isRTime=!0},handleUI:function(){var e=this;this._super(),this.p_btnDay.node.on("click",function(){app.playSound("click"),e.refreshUI(0)}),this.p_btnWeek.node.on("click",function(){app.playSound("click"),e.refreshUI(1)})},setParam:function(){this.refreshUI(0)},refreshUI:function(e){var t=!(0!=e);this._bDay=t;var a=t?app.db.dbPvpDayReward:app.db.dbPvpWeekReward;this.p_nodeDayCh.active=t,this.p_nodeWeekCh.active=!t;var i=app.PVPRANKDATA.pvp?app.PVPRANKDATA.pvp.selfrank:502;i=i||502;for(var n=!1,r=0;r<a.length;++r){!n&&i<=a[r].MAX&&(this.p_nodeItem.getComponent("pvpRewardItem").refreshUI({MIN:i,MAX:i,REWARDS:a[r].REWARDS,bSelfRank:!0},r,this),n=!0);var o=this.m_arrItem[r];o||((o=cc.instantiate(this.p_nodeItem)).parent=this.p_srcView.content,this.m_arrItem.push(o)),o.active=!0,o.getComponent("pvpRewardItem").refreshUI(a[r],r,this)}for(var s=a.length;s<this.m_arrItem.length;++s)this.m_arrItem[s].active=!1},refreshTime:function(){var e=this._bDay?app.player.getDayTimeBySet(23,0,0,0):app.player.getTimeDay(23,0,0,0,4);app.player.getServerTime()>e&&(e+=864e5*(this._bDay?1:7));var t=e-app.player.getServerTime();(!e||t<0)&&(t=0),this.p_labTime.string="\u7ed3\u7b97\u65f6\u95f4\uff1a<color=#d0550b>"+gUtils.getCountDownStr(t)+"</c>"},update:function(e){this.isRTime&&(this.time>1?(this.time=0,this.refreshTime()):this.time+=e)},onClose:function(){this.isRTime=!1,this._super()}});cc._RF.pop()},{basePage:void 0}],quickBattleFormPage:[function(e,t){"use strict";cc._RF.push(t,"e3202SoyTpJrZxwKdTWORaS","quickBattleFormPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"quickbattleformpage",pageType:1},properties:{p_arrChooseDark:[cc.Node],p_arrChooseLight:[cc.Node],p_nodeChoose:cc.Node,p_labPower:cc.Label,p_btnGoBattle:cc.Button,p_arrGeneral:[cc.Node],p_labTips:cc.Label},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){var e=this;this.p_arrChooseDark.forEach(function(t,a){t.on("touchend",function(){e.refreshUI(a)})}),this.p_btnGoBattle.node.on("click",function(){e.onBattle()})},setParam:function(e){this.m_refreshCb=e.refreshCb,this._btype=e.battletype,this.m_nIndex=0,this.refreshUI(this.m_nIndex,!0)},refreshUI:function(e,t){if(t||this.m_nIndex!=e){switch(this.m_nIndex=e,this.p_arrChooseLight.forEach(function(t,a){t.active=a==e}),this._cbtype=this._btype,this.m_nIndex){case 0:break;case 1:this._cbtype="pre1";break;case 2:this._cbtype="pre2"}var a=app.player.battlearr[gConfig.battleForm[this._cbtype]]||{};this._team=a?a.team:null;var i=0,n=0;if(this._team)for(var r in this._team){var o=app.player.general[this._team[r]];o&&(this.p_arrGeneral[i].active=!0,this.p_arrGeneral[i].getComponent("generalQuickItem").initData(this._team[r],a.mythic,this),i++,n+=o.power)}this.p_labPower.string=n;for(var s=i;s<this.p_arrGeneral.length;++s)this.p_arrGeneral[s].active=!1;if(i<=0)switch(this.p_labTips.node.active=!0,this._cbtype){case"pre1":case"pre2":this.p_labTips.string=langMgr.getString("quickBattleFormPage",0);break;default:this.p_labTips.string=langMgr.getString("quickBattleFormPage",1)}else this.p_labTips.node.active=!1}},onBattle:function(){var e=gUtils.deepClone(app.player.battlearr[gConfig.battleForm[this._cbtype]]);if(e)if(gUtils.getTableLength(e.team)<=0)this.shotErr();else{for(var t in e.team)app.player.general[e.team[t]]||delete e.team[t];if(gUtils.getTableLength(e.team)<=0)this.shotErr();else switch(this._btype){case"pvpatt":this.onPvp(e);break;case"kingpvp":this.onPvpKing(e);break;case"tower":this.onTower(e);break;case"manor":this.onClose(),this.m_refreshCb(e)}}else this.shotErr()},shotErr:function(){"pre1"==this._cbtype||"pre2"==this._cbtype?app.showNotice(langMgr.getString("quickBattleFormPage",3)):app.showNotice(langMgr.getString("quickBattleFormPage",4))},onPvp:function(e){var t=this,a={left:{iconid:app.player.iconid,level:app.player.level,headid:app.player.headid,frameid:app.player.frameid},right:{iconid:app.pvpEnemyInfo.iconid,level:app.pvpEnemyInfo.level,headid:app.pvpEnemyInfo.headid,frameid:app.pvpEnemyInfo.frameid}},i=this.m_refreshCb;app.player.sfPvpBattleStart(app.pvpIndex,app.pvpEnemyInfo.rid,e,function(n,r){n?app.showNotice(n):(t.onClose(),app.battleSeed=r.seed,app.player.battlearr[gConfig.battleForm[t._btype]]=gUtils.deepClone(e),app.pages.quickbattleloadpage.showPage({type:"start"}),app.player.sfPvpBattleEnd(r.battleid,function(e,n){if(e)return app.pages.quickbattleloadpage.instance&&app.pages.quickbattleloadpage.instance.onClose(),void app.showNotice(e);app.pages.quickbattleloadpage.instance&&app.pages.quickbattleloadpage.instance.setOver(function(){app.pages.quickbattleresultpage.showPage({type:t._btype,info:a,result:n,refreshCb:i})})}))})},onPvpKing:function(e){var t=this,a={target:app.kpvpEnemyInfo.rid,battleset:e};app.player.sfKpStart(a,function(a,i){a?app.showNotice(a):(app.battleSeed=i.seed,app.player.battlearr[gConfig.battleForm[t._btype]]=gUtils.deepClone(e),app.player.sfKpEnd(i.battleid,function(e){e&&app.showNotice(e)}))})},onTower:function(e){var t=this,a=app.db.getTowerInfoByFloor(app.player.tower),i={left:{iconid:app.player.iconid,level:app.player.level,headid:app.player.headid,frameid:app.player.frameid},right:{iconid:a.GENERAL,level:a.GLEVEL}},n=this.m_refreshCb;app.player.sfTowerBattle(e,function(a,r){a?app.showNotice(a):(t.onClose(),app.battleSeed=r.seed,app.player.battlearr[gConfig.battleForm[t._btype]]=gUtils.deepClone(e),app.pages.quickbattleloadpage.showPage({type:"start"}),app.player.sfTowerOver(r.battleid,function(e,a){if(e)return app.pages.quickbattleloadpage.instance&&cc.isValid(app.pages.quickbattleloadpage.instance.node)&&app.pages.quickbattleloadpage.instance.onClose(),void app.showNotice(e);app.pages.quickbattleloadpage.instance&&app.pages.quickbattleloadpage.instance.setOver(function(){app.pages.quickbattleresultpage.showPage({type:t._btype,info:i,result:a,refreshCb:n})})}))})}});cc._RF.pop()},{basePage:void 0}],quickBattleLoadPage:[function(e,t){"use strict";cc._RF.push(t,"4c002yOnGZOqa5e14ZjaSS3","quickBattleLoadPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"quickbattleloadpage",pageType:1},properties:{p_proLoad:cc.ProgressBar,p_nodeMask:cc.Node},onLoad:function(){a.instance=this,this._super()},handleUI:function(){var e=this;this.p_nodeMask.on("touchstart",function(e){e.stopPropagation()}),this.p_nodeMask.on("touchmove",function(e){e.stopPropagation()}),this.p_nodeMask.on("touchend",function(t){switch(e.m_strType){case"manor":e.onClose()}t.stopPropagation()})},setParam:function(e){e&&(this.m_strType=e.type),this.refreshUI()},refreshUI:function(){this._loadOk=!1,this.m_loadTime=0,this.p_proLoad.progress=this.m_loadTime/3},setOver:function(e){this._loadCb=e,this._loadOk=!0},update:function(e){this.m_loadTime||0==this.m_loadTime||(this.m_loadTime=0),this.m_loadTime+=e,this.p_proLoad.progress=this.m_loadTime/3,this.m_loadTime>=3&&this._loadOk&&(this.onClose(),this._loadCb())}});cc._RF.pop()},{basePage:void 0}],quickBattleResultPage:[function(e,t){"use strict";cc._RF.push(t,"d8f84nmrclKy5P/wc5SaLNJ","quickBattleResultPage");var a=["#EDD789","#3D1D0C"],i=["#BBE1EB","#000000"],n=cc.Class({extends:e("basePage"),statics:{prefabPath:"quickbattleresultpage",pageType:1},properties:{p_sprBg:cc.Sprite,p_sprResult:cc.Sprite,p_nodeLeftHead:cc.Node,p_labLeftLv:cc.Label,p_proLeftHp:cc.ProgressBar,p_labLeftPoints:cc.Label,p_nodeRightHead:cc.Node,p_labRightLv:cc.Label,p_proRightHp:cc.ProgressBar,p_labRightPoints:cc.Label,p_btnVideo:cc.Button,p_pfbPropItem:cc.Prefab,p_rewardContent:cc.Node,p_rTextHard:cc.RichText},onLoad:function(){n.instance=this,this.m_rewards=[],this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){var e=this;this._super(),this.p_btnVideo.node.on("click",function(){e.goToPlayReplay()})},setParam:function(e){var t=this;this._rInfo=e.info,this._resultData=e.result,this._type=e.type,this._closeOk=!1,this._refreshCb=e.refreshCb,this.scheduleOnce(function(){t._closeOk=!0},.5),this.refreshUI()},refreshUI:function(){var e=this,t="",n="";switch("win"==this._resultData.result.ret?(this.p_labLeftPoints.node.color=a[0],this.p_labLeftPoints.node.getComponent(cc.LabelOutline).color=a[1],this.p_labRightPoints.node.color=a[0],this.p_labRightPoints.node.getComponent(cc.LabelOutline).color=a[1],n="title_win_image",t="icon_win_3",t=this._resultData.result.ltper>=7e3?"icon_win_1":this._resultData.result.ltper>=3e3?"icon_win_2":"icon_win_3"):(this.p_labLeftPoints.node.color=a[0],this.p_labLeftPoints.node.getComponent(cc.LabelOutline).color=i[1],this.p_labRightPoints.node.color=a[0],this.p_labRightPoints.node.getComponent(cc.LabelOutline).color=i[1],n="title_lose_image",t="icon_lose_3",t=this._resultData.result.ltper>0?"icon_lose_3":this._resultData.result.rtper>=7e3?"icon_lose_1":this._resultData.result.rtper>=3e3?"icon_lose_2":"icon_lose_3"),app.loadTexture(gConfig.rootPath.uivideo+t,this.p_sprResult,this.prefabPath),app.loadTexture(gConfig.rootPath.uiimagevideo+n,this.p_sprBg,this.prefabPath),this.p_nodeLeftHead&&this.p_nodeLeftHead.getComponent("headItem").init({iconid:this._rInfo.left.iconid,headid:this._rInfo.left.headid,frameid:this._rInfo.left.frameid,target:this}),this.p_labLeftLv.string=this._rInfo.left.level,this.p_nodeRightHead&&this.p_nodeRightHead.getComponent("headItem").init({iconid:this._rInfo.right.iconid,headid:this._rInfo.right.headid,frameid:this._rInfo.right.frameid,target:this}),this.p_labRightLv.string=this._rInfo.right.level,this.p_proLeftHp.progress=this._resultData.result.ltper/1e4,this.p_proRightHp.progress=this._resultData.result.rtper/1e4,this.p_labLeftPoints.node.active=!1,this.p_labRightPoints.node.active=!1,this.p_rTextHard.active=!1,this._type){case"pvpatt":this.p_labLeftPoints.node.active=!0,this.p_labRightPoints.node.active=!0,this.p_labLeftPoints.string=langMgr.getString("quickBattleResultPage",0,[this._resultData.spoints,this._resultData.schange>0?"+"+this._resultData.schange:this._resultData.schange]),this.p_labRightPoints.string=langMgr.getString("quickBattleResultPage",0,[this._resultData.epoints,this._resultData.echange>0?"+"+this._resultData.echange:this._resultData.echange]),app.pages.windowspageturn.showPage(this._resultData.reward);break;case"manor":this.p_rTextHard.active=!0,this.p_rTextHard.string=langMgr.getString("quickBattleResultPage",3,[this._resultData.damge]),(this._resultData.reward||[]).forEach(function(t){var a=cc.instantiate(e.p_pfbPropItem);a.scale=.8,a.parent=e.p_rewardContent,a.getComponent("propItem").initForBag(t),a.getComponent("propItem").setClick(!0)});break;case"tower":if("win"==this._resultData.result.ret){var r={showtype:1,reward:this._resultData.items||[]};app.pages.windowspagereward.showPage(r)}}},goToPlayReplay:function(){var e=this;this._resultData&&(this._resultData.videoid?app.player.sfPlayerData(function(){app.player.sfVideoInfo(e._resultData.videoid,function(t,a){if(t)app.showNotice(langMgr.getString("quickBattleResultPage",2));else{var i=JSON.parse(a.video);switch(e._type){case"pvpatt":app.videoType="pvp";break;case"tower":app.videoType="towerquick";break;case"manor":app.videoType="manor"}app.videoId=e._resultData.videoid,app.pages.battlereportpage.showPage({obj:i})}})}):app.showNotice(langMgr.getString("quickBattleResultPage",1)))},onReport:function(){app.pages.battlereportpage.showPage(this._resultData.result.report)},onClose:function(){var e=this;this._closeOk&&app.player.sfPlayerData(function(){e._refreshCb&&e._refreshCb(),--app.numPrefabZindex,app.popPage(),e.node.active=!1,e.node.destroy(),cc.director.emit("page_close_end")})}});cc._RF.pop()},{basePage:void 0}],rankAchievePage:[function(e,t){"use strict";cc._RF.push(t,"85156c+tg5NIbQocnYQKFZI","rankAchievePage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"rankachievepage",pageType:1},properties:{p_labTitle:cc.Label,p_nodeView:cc.Node,p_nodeTop5:cc.Node,p_arrTop:[cc.Node]},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},onEnable:function(){this._super(),this.p_nodeTop5.parent.active=!1},handleUI:function(){var e=this;this._super(),this.p_nodeTop5.parent.on("touchend",function(){e.p_nodeTop5.parent.active=!e.p_nodeTop5.parent.active})},setParam:function(e){this._type=e.type,this._list=e.list,this.refreshUI()},refreshUI:function(){var e=this,t=app.db.getRankMission(this._type),a={wei:langMgr.getString("rankAchievePage",1),shu:langMgr.getString("rankAchievePage",2),wu:langMgr.getString("rankAchievePage",3),qun:langMgr.getString("rankAchievePage",4),main:langMgr.getString("rankAchievePage",5),tower:langMgr.getString("rankAchievePage",6)};this.p_labTitle.string=langMgr.getString("rankAchievePage",0,a[this._type]);for(var i=-1,n=0;n<t.length;n++)if(this._list&&this._list[n]&&this._list[n][0]&&app.player.getCount(t[n].MARK)<1){i=n;break}if(-1==i)for(var r=0;r<t.length;r++)if(this._list&&this._list[r]&&!this._list[r][0]){i=r;break}var o=this.p_nodeView.getComponent("tableView").cell.data.height,s=Math.max(i,0)*o;this.p_nodeView.getComponent("tableView").initTableView(t.length,{type:this._type,array:t,toplist:this._list,target:this},function(){e.p_nodeView.getComponent("tableView").scrollToOffset(cc.Vec2(0,s))});for(var p=0,c=0;c<this._list.length;c++)this._list&&this._list[c]&&this._list[c].length>0&&app.player.getCount(t[c].MARK)<=0&&p++;app.redDataServer.monument[this._type]=p},showTop5:function(e){var t=this;if(!e||e.length<=0)return app.showNotice(langMgr.getString("rankAchievePage",7)),void(this.p_nodeTop5.parent.active=!1);this.p_nodeTop5.parent.active=!0,this.p_arrTop.forEach(function(a,i){a.getComponent("rankTopItem").refreshUI(e[i],t)})}});a.showPage=function(t){var a=this;app.player.sfMonumentTop(t.type,function(i,n){i?app.showNotice(langMgr.getString("rankAchievePage",8)):e("basePage").showPage.call(a,{type:t.type,list:n})})},cc._RF.pop()},{basePage:void 0}],rankListPage:[function(e,t){"use strict";cc._RF.push(t,"1c0cdgTZXlKH69x5vNKiawY","rankListPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"ranklistpage"},properties:{p_spCampIcon:cc.Sprite,p_nodeView:cc.Node,p_arrRankTop:[cc.Node],p_btnReward:cc.Button,p_btnHelp:cc.Button,p_campNode:cc.Node,p_titleSprF:[cc.SpriteFrame],p_titleSpr:cc.Sprite,p_widgetView:cc.Widget,p_nodeSelfContent:cc.Node,p_pfbRankItem:cc.Prefab,_nodeSelf:null},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(),this.handleUI(),this.fitTopMenu(),this.m_top=this.p_widgetView.top},onEnable:function(){this._super(),eventMgr.on(eventStr.redEvent.RefreshRankListRewardRed,this.refreshRewardRed,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.redEvent.RefreshRankListRewardRed,this.refreshRewardRed,this)},handleUI:function(){var e=this;this._super(),this.p_btnReward&&(this.p_btnReward.node.active=!0),this.p_arrRankTop&&this.p_arrRankTop.length>0&&this.p_arrRankTop.forEach(function(t,a){t.on("touchend",function(){e._arr&&e._arr[a]?app.pages.playerotherinfopage.showPage({rid:e._arr[a].rid}):app.showNotice(langMgr.getString("rankListPage",0))})}),this.p_btnReward&&this.p_btnReward.node.on("click",function(){app.pages.rankachievepage.showPage({type:e._rtype})}),this.p_btnHelp&&this.p_btnHelp.node.on("click",function(){})},setParam:function(e){this._self=e.rank.selfrank,this.damge=e.rank.damge||e.rank.damage,this._arr=e.rank.list,this._rtype=e.rtype,this.hideMy=!!e.hideMy,this.refreshUI()},refreshUI:function(){this.p_nodeView.getComponent("tableView").initTableView(this._arr.length,{array:this._arr,target:this,type:this._rtype});var e={rname:app.player.rname,power:app.player.power,level:app.player.level,iconid:app.player.iconid,headid:app.player.headid,frameid:app.player.frameid,target:this};switch(this._rtype){case"pvp":e.score=app.player.pvpscore;break;case"tower":this.p_campNode.active=!1,this.p_widgetView.top=this.m_top-this.p_campNode.height,this.p_titleSpr.spriteFrame=this.p_titleSprF[5],e.tower=app.player.tower-1,e.score=e.tower;break;case"legion":case"north":this.p_btnReward.node.active=!1,this.p_campNode.active=!1,this.p_widgetView.top=this.m_top-this.p_campNode.height,this.p_titleSpr.spriteFrame=this.p_titleSprF[6],e.damge=this.damge;break;case"main":this.p_campNode.active=!1,this.p_widgetView.top=this.m_top-this.p_campNode.height,this.p_titleSpr.spriteFrame=this.p_titleSprF[4],e.score=app.player.maxmapid;break;case"wei":case"shu":case"wu":case"qun":this.refreshTitle(),e.score=app.player.getGeneralPointsByType(this._rtype);break;case"military":this.p_btnReward.node.active=!1,this.p_campNode.active=!1,this.p_widgetView.top=this.m_top-this.p_campNode.height,this.p_titleSpr.spriteFrame=this.p_titleSprF[7],e.honor=app.player.getCount(38018)}if(!cc.isValid(this._nodeSelf)&&cc.isValid(this.p_pfbRankItem)&&(this._nodeSelf=cc.instantiate(this.p_pfbRankItem),this.p_nodeSelfContent.addChild(this._nodeSelf),this._nodeSelf.setPosition(cc.Vec2.ZERO)),this._nodeSelf.getComponent("pvpRanktabvItem").refreshUI(this._self,e,this._rtype),this._nodeSelf.active=!this.hideMy,this._arr)for(var t=0;t<this.p_arrRankTop.length;++t)this._arr[t]?(this._arr[t].target=this,this.p_arrRankTop[t].getComponent("teampvpPlayerPortraitItem").refreshUI(this._arr[t])):this.p_arrRankTop[t].getComponent("teampvpPlayerPortraitItem").resetLabel();this.refreshRewardRed()},refreshRewardRed:function(){this.p_btnReward&&this.p_btnReward.node.getChildByName("rednotice")&&(this.p_btnReward.node.getChildByName("rednotice").active=app.pages.rankpage.checkReward(this._rtype))},refreshTitle:function(){this.p_widgetView.top=this.m_top;var e=["wei","shu","wu","qun"].indexOf(this._rtype),t=this.p_titleSprF[e];this.p_campNode.active=!0,this.p_titleSpr.spriteFrame=t;var a=gConfig.getIconGCampPath(e);app.loadTexture(a,this.p_spCampIcon,this.prefabPath)}});cc._RF.pop()},{basePage:void 0}],rankMainPage:[function(e,t){"use strict";cc._RF.push(t,"a9ab5HIJfdEDLpYFLgZS6/m","rankMainPage");var a=["norm","guild","pvp","tower"],i=["pvp","tower"],n={pvp:"\u7ade\u6280\u573a",tower:"\u8bd5\u7ec3\u5854"},r=["pvp","tower"],o=["guild"],s=cc.Class({extends:e("basePage"),statics:{prefabPath:"rankmainpage"},properties:{p_arrRankType:[cc.Node],p_menu:e("menu")},onLoad:function(){s.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),s.instance.RANKCACHE={};for(var e=0;e<this.p_arrRankType.length;++e)i.indexOf(a[e])<0&&(this.p_arrRankType[e].active=!1);this.p_menu.init(this)},setParam:function(e){e||(e=0),this.p_menu.setMenuIndex(e),!this._opentime||Date.now()>this._opentime+3e5?(this.sfRankInfo(0),this._opentime=Date.now()):this.refreshUI()},menuHandler:function(e){this._sIndex=e,this.refreshUI()},sfRankInfo:function(e){var t=this;e>=i.length?this.refreshUI():app.player.sfRankByType(i[e],function(a,n){cc.isValid(t.node)&&(a||(s.instance.RANKCACHE[i[e]]=n,t.sfRankInfo(++e)))})},refreshUI:function(){for(var e=s.instance.RANKCACHE,t=0==this._sIndex?r:o,i=0;i<this.p_arrRankType.length;++i){var p=a[i];-1==t.indexOf(p)?this.p_arrRankType[i].active=!1:(this.p_arrRankType[i].active=!0,this.p_arrRankType[i].getComponent("rankMainItem").refreshUI(p,e[p],n[p],this))}},onDestroy:function(){s.instance.RANKCACHE=null,this._opentime=null,this._super()},update:function(){}});cc._RF.pop()},{basePage:void 0,menu:void 0}],rankPage:[function(e,t){"use strict";cc._RF.push(t,"7e6fa5YbkxNIKPwETBrdu3y","rankPage");var a=["shu","wei","wu","qun","main","tower"],i=cc.Class({extends:e("basePage"),statics:{prefabPath:"rankpage"},properties:{p_btnHelp:cc.Button,p_pfbRankMainItem:cc.Prefab,p_nodeContent:cc.Node,p_arrRankType:[cc.Node]},onLoad:function(){i.instance=this,this.stopBgNodeEvent(),this.fitTopMenu(),this.handleUI(),i.instance.RANKCACHE={},this.p_btnHelp.node.on("click",function(){app.pages.windowspagetipshelp.showPage("1032")})},onEnable:function(){this._super(),eventMgr.on(eventStr.redEvent.RefreshRankRed,this.refreshUI,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.redEvent.RefreshRankRed,this.refreshUI,this)},handleUI:function(){this._super()},setParam:function(){!app.rankTop||Date.now()>app.rankTop.time+12e4?this.sfRankInfo():this.refreshUI()},sfRankInfo:function(){var e=this;app.player.sfRankTop(a,function(t,a){!t&&cc.isValid(e)&&(app.rankTop={info:a,time:Date.now()},e.refreshUI())})},refreshUI:function(){if(app.rankTop&&app.rankTop.info)for(var e=0;e<app.rankTop.info.length;++e)if(5!=e||app.db.checkFuncUnLock("RANK_TOWER")){var t=this.p_arrRankType[e];if(!cc.isValid(t))continue;t.active=!0,t.getComponent("rankMainItem").refreshUI(a[e],app.rankTop.info[e],null,this),t.getComponent("rankMainItem").setRed(i.checkReward(a[e]))}else cc.isValid(this.p_arrRankType[e])&&(this._arrRankType[e].active=!1)},onDestroy:function(){i.instance.RANKCACHE=null,this._super()}});i.refreshRed=function(e){for(var t=!1,n=0;n<a.length&&!(t=i.checkReward(a[n]));n++);return e&&(e.active=t),t},i.checkReward=function(e){var t=!1,a=app.getRedInfoByObj(["monument",e],null);return null!=a&&(t=a>0),t},cc._RF.pop()},{basePage:void 0}],rechargeBountyPage:[function(e,t){"use strict";cc._RF.push(t,"027c527QCVLzYISDnopBMjg","rechargeBountyPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"rechargebountypage",pageParent:"bountypage"},properties:{p_tableView:cc.tableView,p_merBar:cc.ProgressBar,p_barItem:cc.Node,p_btnUnLock:cc.Button,p_btnBuygx:cc.Button,p_btnBuyRed:cc.Node,p_btnHelp:cc.Button,p_btnGoMission:cc.Button,p_labScore:cc.Label,p_labTime:cc.Label},onLoad:function(){a.instance=this,this.fitTopMenu(),this.stopBgNodeEvent(),this.handleUI(),this.starContentY=this.p_tableView.content.y,this.starBarY=this.p_merBar.node.y},handleUI:function(){var e=this;this._super(),this.p_tableView.content.on("position-changed",function(){var t=e.p_tableView.content.y-e.starContentY;e.p_merBar.node.y=e.starBarY+t},this),this.p_btnUnLock.node.on("click",function(){}),this.p_btnBuygx.node.on("click",function(){if(app.playSound("click"),1==app.player.getCount(93366)){if(null==localDataUtils.GetValue("bountyred",null)){var t=app.pages.rechargebountypage.getEndTime();localDataUtils.SetValue("bountyred",1,t),e.p_btnBuyRed.active=!1,eventMgr.emit(eventStr.redEvent.RefreshPremiumRed)}var a=langMgr.getString("rechargeBountyPage",3);app.player.getCount(gConfig.player.gx)>=e.m_maxScore&&(a=langMgr.getString("rechargeBountyPage",4));var i={content:a,confirmcb:function(){app.player.yb<100?app.showNotice(langMgr.getString("rechargeBountyPage",1)):app.player.sfBountyBuy({time:100},function(t,a){app.player.sfPlayerData(function(){app.pages.windowspagereward.showPage({showtype:1,reward:a.items}),e.refreshData(),app.pages.premiumpage.instance.refreshCoinUI(),eventMgr.emit(eventStr.redEvent.RefreshPremiumRed)})})},target:e};app.pages.windowspagetipsmsg.showPage(i)}else app.showNotice(langMgr.getString("rechargeBountyPage",0))}),this.p_btnHelp.node.on("click",function(){app.pages.windowspagetipshelp.showPage("1033")}),this.p_btnGoMission.node.on("click",function(){app.playSound("click"),app.pages.missionpage.showPage()})},setParam:function(){this.time=0,this.initData(),this.refreshData()},initData:function(){this.m_arrBarItems||(this.m_arrBarItems=[],this.m_arrBarItems.push(this.p_barItem))},refreshData:function(){if(this.m_arrGiftData&&this.m_arrGiftData.length>0){var e=this.m_arrGiftData;this.refreshUI(e)}else this.m_arrGiftData=app.db.dbBounty,this.refreshUI(this.m_arrGiftData)},refreshUI:function(e){var t=this;if(this.p_labScore.string=app.player.getCount(gConfig.player.gx),this.p_btnUnLock.node.active=!1,this.refreshTime(),this.p_merBar.active=e&&e.length>0,e&&e.length>0){for(var a=0,i=0;i<e.length;++i){var n=this.m_arrBarItems[i];n||((n=cc.instantiate(this.p_barItem)).parent=this.p_merBar.node,this.m_arrBarItems.push(n)),n.y=-143*i,n.getChildByName("pick").active=app.player.getCount(gConfig.player.gx)>=e[i].SCORE,n.getComponentInChildren(cc.Label).string=e[i].SCORE,a=e[i].SCORE,this.m_maxScore=a,n.active=!0}var r=(e.length-1)*Math.abs(-143);this.p_merBar.node.height=r,this.p_merBar.totalLength=r,this.p_merBar.progress=app.player.getCount(gConfig.player.gx)/a>1?1:app.player.getCount(gConfig.player.gx)/a;for(var o=e.length;o<this.m_arrBarItems.length;++o)this.m_arrBarItems[o].active=!1;for(var s,p=0,c=0;c<e.length;++c){var h=e[c],l=1==app.player.getCount(h.MARK.N),g=1==!!app.player.getCount(h.MARK.S),d=app.player.getCount(gConfig.player.gx);(!l&&h.SCORE<=d||!g&&h.SCORE<=d&&d>0)&&0==s&&(s=c),d<h.SCORE&&0==p&&(p=c)}this.p_tableView.initTableView(e.length,{array:e,type:0,target:this},function(){s=s||p;var e=t.p_tableView.cell.data.height,a=Math.max(s-1,0)*e;t.p_tableView.scrollToOffset(cc.Vec2(0,a))})}else this.p_tableView.clear()},isThreeDay:function(){if(1==app.player.getCount(93366)&&!this.p_btnBuygx.node.activeInHierarchy){this.p_btnBuygx.node.active=!0;var e=localDataUtils.GetValue("bountyred",null);this.p_btnBuyRed.active=1==app.player.getCount(93366)&&null==e}},refreshTime:function(){var e=app.player.getServerTime(),t=app.pages.rechargebountypage.getEndTime(),a=gUtils.getDayHourMinSecTime(t-e);this.p_labTime.string=gUtils.getCountDownStr(t-e),a[0]<3?this.isThreeDay():this.p_btnBuygx.node.activeInHierarchy&&(this.p_btnBuygx.node.active=!1)},update:function(e){this.time>1?(this.time=0,this.refreshTime()):this.time+=e},refreshMenuRed:function(){return!1},onClose:function(){this._super()}});a.showPage=function(t,a,i){if(0===app.player.bountyend)return app.showNotice(langMgr.getString("rechargeBountyPage",2)),void(i&&i("\u8d4f\u91d1\u9601\u672a\u5f00\u542f"));e("basePage").showPage.call(this,t,a,i)},a.getEndTime=function(){return app.player.bountyend},a.refreshRed=function(e){var t=!1;if(0!==app.player.bountyend){for(var a=app.db.dbBounty,i=0;i<a.length;i++){var n=a[i];if(t=app.player.getCount(gConfig.player.gx)>=n.SCORE&&(app.player.getCount(n.MARK.N)<=0||app.player.getCount(n.MARK.S)<=0&&app.player.getCount(93366)>0))break}if(!t){var r=app.player.getServerTime(),o=app.pages.rechargebountypage.getEndTime();if(gUtils.getDayHourMinSecTime(o-r)[0]<3){var s=localDataUtils.GetValue("bountyred",null);t=1==app.player.getCount(93366)&&null==s}}}return e&&(e.active=t),t},cc._RF.pop()},{basePage:void 0}],rechargeFixtimePageMSSQ:[function(e,t){"use strict";cc._RF.push(t,"64a40g289BKxo6J/PGAQoiI","rechargeFixtimePageMSSQ");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"rechargefixtimepagemssq"},properties:{p_giftView:cc.ScrollView,p_giftPrefab:cc.Prefab,p_btnGetCZ:cc.Button,p_nodeGet:cc.Node,p_nodeGo:cc.Node},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.fitTopMenu(),this.handleUI(),this.m_arrGiftItems=[]},handleUI:function(){var e=this;this._super(),this.p_btnGetCZ.node.on("click",function(){e.onClickBtnBuy()})},setParam:function(){this.m_type="mssq",this.m_configIndex=1,this.m_arrData=app.db.dbFirstCharge[this.m_configIndex],this.m_freeData=app.db.dbFreeGift[this.m_type],this.refreshUI()},setData:function(){var e=[];app.db.dbFirstCharge[this.m_configIndex].forEach(function(t){var a={price:0};a.rewards=t.ITEMS,a.limitNum=1,a.endTime=9999999999999,a.payType="lqsz",e.push(a)}),this.refreshUI(e)},refreshUI:function(){var e=this,t=0,a=app.player.getCount(93312),i=app.player.firstcharge?app.player.getDayByCreate(app.player.firstcharge):0;if(this.m_arrData&&this.m_arrData.length>0){for(var n=0,r=function(){var r=e.m_arrData[n];r.index=n;var o=e.getGiftNode(t);o.active=!0;var s=r.PATH||r.path||"yuanbao_"+(n+1);o.getComponent("rechargeNormalItem").refreshUI({price:0,rewards:r.ITEMS,limitNum:-1,freestr:"\u7b2c"+(n+1)+"\u5929\u9886\u53d6",rewardIcon:s},e);var p=a>n;o.getComponent("rechargeNormalItem").setRed(!p&&a<=n&&app.player.getCount(90222)>=100&&i>a&&i>n),o.getComponent("rechargeNormalItem").setGray(p),p||o.on("click",function(){e.onBuyClick(r)}),t++};n<this.m_arrData.length;n++)r();for(var o=t>n?this.m_arrData.length+1:this.m_arrData.length;o<this.m_arrGiftItems.length;++o)this.m_arrGiftItems[o].active=!1}else this.m_arrGiftItems&&this.m_arrGiftItems.forEach(function(e,a){e.active=t>0&&0==a});this.p_nodeGet.active=!1,this.p_nodeGo.active=!0,this.p_btnGetCZ.interactable=!0,app.setSpriteState(this.p_btnGetCZ.getComponent(cc.Sprite),!1),this.node.getComponentInChildren("rechargePageAdVip").refreshUI(3),this.node.getComponentInChildren("rechargePageAdVip").refreshRed()},getGiftNode:function(e){var t=this.m_arrGiftItems[e];return t||((t=cc.instantiate(this.p_giftPrefab)).parent=this.p_giftView.content,this.m_arrGiftItems.push(t)),t.targetOff(),t},onBuyClick:function(e){var t=this;if(e){var a=app.player.getCount(93312),i=app.player.firstcharge?app.player.getDayByCreate(app.player.firstcharge):0,n="";if(a>e.index?n=langMgr.getString("rechargeFixtimePageMSSQ",0):app.player.getCount(90222)<100?n=langMgr.getString("rechargeFixtimePageMSSQ",1):i<=a&&(n=langMgr.getString("rechargeFixtimePageMSSQ",2)),n)app.showNotice(n);else{var r=app.db.dbFirstCharge[this.m_configIndex];r&&r.length&&app.player.sfExchange(r[Math.min(2,a)].EXID,1,0,function(e){app.player.sfPlayerData(function(){var a={showtype:1,reward:e};app.pages.windowspagereward.showPage(a),app.pages.rechargepage.instance.refreshCoinUI(),eventMgr.emit(eventStr.redEvent.RefreshRechargeRed),t.refreshUI()})})}}},refreshMenuRed:function(){return!1},onClickBtnBuy:function(){app.pages.rechargepage.instance.setMenuIndex(2,2)},onClose:function(){this._super()}});a.refreshRed=function(e){for(var t=app.player.getCount(93312),a=app.db.dbFirstCharge[1],i=!1,n=app.player.firstcharge?app.player.getDayByCreate(app.player.firstcharge):0,r=0;r<a.length&&!(i=t<=r&&app.player.getCount(90222)>=100&&n>t);r++);return i||(i=app.pages.windowspagerechargevip.refreshRed()),e&&(e.active=i),i},a.isOver=function(){return app.player.getCount(93312)>=app.db.dbFirstCharge[1].length},cc._RF.pop()},{basePage:void 0}],rechargeFixtimePageZXLB:[function(e,t){"use strict";cc._RF.push(t,"f6b7djAy6JGOrd4vpukQz88","rechargeFixtimePageZXLB");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"rechargefixtimepageczlb"},properties:{p_labTime:cc.Label,p_scrView:cc.ScrollView,p_nodeItem:cc.Node},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.fitTopMenu(),this.handleUI(),this.m_arrItems||(this.m_arrItems=[],this.m_arrItems.push(this.p_nodeItem))},handleUI:function(){this._super()},setParam:function(){this.time=0,this.isRTime=!1,this.m_data={etime:1590655152e3,items:[{id:1001,price:30,limit:2,frewards:[{gsid:38005,count:100},{gsid:38006,count:100}],crewards:[101,102]},{id:1001,price:30,limit:2,frewards:[{gsid:38005,count:100},{gsid:38006,count:100}],crewards:[101,102]}],rgroup:{101:[{gsid:30011,count:1},{gsid:38005,count:1},{gsid:38006,count:1}],102:[{gsid:30011,count:1},{gsid:38005,count:1},{gsid:38006,count:1}]}},this.refreshUI()},refreshUI:function(){if(this.m_data){for(var e=0;e<this.m_data.items.length;++e){var t=this.m_arrItems[e];t||((t=cc.instantiate(this.p_nodeItem)).parent=this.p_scrView.content,this.m_arrItems.push(t)),t.active=!0,t.getComponent("rechargeFixtimeItem").refreshUI(this.m_data.items[e],e)}for(var a=this.m_data.items.length;a<this.m_arrItems.length;++a)this.m_arrItems[a].active=!1;this.isRTime=!0,this.time=1}},refreshTime:function(){if(this.m_data&&this.m_data.etime){var e=app.player.getServerTime(),t=this.m_data.etime||0,a=t-e;(!t||a<0)&&(a=0),this.p_labTime.string=0!=a?gUtils.getCountDownStr(a):"00:00:00"}},update:function(e){this.isRTime&&(this.time>1?(this.time=0,this.refreshTime()):this.time+=e)},onClose:function(){this._super()}});cc._RF.pop()},{basePage:void 0}],rechargeNormalPageBWLB:[function(e,t){"use strict";cc._RF.push(t,"19894QDqqVN94P9pev2omJd","rechargeNormalPageBWLB");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"rechargenormalpagebwlb"},properties:{p_giftView:cc.ScrollView,p_giftPrefab:cc.Prefab},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.fitTopMenu(),this.handleUI(),this.m_arrGiftItems=[]},handleUI:function(){this._super()},setParam:function(){this.m_type="bwlb",this.m_freeData=app.db.dbFreeGift[this.m_type],this.setData()},setData:function(){var e=this;app.player.sfGetBwlbList(function(t,a){var i=[];t?cc.log(t):i=a,e.m_arrData=i,e.refreshUI()})},refreshUI:function(){var e=this,t=0;if(this.m_freeData){var a=this.getGiftNode(t);a.active=!0;var i=this.m_freeData.PATH||this.m_freeData.path||"yuanbao_0";a.getComponent("rechargeNormalItem").refreshUI({price:this.m_freeData.PRICE,rewards:this.m_freeData.ITEMS,limitNum:this.m_freeData.LIMITTIME,limitStr:this.m_freeData.LIMITVIP+"\u7ea7VIP",rewardIcon:i},this);var n=1==app.player.getCount(this.m_freeData.MARK);a.getComponent("rechargeNormalItem").setRed(!n&&app.player.vip>=this.m_freeData.LIMITVIP),a.getComponent("rechargeNormalItem").setGray(n),n||a.on("click",function(){e.onFreeBuyClick()}),t++}if(this.m_arrData&&this.m_arrData.length>0){for(var r=0,o=function(){var a=e.m_arrData[r];a.index=r;var i=e.getGiftNode(t);i.active=!0;var n=a.PATH||a.path||"yuanbao_"+(r+1);i.getComponent("rechargeNormalItem").refreshUI({price:a.price,rewards:a.items,limitNum:a.buytime,limitStr:a.vip+"\u7ea7VIP",coinType:a.type,rewardIcon:n},e);var o=a.buytime<=0;i.getComponent("rechargeNormalItem").setGray(o),o||i.on("click",function(){e.onBuyClick(a)}),t++};r<this.m_arrData.length;r++)o();for(var s=t>r?this.m_arrData.length+1:this.m_arrData.length;s<this.m_arrGiftItems.length;++s)this.m_arrGiftItems[s].active=!1}else this.m_arrGiftItems&&this.m_arrGiftItems.forEach(function(e,a){e.active=t>0&&0==a})},getGiftNode:function(e){var t=this.m_arrGiftItems[e];return t||((t=cc.instantiate(this.p_giftPrefab)).parent=this.p_giftView.content,this.m_arrGiftItems.push(t)),t.targetOff(),t},onBuyClick:function(e){var t=this;if(e)if(e.buytime<=0)app.showNotice(langMgr.getString("rechargeNormalPageBWLB",0));else if(app.player.vip<e.vip)app.showNotice(langMgr.getString("rechargeNormalPageBWLB",1));else if(0==e.type&&app.player.yb<e.price)app.showNotice(langMgr.getString("rechargeNormalPageBWLB",2));else{var a={rewards:e.items,title:langMgr.getString("rechargeNormalPageBWLB",3),limitNum:e.buytime,buycb:function(){var a=function(){var a={showtype:1,reward:e.items,target:t};app.pages.windowspagereward.showPage(a),e.buytime-=1,t._payRefreshEnd=!1,t.payRefresh(),t.schedule(t.payRefresh,3,3)};0==e.type?app.player.payBwlbByYB(e.index,function(e){e?app.showNotice(e):a&&a()}):app.player.payBwlb(e.index,e.price,function(){a&&a()},function(){cc.log("\u8d2d\u4e70\u5931\u8d25")})},cancelcb:function(){},target:this};app.pages.windowspagerechargebuy.showPage(a)}},onFreeBuyClick:function(){var e=this;if(this.m_freeData)if(1!=app.player.getCount(this.m_freeData.MARK))if(app.player.vip<this.m_freeData.LIMITVIP)app.showNotice(langMgr.getString("rechargeNormalPageBWLB",1));else{var t="freegift_reward_"+this.m_freeData.MARK;app.player.sfExchange(t,1,0,function(t){app.pages.windowspagereward.showPage({showtype:1,reward:t}),e.refreshUI(),app.pages.rechargepage.instance.refreshCoinUI(),eventMgr.emit(eventStr.redEvent.RefreshRechargeRed)})}else this.refreshUI()},payRefresh:function(){var e=this;this._payRefreshEnd||app.player.sfPlayerData(function(){e._payRefreshEnd=!0,e.refreshUI(),app.pages.rechargepage.instance.refreshCoinUI(),eventMgr.emit(eventStr.redEvent.RefreshRechargeRed)})},refreshMenuRed:function(){return!1},onClose:function(){this._super()}});a.refreshRed=function(e){var t=app.db.dbFreeGift.bwlb,a=0==app.player.getCount(t.MARK)&&app.player.vip>=t.LIMITVIP;return e&&(e.active=a),a},cc._RF.pop()},{basePage:void 0}],rechargeNormalPageCZYB:[function(e,t){"use strict";cc._RF.push(t,"d1d0bgKviNCPp6bc9tVaNIN","rechargeNormalPageCZYB");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"rechargenormalpageczyb",pageParent:"vipprivilegepage"},properties:{p_giftView:cc.ScrollView,p_giftPrefab:cc.Prefab,p_pfbAdItem:cc.Prefab,p_topUI:cc.Node},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.fitTopMenu(),this.handleUI(),this.m_arrGiftItems=[]},handleUI:function(){this._super()},setParam:function(){this.m_type="czyb",this.m_arrData=this.setData(),this.m_freeData=app.db.dbFreeGift[this.m_type],this.refreshUI()},setData:function(){var e=[];for(var t in app.db.dbRecharge){var a=app.db.dbRecharge[t];"RECHARGE"!=a.TYPE||a.REVIEW||e.push(a),gSetting.checkReviewServ()&&"RECHARGE"==a.TYPE&&a.REVIEW&&e.push(a)}return e.sort(function(e,t){return e.PRICE-t.PRICE}),e},refreshUI:function(){var e=this,t=0;if(this.m_freeData){var a=this.getGiftNode(t);a.active=!0;var i=this.m_freeData.PATH||this.m_freeData.path||"yuanbao_1";a.getComponent("rechargeSpecialItem").refreshUI({price:this.m_freeData.PRICE,prop:langMgr.getString("rechargeNormalPageCZYB",1,this.m_freeData.ITEMS[0].COUNT),intro:"",rewardIcon:i},this);var n=app.player.getCount(this.m_freeData.MARK)>0;a.getComponent("rechargeSpecialItem").setRed(!n),a.getComponent("rechargeSpecialItem").setGray(n),n||a.on("click",function(){e.onFreeBuyClick()}),t++}if(this.m_arrData&&this.m_arrData.length>0){for(var r=0,o=function(){var a=e.m_arrData[r];a.SIGN;var i=!!a.SIGN&&app.player.getCount(a.SIGN)>0,n=e.getGiftNode(t);n.active=!0;var o=Math.min(r,7),s=a.PATH||a.path||"yuanbao_"+(o+1);i?n.getComponent("rechargeSpecialItem").refreshUI({price:a.PRICE,prop:langMgr.getString("rechargeNormalPageCZYB",1,a.YB),intro:langMgr.getString("rechargeNormalPageCZYB",2,a.YB),rewardIcon:s},e):n.getComponent("rechargeSpecialItem").refreshUI({price:a.PRICE,prop:langMgr.getString("rechargeNormalPageCZYB",1,a.YB),intro:"",rewardIcon:s},e),n.getComponent("rechargeSpecialItem").setGray(!1),n.on("click",function(){e.onBuyClick(a)}),t++};r<this.m_arrData.length;r++)o();for(var s=t>r?this.m_arrData.length+1:this.m_arrData.length;s<this.m_arrGiftItems.length;++s)this.m_arrGiftItems[s].active=!1}else this.m_arrGiftItems&&this.m_arrGiftItems.forEach(function(e,a){e.active=t>0&&0==a});this.refreshTopUI()},getGiftNode:function(e){var t=this.m_arrGiftItems[e];return t||((t=cc.instantiate(this.p_giftPrefab)).parent=this.p_giftView.content,this.m_arrGiftItems.push(t)),t.targetOff(),t},onBuyClick:function(e){var t=this;if(e){var a=!!e.SIGN&&app.player.getCount(e.SIGN)>0,i=[{GSID:38005,COUNT:e.YB}];a&&(i[1]={GSID:38005,COUNT:e.EXYB});var n={rewards:i,title:langMgr.getString("rechargeNormalPageCZYB",3),limitNum:0,buycb:function(){app.player.pay(e.PID,function(){var e={showtype:1,reward:i,target:t};app.pages.windowspagereward.showPage(e),t._payRefreshEnd=!1,t.payRefresh(),t.schedule(t.payRefresh,1,3),cc.log("\u8d2d\u4e70\u6210\u529f")},function(){cc.log("\u8d2d\u4e70\u5931\u8d25")})},cancelcb:function(){},target:this};app.pages.windowspagerechargebuy.showPage(n)}},onFreeBuyClick:function(){var e=this;if(this.m_freeData){var t="freegift_reward_"+this.m_freeData.MARK;app.player.sfExchange(t,1,0,function(t){app.pages.windowspagereward.showPage({showtype:1,reward:t}),e.refreshUI(),app.pages.vipprivilegepage.instance.refreshCoinUI(),eventMgr.emit(eventStr.redEvent.RefreshVipPrivilegeRed)})}},payRefresh:function(){var e=this;this._payRefreshEnd||app.player.sfPlayerByParam(["others","vip","bagspace","hide","firstcharge"],function(){e._payRefreshEnd=!0,e.refreshUI(),app.pages.vipprivilegepage.instance.refreshCoinUI(),eventMgr.emit(eventStr.redEvent.RefreshVipPrivilegeRed)})},refreshTopUI:function(){this.m_nodeAdItem||(this.m_nodeAdItem=cc.instantiate(this.p_pfbAdItem),this.m_nodeAdItem.parent=this.p_topUI,this.m_nodeAdItem.setPosition(cc.v2(0,0))),this.m_nodeAdItem.getComponent("rechargePageAdVip").refreshUI()},refreshMenuRed:function(){return!1},onClose:function(){this._super()}});a.refreshRed=function(e){var t=app.db.dbFreeGift.czyb,a=0==app.player.getCount(t.MARK);return e&&(e.active=a),a},cc._RF.pop()},{basePage:void 0}],rechargeNormalPageDWLB:[function(e,t){"use strict";cc._RF.push(t,"6b5d4KnI9VHhL7DfxTUpf2r","rechargeNormalPageDWLB");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"rechargenormalpagedwlb"},properties:{p_giftView:cc.ScrollView,p_pfbGift:cc.Prefab,p_labTime:cc.Label},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.fitTopMenu(),this.handleUI(),this.m_arrGiftItems=[]},handleUI:function(){this._super()},setParam:function(){var e=this;this.time=0,this.isRTime=!1,this.m_type="dwlb",this.m_freeData=app.db.dbFreeGift[this.m_type],this.endTime=app.arrZhdTime.DWLB[1],app.player.sfDwlbInfo(function(t,a){t?app.showNotice(t):(e.m_arrData=a,e.refreshUI())})},refreshUI:function(){var e=this,t=0;if(this.m_freeData){var a=this.getGiftNode(t);a.active=!0;var i=this.m_freeData.PATH||this.m_freeData.path||"yuanbao_0";a.getComponent("rechargeNormalItem").refreshUI({price:this.m_freeData.PRICE,rewards:this.m_freeData.ITEMS,limitNum:this.m_freeData.LIMITTIME,rewardIcon:i},this);var n=1==app.player.getCount(this.m_freeData.MARK);a.getComponent("rechargeNormalItem").setRed(!n),a.getComponent("rechargeNormalItem").setGray(n),n||a.on("click",function(){e.onFreeBuyClick()}),t++}if(this.m_arrData&&this.m_arrData.length>0){for(var r=0,o=function(){var a=e.m_arrData[r];a.index=r;var i=e.getGiftNode(t);i.active=!0;var n=a.PATH||a.path||"yuanbao_"+(r+1);i.getComponent("rechargeNormalItem").refreshUI({price:a.price,rewards:a.items,limitNum:a.buytime,rewardIcon:n},e);var o=a.buytime<=0;i.getComponent("rechargeNormalItem").setGray(o),o||i.on("click",function(){e.onBuyClick(a)}),t++};r<this.m_arrData.length;r++)o();for(var s=t>r?this.m_arrData.length+1:this.m_arrData.length;s<this.m_arrGiftItems.length;++s)this.m_arrGiftItems[s].active=!1}else this.m_arrGiftItems&&this.m_arrGiftItems.forEach(function(e,a){e.active=t>0&&0==a});this.isRTime=!0,this.time=1},onFreeBuyClick:function(){var e=this;if(this.m_freeData)if(this.endTime<app.player.getServerTime())this.setParam();else{var t="freegift_reward_"+this.m_freeData.MARK;app.player.sfExchange(t,1,0,function(t){app.pages.windowspagereward.showPage({showtype:1,reward:t}),e.refreshUI(),app.pages.rechargepage.instance.refreshCoinUI(),eventMgr.emit(eventStr.redEvent.RefreshRechargeRed)})}},getGiftNode:function(e){var t=this.m_arrGiftItems[e];return t||((t=cc.instantiate(this.p_pfbGift)).parent=this.p_giftView.content,this.m_arrGiftItems.push(t)),t.targetOff(),t},onBuyClick:function(e){var t=this;if(e)if(this.endTime<app.player.getServerTime())this.setParam();else if(e.buytime<=0)app.showNotice(langMgr.getString("rechargeNormalPageDWLB",1));else{var a={rewards:e.items,title:langMgr.getString("rechargeNormalPageDWLB",2),limitNum:e.buytime,buycb:function(){app.player.payDwlb(e.index,e.price,function(){var a={showtype:1,reward:e.items,target:t};app.pages.windowspagereward.showPage(a),e.buytime-=1,t._payRefreshEnd=!1,t.payRefresh(),t.schedule(t.payRefresh,3,3),cc.log("\u8d2d\u4e70\u6210\u529f")},function(){cc.log("\u8d2d\u4e70\u5931\u8d25")})},cancelcb:function(){},target:this};app.pages.windowspagerechargebuy.showPage(a)}},payRefresh:function(){var e=this;this._payRefreshEnd||app.player.sfPlayerByParam(["others","vip","bagspace","hide","props"],function(){e._payRefreshEnd=!0,e.refreshUI(),app.pages.rechargepage.instance.refreshCoinUI(),eventMgr.emit(eventStr.redEvent.RefreshRechargeRed)})},update:function(e){this.isRTime&&(this.time>1?(this.time=0,this.refreshTime()):this.time+=e)},refreshTime:function(){if(this.endTime){var e=this.endTime-app.player.getServerTime();this.p_labTime.string=langMgr.getString("rechargeNormalPageDWLB",0,gUtils.getCountDownStr(e))}},refreshMenuRed:function(){return!1},onClose:function(){this._super()}});a.isOpen=function(){var e=app.player.getServerTime();return!!(app.arrZhdTime&&app.arrZhdTime.DWLB&&app.arrZhdTime.DWLB[0]<=e&&e<=app.arrZhdTime.DWLB[1])},a.refreshRed=function(e){var t=!1;if(a.isOpen()){var i=app.db.dbFreeGift.dwlb;t=0==app.player.getCount(i.MARK)}return e&&(e.active=!!t),t},cc._RF.pop()},{basePage:void 0}],rechargeNormalPageMRLB:[function(e,t){"use strict";cc._RF.push(t,"28faee0LkpJZa0MFL284qRs","rechargeNormalPageMRLB");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"rechargenormalpagemrlb"},properties:{p_giftView:cc.ScrollView,p_giftPrefab:cc.Prefab,p_labTime:cc.Label},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.fitTopMenu(),this.handleUI(),this.m_arrGiftItems=[]},handleUI:function(){this._super()},setParam:function(){this.time=0,this.isRTime=!1,this.endTime=0,this.m_type="mrlb",this.m_freeData=app.db.dbFreeGift[this.m_type],this.setData()},setData:function(){var e=this;app.player.sfGetMrlbList(function(t,a){var i=[];if(e.m_objData={},e.m_arrData=[],t)cc.log(t);else{for(var n=0;n<a.length;n++){var r=a[n];r.index=n;var o=!1;(!r.vip||r.vip&&app.player.vip>=r.vip[0])&&(o=!0);var s=!1;(!r.lock||r.lock&&app.player.maxmapid>r.lock)&&(s=!0);var p=!1;(!r.mark||r.mark&&app.player.getCount(r.mark)>0)&&(p=!0),o&&s&&p&&i.push(r)}for(var c=0;c<i.length;c++){var h={};h.pre=i[c].trigger,h.next=0,h.data=i[c],e.m_objData[i[c].id]=h,e.m_arrData.push(i[c].id)}for(var l=0;l<i.length;l++)e.m_objData[i[l].trigger]&&(e.m_objData[i[l].trigger].next=i[l].id);e.endTime=gUtils.getSecondDayTime(app.player.getServerTime()),e.refreshUI()}})},refreshUI:function(){var e=this,t=0;if(this.m_freeData){var a=this.getGiftNode(t);a.active=!0;var i=this.m_freeData.PATH||this.m_freeData.path||"yuanbao_0";a.getComponent("rechargeNormalItem").refreshUI({price:this.m_freeData.PRICE,rewards:this.m_freeData.ITEMS,limitNum:this.m_freeData.LIMITTIME,rewardIcon:i},this);var n=1==app.player.getCount(this.m_freeData.MARK);a.getComponent("rechargeNormalItem").setRed(!n),a.getComponent("rechargeNormalItem").setGray(n),n||a.on("click",function(){e.onFreeBuyClick()}),t++}this.m_arrData&&this.m_arrData.length>0?function(){for(var a=0,i=function(){var i,n=e.m_arrData[a],r=e.m_objData[n],o=r.data,s=e.getGiftNode(t);i=0==r.next?e.getPreBuyTime(r.pre):0==r.pre&&o.buytime>0||void 0!==e.m_objData[r.pre]&&0==e.m_objData[r.pre].data.buytime&&o.buytime>0,s.active=i;var p=o.PATH||o.path||"yuanbao_"+(a+1);s.getComponent("rechargeNormalItem").refreshUI({price:o.price,rewards:o.items,limitNum:o.buytime,rewardIcon:p},e);var c=o.buytime<=0;s.getComponent("rechargeNormalItem").setGray(c),c||s.on("click",function(){e.onBuyClick(o,a)}),t++};a<e.m_arrData.length;a++)i();for(var n=t>a?e.m_arrData.length+1:e.m_arrData.length;n<e.m_arrGiftItems.length;++n)e.m_arrGiftItems[n].active=!1}():this.m_arrGiftItems&&this.m_arrGiftItems.forEach(function(e,a){e.active=t>0&&0==a}),this.isRTime=!0,this.time=1},getPreBuyTime:function(e,t){return void 0===t&&(t=!0),this.m_objData[e]?0==this.m_objData[e].data.buytime||this.getPreBuyTime(this.m_objData[e].pre,!1):t},getGiftNode:function(e){var t=this.m_arrGiftItems[e];return t||((t=cc.instantiate(this.p_giftPrefab)).parent=this.p_giftView.content,this.m_arrGiftItems.push(t)),t.targetOff(),t},onBuyClick:function(e){var t=this;if(e)if(this.endTime<app.player.getServerTime())this.setParam();else if(e.buytime<=0)app.showNotice(langMgr.getString("rechargeNormalPageMRLB",2));else{var a={rewards:e.items,title:langMgr.getString("rechargeNormalPageMRLB",3),limitNum:e.buytime,buycb:function(){app.player.payMrlb(e.index,e.price,function(){var a={showtype:1,reward:e.items,target:t};app.pages.windowspagereward.showPage(a),e.buytime-=1,t._payRefreshEnd=!1,t.payRefresh(),t.schedule(t.payRefresh,3,3),cc.log("\u8d2d\u4e70\u6210\u529f")},function(){cc.log("\u8d2d\u4e70\u5931\u8d25")})},cancelcb:function(){},target:this};app.pages.windowspagerechargebuy.showPage(a)}},onFreeBuyClick:function(){var e=this;if(this.m_freeData)if(this.endTime<app.player.getServerTime())this.setParam();else{var t="freegift_reward_"+this.m_freeData.MARK;app.player.sfExchange(t,1,0,function(t){app.pages.windowspagereward.showPage({showtype:1,reward:t}),e.refreshUI(),app.pages.premiumpage.instance.refreshCoinUI(),eventMgr.emit(eventStr.redEvent.RefreshRechargeRed)})}},payRefresh:function(){var e=this;this._payRefreshEnd||app.player.sfPlayerData(function(){e._payRefreshEnd=!0,e.refreshUI(),app.pages.premiumpage.instance.refreshCoinUI(),eventMgr.emit(eventStr.redEvent.RefreshRechargeRed)})},refreshTime:function(){if(this.endTime){var e=this.endTime-app.player.getServerTime();this.p_labTime.string=e<0?langMgr.getString("rechargeNormalPageMRLB",0):langMgr.getString("rechargeNormalPageMRLB",1,gUtils.getCountDownStr(e))}},update:function(e){this.isRTime&&(this.time>1?(this.time=0,this.refreshTime()):this.time+=e)},onClose:function(){this._super()}});a.refreshRed=function(e){var t=app.db.dbFreeGift.mrlb,a=0==app.player.getCount(t.MARK);return e&&(e.active=a),a},cc._RF.pop()},{basePage:void 0}],rechargeNormalPageMRXG:[function(e,t){"use strict";cc._RF.push(t,"5408axLFjRL/JBDiZ7NSQNo","rechargeNormalPageMRXG");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"rechargenormalpagemrxg",pageParent:"premiumpage"},properties:{p_tabvRight:cc.Node,p_aKeyBuy:cc.Node,p_priceNode:cc.Node,p_sprBtnTx:cc.Sprite,p_nodeDays:cc.Node,p_labDays:cc.Label,p_arrSprf:[cc.SpriteFrame]},onLoad:function(){a.instance=this,this.fitTopMenu(),this.handleUI()},handleUI:function(){var e=this;this._super(),this.p_aKeyBuy.on("click",function(){app.playSound("click"),e.onClickBtn()})},setParam:function(){var e=this;this.m_type="mrlb";var t=app.db.dbFreeGift[this.m_type];app.player.sfGetMrlbList(function(a,i){e.m_arrData=i;var n={buytime:1-app.player.getCount(t.MARK),items:t.ITEMS,price:0,mark:t.MARK};e.m_arrData.items.unshift(n),e.refreshUI()})},refreshUI:function(){if(this.m_arrData&&this.m_arrData.items.length>0){var e=this.m_arrData.items.length-1;if(this.p_tabvRight.getComponent("tableView").initTableView(e,{array:this.m_arrData.items,target:this}),this.m_arrData.ispay){this.p_priceNode.active=!1,this.p_nodeDays.active=!0;var t=this.checkGet()?0:2;this.p_sprBtnTx.spriteFrame=this.p_arrSprf[t],this.p_labDays.string=this.m_arrData.day+"/7\u5929",this.p_aKeyBuy.getComponent(cc.Button).interactable=this.checkGet()}else this.p_priceNode.active=!0,this.p_nodeDays.active=!1,this.p_sprBtnTx.spriteFrame=this.p_arrSprf[1],this.p_aKeyBuy.getComponent(cc.Button).interactable=!0,this.p_priceNode.getComponent("price_num_item").init(this.m_arrData.items[this.m_arrData.items.length-1].price,1,2)}app.pages.premiumpage.instance.refreshCoinUI()},checkGet:function(){for(var e=this.m_arrData.items,t=1;t<e.length-1;t++)if(e[t].buytime>0)return!0;return!1},onClickBtn:function(){var e=this;if(this.m_arrData.ispay)if(this.m_arrData.items[0].buytime>0){var t="freegift_reward_"+app.db.dbFreeGift[this.m_type].MARK;app.player.sfGetMrlb({index:5,all:!0},function(a,i){a||app.player.sfExchange(t,1,0,function(t){app.redDataServer&&app.redDataServer.daypack&&(app.redDataServer.daypack=0);var a={showtype:1,reward:i.concat(t),target:e,confirmcb:function(){e.setParam(),app.player.sfPlayerByParam(["others"])}};app.player.addItem(i),app.pages.windowspagereward.showPage(a)})})}else app.player.sfGetMrlb({index:5,all:!0},function(t,a){if(!t){app.redDataServer&&app.redDataServer.daypack&&(app.redDataServer.daypack=0);var i={showtype:1,reward:a,target:e,confirmcb:function(){e.setParam(),app.player.sfPlayerByParam(["others"])}};app.player.addItem(a),app.pages.windowspagereward.showPage(i)}});else{var a=this.m_arrData.items[this.m_arrData.items.length-1],i={content:langMgr.getString("rechargeNormalPageMRXG",0,a.price),confirmcb:function(){app.player.payMrlb(e.m_arrData.items.length-2,a.price,function(){app.player.sfPlayerByParam(["others","vip","hide","props"],function(){e&&cc.isValid(e.node)&&(app.redDataServer&&(app.redDataServer.daypack=3),e.setParam())})},function(){console.log("\u7279\u6743\u8d2d\u4e70\u53d6\u6d88or\u5931\u8d25")})},confirmparm:[],cancelcb:function(){},target:this};app.pages.windowspagetipsmsg.showPage(i)}}});a.refreshRed=function(e){var t=!1,a=app.db.dbFreeGift.mrlb;return 0==app.player.getCount(a.MARK)&&(t=!0),app.redDataServer&&app.redDataServer.daypack>0&&(t=!0),e&&(e.active=t),t},cc._RF.pop()},{basePage:void 0}],rechargeNormalPageMYLB:[function(e,t){"use strict";cc._RF.push(t,"7d25cImCspDRqeLPs77U2i5","rechargeNormalPageMYLB");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"rechargenormalpagemylb",pageParent:"vipprivilegepage"},properties:{p_giftView:cc.ScrollView,p_giftPrefab:cc.Prefab,p_labTime:cc.Label},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.fitTopMenu(),this.handleUI(),this.m_arrGiftItems=[]},handleUI:function(){this._super()},setParam:function(){this.time=0,this.isRTime=!1,this.endTime=0,this.m_type="mylb",this.m_freeData=app.db.dbFreeGift[this.m_type],this.setData()},setData:function(){var e=this;app.player.sfGetMylbList(function(t,a){if(t)app.showNotice(t);else{e.m_arrData=[];for(var i=0;i<a.items.length;i++){var n=a.items[i];n.index=i;var r=!1;(!n.vip||n.vip&&app.player.vip>=n.vip[0])&&(r=!0);var o=!1;(!n.lock||n.lock&&app.player.maxmapid>n.lock)&&(o=!0);var s=!1;(!n.mark||n.mark&&app.player.getCount(n.mark)>0)&&(s=!0),r&&o&&s&&e.m_arrData.push(n)}e.endTime=a.end,e.refreshUI()}})},refreshUI:function(){var e=this,t=0;if(this.m_freeData){var a=this.getGiftNode(t);a.active=!0;var i=this.m_freeData.PATH||this.m_freeData.path||"yuanbao_0";a.getComponent("rechargeNormalItem").refreshUI({price:this.m_freeData.PRICE,rewards:this.m_freeData.ITEMS,limitNum:this.m_freeData.LIMITTIME,rewardIcon:i},this);var n=1==app.player.getCount(this.m_freeData.MARK);a.getComponent("rechargeNormalItem").setRed(!n),a.getComponent("rechargeNormalItem").setGray(n),a.on("click",function(){e.onFreeBuyClick()},this),t++}if(this.m_arrData&&this.m_arrData.length>0){for(var r=0,o=function(){var a=e.m_arrData[r],i=e.getGiftNode(t);i.active=!0;var n=a.PATH||a.path||"yuanbao_"+(r+1);i.getComponent("rechargeNormalItem").refreshUI({price:a.price,rewards:a.items,limitNum:a.buytime,rewardIcon:n},e);var o=a.buytime<=0;i.getComponent("rechargeNormalItem").setGray(o),i.on("click",function(){e.onBuyClick(a)},e),t++};r<this.m_arrData.length;r++)o();for(var s=t>r?this.m_arrData.length+1:this.m_arrData.length;s<this.m_arrGiftItems.length;++s)this.m_arrGiftItems[s].active=!1}else this.m_arrGiftItems&&this.m_arrGiftItems.forEach(function(e,a){e.active=t>0&&0==a});this.isRTime=!0,this.time=1},getGiftNode:function(e){var t=this.m_arrGiftItems[e];return t||((t=cc.instantiate(this.p_giftPrefab)).parent=this.p_giftView.content,this.m_arrGiftItems.push(t)),t.targetOff(this),t},onBuyClick:function(e){var t=this;if(e)if(this.endTime<app.player.getServerTime())this.setParam();else if(e.buytime<=0)app.showNotice(langMgr.getString("rechargeNormalPageMYLB",1));else{var a={rewards:e.items,title:langMgr.getString("rechargeNormalPageMYLB",2),limitNum:e.buytime,buycb:function(){app.player.payMylb(e.index,e.price,function(){var a={showtype:1,reward:e.items,target:t};app.pages.windowspagereward.showPage(a),e.buytime-=1,t._payRefreshEnd=!1,t.payRefresh(),t.schedule(t.payRefresh,3,3),cc.log("\u8d2d\u4e70\u6210\u529f")},function(){cc.log("\u8d2d\u4e70\u5931\u8d25")})},cancelcb:function(){},target:this};app.pages.windowspagerechargebuy.showPage(a)}},onFreeBuyClick:function(){var e=this;if(this.m_freeData)if(this.endTime<app.player.getServerTime())this.setParam();else{var t="freegift_reward_"+this.m_freeData.MARK;app.player.sfExchange(t,1,0,function(t){app.pages.windowspagereward.showPage({showtype:1,reward:t}),e.refreshUI(),app.pages.vipprivilegepage.instance.refreshCoinUI(),eventMgr.emit(eventStr.redEvent.RefreshVipPrivilegeRed)})}},payRefresh:function(){var e=this;this._payRefreshEnd||app.player.sfPlayerData(function(){e._payRefreshEnd=!0,e.refreshUI(),app.pages.vipprivilegepage.instance.refreshCoinUI(),eventMgr.emit(eventStr.redEvent.RefreshVipPrivilegeRed)})},refreshTime:function(){if(this.endTime){var e=this.endTime-app.player.getServerTime();this.p_labTime.string=langMgr.getString("rechargeNormalPageMYLB",0,gUtils.getCountDownStr(e))}},update:function(e){this.isRTime&&(this.time>1?(this.time=0,this.refreshTime()):this.time+=e)},refreshMenuRed:function(){return!1},onClose:function(){this._super()}});a.refreshRed=function(e){var t=app.db.dbFreeGift.mylb,a=0==app.player.getCount(t.MARK);return e&&(e.active=a),a},cc._RF.pop()},{basePage:void 0}],rechargeNormalPageMZLB:[function(e,t){"use strict";cc._RF.push(t,"c7f5dqytc1DzawAcg5+A9rr","rechargeNormalPageMZLB");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"rechargenormalpagemzlb",pageParent:"vipprivilegepage"},properties:{p_giftView:cc.ScrollView,p_pfbGift:cc.Prefab,p_labTime:cc.Label},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.fitTopMenu(),this.handleUI(),this.m_arrGiftItems=[]},handleUI:function(){this._super()},setParam:function(){this.time=0,this.isRTime=!1,this.endTime=0,this.m_type="mzlb",this.m_freeData=app.db.dbFreeGift[this.m_type],this.setData()},setData:function(){var e=this;app.player.sfGetMzlbList(function(t,a){if(t)app.showNotice(t);else{e.m_arrData=[];for(var i=0;i<a.items.length;i++){var n=a.items[i];n.index=i;var r=!1;(!n.vip||n.vip&&app.player.vip>=n.vip[0])&&(r=!0);var o=!1;(!n.lock||n.lock&&app.player.maxmapid>n.lock)&&(o=!0);var s=!1;(!n.mark||n.mark&&app.player.getCount(n.mark)>0)&&(s=!0),r&&o&&s&&e.m_arrData.push(n)}e.endTime=a.end,e.refreshUI()}})},refreshUI:function(){var e=this,t=0;if(this.m_freeData){var a=this.getGiftNode(t);a.active=!0;var i=this.m_freeData.PATH||this.m_freeData.path||"yuanbao_0";a.getComponent("rechargeNormalItem").refreshUI({price:this.m_freeData.PRICE,rewards:this.m_freeData.ITEMS,limitNum:this.m_freeData.LIMITTIME,rewardIcon:i,color:1,ismz:1},this);var n=1==app.player.getCount(this.m_freeData.MARK);a.getComponent("rechargeNormalItem").setRed(!n),a.getComponent("rechargeNormalItem").setGray(n),a.on("click",function(){e.onFreeBuyClick()},this),t++}if(this.m_arrData&&this.m_arrData.length>0){for(var r=0,o=function(){var a=e.m_arrData[r],i=e.getGiftNode(t);i.active=!0;var n=a.PATH||a.path||"yuanbao_"+(r+1);i.getComponent("rechargeNormalItem").refreshUI({price:a.price,rewards:a.items,limitNum:a.buytime,rewardIcon:n,color:1,ismz:1},e);var o=a.buytime<=0;i.getComponent("rechargeNormalItem").setGray(o),i.on("click",function(){e.onBuyClick(a)},e),t++};r<this.m_arrData.length;r++)o();for(var s=t>r?this.m_arrData.length+1:this.m_arrData.length;s<this.m_arrGiftItems.length;++s)this.m_arrGiftItems[s].active=!1}else this.m_arrGiftItems&&this.m_arrGiftItems.forEach(function(e,a){e.active=t>0&&0==a});this.isRTime=!0,this.time=1},getGiftNode:function(e){var t=this.m_arrGiftItems[e];return t||((t=cc.instantiate(this.p_pfbGift)).parent=this.p_giftView.content,this.m_arrGiftItems.push(t)),t.targetOff(this),t},onBuyClick:function(e){var t=this;if(e)if(this.endTime<app.player.getServerTime())this.setParam();else if(e.buytime<=0)app.showNotice(langMgr.getString("rechargeNormalPageMZLB",1));else{var a={rewards:e.items,title:langMgr.getString("rechargeNormalPageMZLB",2),limitNum:e.buytime,buycb:function(){app.player.payMzlb(e.index,e.price,function(){var a={showtype:1,reward:e.items,target:t};app.pages.windowspagereward.showPage(a),e.buytime-=1,t._payRefreshEnd=!1,t.payRefresh(),t.schedule(t.payRefresh,3,3),cc.log("\u8d2d\u4e70\u6210\u529f")},function(){cc.log("\u8d2d\u4e70\u5931\u8d25")})},cancelcb:function(){},target:this};app.pages.windowspagerechargebuy.showPage(a)}},onFreeBuyClick:function(){var e=this;if(this.m_freeData)if(this.endTime<app.player.getServerTime())this.setParam();else{var t="freegift_reward_"+this.m_freeData.MARK;app.player.sfExchange(t,1,0,function(t){app.pages.windowspagereward.showPage({showtype:1,reward:t}),e.refreshUI(),app.pages.vipprivilegepage.instance.refreshCoinUI(),eventMgr.emit(eventStr.redEvent.RefreshVipPrivilegeRed)})}},payRefresh:function(){var e=this;this._payRefreshEnd||app.player.sfPlayerData(function(){e._payRefreshEnd=!0,e.refreshUI(),app.pages.vipprivilegepage.instance.refreshCoinUI(),eventMgr.emit(eventStr.redEvent.RefreshVipPrivilegeRed)})},update:function(e){this.isRTime&&(this.time>1?(this.time=0,this.refreshTime()):this.time+=e)},refreshTime:function(){if(this.endTime){var e=this.endTime-app.player.getServerTime();this.p_labTime.string=langMgr.getString("rechargeNormalPageMZLB",0,gUtils.getCountDownStr(e))}},refreshMenuRed:function(){return!1},onClose:function(){this._super()}});a.refreshRed=function(e){var t=app.db.dbFreeGift.mzlb,a=0==app.player.getCount(t.MARK);return e&&(e.active=a),a},cc._RF.pop()},{basePage:void 0}],rechargePageAdVip:[function(e,t){"use strict";cc._RF.push(t,"bb0e1YpwPBK5IPMnMAX8P2O","rechargePageAdVip"),cc.Class({extends:cc.Component,properties:{p_nodeNext:cc.Node,p_labNextNum:cc.Label,p_labNextVip:cc.Label,p_sprAd:cc.Sprite,p_maxLevelNode:cc.Node,p_vipFrame:cc.Sprite,p_labNowLv:cc.Label,p_nodeMax:cc.Node,p_barVipExp:cc.ProgressBar,p_labVipExp:cc.Label,p_sprNextVip:cc.Sprite,p_sprExpIcon:cc.Sprite},onLoad:function(){this.handleUI()},handleUI:function(){this.refreshUI()},refreshUI:function(e){var t=this,a=e||Math.min(app.player.vip+1,app.db.dbVip.length),i=app.db.getVipExp(a);if(this.p_labNowLv.string=a-1,!i)return this.p_barVipExp.progress=1,this.p_labVipExp.string=langMgr.getString("rechargePageAdVip",0),this.p_maxLevelNode.active=!0,void(this.p_nodeNext.active=!1);var n=i.next-i.now,r=Math.max(n,0)+"";this.p_labNextNum.string=r,app.loadTexture("game_ui/04_page/vip_privilege_page/czyb/vip/vip"+a+"b",this.p_sprNextVip,app.pages.vipprivilegepage.prefabPath),app.loadTexture(gConfig.getCurrencyIconPath(38003),this.p_sprExpIcon,app.pages.vipprivilegepage.prefabPath);var o=gConfig.getVipAdTxPath(a-1);app.loadTexture(o,this.p_sprAd,app.pages.rechargepage.prefabPath,function(){t.p_sprAd.node.active=!0},function(){t.p_sprAd.node.active=!1}),i.now=Math.max(i.now,0),this.p_barVipExp.progress=i.now/i.next>1?1:i.now/i.next,this.p_labVipExp.string=i.now+"/"+i.next}}),cc._RF.pop()},{}],rechargePageMain:[function(e,t){"use strict";cc._RF.push(t,"56a35b20bRJ/Zey153edB2z","rechargePageMain"),cc.Class({extends:cc.Component,properties:{p_tabvRecharge:cc.tableView},onLoad:function(){},refreshUI:function(){this.m_arrShowData=this.setData(),this.refreshView()},refreshView:function(){var e=this.m_arrShowData.length;this.p_tabvRecharge.getComponent("tableView").initTableView(e,{array:this.m_arrShowData,target:this})},setData:function(){var e=[];for(var t in app.db.dbRecharge){var a=app.db.dbRecharge[t];"RECHARGE"==a.TYPE&&e.push(a),gSetting.funofhide&&"RECHARGE1"==a.TYPE&&e.push(a)}return e.sort(function(e,t){return e.PRICE-t.PRICE}),e}}),cc._RF.pop()},{}],rechargePageRight:[function(e,t){"use strict";cc._RF.push(t,"fea60snBNJAJpINArUbke+1","rechargePageRight"),cc.Class({extends:cc.Component,properties:{p_tabvRight:cc.tableView},onLoad:function(){},refreshUI:function(){this.m_arrShowData=this.setData(),this.refreshView()},refreshView:function(){var e=this.m_arrShowData.length;this.p_tabvRight.getComponent("tableView").initTableView(e,{array:this.m_arrShowData,target:this})},setData:function(){var e=[];for(var t in app.db.dbRight){var a=app.db.dbRight[t];e.push(a)}return e}}),cc._RF.pop()},{}],rechargePageVip:[function(e,t){"use strict";function a(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(a)return(a=a.call(e)).next.bind(a);if(Array.isArray(e)||(a=i(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function i(e,t){if(e){if("string"==typeof e)return n(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?n(e,t):void 0}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,i=new Array(t);a<t;a++)i[a]=e[a];return i}cc._RF.push(t,"1edb7GeSUpPDax5SfTFgDV3","rechargePageVip"),cc.Class({extends:cc.Component,properties:{p_menu:e("menu"),p_nodeMenuItem:cc.Node,p_nodeVipInfo:cc.Node,p_arrNodeCReward:[cc.Node],p_atlasVip:cc.SpriteAtlas,p_sprVip:cc.Sprite,p_nodeNo:cc.Node,p_arrPower:[cc.Node],p_arrReward:[cc.Node],p_nodeNoGet:cc.Node,p_btnGet:cc.Button,p_btnSee:cc.Button,p_sprSee1:cc.Sprite,p_sprSee2:cc.Sprite},onLoad:function(){this.p_menu.init(this),this.handleUI()},handleUI:function(){var e=this;this.p_btnGet.node.on("click",function(){app.playSound("click"),e.onClickBtnGet()}),this.p_btnSee.node.on("click",function(){app.goToPage("activityjchdpagezzyk")})},onEnable:function(){this.refreshUI(),this.p_menu.setMenuIndex(0)},refreshUI:function(){this.p_sprSee1.node.active=!app.player.special.specialzz,this.p_sprSee2.node.active=app.player.special.specialzz,this.refreshMenu()},refreshMenu:function(){for(var e=this,t=app.db.dbVip,a=function(a){var i=e.p_menu.p_arrBtnMenu[a];i||(i=cc.instantiate(e.p_nodeMenuItem).getComponent("menuBtnVipItem"),e.p_menu.p_arrBtnMenu.push(i),i.node.on("click",function(){app.playSound("click"),e.p_menu._onClickMenu(a)}),i.node.parent=e.p_menu.node),i.node.active=!0;var n=t[a];i.getComponent("menuBtnVipItem").refreshUI(a,n)},i=0;i<t.length;++i)a(i);for(var n=t.length;n<this.p_menu.p_arrBtnMenu.length;++n)this.p_menu.p_arrBtnMenu[n].node.active=!1},refreshInfo:function(e,t){this.m_numPickVip=e,this.p_arrNodeCReward.forEach(function(e,a){var i=t.BCARD[a];i?(e.active=!0,e.getComponent("propItem").initForBag(i),e.getComponent("propItem").setClick(!0)):e.active=!1}),this.p_sprVip.spriteFrame=this.p_atlasVip.getSpriteFrame("guizu_pink_"+e);for(var i,n=app.db.getPowerByVip(e),r=!0,o=a(n);!(i=o()).done;)if(0!=i.value.num){r=!1;break}this.p_nodeNo.active=r,this.p_arrPower.forEach(function(e,t){var a=n[t];e.active=0!=a.num,e.getChildByName("num").getComponent(cc.Label).string=a.val});var s=app.player.getCount(t.MARK)>0,p=t.REWARD;this.p_arrReward.forEach(function(e,t){var a=p[t];e.active=!!a,e.active&&(e.getComponent("propItem").initForBag(a),e.getComponent("propItem").setClick(!s),e.getChildByName("picked").active=s,app.setNodeState(e.getChildByName("scale_icon"),s))});var c=app.player.getCount(t.MARK);this.p_nodeNoGet.active=e>app.player.vip,this.p_btnGet.node.active=e<=app.player.vip,this.p_btnGet.interactable=e<=app.player.vip&&c<=0},menuHandler:function(e){var t=app.db.dbVip[e];this.refreshInfo(e,t)},onClickBtnGet:function(){var e=this,t=app.db.dbVip[this.m_numPickVip];t.EXID&&(app.player.getCount(t.MARK)>0?app.showNotice(langMgr.getString("rechargePageVip",0)):app.player.sfExchange(t.EXID,1,0,function(i){for(var n,r=[],o=a(i);!(n=o()).done;){var s=n.value,p=s.gsid||s.GSID;"none"!=app.db.getTypeByGsid(p)&&r.push(s)}var c={showtype:1,reward:r,target:e};app.pages.windowspagereward.showPage(c),app.player.addItem([{gsid:t.MARK,count:1}]),e.p_menu.p_arrBtnMenu[e.m_numPickVip].getComponent("menuBtnVipItem").refreshRed(1),e.refreshInfo(e.m_numPickVip,t)}))},onDestroy:function(){}}),cc._RF.pop()},{menu:void 0}],rechargePage:[function(e,t){"use strict";cc._RF.push(t,"1ee19fDbNFP8qkvQHI3XdLx","rechargePage");var a=[{iconPath:"shangchuan_icon_03",spinePath:"pt",pickPath:"shangchuan_icon_03",labelPath:"tx_ptsc",page:"rechargenormalpage",pageParam:null,click:"shangchuan_normal",childPages:[{iconPath:"pay_icon_05",pickPath:"pay_icon_05",labelPath:"windows_switch_tx_yuanbaolibao",page:"rechargenormalpageczyb",pageParam:null,coin:[38005,38006]}],coin:[38005,38006]}],i=[{iconPath:"shangchuan_icon_04",spinePath:"xs",pickPath:"shangchuan_icon_04",labelPath:"tx_xssc",page:"rechargefixtimepage",pageParam:null,click:"shangchuan_xianshi",childPages:[{name:"mssq",iconPath:"shouchong_icon_02",pickPath:"shouchong_icon_02",labelPath:"windows_switch_tx_mssq",page:"rechargefixtimepagemssq",pageParam:null,click:"mansongshenqi",coin:[38005,38006]},{name:"dzlb",iconPath:"shouchong_icon_04",pickPath:"shouchong_icon_04",labelPath:"windows_switch_tx_dingzhilibao",page:"rechargefixtimepageczlb",pageParam:null,click:"dingzhilibao",coin:[38005,38006]},{name:"dwlb",iconPath:"shouchong_icon_05",pickPath:"shouchong_icon_05",labelPath:"windows_switch_tx_duanwulibao",page:"rechargenormalpagedwlb",pageParam:null,click:"duanwulibao",coin:[38005,38006]}],coin:[38005,38006]},{iconPath:"shangchuan_icon_03",spinePath:"pt",pickPath:"shangchuan_icon_03",labelPath:"tx_ptsc",page:"rechargenormalpage",click:"shangchuan_normal",pageParam:null,childPages:[{name:"mrlb",iconPath:"pay_icon_01",pickPath:"pay_icon_01",labelPath:"windows_switch_tx_rilibao",page:"rechargenormalpagemrlb",pageParam:null,click:"dailygift",coin:[38005,38006]},{name:"mzlb",iconPath:"pay_icon_04",pickPath:"pay_icon_04",labelPath:"windows_switch_tx_zhoulibao",page:"rechargenormalpagemzlb",pageParam:null,click:"weekgift",coin:[38005,38006]},{name:"mylb",iconPath:"pay_icon_02",pickPath:"pay_icon_02",labelPath:"windows_switch_tx_yuelibao",page:"rechargenormalpagemylb",pageParam:null,click:"monthgift",coin:[38005,38006]},{name:"yblb",iconPath:"pay_icon_05",pickPath:"pay_icon_05",labelPath:"windows_switch_tx_yuanbaolibao",page:"rechargenormalpageczyb",pageParam:null,click:"rechargeyuanbao",coin:[38005,38006]},{name:"viplb",iconPath:"pay_icon_03",pickPath:"pay_icon_03",labelPath:"windows_switch_tx_bawanglibao",page:"rechargenormalpagebwlb",pageParam:null,click:"vipgift",coin:[38005,38006]}],coin:[38005,38006]},{iconPath:"shangchuan_icon_02",spinePath:"fl",pickPath:"shangchuan_icon_02",labelPath:"tx_flsc",page:"rechargewelfarepage",pageParam:null,click:"shangchuan_fuli",childPages:[{name:"tqlb",iconPath:"pay_btn_icon_001",pickPath:"pay_btn_icon_001",labelPath:"windows_switch_tx_tequanlibao",page:"rechargewelfarepagetqlb",pageParam:null,click:"tequangift",coin:[38005,38006]},{name:"thlb",iconPath:"pay_btn_icon_002",pickPath:"pay_btn_icon_002",labelPath:"windows_switch_tx_tehuilibao",page:"rechargewelfarepagethlb",pageParam:null,click:"tehuigift",coin:[38005,38006]},{name:"yk",iconPath:"pay_icon_09",pickPath:"pay_icon_09",labelPath:"windows_switch_tx_yueka",page:"rechargewelfarepageyk",pageParam:null,click:"mcardgift",coin:[38005,38006]},{name:"czjj",iconPath:"pay_btn_icon_005",pickPath:"pay_btn_icon_005",labelPath:"windows_switch_tx_chengzhangjijin",page:"rechargewelfarepageczjj",pageParam:null,click:"gzjjgift",coin:[38005,38006]}],coin:[38005,38006]},{iconPath:"shangchuan_icon_01",spinePath:"",pickPath:"shangchuan_icon_01",labelPath:"tx_sjg",page:"expeditionbountypage",pageParam:null,click:"shangchuan_shagnjin",childPages:[{name:"yzsjg",iconPath:"pay_btn_icon_008",pickPath:"pay_btn_icon_008",labelPath:"tx_yuanzhengshangjin",page:"expeditionbountypage",pageParam:null,click:"yuanzhengshangjin",coin:[38005,38006]},{name:"rwsjg",iconPath:"pay_btn_icon_009",pickPath:"pay_btn_icon_009",labelPath:"tx_richangshangjin",page:"rechargebountypage",pageParam:null,click:"renwujin",coin:[38005,38006]}],coin:[38005,38006]}],n=cc.Class({extends:e("basePage"),statics:{prefabPath:"rechargepage"},properties:{p_nodeBg:cc.Node,p_arrCoinNode:[cc.Node],p_commonTopNode:cc.Node,p_menuSubNode:cc.Node,p_menuSubItem:cc.Node,p_menuDownPanelPage:cc.Node,p_menuDownLine:cc.Node,p_followMoveNodes:[cc.Node],p_menuContent:cc.Node,p_menuItem:cc.Node,p_menuContentLab:cc.Node,p_menuItemLab:cc.Node},onLoad:function(){n.instance=this,this.stopBgNodeEvent(),this.creatMask(),this.fitTopMenu(),this.handleUI(),this.m_arrMenuItems=[],this.m_arrMenuLabelItems=[],this.m_arrsubMenuItems=[],this.m_arrMenuItems.push(this.p_menuItem),this.m_arrMenuLabelItems.push(this.p_menuItemLab),this.m_arrsubMenuItems.push(this.p_menuSubItem)},onEnable:function(){this._super(),eventMgr.on(eventStr.redEvent.RefreshRechargeRed,this.refreshMenuRed,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.redEvent.RefreshRechargeRed,this.refreshMenuRed,this)},handleUI:function(){var e=this;this._super(),this.m_isMove=!1,this.p_menuDownPanelPage.on("touchmove",function(t){e.moveMapByTouch(t)}),this.p_menuDownPanelPage.on("touchend",function(){e.m_isMove=!1})},setParam:function(e){this.m_menuDatas=gUtils.deepClone(i),gSetting.funofhide?this.m_menuDatas=gUtils.deepClone(a):(0===app.player.bountyend&&0===app.player.mazeend&&this.m_menuDatas.pop(),app.pages.rechargefixtimepagemssq.isOver()&&this.m_menuDatas[0].childPages.shift(),app.pages.rechargenormalpagedwlb.isOpen()||this.m_menuDatas[0].childPages.pop());var t=1,n=0;if(e)for(var r=0;r<this.m_menuDatas.length;r++){var o=this.m_menuDatas[r].childPages;if(o)for(var s=0;s<o.length;s++)if(e==o[s].name){t=r,n=s;break}}gSetting.funofhide&&(t=0,n=0),this.canSelectMenu=!0,this.m_numMenuIndex=t,this.currentPageData={},this.initMenu(),this.setMenuIndex(t,n)},moveMapByTouch:function(e){var t=this;if(e.getLocation&&!(Math.abs(e.getLocation().x-e.getStartLocation().x)<=6)){this.m_isMove=!0;var a=e.getDelta();this.setNodeMove(this.p_menuDownLine.x,a.x,this.p_menuDownLine,1,-cc.winSize.width/2-50,cc.winSize.width/2-this.p_menuDownLine.width),this.p_followMoveNodes.forEach(function(e,i){var n=.6-.1*i;n=Math.max(n,0),t.setNodeMove(e.x,a.x,e,n)})}},setNodeMove:function(e,t,a,i,n,r){void 0===i&&(i=1);var o=void 0!==n?n:(a.width-cc.winSize.width)/2,s=void 0!==r?r:(-a.width+cc.winSize.width)/2;e+=t*i,e=Math.min(o,e),e=Math.max(s,e),a.x=e},refreshUI:function(){this.m_arrCoin=this.currentPageData.coin,this.refreshCoinUI(),this.refreshMenuRed()},initMenu:function(){var e=this;this.p_menuContent.width=this.m_menuDatas.length*(this.p_menuItem.width+60),this.p_menuDownLine.width=this.p_menuContent.x+this.p_menuContent.width;for(var t=function(t){var a=e.m_arrMenuItems[t];a||((a=cc.instantiate(e.p_menuItem)).parent=e.p_menuContent,e.m_arrMenuItems.push(a));var i=e.m_arrMenuLabelItems[t];i||((i=cc.instantiate(e.p_menuItemLab)).parent=e.p_menuContentLab,e.m_arrMenuLabelItems.push(i));var n=e.p_menuItem.width/2+(60+e.p_menuItem.width)*t;i.setPosition(n,e.p_menuItemLab.y),a.setPosition(n,e.p_menuItem.y),a.active=!0;var r=gConfig.getNewRechargeIconPath(e.m_menuDatas[t].iconPath),o=gConfig.getNewRechargeIconPath(e.m_menuDatas[t].labelPath),s=a.getChildByName("spr_icon").getComponent(cc.Sprite),p=a.getChildByName("spr_spine").getComponent(sp.Skeleton);e.m_menuDatas[t].spinePath?app.loadSpine("game_ui_spine/chuan/chuan",p,function(){p.setAnimation(0,e.m_menuDatas[t].spinePath,!0)},null,e.prefabPath):app.loadTexture(r,s,e.prefabPath);var c=i.getChildByName("spr_label").getComponent(cc.Sprite);app.loadTexture(o,c,e.prefabPath),a.targetOff(),a.on("touchmove",function(t){e.moveMapByTouch(t)}),a.on("touchend",function(){e.m_isMove?e.m_isMove=!1:e.setMenuIndex(t,0,!0)})},a=0;a<this.m_menuDatas.length;a++)t(a);this.m_menuDatas.length>=4?this.p_menuDownLine.x=-600:this.p_menuDownLine.x=-450;for(var i=this.m_menuDatas.length;i<this.m_arrMenuItems.length;++i)this.m_arrMenuItems[i].active=!1},initSubMenu:function(){var e=this;if(this.m_menuDatas[this.m_numMenuIndex].childPages&&this.m_menuDatas[this.m_numMenuIndex].childPages.length>0){for(var t=this.m_menuDatas[this.m_numMenuIndex].childPages,a=function(a){var i=e.m_arrsubMenuItems[a];i||((i=cc.instantiate(e.p_menuSubItem)).parent=e.p_menuSubNode,e.m_arrsubMenuItems.push(i)),i.active=!0;var n=gConfig.getNewRechargeIconPath(t[a].iconPath),r=gConfig.getNewRechargeIconPath(t[a].pickPath),o=gConfig.getNewRechargeIconPath(t[a].labelPath),s=i.getChildByName("spr_icon").getComponent(cc.Sprite),p=i.getChildByName("spr_bg_light").getChildByName("spr_icon").getComponent(cc.Sprite),c=i.getChildByName("spr_label").getComponent(cc.Sprite);app.loadTexture(n,s,e.prefabPath),app.loadTexture(r,p,e.prefabPath),app.loadTexture(o,c,e.prefabPath),i.targetOff(),i.on("click",function(){e.setSubMenuIndex(a,!0)})},i=0;i<t.length;i++)a(i);for(var n=t.length;n<this.m_arrsubMenuItems.length;++n)this.m_arrsubMenuItems[n].active=!1}else this.m_arrsubMenuItems.forEach(function(e){e.active=!1})},refreshCoinUI:function(){for(var e=0;e<this.m_arrCoin.length;++e){var t=this.m_arrCoin[e],a=this.p_arrCoinNode[e];a.active=!0;var i=a.getChildByName("spr_prop_item").getComponent(cc.Sprite),n=a.getChildByName("lab_prop_num").getComponent(cc.Label),r=app.db.getPropsIconPath(t);app.loadTexture(r,i,this.prefabPath),n.string=gUtils.showNum(app.player.getCount(t))}for(var o=this.m_arrCoin.length;o<this.p_arrCoinNode.length;++o)this.p_arrCoinNode[o].active=!1},openShopPage:function(){var e=this;if(this.currentPageData&&this.currentPageData.page){this.canSelectMenu=!1;var t=app.pages[this.currentPageData.page],a=function(){t.showPage(e.currentPageData.pageParam,e.p_nodeBg,function(a){a?e.canSelectMenu=!0:(e.m_showPage=t.instance,t.instance.p_bgNode?(e.m_showPageNode=e.m_showPage.p_bgNode,e.m_showPageNode.opacity=0,e.m_showPageNode.runAction(cc.sequence(cc.fadeIn(.15),cc.callFunc(function(){e.canSelectMenu=!0})))):e.canSelectMenu=!0)})};if(this.m_showPage){if(this.m_showPage.node.active=!0,this.m_showPageNode=this.m_showPage.p_bgNode,!this.m_showPageNode)return this.m_showPage.onClose(),this.m_showPage=null,void a();this.m_showPageNode.runAction(cc.sequence(cc.fadeOut(.1),cc.callFunc(function(){e.m_showPage.onClose(),e.m_showPage=null,a()})))}else a();this.refreshUI()}},setMenuIndex:function(e,t,a){void 0===t&&(t=0),void 0===a&&(a=!1),this.canSelectMenu&&(this.m_numMenuIndex==e&&a||(this.m_numMenuIndex=e,this.m_arrMenuItems.forEach(function(t,a){t.getComponent("menuBtnItem")&&t.getComponent("menuBtnItem").select(a==e)}),this.m_menuDatas[this.m_numMenuIndex].click&&app.player.sfClickEvent([this.m_menuDatas[this.m_numMenuIndex].click]),this.initSubMenu(),this.m_menuDatas[this.m_numMenuIndex].childPages&&this.m_menuDatas[this.m_numMenuIndex].childPages.length>0?this.setSubMenuIndex(t):(this.currentPageData=this.m_menuDatas[this.m_numMenuIndex],this.openShopPage())))},setSubMenuIndex:function(e,t){void 0===t&&(t=!1),this.canSelectMenu&&(this.m_numSubMenuIndex==e&&t||(this.m_numSubMenuIndex=e,this.m_arrsubMenuItems.forEach(function(t,a){t.getComponent("menuBtnItem")&&t.getComponent("menuBtnItem").select(a==e)}),this.m_menuDatas[this.m_numMenuIndex].childPages[e].click&&app.player.sfClickEvent([this.m_menuDatas[this.m_numMenuIndex].childPages[e].click]),this.currentPageData=this.m_menuDatas[this.m_numMenuIndex].childPages[e],this.openShopPage()))},refreshMenuRed:function(){for(var e=0;e<this.m_menuDatas.length;e++){var t=this.m_menuDatas[e],a=!1;if(t.childPages&&t.childPages.length>0)for(var i=0;i<t.childPages.length;i++){var n=t.childPages[i],r=!1;app.pages[n.page]&&app.pages[n.page].refreshRed&&(r=app.pages[n.page].refreshRed()),e==this.m_numMenuIndex&&this.m_arrsubMenuItems[i]&&this.m_arrsubMenuItems[i].getComponent("menuBtnItem").setRed(r),r&&(a=!0)}else app.pages[t.page]&&(a=app.pages[t.page].refreshRed());this.m_arrMenuItems[e]&&this.m_arrMenuItems[e].getComponent("menuBtnItem").setRed(a)}},onClose:function(){app.pages[this.currentPageData.page].instance&&cc.isValid(app.pages[this.currentPageData.page].instance.node)&&app.pages[this.currentPageData.page].instance.onClose(),this._super()}});n.refreshRed=function(e){for(var t=!1,a=0;a<i.length;a++){var n=i[a];if(n.childPages&&n.childPages.length>0)for(var r=0;r<n.childPages.length;r++){var o=n.childPages[r];if(app.pages[o.page]&&app.pages[o.page].refreshRed&&(t=app.pages[o.page].refreshRed()),t)break}else app.pages[n.page]&&(t=app.pages[n.page].refreshRed());if(t)break}return e&&(e.active=t),t},cc._RF.pop()},{basePage:void 0}],rechargeWelfarePageCJCZJJ:[function(e,t){"use strict";cc._RF.push(t,"e4f1e0UpB9GUaNXS9ysBj0f","rechargeWelfarePageCJCZJJ");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"rechargewelfarepagecjczjj"},properties:{p_giftView:cc.ScrollView,p_giftPrefab:cc.Prefab,p_btnGetCZLJ:cc.Button,p_merBar:cc.ProgressBar,p_barItem:cc.Node,p_czljNum:cc.Node},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.fitTopMenu(),this.starContentY=this.p_giftView.content.y,this.starBarY=this.p_merBar.node.y,this.handleUI(),this.m_arrGiftItems=[]},handleUI:function(){var e=this;this._super(),this.p_giftView.content.on("position-changed",function(){var t=e.p_giftView.content.y-e.starContentY;e.p_merBar.node.y=e.starBarY+t},this),this.p_btnGetCZLJ.node.on("click",function(){e.onClickBtnBuy()})},setParam:function(){this.m_type="czjj",this.initData(),this.m_arrData=this.setData(),this.m_freeData=app.db.dbFreeGift[this.m_type],this.refreshUI()},setData:function(){return app.db.dbMActivityGpT},refreshUI:function(){var e=this,t=0;if(this.p_merBar.active=this.m_arrData&&this.m_arrData.length>0,this.m_arrData&&this.m_arrData.length>0){for(var a=0,i=this.m_arrData[0].LEVEL,n=0;n<this.m_arrData.length;++n){var r=this.m_arrBarItems[n];r||((r=cc.instantiate(this.p_barItem)).parent=this.p_merBar.node,this.m_arrBarItems.push(r)),r.y=-140*n,r.getChildByName("pick").active=app.player.level>=this.m_arrData[n].LEVEL,r.getComponentInChildren(cc.Label).string=this.m_arrData[n].LEVEL,a=this.m_arrData[n].LEVEL,this.m_maxLevel=a,r.active=!0}var o=(this.m_arrData.length-1)*Math.abs(-140);this.p_merBar.node.height=o,this.p_merBar.totalLength=o,this.p_merBar.progress=(app.player.level-i)/(a-i)>1?1:(app.player.level-i)/(a-i);for(var s=this.m_arrData.length;s<this.m_arrBarItems.length;++s)this.m_arrBarItems[s].active=!1}else this.p_giftView.clear();if(this.m_freeData){var p=this.getGiftNode(t);p.active=!0,p.getComponent("rechargeCzjjListItem").refreshUI(this.m_freeData.ITEMS,this);var c=app.player.getCount(this.m_freeData.MARK)>0,h=0;!c&&app.player.level>=ele.LEVEL&&(h=1),c&&(h=2),p.getComponent("rechargeCzjjListItem").setStatue(h),p.getComponent("rechargeCzjjListItem").setRed(!c&&app.player.special.specialczh>0&&app.player.level>=ele.LEVEL),c||p.getChildByName("btn_get").on("click",function(){e.onFreeBuyClick()}),t++}if(this.m_arrData&&this.m_arrData.length>0){for(var l=0,g=function(){var a=e.m_arrData[l],i=e.getGiftNode(t);i.active=!0,i.getComponent("rechargeCzjjListItem").refreshUI({gsid:38005,count:a.YBNUM},e);var n=app.player.getCount(a.MARK)>a.NUM,r=0;!n&&app.player.level>=a.LEVEL&&(r=1),n&&(r=2),i.getComponent("rechargeCzjjListItem").setStatue(r),i.getComponent("rechargeCzjjListItem").setRed(!n&&app.player.special.specialczh>0&&app.player.level>=a.LEVEL),i.getChildByName("btn_get").on("click",function(){e.onBuyClick(a)}),t++};l<this.m_arrData.length;l++)g();for(var d=t>l?this.m_arrData.length+1:this.m_arrData.length;d<this.m_arrGiftItems.length;++d)this.m_arrGiftItems[d].active=!1}else this.m_arrGiftItems&&this.m_arrGiftItems.forEach(function(e,a){e.active=t>0&&0==a});this.p_czljNum.getComponent("num").init(app.db.dbRecharge.specialczh.PRICE),this.p_btnGetCZLJ.node.active=0==app.player.special.specialczh},initData:function(){this.m_arrBarItems||(this.m_arrBarItems=[],this.m_arrBarItems.push(this.p_barItem))},getGiftNode:function(e){var t=this.m_arrGiftItems[e];return t||((t=cc.instantiate(this.p_giftPrefab)).parent=this.p_giftView.content,this.m_arrGiftItems.push(t)),t.targetOff(),t},onBuyClick:function(e){var t=this;if(e)if(0!=app.player.special.specialczh)if(app.player.level<e.LEVEL)app.showNotice("\u5f53\u524d\u672a\u8fbe\u5230\u9886\u53d6\u7b49\u7ea7");else if(app.player.getCount(e.MARK)<e.NUM)app.showNotice("\u8bf7\u5148\u9886\u53d6\u4e0a\u4e00\u4e2a\u5956\u52b1");else if(app.player.getCount(e.MARK)>e.NUM)app.showNotice("\u5df2\u9886\u53d6\u8be5\u5956\u52b1");else{var a="mactivitygpH_reward_"+e.NUM;app.player.sfExchange(a,1,0,function(e){app.player.sfPlayerByParam(["others"],function(){app.pages.windowspagereward.showPage({showtype:1,reward:e}),t.refreshUI(),app.pages.premiumpage.instance.refreshCoinUI(),eventMgr.emit(eventStr.redEvent.RefreshPremiumRed)})})}else{var i={content:langMgr.getString("rechargeWelfarePageCZJJ",6),confirmcb:function(){t.onClickBtnBuy()},target:this};app.pages.windowspagetipsmsg.showPage(i)}},onFreeBuyClick:function(){var e=this;if(this.m_freeData)if(app.player.level<this.m_freeData.LIMITLEVEL)app.showNotice("\u5f53\u524d\u672a\u8fbe\u5230\u9886\u53d6\u7b49\u7ea7");else{var t="freegift_reward_"+this.m_freeData.MARK;app.player.sfExchange(t,1,0,function(t){app.player.sfPlayerByParam(["others"],function(){app.pages.windowspagereward.showPage({showtype:1,reward:t}),app.player.addItem(t),app.pages.premiumpage.instance.refreshCoinUI(),e.refreshUI(),eventMgr.emit(eventStr.redEvent.RefreshPremiumRed)})})}},payRefresh:function(){var e=this;this._payRefreshEnd||(this._payRefreshEnd=!0,app.player.sfPlayerData(function(){e.refreshUI(),eventMgr.emit(eventStr.redEvent.RefreshPremiumRed)}))},onClickBtnBuy:function(){var e=this;app.player.pay("specialczh",function(){e._payRefreshEnd=!1,e.schedule(e.payRefresh,1,3)},function(){e._payRefreshEnd=!1,console.log("\u652f\u4ed8\u53d6\u6d88or\u5931\u8d25")})},onClose:function(){this._super()}});a.refreshRed=function(e){for(var t=app.db.dbMActivityGpT,a=!1,i=0;i<t.length;i++){var n=t[i];if(a=app.player.getCount(n.MARK)<=n.NUM&&app.player.special.specialczh>0&&app.player.level>=n.LEVEL)break}return e&&(e.active=a),a},cc._RF.pop()},{basePage:void 0}],rechargeWelfarePageCZJJ:[function(e,t){"use strict";cc._RF.push(t,"ef819/I9/BNs6B1jeECsUbL","rechargeWelfarePageCZJJ");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"rechargewelfarepageczjj",pageParent:"bountyczjjpage"},properties:{p_giftView:cc.ScrollView,p_giftPrefab:cc.Prefab,p_btnGetCZLJ:cc.Button,p_merBar:cc.ProgressBar,p_barItem:cc.Node,p_currentLevel:cc.Label,p_btnToBattle:cc.Button,p_nodeMenu:cc.Node,p_labAmount:cc.Label},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.fitTopMenu(),this.starContentY=this.p_giftView.content.y,this.starBarY=this.p_merBar.node.y,this.handleUI(),this.m_menu=this.p_nodeMenu.getComponent("menu"),this.m_menu.init(this),this.m_arrGiftItems=[]},onEnable:function(){this._super(),eventMgr.on(eventStr.rechargeCzjj.RefershCzjjUI,this.refreshUI,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.rechargeCzjj.RefershCzjjUI,this.refreshUI,this)},handleUI:function(){var e=this;this._super(),this.p_giftView.content.on("position-changed",function(){var t=e.p_giftView.content.y-e.starContentY;e.p_merBar.node.y=e.starBarY+t},this),this.p_btnGetCZLJ.node.on("click",function(){e.showWindowsRecharge()}),this.p_btnToBattle.node.on("click",function(){e.onClickBtnbattle()})},setParam:function(){this.m_type="czjj",this.initData();for(var e=0,t=0;t<this.m_arrCzjjData.length&&app.player.level>=this.m_arrCzjjData[t][this.m_arrCzjjData[t].length-1].LEVEL;t++)e++;e&&e++;for(var a=e=Math.min(e,this.m_arrCzjjData.length);a<this.m_menu.p_arrBtnMenu.length;a++)this.m_menu.p_arrBtnMenu[a].active=!1;this.m_handleItemBtn=!1,this.m_menu.setMenuIndex(0)},menuHandler:function(e){return this.m_index!=e&&(this.m_index=e,this.m_arrData=this.setData(e),this.m_arrFreeData=this.setFreeData(e),this.refreshUI(),!0)},setData:function(e){return this.m_arrCzjjData[e]},setFreeData:function(e){return this.m_arrCzjjFreeData[e]},refreshUI:function(){var e=this;if(this.p_labAmount.string="\xa5"+app.db.dbRecharge.specialcz.PRICE,this.p_currentLevel.string=langMgr.getString("rechargeWelfarePageCZJJ",5,app.player.level),this.p_merBar.active=this.m_arrData&&this.m_arrData.length>0,this.m_arrData&&this.m_arrData.length>0){for(var t=0,a=(this.m_arrData[0].LEVEL,0);a<this.m_arrData.length;++a){var i=this.m_arrBarItems[a];i||((i=cc.instantiate(this.p_barItem)).parent=this.p_merBar.node,this.m_arrBarItems.push(i)),i.y=-145*a,i.getChildByName("pick").active=app.player.level>=this.m_arrData[a].LEVEL,i.getComponentInChildren(cc.Label).string=this.m_arrData[a].LEVEL,i.getChildByName("pick").getChildByName("lab_num").getComponent(cc.Label).string=this.m_arrData[a].LEVEL,t=this.m_arrData[a].LEVEL,this.m_maxLevel=t,i.active=!0}var n=(this.m_arrData.length-1)*Math.abs(-145);this.p_merBar.node.height=n,this.p_merBar.totalLength=n;for(var r=-1,o=0;o<this.m_arrData.length;o++){if(!(app.player.level>=this.m_arrData[o].LEVEL)){r<0&&(r=0);break}r++}var s=0;r?(s=r/(this.m_arrData.length-1),r<this.m_arrData.length-1&&(s+=(app.player.level-this.m_arrData[r].LEVEL)/(this.m_arrData[r+1].LEVEL-this.m_arrData[r].LEVEL)/(this.m_arrData.length-1))):s=0,this.p_merBar.progress=s;for(var p=this.m_arrData.length;p<this.m_arrBarItems.length;++p)this.m_arrBarItems[p].active=!1}else this.p_giftView.clear();var c=0;if(this.m_arrData&&this.m_arrData.length>0){for(var h=0,l=-1,g=-1;h<this.m_arrData.length;h++){var d=this.m_arrData[h],u=this.m_arrFreeData[h],f=this.getGiftNode(c);f.active=!0,f.getComponent("rechargeCzjjListItem").refreshUI({gsid:38005,count:d.YBNUM},this),f.getComponent("rechargeCzjjListItem").refreshUIFree({gsid:u.GSID,count:u.COUNT},this);var m=app.player.getCount(u.MARK)>u.NUM,_=app.player.getCount(d.MARK)>d.NUM,v=0;app.player.level>=d.LEVEL?v=1:-1==g&&(g=h),m&&!_&&(v=2),m&&_&&(v=3);var b="specialcz";d.STAGE&&d.STAGE>1&&(b="specialcz"+(d.STAGE-1));var y=!m&&app.player.level>=d.LEVEL||!_&&app.player.special[b]&&app.player.level>=d.LEVEL;y&&-1==l&&(l=h),f.getComponent("rechargeCzjjListItem").setStatue(v,m,_),f.getComponent("rechargeCzjjListItem").setRed(y),f.getComponent("rechargeCzjjListItem").setBtnStatue(u,d,v,"CZJJ"),c++}this.m_handleItemBtn=!0;for(var P=c>h?this.m_arrData.length+1:this.m_arrData.length;P<this.m_arrGiftItems.length;++P)this.m_arrGiftItems[P].active=!1;this.scheduleOnce(function(){-1==l&&(l=g);var t=e.p_giftPrefab.data.height*Math.max(l-1,0);e.p_giftView.scrollToOffset(cc.Vec2(0,t))},.1)}else this.m_arrGiftItems&&this.m_arrGiftItems.forEach(function(e,t){e.active=c>0&&0==t});var w="specialcz";this.m_index&&(w+=this.m_index),this.p_btnGetCZLJ.node.active=!app.player.special[w]},initData:function(){if(this.m_arrBarItems||(this.m_arrBarItems=[],this.m_arrBarItems.push(this.p_barItem)),!this.m_arrCzjjData){this.m_arrCzjjData=[];for(var e=0;e<app.db.dbMActivityGp.length;e++){var t=app.db.dbMActivityGp[e];null==this.m_arrCzjjData[t.STAGE-1]&&(this.m_arrCzjjData[t.STAGE-1]=[]),this.m_arrCzjjData[t.STAGE-1].push(t)}}if(!this.m_arrCzjjFreeData){this.m_arrCzjjFreeData=[];for(var a=0;a<app.db.dbMActivityGpFree.length;a++){var i=app.db.dbMActivityGpFree[a];null==this.m_arrCzjjFreeData[i.STAGE-1]&&(this.m_arrCzjjFreeData[i.STAGE-1]=[]),this.m_arrCzjjFreeData[i.STAGE-1].push(i)}}},getGiftNode:function(e){var t=this.m_arrGiftItems[e];return t||((t=cc.instantiate(this.p_giftPrefab)).parent=this.p_giftView.content,this.m_arrGiftItems.push(t)),t.targetOff(),t},onBuyClick:function(e,t,a){var i=this;if(t||e)if(1==a){if(console.log(app.player.getCount(e.MARK)),app.player.level<e.LEVEL)return void app.showNotice(langMgr.getString("rechargeWelfarePageCZJJ",3));if(app.player.getCount(e.MARK)<e.NUM)return void app.showNotice(langMgr.getString("rechargeWelfarePageCZJJ",4));if(app.player.getCount(e.MARK)>e.NUM)return;var n="mactivitygpFree_reward_"+e.NUM;app.player.sfExchange(n,1,0,function(e){app.player.sfPlayerByParam(["others"],function(){app.pages.windowspagereward.showPage({showtype:1,reward:e}),i.refreshUI(),app.pages.premiumpage.instance.refreshCoinUI(),eventMgr.emit(eventStr.redEvent.RefreshPremiumRed)})})}else if(2==a){if(console.log(app.player.getCount(t.MARK)),!app.player.special.specialcz){var r={content:"\u60a8\u5f53\u524d\u672a\u8d2d\u4e70\u6210\u957f\u57fa\u91d1\uff0c\u662f\u5426\u8981\u82b1\u8d39128\u5143\u8d2d\u4e70\u6210\u957f\u57fa\u91d1\u9886\u53d6\u7279\u6743\uff1f",confirmcb:function(){i.onClickBtnBuy()},target:this};return void app.pages.windowspagetipsmsg.showPage(r)}if(app.player.level<t.LEVEL)return void app.showNotice(langMgr.getString("rechargeWelfarePageCZJJ",3));if(app.player.getCount(t.MARK)<t.NUM)return void app.showNotice(langMgr.getString("rechargeWelfarePageCZJJ",4));if(app.player.getCount(t.MARK)>t.NUM)return;var o="mactivitygp_reward_"+t.NUM;app.player.sfExchange(o,1,0,function(e){app.player.sfPlayerByParam(["others"],function(){app.pages.windowspagereward.showPage({showtype:1,reward:e}),i.refreshUI(),app.pages.premiumpage.instance.refreshCoinUI(),eventMgr.emit(eventStr.redEvent.RefreshPremiumRed)})})}},payRefresh:function(){var e=this;this._payRefreshEnd||(this._payRefreshEnd=!0,app.player.sfPlayerData(function(){e.refreshUI(),eventMgr.emit(eventStr.redEvent.RefreshPremiumRed)}))},showWindowsRecharge:function(){app.playSound("click"),app.pages.windowspagerechargeczjj.showPage({array:this.m_arrData,type:0,index:this.m_index})},onClickBtnBuy:function(){var e=this,t="specialcz";this.m_index&&(t+=this.m_index),app.player.pay(t,function(){e._payRefreshEnd=!1,e.schedule(e.payRefresh,1,3)},function(){e._payRefreshEnd=!1,console.log("\u652f\u4ed8\u53d6\u6d88or\u5931\u8d25")})},onClickBtnbattle:function(){app.goToPage(1001),app.playMusic("city",!0)},onClose:function(){this._super()}});a.refreshRed=function(e){for(var t=app.db.dbMActivityGp,a=app.db.dbMActivityGpFree,i=!1,n=0;n<t.length;n++){var r=t[n],o=a[n],s="specialcz";r.STAGE&&r.STAGE>1&&(s="specialcz"+(r.STAGE-1));var p=app.player.getCount(r.MARK)<=r.NUM&&app.player.special[s]&&app.player.level>=r.LEVEL,c=app.player.getCount(o.MARK)<=o.NUM&&app.player.level>=o.LEVEL;if(i=p||c)break}return e&&(e.active=i),i},cc._RF.pop()},{basePage:void 0}],rechargeWelfarePageJthl:[function(e,t){"use strict";cc._RF.push(t,"2957fkMjmVJ55XuW37UFzfn","rechargeWelfarePageJthl");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"rechargewelfarepagejthl",pageParent:"premiumpage"},properties:{p_scrView:cc.ScrollView,p_nodeItem:cc.Node,p_btnHelp:cc.Button},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.fitTopMenu(),this.p_btnHelp.node.on("click",function(){app.pages.windowspagetipshelp.showPage(1075)}),eventMgr.on(eventStr.rechargeJthl.RefershJthlUI,this.setParam,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.rechargeJthl.RefershJthlUI,this.setParam,this)},setParam:function(){var e=this;app.player.sfJthlInfo(function(t,a){t||(e.m_arrData=a,e.refreshUI())},"forever")},refreshUI:function(){this.m_arrData&&(this.refreshSView(this.m_arrData),eventMgr.emit(eventStr.redEvent.RefreshActivityRed))},refreshSView:function(e){this.m_arrItems||(this.m_arrItems=[],this.m_arrItems.push(this.p_nodeItem));for(var t=0;t<e.length;++t){var a=this.m_arrItems[t];a||((a=cc.instantiate(this.p_nodeItem)).parent=this.p_scrView.content,this.m_arrItems.push(a)),a.active=!0}for(var i=0;i<e.length;++i)this.m_arrItems[i].getComponent("rechargeWelfareJthlItem").refreshUI(e[i],i);for(var n=e.length;n<this.m_arrItems.length;++n)this.m_arrItems[n].active=!1}});a.refreshRed=function(e){var t=!1,a=app.getRedInfoByObj(["act","jthl1"],null);return null!=a&&(t=a>0),e&&(e.active=t),t},cc._RF.pop()},{basePage:void 0}],rechargeWelfarePageMrlc:[function(e,t){"use strict";cc._RF.push(t,"91119jV6+FBh4g35TRio2uj","rechargeWelfarePageMrlc");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"rechargewelfarepagemrlc",pageParent:"premiumpage"},properties:{p_scrView:cc.ScrollView,p_nodeItem:cc.Node,p_btnHelp:cc.Button},onLoad:function(){a.instance=this,app.OBJACTIVITYFIRSTOPENCACHE.WelfarePageMrlcBfo=!1,eventMgr.emit(eventStr.redEvent.RefreshActivityRed),this.stopBgNodeEvent(),this.fitTopMenu(),this.p_btnHelp.node.on("click",function(){app.playSound("click"),app.pages.windowspagetipshelp.showPage(1093)})},setParam:function(){var e=this;app.player.sfMrlcInfo(function(t,a){if(!t){e.m_arrData=a;for(var i=0;i<e.m_arrData.length;++i)e.m_arrData[i].index=i;e.refreshUI()}})},refreshUI:function(){this.m_arrData&&(this.refreshSView(),eventMgr.emit(eventStr.redEvent.RefreshPremiumRed))},refreshSView:function(){this.m_arrData.sort(function(e,t){return 2==e.state&&2!=t.state?1:2!=e.state&&2==t.state?-1:0}),this.m_arrItems||(this.m_arrItems=[],this.m_arrItems.push(this.p_nodeItem));for(var e=0;e<this.m_arrData.length;++e){var t=this.m_arrItems[e];t||((t=cc.instantiate(this.p_nodeItem)).parent=this.p_scrView.content,this.m_arrItems.push(t)),t.active=!0}for(var a=0;a<this.m_arrData.length;++a)this.m_arrItems[a].getComponent("rechargeWelfareMrlcItem").refreshUI(this.m_arrData[a]);for(var i=this.m_arrData.length;i<this.m_arrItems.length;++i)this.m_arrItems[i].active=!1}});a.refreshRed=function(e){var t;return t=(app.getRedInfoByObj(["act","daycharge"],null)||0)>0,e&&(e.active=t),t},cc._RF.pop()},{basePage:void 0}],rechargeWelfarePageSLJJ:[function(e,t){"use strict";cc._RF.push(t,"ad17fIC3ThIQbyyPVzVRcUJ","rechargeWelfarePageSLJJ");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"rechargewelfarepagesljj",pageParent:"bountyczjjpage"},properties:{p_giftView:cc.ScrollView,p_giftPrefab:cc.Prefab,p_btnGetSLJJ:cc.Button,p_merBar:cc.ProgressBar,p_barItem:cc.Node,p_currentTower:cc.Label,p_btnToBattle:cc.Button,p_nodeMenu:cc.Node,p_labAmount:cc.Label},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.fitTopMenu(),this.starContentY=this.p_giftView.content.y,this.starBarY=this.p_merBar.node.y,this.handleUI(),this.m_menu=this.p_nodeMenu.getComponent("menu"),this.m_menu.init(this),this.m_arrGiftItems=[]},onEnable:function(){this._super(),eventMgr.on(eventStr.rechargeCzjj.RefershSljjUI,this.refreshUI,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.rechargeCzjj.RefershSljjUI,this.refreshUI,this)},handleUI:function(){var e=this;this._super(),this.p_giftView.content.on("position-changed",function(){var t=e.p_giftView.content.y-e.starContentY;e.p_merBar.node.y=e.starBarY+t},this),this.p_btnGetSLJJ.node.on("click",function(){e.showWindowsRecharge()}),this.p_btnToBattle.node.on("click",function(){e.onClickBtnbattle()})},setParam:function(){this.m_type="sljj",this.initData();for(var e=0,t=0;t<this.m_arrSljjData.length&&app.player.tower>=this.m_arrSljjData[t][this.m_arrSljjData[t].length-1].TOWER;t++)e++;e&&e++;for(var a=e=Math.min(e,this.m_arrSljjData.length);a<this.m_menu.p_arrBtnMenu.length;a++)this.m_menu.p_arrBtnMenu[a].active=!1;this.m_handleItemBtn=!1,this.m_menu.setMenuIndex(0)},menuHandler:function(e){return this.m_index!=e&&(this.m_index=e,this.m_arrData=this.setData(e),this.m_arrFreeData=this.setFreeData(e),this.refreshUI(),!0)},setData:function(e){return this.m_arrSljjData[e]},setFreeData:function(e){return this.m_arrSljjFreeData[e]},refreshUI:function(){var e=this;this.p_labAmount.string="\xa5"+app.db.dbRecharge.specialcz.PRICE;var t=0;if(this.p_currentTower.string=langMgr.getString("rechargeWelfarePageSLJJ",2,app.player.tower-1),this.p_merBar.active=this.m_arrData&&this.m_arrData.length>0,this.m_arrData&&this.m_arrData.length>0){for(var a=0,i=(this.m_arrData[0].TOWER,0);i<this.m_arrData.length;++i){var n=this.m_arrBarItems[i];n||((n=cc.instantiate(this.p_barItem)).parent=this.p_merBar.node,this.m_arrBarItems.push(n)),n.y=-145*i,n.getChildByName("pick").active=app.player.tower-1>=this.m_arrData[i].TOWER,n.getComponentInChildren(cc.Label).string=this.m_arrData[i].TOWER,n.getChildByName("pick").getChildByName("lab_num").getComponent(cc.Label).string=this.m_arrData[i].TOWER,a=this.m_arrData[i].TOWER,this.m_maxTower=a,n.active=!0}var r=(this.m_arrData.length-1)*Math.abs(-145);this.p_merBar.node.height=r,this.p_merBar.totalLength=r;for(var o=-1,s=0;s<this.m_arrData.length;s++){if(!(app.player.tower>=this.m_arrData[s].TOWER)){o<0&&(o=0);break}o++}var p=0;o?(p=o/(this.m_arrData.length-1),o<this.m_arrData.length-1&&(p+=(app.player.tower-this.m_arrData[o].TOWER)/(this.m_arrData[o+1].TOWER-this.m_arrData[o].TOWER)/(this.m_arrData.length-1))):p=0,this.p_merBar.progress=p;for(var c=this.m_arrData.tower;c<this.m_arrBarItems.tower;++c)this.m_arrBarItems[c].active=!1}else this.p_giftView.clear();if(this.m_arrData&&this.m_arrData.length>0){for(var h=0,l=-1,g=-1;h<this.m_arrData.length;h++){var d=this.m_arrData[h],u=this.m_arrFreeData[h],f=this.getGiftNode(t);f.active=!0,f.getComponent("rechargeCzjjListItem").refreshUI({gsid:d.GSID0,count:d.COUNT0},this),f.getComponent("rechargeCzjjListItem").refreshUIExtra({gsid:d.GSID1,count:d.COUNT1},this),f.getComponent("rechargeCzjjListItem").refreshUIFree({gsid:u.GSID,count:u.COUNT},this);var m=app.player.getCount(u.MARK)>u.NUM,_=app.player.getCount(d.MARK)>d.NUM,v=0;app.player.tower-1>=d.TOWER?v=1:-1==g&&(g=h),m&&!_&&(v=2),m&&_&&(v=3);var b="specialtower";d.STAGE&&d.STAGE>1&&(b="specialtower"+(d.STAGE-1));var y=!m&&app.player.tower-1>=d.TOWER||!_&&app.player.special[b]&&app.player.tower-1>=d.TOWER;y&&-1==l&&(l=h),f.getComponent("rechargeCzjjListItem").setStatue(v,m,_),f.getComponent("rechargeCzjjListItem").setRed(y),f.getComponent("rechargeCzjjListItem").setBtnStatue(u,d,v,"SLJJ"),t++}this.m_handleItemBtn=!0;for(var P=t>h?this.m_arrData.length+1:this.m_arrData.length;P<this.m_arrGiftItems.length;++P)this.m_arrGiftItems[P].active=!1;this.scheduleOnce(function(){-1==l&&(l=g);var t=e.p_giftPrefab.data.height*Math.max(l-1,0);e.p_giftView.scrollToOffset(cc.Vec2(0,t))},.1)}else this.m_arrGiftItems&&this.m_arrGiftItems.forEach(function(e,a){e.active=t>0&&0==a});this.m_index&&this.m_index,this.p_btnGetSLJJ.node.active=!app.player.special.specialtower},initData:function(){if(this.m_arrBarItems||(this.m_arrBarItems=[],this.m_arrBarItems.push(this.p_barItem)),!this.m_arrSljjData){this.m_arrSljjData=[];for(var e=0;e<app.db.dbMActivityGpT.length;e++){var t=app.db.dbMActivityGpT[e];null==this.m_arrSljjData[t.STAGE-1]&&(this.m_arrSljjData[t.STAGE-1]=[]),this.m_arrSljjData[t.STAGE-1].push(t)}}if(!this.m_arrSljjFreeData){this.m_arrSljjFreeData=[];for(var a=0;a<app.db.dbMActivityGpTFree.length;a++){var i=app.db.dbMActivityGpTFree[a];null==this.m_arrSljjFreeData[i.STAGE-1]&&(this.m_arrSljjFreeData[i.STAGE-1]=[]),this.m_arrSljjFreeData[i.STAGE-1].push(i)}}},getGiftNode:function(e){var t=this.m_arrGiftItems[e];return t||((t=cc.instantiate(this.p_giftPrefab)).parent=this.p_giftView.content,this.m_arrGiftItems.push(t)),t.targetOff(),t},onBuyClick:function(e,t,a){var i=this;if(t||e)if(console.log(a),1==a){if(console.log(app.player.getCount(e.MARK)),app.player.tower-1<e.TOWER)return void app.showNotice(langMgr.getString("rechargeWelfarePageSLJJ",0));if(app.player.getCount(e.MARK)<e.NUM)return void app.showNotice(langMgr.getString("rechargeWelfarePageSLJJ",1));if(app.player.getCount(e.MARK)>e.NUM)return;var n="mactivityGpTFree_reward_"+e.NUM;console.log(n),app.player.sfExchange(n,1,0,function(e){console.log(n),app.player.sfPlayerByParam(["others"],function(){app.pages.windowspagereward.showPage({showtype:1,reward:e}),i.refreshUI(),app.pages.premiumpage.instance.refreshCoinUI(),eventMgr.emit(eventStr.redEvent.RefreshPremiumRed)})})}else if(2==a){if(console.log(app.player.getCount(t.MARK)),0==app.player.special.specialtower){var r={content:langMgr.getString("rechargeWelfarePageSLJJ",3,app.db.dbRecharge.specialtower.PRICE),confirmcb:function(){i.onClickBtnBuy()},target:this};return void app.pages.windowspagetipsmsg.showPage(r)}if(app.player.tower-1<t.TOWER)return void app.showNotice(langMgr.getString("rechargeWelfarePageSLJJ",0));if(app.player.getCount(t.MARK)<t.NUM)return void app.showNotice(langMgr.getString("rechargeWelfarePageSLJJ",1));if(app.player.getCount(t.MARK)>t.NUM)return;var o="mactivityGpT_reward_"+t.NUM;app.player.sfExchange(o,1,0,function(e){app.player.sfPlayerByParam(["others"],function(){app.pages.windowspagereward.showPage({showtype:1,reward:e}),i.refreshUI(),app.pages.premiumpage.instance.refreshCoinUI(),eventMgr.emit(eventStr.redEvent.RefreshPremiumRed)})})}},payRefresh:function(){var e=this;this._payRefreshEnd||(this._payRefreshEnd=!0,app.player.sfPlayerData(function(){e.refreshUI(),eventMgr.emit(eventStr.redEvent.RefreshPremiumRed)}))},showWindowsRecharge:function(){app.playSound("click"),app.pages.windowspagerechargeczjj.showPage({array:this.m_arrData,type:1,index:this.m_index})},onClickBtnBuy:function(){var e=this,t="specialtower";this.m_index&&(t+=this.m_index),app.player.pay(t,function(){e._payRefreshEnd=!1,e.schedule(e.payRefresh,1,3)},function(){e._payRefreshEnd=!1,console.log("\u652f\u4ed8\u53d6\u6d88or\u5931\u8d25")})},onClickBtnbattle:function(){app.goToPage(1025)},onClose:function(){this._super()}});a.refreshRed=function(e){for(var t=app.db.dbMActivityGpT,a=app.db.dbMActivityGpTFree,i=!1,n=0;n<t.length;n++){var r=t[n],o=a[n],s="specialtower";r.STAGE&&r.STAGE>1&&(s="specialtower"+(r.STAGE-1));var p=app.player.getCount(r.MARK)<=r.NUM&&app.player.special[s]&&app.player.tower-1>=r.TOWER;if(i=app.player.getCount(o.MARK)<=o.NUM&&app.player.tower-1>=o.TOWER||p)break}return e&&(e.active=i),i},cc._RF.pop()},{basePage:void 0}],rechargeWelfarePageTHLB:[function(e,t){"use strict";cc._RF.push(t,"17931BqZNdDrrqv3OOFKcBK","rechargeWelfarePageTHLB");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"rechargewelfarepagethlb"},properties:{p_giftView:cc.ScrollView,p_giftPrefab:cc.Prefab,p_labTime:cc.Label},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.fitTopMenu(),this.handleUI(),this.m_arrGiftItems=[]},handleUI:function(){this._super()},setParam:function(){var e=this;if(this.m_time=0,this.isRTime=!1,app.player.sfCoinspackList(function(t,a){t?cc.log(t):(e.m_eTime=a.nextFreshTime,e.m_arrData=a.packGift,e.refreshUI())}),null==localDataUtils.GetValue("thlbred",null)){var t=app.player.getServerTime(),a=gUtils.getSecondDayTime(t);localDataUtils.SetValue("thlbred",1,a)}},refreshUI:function(){var e=this,t=0;if(this.m_arrData&&this.m_arrData.length>0){for(var a=0;a<this.m_arrData.length;a++){var i=this.m_arrData[a];i.index=a;var n=this.getGiftNode(t);n.active=!0;var r=i.PATH||i.path||"yuanbao_"+(a+1);n.getComponent("rechargeNormalItem").refreshUI({price:i.castitems[0].COUNT,coinType:0,rewards:i.items,limitNum:i.count,rewardIcon:r},this);var o=i.count<=0;n.getComponent("rechargeNormalItem").setGray(o),o||function(){var t=a;n.on("click",function(){e.onBuyClick(t)})}(),t++}for(var s=t>a?this.m_arrData.length+1:this.m_arrData.length;s<this.m_arrGiftItems.length;++s)this.m_arrGiftItems[s].active=!1}else this.m_arrGiftItems&&this.m_arrGiftItems.forEach(function(e,a){e.active=t>0&&0==a});this.isRTime=!0,this.m_time=1,this.refreshCoin()},refreshCoin:function(){this.m_nowShowCoinData||(this.m_nowShowCoinData=[{type:"yb",gsid:38005},{type:"gold",gsid:38006}]);var e=this.m_nowShowCoinData;this.node.getComponent("currency").refreshCoin(e)},getGiftNode:function(e){var t=this.m_arrGiftItems[e];return t||((t=cc.instantiate(this.p_giftPrefab)).parent=this.p_giftView.content,this.m_arrGiftItems.push(t)),t.targetOff(),t},onBuyClick:function(e){var t=this,a=this.m_arrData[e];if(a.count<=0)app.showNotice(langMgr.getString("rechargeWelfarePageTHLB",1));else{var i={rewards:a.items,title:langMgr.getString("rechargeWelfarePageTHLB",3),limitNum:a.count,buycb:function(){app.player.checkCount(a.castitems[0].GSID,a.castitems[0].COUNT)&&app.player.sfCoinspackBuy(a.id,function(e,i){if(e)app.showNotice(langMgr.getString("rechargeWelfarePageTHLB",2));else{var n={showtype:1,reward:i.items,target:t};app.pages.windowspagereward.showPage(n),app.player.reduceItem(a.castitems),app.player.addItem(i.items),t.m_arrData=i.packGift,eventMgr.emit(eventStr.redEvent.RefreshRechargeRed),t.refreshUI()}})},cancelcb:function(){},target:this};app.pages.windowspagerechargebuy.showPage(i)}},refreshTime:function(){var e=app.player.getServerTime(),t=this.m_eTime||0,a=t-e;(!t||a<0)&&(a=0),this.p_labTime.string=0!=a?langMgr.getString("rechargeWelfarePageTHLB",0,gUtils.getCountDownStr(a)):"00:00:00"},update:function(e){this.isRTime&&(this.m_time>1?(this.m_time=0,this.refreshTime()):this.m_time+=e)}});a.refreshRed=function(e){var t=!1;return null==localDataUtils.GetValue("thlbred",null)&&(t=!0),e&&(e.active=t),t},cc._RF.pop()},{basePage:void 0}],rechargeWelfarePageTQLB:[function(e,t){"use strict";cc._RF.push(t,"6dd0cIEd8pAq4AWYFxF56sf","rechargeWelfarePageTQLB");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"rechargewelfarepagetqlb",pageParent:"vipprivilegepage"},properties:{p_tabvRight:cc.tableView},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.fitTopMenu(),this.handleUI()},handleUI:function(){this._super()},setParam:function(){this.setData()},setData:function(){var e=[];for(var t in app.db.dbRight){var a=app.db.dbRight[t];e.push(a)}this.refreshUI(e)},refreshUI:function(e){if(e&&e.length>0){var t=e.length;this.p_tabvRight.getComponent("tableView").initTableView(t,{array:e,target:this})}else this.p_tabvRight.getComponent("tableView").clear()},refreshMenuRed:function(){return!1},onClose:function(){this._super()}});a.refreshRed=function(e){return e&&(e.active=!1),!1},cc._RF.pop()},{basePage:void 0}],rechargeWelfarePageYK:[function(e,t){"use strict";cc._RF.push(t,"3e212Fd8sFKzK/DTXxLziXA","rechargeWelfarePageYK");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"rechargewelfarepageyk",pageParent:"premiumpage"},properties:{p_arrCardNodes:[cc.Node]},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.fitTopMenu(),this.handleUI()},handleUI:function(){this._super()},setParam:function(){this.setData()},setData:function(){this.refreshUI()},refreshUI:function(){var e=this;this.p_arrCardNodes.forEach(function(t,a){t.getComponent("rechargeWelfareCardItem").refreshUI(app.db.dbMCard,a,e)})},refreshMenuRed:function(){return!1},onClose:function(){this._super()}});a.refreshRed=function(e){return e&&(e.active=!1),!1},cc._RF.pop()},{basePage:void 0}],rookieHandbookPage:[function(e,t){"use strict";function a(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(a)return(a=a.call(e)).next.bind(a);if(Array.isArray(e)||(a=i(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function i(e,t){if(e){if("string"==typeof e)return n(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?n(e,t):void 0}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,i=new Array(t);a<t;a++)i[a]=e[a];return i}function r(){return(r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e}).apply(this,arguments)}cc._RF.push(t,"fb4b2FdK45PZ60KBulyQAFe","rookieHandbookPage");var o=cc.Class({extends:e("basePage"),statics:{prefabPath:"rookiehandbookpage",pageType:1},properties:{p_menuTableView:cc.Node,p_name:cc.Label,p_lvLimit:cc.Label,p_describe:cc.Label,p_taskItem:cc.Node,p_taskListParent:cc.Node,p_rewardListParent:cc.Node,p_rewardItem:cc.Prefab,p_receiveBtn:cc.Button,p_sprDiagram:cc.Sprite},onLoad:function(){o.instance=this,this.setListData(),this.m_taskItemArr=[this.p_taskItem],this.m_rewardArr=[],this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},setListData:function(){var e=app.db.dbRookieHandbook,t=e.filter(function(e){return app.player.level<e.LIMIT}),a=e.filter(function(e){return app.player.level>=e.LIMIT}),i=a.filter(function(e){return e.TASK.every(function(t){return 3==app.player.getMissionState(r({},t,{GETMARK:e.GETMARK})).state})}),n=a.filter(function(e){return e.TASK.some(function(t){return 2==app.player.getMissionState(r({},t,{GETMARK:e.GETMARK})).state})}),o=a.filter(function(e){return e.TASK.every(function(t){return 1==app.player.getMissionState(r({},t,{GETMARK:e.GETMARK})).state})});this._dbData=[].concat(i,n,t,o)},handleUI:function(){var e=this;this._selectIndex=0,this.handleMenuUI(),this.p_receiveBtn.node.on("click",function(){app.playSound("click"),e.onClickBtnGet()})},handleMenuUI:function(){var e=this;this.p_menuTableView.getComponent("tableView").initTableView(this._dbData.length,{array:this._dbData,target:this},function(){e.selectMenu(0)})},selectMenu:function(e){this._selectIndex=e,this.refreshUI()},refreshUI:function(){var e=this,t=this._dbData[this._selectIndex];this.p_name.string=t.NAME,this.p_lvLimit.string=langMgr.getString("rookieHandbook",t.LIMIT>0?0:1,t.LIMIT),this.p_describe.string=t.INTRO,app.loadTexture(gConfig.getRookieHandbookImgPath(t.PIC_ID),this.p_sprDiagram,this.prefabPath),this._receiveState=[];for(var a,i=function(i,n){n=e.m_taskItemArr[i];var r=t.TASK[i];n||((n=cc.instantiate(e.p_taskItem)).parent=e.p_taskListParent,n.active=!0,e.m_taskItemArr[i]=n),n.IS_LISTEN||(n.getChildByName("goto_btn").getComponent(cc.Button).node.on("click",function(){return e._gotoPage(i)}),n.IS_LISTEN=!0),e.refreshTaskUI(i,n,r,t),a=n},n=0;n<t.TASK.length;n++)i(n,a);this.refreshReceiveBtnRed();for(var r,o=0;o<t.REWARD.length;o++)(r=this.m_rewardArr[o])||((r=cc.instantiate(this.p_rewardItem)).parent=this.p_rewardListParent,r.active=!0,r.scale=.7,this.m_rewardArr[o]=r),r.getComponent("propItem").initForBag(t.REWARD[o]),r.getComponent("propItem").setClick(!0);this.p_menuTableView.getComponent("tableView").getCells(function(e){e.filter(function(e){return cc.Node.isNode(e)}).map(function(e){var t=e.getComponent("rookieHandBookItem");cc.isValid(t)&&t.refreshUI()})})},refreshTaskUI:function(e,t,a,i){t.getChildByName("name").getComponent(cc.Label).string=a.TITLE;var n=app.player.getMissionState(r({},a,{GETMARK:i.GETMARK}));t.getChildByName("progress_bar").getComponent(cc.ProgressBar).progress=(n.now>n.end?n.end:n.now)/n.end,t.getChildByName("progress_num").getComponent(cc.Label).string=(n.now>n.end?n.end:n.now)+"/"+n.end,this._receiveState[e]=n.state;var o=t.getChildByName("goto_btn"),s=t.getChildByName("icon_finish");if(this._isLevelLock())o.active=!0,s.active=!1,o.getComponent(cc.Button).interactable=!1;else switch(o.getComponent(cc.Button).interactable=!0,n.state){case 1:o.active=!1,s.active=!0;break;case 2:o.active=!0,s.active=!1;break;case 3:o.active=!1,s.active=!0;break;default:o.active=!1,s.active=!1}},refreshReceiveBtnRed:function(){var e=this.p_receiveBtn,t=e.node.getChildByName("rednotice"),a=e.node.getChildByName("received"),i=e.node.getChildByName("notReceived");this._receiveState.every(function(e){return 1==e})?(e.interactable=!1,t.active=!1,a.active=!0,i.active=!1):(i.active=!0,a.active=!1,this._receiveState.some(function(e){return 3!==e})?(e.interactable=!1,t.active=!1,a.active=!1):(e.interactable=!0,t.active=!0,a.active=!1))},_gotoPage:function(e){var t=this._dbData[this._selectIndex].TASK[e];t&&t.GOTO&&(app.playSound("click"),app.goToPage(t.GOTO))},_isLevelLock:function(){return this._dbData[this._selectIndex].LIMIT>app.player.level},onClickBtnGet:function(){var e=this;if(!this._isLevelLock()){var t=this._dbData[this._selectIndex];app.player.sfExchange(t.EXID,1,null,function(t){for(var i,n=[],r=a(t);!(i=r()).done;){var o=i.value;93119!=(o.gsid||o.GSID)&&n.push(o)}var s={showtype:1,reward:n,confirmcb:function(){},target:e};e.refreshUI(),app.pages.windowspagereward.showPage(s),eventMgr.emit(eventStr.redEvent.RefreshRookieHandbookRed)})}},refreshRed:function(){},refreshMenuRed:function(){},setParam:function(){}});o.checkReward=function(){return app.db.dbRookieHandbook.some(function(e){return app.player.level>=e.LIMIT&&e.TASK.every(function(t){return 3==app.player.getMissionState(r({},t,{GETMARK:e.GETMARK})).state})})},o.showPage=function(t,a,i){e("basePage").showPage.call(this,null,a,i)},cc._RF.pop()},{basePage:void 0}],seasonPage:[function(e,t){"use strict";cc._RF.push(t,"742d5a2zO9KlYRV9tFF4vuo","seasonPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"seasonpage",pageType:1},properties:{p_sprSeasonIcon:cc.Sprite,p_labDescrible:cc.Label,p_labNextSeasonTl:cc.Label,p_labNextSeasonTime:cc.Label,p_sprZfJnIcon:cc.Sprite,p_labZfJnName:cc.Label,p_labZfJnMs:cc.Label,p_labzfjs:cc.Label,p_sprJjJnIcon:cc.Sprite,p_labJjJnName:cc.Label,p_labJjJnMs:cc.Label},onLoad:function(){a.instance=this,this.schedule(this.refreshTime,1),this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},setParam:function(){if(!app.seasonData)return app.refreshSeason(),void this.onClose();this.refreshUI()},refreshUI:function(){this.m_dbSeason=app.db.dbSeason[app.seasonData.info.season-1],this.m_upTime=app.seasonData.info.etime,app.loadTexture(app.db.getSeasonIconPath(),this.p_sprSeasonIcon,this.prefabPath),this.p_labDescrible.string=this.m_dbSeason.DESCRIBLE,this.refreshNextTl();var e=gConfig.getSkillPath(this.m_dbSeason.BFICON);app.loadTexture(e,this.p_sprZfJnIcon,this.prefabPath),this.p_labZfJnName.string=this.m_dbSeason.BFNAME,this.p_labZfJnMs.string=this.m_dbSeason.ADDSTR2,this.refreshZfJs();var t=gConfig.getSkillPath(this.m_dbSeason.ICON);app.loadTexture(t,this.p_sprJjJnIcon,this.prefabPath),this.p_labJjJnName.string=this.m_dbSeason.NAME,this.refreshZfJcMs(),this.refreshTime()},refreshZfJcMs:function(){var e=this.m_dbSeason.ADDSTR1,t=app.seasonData.info.season;e=e.replace("n",app.seasonData.vals[t-1]),this.p_labJjJnMs.string=e},refreshZfJs:function(){app.player.level<this.m_dbSeason.BF1?(this.p_labzfjs.node.active=!0,this.p_labzfjs.string=langMgr.getString("seasonPage",0,this.m_dbSeason.BF1)):app.player.level>=this.m_dbSeason.BF1&&app.player.level<this.m_dbSeason.BF2?(this.p_labzfjs.node.active=!0,this.p_labzfjs.string=langMgr.getString("seasonPage",1,this.m_dbSeason.BF2)):app.player.level>=this.m_dbSeason.BF2&&(this.p_labzfjs.node.active=!1)},refreshNextTl:function(){var e=langMgr.getString("seasonPage",3);switch(app.seasonData.info.season){case 1:e=langMgr.getString("seasonPage",4);break;case 2:e=langMgr.getString("seasonPage",5);break;case 3:e=langMgr.getString("seasonPage",6);break;case 4:e=langMgr.getString("seasonPage",3)}this.p_labNextSeasonTl.string=langMgr.getString("seasonPage",2,e)},refreshTime:function(){var e=app.player.getServerTime(),t=this.m_upTime||0,a=t-e;(!t||a<0)&&(a=0,app.refreshSeason(this,this.refreshUI)),this.p_labNextSeasonTime.string=gUtils.getCountDownStr(a)}});cc._RF.pop()},{basePage:void 0}],seniorRecruitPage:[function(e,t){"use strict";cc._RF.push(t,"ffd526ylGpL1L3NsfiyoxxX","seniorRecruitPage");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=cc._decorator,o=r.ccclass,s=r.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_labTimes=null,t.p_nodeTenTime=null,t.p_yuanbaoOne=null,t.p_yuanbaoTen=null,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,e.prototype.onLoad.call(this)},t.prototype.getOneTimeCost=function(){var e=app.player.getCount(app.db.dbDraw[3][1].COST[0].GSID),t=app.db.getPropsIconPath(app.db.dbDraw[3][1].COST[0].GSID),a=app.db.dbDraw[3][1].COST[0].COUNT;return e<=0?(this.m_nowPOneCost=app.db.dbDraw[3][1].COST[1],t=app.db.getPropsIconPath("38005"),a=app.db.dbDraw[3][1].COST[1].COUNT):this.m_nowPOneCost=app.db.dbDraw[3][1].COST[0],{count:"x"+a,iconPath:t,freeTime:app.player.recruitfree.premium}},t.prototype.getTenTimesCost=function(){var e=app.player.getCount(app.db.dbDraw[3][1].COST[0].GSID),t=app.db.getPropsIconPath(app.db.dbDraw[3][10].COST[0].GSID),a=app.db.dbDraw[3][10].COST[0].COUNT;return e<10?(this.m_nowPTenCost=app.db.dbDraw[3][10].COST[1],t=app.db.getPropsIconPath("38005"),a=app.db.dbDraw[3][10].COST[1].COUNT):this.m_nowPTenCost=app.db.dbDraw[3][10].COST[0],{count:"x"+a,iconPath:t}},t.prototype.refreshConsume=function(){e.prototype.refreshConsume.call(this),this.p_yuanbaoOne.active=!1,this.p_yuanbaoTen.active=!1;var t=app.player.getCount(app.db.dbDraw[3][1].COST[0].GSID);t<=0&&this.p_nodeOneTime.active&&(this.p_nodeOneTime.active=!1,this.p_yuanbaoOne.active=!0),this.p_nodeTenTime.active=!0,t<10&&(this.p_nodeTenTime.active=!1,this.p_yuanbaoTen.active=!0)},t.prototype.refreshBaodi=function(){this.p_labTimes.string=app.player.safe.recruit.premium},t.prototype.oneTimeClickHandle=function(){app.playSound("click"),this.extract(3,1)},t.prototype.tenTimesClickHandle=function(){app.playSound("click"),this.extract(3,10)},t.prototype.showXuyuan=function(){return!0},t.prototype.showTianyun=function(){return!0},t.refreshRed=function(){return!app.comeInSeniorRecruit},t.prefabPath="seniorrecruitpage",n([s(cc.Label)],t.prototype,"p_labTimes",void 0),n([s(cc.Node)],t.prototype,"p_nodeTenTime",void 0),n([s(cc.Node)],t.prototype,"p_yuanbaoOne",void 0),n([s(cc.Node)],t.prototype,"p_yuanbaoTen",void 0),a=n([o],t)}(e("./cardpubBasePage").CardpubBasePage);t.exports=p,cc._RF.pop()},{"./cardpubBasePage":"cardpubBasePage"}],shiMingPage:[function(e,t){"use strict";cc._RF.push(t,"d0f0aDHOzlHU4uHAPwxfrZ4","shiMingPage"),cc.Class({extends:e("basePage"),statics:{prefabPath:"shimingpage"},properties:{p_btnReward:cc.Button,p_btnGoShiMing:cc.Button,itemNode:[cc.Node]},onLoad:function(){this.stopBgNodeEvent(),this.creatMask(!0);var e=this;this.p_btnGoShiMing.node.on("click",function(){console.log("\u8c03\u7528\u5b9e\u540d"),console.log(gSetting.isShiming),gSetting.isShiming?app.showNotice(langMgr.getString("shiMingPage",0)):e.onClose()}),this.p_btnReward.node.on("click",function(){e.rewardForShiMing()}),this.refreshUI()},rewardForShiMing:function(){console.log("\u9886\u53d6\u5956\u52b1"),console.log(gSetting.isShiming),gSetting.isShiming?app.player.getRoleVerVerifiedReward(function(e,t){e?app.showNotice(e):t.message&&"OK"==t.message?app.showNotice(langMgr.getString("shiMingPage",2)):app.showNotice(langMgr.getString("shiMingPage",3))}):app.showNotice(langMgr.getString("shiMingPage",1))},handleUI:function(){this._super()},refreshUI:function(){var e=this;console.log("\u5956\u52b1\u6570\u636e1"),app.player.getRoleVerVerifiedInfo(function(t,a){if(!t){console.log("\u5956\u52b1\u6570\u636e"),console.log(a);for(var i=0;i<a.length;i++)e.itemNode.forEach(function(e,t){var i=a[t];if(i){var n=i.GSID||i.gsid,r=i.count||i.COUNT;"number"!=typeof r&&(r=0),n?(e.getComponent("propItem").initForBag(i),e.active=!0):e.active=!1}else e.active=!1})}})}}),cc._RF.pop()},{basePage:void 0}],shopPage:[function(e,t){"use strict";cc._RF.push(t,"21b59Fa3LVLSq9piebI8x2N","shopPage");var a=[42005,42006,42007,42008,42009],i=[{page:"day",coin:[38005,38006]},{page:"legion",coin:[30020,30052],FUNCTION_ID:"SHOP_LEGION"},{page:"decomp",coin:[30014],FUNCTION_ID:"DISMISS_SHOP"},{page:"star",coin:[30027],FUNCTION_ID:"SHOP_LOOK"},{page:"offical",coin:[30029],FUNCTION_ID:"SHOP_PRES"},{page:"general",coin:[30013],FUNCTION_ID:"SHOP_DRAW"},{page:"kill",coin:[30003],FUNCTION_ID:"SHOP_MAZE"},{page:"pvp",coin:[30002],FUNCTION_ID:"SHOP_PVP"},{page:"skin",coin:[30077],FUNCTION_ID:"SHOP_SKIN"},{page:"nation",coin:[30104],FUNCTION_ID:"SHOP_NATION"}],n=cc.Class({extends:e("basePage"),statics:{prefabPath:"shoppage"},properties:{p_btnRefresh:cc.Button,p_tabvShop:cc.Node,p_prebItem:cc.Prefab,p_nodeTime:cc.Node,p_labTime:cc.Label,p_nodeCoin:cc.Node,p_nodeCoinItem:cc.Node,p_contentNode:cc.Node},onLoad:function(){n.instance=this,this.stopBgNodeEvent(),this.creatMask(),this.handleUI(),this.fitTopMenu(),this.schedule(this.refreshTime,1)},handleUI:function(){var e=this;this._super(),this.p_btnRefresh.node.on("click",function(){app.playSound("click"),e.onClickBtnRefresh()}),this.m_menu=this.node.getComponent("menu"),this.m_menu.init(this)},start:function(){app.openshop=!0},setParam:function(e){void 0===e&&(e="day"),this._uselessChips=[];var t=app.player._skins;for(var a in t)if(t.hasOwnProperty(a)){a=Number(a);var n=app.db.getSkinConfigBySkinId(a);if(n.GENERAL_GSID==a)continue;var r=n.UNLOCK_CONSUME;this._uselessChips.push(r.GSID)}for(var o=0;o<i.length;++o){var s=i[o].FUNCTION_ID;if(s){var p=app.db.checkFuncUnLock(s)&&app.db.checkChannelShow(s);this.m_menu.p_arrBtnMenu[o].active=p}}var c=this.p_contentNode.getChildByName("btn_qssd");if(cc.isValid(c)&&(c.active=app.db.checkFuncUnLock("DISMISS_SHOP")),this.m_strShopName==e)this.m_strShopName=e,this.refreshData();else{this.m_strShopName=e;for(var h=0;h<i.length;++h)e==i[h].page&&(this.m_menu.p_arrBtnMenu[h].active?this.m_menu.setMenuIndex(h):this.m_menu.setMenuIndex(0))}app.runUnlockGuide("SHOP")},setMenuIndex:function(e){if(this.m_strShopName==e)this.m_strShopName=e,this.refreshData();else{this.m_strShopName=e;for(var t=0;t<i.length;++t)e==i[t].page&&this.m_menu.setMenuIndex(t)}},check:function(e){return!!e||(app.showNotice(langMgr.getString("shopPage",0)),!1)},menuHandler:function(e){this.m_numNowIndex=e,this.setMenuIndex(i[e].page)},refreshData:function(){var e=this;app.player.sfShopGet(this.m_strShopName,function(t,a){t?app.showNotice(t):(e.m_refTime=a.nexttime,e.m_refCount=a.mark,e.m_objData=a.goods,e.m_arrShowData=e.setData(a.goods),e.refreshUI())})},refreshUI:function(){this.refreshView();var e=app.db.dbShopRefresh[this.m_strShopName];e&&e.INTERAL?(this.p_nodeTime.active=!0,this.refreshTime()):this.p_nodeTime.active=!1,"general"==this.m_strShopName||"kill"==this.m_strShopName?this.p_btnRefresh.node.active=!0:this.p_btnRefresh.node.active=!1,this.refreshCoinUI()},refreshView:function(){if(this.m_arrShowData){var e=this.m_arrShowData.length;this.p_tabvShop.getComponent("tableView").initTableView(e,{shopname:this.m_strShopName,refreshcb:this.refreshCb,array:this.m_arrShowData,target:this},function(){cc.director.emit("EVT_PLAY_ITEM_ACTION")})}},showCast:function(){var e={};e.gsid=this.m_arrShowData[0][0].data.COIN,app.playSound("click"),app.pages.windowspagetipsprop.showPage(e)},setData:function(e){var t=[];if(e){for(var i="skin"==this.m_strShopName&&app.pages.activitydyrpfpage.isOpen(),n=0,r=0,o=0;n<e.length;++n)if(e[n]&&(!i||-1==a.indexOf(e[n].GSID))){t[r]||(t[r]=[]);var s={index:n,data:e[n]};t[r].push(s),o++,r=Math.floor(o/3)}return cc.log(t),t}},refreshCb:function(){var e=this;app.player.sfShopGet(this.m_strShopName,function(t,a){if(t)app.showNotice(t);else{e.m_refTime=a.nexttime,e.m_refCount=a.mark,e.m_objData=a.goods,e.m_arrShowData=e.setData(a.goods);var i={shopname:e.m_strShopName,refreshcb:e.refreshCb,array:e.m_arrShowData,target:e};e.p_tabvShop.getComponent("tableView").reload(i)}}),this.refreshUI()},refreshTime:function(){if(this.p_nodeTime.active){var e=app.player.getServerTime(),t=this.m_refTime-e;t<0&&(t=0),this.p_labTime.string=gUtils.getCountDownStr(t)}},onClickBtnRefresh:function(){var e=this,t=app.db.dbShopRefresh[this.m_strShopName];if(t.MANUAL&&t.MANUAL.CAST_ITEMS){var a,i=(a=this.m_refCount>t.MANUAL.CAST_ITEMS.length-1?t.MANUAL.CAST_ITEMS[t.MANUAL.CAST_ITEMS.length-1]:t.MANUAL.CAST_ITEMS[this.m_refCount]).COUNT,n=app.player.getCount(a.GSID),r=app.db.getPropsName(a.GSID);if(n<i)app.showNotice(langMgr.getString("shopPage",1,r));else{"star"==this.m_strShopName?langMgr.getString("shopPage",2):langMgr.getString("shopPage",3);var o={content:langMgr.getString("shopPage",4,[i,r]),confirmcb:function(){app.player.sfShopRefresh(e.m_strShopName,function(t,i){t?app.showNotice(t):cc.isValid(e)&&(app.player.reduceItem(a),e.m_refCount++,e.m_objData=i.goods,e.m_arrShowData=e.setData(i.goods),e.refreshUI())})},target:this};app.pages.windowspagetipsmsg.showPage(o)}}},onClose:function(){cc.isValid(this.node)&&this.node.active&&(--app.numPrefabZindex,app.popPage(),this.node.active=!1,cc.director.emit("page_close_end"))},refreshCoinUI:function(){this.m_arrCoin=i[this.m_numNowIndex].coin,this.node.getComponent("currency").refreshCoin(this.m_arrCoin)},checkChipUseless:function(e){return e=Number(e),this._uselessChips instanceof Array&&this._uselessChips.includes(e)}});n.refreshRed=function(e){return e&&(e.active=!1),!1},cc._RF.pop()},{basePage:void 0}],siegePage:[function(e,t){"use strict";cc._RF.push(t,"5d3a5dJQORDE7RSAZbj2liH","siegePage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"siegepage",pageType:1},properties:{p_sfChapter:[cc.SpriteFrame],p_nodeChapter:cc.Node,p_nodeNowChapter:cc.Node,p_labChapter:cc.Label,p_nodeHead:cc.Node,p_btnFight:cc.Button,p_animFight:cc.Animation,p_labGeneral:cc.Label,p_labChapterName:cc.Label,p_sprGeneral:cc.Sprite,p_spGeneral:sp.Skeleton,p_animGeneral:cc.Animation},onLoad:function(){a.instance=this,this.p_nodeNowChapter.zIndex=1,this.creatMask(!0),this.stopBgNodeEvent(),this.handleUI(),app.loadEff("fight_anim",this.p_animFight,2,1,1,14)},handleUI:function(){var e=this;this._super(),this.p_btnFight.node.on("click",function(){app.playSound("click"),e.maxLevel>app.player.level?app.pages.windowspagezhengzhannotice.showPage(e.maxLevel):e.goBattle()})},setParam:function(e){this.m_result=e,this.refreshUI()},refreshUI:function(){var e=app.player.maxmapid;this.m_cityBlood=e,cc.log("\u5f53\u524d\u5173\u5361",e);var t=app.db.getMapInfo(e);cc.log("\u5173\u5361\u4fe1\u606f",t);var a=t.CITY,i=t.GENERAL,n=app.db.getCityInfo(a),r=n.MAP;cc.log("\u57ce\u6c60\u4fe1\u606f",n),this.maxLevel=t.LIMIT,this.p_labChapter.string=t.NAME,this.m_arrChapter=this.m_arrChapter||[this.p_nodeChapter];var o=this.p_nodeChapter.parent;this.p_labGeneral.string=app.db.getGNameByGsid(i),this.p_labChapterName.string=n.NAME;for(var s=0;s<r.length;++s){var p=this.m_arrChapter[s];p||((p=cc.instantiate(this.p_nodeChapter)).parent=o,this.m_arrChapter.push(p));var c=r[s];p.getComponent(cc.Sprite).spriteFrame=c>=e?this.p_sfChapter[0]:this.p_sfChapter[1];var h=o.width/r.length,l=h*s+h/2-o.width/2;e==c&&(this.p_nodeNowChapter.x=l),p.setPosition(cc.v2(l,0))}this.p_nodeHead.getComponent("headItem").init({iconid:app.player.iconid,headid:app.player.headid,frameid:app.player.frameid,target:this}),this.setGeneralAnim(i)},goBattle:function(){var e=this;app.battleType="normal",app.player.sfChapterInfo(function(t,a){t?app.showNotice(langMgr.getString("siegePage",0)):(app.onBattle=e.m_cityBlood,app.battleConfig=a.chapter,app.levelFactor=a.levelfactor,app.goToNormBattle())})},afterBattleFresh:function(){this.refreshUI()},setGeneralAnim:function(e){app.loadGeneral(e,this.p_sprGeneral,this.p_spGeneral,this.p_animGeneral,null,this.prefabPath)}});cc._RF.pop()},{basePage:void 0}],soulTemplePage:[function(e,t){"use strict";cc._RF.push(t,"8ba43gSK/BAqLgQf7EGd/Xp","soulTemplePage");var a=cc.Enum({Rising:0,Compound:1,Quenching:2}),i=cc.Class({extends:e("basePage"),statics:{prefabPath:"soultemplepage"},properties:{p_btnHelp:cc.Button,p_nodeRisingTop:cc.Node,p_nodeCompoundTop:cc.Node,p_nodeQuenchingTop:cc.Node,p_nodeQuenchingMid:cc.Node,p_nodeTabvMid:cc.Node,p_stoneTabv:cc.Node,p_risingSelectedItem:[cc.Node],p_risingQuickSelect:cc.Button,p_risingBtn:cc.Button,p_risingNodeSelectStar:cc.Node,p_risingPickStar:cc.Node,p_risingLabSelectStar:cc.Label,p_risingNodeSecelt:cc.Node,p_risingArrNodeSelect:[cc.Node],p_risingTips:cc.Label,p_risingChanceTips:cc.Label,p_risingNewStoneStar:cc.Sprite,p_risingSp:cc.Node,p_compoundSelectedItem:[cc.Node],p_compoundQuickSelect:cc.Button,p_compoundBtn:cc.Button,p_compoundNodeSelectStar:cc.Node,p_compoundPickStar:cc.Node,p_compoundLabSelectStar:cc.Label,p_compoundNodeSecelt:cc.Node,p_compoundArrNodeSelect:[cc.Node],p_compoundTips:cc.Label,p_compoundChanceTips:cc.Label,p_compoundNewStoneStar:cc.Sprite,p_compoundSp:[cc.Node],p_quenchingBtn:cc.Button,p_quenchingCostNode:cc.Node,p_quenchingCost:[cc.Node],p_quenchingSelectNode:cc.Node,p_quenchingItem:cc.Node,p_quenchingFrame:cc.Node,p_quenchingNoStoneTips:cc.Node,p_quenchingGAttrNode:cc.Node,p_quenchingAAttrNode:cc.Node,p_quenchingNodeProperty:cc.Node,p_quenchingLabP:cc.Sprite,p_quenchingAddAttrNode:cc.Node,p_quenchingSp:cc.Node,p_guangSp:cc.Node,p_anSp:cc.Node,p_txtSp:cc.Node},onLoad:function(){i.instance=this,this.handleUI(),this.stopBgNodeEvent(),this.fitTopMenu(80),this.node.getComponent("menu").init(this),this.m_selectData=[],this.targetRisingStar=2,this.targetCompoundStar=1,this.m_quenchingData={},this.m_qcAttrType=-1},handleUI:function(){var e=this;this._super(),this.p_btnHelp.node.on("click",function(){app.playSound("click");var t=0;0==e.m_numMenuIndex?t=1126:1==e.m_numMenuIndex?t=1127:2==e.m_numMenuIndex&&(t=1128),app.pages.windowspagetipshelp.showPage(t)}),this.p_compoundBtn.node.on("click",function(){app.playSound("click"),app.player.sfSoulStoneComp(e.m_selectData,function(t,a){if(t)"invalid consumenum"==t?app.showNotice(window.langMgr.getString("soulTemplePage",0)):app.showNotice(t);else{var i=e.p_compoundSp[0].getComponent(sp.Skeleton),n=e.p_compoundSp[1].getComponent(sp.Skeleton),r=e.p_compoundSp[2].getComponent(sp.Skeleton),o=e.p_compoundSp[3].getComponent(sp.Skeleton);i.node.active=!0,n.node.active=!0,i.setAnimation(0,"effect",!1),n.setAnimation(0,"effect",!1),i.setCompleteListener(function(){i.node.active=!1,n.node.active=!1}),e.scheduleOnce(function(){e.p_compoundSelectedItem.forEach(function(e){e.active=!1}),r.node.active=!0,r.setAnimation(0,"animation",!1),r.setCompleteListener(function(){r.node.active=!1,o.node.active=!0,o.setAnimation(0,"effect2",!1),o.setCompleteListener(function(){o.node.active=!1,e.showRewardFunc(a)})})},.4)}})}),this.p_risingBtn.node.on("click",function(){app.playSound("click"),app.player.sfSoulStoneUp(e.m_selectData,function(t,a){if(t)"invalid consumenum"==t?app.showNotice(window.langMgr.getString("soulTemplePage",0)):"no enough:38006"==t?app.showNotice(window.langMgr.getString("soulTemplePage",8)):app.showNotice(t);else{var i=e.p_risingSp.getComponent(sp.Skeleton);i.node.active=!0,i.setAnimation(0,"animation",!1),e.scheduleOnce(function(){e.p_risingSelectedItem.forEach(function(e){e.active=!1})},.2),i.setCompleteListener(function(){i.node.active=!1,e.showRewardFunc(a)})}})}),this.p_quenchingBtn.node.on("touchend",function(){if(app.playSound("click"),e.m_quenchingData.guid){var t=app.db.dbSoulStoneInfo.RESETCOST[""+(e.m_qcAttrType-1)],a={content:langMgr.getString("soulTemplePage",6,app.db.dbSoulStoneInfo.INFO[e.m_quenchingData.gsid].NAME,1==e.m_qcAttrType?"\u5149":"\u6697"),confirmcb:function(){var a=t[0].GSID;app.player.sfSoulStoneReset(e.m_quenchingData.guid,a,null,function(t,a){if(t)app.showNotice(t);else{var i=e.p_quenchingSp.getComponent(sp.Skeleton);i.node.active=!0,i.setAnimation(0,"1",!1),i.setCompleteListener(function(){i.node.active=!1,e.showRewardFunc(a)})}})}},i=!0,n=[];t.forEach(function(e,t){app.player.getCount(e.GSID)<e.COUNT&&(i=!1,n.push(t))}),i?app.pages.windowspagetipsmsg.showPage(a):app.showNotice(langMgr.getString("soulTemplePage",9,n.length>1?app.db.getPropsInfoByGsid(t[0].GSID).NAME:app.db.getPropsInfoByGsid(t[n[0]].GSID).NAME))}else app.showNotice(langMgr.getString("soulTemplePage",10))}),this.p_risingQuickSelect.node.on("click",function(){app.playSound("click"),e.onClickOneKey()}),this.p_compoundQuickSelect.node.on("click",function(){app.playSound("click"),e.onClickOneKey()}),this.p_risingNodeSelectStar.on("touchend",function(){e.p_risingNodeSecelt.active=!e.p_risingNodeSecelt.active,e.p_risingNodeSelectStar.angle=e.p_risingNodeSecelt.active?0:180}),this.p_compoundNodeSelectStar.on("touchend",function(){e.p_compoundNodeSecelt.active=!e.p_compoundNodeSecelt.active,e.p_compoundNodeSelectStar.angle=e.p_compoundNodeSecelt.active?0:180}),this.p_risingArrNodeSelect.forEach(function(t,a){t.on("touchend",function(){e.p_risingNodeSecelt.active=!1,e.p_risingNodeSelectStar.angle=e.p_risingNodeSecelt.active?0:180,e.targetRisingStar=a+2,e.onClickStar()})}),this.p_compoundArrNodeSelect.forEach(function(t,a){t.on("touchend",function(){e.p_compoundNodeSecelt.active=!1,e.p_compoundNodeSelectStar.angle=e.p_compoundNodeSecelt.active?0:180,e.targetCompoundStar=a+1,e.onClickStar()})}),this.p_quenchingSelectNode.on("touchend",function(){app.playSound("click");var t={isTemple:!0,callback:function(t){var a=e.m_quenchingData=app.player.soulstones[t];e.p_quenchingItem.getComponent("soulStItem").refreshUI({stone:a,click:!0,showType:app.pages.windowspagetipssoulstoneinfo.SHOW_TYPE.TEMPLE}),e.m_qcAttrType=1,e.refreshQuening()}};app.pages.soulstonelistpage.showPage(t)}),this.p_quenchingGAttrNode.on("touchend",function(){app.playSound("click"),e.m_qcAttrType=1,e.qcAttrClick()}),this.p_quenchingAAttrNode.on("touchend",function(){app.playSound("click"),e.m_qcAttrType=2,e.qcAttrClick()}),this.p_quenchingAddAttrNode.on("touchend",function(){var t={type:"stone",m_type:e.m_qcAttrType};app.pages.newexpeditionbuffpage.showPage(t)})},setParam:function(e){this.refreshUI(e)},refreshUI:function(e){e&&e.isGoToCL?(this.m_isGoToCL=e.isGoToCL,this.m_numMenuIndex=2,this.m_quenchingData=e.stone):this.m_numMenuIndex||0==this.m_numMenuIndex||(this.m_numMenuIndex=0),this.node.getComponent("menu").setMenuIndex(this.m_numMenuIndex)},menuHandler:function(e){this.p_nodeRisingTop.active=0==e,this.p_risingPickStar.active=0==e,this.p_compoundPickStar.active=1==e,this.p_nodeTabvMid.active=0==e||1==e,this.p_nodeCompoundTop.active=1==e,this.p_nodeQuenchingTop.active=2==e,this.p_nodeQuenchingMid.active=2==e,this.p_risingNodeSecelt.active=!1,this.p_compoundNodeSecelt.active=!1,this.m_numMenuIndex=e,this.m_selectData=[],this.refreshSelectedItem(),this.m_quenchingData=this.m_isGoToCL?this.m_quenchingData:{};var t=0==e?this.p_risingTips:this.p_compoundTips,i=0==e?this.p_risingChanceTips:this.p_compoundChanceTips;switch(t.string="\u653e\u5165\u7684\u5149\u6697\u9b42\u77f3\u8d8a\u591a\u5408\u6210\u5149\u6697\u9b42\u77f3\u7684\u6982\u7387\u8d8a\u9ad8",i.node.active=!1,!0){case e==a.Rising:case e==a.Compound:this.onClickStar();break;case e==a.Quenching:this.refreshQuening()}return!0},onClickStar:function(){var e,t=0==this.m_numMenuIndex?this.targetRisingStar:this.targetCompoundStar;switch(t){case 1:e=window.langMgr.getString("soulTemplePage",1);break;case 2:e=window.langMgr.getString("soulTemplePage",2);break;case 3:e=window.langMgr.getString("soulTemplePage",3);break;case 4:e=window.langMgr.getString("soulTemplePage",4);break;case 5:e=window.langMgr.getString("soulTemplePage",5)}(0==this.m_numMenuIndex?this.p_risingLabSelectStar:this.p_compoundLabSelectStar).string=e;var a=0==this.m_numMenuIndex?this.p_risingNewStoneStar:this.p_compoundNewStoneStar,i=gConfig.getNewIconGStarPath(t-1);app.loadTexture(i,a,assetMsg.cacheNoReleaseKey.Public),this.m_selectData=[],this.refreshSelectedItem(),this.m_isGoToCL&&(this.m_isGoToCL=!1),this.setData(),this.refreshView()},refreshView:function(){var e=this.m_arrShowData.length;this.p_stoneTabv.getComponent("tableView").initTableView(e,{array:this.m_arrShowData,target:this,len:0==this.m_numMenuIndex?5:2})},setData:function(){var e=0==this.m_numMenuIndex?this.targetRisingStar-1:this.targetCompoundStar,t=app.player.soulstones,a=[];for(var i in t){for(var n=t[i].gsid,r=t[i].pType,o=t[i].sType,s=0,p=0;p<this.m_selectData.length;p++)i==this.m_selectData[p]&&(s=1);var c={gsid:n,guid:i,count:1,picked:s,pType:r,sType:o},h=app.db.getPropsInfoByGsid(n);h&&h.STAR==e&&a.push(c)}a.sort(function(e,t){var a="132".indexOf(e.sType),i="132".indexOf(t.sType);return a!==i?i-a:e.pType-t.pType}),this.m_arrShowData=a},itemClickHandler:function(e,t){if("plus"==t)this.m_selectData.push(e.guid);else{var a=this.m_selectData.indexOf(e.guid);this.m_selectData.splice(a,1)}this.refreshSelectedItem()},refreshSelectedItem:function(){for(var e=0==this.m_numMenuIndex?this.p_risingSelectedItem:this.p_compoundSelectedItem,t=0==this.m_numMenuIndex?5:2,a=0;a<e.length;a++){var i=e[a];if(!i)return;var n=this.m_selectData[a];if(i.active=!!n,n){var r=app.player.soulstones[n];i.getComponent("soulStItem").refreshUI({stone:r,showType:app.pages.windowspagetipssoulstoneinfo.SHOW_TYPE.TEMPLE})}}var o=0==this.m_numMenuIndex?this.p_risingTips:this.p_compoundTips,s=0==this.m_numMenuIndex?this.p_risingChanceTips:this.p_compoundChanceTips;if(this.m_selectData.length===t){var p=0==this.m_numMenuIndex?app.db.dbSoulStoneInfo.UP:app.db.dbSoulStoneInfo.COMP,c=0,h=0,l=0,g=0,d="",u=0==this.m_numMenuIndex?this.targetRisingStar:this.targetCompoundStar;this.m_selectData.forEach(function(e){var t=app.player.soulstones[e];1==t.sType&&c++,2==t.sType&&h++,3==t.sType&&l++}),d+=u+"_"+c+"_"+h+"_"+l,c==t?(o.string="\u653e\u5165\u7684\u5149\u6697\u9b42\u77f3\u8d8a\u591a\u5408\u6210\u5149\u6697\u9b42\u77f3\u7684\u6982\u7387\u8d8a\u9ad8",s.node.active=!1):(h>0&&0==l?(g=p[d].LIGHT_CHANCE/1e5*100,o.string="\u83b7\u5f97\u5149\u9b42\u77f3\u51e0\u7387:"):0==h&&l>0?(g=p[d].DARK_CHANCE/1e5*100,o.string="\u83b7\u5f97\u6697\u9b42\u77f3\u51e0\u7387:"):h>0&&l>0&&(g=(p[d].LIGHT_CHANCE+p[d].DARK_CHANCE)/1e5*100,o.string="\u83b7\u5f97\u5149\u6697\u9b42\u77f3\u51e0\u7387:"),s.node.active=!0,s.string=g+"%")}else o.string="\u653e\u5165\u7684\u5149\u6697\u9b42\u77f3\u8d8a\u591a\u5408\u6210\u5149\u6697\u9b42\u77f3\u7684\u6982\u7387\u8d8a\u9ad8",s.node.active=!1},onClickOneKey:function(){var e=0==this.m_numMenuIndex?5:2;if(this.m_selectData.length!=e){for(var t=0;t<this.m_arrShowData.length&&this.m_selectData.length<e;++t){var a=this.m_arrShowData[t];a.picked||(a.picked=1,this.itemClickHandler({gsid:a.gsid,guid:a.guid,count:1},"plus"))}this.refreshView()}else app.showNotice(langMgr.getString("soulTemplePage",7))},refreshQuening:function(){var e=this.m_quenchingData.guid;this.p_quenchingFrame.active=!!e,this.p_quenchingCostNode.active=!!e,this.p_quenchingNoStoneTips.active=!e,this.p_quenchingBtn.interactable=!!e,this.p_quenchingLabP.node.active=!!e,this.p_quenchingItem.active=!!e,this.p_quenchingNodeProperty.active=!!e,e&&(this.m_qcAttrType=1,this.qcAttrClick(),this.refreshProp(),this.refreshCost(),this.m_isGoToCL&&this.p_quenchingItem.getComponent("soulStItem").refreshUI({stone:this.m_quenchingData,click:!0,showType:app.pages.windowspagetipssoulstoneinfo.SHOW_TYPE.TEMPLE}))},refreshProp:function(){var e=[],t=[];for(var a in this.m_quenchingData.main){var i={};i.key=a,i.val=this.m_quenchingData.main[a],e.push(i),t.push(i)}if(this.m_quenchingData.rand)for(var n in this.m_quenchingData.rand){var r={};r.key=n,r.val=this.m_quenchingData.rand[n],e.push(r)}this.p_quenchingNodeProperty.getComponent("propertyArrItem").refreshUI(e,t)},refreshCost:function(){for(var e=app.db.dbSoulStoneInfo.RESETCOST[""+(this.m_qcAttrType-1)],t=0;t<this.p_quenchingCost.length;++t)e[t]?(this.p_quenchingCost[t].getComponent("costItem").refreshUI(e[t].GSID,e[t].COUNT,this),this.p_quenchingCost[t].active=!0):this.p_quenchingCost[t].active=!1},qcAttrClick:function(){this.p_quenchingGAttrNode.getChildByName("picked").active=1==this.m_qcAttrType,this.p_quenchingAAttrNode.getChildByName("picked").active=2==this.m_qcAttrType;var e=1==this.m_qcAttrType?"txt_sh_gsx_lang":"txt_sh_asx_lang";this.m_quenchingData.rand&&(e=1==this.m_qcAttrType?"txt_sh_gsx01_lang":"txt_sh_asx01_lang");var t=gConfig.rootPath.uibeastsoul+e;app.loadTexture(t,this.p_quenchingLabP,app.getPrefabPathFrom(this));var a=this.p_guangSp.getComponent(sp.Skeleton),i=this.p_anSp.getComponent(sp.Skeleton);a.node.active=1==this.m_qcAttrType,i.node.active=2==this.m_qcAttrType,1==this.m_qcAttrType?a.setAnimation(0,"1",!0):i.setAnimation(0,"2",!0);var n=this.p_txtSp.getComponent(sp.Skeleton);n.node.active=!0,n.setAnimation(0,"1",!0),this.refreshCost()},showRewardFunc:function(e){var t=this;this.m_selectData=[],this.m_quenchingData={},this.m_isGoToCL=!1;var a=[],i=app.db.getPropsInfoByGsid(e.soul.gsid);e.soul.STYPE=i.STYPE,a.push(e.soul);var n={showtype:1,reward:a,confirmcb:function(){2==t.m_numMenuIndex?app.player.sfPlayerByParam(["soulstones","props","hide"],function(){t.menuHandler(t.m_numMenuIndex)}):app.player.sfPlayerByParam(["soulstones"],function(){t.menuHandler(t.m_numMenuIndex)})},target:this};app.pages.windowspagereward.showPage(n)}});cc._RF.pop()},{basePage:void 0}],soulstoneBagPage:[function(e,t){"use strict";cc._RF.push(t,"db184+Cyu9AgIJmpVVlR7Ir","soulstoneBagPage");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=cc._decorator,o=r.ccclass,s=(r.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,this.creatMask(!0),this.handleUI()},t.prototype.setParam=function(t){this.m_beastsoulPos=t.beastsoulPos,e.prototype.setParam.call(this,t)},t.prototype.menuHandler=function(e){var t=this.m_stoneList;0!==e&&(t=t.filter(function(t){return t.pType===e})),this.p_nodeTableView.getComponent("tableView").initTableView(t.length,{array:t,target:this,showType:app.pages.windowspagetipssoulstoneinfo.SHOW_TYPE.STONE_BAG,guid:this.m_strGeneralGuid,stonePos:this.m_stonePos,banStonePtypes:this.m_banStonePtypes})},t.prefabPath="soulstonebagpage",t.pageType=1,a=n([o],t)}(e("soulstoneListPage")));t.exports=s,cc._RF.pop()},{soulstoneListPage:"soulstoneListPage"}],soulstoneListPage:[function(e,t){"use strict";cc._RF.push(t,"dbff7vENDJBJ6dh5Gva8lRI","soulstoneListPage");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=cc._decorator,o=r.ccclass,s=r.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_nodeTableView=null,t.m_stonePos=null,t.m_stoneList=[],t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,this.creatMask(!0),this.handleUI()},t.prototype.setParam=function(e){var t=this;this.m_isTemple=e.isTemple||!1,this.m_stonePos=e.stonePos,this.m_strGeneralGuid=e.guid,this.m_stoneList=Object.values(app.player.soulstones),this.m_banStonePtypes=app.pages.generalbaghandbookpage.checkStoneOn(this.m_stonePos,this.m_strGeneralGuid),this.m_stoneList.sort(function(e,a){if(t.m_banStonePtypes){var i=t.m_banStonePtypes.indexOf(e.pType),n=t.m_banStonePtypes.indexOf(a.pType);if(i!=n&&(-1===i||-1===n))return i-n}var r=e.star,o=a.star;if(r!==o)return o-r;var s=t.m_isTemple?"321":"132",p=s.indexOf(e.sType),c=s.indexOf(a.sType);return p!==c?c-p:e.pType-a.pType}),e.callback&&(this.m_callback=e.callback),this.refreshUI()},t.prototype.refreshUI=function(){this.node.getComponent("menu").init(this),this.node.getComponent("menu").setMenuIndex(0)},t.prototype.menuHandler=function(e){var t=this.m_isTemple?this.m_stoneList.filter(function(e){return 5===e.star}):this.m_stoneList;0!==e&&(t=t.filter(function(t){return t.pType===e})),this.p_nodeTableView.getComponent("tableView").initTableView(t.length,{array:t,target:this,isTemple:this.m_isTemple,guid:this.m_strGeneralGuid,stonePos:this.m_stonePos,banStonePtypes:this.m_banStonePtypes})},t.prefabPath="soulstonelistpage",t.pageType=1,n([s(cc.Node)],t.prototype,"p_nodeTableView",void 0),a=n([o],t)}(e("basePage"));t.exports=p,cc._RF.pop()},{basePage:void 0}],summitpvpChapmionPage:[function(e,t){"use strict";cc._RF.push(t,"9f6beM5XwNJ2aoOpmA0QoQb","summitpvpChapmionPage");var a=cc.Class({name:"summitpvpChapmionHeadItem",properties:{p_headItem:cc.Node,p_labName:cc.Label,p_labLegionName:cc.Label,p_labServName:cc.Label},refreshUI:function(e,t){e&&(this.p_headItem&&(this.p_headItem.active=!0),this.p_labName&&(this.p_labName.node.active=!0),this.p_labLegionName&&(this.p_labLegionName.node.active=!0),this.p_labServName&&(this.p_labServName.node.active=!0),this.p_headItem&&this.p_headItem.getComponent("headItem").init({iconid:e.iconid,headid:e.headid,frameid:e.frameid,numLevel:e.lv,target:t}),this.p_labName.string=e.rname,this.p_labLegionName.string=e.lname?"<"+e.lname+">":"",this.p_labServName.string="\u3010"+gUtils.getServNameForShow(e.servid)+"\u3011")},initEmpty:function(){this.p_headItem&&(this.p_headItem.active=!1),this.p_labName&&(this.p_labName.node.active=!1),this.p_labLegionName&&(this.p_labLegionName.node.active=!1),this.p_labServName&&(this.p_labServName.node.active=!1)}}),i=cc.Class({extends:e("basePage"),statics:{prefabPath:"summitpvpchapmionpage"},properties:{p_btnHelp:cc.Button,p_btnAdds:[cc.Button],p_btnGotoSummitpvp:cc.Button,p_headItems:[a],p_labSeason:cc.Label,p_sprGeneral:cc.Sprite,p_spGeneral:sp.Skeleton,p_animGeneral:cc.Animation,p_waitGeneral:cc.Node,p_animGeneralStar:cc.Node,p_labLimitCount:cc.Label},onLoad:function(){i.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.fitTopMenu()},handleUI:function(){var e=this;this._super(),this.p_btnHelp.node.on("click",function(){app.playSound("click"),app.pages.windowspagetipshelp.showPage("1041")}),this.p_headItems.forEach(function(t,a){t.p_headItem.on("touchend",function(){var t=e.m_objData.list[a];if(t){app.playSound("click");var i={};i.rid=t.rid+"|"+t.servid,i.type="summitpvp",t.rid==app.player.id&&app.player.servid==t.servid||app.pages.playerotherinfopage.showPage(i)}})}),this.p_btnAdds.forEach(function(t,a){t.node.on("click",function(){e.onAddBtnClick(a)})}),this.p_btnGotoSummitpvp.node.on("click",function(){app.playSound("click"),app.pages.summitpvppage.dealData(function(){var e=app.pages.summitpvppage.getSummitPvpState();if(-1==e.state)app.pages.summitpvppage.showPage();else if(1==e.type){if(1!=app.summitPvpInfo.type)return void app.showNotice(langMgr.getString("summitpvpChapmionPage",0));if(app.summitPvpInfo.seadata.length<=0)return void app.showNotice(langMgr.getString("summitpvpChapmionPage",1));app.pages.summitpvpprepage.showPage()}else app.pages.summitpvppage.showPage()},!0,!0)})},setParam:function(e){e.isStart&&(e.list=null),this.m_isStart=e.isStart,this.m_objData=e,this.m_strNowPickGsid=e.list&&e.list[0]&&e.list[0].imageid?e.list[0].imageid:0,this.m_limitCount=app.player.getCount(94510),this.refreshUI()},refreshUI:function(){var e=this,t=this.m_objData.isStart?this.m_objData.cycle+1:this.m_objData.cycle;this.p_labSeason.string=0==t?langMgr.getString("summitpvpChapmionPage",5):langMgr.getString("summitpvpChapmionPage",6,t),this.m_objData.isStart&&(this.p_labSeason.string+=langMgr.getString("summitpvpChapmionPage",7)),this.p_headItems.forEach(function(t,a){e.m_objData&&e.m_objData.list&&e.m_objData.list[a]?t.refreshUI(e.m_objData.list[a],e):t.initEmpty()}),this.p_btnAdds.forEach(function(t,a){if(e.m_objData&&e.m_objData.list&&e.m_objData.list[a]){t.node.active=!0;var i=e.m_objData.list[a];t.node.getComponentInChildren(cc.Label).string=i.support;var n=e.m_limitCount>=5;t.interactable=!n,app.setSpriteState(t.getComponent(cc.Sprite),n),app.setSpriteState(t.node.getChildByName("icon_good").getComponent(cc.Sprite),n),app.setSpriteState(t.getComponentInChildren(cc.Label),n),t.node.getChildByName("rednotice").active=!n}else t.node.active=!1}),this.refreshHeroAmin(),this.p_labLimitCount.string=langMgr.getString("summitpvpChapmionPage",8,Math.max(5-this.m_limitCount,0))},refreshHeroAmin:function(){if(!this.m_strNowPickGsid||!app.db.dbHeadImage[this.m_strNowPickGsid])return this.p_waitGeneral.active=!0,void(this.p_animGeneralStar.active=!1);this.p_waitGeneral.active=!1,this.p_animGeneralStar.active=!0,app.loadHeadGeneral(this.m_strNowPickGsid,this.p_sprGeneral,this.p_spGeneral,this.p_animGeneral,null,this.prefabPath)},onAddBtnClick:function(e){var t=this,a=this.m_objData.list[e];if(a){if(app.playSound("click"),app.player.getCount(94510)>=5)return this.m_limitCount=app.player.getCount(94510),this.refreshUI(),void app.showNotice(langMgr.getString("summitpvpChapmionPage",2));var i={mark:a.mark,warzone:a.areamark};app.player.sfSpTopAdd(i,function(e,a){if(e)app.showNotice(e);else{var i={showtype:1,reward:a.items};app.player.addItem(a.items),app.player.addItem({GSID:94510,COUNT:1}),t.m_limitCount=app.player.getCount(94510),app.player.sfSpTopInfo({warzone:app.topWarzoneList.my},function(e,a){e?app.showNotice(e):(a.isStart=t.m_isStart,app.summitPvpTopList=a,t.m_isStart&&(a.list=null),t.m_objData=a,t.m_strNowPickGsid=a.list&&a.list[0]&&a.list[0].imageid?a.list[0].imageid:0,t.refreshUI())}),app.pages.windowspagereward.showPage(i)}})}},onClose:function(){this._super()}});i.isOpen=function(){return!!app.db.checkFuncUnLock("PVP_SUMMIT_CHAPMION")},i.showPage=function(){var t=this;if(!app.db.checkFuncUnLock("PVP_SUMMIT_CHAPMION"))return e("basePage").showPage.call(this);if(i.isOpen()){var a=app.pages.pvpentrancepage.checkSummitPvpOpen(),n=function(){app.player.sfSpTopInfo({warzone:app.topWarzoneList.my},function(i,n){i?app.showNotice(i):(n.isStart=a,app.summitPvpTopList=n,e("basePage").showPage.call(t,n))})};app.topWarzoneList?n():app.player.sfSpTopWarzone({servid:app.player.servid},function(e,t){e?app.showNotice(langMgr.getString("summitpvpChapmionPage",3)):t.my?(app.topWarzoneList=t,n()):app.showNotice(langMgr.getString("summitpvpChapmionPage",4))})}},i.refreshRed=function(e){var t=!1;return i.isOpen()&&!app.pages.pvpentrancepage.checkSummitPvpOpen()&&(t=app.summitPvpTopList&&app.summitPvpTopList.list&&app.summitPvpTopList.list.length>0&&app.player.getCount(94510)<5),e&&(e.active=t),t},cc._RF.pop()},{basePage:void 0}],summitpvpDropdownBox:[function(e,t){"use strict";cc._RF.push(t,"361dcW7sc1OD7EAu/P3qShv","summitpvpDropdownBox"),cc.Class({extends:cc.Component,properties:{ScrollView:{default:null,type:cc.ScrollView},ItemPrefab:{default:null,type:cc.Prefab},Content:{default:null,type:cc.Label},Arrow:{default:null,type:cc.Sprite}},onLoad:function(){this.Items=[],this.CurrItemData={},this.onClickButtonEvent()},reset:function(){this.ScrollView.node.active=!1,this.ScrollView.scrollToTop(),this.Arrow.node.scaleY=-1},setScrollView:function(){this.ScrollView.node.setPosition(cc.v2(667,-48))},init:function(e){this.reset(),this.ScrollView.content.destroyAllChildren(),this.Items=[],e.isUpScrollView||this.setScrollView(),this.CallBackItem=e.CallBackItem,this.CallBackBtn=e.CallBackBtn;for(var t=0;t<e.data.length;t++){var a=e.data[t],i=cc.instantiate(this.ItemPrefab);this.ScrollView.content.addChild(i);var n=i.getComponent("summitpvpDropdownItem");n.init(a,this.onClickItemEvent.bind(this)),this.Items.push(n),a.Selected&&(this.Content.string=a.Content,this.CurrItemData=a)}},onClickButtonEvent:function(){var e=this.ScrollView.node.active;this.ScrollView.node.active=!e,this.ScrollView.scrollToTop(),this.Arrow.node.scaleY=!0===e?-1:1,this.CallBackBtn&&this.CallBackBtn()},onClickItemEvent:function(e){this.Content.string=e.Content,this.CurrItemData=e,this.onClickButtonEvent(),this.CallBackItem&&this.CallBackItem(e);for(var t=0;t<this.Items.length;t++){var a=this.Items[t];e.Content!==a.Data.Content&&a.setSelected(!1)}},getCurrItemData:function(){return this.CurrItemData}}),cc._RF.pop()},{}],summitpvpGuessPage:[function(e,t){"use strict";cc._RF.push(t,"909f14+NHtNQr0Cd3wWsFBR","summitpvpGuessPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"summitpvpguesspage",pageType:1},properties:{p_menu:cc.Node,p_nodeGuess:cc.Node,p_nodeGuessRecord:cc.Node,p_labMoney:cc.Label,p_btnHelp:cc.Button,p_btnGuessStat:cc.Button,p_SetLineupRedNode:cc.Node},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this._menuComp=this.p_menu.getComponent("menu"),this._menuComp.init(this),this._recordData=null,this._guessData=null,eventMgr.on("guessdata",this.onGuessData,this),eventMgr.on("guessrecord",this.onGuessRecord,this),eventMgr.on("38006",this.refreshUI,this)},handleUI:function(){var e=this;this._super(),this.p_btnHelp.node.on("click",function(){app.playSound("click"),app.pages.windowspagetipshelp.showPage("1042")}),this.p_btnGuessStat.node.on("click",function(){app.playSound("click"),e._recordData?app.pages.summitpvpguessstatpage.showPage(e._recordData):app.player.sfSpGuessRecord(function(){app.pages.summitpvpguessstatpage.showPage(e._recordData)})})},menuHandler:function(e){this.m_nIndex=e,this.p_nodeGuess.active=0==e,this.p_nodeGuessRecord.active=0!=e,0==e?this._guessData?this.refreshGuessdata():app.player.sfSpGuessInfo():this._recordData?this.refreshGuessRecord():app.player.sfSpGuessRecord()},onGuessData:function(e){e&&!e.err?e.data&&(this._guessData=e.data,0==this.m_nIndex&&this.refreshGuessdata()):"no record"==e.err&&(this._menuComp.setMenuIndex(1),this._menuComp.p_arrBtnMenu[0].active=!1)},refreshGuessdata:function(){this._guessData&&this.p_nodeGuess.getComponent("summitpvpGuessNode").refreshUI(this._guessData,this)},onGuessRecord:function(e){e&&!e.err&&e.data&&(this._recordData=e.data,0!=this.m_nIndex&&this.refreshGuessRecord())},refreshGuessRecord:function(){this._recordData&&this.p_nodeGuessRecord.getComponent("summitpvpGuessRecordNode").refreshUI(this._recordData,this)},setParam:function(){this._menuComp.setMenuIndex(0),this.refreshUI()},refreshUI:function(){this.p_labMoney.string=app.player.getCount(gConfig.player.gold)},onDestroy:function(){this._super(),eventMgr.off("guessdata",this.onGuessData,this),eventMgr.off("guessrecord",this.onGuessRecord,this),eventMgr.off("38006",this.refreshUI,this)}});a.refreshRed=function(e){var t=a.checkSupport();return e&&(e.active=t),t},a.checkSupport=function(){if(!app.summitPvpInfo||!app.pages.summitpvppage.isOpen()||app.summitPvpInfo.time<0)return!1;if(1==app.summitPvpInfo.currtype)return!1;var e=["seadata","groupdata","kingdata"][app.summitPvpInfo.currtype-1],t=app.summitPvpInfo[e];if(t)for(var a=0;a<t.length;a++){var i=t[a];if(i.players)for(var n=0;n<i.players.length;n++)if(i.players[n].support)return!1}return!0},cc._RF.pop()},{basePage:void 0}],summitpvpGuessStatPage:[function(e,t){"use strict";cc._RF.push(t,"db275e8H4RFpKcvH6I8PyXV","summitpvpGuessStatPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"summitpvpguessstatpage",pageType:1},properties:{p_arrGuessStatItem:[cc.Node],p_labTotalReward:cc.Label},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){this._super()},setParam:function(e){if(this._arrRecord={},e&&e.length>0)for(var t=0;t<e.length;t++){var a=e[t],i=0==a.type?a.stage-1:a.stage-1+3;this._arrRecord[i]=a}this.refreshUI()},refreshUI:function(){var e=this;if(this._arrRecord){var t=!0,a=0;this.p_arrGuessStatItem.forEach(function(i,n){if(t&&(t=-1==app.summitPvpInfo.time||e.checkStart(n)),i.getComponent("summitpvpGuessStatItem").refreshUI(e._arrRecord[n],t),e._arrRecord[n]&&e._arrRecord[n].money){var r=e._arrRecord[n].money;e._arrRecord[n].bingo?a+=r||0:a-=r||0}}),this.p_labTotalReward.string=a}},checkStart:function(e){return 2==app.pages.summitpvppage.getSummitPvpState().type&&e<=2&&e+1<app.pages.summitpvppage.getSummitPvpState().turn||app.pages.summitpvppage.getSummitPvpState().type>2&&e-2<app.pages.summitpvppage.getSummitPvpState().turn}});cc._RF.pop()},{basePage:void 0}],summitpvpPage:[function(e,t){"use strict";cc._RF.push(t,"305eaAKhSJB35dmIftSwihM","summitpvpPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"summitpvppage"},properties:{p_nodeSummit:cc.Node,p_nodeSummitGroup:cc.Node,p_nodeMiddle:cc.Node,p_nodeBottom:cc.Node,p_btnLeft:cc.Button,p_btnRight:cc.Button,p_arrGroupMenu:[cc.Node],p_groupMenuNode:cc.Node,p_nodeTouchMove:cc.Node,p_btnHelp:cc.Button,p_btnYYS:cc.Button,p_btnReward:cc.Button,p_btnSummitPre:cc.Button,p_btnSetLineup:cc.Button,p_labSetLineupTime:cc.Label,p_btnGuess:cc.Button,p_GuessNode:cc.Node,p_GuessRedNode:cc.Node,p_SetLineupRedNode:cc.Node,p_labTip:cc.Label,p_labTimeTip:cc.Label,p_labTime:cc.Label,p_arrMenu:[cc.Node],p_dropdownBoxNode:cc.Node},onLoad:function(){a.instance=this,this._super(),this.fitTopMenu(),this._bKpSeasonQuery=!1,this._isStart=!1},handleUI:function(){var e=this;this._super(),this.p_arrMenu.forEach(function(t,a){t.on("touchend",function(){e.onMenuIndex(a)})}),this.p_nodeTouchMove.on("touchend",function(t){if(!e._moving){var a=t.getLocation().x-t.getStartLocation().x;a>10?e.moveRight():a<-10&&e.moveLeft()}}),this.p_btnLeft.node.on("click",function(){e._moving||e.moveRight()}),this.p_btnRight.node.on("click",function(){e._moving||e.moveLeft()}),this.p_btnSummitPre.node.on("click",function(){app.playSound("click"),app.pages.summitpvpprepage.showPage()}),this.p_btnHelp.node.on("click",function(){app.playSound("click"),app.pages.windowspagetipshelp.showPage("1041")}),this.p_btnSetLineup.node.on("click",function(){if(app.playSound("click"),a.checkSummitPvpCanSetBattle().isCanSet){if(null==localDataUtils.GetValue("summitpvpred",null)){for(var t=app.seasonData.info.season,i=gUtils.getNumByRemainder(t,4),n=1;app.PVPOPENTIME.summitpvp.open.indexOf(i)<0;)i=gUtils.getNumByRemainder(i,4),n++;var r=app.seasonData.info.etime+6048e5*(n-1)+216e5;localDataUtils.SetValue("summitpvpred",1,r)}e.p_SetLineupRedNode.active=app.pages.summitpvppage.checkBattleArrRed(),app.battleType="kingpvpsave",app.summitSave=!0,app.goToNormBattle()}else app.showNotice(langMgr.getString("summitpvpPage",10))}),this.p_btnGuess.node.on("click",function(){app.pages.summitpvpguesspage.showPage()}),this.p_arrGroupMenu.forEach(function(t){t.on("touchend",function(){e._moving||(3==e.m_arrGroupMenu.indexOf(t)?e.moveLeft():1==e.m_arrGroupMenu.indexOf(t)&&e.moveRight())})}),this.p_btnReward.node.on("click",function(){app.playSound("click"),app.pages.summitpvprewardpage.showPage()})},onEnable:function(){this._super(),eventMgr.on(eventStr.commonEvent.RefreshTime,this.refreshTime,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.commonEvent.RefreshTime,this.refreshTime,this)},setParam:function(){this._selectWarzone=app.summitPvpWarList.my,this.initWarZone(),this.setMidGroup(),this.m_nIndex=app.summitPvpInfo.currtype-1,this._isStart=!1,this.setData(),app.summitPvpRed=!0,this.p_btnSetLineup.node.active=a.checkSummitPvpCanSetBattle().isCanShow,this.p_btnSummitPre.node.active=1==app.summitPvpInfo.type,this.p_arrMenu[0].active=app.summitPvpInfo&&3==app.summitPvpInfo.round&&3==app.summitPvpInfo.currtype&&app.summitPvpInfo.kingdata[0]&&app.summitPvpInfo.kingdata[0].vediolist.length>=3},setData:function(){var e=this;this._selectWarzone==app.summitPvpWarList.my?(this._groupdata=app.summitPvpInfo.groupdata,this._kingdata=app.summitPvpInfo.kingdata[0],this.refreshUI()):app.player.sfSearchSummitpvpInfo(this._selectWarzone,function(t,a){e._groupdata=a.groupdata,e._kingdata=a.kingdata[0],e.refreshUI()})},setMidGroup:function(){if(this._midGroup=0,2==app.summitPvpInfo.currtype){var e=app.summitPvpInfo.groupdata;if(e){for(var t=!1,i=-1,n=0;n<e.length;n++){var r=e[n],o=0;if(r.players)for(var s=0;s<r.players.length;s++){if(r.players[s].uid==app.player.uid){o=r.players[s].mark+"";break}if(r.players[s].support){t=!0;break}}if(1==app.summitPvpInfo.type&&o&&r.record){var p=a.getArrWinerIndex(r.record);if(p[p.length-1].indexOf(o)>=0)return void(this._midGroup=n);break}t&&i<0&&(i=n)}if(t)return void(this._midGroup=i)}}},setGuessPlayerData:function(e,t){var a=["seadata","groupdata","kingdata"][app.summitPvpInfo.currtype-1];if(app.summitPvpInfo[a])for(var i=0;i<app.summitPvpInfo[a].length;i++){var n=app.summitPvpInfo[a][i];if(n.players)for(var r=0;r<n.players.length;r++)if(n.players[r].uid==e&&n.players[r].servid==t)return app.summitPvpInfo[a][i].players[r].support=!0,void this.setParam()}},setGuessIconPos:function(){var e=!1,t=null,i=function(e,t){var i={support:!1,node:null};if(!e||!t)return i;for(var n=a.dealPlayer(e.players),r=a.getArrWinerIndex(e.record),o=["8","4","2","1"],s=0;s<r.length;++s)for(var p=0;p<r[s].length;++p)if(s==r.length-1&&n[r[s][p]].support)return i.support=!0,i.node=t["p_arrSummit"+o[s]][p],i;return i};if(0!=this.m_nIndex)if(1==this.m_nIndex)for(var n=0,r=-1;n<this.m_arrMiddle.length;n++,r++){var o=this.getGroupIndex(r),s=i(this._groupdata[o],this.m_arrMiddle[n].getComponent("summitpvpGroupNode"));if(s.support){e=s.support,t=s.node;break}}else{var p=i(this._kingdata,this.m_arrMiddle[1].getComponent("summitpvpGroupNode"));e=p.support,t=p.node}e&&(this.p_GuessNode.active=e,this.p_GuessNode.parent=t,this.p_GuessNode.position=cc.v2(-42,44)),this.p_GuessNode.active=e},onClickedGradEvent:function(){},onSelectedGradEvent:function(e){this._selectWarzone=e.id,this.setData(),cc.log("onSelectedGradEvent: info",e)},refreshUI:function(){this.onMenuIndex(this.m_nIndex),3==app.pages.summitpvppage.getSummitPvpState().state&&this.showStart(),this.refreshTime(),this.p_GuessRedNode.active=app.pages.summitpvpguesspage.refreshRed(),this.p_SetLineupRedNode.active=app.pages.summitpvppage.checkBattleArrRed()},showStart:function(){this._isStart||(this._isStart=!0,app.pages.summitpvppreflagpage.showPage({target:this}))},initWarZone:function(){this.ChangGradDropdownBox=this.p_dropdownBoxNode.getComponent("summitpvpDropdownBox");var e=[];if(app.summitPvpWarList.warzonelist)for(var t=0;t<app.summitPvpWarList.warzonelist.length;t++){var a={};a.id=app.summitPvpWarList.warzonelist[t],a.Content=langMgr.getString("summitpvpPage",19,t+1),a.Selected=app.summitPvpWarList.warzonelist[t]==app.summitPvpWarList.my,e.push(a)}else{var i={};i.id=app.summitPvpWarList.my,i.Content=langMgr.getString("summitpvpPage",19,1),i.Selected=!0,e.push(i)}var n={data:e,CallBackItem:this.onSelectedGradEvent.bind(this),CallBackBtn:this.onClickedGradEvent.bind(this),isUpScrollView:!1};this.ChangGradDropdownBox.init(n)},onMenuIndex:function(e){this.p_btnGuess.node.active=0!=e,this.m_nIndex=e;for(var t=0;t<this.p_arrMenu.length;++t)this.p_arrMenu[t].getChildByName("choose").active=t==e;switch(e){case 0:this.p_nodeSummitGroup.active=!1,this.p_nodeSummit.active=!0,this.onShowTop8();break;case 1:this.p_nodeSummitGroup.active=!0,this.p_nodeSummit.active=!1,this.onShowGroupStage(),this.setGuessIconPos();break;case 2:this.p_nodeSummitGroup.active=!0,this.p_nodeSummit.active=!1,this.onShowChampionStage(),this.setGuessIconPos()}},onShowTop8:function(){for(var e=a.getArrWinerIndex(this._kingdata.record),t=a.dealPlayer(this._kingdata.players),i=[],n=[],r=e.length-1;r>=0;r--)for(var o=0;o<e[r].length;o++){var s=e[r][o];n.indexOf(s)<0&&t[s]&&(i.push(t[s]),n.push(s))}this.p_nodeSummit.getComponent("summitpvpNode").refreshUI(i,this)},onShowGroupStage:function(){if(this.p_groupMenuNode.active=!0,!this.m_arrMiddle){this.m_arrMiddle=[];var e=cc.instantiate(this.p_nodeMiddle),t=cc.instantiate(this.p_nodeMiddle);e.parent=this.p_nodeMiddle.parent,t.parent=this.p_nodeMiddle.parent,e.setPosition(-cc.winSize.width,this.p_nodeMiddle.y),t.setPosition(cc.winSize.width,this.p_nodeMiddle.y),this.m_arrMiddle.push(e),this.m_arrMiddle.push(this.p_nodeMiddle),this.m_arrMiddle.push(t)}for(var a=0;a<this.m_arrMiddle.length;++a){var i=this.getGroupIndex(a-Math.floor(this.m_arrMiddle.length/2));this._groupdata[i].target=this,this.m_arrMiddle[a].getComponent("summitpvpGroupNode").refreshUI(this._groupdata[i])}var n=this.p_arrGroupMenu.length;if(!this.m_arrGroupMenu){this.m_arrGroupMenu=[];for(var r=0;r<n;++r){this.m_arrGroupMenu.push(this.p_arrGroupMenu[r]);var o=String(this.getGroupIndex(r-Math.floor(n/2))+1);this.p_arrGroupMenu[r].getChildByName("lab_group").getComponent(cc.Label).string="\u7ec4"+o}}for(var s=0;s<n;++s)this.m_arrGroupMenu[s].getChildByName("choose").active=s==Math.floor(n/2)},moveRight:function(){var e=this;if(2!=this.m_nIndex){this._moving=!0,this._midGroup=--this._midGroup<0?7:this._midGroup,this.m_arrMiddle.forEach(function(t,a){2!=a?t.runAction(cc.moveBy(.5,cc.winSize.width,0)):t.runAction(cc.sequence(cc.moveBy(.5,cc.winSize.width,0),cc.callFunc(function(){e._moving=!1,t.setPosition(-cc.winSize.width,t.y),e.m_arrMiddle.unshift(e.m_arrMiddle.pop());var a=e.getGroupIndex(-1);e._groupdata[a].target=e,t.getComponent("summitpvpGroupNode").refreshUI(e._groupdata[a]),e.setGuessIconPos()})))});var t=this.m_arrGroupMenu.length;this.m_arrGroupMenu[Math.floor(t/2)].getChildByName("choose").active=!1,this.m_arrGroupMenu[Math.floor(t/2)-1].getChildByName("choose").active=!0;var a=Math.abs(this.m_arrGroupMenu[0].x-this.m_arrGroupMenu[1].x),i=this.m_arrGroupMenu[0].x;this.m_arrGroupMenu.forEach(function(n,r){r!=t-1?n.runAction(cc.moveBy(.5,a,0)):n.runAction(cc.sequence(cc.moveBy(.5,a,0),cc.callFunc(function(){n.setPosition(i,n.y),e.m_arrGroupMenu.unshift(e.m_arrGroupMenu.pop());var a=String(e.getGroupIndex(0-Math.floor(t/2))+1);n.getChildByName("lab_group").getComponent(cc.Label).string="\u7ec4"+a})))})}},moveLeft:function(){var e=this;if(2!=this.m_nIndex){this._moving=!0,this._midGroup=++this._midGroup>7?0:this._midGroup,this.m_arrMiddle.forEach(function(t,a){0!=a?t.runAction(cc.moveBy(.5,-cc.winSize.width,0)):t.runAction(cc.sequence(cc.moveBy(.5,-cc.winSize.width,0),cc.callFunc(function(){e._moving=!1,t.setPosition(cc.winSize.width,t.y),e.m_arrMiddle.push(e.m_arrMiddle.shift());var a=e.getGroupIndex(1);t.getComponent("summitpvpGroupNode").refreshUI(e._groupdata[a]),e.setGuessIconPos()})))});var t=this.m_arrGroupMenu.length;this.m_arrGroupMenu[Math.floor(t/2)].getChildByName("choose").active=!1,this.m_arrGroupMenu[Math.floor(t/2)+1].getChildByName("choose").active=!0;var a=Math.abs(this.m_arrGroupMenu[0].x-this.m_arrGroupMenu[1].x),i=this.m_arrGroupMenu[t-1].x;this.m_arrGroupMenu.forEach(function(n,r){0!=r?n.runAction(cc.moveBy(.5,-a,0)):n.runAction(cc.sequence(cc.moveBy(.5,-a,0),cc.callFunc(function(){n.setPosition(i,n.y),e.m_arrGroupMenu.push(e.m_arrGroupMenu.shift());var a=String(e.getGroupIndex(t-1-Math.floor(t/2))+1);n.getChildByName("lab_group").getComponent(cc.Label).string=langMgr.getString("summitpvpPage",15,a)})))})}},getGroupIndex:function(e){var t=this._midGroup+e;return t<0?t+=8:t>7&&(t%=8),t},onShowChampionStage:function(){if(this.p_groupMenuNode.active=!1,!this.m_arrMiddle){this.m_arrMiddle=[];var e=cc.instantiate(this.p_nodeMiddle),t=cc.instantiate(this.p_nodeMiddle);e.parent=this.p_nodeMiddle.parent,t.parent=this.p_nodeMiddle.parent,e.setPosition(-cc.winSize.width,this.p_nodeMiddle.y),t.setPosition(cc.winSize.width,this.p_nodeMiddle.y),this.m_arrMiddle.push(e),this.m_arrMiddle.push(this.p_nodeMiddle),this.m_arrMiddle.push(t)}for(var a=0;a<this.m_arrMiddle.length;++a)this._kingdata&&(this._kingdata.target=this),1==a&&this.m_arrMiddle[a].getComponent("summitpvpGroupNode").refreshUI(this._kingdata,!1)},refreshTime:function(){var e=this;if(app.PVPOPENTIME&&app.PVPOPENTIME.summitpvp){var t=app.player.getServerTime();if(app.seasonData.info.season,app.seasonData.info.etime-t<0){if(this._bKpSeasonQuery)return;return this._bKpSeasonQuery=!0,void app.refreshSeason(this,function(){e._bKpSeasonQuery=!1,e.refreshTime()})}var a=app.pages.summitpvppage.getSummitPvpState();switch(this.p_labTip.string=gConfig.getSummitpvpTurnNameByType(a.type,a.turn),this.p_labSetLineupTime.string="",a.state){case-1:this.p_labTimeTip.string=langMgr.getString("summitpvpPage",16),this.p_labTime.string=gUtils.getCountDownStr(a.time);break;case 1:case 2:this.p_labTimeTip.string=langMgr.getString("summitpvpPage",17),this.p_labSetLineupTime.string=gUtils.getCountDownStr(a.locktime),this.p_labTime.string=gUtils.getCountDownStr(a.time);break;case 3:this.p_labTimeTip.string=langMgr.getString("summitpvpPage",18),this.p_labTime.string="00:00:00"}}},onClose:function(){this._super(),eventMgr.emit(eventStr.redEvent.RefreshPVPEntranceRed)}});a.refreshRed=function(e){var t=!1;return a.isOpen()&&((t=a.checkBattleArrRed())||(t=app.pages.summitpvpguesspage.refreshRed()),t||app.summitPvpRed||(t=a.checkSummitPvpCanSetBattle().isCanSet)),e&&(e.active=t),t},a.checkBattleArrRed=function(){return!!a.checkSummitPvpCanSetBattle().isCanSet&&null==localDataUtils.GetValue("summitpvpred",null)},a.isOpen=function(){return"9001"!=app.player.servid&&!!app.db.checkFuncUnLock("PVP_SUMMIT")&&!!app.pages.pvpentrancepage.checkSummitPvpOpen()},a.getSummitPvpState=function(e){void 0===e&&(e=!0);var t=app.player.getServerTime(),i={type:1,turn:1,time:12315623151,locktime:0,state:0},n=function(){for(var e=app.seasonData.info.etime-t,a=app.seasonData.info.season,i=gUtils.getNumByRemainder(a,4),n=1;app.PVPOPENTIME.summitpvp.open.indexOf(i)<0;)i=gUtils.getNumByRemainder(i,4),n++;return e+6048e5*(n-1)+216e5};if(a.isOpen()){var r=new Date(t),o=r.getDay();if(app.summitPvpInfo)i.type=app.summitPvpInfo.currtype,i.time=app.summitPvpInfo.time-t,i.locktime=app.summitPvpInfo.locktime-t,i.turn=app.summitPvpInfo.round,i.time<0?(i.time=0,i.locktime=0,i.state=3):app.summitPvpInfo.locktime<t?(i.state=2,i.locktime=0):i.state=1,(app.summitPvpInfo.time&&app.summitPvpInfo.time<0||3==app.summitPvpInfo.currtype&&3==app.summitPvpInfo.round&&app.summitPvpInfo.kingdata[0].vediolist.length>=3)&&(i.time=n(),i.locktime=0,i.state=-1);else if(i.type=[2,2,3,3,3,1,2][o],i.turn=[2,3,1,2,3,1,1][o],e){var s=r.getHours();i.state=s<20?1:s<21?2:3;var p=3==i.state?23:21,c=r.setHours(p,0,0,0),h=r.setHours(20,0,0,0);i.time=c-t,3!=i.state&&(i.locktime=h-t)}else i.time=app.seasonData.info.etime-t,i.state=0}else i.time=n(),i.type=3,i.turn=3,i.state=-1;return i},a.checkSummitPvpCanEnter=function(e){return 0!=e.type||1!=a.getSummitPvpState().type||(app.showNotice(langMgr.getString("summitpvpPage",11)),!1)},a.checkSummitPvpCanSetBattle=function(){var e={isCanShow:!1,isCanSet:!1};if(!app.summitPvpInfo||1!=app.summitPvpInfo.type||!a.isOpen()||app.summitPvpInfo.time<0)return e;if(1==app.summitPvpInfo.currtype)e.isCanShow=!0;else{var t=["seadata","groupdata","kingdata"][app.summitPvpInfo.currtype-1],i=app.summitPvpInfo[t];if(i)for(var n=0;n<i.length;n++){var r=i[n],o=0;if(r.players)for(var s=0;s<r.players.length;s++)if(r.players[s].uid==app.player.uid){o=r.players[s].mark+"";break}if(o&&r.record){var p=a.getArrWinerIndex(r.record);e.isCanShow=p[p.length-1].indexOf(o)>=0;break}}}return e.isCanShow&&-1==a.getSummitPvpState().state?(e.isCanShow=!1,e):e.isCanShow?(e.isCanSet=1==a.getSummitPvpState().state,e):e},a.dealData=function(e,t,a){if(void 0===t&&(t=!0),void 0===a&&(a=!1),!app.isGetSummitPvp){app.isGetSummitPvp=!0;var i=function(){!app.summitPvpInfo||a?app.player.sfSearchSummitpvpInfo(app.summitPvpWarList.my,function(a,i){app.isGetSummitPvp=!1,a?t&&app.showNotice(langMgr.getString("summitpvpPage",12)):i&&i.needstop?t&&app.showNotice(langMgr.getString("summitpvpPage",13)):(app.summitPvpInfo=i,e())}):(app.isGetSummitPvp=!1,e())};app.summitPvpWarList?(app.isGetSummitPvp=!1,i()):app.player.sfSearchSummitpvpWarList(function(e,a){return e?(app.isGetSummitPvp=!1,void(t&&app.showNotice(langMgr.getString("summitpvpPage",12)))):a.my?(app.summitPvpWarList=a,void i()):(app.isGetSummitPvp=!1,void(t&&app.showNotice(langMgr.getString("summitpvpPage",14))))})}},a.showPage=function(){var t=this;a.dealData(function(){a.checkSummitPvpCanEnter(app.summitPvpInfo)&&e("basePage").showPage.call(t,app.summitPvpInfo)})},a.getArrWinerIndex=function(e){for(var t=[],a=0;a<e.length;++a){t[a]=[];for(var i=0;i<e[a].length;++i){var n="string"==typeof e[a][i]?e[a][i]:""+e[a][i];t[a]=t[a].concat(n.split("_"))}}return t},a.dealPlayer=function(e){for(var t=[],a=gUtils.deepClone(e),i=0;i<a.length;++i){var n=a[i].mark;t[n]&&(t[n]={}),t[n]=a[i]}return t},cc._RF.pop()},{basePage:void 0}],summitpvpPreFlagPage:[function(e,t){"use strict";cc._RF.push(t,"6bb8bK7dnNG4qOciMTMp07H","summitpvpPreFlagPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"summitpvppreflagpage",pageType:1},properties:{p_labTime:cc.Label,p_labPlayerNum:cc.Label},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this._waitint=0},onEnable:function(){this._super(),eventMgr.on(eventStr.commonEvent.RefreshTime,this.refreshTime,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.commonEvent.RefreshTime,this.refreshTime,this)},handleUI:function(){this._super()},setParam:function(e){this._target=e.target,this.m_time=e.time?e.time:app.summitPvpInfo?app.summitPvpInfo.time:app.player.getServerTime(),this._waitint=0,this.isCanClose=!1,this.refreshUI()},refreshUI:function(){this.refreshTime()},refreshTime:function(){var e=app.player.getServerTime(),t=this.m_time+18e5*this._waitint-e;this.p_labTime.string=t<0?"00:00:00":gUtils.getCountDownStr(t),t<=0?(this._waitint++,this.isCanClose&&this.onClose()):this.isCanClose=!0},onClose:function(){this._super(),this._target.onClose()}});cc._RF.pop()},{basePage:void 0}],summitpvpPrePage:[function(e,t){"use strict";cc._RF.push(t,"dabc1c7cDRP5KVy5Xh6CbZ9","summitpvpPrePage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"summitpvpprepage"},properties:{p_nodeSummitPre:cc.Node,p_btnSetLineup:cc.Button,p_btnHelp:cc.Button,p_btnReward:cc.Button,p_labTip:cc.Label,p_labTime:cc.Label,p_labSetLineupTime:cc.Label,p_labTimeTip:cc.Label,p_SetLineupRedNode:cc.Node},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.fitTopMenu(),this.schedule(this.refreshTime,1),this._isStart=!1},handleUI:function(){var e=this;this._super(),this.p_btnSetLineup.node.on("click",function(){if(app.playSound("click"),app.pages.summitpvppage.checkSummitPvpCanSetBattle().isCanSet){if(null==localDataUtils.GetValue("summitpvpred",null)){for(var t=app.seasonData.info.season,a=gUtils.getNumByRemainder(t,4),i=1;app.PVPOPENTIME.summitpvp.open.indexOf(a)<0;)a=gUtils.getNumByRemainder(a,4),i++;var n=app.seasonData.info.etime+6048e5*(i-1)+216e5;localDataUtils.SetValue("summitpvpred",1,n)}e.p_SetLineupRedNode.active=app.pages.summitpvppage.checkBattleArrRed(),app.battleType="kingpvpsave",app.summitSave=!0,app.goToNormBattle()}else app.showNotice(langMgr.getString("summitpvpPrePage",3))}),this.p_btnHelp.node.on("click",function(){app.playSound("click"),app.pages.windowspagetipshelp.showPage("1041")}),this.p_btnReward.node.on("click",function(){app.playSound("click"),app.pages.summitpvprewardpage.showPage()})},setParam:function(){this._isStart=!1,app.summitPvpRed=!0,this.refreshUI(),3==app.pages.summitpvppage.getSummitPvpState().state&&this.showStart(),this.p_btnSetLineup.node.active=app.pages.summitpvppage.checkSummitPvpCanSetBattle().isCanShow},showStart:function(){this._isStart||(this._isStart=!0,app.pages.summitpvppreflagpage.showPage({target:this}))},refreshUI:function(){this.p_nodeSummitPre.getComponent("summitpvpPreNode").refreshUI(app.summitPvpInfo.seadata,this),this.refreshTime(),this.p_SetLineupRedNode.active=app.pages.summitpvppage.checkBattleArrRed()},refreshTime:function(){var e=this;if(app.PVPOPENTIME&&app.PVPOPENTIME.summitpvp){var t=app.player.getServerTime();if(app.seasonData.info.season,app.seasonData.info.etime-t<0){if(this._bKpSeasonQuery)return;return this._bKpSeasonQuery=!0,this.unschedule(this.refreshTime),void app.refreshSeason(this,function(){e._bKpSeasonQuery=!1,e.refreshTime(),e.schedule(e.refreshTime,1)})}var a=app.pages.summitpvppage.getSummitPvpState();switch(this.p_labTip.string=gConfig.getSummitpvpTurnNameByType(a.type,a.turn),a.state){case-1:this.p_labTimeTip.string=langMgr.getString("summitpvpPrePage",0),this.p_labTime.string=gUtils.getCountDownStr(a.time);break;case 1:case 2:this.p_labTimeTip.string=langMgr.getString("summitpvpPrePage",1),this.p_labSetLineupTime.string=gUtils.getCountDownStr(a.locktime),this.p_labTime.string=gUtils.getCountDownStr(a.time);break;case 3:this.p_labTimeTip.string=langMgr.getString("summitpvpPrePage",2),this.p_labTime.string="00:00:00"}}},onClose:function(){this._super(),eventMgr.emit(eventStr.redEvent.RefreshPVPEntranceRed)}});a.showPage=function(){var t=this;app.pages.summitpvppage.dealData(function(){app.pages.summitpvppage.checkSummitPvpCanEnter(app.summitPvpInfo)&&e("basePage").showPage.call(t)})},cc._RF.pop()},{basePage:void 0}],summitpvpPreRecordPage:[function(e,t){"use strict";cc._RF.push(t,"ed269phFJ5JQYBsmn87euqr","summitpvpPreRecordPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"summitpvpprerecordpage",pageType:1},properties:{p_nodeContent:cc.Node,p_prefbItem:cc.Prefab},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this._arrItems=[]},handleUI:function(){this._super()},setParam:function(e){e&&(this._rid=e.rid,this._arrRecordData=e.data,this.refreshUI())},refreshUI:function(){for(var e=0;e<this._arrRecordData.length;++e){var t=this._arrItems[e];t||((t=cc.instantiate(this.p_prefbItem)).setParent(this.p_nodeContent),this._arrItems.push(t)),t.active=!0;var a={left:{},right:{},lscore:{},rscore:{},videoid:this._arrRecordData[e].videoid},i=this._arrRecordData[e].left.uid+"|"+this._arrRecordData[e].left.servid;a.left=i!=this._rid?this._arrRecordData[e].right:this._arrRecordData[e].left,a.right=i!=this._rid?this._arrRecordData[e].left:this._arrRecordData[e].right,a.lscore=i!=this._rid?this._arrRecordData[e].rscore:this._arrRecordData[e].lscore,a.rscore=i!=this._rid?this._arrRecordData[e].lscore:this._arrRecordData[e].rscore,t.getComponent("summitpvpPreRecordItem").refreshUI(a,this)}for(var n=e;n<this._arrItems.length;++n)this._arrItems[n].active=!1}});cc._RF.pop()},{basePage:void 0}],summitpvpRewardPage:[function(e,t){"use strict";cc._RF.push(t,"b8037dmPlpDz5+4eDPFLqPx","summitpvpRewardPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"summitpvprewardpage",pageType:1},properties:{p_nodeRewardView:cc.tableView},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},onEnable:function(){this._super()},onDisable:function(){this._super()},handleUI:function(){this._super()},setParam:function(e){void 0===e&&(e="summitpvp"),this.m_type=e,this.refreshUI()},refreshUI:function(){var e="summitpvp"==this.m_type?app.db.dbSummitpvpReward:app.db.dbWangpvpReward;this.p_nodeRewardView.getComponent("tableView").initTableView(e.length,{array:e,type:"summitpvp",target:this})},onClose:function(){this._super()}});cc._RF.pop()},{basePage:void 0}],teampvpChallengeOrderPage:[function(e,t){"use strict";cc._RF.push(t,"5cd463139lFaI0ORaQQcV2/","teampvpChallengeOrderPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"teampvpchallengeorderpage",pageType:1},properties:{p_arrNodeTeammate:[cc.Node],p_btnSwitch1:cc.Button,p_btnSwitch2:cc.Button,p_btnConfirm:cc.Button},onLoad:function(){a.instance=this,this._super()},handleUI:function(){var e=this;this._super(),this.p_btnSwitch1.node.on("click",function(){var t=e._myTeamInfo.team[0];e._myTeamInfo.team[0]=e._myTeamInfo.team[1],e._myTeamInfo.team[1]=t,e.refreshUI()}),this.p_btnSwitch2.node.on("click",function(){var t=e._myTeamInfo.team[1];e._myTeamInfo.team[1]=e._myTeamInfo.team[2],e._myTeamInfo.team[2]=t,e.refreshUI()}),this.p_btnConfirm.node.on("click",function(){var t={rids:[]};e._myTeamInfo.team.forEach(function(e,a){t.rids[a]=e.rid}),app.player.sfTpSetOrder(t,function(){e._teampvpPage.refreshTeamInfoItem(e._myTeamInfo);var t=app.pages.teampvpsearchenemypage.instance;t._myTeamInfo=e._myTeamInfo,t.p_arrNodeEnemyTeam.forEach(function(t){t.getComponent("teampvpEnemyTeamItem")._myTeamInfo=e._myTeamInfo}),e.onClose()})})},setParam:function(e){e&&e.team.forEach(function(e){e.target=null}),this._myTeamInfo=gUtils.deepClone(e),this._teampvpPage=app.pages.teampvppage.instance,this.refreshUI()},refreshUI:function(){var e=this;this.p_arrNodeTeammate.forEach(function(t,a){e._myTeamInfo.team[a]?(t.active=!0,e._myTeamInfo.team[a].target=e,t.getComponent("teampvpPlayerPortraitItem").refreshUI(e._myTeamInfo.team[a])):t.active=!1})}});cc._RF.pop()},{basePage:void 0}],teampvpCompetitionTipsPage:[function(e,t){"use strict";cc._RF.push(t,"84145AIzlBCT7/04Vgu5BPV","teampvpCompetitionTipsPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"teampvpcompetitiontipspage",pageType:1},properties:{p_nodeTeammate:[cc.Node],p_btnComfirm:cc.Button},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){var e=this;this._super(),this.p_btnComfirm.node.on("click",function(){app.player.sfTpCompetition(function(t,a){if(t){if("more fellow"==t){app.showNotice(langMgr.getString("teampvpCompetitionTipsPage",0));var i={id:app.player.teamid};app.player.sfTpTeaminfo(i,function(t){e._teampvpPage.refreshTeamInfoItem(t)})}else if("battleset empty"==t)app.showNotice(langMgr.getString("teampvpCompetitionTipsPage",1));else if("team ready"==t){app.showNotice(langMgr.getString("teampvpCompetitionTipsPage",2));var n={id:app.player.teamid};app.player.sfTpTeaminfo(n,function(t){e._teampvpPage.refreshTeamInfoItem(t),e.onClose()})}}else e._myTeamInfo.competition=a,e._teampvpPage.refreshTeamInfoItem(e._myTeamInfo),e.onClose()})})},setParam:function(e){this._myTeamInfo=e,this._teampvpPage=app.pages.teampvppage.instance,this.refreshUI()},refreshUI:function(){var e=this;this.p_nodeTeammate.forEach(function(t,a){e._myTeamInfo.team[a].target=e,t.getComponent("teampvpPlayerPortraitItem").refreshUI(e._myTeamInfo.team[a])})}});cc._RF.pop()},{basePage:void 0}],teampvpCreateTeamPage:[function(e,t){"use strict";cc._RF.push(t,"daa44ElmplG8rPgD3wjesVg","teampvpCreateTeamPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"teampvpcreateteampage",pageType:1},properties:{p_editTeamName:cc.EditBox,p_editPowerDemand:cc.EditBox,p_btnCreatTeam:cc.Button},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){var e=this;this._super(),this.p_btnCreatTeam&&this.p_btnCreatTeam.node.on("click",function(){if(e.p_editTeamName.string&&e.p_editPowerDemand.string){var t=e.p_editTeamName.string;if(t){var a=t.length,i=a;if(i>12)app.showNotice(langMgr.getString("playerinfoNamePage",11));else{for(var n=0;n<a;++n)t.charCodeAt(n)>127&&++i;if(i>12)app.showNotice(langMgr.getString("playerinfoNamePage",11));else if(app.checkMatchStr(t))if(gUtils.checkRNameStr(t))app.showNotice(langMgr.getString("playerinfoNamePage",13));else{for(var r=0;r<a;++r)t.charCodeAt(r)>127&&++i;if(i>12)app.showNotice(langMgr.getString("teampvpCreateTeamPage",2));else{if(!app.checkMatchStr(t))return app.showNotice(langMgr.getString("teampvpCreateTeamPage",3)),void(e.p_editTeamName.string="");if(isNaN(e.p_editPowerDemand.string))app.showNotice(langMgr.getString("teampvpCreateTeamPage",4));else if(+e.p_editPowerDemand.string<0)app.showNotice(langMgr.getString("teampvpCreateTeamPage",4));else if(+e.p_editPowerDemand.string>9999999)app.showNotice(langMgr.getString("teampvpCreateTeamPage",9));else{var o={name:e.p_editTeamName.string.replace(/\s+/g,""),pneed:e.p_editPowerDemand.string};app.player.sfTpCreateTeam(o,function(t){app.player.sfPlayerByParam(["others","vip","hide","props"],function(){app.player.teamid=t.id,e._teampvpPage.p_nodeMyTeamInfo.active=!0,e._teampvpPage.p_nodeEmptyTeam.active=!1,e._teampvpPage.refreshTeamInfoItem(t)}),e.onClose()})}}}else app.showNotice(langMgr.getString("playerinfoNamePage",12))}}else app.showNotice(langMgr.getString("playerinfoNamePage",10))}else app.showNotice(langMgr.getString("teampvpCreateTeamPage",0))})},setParam:function(){this._teampvpPage=app.pages.teampvppage.instance},onClose:function(){this.p_editTeamName.string="",this.p_editPowerDemand.string="",this._super()}});cc._RF.pop()},{basePage:void 0}],teampvpEnemyTeaminfoPage:[function(e,t){"use strict";cc._RF.push(t,"f6ef0DOjU5CY7oQE5A1yv5b","teampvpEnemyTeaminfoPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"teampvpenemyteaminfopage",pageType:1},properties:{p_arrNodeEnemyTeaminfo:[cc.Node],p_nodePowerContent:cc.Node,p_pfbPowerDisplay:cc.Prefab,_numPower:null,p_labSer:cc.Label,p_labScore:cc.Label,p_labId:cc.Label,p_labName:cc.Label},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},setParam:function(e){this.m_data=e.data,cc.isValid(this._numPower)||(this._numPower=cc.instantiate(this.p_pfbPowerDisplay),this.p_nodePowerContent.addChild(this._numPower),this._numPower.setPosition(cc.Vec2.ZERO)),this._numPower.getComponent("PowerDisplay").init({val:this.m_data.power}),this.p_labSer.string=gUtils.getServNameForShow(this.m_data.servid),this.p_labScore.string=this.m_data.score,this.p_labId.string=this.m_data.teamno,this.p_labName.string="\u3010"+this.m_data.name+"\u3011",this.refreshUI(e.array)},refreshUI:function(e){var t=this;this.p_arrNodeEnemyTeaminfo.forEach(function(a,i){a.getComponent("teampvpEnemyTeaminfoItem").refreshUI(e[i],i,t)})}});cc._RF.pop()},{basePage:void 0}],teampvpFightRecordPage:[function(e,t){"use strict";cc._RF.push(t,"b2bacf4cuNI2ZR1zxUVd08o","teampvpFightRecordPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"teampvpfightrecordpage",pageType:1},properties:{p_nodeViewRecord:cc.Node,p_labTips:cc.Label},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},setParam:function(e){this._fightRecords=e,app.tpFightRecordsData=e,this.refreshUI()},refreshUI:function(){for(var e=[],t=0;t<this._fightRecords.length;++t)!this._fightRecords[t].version||this._fightRecords[t].version<gSetting.videoVersion||e.push(this._fightRecords[t]);this._fightRecords=e,this.p_nodeViewRecord.getComponent("tableView").initTableView(this._fightRecords.length,{array:this._fightRecords}),this.p_labTips.node.opacity=this._fightRecords&&this._fightRecords.length<=0?255:0,this.p_nodeViewRecord.opacity=this._fightRecords&&this._fightRecords.length<=0?0:255}});cc._RF.pop()},{basePage:void 0}],teampvpFightResultPage:[function(e,t){"use strict";cc._RF.push(t,"fc4e1xCLnROEKMUQZQOyOqe","teampvpFightResultPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"teampvpfightresultpage"},properties:{p_arrNodeResult:[cc.Node]},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){this._super()},setParam:function(e){this._fightResultData=e.fightResultData,this._pageFrom=e.pageFrom,app.tpFightResultData=e,this.refreshUI()},refreshUI:function(){var e=this;this.p_arrNodeResult.forEach(function(t,a){e._fightResultData.videoinfo[a]?(t.active=!0,e._fightResultData.target=e,t.getComponent("teampvpFightResultItem").refreshUI(e._fightResultData,a,e._pageFrom)):t.active=!1})}});cc._RF.pop()},{basePage:void 0}],teampvpInvitationPage:[function(e,t){"use strict";cc._RF.push(t,"89c7dxE+ShNdqYHsvdbKPaq","teampvpInvitationPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"teampvpinvitationpage",pageType:1},properties:{p_nodePlayerPortrait:cc.Node,p_labTips:cc.Label,p_btnAccept:cc.Button,p_btnRefuse:cc.Button},onLoad:function(){a.instance=this,this._super()},handleUI:function(){var e=this;this._super(),this.p_btnAccept.node.on("click",function(){e.sendResponseMsg(1)}),this.p_btnRefuse.node.on("click",function(){e.sendResponseMsg(0)})},sendResponseMsg:function(e){var t=this,a={id:this._data[this._dataIndex].id,accept:e};app.player.sfTpInviteResponse(a,function(e,a){e?"already join"==e?(app.showNotice(langMgr.getString("teampvpInvitationPage",0)),app.player.sfPlayerByParam(["teamid"],function(){var e={id:app.player.teamid};app.player.sfTpTeaminfo(e,function(e){t._teampvpPage.p_nodeMyTeamInfo.active=!0,t._teampvpPage.p_nodeEmptyTeam.active=!1,t._teampvpPage.refreshTeamInfoItem(e),t.onClose()})})):"team full"==e?(app.showNotice(langMgr.getString("teampvpInvitationPage",1)),t.getNextInvitation()):"power limit"==e?(app.showNotice(langMgr.getString("teampvpInvitationPage",2)),t.getNextInvitation()):t.onClose():a&&0!=Object.keys(a).length?(app.player.teamid=a.tid,t._teampvpPage.p_nodeMyTeamInfo.active=!0,t._teampvpPage.p_nodeEmptyTeam.active=!1,t._teampvpPage.refreshTeamInfoItem(a),t.onClose()):t.getNextInvitation()})},getNextInvitation:function(){if(this.onClose(),this._dataIndex<this._data.length-1){var e={data:this._data,index:this._dataIndex+1,teampvpPage:this._teampvpPage};app.pages.teampvpinvitationpage.showPage(e)}},setParam:function(e){this._data=e.data,this._dataIndex=e.index,this._teampvpPage=e.teampvpPage,this.refreshUI(this._data[this._dataIndex])},refreshUI:function(e){var t={iconid:e.iconid,headid:e.headid,frameid:e.frameid,power:e.power,target:this};this.p_nodePlayerPortrait.getComponent("teampvpPlayerPortraitItem").refreshUI(t),this.p_labTips&&(this.p_labTips.string=e.rname)}});cc._RF.pop()},{basePage:void 0}],teampvpPage:[function(e,t){"use strict";function a(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(a)return(a=a.call(e)).next.bind(a);if(Array.isArray(e)||(a=i(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function i(e,t){if(e){if("string"==typeof e)return n(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?n(e,t):void 0}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,i=new Array(t);a<t;a++)i[a]=e[a];return i}cc._RF.push(t,"425d3R3N+1JPbF9miu4GfiZ","teampvpPage");var r=cc.Class({extends:e("basePage"),statics:{prefabPath:"teampvppage"},properties:{p_labTime:cc.Label,p_labTeamTips:cc.Label,p_nodeView:cc.Node,p_nodeMyTeamInfo:cc.Node,p_nodeEmptyTeam:cc.Node,p_btnCreateTeam:cc.Button,p_btnJoinTeam:cc.Button,p_btnReward:cc.Button,p_btnRecord:cc.Button,p_btnBattleArr:cc.Button,p_labServGroupInfo:cc.Label,p_sprRankIcon:cc.Sprite,p_labRankNum:cc.Label,p_btnHelp:cc.Button},onLoad:function(){r.instance=this,this.fitTopMenu(),this._super(),this.nextTime=0},handleUI:function(){this._super(),this.p_btnCreateTeam.node.on("click",function(){app.playSound("click"),app._bTpOpen?app.pages.teampvpcreateteampage.showPage():app.showNotice(langMgr.getString("teampvpPage",5))}),this.p_btnJoinTeam.node.on("click",function(){app.playSound("click"),app._bTpOpen?app.pages.teampvpsearchteampage.showPage():app.showNotice(langMgr.getString("teampvpPage",5))}),this.p_btnReward.node.on("click",function(){app.playSound("click"),app.pages.teampvprewardpage.showPage()}),this.p_btnRecord.node.on("click",function(){app.playSound("click"),app.player.teamid?app.player.sfTpRecord(function(e){app.pages.teampvpfightrecordpage.showPage(e)}):app.showNotice(langMgr.getString("teampvpPage",6))}),this.p_btnBattleArr.node.on("click",function(){app.playSound("click"),app._bTpOpen?(app.battleType="teampvp",app.goToNormBattle()):app.showNotice(langMgr.getString("teampvpPage",5))}),this.p_btnHelp.node.on("click",function(){app.playSound("click"),app.pages.windowspagetipshelp.showPage("1014")})},onEnable:function(){this._super(),eventMgr.on(eventStr.commonEvent.RefreshTime,this.refreshTime,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.commonEvent.RefreshTime,this.refreshTime,this)},setParam:function(e){var t=this;this._redNotice=e.redNotice,this.refreshTime(),this.refreshUI(app.PVPRANKDATA.pvpteam,e.myTeamInfo),app.openteam=!0,app.crossServGroupInfo?this.setCrossServGroup():app.player.sfCsGetServinfo(function(e,a){e||(app.crossServGroupInfo=a,t.setCrossServGroup())}),null==localDataUtils.GetValue("teampvpred",null)&&(localDataUtils.SetValue("teampvpred",1,this.nextTime),eventMgr.emit(eventStr.redEvent.RefreshPVPEntranceRed),eventMgr.emit(eventStr.redEvent.RefreshNewWorldRed)),app.runUnlockGuide("TEAM_PVP")},setCrossServGroup:function(){var e=[];if(app.crossServGroupInfo.list.length>0)for(var t=0;t<app.crossServGroupInfo.list.length;t++){var a=gUtils.getServNameForShow(app.crossServGroupInfo.list[t].servid);e.push(a)}else{var i=gUtils.getServNameForShow(app.player.servid);e.push(i)}e=e.join(","),this.p_labServGroupInfo.string=langMgr.getString("teampvpPage",0,e)},refreshUI:function(e,t){var a=this;if(e){if(this._teamRank=e.selfrank,this._teamRank)if(this.p_sprRankIcon.node.active=this._teamRank<=3,this.p_labRankNum.node.active=this._teamRank>3,this._teamRank<=3){var i=gConfig.getRankIconPath(this._teamRank);app.loadTexture(i,this.p_sprRankIcon,this.prefabPath)}else this.p_labRankNum.string=this._teamRank;else this.p_sprRankIcon.node.active=!1,this.p_labRankNum.string="500+";this.p_nodeView.getComponent("tableView").initTableView(e.list.length,{array:e.list,target:this})}this.p_nodeEmptyTeam.active=!app.player.teamid,this.p_nodeMyTeamInfo.active=!!app.player.teamid,app.player.teamid?this.refreshTeamInfoItem(t):app.player.sfTpReceiveInvitedList(function(e){var t={data:e,index:0,teampvpPage:a};e&&e.length>0&&app.pages.teampvpinvitationpage.showPage(t)})},refreshTeamInfoItem:function(e){e.target=null,e.team.forEach(function(e){e.target=null}),this._myTeamInfo=e;var t=gUtils.deepClone(e);t.target=this,this.p_nodeMyTeamInfo.getComponent("teampvpTeaminfoItem").refreshUI(t,this._redNotice)},isLeader:function(){for(var e,t=a(this._myTeamInfo.team);!(e=t()).done;){var i=e.value;if(i.rid==app.player.id)return 1==i.leader}return!1},refreshTime:function(){if(app.PVPOPENTIME&&app.PVPOPENTIME.teampvp){var e=app.player.getServerTime(),t=new Date(e).getDay(),a=app.PVPOPENTIME.teampvp.open.indexOf(t);if(app.PVPOPENTIME.teampvp.open.lenth>=7)this.p_labTime.string=langMgr.getString("teampvpPage",1),this.p_labTeamTips.string=langMgr.getString("teampvpPage",2),this.nextTime=0;else{var i=(t+1)%7,n=1;if(a>=0){for(;app.PVPOPENTIME.teampvp.open.indexOf(i)>=0;)i=(i+1)%7,n++;this.p_labTeamTips.string=langMgr.getString("teampvpPage",3)}else{for(;app.PVPOPENTIME.teampvp.open.indexOf(i)<0;)i=(i+1)%7,n++;this.p_labTeamTips.string=langMgr.getString("teampvpPage",5)}var r=gUtils.getTimeByDay(e,n);this.nextTime=r,this.p_labTime.string=gUtils.getCountDownStr(r-e)}}},onClose:function(){this._super()}});r.showPage=function(e,t,a){var i={};app.player.sfPlayerByParam(["teamid"],function(){app.PVPRANKDATA.pvpteam?r.getTeamInfo(i,t,a):app.player.sfRankByType("pvpteam",function(e,t){e&&(app.showNotice(e),t={list:[]}),app.PVPRANKDATA.pvpteam=t,t&&(app.PVPRANKDATA.pvpteam.time=Date.now()),r.getTeamInfo(i,a)})})},r.getTeamInfo=function(t,a,i){var n=this;if(app.player.teamid){var o={id:app.player.teamid,load:!0};app.player.sfTpTeaminfo(o,function(o){t.myTeamInfo=o,!o.competition&&r.checkIsLeader(o.team)?app.player.sfTpJoinTeamRequestList({load:!0},function(r){var o={};r&&Object.keys(r).length>0&&(o.bRed=!0),t.redNotice=o,e("basePage").showPage.call(n,t,a,i)}):e("basePage").showPage.call(n,t,a,i)})}else e("basePage").showPage.call(this,t,a,i)},r.checkIsLeader=function(e){for(var t,i=a(e);!(t=i()).done;){var n=t.value;if(n.rid==app.player.id)return 1==n.leader}return!1},r.refreshRed=function(e){var t=!1;if(app.db.checkFuncUnLock("PVP_TEAM",!1)){var a=app.player.getServerTime(),i=new Date(a).getDay();app.PVPOPENTIME&&app.PVPOPENTIME.teampvp&&app.PVPOPENTIME.teampvp.open.indexOf(i)>=0&&null==localDataUtils.GetValue("teampvpred",null)&&(t=!0)}return e&&(e.active=t),t},cc._RF.pop()},{basePage:void 0}],teampvpPlayerinfoPage:[function(e,t){"use strict";cc._RF.push(t,"262c65RKDlBabNOfJALpNMU","teampvpPlayerinfoPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"teampvpplayerinfopage",pageType:1},properties:{p_nodePlayerPortrait:cc.Node,p_pfbGeneral:cc.Prefab,p_nodeGeneralContent:cc.Node,_arrNodeGeneral:[],p_labPlayerName:cc.Label,p_btnAddFriend:cc.Button,p_btnTransferLeader:cc.Button,p_btnKickOut:cc.Button},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){var e=this;this._super(),this.p_btnAddFriend.node.on("click",function(){var t=[];t.push(e._rid),app.player.sfApply(t,function(t){t?app.showNotice(langMgr.getString("teampvpPlayerinfoPage",0)):(app.showNotice(langMgr.getString("teampvpPlayerinfoPage",1)),e.p_btnAddFriend.interactable=!1)})}),this.p_btnTransferLeader.node.on("click",function(){var t={content:langMgr.getString("teampvpPlayerinfoPage",4,e._playerinfo.rname),confirmcb:function(){var t={rid:e._rid};app.player.sfTpTransferLeader(t,function(t,a){if(t)if("member nexist"==t){app.showNotice(langMgr.getString("teampvpPlayerinfoPage",2));var i={id:app.player.teamid};app.player.sfTpTeaminfo(i,function(t){e._teampvpPage.refreshTeamInfoItem(t)})}else"team ready"==t&&app.showNotice(langMgr.getString("teampvpPlayerinfoPage",3));else e._teampvpPage.refreshTeamInfoItem(a);e.onClose()})},target:e};app.pages.windowspagetipsmsg.showPage(t)}),this.p_btnKickOut.node.on("click",function(){var t={content:langMgr.getString("teampvpPlayerinfoPage",5,e._playerinfo.rname),confirmcb:function(){var t={rid:e._rid};app.player.sfTpKickout(t,function(t,a){if(t)if("member nexist"==t){app.showNotice(langMgr.getString("teampvpPlayerinfoPage",2));var i={id:app.player.teamid};app.player.sfTpTeaminfo(i,function(t){e._teampvpPage.refreshTeamInfoItem(t)})}else"team ready"==t&&app.showNotice(langMgr.getString("teampvpPlayerinfoPage",3));else e._teampvpPage.refreshTeamInfoItem(a);e.onClose()})},target:e};app.pages.windowspagetipsmsg.showPage(t)})},setParam:function(e){this._myTeamInfo=e.myTeamInfo,this._rid=e.rid,this._playerinfo=e.playerinfo,this._teampvpPage=app.pages.teampvppage.instance,this.refreshUI()},refreshUI:function(){var e=this._teampvpPage.isLeader(),t=this._myTeamInfo.competition;this.p_btnTransferLeader.node.active=e&&this._rid!=app.player.id&&!t,this.p_btnKickOut.node.active=e&&this._rid!=app.player.id&&!t,this._playerinfo.target=this,this.p_nodePlayerPortrait.getComponent("teampvpPlayerPortraitItem").refreshUI(this._playerinfo),this.p_labPlayerName.string=this._playerinfo.rname+" ["+this._myTeamInfo.name+"]";var a=app.checkIsFriend(this._rid);this.p_btnAddFriend.node.active=!a&&this._rid!=app.player.id,this.p_btnAddFriend.interactable=!0;var i=0,n=this._playerinfo.bestgeneral;for(var r in this._arrNodeGeneral.forEach(function(e){e.active=!1}),n){var o=this._arrNodeGeneral[i];cc.isValid(o)||(o=cc.instantiate(this.p_pfbGeneral),this.p_nodeGeneralContent.addChild(o),this._arrNodeGeneral[i]=o),++i,o.active=!0;var s=app.db.getGBaseByGsid(n[r].gsid);o.getComponent("generalPortraitItem").initReport(s,n[r])}}});a.showPage=function(t,a){var i=this,n={rids:[t.rid+"|"+t.myTeamInfo.servid],battleset:"teampvp"};app.player.sfGetRolesInfo(n,function(n){t.playerinfo=n[0],t.playerinfo.rid=t.rid,e("basePage").showPage.call(i,t,a)})},cc._RF.pop()},{basePage:void 0}],teampvpResultSimplePage:[function(e,t){"use strict";cc._RF.push(t,"79755r2VK1F9Kzhr/1Z1nIK","teampvpResultSimplePage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"teampvpresultsimplepage"},properties:{p_sprWin:cc.Sprite,p_sprLose:cc.Sprite,p_arrTeamInfoNode:[cc.Node],p_labScorePtoP:cc.Label,p_btnVideo:cc.Button},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){var e=this;this._super(),this.p_btnVideo.node.on("click",function(){var t={fightResultData:e._fightResultData,pageFrom:"fight"};app.pages.teampvpfightresultpage.showPage(t)})},setParam:function(e){this._fightResultData=e,this.refreshUI()},refreshUI:function(){var e=0,t=0;this._fightResultData.videoinfo.forEach(function(a){"win"==a.result?e++:t++}),this.p_labScorePtoP.string=e+" : "+t,this.p_sprWin.node.active=e>=t,this.p_sprLose.node.active=e<t;var a=this._fightResultData.competition.teamscore-this._fightResultData.myTeamInfo.competition.teamscore,i=this._fightResultData.enemyTeamInfo.competition.teamscore-a;this.p_arrTeamInfoNode[0].getComponent("teampvpResultSimpleItem").refreshUI(this._fightResultData.myTeamInfo,this._fightResultData.competition.teamscore,a,this),this.p_arrTeamInfoNode[1].getComponent("teampvpResultSimpleItem").refreshUI(this._fightResultData.enemyTeamInfo,i,-a,this)}});cc._RF.pop()},{basePage:void 0}],teampvpRewardPage:[function(e,t){"use strict";cc._RF.push(t,"27c61uaDZFIV5taq9qej9n4","teampvpRewardPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"teampvprewardpage",pageType:1},properties:{p_labTime:cc.Label,p_nodeRewardView:cc.tableView,p_nodeMyReward:cc.Node,p_nodeActiveSwitch:cc.Node,p_sprIcon:cc.Sprite},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},onEnable:function(){this._super(),eventMgr.on(eventStr.commonEvent.RefreshTime,this.refreshTime,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.commonEvent.RefreshTime,this.refreshTime,this)},handleUI:function(){this._super()},setParam:function(){this._teampvpPage=app.pages.teampvppage.instance,this.refreshTime(),this.refreshUI()},refreshTime:function(){if(app.PVPOPENTIME&&app.PVPOPENTIME.teampvp){var e=app.player.getServerTime(),t=new Date(e).getDay(),a=app.PVPOPENTIME.teampvp.open.indexOf(t);if(app.PVPOPENTIME.teampvp.open.lenth>=7)this.p_labTime.string=langMgr.getString("teampvpRewardPage",0);else{var i=(t+1)%7,n=1;if(a>=0)for(;app.PVPOPENTIME.teampvp.open.indexOf(i)>=0;)i=(i+1)%7,n++;else for(;app.PVPOPENTIME.teampvp.open.indexOf(i)<0;)i=(i+1)%7,n++;var r=gUtils.getTimeByDay(e,n)-e;this.p_labTime.string=gUtils.getCountDownStr(r)}}},refreshUI:function(){var e=app.db.dbPvpteamRewardSeason,t=this._teampvpPage._teamRank;!t&&this._teampvpPage._myTeamInfo&&this._teampvpPage._myTeamInfo.competition&&(t=1001),this.p_nodeActiveSwitch.active=!!t;for(var a=0;a<e.length;++a)if(t<=e[a].MAX){this.p_nodeMyReward.getComponent("teampvpRewardItem").refreshUI({MIN:t,MAX:t,REWARDS:e[a].REWARDS});break}this.p_nodeRewardView.getComponent("tableView").initTableView(e.length,{array:e,target:this})},onClose:function(){this._super()}});cc._RF.pop()},{basePage:void 0}],teampvpSearchEnemyPage:[function(e,t){"use strict";cc._RF.push(t,"0fa85Kubo5H07amRP3IpQcK","teampvpSearchEnemyPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"teampvpsearchenemypage",pageType:1},properties:{p_labStamina:cc.Label,p_labTime:cc.Label,p_btnUpdate:cc.Button,p_sprUpdate:cc.Sprite,p_labUpdateCd:cc.Label,p_btnSet:cc.Button,p_arrNodeEnemyTeam:[cc.Node],p_nodeLoading:cc.Node,p_nodeMask:cc.Node,p_pbChallenge:cc.ProgressBar,p_arrSprLoadPoint:[cc.Sprite]},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.p_nodeMask.on("touchstart",function(e){e.stopPropagation()}),this.p_nodeMask.on("touchmove",function(e){e.stopPropagation()}),this.p_nodeMask.on("touchend",function(e){e.stopPropagation()}),this._maxStamina=10},handleUI:function(){var e=this;this._super(),this.p_btnUpdate.node.on("click",function(){app.player.sfTpSearchEnemyTeam({force:1},function(t){e.p_arrNodeEnemyTeam.forEach(function(a,i){t&&t[i]?(a.active=!0,t[i].target=e,a.getComponent("teampvpEnemyTeamItem").refreshUI(t[i],e._myTeamInfo,i)):a.active=!1})}),e._updateCd=2,e.p_btnUpdate.interactable=!1,e.p_sprUpdate.node.active=!1,e.p_labUpdateCd.node.active=!0,e.p_labUpdateCd.string="("+e._updateCd+")",e.p_btnUpdate.schedule(function(){if(e._updateCd--<=1)return e.p_btnUpdate.interactable=!0,e.p_sprUpdate.node.active=!0,void(e.p_labUpdateCd.node.active=!1);e.p_labUpdateCd.string="("+e._updateCd+")"},1,1,0)}),this.p_btnSet.node.on("click",function(){app.pages.teampvpchallengeorderpage.showPage(e._myTeamInfo)})},setParam:function(e){this._myTeamInfo=e,this._secTimer=0,this._bStaminaRecover=e.competition.stamina<this._maxStamina,this._staRecTimestamp=this._myTeamInfo.competition.time,this.refreshUI(!0)},refreshUI:function(e){var t=this;this.p_nodeLoading.active=!1,this.p_labStamina.string=this._myTeamInfo.competition.stamina,e&&(app.player.sfTpSearchEnemyTeam({force:1},function(e){t.p_arrNodeEnemyTeam.forEach(function(a,i){e&&e[i]?(a.active=!0,e[i].target=t,a.getComponent("teampvpEnemyTeamItem").refreshUI(e[i],t._myTeamInfo,i)):a.active=!1})}),this.refreshTime(),this._myTeamInfo.competition.stamina>=this._maxStamina&&(this.p_labTime.string=gUtils.getHourMinSecTime(0)))},refreshTime:function(){var e=new Date(app.player.getServerTime()),t=e.getTime()/1e3,a=this._staRecTimestamp/1e3;this._staRecRemainder=3600-(t-a),this.p_labTime.string=gUtils.getHourMinSecTime(this._staRecRemainder),0==this._staRecRemainder&&(this.p_labStamina.string=++this._myTeamInfo.competition.stamina,this._staRecTimestamp=e.getTime(),this._myTeamInfo.competition.time=e.getTime(),this._myTeamInfo.competition.stamina>=this._maxStamina&&(this._bStaminaRecover=!1))},update:function(e){this._bStaminaRecover&&(this._secTimer+=e,this._secTimer>1&&(this._secTimer=0,this.refreshTime()))}});a.showPage=function(t,a,i){var n=this,r={id:app.player.teamid};app.player.sfTpTeaminfo(r,function(t){app.pages.teampvppage.instance._myTeamInfo=t,e("basePage").showPage.call(n,t,a,i)})},cc._RF.pop()},{basePage:void 0}],teampvpSearchTeamPage:[function(e,t){"use strict";cc._RF.push(t,"be637SYXsNBBomNaRrOUlFj","teampvpSearchTeamPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"teampvpsearchteampage",pageType:1},properties:{p_editSearchTeam:cc.EditBox,p_btnSearch:cc.Button,p_btnUpdate:cc.Button,p_nodeView:cc.Node},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){var e=this;this._super(),this.p_btnSearch.node.on("click",function(){e.refreshUI()}),this.p_btnUpdate.node.on("click",function(){e.p_editSearchTeam.string="",e.refreshUI()})},setParam:function(){this.refreshUI()},refreshUI:function(){var e=this;if(""==this.p_editSearchTeam.string)app.player.sfTpJoinableTeam(function(t){e.p_nodeView.getComponent("tableView").initTableView(t.length,{array:t,target:e})});else{var t={};isNaN(this.p_editSearchTeam.string)?t.name=this.p_editSearchTeam.string:t.no=this.p_editSearchTeam.string,app.player.sfTpTeaminfo(t,function(t){if(t){var a=[t];e.p_nodeView.getComponent("tableView").initTableView(a.length,{array:a,target:e})}else app.showNotice(langMgr.getString("teampvpSearchTeamPage",0))})}},onClose:function(){this.p_editSearchTeam.string="",this._super()}});cc._RF.pop()},{basePage:void 0}],teampvpSearchTeammatePage:[function(e,t){"use strict";cc._RF.push(t,"62d8fNPtq1LJJteNo6UASZ/","teampvpSearchTeammatePage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"teampvpsearchteammatepage",pageType:1},properties:{p_menu:e("menu"),p_nodeInviteList:cc.Node,p_nodeViewInvite:cc.Node,p_btnUpdateInvite:cc.Button,p_nodeRequestList:cc.Node,p_nodeViewRequest:cc.Node,p_btnClearRequest:cc.Button,p_labInviteTips:cc.Label,p_labReqTips:cc.Label},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.p_menu.init(this)},handleUI:function(){var e=this;this._super(),this.p_btnUpdateInvite.node.on("click",function(){e.refreshInviteableList()}),this.p_btnClearRequest.node.on("click",function(){app.player.sfTpClearRequestList(function(){e.refreshRequestList()})})},setParam:function(){this.p_menu.setMenuIndex(1)},menuHandler:function(e){switch(this._numIndex=e,e){case 0:this.refreshInviteableList();break;case 1:this.refreshRequestList()}},refreshUI:function(){this.p_nodeInviteList.active=0==this._numIndex,this.p_nodeRequestList.active=1==this._numIndex},refreshInviteableList:function(){var e=this;app.player.sfTpInviteableList(function(t,a){t?("team full"==t&&app.showNotice(langMgr.getString("teampvpSearchTeammatePage",0)),e.p_nodeViewInvite.active=!1):(e.p_nodeViewInvite.active=!0,e.p_nodeViewInvite.getComponent("tableView").initTableView(a.length,{array:a,type:"invite"})),a&&0!=Object.keys(a).length?e.p_labInviteTips.node.active=!1:e.p_labInviteTips.node.active=!0,e.refreshUI()})},refreshRequestList:function(){var e=this;app.player.sfTpJoinTeamRequestList(function(t){t&&0!=Object.keys(t).length?e.p_labReqTips.node.active=!1:e.p_labReqTips.node.active=!0,e.p_nodeViewRequest.getComponent("tableView").initTableView(t.length,{array:t,type:"request"}),e.refreshUI()})}});cc._RF.pop()},{basePage:void 0,menu:void 0}],towerManagePage:[function(e,t){"use strict";function a(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(a)return(a=a.call(e)).next.bind(a);if(Array.isArray(e)||(a=i(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function i(e,t){if(e){if("string"==typeof e)return n(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?n(e,t):void 0}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,i=new Array(t);a<t;a++)i[a]=e[a];return i}cc._RF.push(t,"60c63NvZBZKrYTypSZSp7Ik","towerManagePage");var r=[1,2,3,4],o=cc.Class({extends:e("basePage"),statics:{prefabPath:"towermanagepage"},properties:{p_arrTower:[cc.Node],p_nodeTowerRed:cc.Node},onLoad:function(){o.instance=this,this.stopNodeEvent(),this.handleUI(),this.fitTopMenu()},handleUI:function(){var e=this;this._super(),this.p_arrTower.forEach(function(t,a){t.on("touchend",function(){if(app.loginReset.OCCUTOWER&&app.loginReset.OCCUTOWER.length<=0&&4!=a)return app.showNotice(langMgr.getString("towerManagePage",3));e.goToTower(a)})})},setParam:function(){this.getTowerInfo(),app.runUnlockGuide("TOWER_OCC")},onEnable:function(){this._super(),eventMgr.on(eventStr.redEvent.RefreshTowerManageRed,this.refreshRed,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.redEvent.RefreshTowerManageRed,this.refreshRed,this)},refreshRed:function(){app.pages.climbingtowerpage.refreshRed(this.p_nodeTowerRed)},getTowerInfo:function(){var e=this;!app.loginReset.OCCUTOWER||app.loginReset.OCCUTOWER.length<=0||!app.loginReset.OCCUTOWER[0]?(app.loginReset.OCCUTOWER=[],app.player.sfGetOccTowerInfo(function(t,i){if(t)e._errMsg=t;else{for(var n,o=a(r);!(n=o()).done;){var s=n.value;app.loginReset.OCCUTOWER.push(i[s])}app.loginReset.OCCUTOWER.push(app.player.tower),e.refreshUI()}})):this.refreshUI()},afterBattleFresh:function(){this.refreshUI()},refreshUI:function(){for(var e=0;e<this.p_arrTower.length;++e){var t=this.p_arrTower[e];if(e<this.p_arrTower.length-1&&"lv limit"==this._errMsg)t.getChildByName("floor_num").getComponent(cc.Label).string=langMgr.getString("towerManagePage",0);else{var a=app.loginReset.OCCUTOWER&&null!=app.loginReset.OCCUTOWER[e]?app.loginReset.OCCUTOWER[e]:app.player.tower;t.getChildByName("floor_num").getComponent(cc.Label).string=a&&a<1001?langMgr.getString("towerManagePage",1,a):langMgr.getString("towerManagePage",2)}}this.refreshRed()},goToTower:function(e){var t=app.loginReset.OCCUTOWER[e],a={type:r[e]?"occ":"all",occ:r[e],floor:t};app.pages.climbingtowerpage.showPage(a)}});o.refreshRed=function(e){var t;return t=app.pages.climbingtowerpage.refreshRed(),e&&(e.active=t),t},o.showPage=function(){var t=this;if(app.db.checkPageUnLock("towermanagepage",!0))if(app.db.checkFuncUnLock("TOWER_OCC"))!app.loginReset.OCCUTOWER||app.loginReset.OCCUTOWER.length<=0||!app.loginReset.OCCUTOWER[0]?(app.loginReset.OCCUTOWER=[],app.player.sfGetOccTowerInfo(function(i,n){if(i)app.showNotice(i);else{for(var o,s=a(r);!(o=s()).done;){var p=o.value;app.loginReset.OCCUTOWER.push(n[p])}app.loginReset.OCCUTOWER.push(app.player.tower),e("basePage").showPage.call(t,null)}})):(app.loginReset.OCCUTOWER||(app.loginReset.OCCUTOWER=[]),app.loginReset.OCCUTOWER[4]=app.player.tower,e("basePage").showPage.call(this,null));else{app.loginReset.OCCUTOWER||(app.loginReset.OCCUTOWER=[]);var i={type:"all",occ:null,floor:app.loginReset.OCCUTOWER[4]=app.player.tower};app.pages.climbingtowerpage.showPage(i)}},cc._RF.pop()},{basePage:void 0}],treasureStarPage:[function(e,t){"use strict";cc._RF.push(t,"d79c3ILi79J/6hMaHjTvZ/F","treasureStarPage"),e("../utils/gameConfig");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"treasurestarpage"},properties:{p_labTreasName:cc.Label,p_labStar:cc.Label,p_nodeStarLeft:cc.Node,p_nodeArrow:cc.Node,p_nodeStarRight:cc.Node,p_arrProp:[cc.Node],p_labStarLeft:cc.Label,p_labStarRight:cc.Label,p_barExp:cc.ProgressBar,p_labExp:cc.Label,p_tabvTreas:cc.tableView,p_btnPick:cc.Button,p_btnUp:cc.Button,iconAnim:sp.Skeleton,p_pfbPropItem:cc.Prefab,p_nodeContent:cc.Node,_mTreasNode:null},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!1,255,"#21140b"),this.fitTopMenu(),this.handleUI()},handleUI:function(){var e=this;this._super(),this.p_btnUp.node.on("click",function(){app.playSound("click"),e.onClickStarUp()}),this.p_btnPick.node.on("click",function(){app.playSound("click"),e.onClickOneKey()}),this.iconAnim.setCompleteListener(function(){return e.iconAnim.node.active=!1})},start:function(){this.p_labStar.string=langMgr.getString("treasureStarPage",0)},setParam:function(e){cc.log("now star up treas is ",e.gsid),this.m_strGuid=e.guid,this.m_strTreasGuid=e.treasGuid,this.m_strTargetGsid=e.gsid,this.m_closeCb=e.closecb,this.m_objNewGData=null,this.refreshData(),this.refreshUI()},refreshData:function(){this.m_arrShowData=this.setData()},refreshUI:function(){this.refreshTarget(),this.refreshView(),this.initExp(),this.refreshInfo()},refreshView:function(){cc.log("refreshview");var e=this.m_arrShowData.length;this.p_tabvTreas.getComponent("tableView").initTableView(e,{array:this.m_arrShowData,target:this})},refreshTarget:function(){this.m_generalInfo=app.player.general[this.m_strGuid]||[],this.m_gsid=this.m_generalInfo.treasure.gsid?this.m_generalInfo.treasure.gsid:this.m_generalInfo.treasure,cc.log("now treas id is ",this.m_strTargetGsid,this.m_gsid),cc.isValid(this._mTreasNode)||(this._mTreasNode=cc.instantiate(this.p_pfbPropItem),this.p_nodeContent.addChild(this._mTreasNode),this._mTreasNode.setPosition(cc.Vec2.ZERO)),this._mTreasNode.getComponent("propItem").initForGsid(this.m_gsid);var e=app.db.getTBaseByGsid(this.m_gsid);this.p_labTreasName.string=e.NAME},setStar:function(e,t){if(cc.isValid(e)){var a=null;if(t>6){a=gConfig.gHightStarBgPath;var i=null;if(!cc.isValid(e.children[0])){var n=new cc.Node("hightstarnum");n.addComponent(cc.Sprite),n.active=!0,e.addChild(n),i=n}i||(i=e.getChildByName("hightstarnum")),i.active=!0;var r=gConfig.getIconCommonStarNumPath(t-6);app.loadTexture(r,i.getComponent(cc.Sprite)),e.active=!0}else a=gConfig.getIconCommonStarPath(t-1),cc.isValid(e.children[0])&&(e.children[0].active=!1);app.loadTexture(a,e.getComponent(cc.Sprite)),e.active=!0}},refreshInfo:function(e){var t,a=app.db.getTBaseByGsid(this.m_gsid),i=a.PROP,n=[];e?(n=(t=app.db.getTBaseByGsid(e)).PROP,this.setStar(this.p_nodeStarRight,t.STAR),this.p_nodeArrow.active=!0,this.p_nodeStarRight.active=!0):(this.p_nodeArrow.active=!1,this.p_nodeStarRight.active=!1),this.setStar(this.p_nodeStarLeft,a.STAR);for(var r=0;r<this.p_arrProp.length;++r){var o=i[r],s=n[r];o||s?(this.p_arrProp[r].active=!0,this.p_arrProp[r].getComponent("propertyUpdateItem").showLabels(),this.p_arrProp[r].getComponent("propertyUpdateItem").refreshUI(o,s)):(this.p_arrProp[r].active=!1,this.p_arrProp[r].getComponent("propertyUpdateItem").hideLabels())}},initExp:function(){this.m_isMaxExp=!1,this.m_isMaxLv=!1,this.m_strNextGsid=null,this.m_objPickItem={},this.m_numPickExp=0;var e=app.db.getTBaseByGsid(this.m_gsid),t=e.NEXT;if(t&&this.checkAwake(t.ID)){var a=e.STAR,i=app.db.getTBaseByGsid(t.ID),n=i.STAR;this.p_labStarLeft.string=langMgr.getString("treasureStarPage",4,a);var r=langMgr.getString("treasureStarPage",4,n);i.NEXT||(r+="(\u6ee1\u7ea7)"),this.p_labStarRight.string=r,this.p_labExp.string="0/"+t.EXP,this.p_barExp.progress=0,this.m_numNextBeginExp=0,this.m_numNextExp=t.EXP}else{this.m_isMaxLv=!0;var o=e.STAR,s=e.STAR;this.p_labStarLeft.string=langMgr.getString("treasureStarPage",1,o),this.p_labStarRight.string=langMgr.getString("treasureStarPage",2,s),this.p_labExp.string=langMgr.getString("treasureStarPage",3),this.p_barExp.progress=1}},itemClickHandler:function(e,t){this.refreshPick(e,t),this.refreshExp()},refreshPick:function(e,t){if(e){var a=app.db.getTBaseByGsid(e.gsid);this.m_objPickItem[e.gsid]?("plus"==t&&(this.m_objPickItem[e.gsid]+=Number(e.count)),"minus"==t&&(this.m_objPickItem[e.gsid]-=Number(e.count),this.m_objPickItem[e.gsid]<=0&&delete this.m_objPickItem[e.gsid])):this.m_objPickItem[e.gsid]=Number(e.count),"plus"==t&&(this.m_numPickExp+=a.EXP*e.count),"minus"==t&&(this.m_numPickExp-=a.EXP*e.count)}},refreshExp:function(){var e=this.getNextInfo(this.m_numPickExp,this.m_gsid);this.m_isMaxExp=!!e.isMax,this.m_numNextExp=e.nextexp,this.m_numNextBeginExp=e.exp,cc.log("now need next exp",this.m_numNextBeginExp),e.nextprop&&e.nextprop!=this.m_gsid?(this.m_strNextGsid=e.nextprop,this.refreshInfo(e.nextprop)):(this.m_strNextGsid=null,this.refreshInfo());var t=app.db.getTBaseByGsid(e.now),a=app.db.getTBaseByGsid(e.next);a.NEXT&&this.checkAwake(a.NEXT.ID)?this.m_numNextNextExp=a.NEXT.EXP:this.m_numNextNextExp=null;var i=t.STAR,n=a.STAR;this.p_labStarLeft.string=langMgr.getString("treasureStarPage",4,i);var r=langMgr.getString("treasureStarPage",4,n);a.NEXT&&this.checkAwake(a.NEXT.ID)||(r+=langMgr.getString("treasureStarPage",8)),this.p_labStarRight.string=r,this.p_labExp.string=e.exp+"/"+e.nextexp,this.p_barExp.progress=e.exp/e.nextexp},getNextInfo:function(e,t){var a=app.db.getTBaseByGsid(t).NEXT,i={exp:e,now:t,next:a.ID,nextexp:a.EXP,isMax:!1};if(e>a.EXP){var n=e-a.EXP,r=app.db.getTBaseByGsid(a.ID);return r.NEXT&&this.checkAwake(r.NEXT.ID)?this.getNextInfo(n,a.ID):(i.isMax=!0,i.nextprop=a.ID,i)}if(e==a.EXP){var o=app.db.getTBaseByGsid(a.ID);return i.nextprop=a.ID,o.NEXT&&this.checkAwake(o.NEXT.ID)?i:(i.isMax=!0,i)}return i.nextprop=t,i},isMaxStar:function(){var e=!1,t=app.db.getTBaseByGsid(this.m_gsid);for(var a in this.m_objPickItem)if(app.db.getTBaseByGsid(a).QUALITY>t.QUALITY){e=!0;break}return e},checkAwake:function(e){if(!e)return!1;var t=app.db.getTBaseByGsid(e),a=gConfig.treasAwake,i=a[t.STAR]?a[t.STAR].propertynum:0,n=this.m_generalInfo.treasure.property?this.m_generalInfo.treasure.property.length:0;return cc.log(i,n,e,t),!(i&&i>n)},checkTreasMaxLv:function(e){return!(!e||app.db.getTBaseByGsid(e).NEXT&&this.checkAwake(e))},onClickStarUp:function(){var e=this;if(cc.log("click star up"),this.m_isMaxLv)app.showNotice(langMgr.getString("treasureStarPage",5));else if(this.m_strNextGsid){var t=function(){var t=e.setArrChooseItem();cc.log(t);var a=e.m_strTreasGuid?e.m_strTreasGuid:e.m_strTargetGsid;app.player.sfTreasLvUp(e.m_strGuid,a,t,function(t,a){if(t)return"awake first"==t||"not awake"==t?void app.showNotice("\u8bf7\u89c9\u9192\u540e\u518d\u5347\u661f\uff01"):void app.showNotice(t);e._isUpgrade=!0;var i=e.m_strNextGsid;e.m_objNewGData=a.general;var n={showtype:1,reward:[{gsid:i,count:1}],confirmcb:function(){e.m_gsid=i,e.refreshData(),e.refreshUI(),e.iconAnim.node.active=!0,e.iconAnim.setAnimation(0,"shengji_guang",!1)}};app.player.sfPlayerByParam(["others","props"],function(){}),app.pages.windowspagereward.showPage(n)})};if(this.isMaxStar()){var a={content:langMgr.getString("treasureStarPage",9),confirmcb:function(){t&&t()},target:this};app.pages.windowspagetipsmsg.showPage(a)}else t&&t()}else app.showNotice(langMgr.getString("treasureStarPage",6))},onClickOneKey:function(){if(this.m_isMaxLv)app.showNotice(langMgr.getString("treasureStarPage",5));else{var e=this.m_numNextExp-this.m_numNextBeginExp,t=0;if(e>=0){if(0==e){if(!this.m_numNextNextExp)return void app.showNotice(langMgr.getString("treasureStarPage",7));e=this.m_numNextNextExp}for(var a=0;a<this.m_arrShowData.length&&t<e;++a){var i=this.m_arrShowData[a];if(i.picked!=i.count){for(var n=app.db.getTBaseByGsid(i.gsid).EXP,r=i.picked,o=i.count,s=0,p=r;p<o&&t<e;++p)t+=n,++s;i.picked+=s,this.refreshPick({gsid:i.gsid,count:s},"plus"),this.m_lastItemIndex=a}}this.refreshExp(),this.refreshView(),this.scrollToPick()}else app.showNotice(langMgr.getString("treasureStarPage",7))}},setData:function(){var e=[];for(var t in cc.log(app.player.treas),app.player.treas){var a=app.player.treas[t].count;if(!app.player.treas[t].guid&&(t!=this.m_strTargetGsid&&t!=this.m_gsid||this.m_strGuid||(a-=1),a&&!(a<0))){var i={gsid:t,count:a,picked:0};e.push(i)}}return e.sort(function(e,t){var a=app.db.getTBaseByGsid(e.gsid),i=app.db.getTBaseByGsid(t.gsid);if(a.QUALITY>i.QUALITY)return 1;if(a.QUALITY==i.QUALITY){if(a.STAR>i.STAR)return 1;if(a.STAR==i.STAR&&e.gsid>t.gsid)return 1}return-1}),cc.log(e),e},setArrChooseItem:function(){var e=[];for(var t in this.m_objPickItem)e.push({gsid:t,count:this.m_objPickItem[t]});return e},scrollToPick:function(){var e=this.m_lastItemIndex;if(!(e<0)){var t=this.p_tabvTreas.getScrollOffset().y,a=this.p_tabvTreas.cell.data.height,i=this.p_tabvTreas._groupCellCount,n=Math.floor(e/i),r=0!=n?this.p_tabvTreas.top:0,o=(a+this.p_tabvTreas.spacingY)*n+r;o>t&&this.p_tabvTreas.scrollToOffset(cc.v2(0,o),1)}},onClose:function(){if(this._super(),this.m_closeCb&&this.m_closeCb(this.m_objNewGData),this._isUpgrade&&app.player.hasBeenSoulBind(this.m_strGuid)){var e=app.player.getSoulBindGuid(this.m_strGuid);e&&app.player.sfQueryGeneralListInfo([e])}}});cc._RF.pop()},{"../utils/gameConfig":void 0,basePage:void 0}],vipKeFuPage:[function(e,t){"use strict";cc._RF.push(t,"52ee77sTPlOLJOGVuye52Mi","vipKeFuPage"),cc.Class({extends:e("basePage"),statics:{prefabPath:"vipkefupage"},properties:{},onLoad:function(){this.stopBgNodeEvent(),this.creatMask(!0)},handleUI:function(){this._super()}}),cc._RF.pop()},{basePage:void 0}],vipPrivilegePage:[function(e,t){"use strict";cc._RF.push(t,"a299fhn8a5EM7IhvRPtcYhQ","vipPrivilegePage");var a=[{name:"vip",uiPatch:"vip_privilege_page",iconPath:"btn_vip_viptq01",iconPickPath:"btn_vip_viptq02",labelPath:"txt_vip_viptq_lang",page:"windowspagerechargevip",pageParam:null,coin:[38005,38006],funcId:"RECHARGE_VIP"},{name:"tqlb",uiPatch:"vip_privilege_page",iconPath:"btn_vip_tqlb01",iconPickPath:"btn_vip_tqlb02",labelPath:"txt_vip_tqlb_lang",page:"rechargewelfarepagetqlb",pageParam:null,coin:[38005,38006],funcId:"SHOP_PRIV"},{name:"mzlb",uiPatch:"vip_privilege_page",iconPath:"btn_vip_mzlb01",iconPickPath:"btn_vip_mzlb02",labelPath:"txt_vip_mzlb_lang",page:"rechargenormalpagemzlb",pageParam:null,coin:[38005,38006],funcId:"GIFT_WEEK"},{name:"mylb",uiPatch:"vip_privilege_page",iconPath:"btn_vip_mylb01",iconPickPath:"btn_vip_mylb02",labelPath:"txt_vip_mylb_lang",page:"rechargenormalpagemylb",pageParam:null,coin:[38005,38006],funcId:"GIFT_MONTH"},{name:"czyb",uiPatch:"vip_privilege_page",iconPath:"btn_vip_ybcz01",iconPickPath:"btn_vip_ybcz02",labelPath:"txt_vip_ybcz_lang",page:"rechargenormalpageczyb",pageParam:null,coin:[38005,38006],funcId:"RECHARGE_YB"}],i=cc.Class({extends:e("basePage"),statics:{prefabPath:"vipprivilegepage"},properties:{p_nodeBg:cc.Node,p_top:cc.Node,p_menu:cc.Node,p_scrView:cc.ScrollView,p_arrNode_Normal:[cc.Node],p_arrNode_Special:[cc.Node]},onLoad:function(){i.instance=this,this.stopBgNodeEvent(),this.creatMask(),this.fitTopMenu(50),this.handleUI(),this.canSelectMenu=!0,this.m_menu=this.p_menu.getComponent("menuV2"),this.refreshByPgts()},onEnable:function(){this._super(),eventMgr.on(eventStr.redEvent.RefreshVipPrivilegeRed,this.refreshRed,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.redEvent.RefreshVipPrivilegeRed,this.refreshRed,this)},handleUI:function(){this._super()},setParam:function(e){var t=this,a=e||"czyb",i=this.getMenuData();this.m_arrMenuData=i.arr,this.m_arrMenuName=i.arrName,this.m_menu.init(this.m_arrMenuData.length,this.menuHandler,this.refreshMenuUI,this.refreshMenuRed,this),this.m_menu.refreshMenu(),this.setMenu(a),this.scheduleOnce(function(){t.refershMenuView()},.1)},refershMenuView:function(){var e=this.m_arrMenuData.length,t=this.m_menu.p_menuBtnTemp.width,a=this.p_scrView.content.getComponent(cc.Layout).spacingX,i=this.m_menu.m_numMenuIndex;if(cc.log(e),e<=5){var n=t*e+a*(e-1);this.p_scrView.content.x=-n-this.p_scrView.content.getComponent(cc.Layout).paddingLeft,cc.log(n,this.p_scrView.content.width,this.p_scrView.content.x)}else{var r=i<5?0:i-5+3,o=0==r?0:(t+a)*r;this.p_scrView.scrollToOffset(cc.Vec2(o,0))}this.p_scrView.elastic=!!(e>5)},refreshCoinUI:function(){this.p_top.getComponent("currency").refreshCoin(this.currentPageData.coin),this.refreshRed()},openShopPage:function(){var e=this;if(this.currentPageData&&this.currentPageData.page){this.canSelectMenu=!1;var t=app.pages[this.currentPageData.page],a=function(){t.showPage(e,e.p_nodeBg,function(a){a?e.canSelectMenu=!0:(e.m_showPage=t.instance,t.instance.p_bgNode?(e.m_showPageNode=e.m_showPage.p_bgNode,e.m_showPageNode.opacity=0,e.m_showPageNode.runAction(cc.sequence(cc.fadeIn(.15),cc.callFunc(function(){e.canSelectMenu=!0})))):e.canSelectMenu=!0)})};if(this.m_showPage){if(this.m_showPage.node.active=!0,this.m_showPageNode=this.m_showPage.p_bgNode,!this.m_showPageNode)return this.m_showPage.onClose(),this.m_showPage=null,void a();this.m_showPageNode.runAction(cc.sequence(cc.fadeOut(.1),cc.callFunc(function(){e.m_showPage.onClose(),e.m_showPage=null,a()})))}else a();this.refreshCoinUI()}},menuHandler:function(e){if(!this.canSelectMenu)return!1;this.currentPageData=this.m_arrMenuData[e],this.openShopPage()},refreshRed:function(){this.m_menu.refreshRed()},refreshMenuUI:function(e){return this.m_arrMenuData[e]||{}},refreshMenuRed:function(e){var t=this.m_arrMenuData[e];return!!(t&&t.page&&app.pages[t.page]&&app.pages[t.page].refreshRed)&&app.pages[t.page].refreshRed()},getMenuData:function(){for(var e=[],t=[],i=0;i<a.length;++i){var n=a[i],r=app.db.checkFuncUnLock(n.funcId),o=app.db.checkChannelShow(n.funcId);r&&o&&(e.push(n),t.push(n.name))}return{arr:e,arrName:t}},setMenu:function(e){var t=this.m_arrMenuName.indexOf(e);t>=0&&this.m_menu.setMenuIndex(t)},refreshByPgts:function(){this.p_arrNode_Normal.forEach(function(e){e.active=!gSetting.checkReviewServ()}),this.p_arrNode_Special.forEach(function(e){e.active=gSetting.checkReviewServ()})},onClose:function(){app.pages[this.currentPageData.page].instance&&cc.isValid(app.pages[this.currentPageData.page].instance.node)&&app.pages[this.currentPageData.page].instance.onClose(),this._super()}});i.refreshRed=function(e){for(var t=!1,i=0;i<a.length;i++){var n=a[i],r=app.db.checkFuncUnLock(n.funcId),o=app.db.checkChannelShow(n.funcId);if(r||o?n.page&&app.pages[n.page]&&app.pages[n.page].refreshRed&&(t=app.pages[n.page].refreshRed()):t=!1,t)break}return e&&(e.active=t),t},cc._RF.pop()},{basePage:void 0}],wangpvpGuessPage:[function(e,t){"use strict";cc._RF.push(t,"9a9afIRehNGB5mUFCNyHP6I","wangpvpGuessPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"wangpvpguesspage",pageType:1},properties:{p_nodeContent:cc.Node,p_prefbItem:cc.Prefab,p_labMoney:cc.Label,p_btnHelp:cc.Button,p_labTip:cc.Label,p_labTimeTip:cc.Label,p_labTime:cc.Label,p_titleSpriteFrames:[cc.SpriteFrame],p_sprTitle:cc.Sprite,p_nodePlayerTips:cc.Node,p_labPlayerNum:cc.Label,p_labMulti:cc.Label},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.m_arrPlayer=[]},onEnable:function(){this._super(),eventMgr.on(eventStr.commonEvent.RefreshTime,this.refreshTime,this),eventMgr.on(eventStr.palaceEvent.RefreshWangGuess,this.setParam,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.commonEvent.RefreshTime,this.refreshTime,this),eventMgr.off(eventStr.palaceEvent.RefreshWangGuess,this.setParam,this)},handleUI:function(){this._super(),this.p_btnHelp.node.on("click",function(){app.playSound("click"),app.pages.windowspagetipshelp.showPage("1042")})},setParam:function(e){if(this.m_data=e.kingdata,this.m_support=void 0!==e.support||-1==app.pages.wangpvppage.getSummitPvpState().state,this.m_data.sort(function(e,t){return!e.eliminate&&t.eliminate?-1:1}),this.m_support){var t=-1,a={};this.m_data.forEach(function(e,i){if(e.support)return t=i,void(a=e)}),-1!=t&&(this.m_data.splice(t,1),this.m_data.unshift(a))}this.refreshUI()},setNodeTipsActive:function(e){this.p_labPlayerNum.node.active=e,this.p_nodePlayerTips.active=e,this.p_labMulti.node.active=e},refreshUI:function(){this.p_labMoney.string=gUtils.showCoinNum(app.player.getCount(gConfig.player.gold)),this.refreshTime(),this.setNodeTipsActive(!app.pages.wangpvppage.isOver());for(var e=0,t=0;t<this.m_data.length;t++)if(this.m_data[t]){var a=this.m_arrPlayer[e];a||((a=cc.instantiate(this.p_prefbItem)).setParent(this.p_nodeContent),this.m_arrPlayer.push(a)),a.active=!0,this.m_data[t].target=this,a.getComponent("wangpvpGuessItem").refreshUI(this.m_data[t],this.m_support),e++}for(var i=e;i<this.m_arrPlayer.length;++i)this.m_arrPlayer[i].active=!1;var n=app.pages.wangpvppage.getSummitPvpState();this.p_sprTitle.spriteFrame=this.p_titleSpriteFrames[n.turn-1];var r=["8","4","2"];this.p_labPlayerNum.string=r[n.turn-1],this.p_labMulti.string=r[n.turn-1]},refreshTime:function(){var e=app.pages.wangpvppage.getSummitPvpState();switch(this.p_labTip.string=gConfig.getSummitpvpTurnNameByType(e.type,e.turn),e.state){case-1:this.p_labTimeTip.string=langMgr.getString("wangpvpGuessPage",1),this.p_labTime.string=gUtils.getCountDownStr(e.time);break;case 1:case 2:this.p_labTimeTip.string=langMgr.getString("wangpvpGuessPage",2),this.p_labTime.string=gUtils.getCountDownStr(e.time);break;case 3:this.p_labTimeTip.string=langMgr.getString("wangpvpGuessPage",3),this.p_labTime.string="00:00:00"}},onDestroy:function(){this._super()}});a.showPage=function(){var t=this;app.player.sfWpGuessInfo(function(a,i){a?app.showNotice(langMgr.getString("wangpvpGuessPage",0)):e("basePage").showPage.call(t,i)})},a.refreshRed=function(e){var t=a.checkSupport();return e&&(e.active=t),t},a.checkSupport=function(){if(!app.wangPvpInfo||!app.pages.wangpvppage.isOpen()||app.pages.wangpvppage.isOver())return!1;var e=["groupdata","kingdata"][app.wangPvpInfo.currtype-1];if("groupdata"==e)return!1;var t=app.wangPvpInfo[e];if(t)for(var a=0;a<t.length;a++){var i=t[a];if(i.players)for(var n=0;n<i.players.length;n++)if(i.players[n].support)return!1}return!0},cc._RF.pop()},{basePage:void 0}],wangpvpPage:[function(e,t){"use strict";cc._RF.push(t,"9971feF++VNCqcp5p+a6wWN","wangpvpPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"wangpvppage"},properties:{p_nodeSummitGroup:cc.Node,p_nodeMiddle:cc.Node,p_btnLeft:cc.Button,p_btnRight:cc.Button,p_arrGroupMenu:[cc.Node],p_groupMenuNode:cc.Node,p_nodeTouchMove:cc.Node,p_btnHelp:cc.Button,p_btnReward:cc.Button,p_btnSetLineup:cc.Button,p_btnGuess:cc.Button,p_GuessNode:cc.Node,p_GuessRedNode:cc.Node,p_SetLineupRedNode:cc.Node,p_labTip:cc.Label,p_labTimeTip:cc.Label,p_labTime:cc.Label,p_arrMenu:[cc.Node],p_colorNode:[cc.Color],p_colorOutLine:[cc.Color]},onLoad:function(){a.instance=this,this._super(),this.fitTopMenu(),this._bKpSeasonQuery=!1,this._isStart=!1},handleUI:function(){var e=this;this._super(),this.p_arrMenu.forEach(function(t,a){t.on("touchend",function(){e.onMenuIndex(a)})}),this.p_nodeTouchMove.on("touchend",function(t){if(!e._moving){var a=t.getLocation().x-t.getStartLocation().x;a>10?e.moveRight():a<-10&&e.moveLeft()}}),this.p_btnLeft.node.on("click",function(){e._moving||e.moveRight()}),this.p_btnRight.node.on("click",function(){e._moving||e.moveLeft()}),this.p_btnHelp.node.on("click",function(){app.playSound("click"),app.pages.windowspagetipshelp.showPage("1084")}),this.p_btnSetLineup.node.on("click",function(){if(app.playSound("click"),a.checkWangPvpCanSetBattle().isCanSet){if(null==localDataUtils.GetValue("wangpvpred",null)){var t=app.player.getServerTime()+a.openNextTime();localDataUtils.SetValue("wangpvpred",1,t)}e.p_SetLineupRedNode.active=app.pages.wangpvppage.checkBattleArrRed(),app.battleType="wangpvpsave",app.goToNormBattle()}else app.showNotice(langMgr.getString("wangpvpPage",0))}),this.p_btnGuess.node.on("click",function(){app.playSound("click"),app.pages.wangpvpguesspage.showPage()}),this.p_arrGroupMenu.forEach(function(t,a){t.on("touchend",function(){e._moving||(3==e.m_arrGroupMenu.indexOf(t)?e.moveLeft():1==e.m_arrGroupMenu.indexOf(t)&&e.moveRight(),e.p_arrGroupMenu.forEach(function(t,i){var n=t.getChildByName("lab_group");if(cc.isValid(n)){var r=n.color,o=e.p_colorNode[Number(i===a)];r.equals(o)||(n.color=o,n.getComponent(cc.LabelOutline).color=e.p_colorOutLine[Number(i===a)])}}))})}),this.p_btnReward.node.on("click",function(){app.playSound("click"),app.pages.summitpvprewardpage.showPage("wangpvp")})},onEnable:function(){this._super(),eventMgr.on(eventStr.commonEvent.RefreshTime,this.refreshTime,this),eventMgr.on(eventStr.palaceEvent.RefreshWangInfo,this.refreshWangInfo,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.commonEvent.RefreshTime,this.refreshTime,this),eventMgr.off(eventStr.palaceEvent.RefreshWangInfo,this.refreshWangInfo,this)},setParam:function(){this.setMidGroup(),this.m_nIndex=app.wangPvpInfo.currtype-1,this._isStart=!1,this.setData(),this.p_btnSetLineup.node.active=a.checkWangPvpCanSetBattle().isCanShow},setData:function(){this._groupdata=app.wangPvpInfo.groupdata,this._kingdata=app.wangPvpInfo.kingdata[0],this.refreshUI()},refreshWangInfo:function(){var e=this;a.dealData(function(){e.setParam()},!1,!0)},setMidGroup:function(){if(this._midGroup=0,1==app.wangPvpInfo.currtype){var e=app.wangPvpInfo.groupdata;if(e){for(var t=!1,i=-1,n=0;n<e.length;n++){var r=e[n],o=0;if(r.players)for(var s=0;s<r.players.length;s++){if(r.players[s].rid==app.player.id){o=r.players[s].mark+"";break}if(r.players[s].support){t=!0;break}}if(1==app.wangPvpInfo.type&&o&&r.record){var p=a.getArrWinerIndex(r.record);if(p[p.length-1].indexOf(o)>=0)return void(this._midGroup=n);break}t&&i<0&&(i=n)}if(t)return void(this._midGroup=i)}}},setGuessPlayerData:function(e,t){var a=["groupdata","kingdata"][app.wangPvpInfo.currtype-1];if(app.wangPvpInfo[a])for(var i=0;i<app.wangPvpInfo[a].length;i++){var n=app.wangPvpInfo[a][i];if(n.players)for(var r=0;r<n.players.length;r++)if(n.players[r].uid==e&&n.players[r].servid==t)return app.wangPvpInfo[a][i].players[r].support=!0,void this.setParam()}},setGuessIconPos:function(){var e=!1,t=null,i=function(e,t){var i={support:!1,node:null};if(!e||!t)return i;for(var n=a.dealPlayer(e.players),r=a.getArrWinerIndex(e.record),o=["8","4","2","1"],s=0;s<r.length;++s)for(var p=0;p<r[s].length;++p)if(s==r.length-1&&n[r[s][p]].support)return i.support=!0,i.node=t["p_arrSummit"+o[s]][p],i;return i};if(0==this.m_nIndex)for(var n=0,r=-1;n<this.m_arrMiddle.length;n++,r++){var o=this.getGroupIndex(r),s=i(this._groupdata[o],this.m_arrMiddle[n].getComponent("summitpvpGroupNode"));if(s.support){e=s.support,t=s.node;break}}else{var p=i(this._kingdata,this.m_arrMiddle[1].getComponent("summitpvpGroupNode"));e=p.support,t=p.node}e&&(this.p_GuessNode.active=e,this.p_GuessNode.parent=t,this.p_GuessNode.position=cc.v2(-42,44)),this.p_GuessNode.active=e},onClickedGradEvent:function(){},onSelectedGradEvent:function(e){this._selectWarzone=e.id,this.setData(),cc.log("onSelectedGradEvent: info",e)},refreshUI:function(){if(this.onMenuIndex(this.m_nIndex),3==app.pages.wangpvppage.getSummitPvpState().state&&this.showStart(),!localDataUtils.GetValue("wangpvptime",null)){var e=app.player.getServerTime()+a.openNextTime();localDataUtils.SetValue("wangpvptime",e)}this.refreshTime(),this.p_GuessRedNode.active=app.pages.wangpvpguesspage.refreshRed(),this.p_SetLineupRedNode.active=app.pages.wangpvppage.checkBattleArrRed(),this.p_btnGuess.node.active=2==app.wangPvpInfo.currtype&&1==this.m_nIndex},showStart:function(){this._isStart||(this._isStart=!0,app.pages.summitpvppreflagpage.showPage({target:this}))},onMenuIndex:function(e){this.m_nIndex=e;for(var t=0;t<this.p_arrMenu.length;++t)this.p_arrMenu[t].getChildByName("choose").active=t==e;switch(this.p_btnGuess.node.active=2==app.wangPvpInfo.currtype&&1==this.m_nIndex,this.m_nIndex){case 0:this.onShowGroupStage();break;case 1:this.onShowChampionStage()}this.setGuessIconPos()},onShowGroupStage:function(){if(this.p_groupMenuNode.active=!0,!this.m_arrMiddle){this.m_arrMiddle=[];var e=cc.instantiate(this.p_nodeMiddle),t=cc.instantiate(this.p_nodeMiddle);e.parent=this.p_nodeMiddle.parent,t.parent=this.p_nodeMiddle.parent,e.setPosition(-cc.winSize.width,this.p_nodeMiddle.y),t.setPosition(cc.winSize.width,this.p_nodeMiddle.y),this.m_arrMiddle.push(e),this.m_arrMiddle.push(this.p_nodeMiddle),this.m_arrMiddle.push(t)}for(var a=0;a<this.m_arrMiddle.length;++a){var i=this.getGroupIndex(a-Math.floor(this.m_arrMiddle.length/2));this.m_arrMiddle[a].getComponent("summitpvpGroupNode").refreshUI(this._groupdata[i],!0,"wangpvp")}var n=this.p_arrGroupMenu.length;if(!this.m_arrGroupMenu){this.m_arrGroupMenu=[];for(var r=0;r<n;++r){this.m_arrGroupMenu.push(this.p_arrGroupMenu[r]);var o=String(this.getGroupIndex(r-Math.floor(n/2))+1);this.p_arrGroupMenu[r].getChildByName("lab_group").getComponent(cc.Label).string="\u7ec4"+o}}for(var s=0;s<n;++s)this.m_arrGroupMenu[s].getChildByName("choose").active=s==Math.floor(n/2)},moveRight:function(){var e=this;if(1!=this.m_nIndex){this._moving=!0,this._midGroup=--this._midGroup<0?7:this._midGroup,this.m_arrMiddle.forEach(function(t,a){2!=a?t.runAction(cc.moveBy(.5,cc.winSize.width,0)):t.runAction(cc.sequence(cc.moveBy(.5,cc.winSize.width,0),cc.callFunc(function(){e._moving=!1,t.setPosition(-cc.winSize.width,t.y),e.m_arrMiddle.unshift(e.m_arrMiddle.pop());var a=e.getGroupIndex(-1);t.getComponent("summitpvpGroupNode").refreshUI(e._groupdata[a],!0,"wangpvp"),e.setGuessIconPos()})))});var t=this.m_arrGroupMenu.length;this.m_arrGroupMenu[Math.floor(t/2)].getChildByName("choose").active=!1,this.m_arrGroupMenu[Math.floor(t/2)-1].getChildByName("choose").active=!0;var a=Math.abs(this.m_arrGroupMenu[0].x-this.m_arrGroupMenu[1].x),i=this.m_arrGroupMenu[0].x;this.m_arrGroupMenu.forEach(function(n,r){r!=t-1?n.runAction(cc.moveBy(.5,a,0)):n.runAction(cc.sequence(cc.moveBy(.5,a,0),cc.callFunc(function(){n.setPosition(i,n.y),e.m_arrGroupMenu.unshift(e.m_arrGroupMenu.pop());var a=String(e.getGroupIndex(0-Math.floor(t/2))+1);n.getChildByName("lab_group").getComponent(cc.Label).string="\u7ec4"+a})))})}},moveLeft:function(){var e=this;if(1!=this.m_nIndex){this._moving=!0,this._midGroup=++this._midGroup>7?0:this._midGroup,this.m_arrMiddle.forEach(function(t,a){0!=a?t.runAction(cc.moveBy(.5,-cc.winSize.width,0)):t.runAction(cc.sequence(cc.moveBy(.5,-cc.winSize.width,0),cc.callFunc(function(){e._moving=!1,t.setPosition(cc.winSize.width,t.y),e.m_arrMiddle.push(e.m_arrMiddle.shift());var a=e.getGroupIndex(1);t.getComponent("summitpvpGroupNode").refreshUI(e._groupdata[a],!0,"wangpvp"),e.setGuessIconPos()})))});var t=this.m_arrGroupMenu.length;this.m_arrGroupMenu[Math.floor(t/2)].getChildByName("choose").active=!1,this.m_arrGroupMenu[Math.floor(t/2)+1].getChildByName("choose").active=!0;var a=Math.abs(this.m_arrGroupMenu[0].x-this.m_arrGroupMenu[1].x),i=this.m_arrGroupMenu[t-1].x;this.m_arrGroupMenu.forEach(function(n,r){0!=r?n.runAction(cc.moveBy(.5,-a,0)):n.runAction(cc.sequence(cc.moveBy(.5,-a,0),cc.callFunc(function(){n.setPosition(i,n.y),e.m_arrGroupMenu.push(e.m_arrGroupMenu.shift());var a=String(e.getGroupIndex(t-1-Math.floor(t/2))+1);n.getChildByName("lab_group").getComponent(cc.Label).string=langMgr.getString("wangpvpPage",3,a)})))})}},getGroupIndex:function(e){var t=this._midGroup+e;return t<0?t+=8:t>7&&(t%=8),t},onShowChampionStage:function(){if(this.p_groupMenuNode.active=!1,!this.m_arrMiddle){this.m_arrMiddle=[];var e=cc.instantiate(this.p_nodeMiddle),t=cc.instantiate(this.p_nodeMiddle);e.parent=this.p_nodeMiddle.parent,t.parent=this.p_nodeMiddle.parent,e.setPosition(-cc.winSize.width,this.p_nodeMiddle.y),t.setPosition(cc.winSize.width,this.p_nodeMiddle.y),this.m_arrMiddle.push(e),this.m_arrMiddle.push(this.p_nodeMiddle),this.m_arrMiddle.push(t)}for(var a=0;a<this.m_arrMiddle.length;++a)1==a&&this.m_arrMiddle[a].getComponent("summitpvpGroupNode").refreshUI(this._kingdata,!1,"wangpvp")},refreshTime:function(){var e=app.pages.wangpvppage.getSummitPvpState();switch(this.p_labTip.string=gConfig.getSummitpvpTurnNameByType(e.type+1,e.turn),e.state){case-1:this.p_labTimeTip.string=langMgr.getString("wangpvpPage",4),this.p_labTime.string=gUtils.getCountDownStr(e.time);break;case 1:case 2:this.p_labTimeTip.string=langMgr.getString("wangpvpPage",5),this.p_labTime.string=gUtils.getCountDownStr(e.time);break;case 3:this.p_labTimeTip.string=langMgr.getString("wangpvpPage",6),this.p_labTime.string="00:00:00"}},onClose:function(){this._super(),eventMgr.emit(eventStr.redEvent.RefreshPalacePageRed)}});a.refreshRed=function(e){var t=!1;return a.isOpen()&&((t=a.checkBattleArrRed())||(t=app.pages.wangpvpguesspage.refreshRed())),e&&(e.active=t),t},a.checkBattleArrRed=function(){return!!a.checkWangPvpCanSetBattle().isCanSet&&null==localDataUtils.GetValue("wangpvpred",null)},a.isOpen=function(){return!!app.db.checkFuncUnLock("PALACE")&&!!(app.wangPvpInfo&&app.wangPvpInfo.groupdata&&app.wangPvpInfo.groupdata.length>0)},a.isOver=function(){return app.wangPvpInfo&&2==app.wangPvpInfo.currtype&&3==app.wangPvpInfo.round&&app.wangPvpInfo.kingdata[0].vediolist.length>=3},a.openNextTime=function(){var e=app.player.getServerTime();return app.player.getTimeDay(0,5,0,0,5)-e},a.getSummitPvpState=function(e){void 0===e&&(e=!0);var t=app.player.getServerTime(),i={type:1,turn:1,time:12315623151,state:0};return a.isOpen()&&app.wangPvpInfo&&app.wangPvpInfo.time?(i.type=app.wangPvpInfo.currtype,i.time=app.wangPvpInfo.time-t,i.turn=app.wangPvpInfo.round,i.time<0?(i.time=0,i.locktime=0,i.state=3):i.state=1,a.isOver()&&(i.time=a.openNextTime(),i.locktime=0,i.state=-1)):(i.time=a.openNextTime(),i.type=2,i.state=-1),i},a.checkWangPvpCanSetBattle=function(){var e={isCanShow:!1,isCanSet:!1};if(!app.wangPvpInfo||1!=app.wangPvpInfo.type||!a.isOpen()||a.isOver())return e;var t=["groupdata","kingdata"][app.wangPvpInfo.currtype-1],i=app.wangPvpInfo[t];if(i)for(var n=0;n<i.length;n++){var r=i[n],o=0;if(r.players)for(var s=0;s<r.players.length;s++)if(r.players[s].rid==app.player.id){o=r.players[s].mark+"";break}if(o&&r.record){var p=a.getArrWinerIndex(r.record);e.isCanShow=p[p.length-1].indexOf(o)>=0;break}}return e.isCanShow&&-1==a.getSummitPvpState().state?(e.isCanShow=!1,e):e.isCanShow?(e.isCanSet=1==a.getSummitPvpState().state,e):e},a.dealData=function(e,t,a){void 0===t&&(t=!0),void 0===a&&(a=!1),app.isGetWangPvp||(app.isGetWangPvp=!0,!app.wangPvpInfo||a?app.player.sfSearchWangpvpInfo(function(a,i){app.isGetWangPvp=!1,a?t&&app.showNotice(langMgr.getString("wangpvpPage",1)):i&&i.needstop?t&&app.showNotice(langMgr.getString("wangpvpPage",2)):(app.wangPvpInfo=i,e())}):(app.isGetWangPvp=!1,e()))},a.showPage=function(){var t=this;a.dealData(function(){e("basePage").showPage.call(t,app.wangPvpInfo)},!0,!0)},a.getArrWinerIndex=function(e){for(var t=[],a=0;a<e.length;++a){t[a]=[];for(var i=0;i<e[a].length;++i){var n="string"==typeof e[a][i]?e[a][i]:""+e[a][i];t[a]=t[a].concat(n.split("_"))}}return t},a.dealPlayer=function(e){for(var t=[],a=gUtils.deepClone(e),i=0;i<a.length;++i){var n=a[i].mark;t[n]&&(t[n]={}),t[n]=a[i]}return t},cc._RF.pop()},{basePage:void 0}],windowsAyzzActivity:[function(e,t){"use strict";cc._RF.push(t,"8c2131nRVtOJJZakYEHcR7b","windowsAyzzActivity"),cc.Class({extends:cc.Component,properties:{p_nodeContent:cc.Node},start:function(){},refreshUI:function(e){this.m_data=e;var t=[{index:1,count:e.dzy},{index:2,count:e.xsl},{index:3,count:e.yzzc},{index:4,count:e.yjdx},{index:5,count:3-app.player.getCount(90151)}];t.sort(function(e,t){return t.count-e.count}),t.unshift({index:0,count:app.player.tower});for(var a=0;a<t.length;a++)if(!(t[a].count<0)){var i=this.p_nodeContent.children[a];i||(i=cc.instantiate(this.p_nodeContent.children[0]),this.p_nodeContent.addChild(i)),i.active=!0,i.getComponent("ayzzItem").refreshUI(t[a])}}}),cc._RF.pop()},{}],windowsAyzzGJ:[function(e,t){"use strict";cc._RF.push(t,"48375A8mf5FnKEc10Ai+/fP","windowsAyzzGJ"),cc.Class({extends:cc.Component,properties:{p_labGjTime:cc.Label,p_labGjCountGreen:cc.Label,p_labGjCountRed:cc.Label,p_btnGet:cc.Button,p_btnGoTo:cc.Button},onLoad:function(){var e=this;this.p_btnGet.node.on("click",function(){app.playSound("click"),app.pages.newworldmappage.instance&&cc.isValid(app.pages.newworldmappage.instance.node)&&app.pages.newworldmappage.instance.getHangProfit(),e.m_target.onClose()}),this.p_btnGoTo.node.on("click",function(){app.playSound("click"),app.goToPage(1034)})},start:function(){},refreshUI:function(e){this.m_target=e.target;var t=e.time,a=e.count,i=app.db.dbVip[app.player.vip].RIGHT.HANG_TIME,n=gUtils.getHourMinTime(t),r=n[0],o=n[1];r>=i&&(r=i,o=0);var s=langMgr.getString("windowsAyzzGJ",0,[r,o]);this.p_labGjTime.string=s,a>0?(this.p_labGjCountGreen.node.active=!0,this.p_labGjCountGreen.string=langMgr.getString("windowsAyzzGJ",1,a),this.p_labGjCountRed.node.active=!1):(this.p_labGjCountGreen.node.active=!1,this.p_labGjCountGreen.string=langMgr.getString("windowsAyzzGJ",1,0),this.p_labGjCountRed.node.active=!0)}}),cc._RF.pop()},{}],windowsCjhdPageJNXL:[function(e,t){"use strict";cc._RF.push(t,"64021tyWpJKdqc8ZiLfXlvt","windowsCjhdPageJNXL");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=e("../lang/langMgr"),o=e("basePage"),s=cc._decorator,p=s.ccclass,c=s.property,h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_labTime=null,t.p_btnHelp=null,t.p_nodeItem=null,t.p_nodeItemContent=null,t.p_sprTotalIcon=null,t.p_labTotalCount=null,t.p_sprDiscountIcon=null,t.p_labDiscountCount=null,t.p_sprCostIcon=null,t.p_labCostCount=null,t.p_btnBuy=null,t.m_buyData=[],t.m_shopingData=[],t.m_buyCount=0,t.m_data=null,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){var e=this;a.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.p_btnBuy.node.on("click",function(){if(app.playSound("click"),e.m_buyCount<=0)app.showNotice(r.getString("windowsCjhdPageJNXL",0));else if(app.player.getCount(e.m_data[0].cost[0].GSID||38005)<e.m_buyCount){var t=app.db.getPropsName(e.m_data[0].cost[0].GSID||38005);app.showNotice(r.getString("playerData",0,t))}else{for(var a=[],i=0;i<e.m_shopingData.length;i++)a.push([e.m_shopingData[i].index,e.m_shopingData[i].count]);app.player.sfJnxlBuy(a,function(t,a){if(!t){var i={showtype:1,reward:a,confirmcb:function(){app.player.sfPlayerByParam(["others","hide","props"],function(){eventMgr.emit(eventStr.nhdPage.REFRESH_COIN),eventMgr.emit(eventStr.nhdPage.REFRESH_BTN_RED),eventMgr.emit(eventStr.commonEvent.RefershActivityZhdCoinUi),e.getData()})},target:e};app.pages.windowspagereward.showPage(i)}})}}),this.schedule(this.refreshTime,1)},t.prototype.setParam=function(){this.getData()},t.prototype.getData=function(){var e=this;app.player.sfJnxlList(function(t,a){if(!t){for(var i=0;i<a.length;i++)a[i].index=i;var n=[],r=[];for(i=0;i<a.length;i++)a[i].buytime?n.push(a[i]):r.push(a[i]);e.m_data=n.concat(r),e.refreshUI()}})},t.prototype.refreshUI=function(){this.refreshTime(),this.m_buyData=[];for(var e=0;e<this.m_data.length;e++){var t=this.m_data[e],a=this.p_nodeItemContent.children[e];a||((a=cc.instantiate(this.p_nodeItem)).parent=this.p_nodeItemContent),a.active=!0,a.getComponent("jnxlItem").refreshUI(t,e,this)}for(e=this.m_data.length;e<this.p_nodeItemContent.children.length;e++)this.p_nodeItemContent.children[e].active=!1;this.refreshCost(-1,0)},t.prototype.refreshTime=function(){var e=app.player.getServerTime(),t=app.arrZhdTime.JNXL[1]||0,a=t-e;(!t||a<0)&&(a=0),this.p_labTime.string=0!=a?gUtils.getCountDownStr(a):"00:00:00"},t.prototype.refreshCost=function(e,t){var a=0;if(this.m_shopingData=[],e<0);else{var i=this.findIndex(this.m_data[e].index);i>-1?this.m_buyData[i].count=t:this.m_buyData.push({index:this.m_data[e].index,count:t,cost:this.m_data[e].cost[0]});for(var n=0;n<this.m_buyData.length;n++)0!=this.m_buyData[n].count&&this.m_shopingData.push(this.m_buyData[n]);for(n=0;n<this.m_shopingData.length;n++)a+=this.m_shopingData[n].count*this.m_shopingData[n].cost.COUNT}console.log("total",a);var r=this.checkDiscount(a);console.log("discount",r);var o=app.db.getPropsIconPath(this.m_data[0].cost[0].GSID||38005);app.loadTexture(o,this.p_sprDiscountIcon,app.getPrefabPathFrom(this)),this.p_labDiscountCount.string=""+r,app.loadTexture(o,this.p_sprCostIcon,app.getPrefabPathFrom(this)),this.m_buyCount=a-r,this.p_labCostCount.string=this.m_buyCount+"",app.loadTexture(o,this.p_sprTotalIcon,app.getPrefabPathFrom(this)),this.p_labTotalCount.string=""+a},t.prototype.checkDiscount=function(e){if(e<=0)return 0;for(var t=app.db.dbJNXL.DISCOUNT,a=0;a<t.length;a++)if(e>=t[a][0])return t[a][1];return 0},t.prototype.findIndex=function(e){for(var t=0;t<this.m_buyData.length;t++)if(this.m_buyData[t].index==e)return t;return-1},t.prefabPath="windowsCjhdPageJNXL",t.pageParent="activitycfhdpage",n([c(cc.Label)],t.prototype,"p_labTime",void 0),n([c(cc.Button)],t.prototype,"p_btnHelp",void 0),n([c(cc.Node)],t.prototype,"p_nodeItem",void 0),n([c(cc.Node)],t.prototype,"p_nodeItemContent",void 0),n([c(cc.Sprite)],t.prototype,"p_sprTotalIcon",void 0),n([c(cc.Label)],t.prototype,"p_labTotalCount",void 0),n([c(cc.Sprite)],t.prototype,"p_sprDiscountIcon",void 0),n([c(cc.Label)],t.prototype,"p_labDiscountCount",void 0),n([c(cc.Sprite)],t.prototype,"p_sprCostIcon",void 0),n([c(cc.Label)],t.prototype,"p_labCostCount",void 0),n([c(cc.Button)],t.prototype,"p_btnBuy",void 0),a=n([p],t)}(o);h.refreshRed=function(e){var t=!1,a=app.getRedInfoByObj(["act","jnxl"],null);return null!=a&&(t=a>0),e&&(e.active=t),t},t.exports=h,cc._RF.pop()},{"../lang/langMgr":void 0,basePage:void 0}],windowsCjhdPageXYS:[function(e,t){"use strict";cc._RF.push(t,"89be4nYlRxJaY8AklnWUh9n","windowsCjhdPageXYS");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=e("../lang/langMgr"),o=e("basePage"),s=cc._decorator,p=s.ccclass,c=s.property,h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_labTime=null,t.p_nodeWish=null,t.p_nodeTree=null,t.p_sprWish=null,t.p_arrSprFWish=[],t.p_nodeItemContent=null,t.p_arrNodeSecelt=[],t.p_arrNodeSeceltLight=[],t.p_btnSecelt=null,t.p_pfbItem=null,t.p_nodeParent=null,t.p_barPro=null,t.p_labPro=null,t.p_btnWater=null,t.p_btnGet=null,t.p_nodeFinish=null,t.p_btnHelp=null,t.p_spAnim=null,t.m_data=null,t.m_index=0,t.m_gsid="",t.m_total=0,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){var e=this;a.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.p_arrNodeReward=[];for(var t=[[-87,222],[75.5,222],[-175,94],[158,94]],i=0;i<4;i++){var n=cc.instantiate(this.p_pfbItem);n.parent=this.p_nodeParent,n.scale=.8,n.setPosition(t[i][0],t[i][1]),this.p_arrNodeReward.push(n)}this.p_btnGet.node.on("click",function(){app.playSound("clcik"),gUtils.activityIsOpen("XYSH",!0)&&app.player.sfXyshReward(function(t,a){if(!t){app.player.addItem(a);var i={showtype:1,reward:a,confirmcb:function(){e.p_btnGet.node.active=!1,e.p_btnWater.node.active=!1,e.p_nodeFinish.active=!0,app.redDataServer.act&&app.redDataServer.act.xysh&&(app.redDataServer.act.xysh=0),eventMgr.emit(eventStr.nhdPage.REFRESH_COIN),eventMgr.emit(eventStr.nhdPage.REFRESH_BTN_RED)},target:e};app.pages.windowspagereward.showPage(i)}})}),this.p_btnWater.node.on("click",function(){if(app.playSound("clcik"),gUtils.activityIsOpen("XYSH",!0)){if(app.player.getCount(e.m_gsid)<=0){var t=app.db.getPropsName(e.m_gsid);return app.showNotice(r.getString("playerData",0,t)),void app.pages.windowspagesource.showPage(e.m_gsid)}e.p_spAnim.setAnimation(0,"watering2",!1),app.player.sfXyshWater(function(t,a){t||(e.scheduleOnce(function(){app.playSound("water")},.7),app.showNotice(r.getString("windowsCjhdPageXYS",0)),app.redDataServer.act&&app.redDataServer.act.xysh&&a.num<e.m_total&&(app.redDataServer.act.xysh=0),app.player.sfPlayerByParam(["others","props"],function(){eventMgr.emit(eventStr.nhdPage.REFRESH_COIN),eventMgr.emit(eventStr.nhdPage.REFRESH_BTN_RED),e.getInfo()}))})}}),this.p_btnSecelt.node.on("click",function(){if(app.playSound("clcik"),gUtils.activityIsOpen("XYSH",!0)){var t={content:r.getString("windowsCjhdPageXYS",2),confirmcb:function(){app.player.sfXyshWish(e.m_index,function(t){t||(app.showNotice(r.getString("windowsCjhdPageXYS",1)),app.player.getCount(e.m_gsid)<=0&&(app.redDataServer.act&&app.redDataServer.act.xysh&&(app.redDataServer.act.xysh=0),eventMgr.emit(eventStr.nhdPage.REFRESH_BTN_RED)),e.getInfo())})},target:e};app.pages.windowspagetipsmsg.showPage(t)}}),this.p_btnHelp.node.on("click",function(){app.playSound("clcik"),app.pages.windowspagetipshelp.showPage("1102")}),this.p_arrNodeSecelt.forEach(function(t,a){t.on("touchend",function(){e.m_index!=a&&(app.playSound("clcik"),e.refreshWishReward(a))})}),this.m_data=app.db.dbXysh,this.schedule(this.refreshTime,1)},t.prototype.setParam=function(){gUtils.activityIsOpen("XYSH",!0)&&this.getInfo()},t.prototype.getInfo=function(){var e=this;this.refreshTime(),app.player.sfXyshInfo(function(t,a){t||(e.m_gsid=a.mark,a.wishIndex<0?e.refreshWish():e.refreshTree(a))})},t.prototype.refreshTime=function(){var e=app.player.getServerTime(),t=gUtils.getActivityArrTime("XYSH")[1]||0,a=t-e;(!t||a<0)&&(a=0),this.p_labTime.string=0!=a?gUtils.getCountDownStr(a):"00:00:00"},t.prototype.refreshWish=function(){this.p_nodeTree.active=!1,this.p_nodeWish.active=!0,this.refreshWishReward(0)},t.prototype.refreshTree=function(e){this.p_nodeTree.active=!0,this.p_nodeWish.active=!1;for(var t=e.wish[e.wishIndex],a=0;a<t.length;a++){var i=this.p_arrNodeReward[a];i.active=!0,i.getComponent("propItem").initForBag(t[a]),i.getComponent("propItem").setClick(!0)}for(a=t.length;a<this.p_arrNodeReward.length;a++)this.p_arrNodeReward[a].active=!1;this.m_total=e.total;var n=e.num/e.total;this.p_barPro.progress=n,this.p_labPro.string=e.num+"/"+e.total,this.p_btnGet.node.active=n>=1&&!e.wishDone,this.p_btnWater.node.active=n<1&&!e.wishDone,this.p_btnWater.node.getChildByName("rednotice").active=app.player.getCount(this.m_gsid)>0,this.p_nodeFinish.active=e.wishDone},t.prototype.refreshWishReward=function(e){this.p_arrNodeSeceltLight.forEach(function(t,a){t.active=a==e}),this.p_sprWish.spriteFrame=this.p_arrSprFWish[e],this.m_index=e;for(var t=this.m_data.WISH[e],a=0;a<t.length;a++){var i=this.p_nodeItemContent.children[a];i||((i=cc.instantiate(this.p_pfbItem)).scale=.7,i.parent=this.p_nodeItemContent),i.active=!0,i.getComponent("propItem").initForBag(t[a]),i.getComponent("propItem").setClick(!0)}for(a=t.length;a<this.p_nodeItemContent.children.length;a++)this.p_nodeItemContent.children[a].active=!1},t.prefabPath="windowsCjhdPageXYS",t.pageParent="activitycfhdpage",n([c(cc.Label)],t.prototype,"p_labTime",void 0),n([c(cc.Node)],t.prototype,"p_nodeWish",void 0),n([c(cc.Node)],t.prototype,"p_nodeTree",void 0),n([c(cc.Sprite)],t.prototype,"p_sprWish",void 0),n([c(cc.SpriteFrame)],t.prototype,"p_arrSprFWish",void 0),n([c(cc.Node)],t.prototype,"p_nodeItemContent",void 0),n([c(cc.Node)],t.prototype,"p_arrNodeSecelt",void 0),n([c(cc.Node)],t.prototype,"p_arrNodeSeceltLight",void 0),n([c(cc.Button)],t.prototype,"p_btnSecelt",void 0),n([c(cc.Prefab)],t.prototype,"p_pfbItem",void 0),n([c(cc.Node)],t.prototype,"p_nodeParent",void 0),n([c(cc.ProgressBar)],t.prototype,"p_barPro",void 0),n([c(cc.Label)],t.prototype,"p_labPro",void 0),n([c(cc.Button)],t.prototype,"p_btnWater",void 0),n([c(cc.Button)],t.prototype,"p_btnGet",void 0),n([c(cc.Node)],t.prototype,"p_nodeFinish",void 0),n([c(cc.Button)],t.prototype,"p_btnHelp",void 0),n([c(sp.Skeleton)],t.prototype,"p_spAnim",void 0),a=n([p],t)}(o);h.refreshRed=function(e){var t=!1,a=app.getRedInfoByObj(["act","xysh"],null);return null!=a&&(t=a>0),e&&(e.active=t),t},t.exports=h,cc._RF.pop()},{"../lang/langMgr":void 0,basePage:void 0}],windowsPageAYZZ:[function(e,t){"use strict";cc._RF.push(t,"7a723xDdOVAdLgP3pA+7baB","windowsPageAYZZ");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspageayzz",pageType:1},properties:{p_labNextLevel:cc.Label,p_labNowLevel:cc.Label,p_labTime:cc.Label,p_labTitle:cc.Label,p_node1:cc.Node,p_node2:cc.Node},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){this._super()},setParam:function(e){var t=this;app.player.sfAyzz(function(a,i){a||(t.m_data=i,t.refreshUI(e))})},refreshUI:function(e){this.p_labNextLevel.string=langMgr.getString("windowsPageAYZZ",0,e+1),this.p_labNowLevel.string=langMgr.getString("windowsPageAYZZ",0,app.player.level),this.refreshTime(e);var t=app.player.getServerTime()-app.player.lastreap,a=Math.floor(t/1e3/60),i=app.db.getVipQuickRewardCount(app.player.vip);a>=5||i>0?(this.p_node1.active=!0,this.p_node2.active=!1,this.p_node1.getComponent("windowsAyzzGJ").refreshUI({time:t,count:i,target:this})):(this.p_node2.active=!0,this.p_node1.active=!1,this.p_node2.getComponent("windowsAyzzActivity").refreshUI(this.m_data))},refreshTime:function(e){var t=app.player.exp,a=app.db.getPlayerNextExpByLv(e)-t,i=app.db.getMapInfo(app.player.maxmapid),n=app.db.dbVip[app.player.vip].RIGHT,r=i.HANG[0],o=n.HANG_EXP/1e3,s=Math.floor(12*r.COUNT*(1+o)),p=Math.floor(a/s),c=Math.floor(p/60);if(c<24){var h=p%60;this.p_labTime.string=langMgr.getString("windowsPageAYZZ",3,[c,h])}else{var l=Math.floor(c/24);this.p_labTime.string=langMgr.getString("windowsPageAYZZ",4,[l,c%24])}}});cc._RF.pop()},{basePage:void 0}],windowsPageAchieve:[function(e,t){"use strict";cc._RF.push(t,"613cczIYR5Oapdea7CB2LWu","windowsPageAchieve");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspageachieve",pageType:1,createShot:!0},properties:{p_tabview:cc.Node,p_bannerSpr:cc.Sprite,p_bannerSprf:[cc.SpriteFrame]},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){this._super()},setParam:function(e){void 0===e&&(e=0),e>1&&(e=0),this.m_type=e,this.refeshUI()},setData:function(){if(0==this.m_type){for(var e=gUtils.deepClone(app.db.dbMapAchive),t=app.player.getCount(93199),a=0;a<e.length;a++)a<t?e[a].status=0:a==t?app.player.maxmapid>e[a].MAPID?e[a].status=2:e[a].status=3:e[a].status=1;return e.sort(function(e,t){return e.status<t.status?1:e.status==t.status?0:-1}),e}if(1==this.m_type){var i=gUtils.deepClone(app.db.dbTowerAchieve.ACHIEVE),n=app.player.getCount(app.db.dbTowerAchieve.GETMARK);console.log(n);for(var r=0;r<i.length;r++)r<n?i[r].status=0:r==n?app.player.tower>i[r].TOWER?i[r].status=2:i[r].status=3:i[r].status=1;return i.sort(function(e,t){return e.status<t.status?1:e.status==t.status?0:-1}),i}},refeshUI:function(){this.p_bannerSpr.spriteFrame=this.p_bannerSprf[this.m_type];var e=this.setData(),t=e.length;this.p_tabview.getComponent("tableView").initTableView(t,{array:e,target:this})}});cc._RF.pop()},{basePage:void 0}],windowsPageActiveSource:[function(e,t){"use strict";cc._RF.push(t,"2960eGE7jpNI7RRIriCE3x/","windowsPageActiveSource");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspageactivesource",pageType:1},properties:{p_labTitle:cc.Label,p_nodeContent:cc.Node,p_nodeItem:cc.Node},onLoad:function(){a.instance=this,this.handleUI(),this.creatMask(!0)},handleUI:function(){this._super()},setParam:function(e){this.m_objData=e,this.refreshUI()},refreshUI:function(){this.p_labTitle.string=this.m_objData.title,this.refreshSView(this.m_objData.event)},refreshSView:function(e){this.m_arrItems||(this.m_arrItems=[],this.m_arrItems.push(this.p_nodeItem));for(var t=0;t<e.length;++t){var a=this.m_arrItems[t];a||((a=cc.instantiate(this.p_nodeItem)).parent=this.p_nodeContent,this.m_arrItems.push(a)),a.active=!0,a.getComponent("activitySourceItem").refreshUI(e[t])}for(var i=e.length;i<this.m_arrItems.length;++i)this.m_arrItems[i].active=!1}});cc._RF.pop()},{basePage:void 0}],windowsPageAdvanceNotice:[function(e,t){"use strict";cc._RF.push(t,"67908+8lIpAcZSfodPF93mu","windowsPageAdvanceNotice");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspageadvancenotice",pageType:1},properties:{p_labTimed:cc.Label},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},onEnable:function(){this._super(),eventMgr.on(eventStr.commonEvent.RefreshTime,this.refreshTime,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.commonEvent.RefreshTime,this.refreshTime,this)},handleUI:function(){this._super()},setParam:function(){this.refreshTime()},refreshTime:function(){if(this.p_labTimed){var e,t=app.player.getServerTime();e=new Date("2020-7-31 21:00:00").getTime()-t,this.p_labTimed.string=gUtils.getCountDownStr(e)}}});cc._RF.pop()},{basePage:void 0}],windowsPageAutoBattleInfo:[function(e,t){"use strict";cc._RF.push(t,"1f17fr/iA9MgIRX3yFePVug","windowsPageAutoBattleInfo");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspageautobattleinfo"},properties:{p_labTime:cc.Label,p_labExp:cc.Label,p_labGold:cc.Label,p_labGexp:cc.Label,p_nodeView:cc.Node},onLoad:function(){a.instance=this,this._super(),this.m_arrReward=[]},handleUI:function(){this._super()},setParam:function(e){this._data=e.data,this._oldlv=e.oldlv,this.refreshUI()},refreshUI:function(){app.player.getServerTime();var e=gUtils.getHourMinSecTime(Math.floor((app.player.getServerTime()-app.player.lastreap)/1e3));this.p_labTime.string=e;for(var t=app.db.getMapInfo(app.player.nowmapid),a=0;a<t.HANG.length;++a)switch(t.HANG[a].GSID){case 38001:this.p_labExp.string=langMgr.getString("windowsPageAutoBattleInfo",0,12*t.HANG[a].COUNT);break;case 38006:this.p_labGold.string=langMgr.getString("windowsPageAutoBattleInfo",0,12*t.HANG[a].COUNT);break;case 30001:this.p_labGexp.string=langMgr.getString("windowsPageAutoBattleInfo",0,12*t.HANG[a].COUNT)}var i=this._data.length;this.p_nodeView.getComponent("tableView").initTableView(i,{array:this._data,target:this})},onClose:function(){this._super();var e=this._oldlv;e<app.player.level&&app.pages.windowspageplayerlvup.showPage(e)}});cc._RF.pop()},{basePage:void 0}],windowsPageBookAwakenPreview:[function(e,t){"use strict";cc._RF.push(t,"9c5aaDSosZBuIRRDycA45Ix","windowsPageBookAwakenPreview");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=(e("langMgr"),cc._decorator),o=r.ccclass,s=r.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_nodeContent=null,t.p_labTitle=null,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0,150),this.handleUI()},t.prototype.setParam=function(e){this.m_pos=e.pos,this.m_type=e.type,this.refreshUI()},t.prototype.refreshUI=function(){this.p_labTitle.string=(this.m_type,window.langMgr.getString("windowsPageBookAwakenPreview",0));for(var e=app.db.getBookAwakenPropByPos(this.m_pos),t=0;t<e.length;t++){var a=this.p_nodeContent.children[t];a||((a=cc.instantiate(this.p_nodeContent.children[0])).parent=this.p_nodeContent),a.active=!0;var i=gConfig.getBookAwakenPropPath(e[t].toLowerCase());app.loadTexture(i,a.getComponent(cc.Sprite),this.prefabPath)}for(t=e.length;t<this.p_nodeContent.children.length;t++)this.p_nodeContent.children[t].active=!1},t.prefabPath="windowsPageBookAwakenPreview",t.pageType=1,n([s(cc.Node)],t.prototype,"p_nodeContent",void 0),n([s(cc.Label)],t.prototype,"p_labTitle",void 0),a=n([o],t)}(e("basePage"));t.exports=p,cc._RF.pop()},{basePage:void 0,langMgr:void 0}],windowsPageBookAwakenSucc:[function(e,t){"use strict";cc._RF.push(t,"22ac59IDuBOnKzG/3JuqdUx","windowsPageBookAwakenSucc");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=cc._decorator,o=r.ccclass,s=r.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_arrSprStar=[],t.p_nodeMianProp=null,t.p_sprAwakenProp=null,t.p_sprSuitSkillIcon=null,t.p_labSuitSkillIntro=null,t.p_labMainPropName=null,t.p_labMainOldVal=null,t.p_labMainNewVal=null,t.p_spTitleAnim=null,t.m_oldGsid=0,t.m_bookInfo=null,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},t.prototype.setParam=function(e){this.m_oldGsid=e.gsid,this.m_bookInfo=e.book,this.refreshUI()},t.prototype.refreshUI=function(){app.playUpgradeAnim({spComp:this.p_spTitleAnim,startName:"appear",endName:"loop",index:7,target:this});var e=app.db.getBBaseByGsid(this.m_oldGsid),t=gConfig.getGlobalStarPath(e.STAR-1),a=app.db.getBBaseByGsid(this.m_bookInfo.gsid),i=gConfig.getGlobalStarPath(a.STAR-1);app.loadTexture(t,this.p_arrSprStar[0],this.prefabPath),app.loadTexture(i,this.p_arrSprStar[1],this.prefabPath);var n=this.p_labMainPropName,r=this.p_labMainOldVal,o=this.p_labMainNewVal,s=app.db.getPropertyCnByEn(a.PROP[0].KEY),p=e.PROP[0].VAL,c=a.PROP[0].VAL,h=app.db.getPropertyIdByEn(a.PROP[0].KEY);h&&2==app.db.dbProperty[h].NUMTYPE&&(p=p/10+"%",c=c/10+"%"),n.string=s,r.string=p,o.string=c;var l=this.m_bookInfo.awake[0],g=gConfig.getBookAwakenPropPath(l.key);app.loadTexture(g,this.p_sprAwakenProp,this.prefabPath);var d=app.db.getSuitBookById(a.SUITID,a.STAR).SKILL[0],u=app.db.getSuitSkillInfoBySuitId(d),f=app.db.getBookSuitIconPath(a.SUITID,a.STAR);app.loadTexture(f,this.p_sprSuitSkillIcon,this.prefabPath),this.p_labSuitSkillIntro.string=u.INTRO},t.prototype.onClose=function(){var t=app.db.getBBaseByGsid(this.m_bookInfo.gsid);eventMgr.emit(eventStr.generalPageBook.RefreshBook),eventMgr.emit(eventStr.generalPageBook.RefreshBookBag,t.POS),e.prototype.onClose.call(this)},t.prefabPath="windowsPageBookAwakenSucc",t.pageType=1,n([s(cc.Sprite)],t.prototype,"p_arrSprStar",void 0),n([s(cc.Node)],t.prototype,"p_nodeMianProp",void 0),n([s(cc.Sprite)],t.prototype,"p_sprAwakenProp",void 0),n([s(cc.Sprite)],t.prototype,"p_sprSuitSkillIcon",void 0),n([s(cc.Label)],t.prototype,"p_labSuitSkillIntro",void 0),n([s(cc.Label)],t.prototype,"p_labMainPropName",void 0),n([s(cc.Label)],t.prototype,"p_labMainOldVal",void 0),n([s(cc.Label)],t.prototype,"p_labMainNewVal",void 0),n([s(sp.Skeleton)],t.prototype,"p_spTitleAnim",void 0),a=n([o],t)}(e("basePage"));t.exports=p,cc._RF.pop()},{basePage:void 0}],windowsPageBookRandomPreview:[function(e,t){"use strict";cc._RF.push(t,"a9653h70ClBW4V4tbbkTSap","windowsPageBookRandomPreview");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=(e("langMgr"),cc._decorator),o=r.ccclass,s=r.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_nodeContent=null,t.p_labTitle=null,t.p_labIntro=null,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0,150),this.handleUI()},t.prototype.setParam=function(e){this.m_pos=e.pos,this.refreshUI()},t.prototype.refreshUI=function(){this.p_labTitle.string=window.langMgr.getString("windowsPageBookRandomPreview",0);for(var e=app.db.getBookPropByPosStar(this.m_pos,6),t=app.db.getBookStrAddByStar(6),a=0;a<e.length;a++){var i=this.p_nodeContent.children[a];i||((i=cc.instantiate(this.p_nodeContent.children[0])).parent=this.p_nodeContent),i.active=!0;for(var n=i.getChildByName("name").getComponent(cc.Label),r=i.getChildByName("val").getComponent(cc.Label),o=i.getChildByName("add").getComponent(cc.Label),s=app.db.getPropertyCnByEn(e[a].KEY),p=e[a].VAL,c=void 0,h=0;h<t.length;h++)t[h].KEY==e[a].KEY&&(c=t[h].VAL);var l=app.db.getPropertyIdByEn(e[a].KEY);l&&2==app.db.dbProperty[l].NUMTYPE&&(p=p/10+"%",c=c/10+"%"),n.string=s,r.string=window.langMgr.getString("windowsPageBookRandomPreview",1,p),o.string=window.langMgr.getString("bookAwakenPage",2,c)}for(a=e.length;a<this.p_nodeContent.children.length;a++)this.p_nodeContent.children[a].active=!1},t.prototype.setData=function(){},t.prefabPath="windowsPageBookRandomPreview",t.pageType=1,n([s(cc.Node)],t.prototype,"p_nodeContent",void 0),n([s(cc.Label)],t.prototype,"p_labTitle",void 0),n([s(cc.Label)],t.prototype,"p_labIntro",void 0),a=n([o],t)}(e("basePage"));t.exports=p,cc._RF.pop()},{basePage:void 0,langMgr:void 0}],windowsPageBossBattle:[function(e,t){"use strict";cc._RF.push(t,"ca047I4W9VMK63tCDYpuYm9","windowsPageBossBattle");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagebossbattle",pageType:1},properties:{p_arrRewards:[cc.Node],p_arrGenerals:[cc.Node],p_rewardItem:cc.Prefab,p_rewardContent:cc.Node,p_generalItem:cc.Prefab,p_generalContent:cc.Node,p_btnBattle:cc.Button,p_labTitle:cc.Label,p_sprName:cc.Sprite,p_labIntro:cc.Label,p_powerNode:cc.Node,p_headIcon:cc.Sprite,p_labPass:cc.Label},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.creatMask(!0),this.m_arrPorp=[],this.m_arrGeneral=[]},handleUI:function(){var e=this;this._super(),this.p_btnBattle.node.on("click",function(){app.playSound("click"),app.player.sfMonthBossInfo(e.m_bossData.boss.bossid,function(t,a){if(e&&cc.isValid(e.node)&&a){e.onClose();var i=e.m_bossData.boss.bossid;app.battleParam=1,app.battleIndex=i,app.goToBossBattle("dramaboss",a)}})})},setParam:function(e){this.m_bossData=e.data,this.m_index=e.index,e.target&&(this.m_target=e.target),this.m_objData=this.m_bossData.bossset[this.m_index],this.refreshUI()},refreshUI:function(){this.p_btnBattle.node.active=this.m_index==this.m_bossData.boss.subindex;var e=app.db.getPveProperInfo(this.m_objData.bset);if(console.log(e),this.p_powerNode){var t=0;for(var a in e.team)t+=e.team[a].power||0;this.p_powerNode.getComponent(cc.Label).string=gUtils.showNum(t)}this.generalList=[];var i=gUtils.deepClone(e.team);for(var n in i){var r=i[n];r.mppercent=0;var o=i[n].level;r.level=o,this.generalList.push(r)}if(this.generalList)for(var s=0;s<this.generalList.length;s++){var p=this.generalList[s],c=this.m_arrGeneral[s];c||((c=cc.instantiate(this.p_generalItem)).parent=this.p_generalContent,this.m_arrGeneral.push(c)),c.getComponent("generalDungeonItem").refreshUI(p,!1,!0,!0),c.getComponent("generalDungeonItem").selected(!1),c.active=!0}var h=app.db.getGHeadIconByGsid(this.m_objData.gsid);app.loadTexture(h,this.p_headIcon,this.prefabPath);var l=app.db.getGNamePathHByGsid(this.m_objData.gsid);app.loadTexture(l,this.p_sprName,this.prefabPath);var g=app.db.getGIntroByGsid(this.m_objData.gsid);this.p_labIntro.string=g.INTRO,this.p_labPass.node.active=this.m_index>this.m_bossData.boss.subindex;for(var d=app.db.getDramaBossInfo(this.m_bossData.boss.bossid).BATTLE[this.m_index].REWARDS,u=0;u<d.length;u++){var f=d[u],m=this.m_arrPorp[u];m||((m=cc.instantiate(this.p_rewardItem)).parent=this.p_rewardContent,this.m_arrPorp.push(m)),m.getComponent("propItem").initForBag(f),m.getComponent("propItem").setClick(!0),m.active=!0}for(var _=d.length;_<this.m_arrPorp.length;_++)this.m_arrPorp[_].active=!1;for(var v=this.generalList.length;v<this.m_arrGeneral.length;v++)this.m_arrGeneral[v].active=!1}});cc._RF.pop()},{basePage:void 0}],windowsPageBossTalk:[function(e,t){"use strict";cc._RF.push(t,"e1e5axdCgJG1ZSFAz96XhPp","windowsPageBossTalk");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagebosstalk",pageType:1},properties:{p_sprName:cc.Sprite,p_labName:cc.Label,p_nameAtlas:cc.SpriteAtlas,p_labTalk:cc.Label,p_btnGoto:cc.Button,p_sprGeneral:cc.Sprite,p_spGeneral:sp.Skeleton,p_animGeneral:cc.Animation},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){var e=this;this._super(),this.p_btnGoto.node.on("click",function(){e.onClose()})},setParam:function(e){this.m_objData=e.obj,this.m_confirmcb=e.confirmcb,e.target&&(this.m_target=e.target),this.refreshUI()},refreshUI:function(){var e=app.db.getDramaBossInfo(this.m_objData.boss.bossid).GSID,t=app.db.getDramaEventInfo(this.m_objData.boss.bossid);this.p_labTalk.string=t.BOSSTALK;var a=app.db.getGBaseByGsid(e);app.loadGeneral(e,this.p_sprGeneral,this.p_spGeneral,this.p_animGeneral,function(){},this.prefabPath),this.p_labName.string=a.NAME+"\uff01"},onClose:function(){this.m_confirmcb&&this.m_confirmcb.call(this.m_target),this._super()}});cc._RF.pop()},{basePage:void 0}],windowsPageChapterInfo:[function(e,t){"use strict";cc._RF.push(t,"2c10dTLtxNMeIOYZsexYY+E","windowsPageChapterInfo");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagechapterinfo"},properties:{p_labMapName:cc.Label,p_labExp:cc.Label,p_labGold:cc.Label,p_labGexp:cc.Label,p_nodeContent:cc.Node,p_pfbItem:cc.Prefab},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.m_arrDrop=[]},handleUI:function(){this._super()},setParam:function(e){this._mapid=e,this.refreshUI()},refreshUI:function(){var e=app.db.getMapInfo(this._mapid);this.p_labMapName.string=e.NAME;for(var t=0;t<e.HANG.length;++t)switch(e.HANG[t].GSID){case 38001:this.p_labExp.string=langMgr.getString("windowsPageChapterInfo",0,12*e.HANG[t].COUNT);break;case 38006:this.p_labGold.string=langMgr.getString("windowsPageChapterInfo",0,12*e.HANG[t].COUNT);break;case 30001:this.p_labGexp.string=langMgr.getString("windowsPageChapterInfo",0,12*e.HANG[t].COUNT)}for(var a=0;a<e.DROPS.length;++a){var i=this.m_arrDrop[a];i||((i=cc.instantiate(this.p_pfbItem)).parent=this.p_nodeContent,this.m_arrDrop.push(i)),i.active=!0,i.getComponent("propItem").initForGsid(e.DROPS[a].GSID),i.getComponent("propItem").setClick(!0)}for(var n=e.DROPS.length;n<this.m_arrDrop.length;++n)this.m_arrDrop[n].active=!1},goToHang:function(){var e=this;app.player.sfChapterChange(this._mapid,function(){e.onClose(),app.player.sfPlayerData(function(){app.player.nowmapid=Number(e._mapid)})})}});cc._RF.pop()},{basePage:void 0}],windowsPageCityInfo:[function(e,t){"use strict";cc._RF.push(t,"d85fb3eh5pNgpulEzu4c4Ig","windowsPageCityInfo");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagecityinfo"},properties:{p_arrChapter:[cc.Node],p_nodeGeneral:cc.Node,p_labName:cc.Label,p_labExp:cc.Label,p_labGold:cc.Label,p_labGexp:cc.Label,p_arrRewards:[cc.Node],p_btnCheck:cc.Button,p_btnFight:cc.Button},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){this._super(),this.p_btnCheck.node.on("click",function(){app.playSound("click"),app.pages.windowspagechapterinfo.showPage(app.player.nowmapid)}),this.p_btnFight.node.on("click",function(){app.playSound("click"),app.battleType="normal",app.goToNormBattle()})},setParam:function(e){this._city=e,this.refreshUI()},refreshUI:function(){this.refreshCityInfo(),this.refreshHangInfo()},refreshCityInfo:function(){var e=app.db.getCityInfo(this._city);this.p_nodeGeneral.getComponent("generalPortraitItem")._init("GSID",e.GENERAL),this.p_labName.string=e.NAME;for(var t=0;t<e.MAP.length;++t)this.p_arrChapter[t].getComponent("mapChapterItem").refreshUI(e.MAP[t]);for(var a=e.MAP.length;a<this.p_arrChapter.length;++a)this.p_arrChapter[a].active=!1},refreshHangInfo:function(){for(var e=app.db.getMapInfo(app.player.nowmapid),t=0;t<e.REWARDS.length&&t<this.p_arrRewards.length;++t)this.p_arrRewards[t].active=!0,this.p_arrRewards[t].getComponent("propItem").initForBag(e.REWARDS[t]);for(var a=e.REWARDS.length;a<this.p_arrRewards.length;++a)this.p_arrRewards[a].active=!1;for(var i=0;i<e.HANG.length;++i)switch(e.HANG[i].GSID){case 38001:this.p_labExp.string=langMgr.getString("windowsPageCityInfo",0,12*e.HANG[i].COUNT);break;case 38006:this.p_labGold.string=langMgr.getString("windowsPageCityInfo",0,12*e.HANG[i].COUNT);break;case 30001:this.p_labGexp.string=langMgr.getString("windowsPageCityInfo",0,12*e.HANG[i].COUNT)}this.p_btnFight.node.active=app.player.nowmapid===app.player.maxmapid}});cc._RF.pop()},{basePage:void 0}],windowsPageCode:[function(e,t){"use strict";cc._RF.push(t,"d30a54gELBIq5WWKNO5ARkk","windowsPageCode");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagecode",pageType:1},properties:{p_editCode:cc.EditBox,p_btnExCode:cc.Button},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(),this.handleUI()},handleUI:function(){var e=this;this._super(),this.p_btnExCode.node.on("click",function(){var t=e.p_editCode.string;if(t.length<=0)app.showNotice(langMgr.getString("windowsPageCode",0));else{for(var a=0;a<t.length;a++){var i=t.substr(a,1);if(!(i>="A"&&i<="Z")&&!(i>="a"&&i<="z")&&isNaN(i))return void app.showNotice(langMgr.getString("windowsPageCode",1))}var n=e;app.player.sfCDKey(t,function(e,t){if(e)n.showError(e),n.refreshUI();else{n.m_data=t;var a={showtype:1,reward:t,target:n};app.pages.windowspagereward.showPage(a),n._payRefreshEnd=!1,n.payRefresh(),n.schedule(n.payRefresh,1,3)}})}})},setParam:function(){this.refreshUI()},payRefresh:function(){var e=this;this._payRefreshEnd||app.player.sfPlayerData(function(){e._payRefreshEnd=!0,app.showNotice(langMgr.getString("windowsPageCode",2)),e.refreshUI()})},showError:function(e){var t=e;switch(e){case"cdkey nexist":t=langMgr.getString("windowsPageCode",3);break;case"cdkey pause":t=langMgr.getString("windowsPageCode",4);break;case"before start":t=langMgr.getString("windowsPageCode",5);break;case"after expire":t=langMgr.getString("windowsPageCode",6);break;case"cdkey runout":t=langMgr.getString("windowsPageCode",7);break;case"channel forbit":t=langMgr.getString("windowsPageCode",8);break;case"server forbit":t=langMgr.getString("windowsPageCode",9);break;case"level forbit":t=langMgr.getString("windowsPageCode",10);break;case"no more":t=langMgr.getString("windowsPageCode",11)}app.showNotice(t)},refreshUI:function(){this.p_editCode.string=""}});cc._RF.pop()},{basePage:void 0}],windowsPageCutCity:[function(e,t){"use strict";cc._RF.push(t,"22a8bV/H5FD9IYoqsplvYIj","windowsPageCutCity");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagecutcity",pageType:1},properties:{p_nodeBg_1:cc.Node,p_nodeSiege:cc.Node,p_sprCity:cc.Sprite,p_rtNotice:cc.RichText,p_btnNext:cc.Button},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){var e=this;this._super(),this.p_btnNext.node.on("click",function(){e.m_eventCb&&e.m_eventCb(),e.onClose()})},setParam:function(e){this.m_cityId=e.cityId,this.m_eventCb=e.cb,this.refreshUI()},refreshUI:function(){var e,t=app.player.maxmapid,a=app.db.getMapInfo(t).CITY,i=app.db.getCityInfo(this.m_cityId),n=i.CITYNAME;this.p_nodeBg_1.active=!0,e=langMgr.getString("windowsPageCutCity",0,n);var r=app.db.getCityIconPath(this.m_cityId);this.m_cityId==a?r+="_blue":r+="_red",gSetting.checkReviewServ()&&(r+="_pgts"),app.loadTexture(r,this.p_sprCity,this.prefabPath),this.p_nodeSiege.active=-1!=i.MAP.indexOf(t),this.p_rtNotice.string=e}});cc._RF.pop()},{basePage:void 0}],windowsPageDeclare:[function(e,t){"use strict";cc._RF.push(t,"5bc44q3TiBFwLhgsbKk2d5G","windowsPageDeclare");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagedeclare",pageType:1},properties:{p_maskNode:cc.Node,p_nodeLeft:cc.Node,p_nodeRight:cc.Node,p_nodeHint:cc.Node,p_labHint:cc.RichText,p_sprNormalBt:cc.Sprite,p_sprForce:[cc.SpriteFrame]},onLoad:function(){a.instance=this,this.m_numLeftX=this.p_nodeLeft.x,this.m_numRightX=this.p_nodeRight.x,this.creatMask(!0)},setParam:function(e){this.m_cb=e.cb,this.setAction(),this.refreshUI(e.id,e.isEnd,e.bNb)},refreshUI:function(e,t,a){var i="",n=app.player.rname;app.player.maxmapid<10201&&(n=langMgr.getString("windowsPageDeclare",3));var r=app.seasonData.info,o=200+r.year+langMgr.getString("windowsPageDeclare",4);switch(r.season){case 1:o+=langMgr.getString("windowsPageDeclare",5);break;case 2:o+=langMgr.getString("windowsPageDeclare",6);break;case 3:o+=langMgr.getString("windowsPageDeclare",7);break;case 4:o+=langMgr.getString("windowsPageDeclare",8)}if(a){var s=app.db.getMapInfo(app.player.maxmapid),p=app.db.getCityInfo(s.CITY);this.p_sprNormalBt.spriteFrame=this.p_sprForce[1],i=langMgr.getString("windowsPageDeclare",0,[o,n,p.CITYNAME])}else this.p_sprNormalBt.spriteFrame=t?this.p_sprForce[0]:this.p_sprForce[1];this.p_labHint.string=i},setAction:function(){var e=this;this.m_isAction=!0,this.p_nodeLeft.x=this.m_numLeftX,this.p_nodeRight.x=this.m_numRightX,this.p_nodeHint.opacity=0,this.p_nodeRight.runAction(cc.moveTo(.5,cc.v2(280,this.p_nodeRight.y))),this.p_nodeLeft.runAction(cc.sequence(cc.moveTo(.5,cc.v2(-280,this.p_nodeLeft.y)),cc.callFunc(function(){setTimeout(function(){e.p_nodeHint.runAction(cc.sequence(cc.fadeIn(.3),cc.callFunc(function(){e.m_isAction=!1})))},.5)})))},update:function(){this.m_isAction&&this.setMaskWidth()},setMaskWidth:function(){var e=Math.abs(this.p_nodeLeft.x)+this.p_nodeRight.x;this.p_maskNode.width=e},onClose:function(){this.m_isAction?(this.p_nodeLeft.stopAllActions(),this.p_nodeRight.stopAllActions(),this.p_nodeHint.stopAllActions(),this.m_isAction=!1,this.p_nodeLeft.x=-280,this.p_nodeRight.x=280,this.p_nodeHint.opacity=255,this.setMaskWidth()):(this._super(),this.m_cb&&this.m_cb())}});cc._RF.pop()},{basePage:void 0}],windowsPageEquipBuildSucc:[function(e,t){"use strict";cc._RF.push(t,"08763bdt89AOqvaIg5AfP/c","windowsPageEquipBuildSucc");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspageequipbuildsucc",pageType:1},properties:{p_nodeItem:cc.Node,p_pfbPropItem:cc.Prefab,p_arrProNode:[cc.Node],p_arrNodeSkill:[cc.Node],p_labSuitName:cc.Label,p_spTitleAnim:sp.Skeleton},onLoad:function(){a.instance=this,this.handleUI(),this.creatMask(!0),this.stopBgNodeEvent(),this.m_propItem=null},handleUI:function(){this._super()},setParam:function(e){console.log(e),this.m_beforequip=e.beforequip,this.m_equip=e.items[0].gsid,this.m_data=e,this.refreshUI()},refreshUI:function(){app.playUpgradeAnim({spComp:this.p_spTitleAnim,startName:"appear",endName:"loop",index:5,target:this}),this.m_propItem||(this.m_propItem=cc.instantiate(this.p_pfbPropItem),this.m_propItem.parent=this.p_nodeItem,this.m_propItem.active=!0);var e=app.db.getEBaseByGsid(this.m_beforequip),t=app.db.getEBaseByGsid(this.m_equip);console.log(e,t),this.m_propItem.getComponent("propItem").initForGEquip(this.m_equip);var a=app.db.dbOccuequipset[t.SETID].SKILL;this.p_arrNodeSkill.forEach(function(e,t){if(a[t]){e.active=!0;var i=a[t];console.log(i),e.getComponent("suitSetItem").refreshUI(i,0,t)}else e.active=!1});var i=[[langMgr.getString("windowsPageEquipBuildSucc",0),t.NAME,e.NAME]];this.p_labSuitName.string=t.SUITNAME;for(var n=0;n<t.PROP.length;n++){var r=t.PROP[n],o=[],s=r.VAL,p=app.db.getPropertyIdByEn(r.KEY);p&&2==app.db.dbProperty[p].NUMTYPE&&(s=s/10+"%"),o.push(r.KEY),o.push(s),i.push(o)}for(var c=1;c<i.length;c++){var h=i[c];h.push[0];for(var l=0;l<e.PROP.length;l++){var g=e.PROP[l],d=g.VAL,u=app.db.getPropertyIdByEn(g.KEY);u&&2==app.db.dbProperty[u].NUMTYPE&&(d=d/10+"%"),h[0]==g.KEY&&(h[2]=d)}}for(var f=0;f<this.p_arrProNode.length;f++){var m=i[f],_=this.p_arrProNode[f];if(!m)return void(this.p_arrProNode[f].active=!1);var v=_.getChildByName("key").getComponent(cc.Label),b=_.getChildByName("old_val").getComponent(cc.Label),y=_.getChildByName("new_val").getComponent(cc.Label);if(0==f)v.string=m[0];else{var P=app.db.getPropertyCnByEn(m[0]);v.string=P}b.string=m[2]||0,y.string=m[1]||0,this.p_arrProNode[f].active=!0}},onClose:function(){this._super();var e={};e.gsid=this.m_equip,e.type=1,e.general=this.m_data.general.guid,e.isHideBtn=!1,e.isBuild=!0,app.pages.generalpage.instance.refreshInfo(this.m_data.general),app.pages.windowspagetipsequip.showPage(e)}});cc._RF.pop()},{basePage:void 0}],windowsPageExpeditionCSM:[function(e,t){"use strict";cc._RF.push(t,"2a76ff2enVKsZ9zSZZa3kgG","windowsPageExpeditionCSM");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspageexpeditioncsm",pageType:1},properties:{p_arrDiffNodes:[cc.Node],p_btnBattle:cc.Button},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.creatMask(!0)},handleUI:function(){var e=this;this._super(),this.p_btnBattle.node.on("click",function(){app.playSound("click"),e.onClose(),app.player.sfExpedNextGate({gatetype:app.expeditionInfo.nextgatetype[e.m_index]},function(e){e?app.showNotice(e):app.pages.expeditionpage.instance.goNextFloor()})})},setParam:function(e){this.m_index=e,this.refreshUI()},refreshUI:function(){var e=0;app.expeditionInfo.nextgatetype.length>1&&Math.max.apply(null,app.expeditionInfo.nextgatetype)==app.expeditionInfo.nextgatetype[this.m_index]&&(e=1),this.p_arrDiffNodes.forEach(function(t,a){t.active=e==a})}});cc._RF.pop()},{basePage:void 0}],windowsPageExpeditionCardPreview:[function(e,t){"use strict";cc._RF.push(t,"8c0b9h5nWNFSalBGWW02Hna","windowsPageExpeditionCardPreview");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspageexpeditioncardpreview",pageType:1},properties:{p_cardParent:cc.Node,p_cardPrefab:cc.Prefab,p_desNode:cc.Node,p_labDes:cc.Label},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.creatMask(!0),this.p_cardNode=null},handleUI:function(){this._super()},setParam:function(e){if(!this.p_cardNode){var t=cc.instantiate(this.p_cardPrefab);t.parent=this.p_cardParent,t.scale=1.5,t.setPosition(0,0),this.p_cardNode=t}this.p_cardNode.getComponent("expeditionCardItem").refreshUI(e,this),this.p_cardNode.getComponent("expeditionCardItem").select(!0);var a=app.db.dbCard[e];null!=a.DES?(this.p_desNode.active=!0,this.p_labDes.string=a.DES):this.p_desNode.active=!1}});a.showPage=function(t){app.db.dbCard[t]?e("basePage").showPage.call(this,t):app.showNotice(langMgr.getString("windowsPageExpeditionCardPreview",0))},cc._RF.pop()},{basePage:void 0}],windowsPageExpeditionCards:[function(e,t){"use strict";cc._RF.push(t,"41b4e8WeFhJuqivPPLT6TlS","windowsPageExpeditionCards");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspageexpeditioncards",pageType:1},properties:{p_btnChange:cc.Button,p_cardItemPrefab:cc.Prefab,p_cardParentNode:cc.Node,p_desNode:cc.Node,p_labDes:cc.Label},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.creatMask(!0)},handleUI:function(){var e=this;this._super(),this.p_btnChange.node.on("click",function(){app.playSound("click"),e.onClose();var t={pos:e.pos,index:e.m_menuIndex};app.player.sfExpedChangeCards(t,function(t,a){t?app.showNotice(t):(app.pages.expeditionpage.instance.updateMapItem(e.row,e.pos,a.node),app.expeditionInfo.cardbag=a.cardbag,app.expeditionInfo.map[e.row][e.pos].node.getComponent("expeditionItem").refreshUI(e.row,e.pos,e),app.pages.expeditionpage.instance.refreshUI())})}),this.p_arrBtnMenu=[],this.createMenu(),this.p_arrBtnMenu.forEach(function(t,a){t.on("click",function(){app.playSound("click"),e.menuHandler(a)})})},setParam:function(e){var t=this;this.row=e.row,this.pos=e.pos,this.p_btnChange.node.active=!1,this.p_arrBtnMenu.forEach(function(e,a){var i=app.expeditionInfo.map[t.row][t.pos].cardlist[a];i?(e.getComponent("expeditionCardItem")&&e.getComponent("expeditionCardItem").refreshUI(i,t),e.active=!0):e.active=!1}),this.menuHandler(-1)},createMenu:function(){if(this.p_arrBtnMenu.length<=0)for(var e=0;e<3;e++){var t=cc.instantiate(this.p_cardItemPrefab);t.parent=this.p_cardParentNode,t.setPosition(228*e-228,0),t.active=!0,this.p_arrBtnMenu.push(t)}},refreshUI:function(){var e=this;this.p_arrBtnMenu[this.m_menuIndex]&&(this.p_btnChange.node.active=!0,this.p_btnChange.node.x=this.p_arrBtnMenu[this.m_menuIndex].x),this.p_arrBtnMenu.forEach(function(t,a){t.getComponent("expeditionCardItem")&&t.getComponent("expeditionCardItem").select(a==e.m_menuIndex),t.zIndex=a==e.m_menuIndex?1:0});var t=app.expeditionInfo.map[this.row][this.pos].cardlist[this.m_menuIndex];if(t){var a=app.db.dbCard[t];null!=a.DES?(this.p_desNode.active=!0,this.p_labDes.string=a.DES):this.p_desNode.active=!1}else this.p_desNode.active=!1},menuHandler:function(e){this.m_menuIndex=e,this.refreshUI()}});a.showPage=function(e){var t=e.row,a=e.pos;if(void 0===app.expeditionInfo.map[t][a].finish&&void 0!==app.expeditionInfo.map[t][a].cardlist&&void 0===app.expeditionInfo.map[t][a].choicecard){var i={pos:a,index:1};app.player.sfExpedChangeCards(i,function(e,i){e?app.showNotice(e):(app.pages.expeditionpage.instance.updateMapItem(t,a,i.node),app.expeditionInfo.cardbag=i.cardbag,app.expeditionInfo.map[t][a].node.getComponent("expeditionItem").refreshUI(t,a,app.pages.expeditionpage.instance),app.pages.expeditionpage.instance.refreshUI())})}},cc._RF.pop()},{basePage:void 0}],windowsPageExpeditionEnmy:[function(e,t){"use strict";cc._RF.push(t,"1fb3fnEYlVPP47m6AA0ONZf","windowsPageExpeditionEnmy");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspageexpeditionenmy",pageType:1},properties:{p_rewardItem:cc.Prefab,p_rewardContent:cc.Node,p_generalItem:cc.Prefab,p_generalContent:cc.Node,p_goSpr:cc.Node,p_battleSpr:cc.Node,p_btnBattle:cc.Button,p_sprTitle:cc.Sprite,p_titleSpriteFrames:[cc.SpriteFrame],p_labName:cc.Label,p_powerNode:cc.Node,p_powerPfb:cc.Prefab,p_headItem:cc.Node,p_headPfb:cc.Prefab,p_labMo:cc.Label,p_sprMo:cc.Sprite},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.creatMask(!0),this.m_arrPorp=[],this.m_arrGeneral=[],this.m_powernode=null,this.m_headnode=null},handleUI:function(){var e=this;this._super(),this.p_btnBattle.node.on("click",function(){app.playSound("click"),e.onClose(),1==e.m_objData.state?app.pages.expeditionpage.instance.expedBattle(e.row,e.pos):0==e.m_objData.state&&app.pages.expeditionpage.instance.goNextPosition(e.row,e.pos)}),this.p_sprMo.node.on("touchend",function(){app.playSound("click"),app.showNotice(langMgr.getString("windowsPageExpeditionEnmy",0))})},setParam:function(e){this.m_objData=e.data,this.row=e.row,this.pos=e.pos,this.p_sprTitle.spriteFrame=this.p_titleSpriteFrames[e.titleIndex],this.generalList=[];var t=gUtils.deepClone(this.m_objData.bset.team);for(var a in t){var i=t[a];i.mppercent=0,this.m_objData.cache&&this.m_objData.cache[a]&&(i.hppercent=this.m_objData.cache[a].hppercent,i.mppercent=this.m_objData.cache[a].mp||0);var n=this.m_objData.stepnum,r=t[a].level;t[a].property||(r=this.m_objData.showlevel+n-1),i.level=r,this.generalList.push(i)}this.refreshUI()},refreshUI:function(){var e=!1;0==this.row?e=!0:this.row-app.expeditionInfo.row==1&&-1!=app.expeditionInfo.canAttack.indexOf(this.pos)&&(e=!0),this.p_btnBattle.node.active=e,this.p_battleSpr.active=1==this.m_objData.state,this.p_goSpr.active=0==this.m_objData.state;var t=0,a=0;if(this.m_objData&&this.m_objData.boxitems)for(;a<this.m_objData.boxitems.length;a++){var i=this.m_objData.boxitems[a],n=this.m_arrPorp[a];n||((n=cc.instantiate(this.p_rewardItem)).parent=this.p_rewardContent,this.m_arrPorp.push(n)),n.getComponent("propItem").initForBag(i),n.getComponent("propItem").setClick(!0),n.active=!0}if(this.generalList)for(;t<this.generalList.length;t++){var r=this.generalList[t],o=this.m_arrGeneral[t];o||((o=cc.instantiate(this.p_generalItem)).parent=this.p_generalContent,this.m_arrGeneral.push(o)),o.getComponent("generalExpeditionItem").refreshUI(r,!1,!0,!0),o.getComponent("generalExpeditionItem").selected(!1),o.active=!0}for(var s=0;s<this.m_arrPorp.length;s++)s>=a&&(this.m_arrPorp[s].active=!1);for(var p=0;p<this.m_arrGeneral.length;p++)p>=t&&(this.m_arrGeneral[p].active=!1);if(this.p_labName&&(this.p_labName.string=this.m_objData.rname||langMgr.getString("windowsPageExpeditionEnmy",1)),this.p_powerNode){var c=0;for(var h in this.m_objData.bset.team)c+=this.m_objData.bset.team[h].power||0;this.m_powernode||(this.m_powernode=cc.instantiate(this.p_powerPfb),this.m_powernode.parent=this.p_powerNode,this.m_powernode.setPosition(cc.Vec2.ZERO)),this.m_powernode.getComponent("PowerDisplay").init({val:c})}this.p_labMo&&(this.p_labMo.node.active=!1),this.p_headItem&&(this.m_headnode||(this.m_headnode=cc.instantiate(this.p_headPfb),this.m_headnode.parent=this.p_headItem,this.m_headnode.setPosition(cc.Vec2.ZERO)),this.m_headnode&&this.m_headnode.getComponent("headItem").init({iconid:this.m_objData.iconid||10261,headid:this.m_objData.headid||50076,frameid:this.m_objData.frameid||51001,target:this}))}});cc._RF.pop()},{basePage:void 0}],windowsPageExpeditionGeneral:[function(e,t){"use strict";cc._RF.push(t,"337d0fsZx1Ch60naeiy7wrk","windowsPageExpeditionGeneral");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspageexpeditiongeneral",pageType:1},properties:{p_generalTabView:cc.Node},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.generalList=[]},handleUI:function(){this._super()},setParam:function(){var e=[];for(var t in app.expeditionInfo.tempgeneral){var a=app.expeditionInfo.tempgeneral[t];e.push(a.guid)}for(var i in app.player.general){var n=app.player.general[i];e.push(n.guid)}this.generalList=e,this.generalList.sort(function(e,t){var a=app.pages.expeditionpage.instance.getGeneralByGuid(e),i=app.pages.expeditionpage.instance.getGeneralByGuid(t);return i.star>a.star?1:i.star==a.star?i.level>a.level?1:i.level==a.level&&i.gsid<a.gsid?1:-1:-1}),this.refreshUI()},refreshUI:function(){this.p_generalTabView.getComponent("tableView").initTableView(this.generalList.length,{array:this.generalList,bShowPower:!1,bShowHp:!0,bShowMp:!0,isexpedition:!0,target:this})},onDestroy:function(){this._super()},onClose:function(){this._super()}});a.refreshRed=function(e){var t=app.player.getCount(90153);e.active=t<=0},cc._RF.pop()},{basePage:void 0}],windowsPageExpeditionLMKZ:[function(e,t){"use strict";cc._RF.push(t,"e79feIdDGRC6IcLwkcT3vB7","windowsPageExpeditionLMKZ");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspageexpeditionlmkz",pageType:1},properties:{p_generalContent:cc.Node,p_generalPfbItem:cc.Prefab,p_arrBtns:[cc.Button],p_goSpr:cc.Node,p_battleSpr:cc.Node,p_btnBattle:cc.Button},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.creatMask(!0),this.isShow=!1,this.p_arrGenerals=[]},handleUI:function(){var e=this;this._super(),this.p_btnBattle.node.on("click",function(){if(app.playSound("click"),app.pages.expeditionpage.instance.isCanNext())if(e.selectGeneralIndex>=0){var t={type:e.m_objData.type,pos:e.pos,index:e.selectGeneralIndex};app.player.sfExpedEvent(t,function(t,a){if(t)app.showNotice(t);else{e.onClose(),app.expeditionInfo.gcache=a.gcache;for(var i=0;i<a.tempgeneral.length;++i){var n=app.player.dealGeneral(a.tempgeneral[i]);if(!app.expeditionInfo.tempgeneral[n.guid]){app.expeditionInfo.tempgeneral[n.guid]=n;break}}app.expeditionInfo.map[e.row][e.pos].finish=app.player.getServerTime();var r=e.p_arrGenerals[e.selectGeneralIndex].getComponent("generalExpeditionItem").m_generalItem;r.getComponent("generalPortraitItem").setGray(!1);var o=app.pages.expeditionpage.instance.p_btnGeneral.node,s=r.addComponent("nodeFlyToWallet"),p=r,c=o,h=o;s.init(r,p,c,h),s.playAnim(1,0),app.pages.expeditionpage.instance.moveNextPosition(e.row,e.pos)}})}else app.showNotice(langMgr.getString("windowsPageExpeditionLMKZ",1));else app.showNotice(langMgr.getString("windowsPageExpeditionLMKZ",0))}),this.p_arrBtns.forEach(function(t,a){t.node.on("click",function(){e.onClickDesGeneral(a)})})},setParam:function(e){this.selectGeneralIndex=-1,this.m_objData=e.data,this.row=e.row,this.pos=e.pos,this.refreshUI()},refreshUI:function(){var e=this;if(this.isShow=!1,0==this.row?this.isShow=!0:this.row-app.expeditionInfo.row==1&&-1!=app.expeditionInfo.canAttack.indexOf(this.pos)&&(this.isShow=!0),this.p_btnBattle.node.active=this.isShow,this.m_objData.generals){var t=0;this.m_objData.generals.forEach(function(a,i){var n=e.p_arrGenerals[i];n||((n=cc.instantiate(e.p_generalPfbItem)).parent=e.p_generalContent,n.setPosition(0,47),n.on("touchend",function(){e.isShow&&e.onClickGeneral(i)}),n.active=!0,e.p_arrGenerals.push(n)),n.getComponent("generalExpeditionItem").refreshUI(a,!0,!1,!1),n.getComponent("generalExpeditionItem").selected(!1),t++});for(var a=t;a<this.p_arrGenerals.length;a++)cc.isValid(this.p_arrGenerals[a])&&(this.p_arrGenerals[a].active=!1)}},onClickGeneral:function(e){this.selectGeneralIndex=e,this.p_arrGenerals.forEach(function(t,a){t.getComponent("generalExpeditionItem").selected(a==e)})},onClickDesGeneral:function(e){cc.log(this.m_objData.generals[e]);var t=this.m_objData.generals[e];t.sourceType=1,t.isShowMode=!0,app.pages.generalpage.showPage(t)}});cc._RF.pop()},{basePage:void 0}],windowsPageExpeditionPass:[function(e,t){"use strict";cc._RF.push(t,"e7facJhnr9L3ZM5tjJp+OuB","windowsPageExpeditionPass");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspageexpeditionpass",pageType:1},properties:{p_nodeContent:cc.Node,p_nodeReward:cc.Prefab,p_nodeRewardContent:cc.Node,p_btnConfirm:cc.Button,p_spWinTitle:sp.Skeleton},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.creatMask(),this.m_arrNodeReward=[]},handleUI:function(){var e=this;this._super(),this.labAnim(),this.p_btnConfirm.node.on("click",function(){app.playSound("click"),e.onClose(),app.pages.expeditionpage.instance.onClose(),app.showRecommendGift()})},setParam:function(e){this.m_objData=e,this.refreshUI()},refreshUI:function(){this.p_nodeContent.opacity=0,this.m_arrReward=this.m_objData.reward;for(var e=0;e<this.m_arrReward.length;++e){var t=this.m_arrNodeReward[e];t||((t=cc.instantiate(this.p_nodeReward)).parent=this.p_nodeRewardContent),t.active=!0,t.getComponent("propItem").initForBag(this.m_arrReward[e]),t.getComponent("propItem").setClick(!0)}app.playUpgradeAnim({spComp:this.p_spWinTitle,startName:"appear",endName:"loop",index:4,target:this})},labAnim:function(){this.m_boolEnableClose=!0,this.p_nodeContent.runAction(cc.fadeIn(.7,255))}});cc._RF.pop()},{basePage:void 0}],windowsPageExpeditionSLZM:[function(e,t){"use strict";cc._RF.push(t,"92896M29glF27atFnmsWvdp","windowsPageExpeditionSLZM");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspageexpeditionslzm",pageType:1},properties:{p_generalContent:cc.Node,p_propContent:cc.Node,p_generalPfbItem:cc.Prefab,p_propPfbItem:cc.Prefab,p_goSpr:cc.Node,p_battleSpr:cc.Node,p_btnBattle:cc.Button},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.creatMask(!0),this.p_arrGenerals=[],this.p_arrRewards=[]},handleUI:function(){var e=this;this._super(),this.p_btnBattle.node.on("click",function(){app.playSound("click"),e.onClose(),1==e.m_objData.state?app.pages.expeditionpage.instance.expedBattle(e.row,e.pos):0==e.m_objData.state&&app.pages.expeditionpage.instance.goNextPosition(e.row,e.pos)})},setParam:function(e){this.m_objData=e.data,this.row=e.row,this.pos=e.pos,this.generalList=[];var t=app.db.getPveProperInfo(gUtils.deepClone(this.m_objData.bset.team),0,0,1);for(var a in t.team){var i=t.team[a];i.mppercent=0,this.m_objData.cache&&this.m_objData.cache[a]&&(i.hppercent=this.m_objData.cache[a].hppercent,i.mppercent=this.m_objData.cache[a].mp||0);var n=this.m_objData.stepnum,r=this.m_objData.showlevel+n-1;i.level=r,this.generalList.push(i)}this.generalList.sort(function(e,t){return void 0!==e.hppercent&&void 0!==t.hppercent?t.hppercent-e.hppercent:void 0===e.hppercent&&void 0===t.hppercent?e.level==t.level?e.gsid-t.gsid:t.level-e.level:void 0!==e.hppercent?1:-1}),this.refreshUI()},refreshUI:function(){var e=this,t=!1;if(0==this.row?t=!0:this.row-app.expeditionInfo.row==1&&-1!=app.expeditionInfo.canAttack.indexOf(this.pos)&&(t=!0),this.p_btnBattle.node.active=t,this.p_battleSpr.active=1==this.m_objData.state,this.p_goSpr.active=0==this.m_objData.state,this.p_arrRewards&&this.p_arrRewards.forEach(function(t,a){var i=e.m_objData.boxitems?e.m_objData.boxitems[a]:null;i?(t.getComponent("propItem").initForBag(i),t.getComponent("propItem").setClick(!0),t.active=!0):t.active=!1}),this.m_objData.boxitems){var a=0;this.m_objData.boxitems.forEach(function(t,i){var n=e.p_arrRewards[i];n||((n=cc.instantiate(e.p_propPfbItem)).parent=e.p_propContent,n.setPosition(0,0),n.active=!0,e.p_arrRewards.push(n)),n.getComponent("propItem").initForBag(t),n.getComponent("propItem").setClick(!0),a++});for(var i=a;i<this.p_arrRewards.length;i++)cc.isValid(this.p_arrRewards[i])&&(this.p_arrRewards[i].active=!1)}if(this.generalList){var n=0;this.generalList.forEach(function(t,a){var i=e.p_arrGenerals[a];i||((i=cc.instantiate(e.p_generalPfbItem)).parent=e.p_generalContent,i.setPosition(0,30),i.active=!0,e.p_arrGenerals.push(i)),i.getComponent("generalExpeditionItem").refreshUI(t,!0,!1,!1),i.getComponent("generalExpeditionItem").selected(!1),n++});for(var r=n;r<this.p_arrGenerals.length;r++)cc.isValid(this.p_arrGenerals[r])&&(this.p_arrGenerals[r].active=!1)}}});cc._RF.pop()},{basePage:void 0}],windowsPageExpeditionSMDK:[function(e,t){"use strict";cc._RF.push(t,"65879nTZEFNFLFc0+r5JA1D","windowsPageExpeditionSMDK");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspageexpeditionsmdk",pageType:1},properties:{p_generalContent:cc.Node,p_propContent:cc.Node,p_generalPfbItem:cc.Prefab,p_propPfbItem:cc.Prefab,p_goSpr:cc.Node,p_battleSpr:cc.Node,p_btnBattle:cc.Button},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.creatMask(!0),this.p_arrRewards=[],this.p_arrGenerals=[]},handleUI:function(){var e=this;this._super(),this.p_btnBattle.node.on("click",function(){app.playSound("click"),e.onClose(),1==e.m_objData.state?app.pages.expeditionpage.instance.expedBattle(e.row,e.pos):0==e.m_objData.state&&app.pages.expeditionpage.instance.goNextPosition(e.row,e.pos)})},setParam:function(e){this.m_objData=e.data,this.row=e.row,this.pos=e.pos,this.generalList=[];var t=app.db.getPveProperInfo(gUtils.deepClone(this.m_objData.bset.team),0,0,1);for(var a in t.team){var i=t.team[a];i.mppercent=0,this.m_objData.cache&&this.m_objData.cache[a]&&(i.hppercent=this.m_objData.cache[a].hppercent,i.mppercent=this.m_objData.cache[a].mp||0);var n=this.m_objData.stepnum,r=this.m_objData.showlevel+n-1;i.level=r,this.generalList.push(i)}this.generalList.sort(function(e,t){return void 0!==e.hppercent&&void 0!==t.hppercent?t.hppercent-e.hppercent:void 0===e.hppercent&&void 0===t.hppercent?e.level==t.level?e.gsid-t.gsid:t.level-e.level:void 0!==e.hppercent?1:-1}),this.refreshUI()},refreshUI:function(){var e=this,t=!1;if(0==this.row?t=!0:this.row-app.expeditionInfo.row==1&&-1!=app.expeditionInfo.canAttack.indexOf(this.pos)&&(t=!0),this.p_btnBattle.node.active=t,this.p_battleSpr.active=1==this.m_objData.state,this.p_goSpr.active=0==this.m_objData.state,this.m_objData.boxitems){var a=0;this.m_objData.boxitems.forEach(function(t,i){var n=e.p_arrRewards[i];n||((n=cc.instantiate(e.p_propPfbItem)).parent=e.p_propContent,n.setPosition(0,0),n.active=!0,e.p_arrRewards.push(n)),n.getComponent("propItem").initForBag(t),n.getComponent("propItem").setClick(!0),a++});for(var i=a;i<this.p_arrRewards.length;i++)cc.isValid(this.p_arrRewards[i])&&(this.p_arrRewards[i].active=!1)}if(this.generalList){var n=0;this.generalList.forEach(function(t,a){var i=e.p_arrGenerals[a];i||((i=cc.instantiate(e.p_generalPfbItem)).parent=e.p_generalContent,i.setPosition(0,30),i.active=!0,e.p_arrGenerals.push(i)),i.getComponent("generalExpeditionItem").refreshUI(t,!0,!1,!1),i.getComponent("generalExpeditionItem").selected(!1),n++});for(var r=n;r<this.p_arrGenerals.length;r++)cc.isValid(this.p_arrGenerals[r])&&(this.p_arrGenerals[r].active=!1)}}});cc._RF.pop()},{basePage:void 0}],windowsPageExpeditionSMLZ:[function(e,t){"use strict";cc._RF.push(t,"41b4fF9PUdDAIf+7WTWrCMu","windowsPageExpeditionSMLZ");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspageexpeditionsmlz",pageType:1},properties:{p_arrGoSpr:[cc.Node],p_arrUseSpr:[cc.Node],p_btnGo:cc.Button,p_btnCancel:cc.Button},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.creatMask(!0)},handleUI:function(){var e=this;this._super(),this.p_btnGo.node.on("click",function(){if(app.playSound("click"),1==e.m_objData.state){var t={type:e.m_objData.type,pos:e.pos};app.player.sfExpedEvent(t,function(t,a){t?app.showNotice(t):(e.onClose(),app.showNotice(langMgr.getString("windowsPageExpeditionSMLZ",0)),app.expeditionInfo.gcache=a.gcache,app.expeditionInfo.map[e.row][e.pos].finish=app.player.getServerTime(),app.pages.expeditionpage.instance.moveNextPosition(e.row,e.pos))})}else 0==e.m_objData.state&&(e.onClose(),app.pages.expeditionpage.instance.goNextPosition(e.row,e.pos))}),this.p_btnCancel.node.on("click",function(){app.playSound("click"),1==e.m_objData.state?app.player.sfExpedAbandon(null,function(t){t?app.showNotice(t):(e.onClose(),app.expeditionInfo.map[e.row][e.pos].finish=app.player.getServerTime(),app.pages.expeditionpage.instance.moveNextPosition(e.row,e.pos))}):e.onClose()})},setParam:function(e){this.m_objData=e.data,this.row=e.row,this.pos=e.pos,this.refreshUI()},refreshUI:function(){var e=this,t=!1;0==this.row?t=!0:this.row-app.expeditionInfo.row==1&&-1!=app.expeditionInfo.canAttack.indexOf(this.pos)&&(t=!0),this.p_btnGo.node.active=t,this.p_btnCancel.node.active=t,this.p_arrGoSpr.forEach(function(t){t.active=0==e.m_objData.state}),this.p_arrUseSpr.forEach(function(t){t.active=1==e.m_objData.state})}});cc._RF.pop()},{basePage:void 0}],windowsPageExpeditionSevenlight:[function(e,t){"use strict";cc._RF.push(t,"f7bb5bodulPTJUjzhFJNI8G","windowsPageExpeditionSevenlight");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspageexpeditionsevenlight",pageType:1},properties:{p_btnUse:cc.Button,p_useNode:cc.Node,p_freeNode:cc.Node,p_labNum:cc.Label,p_generalTabView:cc.Node,p_labATK:cc.Label,p_labHP:cc.Label,p_labDEF:cc.Label,p_labMDEF:cc.Label},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){var e=this;this._super(),this.p_btnUse.node.on("click",function(){app.playSound("click"),e.onBtnClick()})},setParam:function(){for(var e in this.generalList=[],this.isUse=!1,this.isFree=app.player.getCount(90529)<=0,app.expeditionInfo.tempgeneral){var t=app.expeditionInfo.tempgeneral[e];t.level<40||this.generalList.push(t.guid)}for(var a in app.player.general){var i=app.player.general[a];i.level<40||this.generalList.push(i.guid)}this.generalList.sort(function(e,t){var a=app.pages.expeditionpage.instance.getGeneralByGuid(e),i=app.pages.expeditionpage.instance.getGeneralByGuid(t);return i.star>a.star?1:i.star==a.star?i.level>a.level?1:i.level==a.level&&i.gsid<a.gsid?1:-1:-1}),this.refreshUI()},refreshUI:function(){this.p_labNum.string=app.player.getCount(30103),this.p_generalTabView.getComponent("tableView").initTableView(this.generalList.length,{array:this.generalList,bShowPower:!1,bShowHp:!0,bShowMp:!0,isexpedition:!0,target:this}),this.p_labATK.string=app.expeditionInfo&&app.expeditionInfo.specialbuf&&app.expeditionInfo.specialbuf[0]&&app.expeditionInfo.specialbuf[0].atk?langMgr.getString("windowsPageExpeditionSevenlight",7)+app.expeditionInfo.specialbuf[0].atk+"%":langMgr.getString("windowsPageExpeditionSevenlight",11),this.p_labHP.string=app.expeditionInfo&&app.expeditionInfo.specialbuf&&app.expeditionInfo.specialbuf[0]&&app.expeditionInfo.specialbuf[0].hp?langMgr.getString("windowsPageExpeditionSevenlight",8)+app.expeditionInfo.specialbuf[0].hp+"%":langMgr.getString("windowsPageExpeditionSevenlight",12),this.p_labDEF.string=app.expeditionInfo&&app.expeditionInfo.specialbuf&&app.expeditionInfo.specialbuf[0]&&app.expeditionInfo.specialbuf[0].def?langMgr.getString("windowsPageExpeditionSevenlight",9)+app.expeditionInfo.specialbuf[0].def+"%":langMgr.getString("windowsPageExpeditionSevenlight",13),this.p_labMDEF.string=app.expeditionInfo&&app.expeditionInfo.specialbuf&&app.expeditionInfo.specialbuf[0]&&app.expeditionInfo.specialbuf[0].mdef?langMgr.getString("windowsPageExpeditionSevenlight",10)+app.expeditionInfo.specialbuf[0].mdef+"%":langMgr.getString("windowsPageExpeditionSevenlight",14),this.p_useNode.active=!this.isFree,this.p_freeNode.active=this.isFree},onBtnClick:function(){var e=this;!this.isFree&&app.player.getCount(30103)<=0?app.showNotice(langMgr.getString("windowsPageExpeditionSevenlight",0)):this.isUse?app.showNotice(langMgr.getString("windowsPageExpeditionSevenlight",1)):app.expeditionInfo.row>=app.expeditionInfo.map.length-1&&app.expeditionInfo.nextgatetype.length<=0?app.showNotice(langMgr.getString("windowsPageExpeditionSevenlight",2)):(this.isUse=!0,app.player.sfExpedEvent({type:9,pos:0},function(t){t?app.showNotice(t):(e.isFree&&(e.isFree=!1),app.player.sfExpedInfo(function(t,a){t?app.showNotice(langMgr.getString("windowsPageExpeditionSevenlight",6)):(app.pages.expeditionpage.getExpeditionInfo(a),app.pages.expeditionpage.instance.setParam(),app.player.sfPlayerByParam(["props","others"],function(){app.showNotice(langMgr.getString("windowsPageExpeditionSevenlight",4)),e.onClose()}))}))}))},onDestroy:function(){this._super()},onClose:function(){this._super()}});a.refreshRed=function(e){var t=app.player.getCount(90153);e.active=t<=0},cc._RF.pop()},{basePage:void 0}],windowsPageExpeditionSkill:[function(e,t){"use strict";cc._RF.push(t,"a3d665kttVGcqkyYVCidReb","windowsPageExpeditionSkill");var a=[{rname:"\u5175\u5668\u795d\u798f",intro:"\u6bcf\u5c42\u63d0\u5347\u6240\u6709\u6b66\u5c06\u653b\u51fb\u529b15%"},{rname:"\u751f\u547d\u795d\u798f",intro:"\u6bcf\u5c42\u63d0\u5347\u6240\u6709\u6b66\u5c06\u751f\u547d\u503c15%"},{rname:"\u6012\u6c14\u795d\u798f",intro:"\u6bcf\u5c42\u63d0\u5347\u6240\u6709\u6b66\u5c06\u521d\u59cb\u80fd\u91cf15\u70b9"}],i=cc.Class({extends:e("basePage"),properties:{p_sprIcon:cc.Sprite,p_labIntro:cc.Label,p_labName:cc.Label,p_labLv:cc.Label},statics:{prefabPath:"windowspageexpeditionskill"},onLoad:function(){i.instance=this,this.stopBgNodeEvent(),this.creatMask(!0)},setParam:function(e){this._obj=e,this.refreshUI()},refreshUI:function(){this._obj&&(this.p_sprIcon.spriteFrame=this._obj.spriteFrame,this.p_labName.string=a[this._obj.index].rname,this.p_labIntro.string=a[this._obj.index].intro,this.p_labLv.string=this._obj.level)}});cc._RF.pop()},{basePage:void 0}],windowsPageExpeditionTSZC:[function(e,t){"use strict";cc._RF.push(t,"4c751yO0EtCaLFgQEdu14XO","windowsPageExpeditionTSZC");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspageexpeditiontszc",pageType:1},properties:{p_arrGoSpr:[cc.Node],p_arrUseSpr:[cc.Node],p_btnGo:cc.Button,p_btnCancel:cc.Button},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.creatMask(!0)},handleUI:function(){var e=this;this._super(),this.p_btnGo.node.on("click",function(){if(app.playSound("click"),1==e.m_objData.state){var t={type:e.m_objData.type,pos:e.pos};app.player.sfExpedEvent(t,function(t,a){t?app.showNotice(t):(e.onClose(),app.showNotice(langMgr.getString("windowsPageExpeditionTSZC",0)),app.expeditionInfo.gcache=a.gcache,app.expeditionInfo.map[e.row][e.pos].finish=app.player.getServerTime(),app.pages.expeditionpage.instance.moveNextPosition(e.row,e.pos))})}else 0==e.m_objData.state&&(e.onClose(),app.pages.expeditionpage.instance.goNextPosition(e.row,e.pos))}),this.p_btnCancel.node.on("click",function(){app.playSound("click"),1==e.m_objData.state?app.player.sfExpedAbandon(null,function(t){t?app.showNotice(t):(e.onClose(),app.expeditionInfo.map[e.row][e.pos].finish=app.player.getServerTime(),app.pages.expeditionpage.instance.moveNextPosition(e.row,e.pos))}):e.onClose()})},setParam:function(e){this.m_objData=e.data,this.row=e.row,this.pos=e.pos,this.refreshUI()},refreshUI:function(){var e=this,t=!1;0==this.row?t=!0:this.row-app.expeditionInfo.row==1&&-1!=app.expeditionInfo.canAttack.indexOf(this.pos)&&(t=!0),this.p_btnGo.node.active=t,this.p_btnCancel.node.active=t,this.p_arrGoSpr.forEach(function(t){t.active=0==e.m_objData.state}),this.p_arrUseSpr.forEach(function(t){t.active=1==e.m_objData.state})}});cc._RF.pop()},{basePage:void 0}],windowsPageExpeditionXYSR:[function(e,t){"use strict";cc._RF.push(t,"16e00GXmC1JTJ5G8BqK4omI","windowsPageExpeditionXYSR");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspageexpeditionxysr",pageType:1},properties:{p_arrRewards:[cc.Node],p_btnGo:cc.Button,p_btnGiveUp:cc.Button},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.creatMask(!0)},handleUI:function(){var e=this;this._super(),this.p_btnGo.node.on("click",function(){app.playSound("click"),e.onClose(),0==e.m_objData.state&&app.pages.expeditionpage.instance.goNextPosition(e.row,e.pos)}),this.p_btnGiveUp.node.on("click",function(){app.playSound("click"),1==e.m_objData.state&&app.player.sfExpedAbandon(null,function(t){t?app.showNotice(t):(e.onClose(),app.expeditionInfo.map[e.row][e.pos].finish=app.player.getServerTime(),app.pages.expeditionpage.instance.moveNextPosition(e.row,e.pos))})})},setParam:function(e){this.m_objData=e.data,this.row=e.row,this.pos=e.pos,this.refreshUI()},refreshUI:function(){var e=this,t=!1;0==this.row?t=!0:this.row-app.expeditionInfo.row==1&&-1!=app.expeditionInfo.canAttack.indexOf(this.pos)&&(t=!0),this.p_btnGo.node.active=t&&0==this.m_objData.state,this.p_btnGiveUp.node.active=t&&1==this.m_objData.state,this.p_arrRewards&&this.p_arrRewards.forEach(function(a,i){e.m_objData.goods&&e.m_objData.goods[i]?(a.getComponent("expeditionShopItem").refreshUI(i,e.row,e.pos,e.m_objData,e),a.getComponent("expeditionShopItem").setClick(t&&1==e.m_objData.state),a.active=!0):a.active=!1})}});cc._RF.pop()},{basePage:void 0}],windowsPageGClassReady:[function(e,t){"use strict";cc._RF.push(t,"39ea1B0kx9LUaSq2uLsMbI/","windowsPageGClassReady");var a=["hp","atk","def","mdef"],i=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagegclassready"},properties:{p_labLimit:cc.Label,p_labNextLimit:cc.Label,p_arrLabBen:[cc.Label],p_arrLabUp:[cc.Label],p_nodeNewSkill:cc.Node,p_nodeSkill:cc.Node,p_labSkill:cc.Label,p_labCost_01:cc.Label,p_labCost_02:cc.Label,p_labNow:cc.Label,p_btnUp:cc.Button},onLoad:function(){i.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.creatMask(!0),this.m_colorCost=this.p_labCost_01.node.color.clone()},handleUI:function(){var e=this;this.p_btnUp.node.on("click",function(){app.playSound("click"),e.onClickBtnUp()})},check:function(e){return!!app.db.getGClassCostByClass(e.gdata.class)},setParam:function(e){this.m_objData=e.gdata,this.m_target=e.target,this.refreshUI()},refreshUI:function(){var e=this,t=app.db.getGClassCostByClass(this.m_objData.class);if(t){var i=app.db.dbGeneralClass[this.m_objData.class+1];this.p_labCost_01.string=t[0].COUNT,this.p_labCost_02.string=t[1].COUNT,this.p_labCost_01.node.color=app.player.getCountEnough(t[0])?this.m_colorCost:cc.Color.RED,this.p_labCost_02.node.color=app.player.getCountEnough(t[1])?this.m_colorCost:cc.Color.RED,this.p_labLimit.string=app.db.getGMaxLvByGsid(this.m_objData.gsid,this.m_objData.class),this.p_labNextLimit.string=app.db.getGMaxLvByGsid(this.m_objData.gsid,this.m_objData.class+1),this.p_arrLabBen.forEach(function(t,i){var n=e.m_objData.property[a[i]];t.string=n}),this.p_arrLabUp.forEach(function(t,n){var r=i.ADD[a[n].toUpperCase()]/10;t.string=r<=0?e.m_objData.property[a[n]]:Math.floor(e.m_objData.property[a[n]]*(r+100)/100)});var n=app.db.getNextClassSkill(this.m_objData.gsid,this.m_objData.class);if(cc.log("arrNewSkill is ",n),n.length>0){for(var r=0;r<n.length;++r){var o=n[r];if(o){this.p_nodeSkill.getComponent("skillItem").initForShow(o,this);var s=app.db.getSkillInfoByGsid(o);this.p_labSkill.string=s.NAME||langMgr.getString("windowsPageGClassReady",0)}}this.p_nodeNewSkill.active=!0}else this.p_nodeNewSkill.active=!1;this.p_labNow.string=app.player.getCount(30015)}},onClickBtnUp:function(){for(var e=this,t=app.db.getGClassCostByClass(this.m_objData.class),a=1,i=0;i<t.length;++i){var n=t[i];if(!app.player.checkCount(n.GSID,n.COUNT)){a=0;break}}a&&app.player.sfGeneralClassUp(this.m_objData.guid,function(t,a){if(t)app.showNotice(t);else{e.onClose();var i={old:e.m_objData,new:a};app.pages.windowspagegclasssucc.showPage(i),app.player.addGeneral(a),e.m_target.m_objParent.refreshInfo(a)}})}});cc._RF.pop()},{basePage:void 0}],windowsPageGClassSkill:[function(e,t){"use strict";cc._RF.push(t,"902587BlqJOjbjOeBs/ukEP","windowsPageGClassSkill");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagegclassskill"},properties:{p_nodeSkill:cc.Node,p_rtxtIntro:cc.RichText},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0)},setParam:function(e){this.m_numSkillGsid=e,this.refreshUI()},refreshUI:function(){var e=app.db.getSkillInfoByGsid(this.m_numSkillGsid);this.p_nodeSkill.getComponent("skillItem").initForShow(this.m_numSkillGsid,this),this.p_rtxtIntro.string=e.INTRO}});cc._RF.pop()},{basePage:void 0}],windowsPageGClassSucc:[function(e,t){"use strict";cc._RF.push(t,"ee44dYbJLtP+4S17/RS2uv9","windowsPageGClassSucc");var a=["hp","atk","def","mdef"],i=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagegclasssucc"},properties:{p_nodeGeneral:cc.Node,p_arrNodeClass:[cc.Node],p_arrNodeNowClass:[cc.Node],p_arrLabOld:[cc.Label],p_arrLabNew:[cc.Label]},onLoad:function(){i.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),app.playSound("reward")},setParam:function(e){this.m_objOldData=e.old,this.m_objNewData=e.new,cc.log("old data is ",this.m_objOldData),cc.log("new data is ",this.m_objNewData),this.refreshUI()},refreshUI:function(){var e=this,t=app.db.getGBaseByGsid(this.m_objNewData.gsid);this.p_nodeGeneral.getComponent("generalPortraitItem").initForShow(this.m_objNewData.gsid),this.p_arrNodeClass.forEach(function(e,a){e.active=a<t.MAXCLASS}),this.p_arrNodeNowClass.forEach(function(t,a){t.active=a<e.m_objNewData.class}),this.p_arrLabOld.forEach(function(t,i){var n;n=0==i?e.m_objOldData.power||0:1==i?app.db.getGMaxLvByGsid(e.m_objOldData.gsid,e.m_objOldData.class):e.m_objOldData.property[a[i-2]],t.string=n}),this.p_arrLabNew.forEach(function(t,i){var n;n=0==i?e.m_objNewData.power||0:1==i?app.db.getGMaxLvByGsid(e.m_objNewData.gsid,e.m_objNewData.class):e.m_objNewData.property[a[i-2]],t.string=n})},onClose:function(){this._super();var e=app.db.getNextClassSkill(this.m_objOldData.gsid,this.m_objOldData.class);e.length>0&&app.pages.windowspagegclassskill.showPage(e[0])}});cc._RF.pop()},{basePage:void 0}],windowsPageGStarSucc:[function(e,t){"use strict";cc._RF.push(t,"ecc378i8ERFgoPeukpn+rQs","windowsPageGStarSucc");var a=["hp","atk","def","mdef"],i=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagegstarsucc",pageType:1},properties:{p_nodePowerOld:cc.Node,p_nodePowerNew:cc.Node,p_arrLabOld:[cc.Label],p_arrLabNew:[cc.Label],titleAnim:sp.Skeleton,lContent:cc.Node,rContent:cc.Node,pfbGItem:cc.Prefab,_nodeGeneralL:null,_nodeGeneralR:null,p_arrProperty:[cc.Label]},onLoad:function(){i.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),app.playSound("reward")},setParam:function(e){cc.log("\u5347\u661f\u6210\u529f",e),this.m_objOldData=e.old,this.m_objNewData=e.new,this.m_arrItems=e.items,this.refreshUI()},refreshUI:function(){var e=this;app.playUpgradeAnim({spComp:this.titleAnim,startName:"appear",endName:"loop",index:0,target:this}),cc.isValid(this._nodeGeneralL)||(this._nodeGeneralL=cc.instantiate(this.pfbGItem),this.lContent.addChild(this._nodeGeneralL),this._nodeGeneralL.setPosition(cc.Vec2.ZERO)),this._nodeGeneralL.getComponent("generalPortraitItem").initForShow(this.m_objOldData.gsid),cc.isValid(this._nodeGeneralR)||(this._nodeGeneralR=cc.instantiate(this.pfbGItem),this.rContent.addChild(this._nodeGeneralR),this._nodeGeneralR.setPosition(cc.Vec2.ZERO)),this._nodeGeneralR.getComponent("generalPortraitItem").initForShow(this.m_objNewData.gsid),this.p_nodePowerOld.getComponent(cc.Label).string=gUtils.showNum(this.m_objOldData.power),this.p_nodePowerNew.getComponent(cc.Label).string=gUtils.showNum(this.m_objNewData.power),this.p_arrLabOld.forEach(function(t,i){var n;n=0==i?app.db.getGMaxLvByGsid(e.m_objOldData.gsid,6):e.m_objOldData.property[a[i-1]],t.string=n}),this.p_arrLabNew.forEach(function(t,i){var n;n=0==i?app.db.getGMaxLvByGsid(e.m_objNewData.gsid,6):e.m_objNewData.property[a[i-1]],t.string=n}),this.p_arrProperty.forEach(function(e,t){if(t<2)e.string=langMgr.getString("public",34+t);else{var i,n=null!=(i=app.db.getPropertyCnByEn(a[t-2]))?i:"";e.string=n}})},checkStarGift:function(){console.log("\u56de\u8c03",this.m_objNewData),app.showRecommendGift()},onClose:function(){if(this._super(),this.m_arrItems.length>0){this.m_objNewData.gsid;var e={title:"\u6b66\u5c06\u5347\u661f",type:1,content:langMgr.getString("windowsPageGStarSucc",0),props:this.m_arrItems,confirmname:"\u786e\u8ba4",confirmcb:function(){app.showRecommendGift()},target:this};app.pages.windowspagepreview.showPage(e)}else this.checkStarGift()}});cc._RF.pop()},{basePage:void 0}],windowsPageGoToPub:[function(e,t){"use strict";cc._RF.push(t,"20a29b1h8BGiZPdbxU1ktzV","windowsPageGoToPub");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagegotopub",pageType:1},properties:{p_btnGoTo:cc.Button,p_nodeContent:cc.Node,p_nodeItem:cc.Prefab},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){this._super(),this.p_btnGoTo.node.on("click",function(){app.playSound("click"),app.goToPage(1005)})},setParam:function(e){this.p_btnGoTo.node.active=!e,this.refreshUI()},onEnable:function(){this._super(),eventMgr.on(eventStr.windowspagegotopub.refreshflag,this.refreshFlag,this)},onDisable:function(){this._super(),eventMgr.off(eventStr.windowspagegotopub.refreshflag,this.refreshFlag,this)},refreshFlag:function(){this.m_flag=!1},refreshUI:function(){this.m_index=1;var e=app.db.dbDrawCard;this.m_arrData=[];for(var t=0;t<e.length;t++)app.db.getGBaseByGsid(e[t].GSID).STAR>4&&app.player.tutor==e[t].TYPE&&this.m_arrData.push({gsid:e[t].GSID});this.m_x=60,this.m_dis=this.p_nodeItem.data.width+10,this.m_objTemp=[];for(var a=0;a<7;a++){var i={},n=this.m_arrData[a];if(!n)return;var r=this.p_nodeContent.children[a];r||(r=cc.instantiate(this.p_nodeItem),this.p_nodeContent.addChild(r)),r.setPosition(cc.v2(this.m_x+a*this.m_dis,17)),r.getComponent("generalPubItem").refreshUI(n.gsid,this),i.itemNode=r,i.index=a,this.m_objTemp.push(i)}},update:function(e){if(!this.m_flag&&(this.p_nodeContent.x-=100*e,this.p_nodeContent.x<=-315-this.m_index*this.m_dis)){this.m_index++,this.m_objTemp.push(this.m_objTemp.shift()),this.m_objTemp[this.m_objTemp.length-1].itemNode.x+=this.m_dis*this.p_nodeContent.children.length;var t=this.m_objTemp[this.m_objTemp.length-2].index+1;t>=this.m_arrData.length&&(t=0),this.m_objTemp[this.m_objTemp.length-1].index=t;var a=this.m_arrData[this.m_objTemp[this.m_objTemp.length-1].index];this.m_objTemp[this.m_objTemp.length-1].itemNode.getComponent("generalPubItem").refreshUI(a.gsid,this)}}});cc._RF.pop()},{basePage:void 0}],windowsPageGodBeastTalent:[function(e,t){"use strict";cc._RF.push(t,"efac9dXdM5PwbJe2lkUX+Al","windowsPageGodBeastTalent");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagegodbeasttalent",pageType:1},properties:{p_sprIcon:cc.Sprite,p_labName:cc.Label,p_labIntro:cc.Label,titleAnim:sp.Skeleton},onLoad:function(){a.instance=this,this.creatMask(!0),this.stopBgNodeEvent(),this.handleUI(),app.playSound("reward")},handleUI:function(){this._super()},setParam:function(e){this.refreshUI(e)},refreshUI:function(e){app.playUpgradeAnim({spComp:this.titleAnim,startName:"appear",endName:"loop",index:6,target:this});var t=app.db.getSkillInfoByGsid(e);if(t){var a=app.db.getSkillPathByGsid(t.ICON);app.loadTexture(a,this.p_sprIcon,this.prefabPath),this.p_labName.string=t.NAME,this.p_labIntro.string=t.INTRO}}});cc._RF.pop()},{basePage:void 0}],windowsPageGodbeastClass:[function(e,t){"use strict";cc._RF.push(t,"4bd24WwqL9JlbbYKpBlZlzK","windowsPageGodbeastClass");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagegodbeastclass",pageType:1},properties:{p_labLimit:cc.Label,p_labNextLimit:cc.Label,p_sprIcon:cc.Sprite,p_labCost_01:cc.Label,p_labCost_02:cc.Label,p_btnUp:cc.Button,p_spArrCostIcon:[cc.Sprite]},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.creatMask(!0)},handleUI:function(){var e=this;this._super(),this.p_btnUp.node.on("click",function(){app.playSound("click"),e.onClickBtnUp()})},setParam:function(e){this.m_target=e.target,this.m_nowMid=e.mid,this.refreshUI()},refreshUI:function(){var e=this;this.m_objMBase=app.db.getMythicalById(this.m_nowMid),this.m_objMData=app.player.mythical[this.m_nowMid],this.p_labLimit.string=app.db.getMythicMaxLvByClass(this.m_objMData.class),this.p_labNextLimit.string=app.db.getMythicMaxLvByClass(this.m_objMData.class+1);var t=this.m_objMBase.PSKILL[this.m_objMData.class],a=app.db.getSkillPathByGsid(t,1);app.loadTexture(a,this.p_sprIcon,this.prefabPath);var i=app.db.getMythicCCostByClass(this.m_objMData.class+1);this.p_labCost_01.string=i[0].COUNT,this.p_labCost_02.string=i[1].COUNT,this.p_spArrCostIcon.forEach(function(t,a){if(i[a]){var n=i[a].GSID,r=app.db.getPropsIconPath(n);app.loadTexture(r,t,app.getPrefabPathFrom(e))}})},onClickBtnUp:function(){this.m_target.onClassUp(),this.onClose()}});cc._RF.pop()},{basePage:void 0}],windowsPageGodbeastPreview:[function(e,t){"use strict";cc._RF.push(t,"bda2bImGghPhqM545Sz0CU/","windowsPageGodbeastPreview");var a={HP:0,PATKDAM:1,PASP:2,PCRI:3,PCRID:4,PMPS:5,PSKIDAM:6,PPBS:7,PMBS:8,PEFC:9,PDEX:10,PMDEX:11,PDAM:12,ATK:13},i=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagegodbeastpreview",pageType:1},properties:{p_nodeHalo:cc.Node,p_sprSkillIcon:cc.Sprite,p_labSkillName:cc.Label,p_labSkillLevel:cc.Label,p_labSkillIntro:cc.Label,p_arrNodeHalo:[cc.Node],p_nodeTalent:cc.Node,p_arrNodeTalentItem:[cc.Node],p_arrNodeAddition:[cc.Node],p_arrNodeMenu:[cc.Node],p_arrNodePick:[cc.Node]},onLoad:function(){i.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.creatMask(!0)},handleUI:function(){var e=this;this._super(),this.p_arrNodeMenu.forEach(function(t,a){t.on("touchend",function(){e.onClickMenu(a)})})},setParam:function(e){e&&(this.m_nowMid=e,this.onClickMenu(0))},refreshData:function(){this.m_objMBase=app.db.getMythicalById(this.m_nowMid);var e=app.db.getMythicMaxClass(),t=app.db.getMythicMaxLvByClass(e),a=app.player.mythical[this.m_nowMid];this.m_objMData={},this.m_objMData.level=a?a.level:t,this.m_objMData.class=a?a.class:e,this.m_objMData.pskill=[];for(var i=0;i<4;++i){var n=app.db.getMythicPSkillMaxLv(e,i);this.m_objMData.pskill.push(n)}this.refreshUI()},refreshUI:function(){var e=this.m_objMData.level,t=this.m_objMData.class-1>=0?this.m_objMData.class-1:0,a=this.m_objMBase.SKILL[t],i=e-1>=0?e:1,n=app.db.getSkillInfoByGsid(a,i),r=app.db.getSkillPathByGsid(a,this.m_objMData.level);app.loadTexture(r,this.p_sprSkillIcon,this.prefabPath);var o=this.m_objMData.level;this.p_labSkillName.string=n.NAME,this.p_labSkillLevel.string="Lv."+o,this.p_labSkillIntro.string=n.INTRO,this.refreshHalo()},refreshHalo:function(){var e=this,t=app.player.mythical[this.m_nowMid];this.p_arrNodeHalo.forEach(function(a,i){var n={skill:e.m_objMBase.PSKILL[i],lv:t?t.pskill[i]:e.m_objMData.pskill[i]||0,mId:e.m_nowMid,index:i};a.getComponent("godbeastHaloItem").refreshUI(n,e)})},onClickHalo:function(e){var t={index:e,base:this.m_objMBase,data:this.m_objMData};app.pages.windowspagetipsgodbeasthalo.showPage(t)},refreshTalent:function(){for(var e=app.player.mythical[this.m_nowMid],t=app.db.getMythicalTalentSkill(this.m_nowMid),a=0;a<t.length;a++){var i=!e||e.talentskill&&e.talentskill.length>a?0:1,n=this.p_arrNodeTalentItem[a],r=n.getChildByName("head_frame").getChildByName("icon").getComponent(cc.Sprite),o=n.getChildByName("name").getComponent(cc.Label),s=n.getChildByName("intro").getComponent(cc.Label),p=app.db.getSkillInfoByGsid(t[a]);if(p){var c=app.db.getSkillPathByGsid(p.ICON);app.loadTexture(c,r,this.prefabPath),app.setSpriteState(r,i),o.string=p.NAME,s.string=p.INTRO}}this.refreshTalentAttr()},refreshTalentAttr:function(){var e=app.player.mythical[this.m_nowMid];console.log(e);for(var t=app.db.dbMythicalTalentAttr,i=app.db.dbMythicalTalent[this.m_nowMid].CAST,n=[0,0,0],r=0;r<i.length;r++)for(var o=0;o<i[r].length;o++)n[o]+=i[r][o][0].MAXNUM;for(var s={},p=0;p<t.length;p++)for(var c=n[p],h=0;h<t[p].length;h++)s[t[p][h].ID]||(s[t[p][h].ID]=0),s[t[p][h].ID]+=t[p][h].NUM*c;var l=[];for(var g in s)l.push({key:g,val:s[g]});for(var d=0;d<this.p_arrNodeAddition.length;d++){var u=this.p_arrNodeAddition[d];if(l[d]){u.active=!0;var f=u.getChildByName("key").getComponent(cc.Label),m=u.getChildByName("val").getComponent(cc.Label);if(f.string=langMgr.getString("windowsPageGodbeastPreview",a[l[d].key]),e){var _=this.setData(e);m.string="+"+_[d].val}else m.string="+"+l[d].val}else u.active=!1}},setData:function(e){for(var t=e&&e.talent||[],a=app.db.dbMythicalTalentAttr,i=[0,0,0],n=0;n<t.length;n++)for(var r=0;r<t[n].length;r++)t[n][r]&&(i[r]+=t[n][r].pro);for(var o={},s=0;s<a.length;s++)for(var p=i[s],c=0;c<a[s].length;c++)o[a[s][c].ID]||(o[a[s][c].ID]=0),o[a[s][c].ID]+=a[s][c].NUM*p;var h=[];for(var l in o)h.push({key:l,val:o[l]});return h},onClickMenu:function(e){switch(this.p_arrNodePick.forEach(function(t,a){t.active=a==e}),e){case 0:this.p_nodeHalo.active=!0,this.p_nodeTalent.active=!1,this.refreshData();break;case 1:this.p_nodeHalo.active=!1,this.p_nodeTalent.active=!0,this.refreshTalent()}}});cc._RF.pop()},{basePage:void 0}],windowsPageJgklSelect:[function(e,t){"use strict";cc._RF.push(t,"6fe80jF1OlEU6hOH5qUijGP","windowsPageJgklSelect");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=cc._decorator,o=r.ccclass,s=r.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_btnCancel=null,t.p_btnOk=null,t.p_arrNodeItem=[],t.m_selectIndex=-1,t.m_data=null,t.m_target=null,t}return i(t,e),t.prototype.onLoad=function(){var e=this;this.stopBgNodeEvent(),this.creatMask(!0),this.p_btnOk.node.on("click",function(){e.m_selectIndex<0||(app.playSound("click"),app.player.sfJgklSelect(e.m_data[e.m_selectIndex].GSID,function(t){t||(e.m_target.m_selectIndex=e.m_selectIndex,e.m_target.refreshRareReward(),e.onClose())}))}),this.p_btnCancel.node.on("click",function(){app.playSound("click"),e.onClose()})},t.prototype.start=function(){},t.prototype.setParam=function(e){this.m_selectIndex=e.index,this.m_data=e.data,this.m_target=e.target,this.refresh()},t.prototype.refresh=function(){for(var e=0;e<this.m_data.length;e++)this.p_arrNodeItem[e].getComponent("jgklItem").refreshUI({data:this.m_data[e],index:e,target:this});this.p_btnOk.interactable=this.m_selectIndex>-1},t.prefabPath="windowsPageJgklSelect",t.pageType=1,n([s(cc.Button)],t.prototype,"p_btnCancel",void 0),n([s(cc.Button)],t.prototype,"p_btnOk",void 0),n([s(cc.Node)],t.prototype,"p_arrNodeItem",void 0),n([o],t)}(e("basePage"));t.exports=p,cc._RF.pop()},{basePage:void 0}],windowsPageJiban:[function(e,t){"use strict";cc._RF.push(t,"83f9cFjA1hEmomX6qkvpEBi","windowsPageJiban");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagejiban",pageType:1,_forceCreateNewShot:!0},properties:{p_arrNodeCamp:[cc.Node],p_arrNodeOccu:[cc.Node],p_nodeContent:cc.Node,p_pfbItem:cc.Prefab,p_labTips:cc.Label},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.creatMask(!0),this._campxarr=[],this._occuxarr=[];for(var e=0;e<this.p_arrNodeCamp.length;++e)this._campxarr.push(this.p_arrNodeCamp[e].x);for(var t=0;t<this.p_arrNodeOccu.length;++t)this._occuxarr.push(this.p_arrNodeOccu[t].x);this._arrItems=[]},handleUI:function(){this._super(),this.p_arrNodeCamp.forEach(function(e,t){e.on("touchend",function(){app.pages.windowspagetipscamp.showPage({camp:t+1})})}),this.p_arrNodeOccu.forEach(function(e,t){e.on("touchend",function(){app.pages.windowspagetipsoccu.showPage({occu:t+1})})})},setParam:function(e){this._fetters=app.getFettersByGsidArr(e),this.refreshUI()},refreshUI:function(){for(var e=0,t=[],a=[],i=[],n=[],r=0;r<this._fetters.length;++r){var o=this._fetters[r];if(o.level>0){var s=this._arrItems[e];s||((s=cc.instantiate(this.p_pfbItem)).parent=this.p_nodeContent,s.x=0,this._arrItems.push(s)),s.active=!0,s.getComponent("jibanModelItem").initInfo(o),e++,r<=5?t.push(o.camp):i.push(o.occu)}else r<=5?a.push(o.camp):n.push(o.occu)}for(var p=e;p<this._arrItems.length;++p)this._arrItems[p].active=!1;var c=0==e;this.p_labTips.string=c?langMgr.getString("windowsPageJiban",1):"";for(var h=t.length,l=0;l<h;++l){var g=t[l]-1;this.p_arrNodeCamp[g].x=this._campxarr[l],app.setNodeState(this.p_arrNodeCamp[g],!1)}for(var d=0;d<a.length;++d){var u=a[d]-1;this.p_arrNodeCamp[u].x=this._campxarr[d+h],app.setNodeState(this.p_arrNodeCamp[u],!0)}h=i.length;for(var f=0;f<h;++f){var m=i[f]-1;this.p_arrNodeOccu[m].x=this._occuxarr[f],app.setNodeState(this.p_arrNodeOccu[m],!1)}for(var _=0;_<n.length;++_){var v=n[_]-1;this.p_arrNodeOccu[v].x=this._occuxarr[_+h],app.setNodeState(this.p_arrNodeOccu[v],!0)}}});cc._RF.pop()},{basePage:void 0}],windowsPageLegionPlacard:[function(e,t){"use strict";cc._RF.push(t,"788e8k+pQVEv6DXARbbGiRn","windowsPageLegionPlacard");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagelegionplacard",pageType:1},properties:{p_ebIntro:cc.EditBox,p_btnSure:cc.Button},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){var e=this;this._super(),this.p_btnSure.node.on("click",function(){app.playSound("click"),e.onFixInfo()})},setParam:function(e){this.m_legionInfo=e,this.refreshCreateUI()},refreshCreateUI:function(){this.p_ebIntro.placeholder=this.m_legionInfo.intro,this.p_ebIntro.string=""},onFixInfo:function(){var e=this,t={},a=this.p_ebIntro.string;""==a||a==this.m_legionInfo.intro||(t.notice=a,app.checkMatchStr(a))?"{}"!=JSON.stringify(t)?app.player.sfLegionSet(t,function(){app.showNotice(langMgr.getString("windowsPageLegionPlacard",2)),e.onClose(),app.pages.legionpage.instance.onClose()}):app.showNotice(langMgr.getString("windowsPageLegionPlacard",1)):app.showNotice(langMgr.getString("windowsPageLegionPlacard",0))}});cc._RF.pop()},{basePage:void 0}],windowsPageLegionSet:[function(e,t){"use strict";cc._RF.push(t,"f70a0tS8MVJFqA3boquTASt","windowsPageLegionSet");var a=[0,30,60],i=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagelegionset"},properties:{p_btnSure:cc.Button,p_arrBtnUp:[cc.Button],p_arrBtnDown:[cc.Button],p_labVer:cc.Label,p_labVerLv:cc.Label},onLoad:function(){i.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){var e=this;this._super(),this.p_arrBtnUp.forEach(function(t,a){t.node.on("click",function(){app.playSound("click"),e.setData("ver",a)})}),this.p_arrBtnDown.forEach(function(t,a){t.node.on("click",function(){app.playSound("click"),e.setData("verlv",a)})}),this.p_btnSure.node.on("click",function(){app.playSound("click"),e.onFixInfo()})},setData:function(e,t){"ver"==e?(this.m_isVer=!this.m_isVer,this.refreshIsVer()):(this.m_verLv=t?this.m_verLv+1:this.m_verLv-1,this.refreshVerLv())},refreshIsVer:function(){this.p_labVer.string=this.m_isVer?langMgr.getString("windowsPageLegionSet",1):langMgr.getString("windowsPageLegionSet",0)},refreshVerLv:function(){var e=a[this.m_verLv];this.p_labVerLv.string=e?langMgr.getString("windowsPageLegionSet",2,e):langMgr.getString("windowsPageLegionSet",3),this.p_arrBtnDown[1].interactable=!(this.m_verLv>=a.length-1),this.p_arrBtnDown[0].interactable=this.m_verLv},setParam:function(e){this.m_legionInfo=e,this.m_isVer=e.ispass;for(var t=0;t<a.length;++t)if(a[t]==e.minlv){this.m_verLv=t;break}this.refreshCreateUI()},refreshCreateUI:function(){this.refreshIsVer(),this.refreshVerLv()},onFixInfo:function(){var e=this,t={},i=a[this.m_verLv],n=this.m_isVer;i!=this.m_legionInfo.minlv&&(t.minlv=i),n!=this.m_legionInfo.ispass&&(t.ispass=n?1:0),"{}"!=JSON.stringify(t)?app.player.sfLegionSet(t,function(){app.showNotice(langMgr.getString("windowsPageLegionSet",5)),e.onClose(),app.pages.legionpage.instance.onClose()}):app.showNotice(langMgr.getString("windowsPageLegionSet",4))}});cc._RF.pop()},{basePage:void 0}],windowsPageLiangCao:[function(e,t){"use strict";cc._RF.push(t,"55833XyJuxIGLzIOxFxaWb8","windowsPageLiangCao");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspageliangcao",pageType:1},properties:{p_sprBg:cc.Sprite,p_arrBgSprF:[cc.SpriteFrame],p_btnNode:cc.Button,p_btnTx:[cc.Node],p_rewardContent:cc.Node,p_propItem:cc.Prefab,p_labEtime:cc.Label},onLoad:function(){a.instance=this,this.m_propItem=[],this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){var e=this;this._super(),this.p_btnNode.node.on("click",function(){app.player.sfDramaLiangCao(e.m_bossid,e.m_objData.id,function(t,a){var i={showtype:1,reward:a.items,confirmcb:function(){app.player.sfDramaBossList(function(t){for(var a,i=0;i<t.eventlist.length;i++)t.eventlist[i].boss.bossid==e.m_bossid&&(a=t.eventlist[i]);app.pages.dramabosslistpage.instance&&app.pages.dramabosslistpage.instance.refreshData(t.eventlist),e.m_target.m_objData=a,e.m_target.refreshUI(),e.m_objData=e.m_target.m_liangCao,e.refreshUI()})},target:e};app.pages.windowspagereward.showPage(i)})})},setParam:function(e){this.m_objData=e.data,this.m_bossid=e.bossid,e.target&&(this.m_target=e.target),this.refreshUI(),this.refreshLcTime(),this.schedule(this.refreshLcTime,1)},refreshUI:function(){if(this.m_objData){for(var e=this.m_objData.items,t=0;t<e.length;t++){var a=e[t],i=this.m_propItem[t];i||((i=cc.instantiate(this.p_propItem)).scale=.9,i.parent=this.p_rewardContent,this.m_propItem.push(i)),i.active=!0,i.getComponent("propItem").initForBag(a),i.getComponent("propItem").setClick(!0)}for(var n=e.length;n<this.m_propItem.length;n++)this.m_propItem.active=!1}else this.onClose()},refreshLcTime:function(){var e=(this.m_objData.etime-app.player.getServerTime())/1e3,t=e<=0;this.p_btnNode.interactable=t,this.p_btnNode.node.active=t,this.p_labEtime.node.active=!t;var a,i=gUtils.getDayHourMinSecStruct(e);a=i.d>0?i.d+langMgr.getString("windowsPagePlotBoss",3)+(i.h>0?i.h+langMgr.getString("windowsPagePlotBoss",4):"")+(i.m>0?i.m+langMgr.getString("windowsPagePlotBoss",5):""):(i.h>0?i.h+langMgr.getString("windowsPagePlotBoss",4):"")+(i.m>0?i.m+langMgr.getString("windowsPagePlotBoss",5):"")+i.s+langMgr.getString("windowsPagePlotBoss",6),this.p_labEtime.string=langMgr.getString("windowsPagePlotBoss",7,a),this.p_btnTx[0].active=!t,this.p_btnTx[1].active=t,this.p_sprBg.spriteFrame=t?this.p_arrBgSprF[1]:this.p_arrBgSprF[0]}});cc._RF.pop()},{basePage:void 0}],windowsPageListCard:[function(e,t){"use strict";cc._RF.push(t,"b63d7/i/O1LVKoRU12uTJHA","windowsPageListCard");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagelistcard",pageType:1},properties:{p_tabNode:cc.Node},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){this._super()},setParam:function(){this.refreshUI()},refreshUI:function(){for(var e=app.db.dbDrawCard,t=[],a=0;a<e.length;a++)app.player.tutor==e[a].TYPE&&t.push({gsid:e[a].GSID});var i=t.length;this.p_tabNode.getComponent("tableView").initTableView(i,{array:t,target:this})}});cc._RF.pop()},{basePage:void 0}],windowsPageListEquipSuit:[function(e,t){"use strict";cc._RF.push(t,"43dd2DYOyVAWqdfpAlp9kMT","windowsPageListEquipSuit");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagelistequipsuit",pageType:1},properties:{p_btnCanvel:cc.Button,p_btnConfirm:cc.Button,p_tabView:cc.Node,p_nodeMaxLevel:cc.Node,p_nodeMenuCampCtrl:cc.Node,p_nodeCost:cc.Node},onLoad:function(){a.instance=this,this.m_campMenu=this.p_nodeMenuCampCtrl.getComponent("campMenu"),this.m_campMenu.init(this),this.creatMask(!0),this.stopBgNodeEvent(),this.handleUI()},handleUI:function(){var e=this;this._super(),this.p_btnCanvel.node.on("click",function(){app.playSound("click"),e.onClose()}),this.p_btnConfirm.node.on("click",function(){app.playSound("click"),e.onClickOK()}),this.p_btnConfirm.node.on("click",function(){})},setParam:function(e){console.log(e),this.m_strEquipGsid=e.gsid,this.m_strGuid=e.guid,this.m_isBuild=e.isBuild,this.getData(),this.m_arrShowData=this.setData(0),this.refreshUI()},campMenuHandler:function(e){return this.m_arrShowData=this.setData(e),this.refreshUI(),!0},refreshUI:function(){console.log(this.m_arrShowData),this.m_arrPickedId=[],this.p_nodeMaxLevel.active=this.m_arrShowData.length<1,this.p_btnConfirm.interactable=!(this.m_arrShowData.length<1);var e=this.m_arrShowData.length;this.p_tabView.getComponent("tableView").initTableView(e,{array:this.m_arrShowData,targetGsid:this.m_strEquipGsid,target:this,pos:this.m_pos}),this.m_arrPickedId[0]||(this.p_nodeCost.active=!1)},getData:function(){var e,t=app.db.getEBaseByGsid(this.m_strEquipGsid);this.m_pos=t.POS,e=app.db.getSuitBaseByGsid(this.m_strEquipGsid)?this.m_isBuild?t.NEXT_LEVEL:t.SLEVEL:18;var a=(app.db.dbOccuequipList[e]||[])[this.m_pos-1]||[];if(this.m_isBuild)if(18==e)this.m_data=a;else{for(var i=app.db.getEBaseByGsid(this.m_strEquipGsid),n=[],r=0;r<a.length;r++)app.db.getEBaseByGsid(a[r].GSID).TAB==i.TAB&&n.push(a[r]);this.m_data=n}else{for(var o=app.db.getEBaseByGsid(this.m_strEquipGsid),s=[],p=0;p<a.length;p++)app.db.getEBaseByGsid(a[p].GSID).TAB==o.TAB&&s.push(a[p]);this.m_data=s}},setData:function(e){if(e<1)return this.m_data;for(var t=[],a=this.m_data,i=0;i<a.length;i++){var n=a[i];e==n.OCCU&&t.push(n)}return t},itemClick:function(e,t){return e==this.m_strNowCompGsid||(e!=this.m_selectGsid&&(this.m_selectGsid=null,this.m_selectGuid=null),this.m_chooseItem&&(cc.log("handle choose item"),this.m_chooseItem.selected(!1,this.m_strNowCompGsid)),this.m_chooseItem=t,this.m_strNowCompGsid=e,this.refreshCost(e),!0)},refreshCost:function(e){if(this.m_isBuild)this.p_nodeCost.active=!1;else{var t=app.db.getEBaseByGsid(e);this.m_costData=t.REBUILD,this.p_nodeCost.active=!0;for(var a=0;a<this.m_costData.length;++a){var i=this.p_nodeCost.children[a];i||(i=cc.instantiate(this.p_nodeCost.children[0]),this.p_nodeCost.addChild(i)),i.getComponent("costItem").refreshUI(this.m_costData[a].GSID,this.m_costData[a].COUNT,this),i.active=!0}for(var n=this.m_costData.length;n<this.p_nodeCost.children.length;n++)this.p_nodeCost.children[n].active=!1}},onClickOK:function(){var e=this;if(this.m_isBuild){if(!this.m_arrPickedId[0])return void app.showNotice(langMgr.getString("windowsPageListEquipSuit",0));var t={nowGsid:this.m_strEquipGsid,targetGsid:this.m_arrPickedId[0],guid:this.m_strGuid,isBuild:this.m_isBuild};app.pages.equicsuitbuildpage.showPage(t)}else{if(!this.m_arrPickedId[0])return void app.showNotice(langMgr.getString("windowsPageListEquipSuit",1));if(!this.checkCost(this.m_costData))return;var a=app.db.getEBaseByGsid(this.m_arrPickedId[0]).NAME,i=app.db.getEBaseByGsid(this.m_strEquipGsid).NAME,n={content:langMgr.getString("windowsPageListEquipSuit",5,[i,a]),confirmcb:function(){app.player.sfEquipReBuild(e.m_strGuid,e.m_strEquipGsid,e.m_arrPickedId[0],function(t,a){if(!t){app.pages.generalpage.instance.refreshInfo(a.general);var i={};i.gsid=e.m_arrPickedId[0],i.type=1,i.general=a.general.guid,i.isHideBtn=!1,i.isBuild=!0,app.pages.windowspagetipsequip.showPage(i),e.onClose()}})},target:this};app.pages.windowspagetipsmsg.showPage(n)}},checkCost:function(e){for(var t=0;t<e.length;t++)if(app.player.getCount(e[t].GSID)<e[t].COUNT){var a=app.db.getPropsInfoByGsid(e[t].GSID).NAME;return app.showNotice(langMgr.getString("windowsPageListEquipSuit",2,a)),!1}return!0}});cc._RF.pop()},{basePage:void 0}],windowsPageListEquip:[function(e,t){"use strict";cc._RF.push(t,"48695mE+UFMap4x7GcZuZL0","windowsPageListEquip");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagelistequip",pageType:1},properties:{p_arrTitle:[cc.Node],p_tabvEquip:cc.Node},onLoad:function(){a.instance=this,this.handleUI(),this.creatMask(!0),this.stopBgNodeEvent()},handleUI:function(){this._super()},setParam:function(e){this.m_strGeneralGuid=e.general,this.m_arrShowData=this.setData(e.pos),this.refreshUI(e.pos)},refreshUI:function(e){this.refreshTitle(e),this.refreshView()},refreshTitle:function(e){var t=6==e?1:0;this.p_arrTitle.forEach(function(e,a){e.active=Boolean(a==t)})},refreshView:function(){var e=this.m_arrShowData.length;this.p_tabvEquip.getComponent("tableView").initTableView(e,{array:this.m_arrShowData,target:this})},itemPorpClick:function(e){if(!this.m_arrShowData[e])return!1;var t=this.m_arrShowData[e];return app.showPropTips(t),!1},setData:function(e){var t=[],a=6==e?app.player.treas:app.player.equip,i=6==e?"treas":"equip";for(var n in a){var r=n.length>5?a[n].gsid:n,o="equip"==i?app.db.getEBaseByGsid(r):app.db.getTBaseByGsid(r);if(o){var s={gsid:r,count:a[n].count||1,type:i,tips:2};n.length>5&&(s.guid=n),this.m_strGeneralGuid&&(s.general=this.m_strGeneralGuid),"34000"!=n&&(e<5?o.POS==e&&t.push(s):t.push(s))}}return cc.log("equip list show data : ",t),t}});cc._RF.pop()},{basePage:void 0}],windowsPageListGeneral:[function(e,t){"use strict";function a(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(a)return(a=a.call(e)).next.bind(a);if(Array.isArray(e)||(a=i(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function i(e,t){if(e){if("string"==typeof e)return n(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?n(e,t):void 0}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,i=new Array(t);a<t;a++)i[a]=e[a];return i}cc._RF.push(t,"7c6aaoXsuhIlKE8Xz8lNw1r","windowsPageListGeneral");var r=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagelistgeneral",pageType:1},properties:{p_tabvGeneral:cc.tableView,p_btnConfirm:cc.Button,p_labPick:cc.Label,p_labTips:cc.Label},onLoad:function(){r.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},start:function(){var e=this;eventMgr.on(eventStr.battleEvent.ExitBattle,function(){e.onClose()},this),eventMgr.on(eventStr.soulBinding.ExitBinding,function(){e.onClose()},this)},handleUI:function(){var e=this;this._super(),this.p_btnConfirm.node.on("click",function(){app.playSound("click"),e.onConfirm()})},setParam:function(e){this.m_numIndex=e.index,this.m_strMain=e.main,this.m_arrCond=e.arrcond,this.m_noTips=e.notips,this.m_noPlus=e.noplus,this.m_target=e.target,this.m_callBack=e.cb,this.isGeneralComp=e.isGeneralComp,this.m_arrAllPicked=this.getOtherPicked(),this.objCondData=this.m_arrCond[e.index],this.m_arrShowData=this.setData(this.objCondData.cond),this.isGeneralComp&&this.setCompData(),this.p_labTips.node.active=!this.m_noTips,this.refreshView()},refreshView:function(){if(this.getPicked(),!this.m_noPlus){var e=this.getSourceInfo(this.objCondData.cond);this.m_arrShowData.push(e)}cc.log(this.m_arrShowData);var t=this.m_arrShowData.length;this.p_tabvGeneral.initTableView(t,{array:this.m_arrShowData,maxpick:this.objCondData.need,initfun:"initForGCompList",iscomp:!0,target:this,isMainHero:Boolean(0===this.m_numIndex&&!this.m_strMain)})},itemClick:function(e,t){var a=!t.p_nodeMask.active,i=a?this.m_arrPickedId.length+1:this.m_arrPickedId.length-1;return i=Math.min(i,this.objCondData.need),this.refershLabPick(i),a},refershLabPick:function(e){var t=e||0==e?e:this.m_arrPickedId.length;this.p_labPick.string=langMgr.getString("windowsPageListGeneral",0,[t,this.objCondData.need])},setData:function(e){var t=[],a=[];for(var i in app.player.general)if(!(this.m_arrAllPicked.indexOf(i)>=0||app.player.isSoulGeneral(i))){if(0!==this.m_numIndex||this.m_strMain){if(!this.isGeneralComp&&app.player.isOfficialGeneral(i))continue;if(!this.isGeneralComp&&app.player.isRetinueGeneral(i))continue}var n=app.player.general[i];e?this.checkCond(n.gsid,e)&&(app.player.checkIsInLimitTeam(i)?a.push(i):t.push(i)):t.push(i)}t.sort(function(e,t){var a=app.player.general[e],i=app.player.general[t];if(a.star<i.star)return 1;if(a.star==i.star){if(a.level<i.level)return 1;if(a.level==i.level&&a.gsid>i.gsid)return 1}return-1});for(var r=0;r<a.length;++r)t.push(a[r]);return 0!==this.m_numIndex||this.m_strMain||t.sort(function(e,t){var a=app.player.general[e];return app.player.general[t].level-a.level}),t},checkCond:function(e,t){if(!t)return!1;if("Array"!=gUtils.getType(t))return t==e;if("Array"==gUtils.getType(t)){for(var a=0;a<t.length;++a)if(!app.db.checkGeneralCond(e,t[a]))return!1;return!0}},getOtherPicked:function(){var e=[];this.m_strMain&&e.push(this.m_strMain);for(var t=0;t<this.m_arrCond.length;++t)if(this.m_numIndex!=t)for(var a=this.m_arrCond[t],i=0;i<a.picked.length;++i)e.push(a.picked[i]);return e},getPicked:function(){this.m_arrPickedId=[];for(var e,t=a(this.objCondData.picked);!(e=t()).done;){var i=e.value;this.m_arrPickedId.push(i)}this.refershLabPick()},setPicked:function(){this.objCondData.picked.length=0;for(var e,t=a(this.m_arrPickedId);!(e=t()).done;){var i=e.value;this.objCondData.picked.push(i)}},getSourceInfo:function(e){if(e){var t,a={};if("Array"!=gUtils.getType(e))switch((a=app.db.getGBaseByGsid(e)).STAR){case 4:t=138e3;break;case 5:t=138001;break;case 6:t=138002}if("Array"==gUtils.getType(e))for(var i=0;i<e.length;++i)switch((a=app.db.checkGeneralCond(0,e[i],a)).HEADICON=gConfig.defaultSet.gHeadIcon,a.STAR){case 3:t=138003;break;case 4:t=138004;break;case 5:t=138005;break;case 6:t=138006;break;case 9:t=138007}return{id:t,data:a}}},onConfirm:function(){this.setPicked(),this.m_callBack&&this.m_callBack.call(this.m_target,!0),this.onClose()},onClose:function(){this._super(),eventMgr.targetOff(this)},setCompData:function(){var e,t=this;if(this.m_arrShowData=this.m_arrShowData.sort(function(e,a){var i=app.player.general[e],n=app.player.general[a],r=app.db.getGBaseByGsid(i.gsid),o=app.db.getGBaseByGsid(n.gsid);if(t.m_strMain)return i.level!==n.level?i.level-n.level:r.TGRADE!==o.TGRADE?r.TGRADE-o.TGRADE:n.gsid-i.gsid;switch(t.m_numIndex){case 1:case 2:return i.level!==n.level?i.level-n.level:r.TGRADE!==o.TGRADE?r.TGRADE-o.TGRADE:n.gsid-i.gsid;default:return 0}}),0!==this.m_numIndex||this.m_strMain){var a=[],i=[],n=[],r=[];this.m_arrShowData=(e=this.m_arrShowData.filter(function(e){var t=!1;switch(!0){case app.player.isOfficialGeneral(e):a.push(e);break;case app.player.hasBeenSoulBind(e):i.push(e);break;case app.player.checkIsInLimitTeam(e):n.push(e);break;case app.player.isRetinueGeneral(e):r.push(e);break;default:t=!0}return t})).concat.apply(e,[].concat(r,a,i,n))}}});cc._RF.pop()},{basePage:void 0}],windowsPageManorLock:[function(e,t){"use strict";cc._RF.push(t,"246a3EOelBOYZbfYlOOAK8f","windowsPageManorLock");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagemanorlock",pageType:1},properties:{p_rtxContent:cc.RichText,p_sprTitle:cc.Sprite,p_labChatper:cc.Label,p_btnConfirm:cc.Button,p_btnCancel:cc.Button},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.creatMask(!0)},handleUI:function(){var e=this;this._super(),this.p_btnConfirm.node.on("click",function(){app.playSound("click"),e.onClose(),e.m_confirmCb&&e.m_confirmCb.apply(e.m_target,e.m_confirmParm)}),this.p_btnCancel.node.on("click",function(){app.playSound("cancel"),e.onClose(),e.m_cancelCb&&e.m_cancelCb.call(e.m_target)})},setParam:function(e){this.m_objData=e,this.m_budID=e.budID,this.m_confirmCb=e.confirmcb,this.m_confirmParm=e.confirmparm,this.m_cancelCb=e.cancelcb,this.m_target=e.target,this.refreshUI()},refreshUI:function(){this.m_objData.type||(this.m_objData.type="comfirm"),this.p_btnCancel.node.active=!("nocancel"==this.m_objData.type),app.db.getManorBuildingMax(this.m_budID),this.p_rtxContent.string=app.db.getManorBuildingMax(this.m_budID).DESC||"",app.loadTexture(gConfig.getManorBuildingIconTitle(this.m_budID),this.p_sprTitle,this.prefabPath);var e=this.unLock(this.m_budID);this.p_labChatper.string=langMgr.getString("windowsPageManorLock",0,e)},unLock:function(e){for(var t=app.db.getManorHome(),a=0;a<t.length;a++){var i=t[a].UNLOCK;if(i&&i.indexOf(e)>-1)return t[a].LV}return 0}});cc._RF.pop()},{basePage:void 0}],windowsPageMentor:[function(e,t){"use strict";cc._RF.push(t,"572a4KQoMRBWKea+9QI7CNs","windowsPageMentor");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagementor",pageType:1},properties:{p_sprTVCF:cc.Sprite,p_arrTVCFSprF:[cc.SpriteFrame],p_rtxBoxTime:cc.RichText,p_nodeBox:cc.Node,p_sprTalk:cc.Node,p_nodeGeneralList:cc.Node,p_nodeFetterContent:cc.Node,p_nodeFetterItem:cc.Node,p_sprIntro:cc.Sprite,p_btnLeftArrow:cc.Button,p_btnRightArrow:cc.Button,p_arrNodeOption:[cc.Node],p_arrNodePick:[cc.Node],p_nodeDot:cc.Node,p_arrSprFZhanShi:[cc.SpriteFrame],p_arrSprFCike:[cc.SpriteFrame],p_arrSprFSheShou:[cc.SpriteFrame],p_arrSprFFaShi:[cc.SpriteFrame],p_sprFTongyong:cc.SpriteFrame},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.m_type=window.gSetting.clientRunJudge("JSQBZ")?1:0,this.m_arrSprFIntro=[this.p_arrSprFZhanShi,this.p_arrSprFCike,this.p_arrSprFFaShi,this.p_arrSprFSheShou],this.m_arrFetterNode=[],this.m_arrFetterNode.push(this.p_nodeFetterItem),this.m_spBox=this.p_nodeBox.getComponent(sp.Skeleton),this.handleUI(),this.refreshTime(),this.schedule(this.refreshTime,1),this.p_sprTalk.scale=0;var e=cc.scaleTo(.3,1);this.p_sprTalk.runAction(e),this.p_btnLeftArrow.node.runAction(cc.repeatForever(cc.sequence(cc.moveBy(.5,cc.v2(-5,0)),cc.moveBy(1,cc.v2(10,0)),cc.moveBy(1,cc.v2(-10,0)),cc.moveBy(1,cc.v2(10,0)),cc.moveBy(.5,cc.v2(-5,0)),cc.delayTime(0)))),this.p_btnRightArrow.node.runAction(cc.repeatForever(cc.sequence(cc.moveBy(.5,cc.v2(5,0)),cc.moveBy(1,cc.v2(-10,0)),cc.moveBy(1,cc.v2(10,0)),cc.moveBy(1,cc.v2(-10,0)),cc.moveBy(.5,cc.v2(5,0)),cc.delayTime(0)))),this.p_arrNodeOption[0].active=app.player.level<50,this.p_arrNodeOption[3].active=app.player.level>=50},handleUI:function(){var e=this;this._super(),this.p_arrNodeOption.forEach(function(t,a){t.on("touchend",function(){e.onClickMenu(a)})}),this.p_btnLeftArrow.node.on("click",function(){e.m_tutor--,e.m_tutor<1&&(e.m_tutor=4),e.refreshUI()}),this.p_btnRightArrow.node.on("click",function(){e.m_tutor++,e.m_tutor>4&&(e.m_tutor=1),e.refreshUI()}),this.p_nodeBox.on("touchend",function(){app.player.getCount(94600)||!e.m_isGet?app.pages.windowspagerecommendreward.showPage():app.player.sfBattleReward(function(t,a){if(!t){var i={showtype:1,reward:a.reward,confirmcb:function(){app.player.addItem(a.reward),app.player.sfPlayerByParam(["others"],function(){e.m_isGet=!1,e.refreshUI()})},target:e};app.pages.windowspagereward.showPage(i)}})}),this.p_nodeFetterItem.on("touchend",function(){e.onClickFetter(e.p_nodeFetterItem)})},setParam:function(){this.m_tutor=app.player.tutor,this.p_arrNodeOption[0].active?this.onClickMenu(0):this.onClickMenu(1)},onClickMenu:function(e){this.m_index=e,this.p_arrNodePick.forEach(function(t,a){t.active=e==a}),this.refreshUI()},refreshUI:function(){var e=this;this.m_isGet?this.m_spBox.setAnimation(0,"A",!0):this.m_spBox.setAnimation(0,"B",!0),this.p_nodeDot.x=51*(this.m_tutor-1)-72,this.p_sprTVCF.spriteFrame=this.p_arrTVCFSprF[this.m_type?this.m_tutor-1:this.m_tutor+3],3==this.m_index?this.p_sprIntro.spriteFrame=this.p_sprFTongyong:this.p_sprIntro.spriteFrame=this.m_arrSprFIntro[this.m_tutor-1][this.m_index];for(var t=app.db.getBattleByOccu(this.m_tutor,this.m_index),a=0;a<this.p_nodeGeneralList.children.length;a++){var i=this.p_nodeGeneralList.children[a];t.GENERAL[a]?(i.active=!0,i.getComponent("recommendGeneralItem").refreshUI(t.GENERAL[a],this),0==a&&i.getComponent("recommendGeneralItem").setAnim()):i.active=!1}this._fetters=app.getFettersByGsidArr(t.GENERAL),console.log(this._fetters);for(var n=0,r=0;r<this._fetters.length;r++)this._fetters[r].level&&function(){var t=e.m_arrFetterNode[n];t||(t=cc.instantiate(e.p_nodeFetterItem),e.m_arrFetterNode.push(t),t.parent=e.p_nodeFetterContent,t.on("touchend",function(){e.onClickFetter(t)})),t.active=!0;var a=void 0;e._fetters[r].camp?(t.camp=e._fetters[r].camp,t.occu=0,a=gConfig.getIconGCampPath(e._fetters[r].camp-1)):(t.occu=e._fetters[r].occu,t.camp=0,a=gConfig.getIconGOccuPath(e._fetters[r].occu-1)),app.loadTexture(a,t.getComponent(cc.Sprite),e.prefabPath),t.getChildByName("num").getComponent(cc.Label).string=e._fetters[r].num+"/"+e._fetters[r].need,n++}();for(var o=n;o<this.m_arrFetterNode.length;o++)this.m_arrFetterNode[o].active=!1},refreshTime:function(){if(app.player.create+18e5-app.player.getServerTime()<=0)if(app.player.getCount(94600)){var e=new Date,t=23-e.getHours(),a=59-e.getMinutes(),i=59-e.getSeconds(),n="";t&&(n+=langMgr.getString("windowsPageMentor",0,t)),a&&(n+=langMgr.getString("windowsPageMentor",1,a)),i&&(n+=langMgr.getString("windowsPageMentor",2,i)),this.p_rtxBoxTime.string=langMgr.getString("windowsPageMentor",3,n),this.m_isGet=!1}else this.m_isGet=!0,this.p_rtxBoxTime.string=langMgr.getString("windowsPageMentor",4);else{this.m_isGet=!1;var r=gUtils.getDayHourMinSecTime(app.player.create+18e5-app.player.getServerTime()),o="";r[1]&&(o+=langMgr.getString("windowsPageMentor",0,r[1])),r[2]&&(o+=langMgr.getString("windowsPageMentor",1,r[2])),r[3]&&(o+=langMgr.getString("windowsPageMentor",2,r[3])),this.p_rtxBoxTime.string=langMgr.getString("windowsPageMentor",3,o)}},onClickFetter:function(e){e.camp?app.pages.windowspagetipscamp.showPage({camp:e.camp}):app.pages.windowspagetipsoccu.showPage({occu:e.occu})}});a.refreshRed=function(e){var t=!1;return app.player.create+18e5-app.player.getServerTime()<=0&&!app.player.getCount(94600)&&(t=!0),e&&(e.active=t),t},cc._RF.pop()},{basePage:void 0}],windowsPageMountSkillChoice:[function(e,t){"use strict";cc._RF.push(t,"79becmHiHVN5JKUIciRO05I","windowsPageMountSkillChoice");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=e("../lang/langMgr"),o=cc._decorator,s=o.ccclass,p=o.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.btnConfirm=null,t.btnCancel=null,t.nodeCost=null,t.skillChoices=[],t.skillDisplayList=null,t.skillDisplayPanel=null,t.introducePanel=null,t.mShowData=[],t.mUseData=[],t.mSelectData=[],t.mMountGsid=0,t.mMountLv=1,t._selectIndex=-1,t.curGeneralGuid="",t}var a;return i(t,e),a=t,Object.defineProperty(t.prototype,"selectIndex",{get:function(){return this._selectIndex},set:function(e){if(this._selectIndex!==e){var t=!1;-1===this._selectIndex&&(t=!0),this._selectIndex=e,this.refreshUI(t)}},enumerable:!1,configurable:!0}),t.prototype.onLoad=function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.addEvent(),this._updateBottomPanelStyle(),this.skillDisplayPanel.active=!1},t.prototype.handleUI=function(){var t=this;e.prototype.handleUI.call(this),this.btnConfirm.on("click",function(){var e=window.app;e.playSound("click");var a=t.mSelectData.reduce(function(e,a){return t.mUseData.includes(a)&&e++,e},0),i=t.mSelectData.filter(function(e){return void 0!==e}).length,n="";switch(!0){case e.player.getCount(30047)<1:n=r.getString("WindowsPageMountSkillChoice",0);break;case i<2:n=r.getString("WindowsPageMountSkillChoice",1);break;case a>1:n=r.getString("WindowsPageMountSkillChoice",2)}if(n)return e.showNotice(n);e.pages.windowsPageCompleteChoiceSkill.showPage({oldSkillGuids:t.mUseData,newSkillGuids:t.mSelectData.slice(0,2),generalGuid:t.curGeneralGuid,target:t})},this),this.btnCancel.on("click",function(){window.app.playSound("click")},this),this.skillChoices.forEach(function(e,a){e.on("click",function(){t.selectIndex=a})})},t.prototype.setParam=function(e){this.mUseData=e.skillGsids,this.mMountGsid=e.mountGsid,this.mMountLv=e.mountLv,this.curGeneralGuid=e.generalGuid,this.initUI()},t.prototype.initUI=function(){this.mShowData=window.app.db.getEqualMountSkills(this.mMountGsid,this.mMountLv),this.refreshCost()},t.prototype.refreshUI=function(e){var t;void 0===e&&(e=!1),this.skillDisplayPanel.active=!0;for(var a=this.mShowData[this.selectIndex],i=a instanceof Array?a.length:0,n=0,r=0;r<i&&n<1;++r){var o=a[r];this.mUseData.includes(o)&&(t=[a[r],a[n]],a[n]=t[0],a[r]=t[1],n++)}if(this.skillDisplayList.getComponent("tableView").initTableView(i,{array:a,useList:this.mUseData,selectList:this.mSelectData,target:this}),e){var s=cc.moveBy(.5,cc.v2(0,this.skillDisplayPanel.height*this.skillDisplayPanel.scaleY));this.skillDisplayPanel.active=!0,this.skillDisplayPanel.runAction(s),cc.tween(this.introducePanel).by(.5,{y:260}).start()}},t.prototype.refreshCost=function(){this.nodeCost.getComponent("costItem").refreshUI(30047,1,this)},t.prototype.addEvent=function(){var e=this;cc.director.on("EVT_CLICK_SKILL_ITEM",function(t){var a=e.skillChoices[e.selectIndex];cc.isValid(a)&&a.getComponent("SkillChoiceItem").refreshSkillInfo(t,e)},this)},t.prototype.removeEvent=function(){cc.director.targetOff(this)},t.prototype.onDestroy=function(){this.removeEvent(),e.prototype.onDestroy.call(this)},t.prototype._updateBottomPanelStyle=function(){var e=this.skillDisplayPanel.getComponent(cc.Widget);if(cc.isValid(e)){var t=this.skillDisplayPanel.height*this.skillDisplayPanel.scaleY;e.bottom=-t,e.updateAlignment()}},t.prefabPath="windowsPageMountSkillChoice",t.pageType=1,n([p({type:cc.Node})],t.prototype,"btnConfirm",void 0),n([p({type:cc.Node})],t.prototype,"btnCancel",void 0),n([p({type:cc.Node})],t.prototype,"nodeCost",void 0),n([p({type:[cc.Node]})],t.prototype,"skillChoices",void 0),n([p({type:cc.Node})],t.prototype,"skillDisplayList",void 0),n([p({type:cc.Node})],t.prototype,"skillDisplayPanel",void 0),n([p({type:cc.Node})],t.prototype,"introducePanel",void 0),a=n([s],t)}(e("basePage"));t.exports=c,cc._RF.pop()},{"../lang/langMgr":void 0,basePage:void 0}],windowsPageNameChange:[function(e,t){"use strict";cc._RF.push(t,"9b947Lj+vlGFquZhCwnP2/g","windowsPageNameChange");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagenamechange"},properties:{p_editName:cc.EditBox,p_nodeCancelTips:cc.Node,p_btnConfirm:cc.Button,p_btnCancel:cc.Button,p_labTitleTip:cc.Label,p_nodeTips:cc.Node,p_labTx:cc.Label,p_sprCost:cc.Sprite,p_labCost:cc.Label,p_nodeCost:cc.Node},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(),this.handleUI()},handleUI:function(){var e=this;this._super(),this.p_btnCancel.node.on("click",function(){e.onClose(),e._cancelCb&&e._cancelCb()}),this.p_btnConfirm.node.on("click",function(){e.doChangeName()})},setParam:function(e){this.refreshUI(e)},refreshUI:function(e){e.confirmCb&&(this._confirmCb=e.confirmCb),e.cancelCb&&(this._cancelCb=e.cancelCb),e.titletips&&(this.p_labTitleTip.string=e.titletips),e.cost?e.cost.COUNT<=0?(this.p_labTx.string=langMgr.getString("windowsPageNameChange",5),this.p_nodeCost.active=!1):(this.p_nodeCost.active=!0,this.p_labTx.string=langMgr.getString("windowsPageNameChange",6),this.p_labCost.string=e.cost.COUNT):this.p_nodeTips.active=!1,this.limit=e.limit||12},doChangeName:function(){var e=this,t=this.p_editName.string;if(t!=app.palaceData.kname)if(""!=t&&t){var a=t.length,i=a;if(i>this.limit)app.showNotice(langMgr.getString("windowsPageNameChange",2,this.limit));else{for(var n=0;n<a;++n)t.charCodeAt(n)>127&&++i;if(!app.checkMatchStr(t))return app.showNotice(langMgr.getString("windowsPageNameChange",3)),void(this.p_editName.string="");gUtils.checkRNameStr(t)?app.showNotice(langMgr.getString("windowsPageNameChange",4)):this._confirmCb&&this._confirmCb({strname:t,cb:function(){e.onClose()}})}}else app.showNotice(langMgr.getString("windowsPageNameChange",1));else app.showNotice(langMgr.getString("windowsPageNameChange",0))}});cc._RF.pop()},{basePage:void 0}],windowsPageNorthBuff:[function(e,t){"use strict";cc._RF.push(t,"1339anQwMVBz4kJ1D6e27tz","windowsPageNorthBuff");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagenorthbuff",pageType:1},properties:{p_nodeTable:cc.Node},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.creatMask(!0)},handleUI:function(){this._super()},setParam:function(){this.refreshUI()},refreshUI:function(){var e=app.northInfo?app.northInfo.buff:[];this.p_nodeTable.getComponent("tableView").initTableView(e.length,{array:e,target:this})}});cc._RF.pop()},{basePage:void 0}],windowsPageNoticeBingo:[function(e,t){"use strict";cc._RF.push(t,"2102c6ibPNEibriQ22AX9UR","windowsPageNoticeBingo");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagenoticebingo",createShot:!0,pageType:1,_forceCreateNewShot:!0},properties:{p_rtxNotice:cc.RichText},onLoad:function(){a.instance=this,this.creatMask(!0,0),this.handleUI()},setParam:function(e){this.m_funCb=e.cb,this.m_strIntro=e.str,this.m_index=0,this.m_showEnd=!0,this.m_numShowTime=0,this.refreshUI()},refreshUI:function(){this.p_rtxNotice.string=this.m_strIntro.slice(0,this.m_index),this.m_index>=this.m_strIntro.length&&(this.m_showEnd=!1)},update:function(e){this.m_showEnd&&(this.m_numShowTime+=e,this.m_numShowTime>=.1&&(this.m_index++,this.m_numShowTime=0,this.refreshUI()))},onClose:function(){if(this.m_showEnd)return this.m_index=this.m_strIntro.length,void this.refreshUI();this._super(),this.m_funCb&&this.m_funCb()}});cc._RF.pop()},{basePage:void 0}],windowsPageNoticeLongbtn:[function(e,t){"use strict";cc._RF.push(t,"a5c71t69qxPabiQt6e6D407","windowsPageNoticeLongbtn");var a={normal:cc.color(255,234,189),nerror:cc.color(255,255,255),nwarn:cc.color(255,255,255)};cc.Class({extends:cc.Component,properties:{p_richContent:cc.RichText,p_labContent:cc.Label},onLoad:function(){},init:function(e,t,i,n){var r=this;if(i)this.p_richContent.node.active=!1,this.p_labContent.node.active=!0,this.p_labContent.string=e;else{this.p_richContent.node.active=!0,this.p_labContent.node.active=!1,this.p_richContent.string=e;var o=a[t]||a.normal;this.p_richContent.node.color=o}this.node.stopAllActions(),this.node.active=!0,this.node.opacity=204,this.node.parent=cc.director.getScene(),this.node.x=.5*cc.winSize.width,this.node.y=cc.winSize.height*(n||.4),this.node.zIndex=500,this.node.scale=0;var s=cc.sequence(cc.scaleTo(.2,1),cc.delayTime(1),cc.fadeOut(.5),cc.callFunc(function(){r.node.active=!1}));this.node.runAction(s)}}),cc._RF.pop()},{}],windowsPageNoticeReap:[function(e,t){"use strict";cc._RF.push(t,"2162egRy8FGiKqtIj4no9nt","windowsPageNoticeReap"),cc.Class({extends:cc.Component,properties:{p_arrLabOld:[cc.Label],p_arrLabNew:[cc.Label],p_spEff01:sp.Skeleton,p_spEff02:sp.Skeleton,p_spEff03:sp.Skeleton},onLoad:function(){},init:function(e,t){var a=this;cc.log("now show reap info",e,t),this.p_arrLabOld.forEach(function(t,a){t.string=e[a].COUNT}),this.p_arrLabNew.forEach(function(e,a){e.string=langMgr.getString("windowsPageNoticeReap",0,t[a].COUNT)}),this.node.stopAllActions(),this.node.active=!0,this.node.opacity=255,this.scheduleOnce(function(){a.p_spEff01.setAnimation(0,"shengji_shuzhi",!1),a.p_spEff02.setAnimation(0,"shengji_shuzhi",!1),a.p_spEff03.setAnimation(0,"shengji_shuzhi",!1)},.5);var i=cc.sequence(cc.delayTime(1),cc.fadeOut(3),cc.callFunc(function(){a.node.active=!1}));this.node.runAction(i)}}),cc._RF.pop()},{}],windowsPageNoticeReward:[function(e,t){"use strict";cc._RF.push(t,"bb5f6NooxRA4bb54l/fygiv","windowsPageNoticeReward");var a={normal:cc.color(255,255,255),nerror:cc.color(255,255,255),nwarn:cc.color(255,255,255)};cc.Class({extends:cc.Component,properties:{p_arrNode:[cc.Node],p_arrLabel:[cc.Label],p_labTitle:cc.RichText},onLoad:function(){},init:function(e,t,a){var i=this;if(a&&!(a.length<=0)||e){this.renderUI(e,t,a),this.node.stopAllActions(),this.node.active=!0,this.node.opacity=255,this.node.parent=cc.director.getScene(),this.node.x=.5*cc.winSize.width,this.node.y=.75*cc.winSize.height,this.node.zIndex=500,cc.sequence(cc.delayTime(2),cc.fadeOut(1),cc.callFunc(function(){i.node.active=!1}));var n=cc.sequence(cc.moveBy(.8,0,60),cc.fadeOut(.5),cc.callFunc(function(){i.node.active=!1}));this.node.runAction(n)}},renderUI:function(e,t,i){if(i&&!(i.length<=0)||e){this.p_labTitle.string=e||langMgr.getString("windowsPageNoticeReward",0);var n=i&&i.length>=0;if(this.p_arrNode.forEach(function(e){e.active=n}),this.p_arrLabel.forEach(function(e){e.node.active=n}),n){for(var r=[],o=0;o<i.length;o++){var s=i[o];(s.GSID||s.gsid)>9e4||r.push(s)}this.p_arrNode.forEach(function(e,t){var a=r[t];if(a){var i=a.GSID||a.gsid;e.active=!0;var n=app.db.getPropsIconPath(i);app.loadTexture(n,e.getComponent(cc.Sprite))}else e.active=!1}),this.p_arrLabel.forEach(function(e,i){var n=r[i];if(n){var o=n.COUNT||n.count||0;e.node.active=!0,e.string=o;var s=a[t]||a.normal;e.node.color=s}else e.node.active=!1})}this.node.parent=cc.director.getScene(),this.node.x=.5*cc.winSize.width,this.node.y=.75*cc.winSize.height,this.node.active=!0,this.node.opacity=255,this.node.zIndex=500}}}),cc._RF.pop()},{}],windowsPageOccThalentTotal:[function(e,t){"use strict";cc._RF.push(t,"547efMAqP1N7pOkAvsX8Hip","windowsPageOccThalentTotal");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=cc._decorator,o=r.ccclass,s=r.property,p=e("basePage"),c=function(){function e(){this.p_nodeSelf=null,this.p_sprIcon=null,this.p_labTitle=null,this.p_labDes=null,this.p_labTip=null,this.p_labTipActive=null,this.p_nodeLock=null,this.m_data=null}return e.prototype.refreshUI=function(e){this.m_data=e;var t=gConfig.getOccThalentPath("skill/"+this.m_data.ICON);app.loadTexture(t,this.p_sprIcon,app.pages.windowspageoccthalenttotal.prefabPath);var a=!app.pages.occthalentpage.instance.TConfig.isLocked(this.m_data)&&app.pages.occthalentpage.instance.TConfig.getThalentLv(this.m_data.ID)>0;this.p_nodeLock.active=!a,this.p_labTip.node.active=!a,this.p_labTipActive.node.active=a,this.p_labTip.string=langMgr.getString("windowspageoccthalenttotal",0,this.m_data.LIMIT),this.p_labTipActive.string=langMgr.getString("windowspageoccthalenttotal",0,this.m_data.LIMIT),this.p_labTitle.string=this.m_data.NAME,this.p_labDes.string=this.m_data.DES},n([s(cc.Node)],e.prototype,"p_nodeSelf",void 0),n([s(cc.Sprite)],e.prototype,"p_sprIcon",void 0),n([s(cc.Label)],e.prototype,"p_labTitle",void 0),n([s(cc.Label)],e.prototype,"p_labDes",void 0),n([s(cc.Label)],e.prototype,"p_labTip",void 0),n([s(cc.Label)],e.prototype,"p_labTipActive",void 0),n([s(cc.Node)],e.prototype,"p_nodeLock",void 0),n([o("occThalentTotalSkillItem")],e)}(),h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_nodeSkills=[],t.p_nodeProperyItem=null,t.p_nodeContent=null,t.p_labUseCount=null,t.p_labUseTitle=null,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,e.prototype.onLoad.call(this),e.prototype.stopBgNodeEvent.call(this),e.prototype.creatMask.call(this,!0),this.m_arrDes=[],this.m_arrDes.push(this.p_nodeProperyItem)},t.prototype.setParam=function(e){this.m_occIndex=e,this.refreshUI()},t.prototype.refreshUI=function(){var e=app.pages.occthalentpage.instance.TConfig.getSkillConfigByOCC(this.m_occIndex);this.p_nodeSkills.forEach(function(t,a){e&&e[a]?(t.refreshUI(e[a]),t.p_nodeSelf.active=!0):t.p_nodeSelf.active=!1}),this.p_labUseCount.string=app.pages.occthalentpage.instance.TConfig.getTotalUseThalentScore(this.m_occIndex)+"/"+app.pages.occthalentpage.instance.TConfig.MAXLIMIT,this.p_labUseTitle.string=langMgr.getString("windowspageoccthalenttotal",this.m_occIndex);var t=app.pages.occthalentpage.instance.TConfig.getTotalThalentAttrs(this.m_occIndex),a=0;for(var i in t){var n=this.m_arrDes[a];n||((n=cc.instantiate(this.p_nodeProperyItem)).parent=this.p_nodeContent,this.m_arrDes.push(n)),n.active=!0;var r=t[i],o=app.db.dbProperty[i].EN;n.getComponent("propertyItem").refreshUI({KEY:o,VAL:r}),a++}for(;a<this.m_arrDes.length;a++)this.m_arrDes[a].active=!1},t.prefabPath="windowspageoccthalenttotal",t.pageType=1,n([s({type:[c]})],t.prototype,"p_nodeSkills",void 0),n([s(cc.Node)],t.prototype,"p_nodeProperyItem",void 0),n([s(cc.Node)],t.prototype,"p_nodeContent",void 0),n([s(cc.Label)],t.prototype,"p_labUseCount",void 0),n([s(cc.Label)],t.prototype,"p_labUseTitle",void 0),a=n([o],t)}(p);t.exports=h,cc._RF.pop()},{basePage:void 0}],windowsPageOccThalent:[function(e,t){"use strict";cc._RF.push(t,"6354fIa/wRFjbnUwqn/ogER","windowsPageOccThalent");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=cc._decorator,o=r.ccclass,s=r.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_sprIcon=null,t.p_labName=null,t.p_labDes=null,t.p_labFullScale=null,t.p_labActive=null,t.p_labLevelLimit=null,t.p_btnUp=null,t.p_labCount=null,t.p_nodeProperyItem=null,t.p_nodeSkillItem=null,t.p_nodeContent=null,t.p_nodeUpContent=null,t.p_greenLabelColor=null,t.p_greenLabelOutlineColor=null,t.p_LabelColor=null,t.p_LabelOutlineColor=null,t.p_nodeProperyUp=null,t.p_animNode=null,t.p_animPower_01=null,t.p_animPower_02=null,t.p_animPower_03=null,t.p_nodePowerNum=null,t.m_type=0,t.m_data=null,t.m_arrDes=null,t.m_arrUpDes=null,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,e.prototype.onLoad.call(this),e.prototype.stopBgNodeEvent.call(this),e.prototype.creatMask.call(this,!0),this.m_arrDes=[],this.m_arrDes.push(this.p_nodeProperyItem),this.m_arrUpDes=[]},t.prototype.handleUI=function(){var t=this;e.prototype.handleUI.call(this),this.p_btnUp.node.on("click",function(){if(t.isCanClick&&(app.playSound("click"),1==t.m_type&&!app.pages.occthalentpage.instance.TConfig.isLocked(t.m_data)&&app.pages.occthalentpage.instance.TConfig.getThalentLv(t.m_data.ID)<t.m_data.MAXLV))if(app.player.getCount(38020)<t.m_data.COST)app.showNotice(langMgr.getString("windowspageoccthalent",7));else if(app.pages.occthalentpage.instance.TConfig.isLimitUp(t.m_data.OCC))app.showNotice(langMgr.getString("windowspageoccthalent",9));else{t.isCanClick=!1;var e=app.player.power;app.player.sfOccThalentUp({id:t.m_data.ID},function(a,i){if(a)return app.showNotice(a),void(t.isCanClick=!0);app.showNotice(langMgr.getString("windowspageoccthalent",8)),app.player.power=i.power,t.animPower(app.player.power,e),app.player._refreshGeneral(i.generals),app.player.sfPlayerByParam(["others","hide","military"],function(){t.isCanClick=!0,eventMgr.emit(eventStr.occThalentPageEvent.RefreshPlayerData),eventMgr.emit(eventStr.occThalentPageEvent.RefreshThalentView)})})}})},t.prototype.onEnable=function(){e.prototype.onEnable.call(this),eventMgr.on(eventStr.occThalentPageEvent.RefreshPlayerData,this.refreshUI,this)},t.prototype.onDisable=function(){e.prototype.onDisable.call(this),eventMgr.off(eventStr.occThalentPageEvent.RefreshPlayerData,this.refreshUI,this)},t.prototype.setParam=function(e){this.m_type=e.ATTRS?1:0,this.m_data=e,this.isCanClick=!0,this.refreshUI()},t.prototype.refreshUI=function(){var e=this,t=app.pages.occthalentpage.instance.TConfig.getThalentLv(this.m_data.ID),a=app.pages.occthalentpage.instance.TConfig.isLocked(this.m_data),i=1==this.m_type&&!a&&t<this.m_data.MAXLV,n=0==this.m_type?"skill/":"attr/",r=gConfig.getOccThalentPath(n+this.m_data.ICON);if(app.loadTexture(r,this.p_sprIcon,this.prefabPath),this.p_labName.string=this.m_data.NAME,1==this.m_type&&(this.p_labName.string+=" "+t+"/"+this.m_data.MAXLV),0==this.m_type)this.m_arrDes.forEach(function(e){e.active=!1}),this.p_nodeSkillItem.active=!0,this.p_nodeSkillItem.getComponent(cc.Label).string=this.m_data.DES,this.p_nodeSkillItem.color=a?this.p_LabelColor:this.p_greenLabelColor,this.p_nodeSkillItem.getComponent(cc.LabelOutline).color=a?this.p_LabelOutlineColor:this.p_greenLabelOutlineColor;else{this.p_nodeSkillItem.active=!1;for(var o=0;o<this.m_data.ATTRS.length;o++){var s=this.m_data.ATTRS[o];(l=this.m_arrDes[o])||((l=cc.instantiate(this.p_nodeProperyItem)).parent=this.p_nodeContent,this.m_arrDes.push(l)),l.active=!0;var p=s.NUM+s.GROWNUM*(t-1),c=app.db.dbProperty[s.ID].EN;l.getComponent("propertyItem").refreshUI({KEY:c,VAL:p}),l.getComponentsInChildren(cc.Label).forEach(function(i){i.node.color=!a&&t>=e.m_data.MAXLV?e.p_greenLabelColor:e.p_LabelColor}),l.getComponentsInChildren(cc.LabelOutline).forEach(function(i){i.color=!a&&t>=e.m_data.MAXLV?e.p_greenLabelOutlineColor:e.p_LabelOutlineColor})}for(;o<this.m_arrDes.length;o++)this.m_arrDes[o].active=!1}this.p_btnUp.node.active=i,this.p_labCount.node.parent.active=i,this.p_labCount.string=app.player.getCount(38020)+"/"+this.m_data.COST;var h=1==this.m_type&&t<this.m_data.MAXLV;if(this.p_nodeProperyUp.active=h,h){for(o=0;o<this.m_data.ATTRS.length;o++){var l;s=this.m_data.ATTRS[o],(l=this.m_arrUpDes[o])||((l=cc.instantiate(this.p_nodeProperyItem)).parent=this.p_nodeUpContent,this.m_arrUpDes.push(l)),l.active=!0,p=s.NUM+s.GROWNUM*t,c=app.db.dbProperty[s.ID].EN,l.getComponent("propertyItem").refreshUI({KEY:c,VAL:p}),l.getComponentsInChildren(cc.Label).forEach(function(t){t.node.color=e.p_greenLabelColor}),l.getComponentsInChildren(cc.LabelOutline).forEach(function(t){t.color=e.p_greenLabelOutlineColor})}for(;o<this.m_arrUpDes.length;o++)this.m_arrUpDes[o].active=!1}if(this.p_labFullScale.node.active=!a&&t>=this.m_data.MAXLV,this.p_labActive.node.active=!a&&0==this.m_type,this.p_labFullScale.string=langMgr.getString("windowspageoccthalent",this.m_type+5),this.p_labLevelLimit.node.active=a,a){var g=[];g.push(this.m_data.LIMIT.toString()),g.push(app.pages.occthalentpage.instance.TConfig.getTotalUseThalentScore(this.m_data.OCC)+"/"+this.m_data.LIMIT),this.p_labLevelLimit.string=langMgr.getString("windowspageoccthalent",this.m_data.OCC-1,g)}},t.prototype.animPower=function(){},t.prefabPath="windowspageoccthalent",t.pageType=1,n([s(cc.Sprite)],t.prototype,"p_sprIcon",void 0),n([s(cc.Label)],t.prototype,"p_labName",void 0),n([s(cc.Label)],t.prototype,"p_labDes",void 0),n([s(cc.Label)],t.prototype,"p_labFullScale",void 0),n([s(cc.Label)],t.prototype,"p_labActive",void 0),n([s(cc.Label)],t.prototype,"p_labLevelLimit",void 0),n([s(cc.Button)],t.prototype,"p_btnUp",void 0),n([s(cc.Label)],t.prototype,"p_labCount",void 0),n([s(cc.Node)],t.prototype,"p_nodeProperyItem",void 0),n([s(cc.Node)],t.prototype,"p_nodeSkillItem",void 0),n([s(cc.Node)],t.prototype,"p_nodeContent",void 0),n([s(cc.Node)],t.prototype,"p_nodeUpContent",void 0),n([s(cc.Color)],t.prototype,"p_greenLabelColor",void 0),n([s(cc.Color)],t.prototype,"p_greenLabelOutlineColor",void 0),n([s(cc.Color)],t.prototype,"p_LabelColor",void 0),n([s(cc.Color)],t.prototype,"p_LabelOutlineColor",void 0),n([s(cc.Node)],t.prototype,"p_nodeProperyUp",void 0),n([s(cc.Animation)],t.prototype,"p_animNode",void 0),n([s(cc.Animation)],t.prototype,"p_animPower_01",void 0),n([s(cc.Animation)],t.prototype,"p_animPower_02",void 0),n([s(cc.Animation)],t.prototype,"p_animPower_03",void 0),n([s(cc.Node)],t.prototype,"p_nodePowerNum",void 0),a=n([o],t)}(e("basePage"));t.exports=p,cc._RF.pop()},{basePage:void 0}],windowsPageOfficeRaised:[function(e,t){"use strict";cc._RF.push(t,"faa56CGrmhFG4fxS9GvhyBM","windowsPageOfficeRaised");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=e("../lang/langMgr"),o=cc._decorator,s=o.ccclass,p=o.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_sprOfficeIcon=null,t.p_labPlayerName=null,t.p_sprOfficeName=null,t.p_labYear=null,t.call=null,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this},t.prototype.start=function(){this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},t.prototype.setParam=function(e){e&&(this.call=e.call),this.refreshUI()},t.prototype.refreshUI=function(){var e=this,t=app.player.getCount(38004),a=window.gConfig.getOfficialIconPath(t);a?app.loadTexture(a,this.p_sprOfficeIcon,this.prefabPath,function(){e.p_sprOfficeIcon.node.active=!0}):this.p_sprOfficeIcon.node.active=!1;var i=window.gConfig.getOfficialNamePath(t);i?app.loadTexture(i,this.p_sprOfficeName,this.prefabPath,function(){e.p_sprOfficeName.node.active=!0}):this.p_sprOfficeName.node.active=!1,this.p_labPlayerName.string=app.player.rname;var n=app.seasonData.info,o=200+n.year+r.getString("windowsPageOfficeRaised",0);switch(n.season){case 1:o+=r.getString("windowsPageOfficeRaised",1);break;case 2:o+=r.getString("windowsPageOfficeRaised",2);break;case 3:o+=r.getString("windowsPageOfficeRaised",3);break;case 4:o+=r.getString("windowsPageOfficeRaised",4)}this.p_labYear.string=o},t.prototype.onClose=function(){e.prototype.onClose.call(this),this.call&&this.call()},t.prefabPath="windowsPageOfficeRaised",t.pageType=1,n([p(cc.Sprite)],t.prototype,"p_sprOfficeIcon",void 0),n([p(cc.Label)],t.prototype,"p_labPlayerName",void 0),n([p(cc.Sprite)],t.prototype,"p_sprOfficeName",void 0),n([p(cc.Label)],t.prototype,"p_labYear",void 0),a=n([s],t)}(e("basePage"));t.exports=c,cc._RF.pop()},{"../lang/langMgr":void 0,basePage:void 0}],windowsPageOfficeReward:[function(e,t){"use strict";cc._RF.push(t,"06a7ew9gVBNX4s9CUGksqTI","windowsPageOfficeReward");var a=e("dbProperty"),i=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspageofficereward"},properties:{p_arrLabAttrName:[cc.Label],p_arrLabAttr:[cc.Label],p_sprIcon:cc.Sprite,p_sprName:cc.Sprite,p_btnLeft:cc.Button,p_btnRight:cc.Button,p_nodeLayout:cc.Node,p_pfbRewardItem:cc.Prefab,p_btnSalary:cc.Button,p_labSalaryTimer:cc.Label,p_sprBtnSalary:cc.Sprite,p_arrSfBtnSalary:[cc.SpriteFrame]},onLoad:function(){i.instance=this,this.m_arrIconReward=[],this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.schedule(this.refreshBtnSalary,1)},handleUI:function(){var e=this;this._super(),this.p_btnLeft.node.on("click",function(){app.playSound("click"),e.onClickBtnLeft()}),this.p_btnRight.node.on("click",function(){app.playSound("click"),e.onClickBtnRight()}),this.p_btnSalary.node.on("click",function(){app.playSound("click"),e.onClickBtnSalary()})},setParam:function(e){this.m_target=e,this.showLevel=app.player.getCount(38004),this.showLevel||(this.showLevel=1),this.refreshUI()},refreshUI:function(){var e,t=this,i=this.showLevel;this.p_btnLeft.node.active=1!==this.showLevel,this.p_btnRight.node.active=this.showLevel!==app.db.dbOfficialItems.length,e=app.db.dbOfficialItems[i].ATTR;for(var n=0;n<e.length;++n){var r=e[n],o=r.VAL;this.p_arrLabAttrName[n].string=a[r.KEY].NAME,2==app.db.dbProperty[r.KEY].NUMTYPE&&(o=o/10+"%"),this.p_arrLabAttr[n].string="+"+o}var s=gConfig.getOfficialIconPath(i);s?app.loadTexture(s,this.p_sprIcon,this.prefabPath,function(){t.p_sprIcon.node.active=!0}):this.p_sprIcon.node.active=!1;var p=gConfig.getOfficialNamePath(i);p?app.loadTexture(p,this.p_sprName,this.prefabPath,function(){t.p_sprName.node.active=!0}):this.p_sprName.node.active=!1;for(var c=app.db.dbOfficialItems[i].SALARY,h=0;h<c.length;++h){var l=this.m_arrIconReward[h];l||((l=cc.instantiate(this.p_pfbRewardItem)).parent=this.p_nodeLayout,this.m_arrIconReward.push(l)),l.active=!0,l.getComponent("propItem").initForBag(c[h]),l.getComponent("propItem").setClick(!0)}for(var g=c.length;g<this.m_arrIconReward.length;++g)this.m_arrIconReward[g].active=!1;this.refreshBtnSalary()},refreshBtnSalary:function(){var e=app.player.getCount(90162),t=app.player.getCount(38004),a=t==this.showLevel,i=!!t,n=!(e>0),r=a&&i&&!n;if(this.p_btnSalary.node.active=a&&i,this.p_btnSalary.interactable=n,this.p_sprBtnSalary.spriteFrame=n?this.p_arrSfBtnSalary[0]:this.p_arrSfBtnSalary[1],this.p_labSalaryTimer.node.active=r,r)if(this.m_signTime){var o=this.m_signTime-app.player.getServerTime();!o<0?this.updateOther():(o/=1e3,this.p_labSalaryTimer.string=gUtils.getHourMinSecTime(o))}else this.m_signTime=gUtils.getSecondDayTime(app.player.getServerTime())},updateOther:function(){var e=this;app.player.sfPlayerByParam(["others"],function(){e.m_signTime=gUtils.getSecondDayTime(app.player.getServerTime()),e.refreshBtnSalary()})},onClickBtnLeft:function(){this.showLevel--,this.refreshUI()},onClickBtnRight:function(){this.showLevel++,this.refreshUI()},onClickBtnSalary:function(){this.m_target.onSalary(),this.onClose()}});cc._RF.pop()},{basePage:void 0,dbProperty:void 0}],windowsPageOfficeUp:[function(e,t){"use strict";cc._RF.push(t,"10d735AyzhEL69f/fJhsPbF","windowsPageOfficeUp");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspageofficeup",pageType:1},properties:{p_sprIcon:[cc.Sprite],p_sprName:[cc.Sprite],p_arrNodeAttr:[cc.Node],p_lockOffice:[cc.Sprite],p_spLvUp:sp.Skeleton,p_nodeBg:[cc.Node],p_nodeOffice:cc.Node},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){this._super()},start:function(){var e=this;app.loadSpine("game_ui_spine/level_up/shengji",this.p_spLvUp,function(){cc.log("load succ"),e.p_spLvUp.setAnimation(0,"animation",!1)})},setParam:function(e){this.m_confirmCb=e.confirmcb,this.refreshUI()},refreshUI:function(){var e,t=this,a=app.player.getCount(38004),i=[],n=3,r=app.db.dbOfficialItems[a].PEOPLE;e=app.db.dbOfficialItems[a].ATTR,a-1>=0&&(i=app.db.dbOfficialItems[a-1].ATTR,n=app.db.dbOfficialItems[a-1].PEOPLE);for(var o=0;o<this.p_arrNodeAttr.length;++o){var s=e[o],p=i[o];if(s){var c=app.db.dbProperty[s.KEY].NAME,h=s.VAL,l=0;p&&(l=p.VAL),2==app.db.dbProperty[s.KEY].NUMTYPE&&(h=h/10+"%",l=l/10+"%"),this.p_arrNodeAttr[o].getComponent(cc.Label).string=c,this.p_arrNodeAttr[o].getChildByName("val").getComponent(cc.Label).string="+"+h,this.p_arrNodeAttr[o].getChildByName("tx").getComponent(cc.Label).string="+"+l}}this.p_arrNodeAttr[2].getComponent(cc.Label).string=langMgr.getString("windowsPageOfficeUp",0),this.p_arrNodeAttr[2].getChildByName("val").getComponent(cc.Label).string=r,this.p_arrNodeAttr[2].getChildByName("tx").getComponent(cc.Label).string=n;for(var g=function(e){var i=a-1+e,n=gConfig.getOfficialIconPath(i);n?app.loadTexture(n,t.p_sprIcon[e],t.prefabPath,function(){t.p_sprIcon[e].node.active=!0}):t.p_sprIcon[e].node.active=!1},d=0;d<2;d++)g(d);for(var u=function(e){var i=a-1+e,n=gConfig.getOfficialNamePath(i);n?app.loadTexture(n,t.p_sprName[e],t.prefabPath,function(){t.p_sprName[e].node.active=!0}):t.p_sprName.node.active=!1},f=0;f<2;f++)u(f);var m=app.db.dbGeneralOfficial,_=[];for(var v in m)m[v].UNLOCK_REQUIRE[38004]==a&&_.push(v);_.length<1?(this.p_nodeBg.forEach(function(e){e.height=680}),this.p_nodeOffice.active=!1):(this.p_nodeBg.forEach(function(e){e.height=720}),this.p_nodeOffice.active=!0,this.node.y=150);for(var b=function(e){var a=_[e];if(!a)return t.p_lockOffice[e].node.active=!1,"continue";var i=app.db.getOfficeNameTitlePathByPos(a);app.loadTexture(i,t.p_lockOffice[e],t.prefabPath,function(){t.p_lockOffice[e].node.active=!0})},y=0;y<this.p_lockOffice.length;y++)b(y)},onClose:function(){this._super(),this.m_confirmCb&&this.m_confirmCb()}});cc._RF.pop()},{basePage:void 0}],windowsPageOnline:[function(e,t){"use strict";cc._RF.push(t,"a1b9e9ARWhDQ6ryskcCLGpy","windowsPageOnline");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspageonline"},properties:{p_labTime:cc.Label,p_rewardItem:cc.Node,p_content:cc.Node},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){this._super(),this.refeshUI()},start:function(){},refeshUI:function(){}});cc._RF.pop()},{basePage:void 0}],windowsPagePlayerLvUp:[function(e,t){"use strict";cc._RF.push(t,"9a8a2FelyhK0ojljl/hJ40k","windowsPagePlayerLvUp");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspageplayerlvup",pageType:1},properties:{p_spTitle:sp.Skeleton,p_labNewLv:cc.Label,p_scrvUnlock:cc.ScrollView,p_nodeUnlock:cc.Node,p_nodeUnlockItem:cc.Node},onLoad:function(){var e=this;a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.p_spTitle.setCompleteListener(function(t){"ks"==t.animation.name&&(e.p_spTitle.setCompleteListener(null),e.p_spTitle.setAnimation(0,"xh",!0))})},handleUI:function(){this._super()},setParam:function(e){this.m_numOldLv=e,this.refreshUI(),this.playTitleAnim()},refreshUI:function(){this.p_labNewLv.string=app.player.level,this.refreshUnLock()},refreshUnLock:function(){var e=app.db.getUnLockInfoByLv(this.m_numOldLv);this.m_arrItems||(this.m_arrItems=[]);for(var t=0,a=e.arr.length>4?this.p_scrvUnlock.content:this.p_nodeUnlock,i=0;i<e.arr.length;++i){var n=e.arr[i];if(n.lock.SHOWUP&&app.db.checkChannelShow(n.lock.ID)){var r=this.m_arrItems[t];r||((r=cc.instantiate(this.p_nodeUnlockItem)).parent=a,this.m_arrItems.push(r)),r.active=!0,r.getComponent("lvupUnlockItem").refreshUI(n,this),++t}}},onClose:function(){cc.isValid(app.mainScene)&&(app.mainScene.refreshTopUI(),app.mainScene.refreshLeftButton(),app.pages.newworldmappage.instance&&app.pages.newworldmappage.instance.refreshLockBtn(),app.pages.newworldmappage.instance&&app.pages.newworldmappage.instance.refreshDramaBossIcon()),app.player.level>this.m_numOldLv&&(app.mainScene.popUp(),eventMgr.emit(eventStr.unlockNewFuncEvent.RefreshNewFunc)),app.pages.newworldmappage.instance&&cc.isValid(app.pages.newworldmappage.instance.node),this._super()},playTitleAnim:function(){this.p_spTitle.setAnimation(0,"ks",!1)}});cc._RF.pop()},{basePage:void 0}],windowsPagePlotBoss:[function(e,t){"use strict";cc._RF.push(t,"fad68aTIJNDm48HXJXuDYxU","windowsPagePlotBoss");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspageplotboss"},properties:{p_nodeZhanYi:cc.Node,p_nodeBoss:cc.Node,p_nodeMisson:cc.Node,p_nodeExchange:cc.Node,p_sprTitle:cc.Sprite,p_btnHelp:cc.Button,p_labTime:cc.Label,p_sprBg:cc.Sprite,p_btnLc:cc.Button,p_labLcTime:cc.Label,p_arrSprF:[cc.SpriteFrame],p_nodeRed:cc.Node},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.fitTopMenu(),this.creatMask(),this.m_menu=this.node.getComponent("menu"),this.m_menu.init(this)},handleUI:function(){var e=this;this._super(),this.p_btnHelp.node.on("click",function(){app.playSound("click"),app.pages.windowspagetipshelp.showPage("1083")}),this.p_btnLc.node.on("click",function(){app.playSound("click"),e.m_liangCao?app.pages.windowspageliangcao.showPage({data:e.m_liangCao,target:e,bossid:e.m_objData.boss.bossid}):app.showNotice(langMgr.getString("windowsPagePlotBoss",0))})},setParam:function(e){this.m_objData=e,this.m_eTime=e.etime,this.m_menu.p_arrBtnMenu[0].active=!!this.m_objData.boss,this.m_menu.p_arrBtnMenu[1].active=!!this.m_objData.exchange,this.m_menu.p_arrBtnMenu[2].active=!!this.m_objData.task,this.refreshUI();for(var t=0;t<this.m_menu.p_arrBtnMenu.length;t++)if(this.m_menu.p_arrBtnMenu[t].active){this.m_menu.setMenuIndex(t);break}this.checkIsShow(),this.schedule(this.checkIsShow,1)},refreshUI:function(){var e=app.db.getDramaEventInfo(this.m_objData.boss.bossid),t=gConfig.getBattleTitleIcon(e.ICON);app.loadTexture(t,this.p_sprTitle,this.prefabPath);var a="game_ui/04_page/battle_map_zhanyi/"+e.BG;app.loadTexture(a,this.p_sprBg,this.prefabPath),this.setLiangcao(),this.m_menu.refreshRed()},setLiangcao:function(){var e=this.m_objData.liang;this.m_liangCao=null;for(var t=0;t<e.length;t++)if(1!=e[t].status){this.m_liangCao=e[t];break}this.unschedule(this.checkIsShow),this.refreshLcTime(),this.schedule(this.refreshLcTime,1)},refreshLcTime:function(){if(!this.m_liangCao)return this.p_labLcTime.string=langMgr.getString("windowsPagePlotBoss",1),void(this.p_nodeRed.active=!1);var e=(this.m_liangCao.etime-app.player.getServerTime())/1e3;if(this.p_nodeRed.active=!1,e<=0)return this.p_labLcTime.string=langMgr.getString("windowsPagePlotBoss",2),void(this.m_liangCao.status||(this.p_nodeRed.active=!0));var t,a=gUtils.getDayHourMinSecStruct(e);t=a.d>0?a.d+langMgr.getString("windowsPagePlotBoss",3)+(a.h>0?a.h+langMgr.getString("windowsPagePlotBoss",4):"")+(a.m>0?a.m+langMgr.getString("windowsPagePlotBoss",5):""):(a.h>0?a.h+langMgr.getString("windowsPagePlotBoss",4):"")+(a.m>0?a.m+langMgr.getString("windowsPagePlotBoss",5):"")+a.s+langMgr.getString("windowsPagePlotBoss",6),this.p_labLcTime.string=t},menuHandler:function(e){switch(this.m_numIndex=e,e){case 0:this.m_objData.boss.subindex>=this.m_objData.boss.bossindex&&this.m_objData.boss.bossindex>0?(this.p_nodeZhanYi.active=!1,this.p_nodeBoss.getComponent("windowsPageZhanYiBoss").refreshUI(this.m_objData,this),this.p_nodeBoss.active=!0,this.p_nodeMisson.active=!1,this.p_nodeExchange.active=!1,this.p_sprBg.node.active=!1,this.p_btnLc.node.active=this.m_liangCao):(this.p_nodeZhanYi.active=!0,this.p_nodeZhanYi.getComponent("windowsPageZhanYi").refreshUI(this.m_objData,this),this.p_nodeBoss.active=!1,this.p_nodeMisson.active=!1,this.p_nodeExchange.active=!1,this.p_sprBg.node.active=!0,this.p_btnLc.node.active=this.m_liangCao);break;case 1:this.p_nodeZhanYi.active=!1,this.p_nodeBoss.active=!1,this.p_nodeMisson.active=!1,this.p_nodeExchange.active=!0,this.p_sprBg.node.active=!1,this.p_btnLc.node.active=!1,this.p_nodeExchange.getComponent("windowsPageZhanYiExchange").refreshUI(this.m_objData,this);break;case 2:this.p_nodeZhanYi.active=!1,this.p_nodeBoss.active=!1,this.p_nodeMisson.active=!0,this.p_nodeExchange.active=!1,this.p_sprBg.node.active=!1,this.p_btnLc.node.active=!1,this.p_nodeMisson.getComponent("windowsPageZhanYiMission").refreshUI(this.m_objData,this)}},checkIsShow:function(){if((this.m_eTime-app.player.getServerTime())/1e3<=0)return this.node.active=!1,void this.unschedule(this.checkIsShow)},afterBattleFresh:function(){var e=this;switch(app.battleOverType){case"dramaboss":app.player.sfDramaBossList(function(t){for(var a,i=0;i<t.eventlist.length;i++)t.eventlist[i].boss.bossid==e.m_objData.boss.bossid&&(a=t.eventlist[i]);if(app.pages.dramabosslistpage.instance&&app.pages.dramabosslistpage.instance.refreshData(t.eventlist),e.m_objData=a,e.m_objData.boss.bossindex!=e.m_objData.boss.subindex||e.p_nodeBoss.active)e.m_menu.setMenuIndex(e.m_numIndex);else{var n=app.db.getDramaEventInfo(e.m_objData.boss.bossid);app.pages.windowspagetalk.showPage({result:function(){var t={obj:e.m_objData,confirmcb:function(){e.m_menu.setMenuIndex(e.m_numIndex)},target:e};app.pages.windowspagebosstalk.showPage(t)},talk:[{text:n.BOSSTALK}]})}})}},onClose:function(){app.pages.dramabosslistpage.instance&&cc.isValid(app.pages.dramabosslistpage.instance.node)&&app.pages.dramabosslistpage.instance.resetGetList(),this._super()},refreshMenuRed:function(e){var t=!1;return 0==e&&(t=this.checkLiangRed()),1==e&&(t=!1),2==e&&(t=this.checkMissionRed()),t},checkLiangRed:function(){var e=this.m_objData.liang;if(!e)return!1;for(var t=0;t<e.length;t++){var a=e[t];if((a.etime-app.player.getServerTime())/1e3<=0&&!a.status)return!0}return!1},checkMissionRed:function(){var e=this.m_objData.task;if(!e)return!1;for(var t=0;t<e.length;t++)if(e[t].process>=e[t].require&&!e[t].status)return!0;var a=this.m_objData.taskscore[0];return a.process>=a.num&&!a.status},checkExchageRed:function(){return!1}});cc._RF.pop()},{basePage:void 0}],windowsPagePower:[function(e,t){"use strict";cc._RF.push(t,"e9afdt4OSxMUYyZtQSiI4HT","windowsPagePower"),cc.Class({extends:cc.Component,properties:{p_richContent:cc.RichText},onLoad:function(){},init:function(e,t){var a=this;this.p_richContent.string=e;var i=NOTICE_COLOR[t]||NOTICE_COLOR.normal;this.p_richContent.node.color=i,this.node.stopAllActions(),this.node.active=!0,this.node.opacity=255,"scenes_main"==cc.director.getScene()._name?(this.node.parent=app.mainScene.node,this.node.x=0,this.node.y=cc.winSize.height/2*.5):(this.node.parent=cc.director.getScene(),this.node.x=.5*cc.winSize.width,this.node.y=.75*cc.winSize.height),this.node.zIndex=500,cc.sequence(cc.delayTime(2),cc.fadeOut(1),cc.callFunc(function(){a.node.active=!1}));var n=cc.sequence(cc.moveBy(.8,0,60),cc.fadeOut(.5),cc.callFunc(function(){a.node.active=!1}));this.node.runAction(n)}}),cc._RF.pop()},{}],windowsPagePreview:[function(e,t){"use strict";cc._RF.push(t,"a2f63iK/BZFk56lrdb+8nqj","windowsPagePreview");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagepreview",pageType:1},properties:{p_labIntro:cc.Label,p_tabvProp:cc.tableView,p_btnCancel:cc.Button,p_btnConfirm:cc.Button},onLoad:function(){a.instance=this,this.handleUI(),this.stopBgNodeEvent(),this.creatMask(!0)},handleUI:function(){var e=this;this._super(),this.p_btnConfirm.node.on("click",function(){app.playSound("click"),e.m_confirmCb&&e.m_confirmCb.apply(e.m_target,e.m_confirmParm),e.onClose()}),this.p_btnCancel.node.on("click",function(){app.playSound("cancel"),e.m_cancelCb&&e.m_cancelCb.apply(e.m_target,e.m_cancelParm),e.onClose()})},setParam:function(e){this.m_objData=e,this.m_numType=e.type,this.m_confirmCb=e.confirmcb,this.m_confirmParm=e.confirmparm,this.m_cancelCb=e.cancelcb,this.m_cancelParm=e.cancelparm,this.m_target=e.target,this.refreshUI()},refreshUI:function(){this.p_labIntro.string=this.m_objData.content||langMgr.getString("windowsPagePreview",0),this.p_btnCancel.node.active=!(this.m_numType&&1==this.m_numType),this.refreshView()},refreshView:function(){var e=this.m_objData.props||[],t=e.length;this.p_tabvProp.getComponent("tableView").initTableView(t,{array:e,target:this})}});cc._RF.pop()},{basePage:void 0}],windowsPageProperty:[function(e,t){"use strict";cc._RF.push(t,"0d8c9R6MWhDtYbV9JhBbQEv","windowsPageProperty");var a=["hp","atk","def","mdef"];cc.Class({extends:cc.Component,properties:{p_nodeBg:cc.Node,p_nodePropertyItem:cc.Node},onLoad:function(){},init:function(e,t){var i=this;cc.log("new prop is ",e),cc.log("old prop is ",t),this.m_arrItem||(this.m_arrItem=[],this.m_arrItem.push(this.p_nodePropertyItem));for(var n=0;n<a.length;++n){if(!this.m_arrItem[n]){var r=cc.instantiate(this.p_nodePropertyItem);r.parent=this.p_nodeBg,this.m_arrItem.push(r)}var o=a[n],s=e[o]-t[o];this.m_arrItem[n].active=!0,this.m_arrItem[n].getComponent(cc.Label).string=app.db.getPropertyCnByEn(o)+"+"+s}for(var p=a.length;p<this.m_arrItem.length;++p)this.m_arrItem[p].active=!1;this.node.stopAllActions(),this.node.active=!0,this.node.opacity=255,this.node.parent=cc.director.getScene(),this.node.x=.5*cc.winSize.width-150,this.node.y=.6*cc.winSize.height,this.node.zIndex=500;var c=cc.sequence(cc.moveBy(.25,150,0),cc.fadeOut(1),cc.callFunc(function(){i.node.active=!1}));this.node.runAction(c)}}),cc._RF.pop()},{}],windowsPageQuickReward:[function(e,t){"use strict";cc._RF.push(t,"9d10b6TDllL6JiN86f3H7F+","windowsPageQuickReward");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagequickreward",pageType:1,createShot:!0},properties:{p_labTime:cc.Label,p_labCount:cc.Label,p_freeNode:cc.Node,p_btnConfirm:cc.Button,p_costNode:cc.Node,p_sprCostIcon:cc.Sprite,p_sprZhengshou:cc.Sprite,p_labCost:cc.Label,p_labNextVip:cc.Label},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.creatMask(!0),this.schedule(this.refreshTime,1)},handleUI:function(){var e=this;this._super(),this.p_btnConfirm.node.on("click",function(){app.playSound("click");for(var t=app.player.getCount(90165),a=app.db.getQuickRewardCost(t),i="",n=0;n<a.length;++n)if(a[n].GSID){var r=a[n].COUNT;app.player.getCount(a[n].GSID)<r&&(i+="\u3010"+app.db.getPropsName(a[n].GSID)+"\u3011")}i&&""!=i?app.showNotice(langMgr.getString("windowsPageQuickReward",0,i)):app.player.sfChapterReapQuick(2,function(t,a){t?app.showNotice(t):app.player.sfPlayerData(function(){app.pages.newworldmappage.instance.refreshHangTime(),app.db.getVipQuickRewardCount(app.player.vip),e.refreshUI();var t={showtype:1,reward:a.items,target:e};app.pages.windowspagereward.showPage(t),eventMgr.emit(eventStr.redEvent.RefreshNewWorldRed)})})})},setParam:function(){this.refreshUI(),this.m_rawLv=app.player.level},refreshUI:function(){var e=app.db.getVipQuickRewardCount(app.player.vip);this.p_labCount.string=e;var t=app.player.getCount(90165),a=app.db.getQuickRewardCost(t),i=a[0]?a[0].COUNT:0;if(this.p_labCost.string=i,e>0?(this.p_freeNode.active=!(i>0),this.p_costNode.active=i>0):(this.p_freeNode.active=!1,this.p_costNode.active=!0),this.p_labCost.node.active=e>0,this.p_sprCostIcon.node.active=e>0,a[0]&&e>0){var n=app.db.getPropsIconPath(a[0].GSID);app.loadTexture(n,this.p_sprCostIcon,this.prefabPath)}if(this.p_sprZhengshou.node.position=e>0?cc.v2(27,0):cc.v2(0,0),this.p_btnConfirm.interactable=e>0,app.setSpriteState(this.p_sprZhengshou,e<=0),app.setSpriteState(this.p_btnConfirm.getComponent(cc.Sprite),e<=0),this.p_labNextVip.node.active=!1,e<=0){var r=this.getNextVip();r&&(this.p_labNextVip.node.active=!0,this.p_labNextVip.string=langMgr.getString("windowsPageQuickReward",1,r))}this.m_numOldLv=app.player.level,this.refreshTime()},getNextVip:function(){for(var e=app.player.vip+1;e<16;e++)if(app.db.getVipQuickRewardCount(e)>0)return e;return 0},refreshTime:function(){var e=gUtils.getSecondDayTime(app.player.getServerTime())-app.player.getServerTime();this.p_labTime.string=e<0?"00:00:00":gUtils.getCountDownStr(e)},onClose:function(){this._super(),cc.log(app.player.level,this.m_numOldLv),app.player.level>this.m_numOldLv&&app.mainScene.popUp(),this.m_rawLv<app.player.level&&app.pages.windowspageplayerlvup.showPage(this.m_rawLv)}});cc._RF.pop()},{basePage:void 0}],windowsPageQxlb:[function(e,t){"use strict";cc._RF.push(t,"464fapMGp1P84WTuRAtJ5Cq","windowsPageQxlb");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspageqxlb"},properties:{p_sprBg:cc.Sprite,p_arrGeneral:[cc.Node],p_nodeUp:cc.Node,p_nodeDown:cc.Node,p_arrAnimPick:[cc.Animation],p_btnConfirm:cc.Button},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},start:function(){},handleUI:function(){var e=this;this._super(),this.p_arrGeneral.forEach(function(t,a){t.on("touchend",function(){e.setPick(a)})}),this.p_btnConfirm.node.on("click",function(){app.playSound("click"),e.onConfirm()})},setParam:function(e){this._arrData=e.objData,this._bg=e.bg,this._num=e.num,this._target=e.target,this._funCb=e.cb,this.refreshView()},refreshView:function(){var e=this;this.p_sprBg.node.active=!1;var t=gConfig.getCBoxBgPath(this._bg);app.loadTexture(t,this.p_sprBg,this.prefabPath,function(){e.p_sprBg.node.active=!0}),cc.log(this._arrData),this._arrData.forEach(function(t,a){e.p_arrGeneral[a].getComponent("propItem").initForBag(t),e.p_arrGeneral[a].active=!0});for(var a=this._arrData.length;a<this.p_arrGeneral.length;++a)this.p_arrGeneral[a].active=!1;this.p_arrAnimPick.forEach(function(t,a){app.loadEff("prop_light_01",t,2,1.2,1.2,15,function(){0==a?e.setPick(0):t.node.active=!1})})},setPick:function(e){this._pickIndex=e,this.p_arrAnimPick.forEach(function(t,a){t.node.active=e==a})},onConfirm:function(){var e=this;app.player.sfExchange(this._arrData[this._pickIndex].EXID,this._num,null,function(t){app.player.sfPlayerData(function(){e.onClose(),e._funCb&&e._funCb.call(e._target);var a={showtype:1,reward:t,target:e};app.pages.windowspagereward.showPage(a)})})},onClose:function(){this._super()}});cc._RF.pop()},{basePage:void 0}],windowsPageRechargeBounty:[function(e,t){"use strict";cc._RF.push(t,"db52c8sCpFOBaFZqO0Spnbe","windowsPageRechargeBounty");var a=["gx","yq"],i=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagerechargebounty",pageType:1},properties:{p_arrGetRewards:[cc.Node],p_arrunGetRewards:[cc.Node],p_nodeNum:cc.Node,p_btnBuy:cc.Button},onLoad:function(){i.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.creatMask(!0)},handleUI:function(){var e=this;this._super(),this.p_btnBuy.node.on("click",function(){app.playSound("click"),e.onClickBuy()})},setParam:function(e){this.m_data=e.array,this.m_type=e.type||0,this.GetRewards=this.setRewards(!0),this.unGetRewards=this.setRewards(!1),this.refreshUI()},setRewards:function(e){void 0===e&&(e=!1);for(var t={},i=0;i<this.m_data.length;i++){var n=this.m_data[i];if(!(e&&app.player[a[this.m_type]]<n.SCORE))for(var r=0;r<n.ITEMS.S.length;++r){var o=n.ITEMS.S[r];t[o.GSID]?t[o.GSID]+=o.COUNT:t[o.GSID]=o.COUNT}}var s=[];for(var p in t)s.push({GSID:p,COUNT:t[p]});return s},refreshUI:function(){var e=this;this.p_arrGetRewards.forEach(function(t,a){var i=e.GetRewards[a];i?(t.active=!0,t.getComponent("propItem").initForBag(i),t.getComponent("propItem").setClick(!0)):t.active=!1}),this.p_arrunGetRewards.forEach(function(t,a){var i=e.unGetRewards[a];i?(t.active=!0,t.getComponent("propItem").initForBag(i),t.getComponent("propItem").setClick(!0)):t.active=!1}),this.p_nodeNum.getComponent("price_num_item").init(128,1,2)},onClickBuy:function(){var e=this;1==this.m_type?app.player.payRewardMazeCup(128,function(){app.player.sfPlayerData(function(){app.pages.expeditionbountypage.instance.refreshData(),e.onClose(),app.showNotice(langMgr.getString("windowsPageRechargeBounty",0)),cc.log("\u8d2d\u4e70\u6210\u529f")})},function(){cc.log("\u8d2d\u4e70\u5931\u8d25")}):app.player.payRewardCup(128,function(){app.player.sfPlayerData(function(){app.pages.rechargebountypage.instance.refreshData(),e.onClose(),app.showNotice(langMgr.getString("windowsPageRechargeBounty",0)),cc.log("\u8d2d\u4e70\u6210\u529f")})},function(){cc.log("\u8d2d\u4e70\u5931\u8d25")})}});cc._RF.pop()},{basePage:void 0}],windowsPageRechargeBuy:[function(e,t){"use strict";cc._RF.push(t,"11e65L2VVhAz6yu5Sz+Aokh","windowsPageRechargeBuy");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagerechargebuy",pageType:1},properties:{p_labTitle:cc.Label,p_labLimitNum:cc.Label,p_arrReward:[cc.Node],p_btnCancel:cc.Button,p_btnBuy:cc.Button,p_propPrefab:cc.Prefab},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.creatMask(!0),this.p_arrRewardItems=[]},handleUI:function(){var e=this;this._super(),this.p_btnBuy.node.on("click",function(){app.playSound("click"),e.onClose(),e.m_buyCb&&e.m_buyCb.apply(e.m_target,e.m_buyParm)}),this.p_btnCancel.node.on("click",function(){app.playSound("cancel"),e.onClose(),e.m_cancelCb&&e.m_cancelCb.call(e.m_target)})},setParam:function(e){this.m_objData=e,this.m_buyCb=e.buycb,this.m_buyParm=e.buyparm,this.m_cancelCb=e.cancelcb,this.m_target=e.target,this.m_close=e.close,this.refreshUI()},refreshUI:function(){this.p_labTitle&&(this.p_labTitle.string=this.m_objData.title||""),this.p_labLimitNum&&(this.p_labLimitNum.string=langMgr.getString("windowsPageRechargeBuy",0,this.m_objData.limitNum)||"",this.p_labLimitNum.node.active=this.m_objData.limitNum>0);for(var e=0;e<4;e++){var t=this.m_objData.rewards?this.m_objData.rewards[e]:null,a=this.p_arrRewardItems[e];a||((a=cc.instantiate(this.p_propPrefab)).parent=this.p_bgNode.getChildByName("layOut"),this.p_arrRewardItems.push(a)),t?(a.getComponent("propItem").initForBag(t),a.getComponent("propItem").setClick(!0),a.active=!0,cc.log(11111)):a.active=!1}},onClose:function(){this._super(),this.m_close&&this.m_close.call(this.m_target)}});cc._RF.pop()},{basePage:void 0}],windowsPageRechargeCZJJ:[function(e,t){"use strict";cc._RF.push(t,"1e299DcO0JIfb5wg9gXIxVK","windowsPageRechargeCZJJ");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagerechargeczjj",pageType:1},properties:{p_arrGetRewards:[cc.Node],p_nodeNum:cc.Node,p_btnBuy:cc.Button,p_propPrefab:cc.Prefab},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.creatMask(!0),this.p_arrRewardTop=[],this.p_arrRewardBottom=[]},handleUI:function(){var e=this;this._super(),this.p_btnBuy.node.on("click",function(){app.playSound("click"),e.onClickBuy()})},setParam:function(e){this.m_data=e.array,this.m_type=e.type||0,this.m_index=e.index,this.refreshUI()},refreshUI:function(){if(0==this.m_type){for(var e=0;e<1;++e){var t=this.p_arrRewardTop[e];t||((t=cc.instantiate(this.p_propPrefab)).parent=this.p_bgNode.getChildByName("layOut"),cc.log("thisi parent",this.p_bgNode.getChildByName("layOut")),this.p_arrRewardTop.push(t)),t.active=!0}for(var a=0;a<2;++a){var i=this.p_arrRewardBottom[a];i||((i=cc.instantiate(this.p_propPrefab)).parent=this.p_bgNode.getChildByName("layOut2"),this.p_arrRewardBottom.push(i)),i.active=!0}for(var n=0,r=0,o=0;o<this.m_data.length;o++)r+=this.m_data[o].YBNUM,app.player.level>=this.m_data[o].LEVEL&&(n+=this.m_data[o].YBNUM);var s="specialcz";this.m_index&&(s+=this.m_index);var p=app.db.dbRecharge[s].PRICE;this.p_arrRewardTop[0].getComponent("propItem").initForBag({gsid:38005,count:r}),this.p_arrRewardTop[0].getComponent("propItem").setClick(!0),this.p_arrRewardBottom[0].getComponent("propItem").initForBag({gsid:38003,count:10*p}),this.p_arrRewardBottom[0].getComponent("propItem").setClick(!0),this.p_arrRewardBottom[1].getComponent("propItem").initForBag({gsid:38005,count:n}),this.p_arrRewardBottom[1].getComponent("propItem").setClick(!0),this.p_nodeNum.getComponent("price_num_item").init(p,1,2)}else if(1==this.m_type){for(var c=0;c<2;++c){var h=this.p_arrRewardTop[c];h||((h=cc.instantiate(this.p_propPrefab)).parent=this.p_bgNode.getChildByName("layOut"),cc.log("thisi parent",this.p_bgNode.getChildByName("layOut")),this.p_arrRewardTop.push(h)),h.active=!0}for(var l=0;l<3;++l){var g=this.p_arrRewardBottom[l];g||((g=cc.instantiate(this.p_propPrefab)).parent=this.p_bgNode.getChildByName("layOut2"),this.p_arrRewardBottom.push(g)),g.active=!0}for(var d=0,u=0,f=0;f<this.m_data.length;f++)u+=this.m_data[f].COUNT0,app.player.tower-1>=this.m_data[f].TOWER&&(d+=this.m_data[f].COUNT0);var m="specialtower";this.m_index&&(m+=this.m_index);var _=app.db.dbRecharge[m].PRICE;this.p_arrRewardTop[0].getComponent("propItem").initForBag({gsid:this.m_data[0].GSID0,count:u}),this.p_arrRewardTop[0].getComponent("propItem").setClick(!0),this.p_arrRewardBottom[0].getComponent("propItem").initForBag({gsid:38003,count:10*_}),this.p_arrRewardBottom[0].getComponent("propItem").setClick(!0),this.p_arrRewardBottom[1].getComponent("propItem").initForBag({gsid:this.m_data[0].GSID0,count:d}),this.p_arrRewardBottom[1].getComponent("propItem").setClick(!0);for(var v=0,b=0,y=0;y<this.m_data.length;y++)this.m_data[y].COUNT1&&(b+=this.m_data[y].COUNT1,app.player.tower-1>=this.m_data[y].TOWER&&(v+=this.m_data[y].COUNT1));this.m_data[0].GSID1&&v>0?(this.p_arrRewardTop[1].getComponent("propItem").initForBag({gsid:this.m_data[0].GSID1,count:b}),this.p_arrRewardTop[1].getComponent("propItem").setClick(!0),this.p_arrRewardBottom[2].getComponent("propItem").initForBag({gsid:this.m_data[0].GSID1,count:v}),this.p_arrRewardBottom[2].getComponent("propItem").setClick(!0)):(this.p_arrRewardBottom[2].active=!1,this.p_arrRewardTop[1].active=!1),this.p_nodeNum.getComponent("price_num_item").init(_,1,2)}},onClickBuy:function(){0==this.m_type?(app.pages.rechargewelfarepageczjj.instance.onClickBtnBuy(this.m_index),this.onClose()):1==this.m_type&&(app.pages.rechargewelfarepagesljj.instance.onClickBtnBuy(this.m_index),this.onClose())}});cc._RF.pop()},{basePage:void 0}],windowsPageRechargeVip:[function(e,t){"use strict";function a(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(a)return(a=a.call(e)).next.bind(a);if(Array.isArray(e)||(a=i(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function i(e,t){if(e){if("string"==typeof e)return n(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?n(e,t):void 0}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,i=new Array(t);a<t;a++)i[a]=e[a];return i}cc._RF.push(t,"b8eb4qY6HNC1oQ8kyI8J3P8","windowsPageRechargeVip");var r=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagerechargevip",pageParent:"vipprivilegepage"},properties:{p_nodeAd:cc.Node,p_pfbAdItem:cc.Prefab,p_btnContentNode:cc.Node,p_scrvMenu:cc.ScrollView,p_nodeMenuItem:cc.Node,p_labVipTQ:cc.Label,p_nodeItemParent:cc.Node,p_pfbItem:cc.Prefab,p_btnGet:cc.Button,p_power:cc.Node,p_powerItem:cc.Node,p_nodeNo:cc.Node,p_nodeNoGet:cc.Node,p_redNotice:cc.Node,p_nodeParent:cc.Node,p_layNode:cc.Node,p_labTime:cc.Label,p_nodeShengyushijian:cc.Node,p_openNode:cc.Node,p_btnHelp:cc.Button},onLoad:function(){r.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.fitTopMenu(),this.p_arrPower=[],this.p_arrPower.push(this.p_powerItem)},handleUI:function(){var e=this;this._super(),this.p_btnGet.node.on("click",function(){app.playSound("click"),e.onClickBtnGet()}),this.p_openNode.on("click",function(){app.playSound("click"),app.goToPage(1036)}),this.setShowMaxVip(),this.refreshMenu(),this.p_btnContentNode.children.forEach(function(t,a){t.on("click",function(){e.selectMenu(a)})}),cc.isValid(this.p_btnHelp)&&this.p_btnHelp.node.on("click",function(){app.playSound("click"),window.app.pages.windowspagetipshelp.showPage("1091")},this)},setParam:function(e){this.selectMenu(app.player.vip),this._target=e,cc.isValid(this.p_btnHelp)&&(this.p_btnHelp.node.active=!1),this.refreshAd()},refreshAd:function(){this.m_nodeAdItem||(this.m_nodeAdItem=cc.instantiate(this.p_pfbAdItem),this.m_nodeAdItem.parent=this.p_nodeAd,this.m_nodeAdItem.setPosition(cc.v2(0,0))),this.m_nodeAdItem.getComponent("rechargePageAdVip").refreshUI()},setShowMaxVip:function(){var e=10;app.player.vip>=10&&app.player.vip<13?e=13:app.player.vip>=13&&(e=app.db.dbVip.length-1),this.m_showMaxLv=e},refreshMenu:function(){this.m_arrItemMenu||(this.m_arrItemMenu=[],this.m_arrItemMenu.push(this.p_nodeMenuItem));for(var e=0;e<this.m_showMaxLv+1;++e){var t=this.m_arrItemMenu[e];t||((t=cc.instantiate(this.p_nodeMenuItem)).parent=this.p_scrvMenu.content,this.m_arrItemMenu.push(t)),t.getComponent("vipMenuItem").init(e,this),t.active=!0}for(var a=this.m_showMaxLv+1;a<this.m_arrItemMenu.length;++a)this.m_arrItemMenu[a].active=!1},selectMenu:function(e){if(this.m_index||0==this.m_index){if(e==this.m_index)return;this.p_btnContentNode.children[this.m_index].getChildByName("frame_picked").active=!1}this.m_index=e,this.p_btnContentNode.children[this.m_index].getChildByName("frame_picked").active=!0;var t=app.db.dbVip[e];this.refreshInfo(e,t)},refreshInfo:function(e,t){var i=this;this.m_numPickVip=e,this.p_labVipTQ.string="VIP"+e;for(var n,r=app.db.getPowerByVip(e),o=!0,s=a(r);!(n=s()).done;)if(0!=n.value.num){o=!1;break}this.p_nodeNo.active=o;for(var p=0;p<r.length;p++){var c=r[p],h=this.p_arrPower[p];h||((h=cc.instantiate(this.p_powerItem)).parent=this.p_power,this.p_arrPower.push(h)),h.active=0!=c.num,h.getChildByName("num").getComponent(cc.Label).string=c.val,h.getChildByName("des").getComponent(cc.Label).string=c.title,h.getChildByName("des").color=gSetting.checkReviewServ()?cc.color("#efddb5"):cc.color("#824C12"),h.getChildByName("fang").active=!gSetting.checkReviewServ()}for(var l=r.length;l<this.p_arrPower.length;++l)this.p_arrPower[l].active=!1;app.player.getCount(t.MARK);var g=t.REWARD||[];this.p_arrPorpItems=this.p_arrPorpItems||[];for(var d=0;d<g.length;d++){var u=this.p_arrPorpItems[d];u||((u=cc.instantiate(this.p_pfbItem)).parent=this.p_nodeItemParent,u.scale=.9,this.p_arrPorpItems.push(u)),u.active=!0,u.getComponent("propItem").initForBag(g[d]),u.getComponent("propItem").setClick(!0)}for(var f=g.length;f<this.p_arrPorpItems.length;++f)this.p_arrPorpItems[f].active=!1;var m=app.player.getCount(t.MARK);this.p_nodeNoGet.active=e>app.player.vip,this.p_btnGet.node.active=e<=app.player.vip;var _=e<=app.player.vip&&m<=0;this.p_btnGet.interactable=_,app.setSpriteState(this.p_btnGet.getComponent(cc.Sprite),!_),this.p_arrPorpItems.forEach(function(e){m>0?(e.getComponent("propItem").setMask(!0),e.getComponent("propItem").setGetEnd(!0)):(e.getComponent("propItem").setMask(!1),e.getComponent("propItem").setGetEnd(!1))});var v=app.db.dbVip[e].BCARD||[];this.m_arrYkItems=this.m_arrYkItems||[],this.p_nodeParent.active=!gSetting.checkReviewServ()&&v.length>0;for(var b=app.player.special.specialzz,y=function(e){var t=i.m_arrYkItems[e];t||((t=cc.instantiate(i.p_pfbItem)).parent=i.p_layNode,i.m_arrYkItems.push(t)),t.active=!0,t.getComponent("propItem").initForBag(v[e],function(){t.getComponent("propItem").setNumScale(1.5)}),t.getComponent("propItem").setClick(!0)},P=0;P<v.length;P++)y(P);for(var w=v.length;w<this.m_arrYkItems.length;++w)this.m_arrYkItems[w].active=!1;b?(this.p_nodeShengyushijian.active=!0,this.p_labTime.node.active=!0,this.p_openNode.active=!1,this.p_labTime.string=langMgr.getString("windowsPageRechargeVip",0,b)):(this.p_nodeShengyushijian.active=!1,this.p_labTime.node.active=!1,this.p_openNode.active=!0),this.refreshBtnRed(e,t)},onClickBtnGet:function(){var e=this,t=app.db.dbVip[this.m_numPickVip];t.EXID&&(app.player.getCount(t.MARK)>0?app.showNotice(langMgr.getString("windowsPageRechargeVip",1)):app.player.sfExchange(t.EXID,1,0,function(i){for(var n,r=[],o=a(i);!(n=o()).done;){var s=n.value,p=s.gsid||s.GSID;"none"!=app.db.getTypeByGsid(p)&&r.push(s)}var c={showtype:1,reward:r,target:e};app.pages.windowspagereward.showPage(c),app.player.addItem([{gsid:t.MARK,count:1}]),e.refreshInfo(e.m_numPickVip,t),e._target.refreshCoinUI(),eventMgr.emit(eventStr.redEvent.RefreshVipPrivilegeRed)}))},refreshBtnRed:function(e,t){this.p_redNotice.active=0==app.player.getCount(t.MARK)&&e<=app.player.vip,this.p_btnContentNode.children.forEach(function(e,t){var a=!1;if(app.db.dbVip[t]&&app.player.vip>=t){var i=app.db.dbVip[t];if(!i.EXID)return;a=0==app.player.getCount(i.MARK)}e.getChildByName("rednotice").active=a})}});r.refreshRed=function(e){for(var t=!1,a=0;a<=app.player.vip;a++){var i=app.db.dbVip[a];if(i.EXID&&(t=0==app.player.getCount(i.MARK)))break}return e&&(e.active=t),t},cc._RF.pop()},{basePage:void 0}],windowsPageRecommendReward:[function(e,t){"use strict";cc._RF.push(t,"f76fcVLwtBC6KJg9anoA+fC","windowsPageRecommendReward");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagerecommendreward",pageType:1},properties:{p_rtxTime:cc.RichText,p_nodeReward:cc.Node},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.refreshTime(),this.schedule(this.refreshTime,1)},handleUI:function(){this._super()},setParam:function(){for(var e=app.db.dbRecommendReward,t=0;t<this.p_nodeReward.children.length;t++)e[t]?(this.p_nodeReward.children[t].active=!0,this.p_nodeReward.children[t].getComponent("propItem").initForBag(e[t]),this.p_nodeReward.children[t].getComponent("propItem").setClick(!0)):this.p_nodeReward.children[t].active=!1},refreshTime:function(){var e="";if(app.player.create+18e5-app.player.getServerTime()<=0){var t=new Date,a=23-t.getHours(),i=59-t.getMinutes(),n=59-t.getSeconds();a&&(e+=langMgr.getString("windowsPageRecommendReward",0,a)),i&&(e+=langMgr.getString("windowsPageRecommendReward",1,i)),n&&(e+=langMgr.getString("windowsPageRecommendReward",2,n))}else{var r=gUtils.getDayHourMinSecTime(app.player.create+18e5-app.player.getServerTime());r[1]&&(e+=langMgr.getString("windowsPageRecommendReward",0,r[1])),r[2]&&(e+=langMgr.getString("windowsPageRecommendReward",1,r[2])),r[3]&&(e+=langMgr.getString("windowsPageRecommendReward",2,r[3]))}this.p_rtxTime.string=langMgr.getString("windowsPageRecommendReward",3,e)}});cc._RF.pop()},{basePage:void 0}],windowsPageRecommendStronger:[function(e,t){"use strict";cc._RF.push(t,"f7a1eDvSzVH+qdOuIZK5UrP","windowsPageRecommendStronger");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=e("../lang/langMgr"),o=cc._decorator,s=o.ccclass,p=o.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_nodeRecommend=null,t.p_nodeGeneralList=null,t.p_nodeFetterContent=null,t.p_nodeFetterItem=null,t.p_sprIntro=null,t.p_nodeStronger=null,t.p_nodeStrongerContent=null,t.p_nodeStrongerItem=null,t.p_btnRecommend=null,t.p_recommendPicked=null,t.p_btnStronger=null,t.p_strongerPicked=null,t.p_nodeContent=null,t.p_nodeItem=null,t.p_labTx=null,t.m_arrFetterNode=[],t.m_arrSelectItemNode=[],t.m_arrStrongerNode=[],t.m_index=0,t.m_numIndex=0,t._fetters=null,t.m_arrStronger=[],t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0,1),this.handleUI(),this.fitTopMenu(),this.m_arrFetterNode.push(this.p_nodeFetterItem),this.m_arrSelectItemNode.push(this.p_nodeItem),this.m_arrStrongerNode.push(this.p_nodeStrongerItem)},t.prototype.start=function(){var e=this;this.p_btnRecommend.node.on("click",function(){app.playSound("click"),e.m_index=0,e.refreshUI(),e.onClickSelect(0)}),this.p_btnStronger.node.on("click",function(){app.playSound("click"),e.m_index=1,e.refreshUI(),e.onClickSelect(0)}),this.p_nodeFetterItem.on("touchend",function(){e.onClickFetter(e.p_nodeFetterItem)}),this.p_nodeItem.on("touchend",function(){e.onClickSelect(0)}),this.p_nodeStrongerItem.getChildByName("goto").on("click",function(){e.goToPage(0)})},t.prototype.setParam=function(e){this.m_index=e||0,this.setData(),this.refreshUI(),this.m_arrSelectItemNode[0].getChildByName("picked").active=!0},t.prototype.refreshUI=function(e){var t=this;if(void 0===e&&(e=0),this.node.getComponent("currency").refreshCoin([38005,38006]),this.p_recommendPicked.active=!this.m_index,this.p_strongerPicked.active=!!this.m_index,this.p_nodeRecommend.active=!this.m_index,this.p_nodeStronger.active=!!this.m_index,this.p_labTx.string=this.m_index?r.getString("windowsPageRecommendStronger",0):r.getString("windowsPageRecommendStronger",1),this.m_index){for(var a=function(e){var a=i.m_arrStronger[e],n=i.m_arrSelectItemNode[e];n||(n=cc.instantiate(i.p_nodeItem),i.m_arrSelectItemNode.push(n),n.parent=i.p_nodeContent,n.on("touchend",function(){t.onClickSelect(e)})),n.active=!0,n.getChildByName("name").getComponent(cc.Label).string=a.NAME,n.getChildByName("picked").getChildByName("name").getComponent(cc.Label).string=a.NAME},i=this,n=0;n<this.m_arrStronger.length;n++)a(n);for(n=this.m_arrStronger.length;n<this.m_arrSelectItemNode.length;n++)this.m_arrSelectItemNode[n].active=!1;this.refreshStronger(this.m_arrStronger[e].ARR)}else{var o=app.db.dbBattleRecommend,s=function(e){var a=o[e],i=p.m_arrSelectItemNode[e];i||(i=cc.instantiate(p.p_nodeItem),p.m_arrSelectItemNode.push(i),i.parent=p.p_nodeContent,i.on("touchend",function(){t.onClickSelect(e)})),i.active=!0,i.getChildByName("name").getComponent(cc.Label).string=a.NAME,i.getChildByName("picked").getChildByName("name").getComponent(cc.Label).string=a.NAME},p=this;for(n=0;n<o.length;n++)s(n);for(n=o.length;n<this.m_arrSelectItemNode.length;n++)this.m_arrSelectItemNode[n].active=!1;this.refreshRecommend(o[e])}},t.prototype.refreshRecommend=function(e){for(var t=this,a=0;a<this.p_nodeGeneralList.children.length;a++){var i=this.p_nodeGeneralList.children[a];e.GENERAL[a]?(i.active=!0,i.getComponent("recommendGeneralItem").refreshUI(e.GENERAL[a],this),0==a&&i.getComponent("recommendGeneralItem").setAnim()):i.active=!1}var n=gConfig.getZhenRongIconPath(e.PICID);n&&app.loadTexture(n,this.p_sprIntro,this.prefabPath),this._fetters=app.getFettersByGsidArr(e.GENERAL);var r=0,o=function(e){if(s._fetters[e].level){var a=s.m_arrFetterNode[r];a||(a=cc.instantiate(s.p_nodeFetterItem),s.m_arrFetterNode.push(a),a.parent=s.p_nodeFetterContent,a.on("touchend",function(){t.onClickFetter(a)})),a.active=!0;var i=void 0;s._fetters[e].camp?(a.camp=s._fetters[e].camp,a.occu=0,i=gConfig.getIconGCampPath(s._fetters[e].camp-1)):(a.occu=s._fetters[e].occu,a.camp=0,i=gConfig.getIconGOccuPath(s._fetters[e].occu-1)),app.loadTexture(i,a.getComponent(cc.Sprite),s.prefabPath),a.getChildByName("num").getComponent(cc.Label).string=s._fetters[e].num+"/"+s._fetters[e].need,r++}},s=this;for(a=0;a<this._fetters.length;a++)o(a);for(a=r;a<this.m_arrFetterNode.length;a++)this.m_arrFetterNode[a].active=!1},t.prototype.refreshStronger=function(e){for(var t=this,a=function(a){var n=e[a],o=i.m_arrStrongerNode[a];o||(o=cc.instantiate(i.p_nodeStrongerItem),i.m_arrStrongerNode.push(o),o.parent=i.p_nodeStrongerContent,o.getChildByName("goto").on("click",function(){t.goToPage(a)})),o.active=!0,o.getChildByName("title").getComponent(cc.Label).string=n.TITLE,n.LEVEL&&app.player.level<n.LEVEL?(o.getChildByName("unlock").active=!0,o.getChildByName("unlock").getComponent(cc.Label).string=r.getString("windowsPageRecommendStronger",2,n.LEVEL),o.getChildByName("goto").active=!1):(o.getChildByName("unlock").active=!1,o.getChildByName("goto").active=!!n.PAGEID)},i=this,n=0;n<e.length;n++)a(n);for(n=e.length;n<this.m_arrStrongerNode.length;n++)this.m_arrStrongerNode[n].active=!1},t.prototype.setData=function(){var e=app.db.dbStronger;for(var t in this.m_arrStronger=[],e){var a={ARR:null,NAME:""};a.ARR=e[t],a.NAME=t,this.m_arrStronger.push(a)}},t.prototype.onClickFetter=function(e){e.camp?app.pages.windowspagetipscamp.showPage({camp:e.camp}):app.pages.windowspagetipsoccu.showPage({occu:e.occu})},t.prototype.onClickSelect=function(e){if(this.m_numIndex||0==this.m_numIndex){if(e==this.m_numIndex)return;this.m_arrSelectItemNode[this.m_numIndex].getChildByName("picked").active=!1}this.m_numIndex=e,this.m_arrSelectItemNode[this.m_numIndex].getChildByName("picked").active=!0,this.refreshUI(e)},t.prototype.goToPage=function(e){var t=this.m_arrStronger[this.m_numIndex].ARR[e].PAGEID;app.goToPage(t)},t.prefabPath="windowsPageRecommendStronger",n([p(cc.Node)],t.prototype,"p_nodeRecommend",void 0),n([p(cc.Node)],t.prototype,"p_nodeGeneralList",void 0),n([p(cc.Node)],t.prototype,"p_nodeFetterContent",void 0),n([p(cc.Node)],t.prototype,"p_nodeFetterItem",void 0),n([p(cc.Sprite)],t.prototype,"p_sprIntro",void 0),n([p(cc.Node)],t.prototype,"p_nodeStronger",void 0),n([p(cc.Node)],t.prototype,"p_nodeStrongerContent",void 0),n([p(cc.Node)],t.prototype,"p_nodeStrongerItem",void 0),n([p(cc.Button)],t.prototype,"p_btnRecommend",void 0),n([p(cc.Node)],t.prototype,"p_recommendPicked",void 0),n([p(cc.Button)],t.prototype,"p_btnStronger",void 0),n([p(cc.Node)],t.prototype,"p_strongerPicked",void 0),n([p(cc.Node)],t.prototype,"p_nodeContent",void 0),n([p(cc.Node)],t.prototype,"p_nodeItem",void 0),n([p(cc.Label)],t.prototype,"p_labTx",void 0),a=n([s],t)}(e("basePage"));t.exports=c,cc._RF.pop()},{"../lang/langMgr":void 0,basePage:void 0}],windowsPageReplay:[function(e,t){"use strict";cc._RF.push(t,"b6ab5KrU2dPKZzxyRF8jcXD","windowsPageReplay");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagereplay"},properties:{p_sprTitle:cc.Sprite,p_labTime:cc.Label,p_btnWatch:cc.Button,p_leftWin:cc.Node,p_leftLose:cc.Node,p_leftName:cc.Label,p_leftLevel:cc.Label,p_leftPower:cc.Label,p_leftGeneral:[cc.Node],p_rightWin:cc.Node,p_rightLose:cc.Node,p_rightName:cc.Label,p_rightLevel:cc.Label,p_rightPower:cc.Label,p_rightGeneral:[cc.Node]},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){var e=this;this._super(),this.p_btnWatch.node.on("click",function(){e.onWatchVideo()})},setParam:function(e){this.m_objData=e,this._videoid=e.videoid,this.m_objVideo=JSON.parse(e.video),e.rname&&(this._rname=e.rname),this.refreshUI()},refreshUI:function(){var e="";"win"==this.m_objVideo.result?(e="title_win_3",e=this.m_objVideo.ltper>=7e3?"title_win_1":this.m_objVideo.ltper>=3e3?"title_win_2":"title_win_3"):(e="title_lose_3",e=this.m_objVideo.ltper>0?"title_lose_3":this.m_objVideo.rtper>=7e3?"title_lose_1":this.m_objVideo.rtper>=3e3?"title_lose_2":"title_lose_3"),this.p_labTime.string=gUtils.timestampToTime(this.m_objData.time),app.loadTexture(gConfig.rootPath.uivideo+e,this.p_sprTitle,this.prefabPath);var t=this.m_objVideo.left.set.team||{},a=0;for(var i in t){var n=app.db.getGBaseByGsid(t[i].gsid);this.p_leftGeneral[a].active=!0,this.p_leftGeneral[a].getComponent("generalPortraitItem").initReport(n,t[i]),a++}for(var r=a;r<this.p_leftGeneral.length;++r)this.p_leftGeneral[r].active=!1;var o=this.m_objVideo.right.set.team||{};for(var s in a=0,o){var p=app.db.getGBaseByGsid(o[s].gsid);this.p_rightGeneral[a].active=!0,this.p_rightGeneral[a].getComponent("generalPortraitItem").initReport(p,o[s]),a++}for(var c=a;c<this.p_leftGeneral.length;++c)this.p_rightGeneral[c].active=!1;if(this.p_leftWin.active="win"==this.m_objVideo.result,this.p_leftLose.active="win"!=this.m_objVideo.result,this.p_leftName.string=this.m_objVideo.left.info.rname,this.p_leftLevel.string=langMgr.getString("windowsPageReplay",0,this.m_objVideo.left.info.level),this.p_leftPower.string=this.getTeamPower(this.m_objVideo.left.set.team),this.p_rightWin.active="win"!=this.m_objVideo.result,this.p_rightLose.active="win"==this.m_objVideo.result,this.m_objVideo.right.info.level)this.p_rightName.string=this.m_objVideo.right.info.rname,this.p_rightLevel.string=langMgr.getString("windowsPageReplay",0,this.m_objVideo.right.info.level),this.p_rightPower.string=this.getTeamPower(this.m_objVideo.right.set.team);else{this.p_rightName.string=this._rname;var h=this.getSetLevelPower();this.p_rightLevel.string=langMgr.getString("windowsPageReplay",0,h.level),this.p_rightPower.string=h.power}},getTeamPower:function(e){var t=0;for(var a in e)t+=e[a].power;return t},getSetLevelPower:function(){var e=this.m_objVideo.right.set.team;if(!e)return{level:1,power:0};var t=0,a=0;for(var i in e)a||(a=e[i].level),t+=app.db.getPropertyPower(e[i].property);return{level:a,power:t}},onWatchVideo:function(){app.player.getServerTime()-this.m_objData.time>72e5?app.showNotice(langMgr.getString("windowsPageReplay",1)):(app.battleType="video",app.videoType="chat",app.videoId=this._videoid,app.battleSeed=this.m_objVideo.seed,app.replayData=this.m_objVideo,app.goToNormBattle())}});a.showPage=function(t){var a=this;t.videoid?app.player.sfVideoInfo(t.videoid,function(i,n){i?app.showNotice(langMgr.getString("windowsPageReplay",3)):e("basePage").showPage.call(a,{videoid:t.videoid,time:n.time,version:n.version,video:n.video,rname:t.rname})}):app.showNotice(langMgr.getString("windowsPageReplay",2))},cc._RF.pop()},{basePage:void 0}],windowsPageRewardGeneral:[function(e,t){"use strict";cc._RF.push(t,"8f65acoJcJPq4QROLrZUeMX","windowsPageRewardGeneral");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagerewardgeneral"},properties:{p_sprCamp:cc.Sprite,p_sprOCCU:cc.Sprite,p_sprOccu2:cc.Sprite,p_sprName:cc.Sprite,p_starContainer:cc.Node,p_highStarIcon:cc.Sprite,p_sprStar:[cc.Sprite],p_skill:cc.Node,p_sprGeneral:cc.Sprite,p_spGeneral:sp.Skeleton,p_animGeneral:cc.Animation,p_generalQuality:cc.Node,p_pfbQualityItem:cc.Prefab,_gQualityItem:null,p_spriteBg:cc.Sprite},onLoad:function(){a.instance=this,this.handleUI(),this.creatMask(!0),this.stopNodeEvent(),app.playSound("reward")},handleUI:function(){var e=this;this._super(),this.p_skill.children.forEach(function(t,a){t.on("touchend",function(){e.onClickSkill(a)})})},setParam:function(e){this.gsid=e.gsid,this.m_objData=e,this.m_confirmcb=e.confirmcb,this.refreshUI(this.gsid)},refreshUI:function(e){this.refreshMain(e)},refreshMain:function(e){var t=this,a=app.db.getGBaseByGsid(e);a||(a={GSID:0,NAME:"\u672a\u77e5\u6b66\u5c06",CAMP:1,STAR:1}),this.m_arrSkill=a.SKILL;var i=app.db.getGNamePathHByGsid(e);app.loadTexture(i,this.p_sprName,this.prefabPath);var n=gConfig.getIconGCampPath(a.CAMP-1);app.loadTexture(n,this.p_sprCamp,this.prefabPath);var r=gConfig.getIconGOccuPath(a.OCCU-1);app.loadTexture(r,this.p_sprOCCU,this.prefabPath),a.OCCU2&&(this.p_sprOccu2.node.active=!0,r=gConfig.getIconGOccuPath(a.OCCU2-1),app.loadTexture(r,this.p_sprOccu2,this.prefabPath));var o=a.STAR;if(this.p_starContainer.opacity=o<10?255:0,this.p_highStarIcon.node.active=o>=10?255:0,o>=10){var s=gConfig.getIconGStarPath(o-1);app.loadTexture(s,this.p_highStarIcon,this.prefabPath)}else{var p=(o-1)%5,c=gConfig.getIconGBigStarPath(a.STAR);this.p_sprStar.forEach(function(e,a){e.node.active=p>=a,app.loadTexture(c,e,t.prefabPath)})}for(var h=0;h<this.p_skill.children.length;h++){var l=a.SKILL[h];if(l){this.p_skill.children[h].active=!0;var g=this.p_skill.children[h].getChildByName("skill_sprite").getComponent(cc.Sprite),d=this.p_skill.children[h].getChildByName("skill_name").getComponent(cc.Label),u=this.p_skill.children[h].getChildByName("TypeIcon").getComponent(cc.Sprite),f=app.db.getSkillPathByGsid(l);app.loadTexture(f,g,this.prefabPath);var m=app.db.getSkillInfoByGsid(l);d.string=m.NAME;var _=app.db.getSkillTypePathByGsid(l);app.loadTexture(_,u,this.prefabPath)}else this.p_skill.children[h].active=!1}app.loadGeneral(a.GSID,this.p_sprGeneral,this.p_spGeneral,this.p_animGeneral,null,this.prefabPath),this.p_generalQuality.opacity=Boolean(a.TGRADE)?255:0,a.TGRADE&&(cc.isValid(this._gQualityItem)||(this._gQualityItem=cc.instantiate(this.p_pfbQualityItem),this.p_generalQuality.addChild(this._gQualityItem),this._gQualityItem.setPosition(cc.Vec2.ZERO)),this._gQualityItem.getComponent("GeneralQualityItem").init(a.TGRADE)),app.loadTexture(app.db.getGeneralBgByCamp(a.CAMP),this.p_spriteBg,this.prefabPath)},onClickSkill:function(e){var t=this.m_arrSkill[e];if(t){var a={type:"general",gsid:t,index:e,lock:!0};app.pages.windowspagetipsskill.showPage(a)}},onClose:function(){this._super(),this.m_confirmcb&&this.m_confirmcb()}});cc._RF.pop()},{basePage:void 0}],windowsPageRewardList:[function(e,t){"use strict";cc._RF.push(t,"19759khNqZL6IeqocGnY/GK","windowsPageRewardList");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=cc._decorator,o=r.ccclass,s=r.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.label=null,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,this.stopBgNodeEvent(),this.handleUI()},t.prototype.refreshUI=function(){},t.prototype.setParam=function(){this.refreshUI()},t.prefabPath="windows_page_reward_list",t.pageType=1,n([s(cc.Label)],t.prototype,"label",void 0),a=n([o],t)}(e("basePage"));t.exports=p,cc._RF.pop()},{basePage:void 0}],windowsPageRewardPick:[function(e,t){"use strict";cc._RF.push(t,"d5a962/gx1JAY5fEHfIVrgV","windowsPageRewardPick");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagerewardpick",pageType:1},properties:{p_arrTitle:[cc.Node],p_labIntro:cc.Label,p_tabvProp:cc.tableView,p_btnCancel:cc.Button,p_btnConfirm:cc.Button},onLoad:function(){a.instance=this,this.handleUI(),this.stopBgNodeEvent(),this.creatMask(!0)},handleUI:function(){var e=this;this._super(),this.p_btnConfirm.node.on("click",function(){if(app.playSound("click"),e.m_arrChooseIndex.length<=0)app.showNotice(langMgr.getString("windowsPageRewardPick",2));else{if(e.m_objData.needconfirm){var t=e.m_objData.select[e.m_arrChooseIndex[0]],a=gUtils.tranPropToGeneral(t),i=app.db.getGNameByGsid(a),n={content:langMgr.getString("windowsPageRewardPick",1,i),confirmcb:function(){e.m_confirmCb&&e.m_confirmCb.apply(e.m_target,e.m_arrChooseIndex)},target:e};app.pages.windowspagetipsmsg.showPage(n)}else e.m_confirmCb&&e.m_confirmCb.apply(e.m_target,e.m_arrChooseIndex);e.onClose()}}),this.p_btnCancel.node.on("click",function(){app.playSound("cancel"),e.m_cancelCb&&e.m_cancelCb.apply(e.m_target,e.m_cancelParm),e.onClose()})},setParam:function(e){cc.log("pick data is",e),this.m_objData=e,this.m_numType=e.type||0,this.m_confirmCb=e.confirmcb,this.m_confirmParm=e.confirmparm,this.m_cancelCb=e.cancelcb,this.m_cancelParm=e.cancelparm,this.m_target=e.target,this.refreshUI()},refreshUI:function(){var e=this;this.p_arrTitle.forEach(function(t,a){t.active=Boolean(e.m_numType==a)}),this.p_labIntro.node.active=Boolean(this.m_numType&&1==this.m_numType),this.p_labIntro.node.active&&(this.p_labIntro.string=this.m_objData.content||langMgr.getString("windowsPageRewardPick",0)),this.p_btnConfirm.node.active=Boolean(this.m_numType&&1==this.m_numType),this.p_btnCancel.node.active=Boolean(this.m_numType&&1==this.m_numType),this.refreshView()},itemPorpClick:function(e,t){if(1!=this.m_numType){var a=this.m_objData.select[e],i=gUtils.tranPropToGeneral(a);return app.showPropTips({GSID:i,COUNT:1}),!1}return e==this.m_chooseIndex||(this.m_chooseItem&&(cc.log("handle choose item"),this.m_chooseItem.selected(!1,this.m_chooseIndex)),this.m_chooseItem=t,this.m_chooseIndex=e,!0)},refreshView:function(){var e=this.m_objData.select||[],t=e.length,a=this.m_numType&&1==this.m_numType?1:0;this.p_tabvProp.getComponent("tableView").initTableView(t,{array:e,maxpick:a,initfun:"initForBag",target:this})}});cc._RF.pop()},{basePage:void 0}],windowsPageRewardTips:[function(e,t){"use strict";cc._RF.push(t,"2e4d8MQUG9PKbT+4ZgzXPt9","windowsPageRewardTips");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagerewardtips",pageType:1,createShot:!1},properties:{p_pfbRewardItem:cc.Prefab},onLoad:function(){a.instance=this,this.handleUI(),this.m_arrIconReward=[]},setParam:function(e){this.refreshUI(e),this.closeCb=e.closeCb},refreshUI:function(e){var t,a=this.node.convertToNodeSpaceAR(e.worldPos),i=a.x;e.worldPos.x>680&&(i=a.x-this.p_pfbRewardItem.data.width),t=e.isadd?a.y+this.p_pfbRewardItem.data.height:a.y-this.p_pfbRewardItem.data.height,this.p_bgNode.setPosition(i,t);for(var n=e.arrReward,r=0;r<n.length;++r)if(!(n[r].GSID>9e4||n[r].gsid>9e4)){var o=this.m_arrIconReward[r];o||((o=cc.instantiate(this.p_pfbRewardItem)).parent=this.p_bgNode,o.scale=.8,this.m_arrIconReward.push(o)),o.active=!0,o.getComponent("propItem").initForBag(n[r]),o.getComponent("propItem").setClick(!0)}for(var s=n.length;s<this.m_arrIconReward.length;++s)this.m_arrIconReward[s].active=!1},onClose:function(){this._super(),this.closeCb&&this.closeCb()}});cc._RF.pop()},{basePage:void 0}],windowsPageReward:[function(e,t){"use strict";cc._RF.push(t,"269faL1/39GhKRVrJpQf+42","windowsPageReward");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagereward",pageType:1,createShot:!1},properties:{p_tableView:cc.tableView,p_btnConfirm:cc.Button,p_btnConfirmFive:cc.Button,p_btnConfirmOne:cc.Button,p_btnAgain:cc.Button,p_btnAgainFive:cc.Button,p_btnAgainTen:cc.Button,p_nodeAgainOne:cc.Node,p_nodeAgainFive:cc.Node,p_nodeAgainTen:cc.Node,p_reward_anim:cc.Animation,p_nodeOther:cc.Node,titleAnim:sp.Skeleton,dismissTip:cc.Node},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.creatMask(!0),this.tableOriginPos=this.p_tableView.node.position},handleUI:function(){var e=this;this._super(),cc.isValid(this.p_btnConfirm)&&this.p_btnConfirm.node.on("click",function(){app.playSound("click"),e.m_confirmCb&&e.m_isClose&&e.m_confirmCb.apply(e.m_target,e.m_confirmParm),e.onClose(!0)}),cc.isValid(this.p_btnConfirmOne)&&this.p_btnConfirmOne.node.on("click",function(){app.playSound("click"),e.m_confirmCb&&e.m_isClose&&e.m_confirmCb.apply(e.m_target,e.m_confirmParm),e.onClose(!0)}),cc.isValid(this.p_btnConfirmFive)&&this.p_btnConfirmFive.node.on("click",function(){app.playSound("click"),e.m_confirmCb&&e.m_isClose&&e.m_confirmCb.apply(e.m_target,e.m_confirmParm),e.onClose(!0)}),cc.isValid(this.p_btnAgain)&&this.p_btnAgain.node.on("click",function(){app.playSound("click"),e.m_againCb&&e.m_isClose&&e.m_againCb.apply(e.m_target,e.m_againParm),e.onClose(!0,!0)}),cc.isValid(this.p_btnAgainFive)&&this.p_btnAgainFive.node.on("click",function(){app.playSound("click"),e.m_againCb&&e.m_isClose&&e.m_againCb.apply(e.m_target,e.m_againParm),e.onClose(!0,!0)}),cc.isValid(this.p_btnAgainTen)&&this.p_btnAgainTen.node.on("click",function(){app.playSound("click"),e.m_againCb&&e.m_isClose&&e.m_againCb.apply(e.m_target,e.m_againParm),e.onClose(!0,!0)})},setParam:function(e){cc.log(e),app.playSound("reward");for(var t=[],a=0;a<e.reward.length;++a){var i=e.reward[a],n=app.db.getTypeByGsid(i.GSID||i.gsid);if("general"==n)for(var r=0;r<(i.COUNT||i.count);++r){var o={GSID:i.GSID||i.gsid,COUNT:1};t.push(o)}else"none"!=n&&t.push(i)}e.reward=t,this.m_objData=e,this.m_showType=e.showtype||0,this.m_confirmCb=e.confirmcb,this.m_confirmParm=e.confirmparm,this.m_againName=e.againname,this.m_againCb=e.againcb,this.m_againParm=e.againparm,this.m_maxStar=e.maxstar,this.m_target=e.target,app.playUpgradeAnim({spComp:this.titleAnim,startName:"appear",endName:"loop",index:1,target:this}),e.isAutoDismiss?(this.dismissTip.active=!0,this.p_tableView.node.position.y=this.tableOriginPos.y-(this.dismissTip.height+5)):(this.dismissTip.active=!1,this.p_tableView.node.position=this.tableOriginPos),this.refreshTableV(),this.refreshBGUI()},refreshBGUI:function(){},refreshTableV:function(){var e=this;this.refreshBtn(),this.anim_index=this.anim_index||1,this.anim_index++,app.loadEff("jiuguanchoujiang",this.p_reward_anim,1,2);for(var t=[],a=0;a<this.m_objData.reward.length;++a){var i=this.m_objData.reward[a],n=i.GSID||i.gsid;"none"==app.db.getTypeByGsid(n)&&90353!=n||(i.isShowReward=1,i.MATER=!0,t.push(i))}var r=t.length,o=r<5?r%5:5;this.p_tableView.top=r<=5?this.p_tableView.cell.data.height/2:0;var s=o*this.p_tableView.cell.data.width+this.p_tableView.spacingX*(o-1);this.p_tableView.left=(this.p_tableView.node.width-s)/2,this.m_arrItem=[],this.p_tableView.initTableView(r,t,function(){var a=e.p_tableView.content.children,i=e.anim_index,n=0;e.m_isClose=!1;for(var o=0;o<a.length;++o)for(var s=a[o].children,p=function(t){var a=5*o+t;if(a>=r)return"break";var p=s[t];p.active=!1,e.m_arrItem.push(p),e.scheduleOnce(function(){e.anim_index==i&&(e.m_isClose||(e.m_arrItem.shift(),p.getComponent("propItem").playFlashAnim(),a>=r-1&&(e.m_isClose=!0)))},.1+.2*a),n=a},c=0;c<s.length&&"break"!==p(c);++c);for(var h=n;h<t.length;h++)t[h].isShowReward=!1})},allShowRewardItem:function(){this.m_arrItem||(this.m_arrItem=[]);for(var e=0;e<this.m_arrItem.length;++e)this.m_arrItem[e].getComponent("propItem").playFlashAnim(!0);this.m_isClose=!0},refreshBtn:function(){switch(this.m_showType){case 0:this.p_nodeAgainFive.active=5==this.m_againName,this.p_nodeAgainOne.active=1==this.m_againName,this.p_nodeAgainTen.active=10==this.m_againName,1==this.m_againName&&(this.p_btnAgain.node.getChildByName("tx_chouyici").active=!0,this.p_btnAgain.node.getChildByName("tx_touyici").active=!1),this.p_nodeOther.active=!1;break;case 1:this.p_nodeAgainOne.active=!1,this.p_nodeAgainTen.active=!1,this.p_nodeAgainFive.active=!1,this.p_nodeOther.active=!0;break;case 2:this.p_nodeAgainFive.active=5==this.m_againName,this.p_nodeAgainOne.active=1==this.m_againName,this.p_nodeAgainTen.active=10==this.m_againName,1==this.m_againName&&(this.p_btnAgain.node.getChildByName("tx_chouyici").active=!1,this.p_btnAgain.node.getChildByName("tx_touyici").active=!0),this.p_nodeOther.active=!1}},lbTips:function(e){e||app.showRecommendGift()},onClose:function(e,t){cc.isValid(this.node)&&(this.m_isClose?(0!=this.m_showType||e)&&(this.m_confirmCb&&this.m_confirmCb.apply(this.m_target,this.m_confirmParm),this.lbTips(t),cc.isValid(this.node)&&this.node.active&&(--app.numPrefabZindex,app.popPage(),this.node.active=!1,cc.director.emit("page_close_end"),cc.director.emit("close_reward_page"))):this.allShowRewardItem())}});cc._RF.pop()},{basePage:void 0}],windowsPageScoreRecruit:[function(e,t){"use strict";cc._RF.push(t,"ca1b0D8MPNCO5nTPDw3BGPb","windowsPageScoreRecruit");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=cc._decorator,o=r.ccclass,s=r.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_generalItem=null,t.p_btnRecruit=null,t.p_lableScore=null,t.p_layout=null,t._callback=null,t._target=null,t._params=null,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.creatMask(!0)},t.prototype.handleUI=function(){this.p_btnRecruit.node.on("click",this.recruitClickHandle.bind(this))},t.prototype.recruitClickHandle=function(){if(app.playSound("click"),app.player.getCount(app.db.dbDraw[4][1].COST[0].GSID)/1e3>=1){if(app.player.vip<3&&app.player.level<80)return app.godDraw=!0,void app.showNotice(langMgr.getString("cardpubPage",1));this.onClose(),this._callback&&this._callback.apply(this._target,this._params)}else app.player.vip<3?app.showNotice(langMgr.getString("cardpubPage",10)):app.showNotice(langMgr.getString("cardpubPage",2))},t.prototype.refreshUI=function(){var e=cc.instantiate(this.p_generalItem);e.parent=this.p_layout,e.active=!0,e.getComponent("propItem").initForBag({gsid:36001,count:1}),e.getComponent("propItem").setClick(!0),e.getComponent("propItem").getGeneralNode().getComponent("generalPortraitItem").getChipNode().active=!1,e.getComponent("propItem").getGeneralNode().getComponent("generalPortraitItem").getNumNode().active=!1;var t=app.player.getCount(app.db.dbDraw[4][1].COST[0].GSID);this.p_lableScore.string="\u5f53\u524d\u5929\u8fd0\u503c:"+t},t.prototype.setParam=function(e){var t=e.cb,a=e.target,i=e.params;this._callback=t,this._target=a,this._params=i,this.refreshUI()},t.prefabPath="windowspagescorerecruit",t.pageType=1,n([s(cc.Prefab)],t.prototype,"p_generalItem",void 0),n([s(cc.Button)],t.prototype,"p_btnRecruit",void 0),n([s(cc.Label)],t.prototype,"p_lableScore",void 0),n([s(cc.Node)],t.prototype,"p_layout",void 0),a=n([o],t)}(e("basePage"));t.exports=p,cc._RF.pop()},{basePage:void 0}],windowsPageSeasonTip:[function(e,t){"use strict";cc._RF.push(t,"3fe46VKoB5OKZDEoW3Ti+ot","windowsPageSeasonTip");var a={1:"image_buffszxy_lang",2:"image_buffhzzr_lang",3:"image_bufftzbl_lang",4:"image_bufffzpx_lang"},i=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspageseasontip",pageType:1},properties:{p_sprSeason:cc.Sprite},onLoad:function(){i.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.creatMask(!0,100)},setParam:function(){if(!app.seasonData)return app.refreshSeason(),void this.onClose();this.refreshUI()},refreshUI:function(){var e=app.seasonData.info.season;app.loadTexture("game_ui/04_page/windows_page_season_tip/"+a[e],this.p_sprSeason,this.prefabPath)}});cc._RF.pop()},{basePage:void 0}],windowsPageSetnum:[function(e,t){"use strict";cc._RF.push(t,"025587CcOJOLbx0g65E625d","windowsPageSetnum");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagesetnum",pageType:1},properties:{p_nodeProp:cc.Node,p_labName:cc.Label,p_nodeItem:cc.Node,p_pfbPorp:cc.Prefab,p_labHave:cc.Label,p_labIntro:cc.Label,p_labTips:cc.Label,p_btnUp:cc.Button,p_btnDown:cc.Button,p_nodePrice:cc.Node,p_labPrice:cc.Label,p_sprPrice:cc.Sprite,p_btnSell:cc.Button,p_btnConfirm:cc.Button,p_btnBuy:cc.Button,p_btnOpen:cc.Button,p_sliderNode:cc.Node,p_proBar:cc.ProgressBar,p_sliderCount:cc.Label},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.creatMask(!0)},handleUI:function(){var e=this;this._super(),this.p_btnUp.node.on("click",function(){app.playSound("click"),e.setNumUse(e.m_numEx+1)}),this.p_btnDown.node.on("click",function(){app.playSound("click"),e.setNumUse(e.m_numEx-1)}),this.p_btnConfirm.node.on("click",function(){app.playSound("click"),e.onClickConfirm()}),this.p_btnSell.node.on("click",function(){app.playSound("click"),e.onClickConfirm()}),this.p_btnBuy.node.on("click",function(){app.playSound("click"),e.onClickConfirm()}),this.p_btnOpen.node.on("click",function(){app.playSound("click"),e.onClickConfirm()}),this.p_sliderNode.on("slide",function(){var t=e.p_sliderNode.getComponent(cc.Slider).progress,a=Math.round(e.m_numMaxEx*t),i=e.m_numMaxEx<=0?0:1;a=cc.misc.clampf(a,i,e.m_numMaxEx),e.setNumUse(a)},this)},setParam:function(e){this.m_objData=e,e.maxcount||(e.maxcount=0),this.m_numMaxEx=0===e.maxcount?0:e.maxcount,"wish"==e.type&&(this.m_numMaxEx=1),this.m_numEx=this.m_numMaxEx,this.setData(),this.refreshUI()},setNumUse:function(e){e||0==e||(e=this.m_numMaxEx,30028!=this.m_objData.gsid&&30024!=this.m_objData.gsid||(e=1)),this.m_numMaxEx<=0?e=0:(e=Math.max(1,e),e=Math.min(this.m_numMaxEx,e)),this.m_numEx=e;var t=this.m_numMaxEx<=0?0:e/this.m_numMaxEx;this.p_sliderNode.getComponent(cc.Slider).progress=t,this.p_proBar.progress=t,this.p_sliderCount.string=e+"/"+this.m_numMaxEx,this.refreshSetNum()},refreshUI:function(){this.p_nodeProp.active&&(this.p_labName.string=app.db.getPropsName(this.m_objData.gsid),this.m_nodeItem||(this.m_nodeItem=cc.instantiate(this.p_pfbPorp),this.m_nodeItem.parent=this.p_nodeItem,this.m_nodeItem.setPosition(cc.v2(0,0))),this.m_nodeItem.getComponent("propItem").initForGsid(this.m_objData.gsid,this.m_objData.count));var e=app.player.getCount(this.m_objData.gsid);this.p_labHave.string=langMgr.getString("windowsPageSetnum",0,e);for(var t=(app.db.getPropsInfoByGsid(this.m_objData.gsid).INTRO||"").split("|"),a=(t.length,""),i=0;i<t.length;++i)t[i].length<18||(t[i].length<36||t[i].length),a=i==t.length-1?a+t[i]:a+t[i]+"\n";this.p_labIntro.string=a,this.setNumUse()},refreshSetNum:function(){this.p_btnUp.interactable=this.m_objData.maxcount>this.m_numEx,this.p_btnDown.interactable=this.m_numEx>1,"nums"==this.m_objData.type?this.p_labPrice.string=app.player.getCount(this.m_objData.coin):this.p_labPrice.string=this.m_numEx*this.m_numOnePrice},setData:function(){var e=app.db.getPropsInfoByGsid(this.m_objData.gsid);switch(this.m_objData.type){case"sell":this.p_nodeProp.active=!0,this.p_labTips.string=langMgr.getString("windowsPageSetnum",5),this.p_nodePrice.active=!0,this.m_objData.coin=38006,this.m_numOnePrice=e.PRICE,this.p_btnSell.node.active=!0,this.p_btnConfirm.node.active=!1,this.p_btnBuy.node.active=!1,this.p_btnOpen.node.active=!1;break;case"buy":this.p_nodeProp.active=!0,this.p_labTips.string=langMgr.getString("windowsPageSetnum",6),this.p_nodePrice.active=!0,this.m_numOnePrice=this.m_objData.price,this.p_btnSell.node.active=!1,this.p_btnConfirm.node.active=!1,this.p_btnBuy.node.active=!0,this.p_btnOpen.node.active=!1;break;case"treas":this.p_nodeProp.active=!0,this.p_nodePrice.active=!1,this.p_labTips.string=langMgr.getString("windowsPageSetnum",7),this.p_btnSell.node.active=!0,this.p_btnConfirm.node.active=!0,this.p_btnBuy.node.active=!1,this.p_btnOpen.node.active=!1;break;case"box":this.p_nodeProp.active=!0,this.p_labTips.string=langMgr.getString("windowsPageSetnum",7),this.p_nodePrice.active=!1,this.p_btnSell.node.active=!1,this.p_btnConfirm.node.active=!1,this.p_btnBuy.node.active=!1,this.p_btnOpen.node.active=!0;break;case"chip":this.p_nodeProp.active=!0,this.p_labTips.string=langMgr.getString("windowsPageSetnum",7),this.p_nodePrice.active=!1,this.p_btnSell.node.active=!1,this.p_btnConfirm.node.active=!0,this.p_btnBuy.node.active=!1,this.p_btnOpen.node.active=!1;break;case"nums":this.p_nodeProp.active=!0,this.p_labTips.string=langMgr.getString("windowsPageSetnum",7),this.p_nodePrice.active=!0,this.p_btnSell.node.active=!1,this.p_btnBuy.node.active=!1,this.p_btnConfirm.node.active=!0,this.p_btnOpen.node.active=!1;break;case"wish":this.p_nodeProp.active=!0,this.p_labTips.string=langMgr.getString("windowsPageSetnum",7),this.p_nodePrice.active=!1,this.p_btnSell.node.active=!0,this.p_btnConfirm.node.active=!0,this.p_btnBuy.node.active=!1,this.p_btnOpen.node.active=!1;break;default:this.m_numOnePrice=0,this.p_labTips.string=langMgr.getString("windowsPageSetnum",7),this.p_btnSell.node.active=!1,this.p_btnConfirm.node.active=!1,this.p_btnBuy.node.active=!1,this.p_btnOpen.node.active=!1}if(this.m_objData.coin){this.p_sprPrice.node.active=!0;var t=app.db.getPropsIconPath(this.m_objData.coin);app.loadTexture(t,this.p_sprPrice,this.prefabPath)}else this.p_sprPrice.node.active=!1},onClickBtnUpDown:function(e){1==e?this.m_numMaxEx+1<=this.m_objData.maxcount&&++this.m_numMaxEx:this.m_numMaxEx-1>0&&--this.m_numMaxEx,this.refreshSetNum()},onClickConfirm:function(){38007!=this.m_objData.gsid||0!=this.m_objData.maxcount?this.m_numMaxEx>this.m_objData.maxcount?app.showNotice(langMgr.getString("windowsPageSetnum",4)):(this.m_objData.confirmcb&&this.m_objData.confirmcb.call(this.m_objData.target,this.m_numEx),this.onClose()):app.showNotice(langMgr.getString("windowsPageSetnum",3))},onClickMinMax:function(e){this.m_numMaxEx=1==e?this.m_objData.maxcount:1,this.refreshSetNum()},checkNumLegal:function(e){return/^[1-9]\d*$/.test(e)}});cc._RF.pop()},{basePage:void 0}],windowsPageShareChat:[function(e,t){"use strict";cc._RF.push(t,"00740C1ViBI7ahS5UC+JCkW","windowsPageShareChat");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagesharechat",pageType:1},properties:{p_btnServer:cc.Button,p_btnGuild:cc.Button,p_btnCross:cc.Button},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.creatMask(!0,0)},handleUI:function(){var e=this;this._super(),this.p_btnServer.node.on("click",function(){e.shareToChat(app.roomid_server),e.onClose()}),this.p_btnGuild.node.on("click",function(){e.shareToChat(app.roomid_guild),e.onClose()}),this.p_btnCross.node.on("click",function(){e.shareToChat(app.roomid_cross),e.onClose()})},setParam:function(e){this.m_numMsgType=e.type,this.m_objShareData=e.data,this.refreshUI()},refreshUI:function(){switch(this.m_numMsgType){case 2:this.p_btnServer.node.active=!0,this.p_btnGuild.node.active=!0,this.p_btnCross.node.active=!0;break;default:this.p_btnServer.node.active=!1,this.p_btnGuild.node.active=!1,this.p_btnCross.node.active=!1}},shareToChat:function(e){var t=this;switch(this.m_numMsgType){case 2:var a=langMgr.getString("chatItemPlayer",2,[this.m_objShareData.gstar,this.m_objShareData.gname]);if(!e)return void app.showNotice(langMgr.getString("windowsPageShareChat",2));e==app.roomid_guild?app.player.sfPlayerByParam(["legion"],function(){app.player.legion?app.sendChatMsg(e,a,t.m_numMsgType,t.m_objShareData):app.showNotice(langMgr.getString("windowsPageShareChat",1))}):app.sendChatMsg(e,a,this.m_numMsgType,this.m_objShareData)}}});cc._RF.pop()},{basePage:void 0}],windowsPageShowGeneralList:[function(e,t){"use strict";cc._RF.push(t,"6944bX+gWxA3LXLZZD/EGcN","windowsPageShowGeneralList");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspageshowgenerallist",pageType:1},properties:{p_tabvGeneral:cc.tableView},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},start:function(){var e=this;eventMgr.on(eventStr.battleEvent.ExitBattle,function(){e.onClose()},this),eventMgr.on(eventStr.soulBinding.ExitBinding,function(){e.onClose()},this)},handleUI:function(){this._super()},setParam:function(e){var t=this,a=e.gemerallist||[];this.m_generalList=[],a.forEach(function(e){e.w>0&&t.m_generalList.push(gUtils.deepClone(e))}),this.m_generalList.sort(function(e,t){var a=t;return e.GSID>a.GSID?1:-1}),this.refreshView()},refreshView:function(){var e=this.m_generalList.length;this.p_tabvGeneral.initTableView(e,{array:this.m_generalList,initfun:"initForGppvpList",target:this})},onClose:function(){this._super()}});cc._RF.pop()},{basePage:void 0}],windowsPageSiege:[function(e,t){"use strict";cc._RF.push(t,"fe4a44JzyxDjqk/lgCQVUB8","windowsPageSiege");var a=[{per:.3,path:"_b"},{per:.8,path:"_a"},{per:1}],i={city_01:"battle_bg_01",city_02:"battle_bg_02",city_03:"battle_bg_03"},n=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagesiege"},properties:{p_sprBg_1:cc.Sprite,p_sprBg_2:cc.Sprite,p_labTalk:cc.Label,p_sprCityName:cc.Sprite,p_labCityPNum:cc.Label,p_sprGName:cc.Sprite,p_btnLookReward:cc.Button,p_proPNum:cc.ProgressBar,p_btnSiege:cc.Button,p_nodeGeneral:cc.Node,p_sprGeneral:[cc.Sprite],p_spGeneral:[sp.Skeleton],p_animGeneral:[cc.Animation],p_nodeGInfo:cc.Node,p_sprOff:cc.Sprite,p_sprCamp:cc.Sprite,p_sprSkillIcon:cc.Sprite,p_labSkillName:cc.Label,p_rtSkillIntro:cc.RichText,p_labGeneralName:cc.Label,p_labGPro:cc.Label,p_sfGenera:[cc.SpriteFrame],p_spBomb:sp.Skeleton,p_arrAnim:cc.Animation},onLoad:function(){n.instance=this,this.stopBgNodeEvent(),this.creatMask(),this.handleUI()},handleUI:function(){var e=this;this._super(),this.p_btnLookReward.node.on("click",function(){}),this.p_btnSiege.node.on("click",function(){e.m_numNeedLv>app.player.level?app.pages.windowspagezhengzhannotice.showPage(e.m_numNeedLv):e.goBattle()}),this.p_nodeGInfo.on("touchend",function(t){e.p_nodeGInfo.active=!1,t.stopPropagation()}),this.p_nodeGeneral.on("touchend",function(t){e.p_nodeGInfo.active=!0,t.stopPropagation()}),this.p_spBomb.setCompleteListener(function(){e.changeCity(e.m_objId.last,e.m_objId.now)})},setParam:function(e){var t=this;this.m_result=e,this.m_activePercent=!1,this.p_nodeGInfo.active=!1;var a=app.player.maxmapid;this.m_cityBlood=a;var i=app.onBattle;app.onBattle=null,this.isBattle=!1,null==i||i==a?(this.p_sprGeneral[0].node.parent.opacity=255,this.refreshUI(a),this.refreshBgUI(a)):(app._mask.active=!0,this.refreshUI(i),this.refreshBgUI(i),app.isLoading?this.p_spBomb.setAnimation(0,"play",!1):cc.director.once("loading_end",function(){t.p_spBomb.setAnimation(0,"play",!1)}),this.p_btnSiege.node.active=!1,this.p_btnClose.node.active=!1,this.m_objId={last:i,now:a})},changeCity:function(e,t){var a=this;this.m_nowPercent=this.p_proPNum.progress;var i=this.p_sprGeneral[0].node.parent,n=app.db.getMapInfo(t),r=n.CITY,o=n.GENERAL,s=app.db.getCityInfo(r),p=s.MAP.length;this.m_nowPercent=this.p_proPNum.progress,this.m_maxPercent=(p-s.MAP.indexOf(t))/p,this.m_maxPercent>this.m_nowPercent?this.m_maxPercent=0:this.refreshBgUI(t),this.m_activePercent=!0,this.p_arrAnim.once("finished",function(){0==a.m_maxPercent?a.onClose():(i.opacity=255,a.refreshUI(t)),cc.director.emit("boom_end"),a.m_result&&a.m_result(),cc.log("\u5173\u95ed mask--------\x3e>>>>",app._mask),app._mask.active=!1,a.p_btnSiege.node.active=!0,a.p_btnClose.node.active=!0}),i.runAction(cc.sequence(cc.fadeOut(.3),cc.callFunc(function(){for(var e=0;e<2;++e)app.loadGeneral(o,a.p_sprGeneral[e],a.p_spGeneral[e],a.p_animGeneral[e],null,a.prefabPath);app.loadEff("shengji_01",a.p_arrAnim,1,1)})))},refreshUI:function(e){var t=app.db.getMapInfo(e),a=t.CITY,n=t.GENERAL,r=app.db.getCityInfo(a);this.m_numNeedLv=t.LIMIT;var o=r.MAP.length,s=o-r.MAP.indexOf(e),p=s/o;!this.m_activePercent&&this.refreshProbar(p),this.p_labCityPNum.string=s+"/"+o+"\u4eba";var c=gConfig.rootPath.uimapevent+i[r.ICON],h=gConfig.rootPath.cityname+a;app.loadTexture(h,this.p_sprCityName,this.prefabPath),app.loadTexture(c,this.p_sprBg_1,this.prefabPath),this.p_labTalk.string=t.TALK;for(var l=0;l<2;++l)app.loadGeneral(n,this.p_sprGeneral[l],this.p_spGeneral[l],this.p_animGeneral[l],null,this.prefabPath);this.refreshGeneralInfo(t,n)},refreshBgUI:function(e){for(var t=app.db.getMapInfo(e).CITY,n=app.db.getCityInfo(t),r=n.MAP.length,o=(r-n.MAP.indexOf(e))/r,s=gConfig.rootPath.uimapevent+i[n.ICON],p=a.length,c=null,h=0;h<p;++h){var l=a[h];if(o<=l.per){l.path&&(c=l.path);break}}this.p_sprBg_2.node.active=!!c,c&&app.loadTexture(s+c,this.p_sprBg_2,this.prefabPath)},refreshProbar:function(e){this.p_proPNum.progress=e},refreshGeneralInfo:function(e,t){var a=e.GPRO,i=10*Math.floor(t/10)+1,n=app.db.getSiegeGenerallName(i),r=e.GTYPE,o=app.db.getGBaseByGsid(t),s=o.SKILL[0],p=app.db.getSkillPathByGsid(s),c=app.db.getSkillInfoByGsid(s),h=gConfig.getIconGCampPath(o.CAMP-1);this.p_labSkillName.string=c.NAME,this.p_rtSkillIntro.string=c.INTRO,this.p_labGeneralName.string=o.NAME,this.p_labGPro.string=a,this.p_sprOff.spriteFrame=this.p_sfGenera[r-1],app.loadTexture(h,this.p_sprCamp,this.prefabPath),app.loadTexture(p,this.p_sprSkillIcon,this.prefabPath),app.loadTexture(n,this.p_sprGName,this.prefabPath)},goBattle:function(){var e=this;app.battleType="normal",this.isBattle||app.player.sfChapterInfo(function(t,a){t?app.showNotice(langMgr.getString("windowsPageSiege",0)):(e.isBattle=!0,app.onBattle=e.m_cityBlood,app.battleConfig=a,app.goToNormBattle())})},update:function(){this.m_activePercent&&(this.m_nowPercent-=.01,this.m_nowPercent<=this.m_maxPercent&&(this.m_nowPercent=this.m_maxPercent,this.m_activePercent=!1),this.refreshProbar(this.m_nowPercent))},onClose:function(){this._super()}});cc._RF.pop()},{basePage:void 0}],windowsPageSource:[function(e,t){"use strict";cc._RF.push(t,"440be/Rno1FCaYguwJ8cbMT","windowsPageSource");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagesource",pageType:1},properties:{p_labName:cc.Label,p_nodeNum:cc.Node,p_labNum:cc.Label,p_labDes:cc.Label,p_pfbProp:cc.Prefab,p_pfbGeneral:cc.Prefab,p_btnMylb:cc.Button,p_btnMzlb:cc.Button,p_scrView:cc.ScrollView,p_nodeItem:cc.Node,p_nodeLbShow:cc.Node,p_arrNode:[cc.Node],p_sprBg:cc.Node},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.m_nodeProp=cc.instantiate(this.p_pfbProp),this.m_nodeProp.parent=this.p_bgNode,this.m_nodeGeneral=cc.instantiate(this.p_pfbGeneral),this.m_nodeGeneral.parent=this.p_bgNode,this.m_nodeProp.x=this.m_nodeGeneral.x=-255,this.m_nodeProp.y=this.m_nodeGeneral.y=245},handleUI:function(){this._super(),this.p_btnMylb.node.on("click",function(){app.goToPage(1045)}),this.p_btnMzlb.node.on("click",function(){app.goToPage(1044)})},setParam:function(e){this.m_gsid=e,this.refreshUI()},refreshUI:function(){if("object"==typeof this.m_gsid){if(null==this.m_gsid)return;this.m_nodeProp.active=!1,this.m_nodeGeneral.active=!0;var e=this.m_gsid.id,t=this.m_gsid.data;return t.GSID?(this.m_nodeGeneral.getComponent("generalPortraitItem").initForHandbook(t.GSID),this.p_labName.string=app.db.getPropsName(t.GSID)):(t.STAR&&(this.p_labName.string=langMgr.getString("windowsPageSource",0,t.STAR)),this.m_nodeGeneral.getComponent("generalPortraitItem")._customInit(t)),this.p_nodeNum.active=!1,this.p_labDes.node.active=!1,this.m_arrData=a.getGsidData(e),void(this.m_arrData&&this.refreshSView(this.m_arrData.ITEMS))}this.m_nodeProp.active=!0,this.m_nodeGeneral.active=!1,this.p_nodeNum.active=!0,this.p_labDes.node.active=!0;var i=app.db.getPropsName(this.m_gsid);this.p_labName.string=i;var n=app.player.getCount(this.m_gsid);this.p_labNum.string=gUtils.showNum(n);var r=app.db.getPropsInfoByGsid(this.m_gsid);this.p_labDes.string=r.INTRO,this.m_nodeProp.getComponent("propItem").initForGsid(this.m_gsid),this.m_arrData=a.getGsidData(this.m_gsid)||{},1!=this.m_arrData.LBSHOW||gSetting.checkReviewServ()?(this.p_sprBg.height=540,this.p_arrNode.forEach(function(e){e.height=540}),this.p_nodeLbShow.active=!1):(this.p_sprBg.height=370,this.p_arrNode.forEach(function(e){e.height=360}),this.p_nodeLbShow.active=!0),this.m_arrData&&this.refreshSView(this.m_arrData.ITEMS)},refreshSView:function(e){if(!e)return this.onClose();this.m_arrItems||(this.m_arrItems=[],this.m_arrItems.push(this.p_nodeItem));for(var t=0;t<e.length;++t){var a=this.m_arrItems[t];a||((a=cc.instantiate(this.p_nodeItem)).parent=this.p_scrView.content,this.m_arrItems.push(a)),a.active=!0,a.getComponent("wSourceItem").refreshUI(e[t],t,this.m_gsid)}for(var i=e.length;i<this.m_arrItems.length;++i)this.m_arrItems[i].active=!1}});a.getGsidData=function(e){var t=e,a=app.db.dbSource[e];if(!a)return!1;if(e>=1e5)return a;switch(app.db.getTypeByGsid(t)){case"equip":t=133e3;break;case"treas":t=134e3;break;case"generalchip":case"grandomchip":t=136e3;break;case"treaschip":case"trandomchip":t=137e3}return app.db.dbSource[t+""]},cc._RF.pop()},{basePage:void 0}],windowsPageStarRewards:[function(e,t){"use strict";cc._RF.push(t,"f85559wDytOsq21m3L0PXC2","windowsPageStarRewards");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagestarrewards",pageType:1},properties:{p_layoutRewards:cc.Layout,p_nodeItem:cc.Node,p_xygxText:cc.Node},onLoad:function(){a.instance=this,this.handleUI(),this.creatMask(!0)},handleUI:function(){this._super()},refreshTView:function(e){this.m_type&&"XYGX"==this.m_type&&(this.p_xygxText.active=!0),this.m_arrItems||(this.m_arrItems=[],this.m_arrItems.push(this.p_nodeItem));var t=0;if("object"==typeof e[0]){for(var a=0;a<e.length;++a)t+=e[a].chance||e[a].CHANCE||0;for(var i=0;i<e.length;++i){var n=this.m_arrItems[i];n||((n=cc.instantiate(this.p_nodeItem)).parent=this.p_layoutRewards.node,this.m_arrItems.push(n)),n.active=!0;var r=e[i].gsid||e[i].GSID,o=e[i].count||e[i].COUNT,s=e[i].chance||e[i].CHANCE||0,p=e[i].day||e[i].DAY||0,c=e[i].have||e[i].HAVE||0,h=e[i].tips||e[i].TIPS||0,l=e[i].end||e[i].END||0,g=n.getChildByName("TipsGroup").getChildByName("lab_rand"),d=n.getChildByName("TipsGroup").getChildByName("common_frame").getChildByName("TipsText"),u=n.getChildByName("TipsGroup").getChildByName("common_frame"),f=n.getChildByName("TipsGroup").getChildByName("Tips");if(app.setNodeState(n.getChildByName("porp_item"),!1),n.getChildByName("tx_lingqu").active=!1,o?n.getChildByName("porp_item").getComponent("propItem").initForBag(e[i]):n.getChildByName("porp_item").getComponent("propItem").initForGsid(r),s){g.active=!0;var m=100*s/t;m=Math.round(100*m)/100,g.getComponent(cc.Label).string=m+"%"}else p?(g.active=!0,g.getComponent(cc.Label).string=langMgr.getString("windowsPageTipsRewards",0,p),c&&(app.setNodeState(n.getChildByName("porp_item"),!0),n.getChildByName("tx_lingqu").active=!0)):g.active=!1;l?(d.getComponent(cc.Label).string=l,u.active=!0):u.active=!1,h?(f.getComponent(cc.Label).string=h,f.active=!0):f.active=!1,n.getChildByName("porp_item").getComponent("propItem").setClick(!0)}}else for(var _=0;_<e.length;++_){var v=this.m_arrItems[_];v||((v=cc.instantiate(this.p_nodeItem)).parent=this.p_layoutRewards.node,this.m_arrItems.push(v)),v.active=!0,v.getChildByName("TipsGroup").getChildByName("lab_rand").active=!1,v.getChildByName("TipsGroup").getChildByName("common_frame").active=!1,v.getChildByName("porp_item").getComponent("propItem").initForGsid(e[_]),v.getChildByName("porp_item").getComponent("propItem").setClick(!0)}for(var b=e.length;b<this.m_arrItems.length;++b)this.m_arrItems[b].active=!1},setParam:function(e){this.m_objData=e[0],this.m_type=e[1],this.refreshUI()},refreshUI:function(){this.refreshTView(this.m_objData)}});cc._RF.pop()},{basePage:void 0}],windowsPageTalentSkill:[function(e,t){"use strict";cc._RF.push(t,"20868BZkY9CLKZs2nY9t+xf","windowsPageTalentSkill");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=e("../lang/langMgr"),o=cc._decorator,s=o.ccclass,p=o.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_labName=null,t.p_rtxIntro=null,t.p_labTips=null,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,app.playSound("reward"),this.stopBgNodeEvent(),this.creatMask(!0,1),this.handleUI()},t.prototype.start=function(){},t.prototype.setParam=function(e){console.log(e),this.refreshUI(e)},t.prototype.refreshUI=function(e){var t=e.arrSkill,a=e.index,i=e.openLen,n=t[a],o=app.db.getSkillInfoByGsid(n);if(cc.log(o),o)if(this.p_labName.string=o.NAME||"",this.p_rtxIntro.string=o.INTRO||"",this.p_labTips.node.color=cc.Color.RED,a<i)this.p_labTips.node.color=cc.Color.GREEN,this.p_labTips.string=r.getString("windowsPageTalentSkill",0);else if(a==i)this.p_labTips.string=r.getString("windowsPageTalentSkill",1);else if(a>i&&(this.p_labTips.node.active=a>0,a>0)){var s=app.db.getSkillInfoByGsid(t[a-1]);if(this.p_labTips.node.active=!!s,!s)return;this.p_labTips.string=r.getString("windowsPageTalentSkill",2,s.NAME)}},t.prefabPath="windowspagetalentskill",t.pageType=1,n([p(cc.Label)],t.prototype,"p_labName",void 0),n([p(cc.Label)],t.prototype,"p_rtxIntro",void 0),n([p(cc.Label)],t.prototype,"p_labTips",void 0),a=n([s],t)}(e("basePage"));t.exports=c,cc._RF.pop()},{"../lang/langMgr":void 0,basePage:void 0}],windowsPageTalk:[function(e,t){"use strict";cc._RF.push(t,"b662c1cPJZHFaVLVQ33Emm8","windowsPageTalk");var a={"\u5e74\u517d":{iconpath:"nianshouname",spinepath:"nianshou/niansho"},"\u6363\u4e71\u7684\u98de\u9e1f":{iconpath:"feiniaoname",spinepath:"feiniao/skeleton"},"\u8c03\u76ae\u7684\u71d5\u5b50":{iconpath:"yanziname",spinepath:"yanzi/skeleton"}},i=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagetalk",pageType:1},properties:{p_nodeIcon:cc.Node,p_nodeRole_1:cc.Node,p_nodeRole_2:cc.Node,p_labTalk:cc.Label,p_sprName:cc.Sprite,p_sprite:[cc.Sprite],p_anim:[cc.Animation],p_spine:[sp.Skeleton]},onLoad:function(){i.instance=this,this.creatMask(!0),this.stopNodeEvent()},setParam:function(e){this.m_isTouch=!1,this.m_talkIndex=0,this.m_cb=e.result,this.m_arrTalk=e.talk,this.refreshTalkText()},setTextData:function(){this.m_talkIndex++,this.m_talkIndex>=this.m_arrTalk.length?(this.m_isTouch=!0,this.onClose(),this.m_cb&&this.m_cb()):this.refreshTalkText()},refreshTalkText:function(){var e=this,t=this.m_arrTalk[this.m_talkIndex],i=t.pos-1,n=t.gsid,r=t.text;i?(this.p_nodeRole_1.active=!1,this.p_nodeRole_2.active=!0):(this.p_nodeRole_1.active=!0,this.p_nodeRole_2.active=!1,this.p_nodeIcon.active=!n),this.p_labTalk.string=r;var o=a[n];if(o){var s=gConfig.rootPath.uiname+o.iconpath,p=gConfig.rootPath.uinewspinegeneral+o.spinepath;return this.p_sprite[1].node.active=!1,this.p_anim[1].node.active=!1,this.p_spine[1].node.active=!0,app.loadSpine(p,this.p_spine[1],function(){e.p_spine[1].setAnimation(0,"animation",!0)},null,this.prefabPath),void app.loadTexture(s,this.p_sprName,this.prefabPath)}n&&this.refreshGeneralIamge(n,i);var c="";n?(app.db.getGBaseByGsid(n),c=app.db.getGNamePathHByGsid(n)):c=gConfig.rootPath.uiname+"xiaoquename",app.loadTexture(c,this.p_sprName,this.prefabPath)},refreshGeneralIamge:function(e,t){app.loadGeneral(e,this.p_sprite[t],this.p_spine[t],this.p_anim[t],null,this.prefabPath)},onClose:function(){this.m_isTouch?this._super():this.setTextData()}});cc._RF.pop()},{basePage:void 0}],windowsPageTipsBook:[function(e,t){"use strict";cc._RF.push(t,"683a9ZTFZ9GJJ0Mk8Wn5wgV","windowsPageTipsBook");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=cc._decorator,o=r.ccclass,s=r.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_nodeItem=null,t.p_nodeOn=null,t.p_labName=null,t.p_nodeMian=null,t.p_nodeRand=null,t.p_nodeSuit=null,t.p_nodeAwaken=null,t.p_nodeSuitSkill=null,t.p_nodeMainProp=null,t.p_arrNodeRandProp=[],t.p_arrNodeSuitProp=[],t.p_sprAwakenProp=null,t.p_btnLeft=null,t.p_btnMid=null,t.p_arrNodeTx=[],t.p_btnRight=null,t.p_btnOff=null,t.m_generalGuid=null,t.m_bookGuid=null,t.m_bookInfo=null,t.m_numShowType=null,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){var e=this;a.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.creatMask(!0),this.p_btnMid.node.on("click",function(){app.playSound("click"),e.m_isAwaken?e.awaken():e.reset()}),this.p_btnLeft.node.on("click",function(){app.playSound("click"),e.onClose(),e.intensify()}),this.p_btnRight.node.on("click",function(){if(app.playSound("click"),e.m_isChanage){var t=app.db.getBBaseByGsid(e.m_bookInfo.gsid);eventMgr.emit(eventStr.generalPageBook.ShowBookBag,t.POS),e.onClose()}else{t=app.db.getBBaseByGsid(e.m_bookInfo.gsid);var a=app.player.general[e.m_generalGuid]?app.player.general[e.m_generalGuid].power:0;app.player.sfBookOn(e.m_generalGuid,e.m_bookGuid,t.POS,function(t,i){t||app.player.sfPlayerByParam(["books"],function(){if(eventMgr.emit(eventStr.generalPageBook.RefreshBook),eventMgr.emit(eventStr.generalPageBook.RefreshBookBag),app.pages.generalpage.instance&&app.pages.generalpage.instance.node.active&&app.pages.generalpage.instance.refreshInfo(i),cc.isValid(e)){var t=app.player.general[e.m_generalGuid]?app.player.general[e.m_generalGuid].power:0;cc.director.emit("EVT_PLAY_BOOK_POWER_ANIM",{curPower:t,beforePower:a})}e.onClose()})})}}),this.p_btnOff.node.on("click",function(){app.playSound("click");var t=app.db.getBBaseByGsid(e.m_bookInfo.gsid),a=app.player.general[e.m_generalGuid]?app.player.general[e.m_generalGuid].power:0;app.player.sfBookOff(e.m_generalGuid,t.POS,function(t,i){t||app.player.sfPlayerByParam(["books"],function(){if(eventMgr.emit(eventStr.generalPageBook.RefreshBook),eventMgr.emit(eventStr.generalPageBook.RefreshBookBag),app.pages.generalpage.instance&&app.pages.generalpage.instance.node.active&&app.pages.generalpage.instance.refreshInfo(i),cc.isValid(e)){var t=app.player.general[e.m_generalGuid]?app.player.general[e.m_generalGuid].power:0;cc.director.emit("EVT_PLAY_BOOK_POWER_ANIM",{curPower:t,beforePower:a})}e.onClose()})})})},t.prototype.start=function(){},t.prototype.setParam=function(e){e.general&&(this.m_generalGuid=e.general),e.guid&&(this.m_bookGuid=e.guid),e.bdata&&(this.m_bookInfo=e.bdata),this.m_numShowType=e.type,e.gsid?this.refreshForGsid(e.gsid):this.refreshForGuid()},t.prototype.refreshForGsid=function(e){this.p_nodeItem.getComponent("bookItem").refreshUI({book:{gsid:e}});var t=app.db.getBBaseByGsid(e);this.p_labName.string=t.NAME;var a=t.PROP[0],i=app.db.getPropertyCnByEn(a.KEY),n=app.db.getPropertyIdByEn(a.KEY),r=a.VAL,o=0;n&&2==app.db.dbProperty[n].NUMTYPE&&(r=r/10+"%",o=o/10+"%"),this.p_nodeMainProp.getChildByName("prop_name").getComponent(cc.Label).string=i,this.p_nodeMainProp.getChildByName("prop_value").getComponent(cc.Label).string="+"+r,this.p_nodeMainProp.getChildByName("prop_add").getComponent(cc.Label).string=window.langMgr.getString("bookAwakenPage",2,o),this.p_nodeRand.active=!1,this.p_nodeAwaken.active=!1;for(var s=app.db.getSuitBookById(t.SUITID,t.STAR).PROP,p=0;p<s.length;p++){var c=s[p],h=this.p_arrNodeSuitProp[p],l=window.langMgr.getString("windowsPageTipsBook",0),g=app.db.getPropertyCnByEn(c.KEY),d=app.db.getPropertyIdByEn(c.KEY),u=c.VAL;d&&2==app.db.dbProperty[d].NUMTYPE&&(u=u/10+"%"),h.getChildByName("prop_name").getComponent(cc.Label).string=g,h.getChildByName("prop_value").getComponent(cc.Label).string="+"+u+l}this.p_nodeSuitSkill.getComponent("bookSuitSkill").refreshUI({gsid:e,num:0,target:this}),this.refreshButton(e)},t.prototype.refreshForGuid=function(){if(!this.m_bookInfo)switch(this.m_numShowType){case 1:this.m_bookInfo=app.player.general[this.m_strGeneralGuid].book;break;default:this.m_bookInfo=app.player.books[this.m_bookGuid]}this.p_nodeItem.getComponent("bookItem").refreshUI({book:this.m_bookInfo,general:this.m_generalGuid});var e=this.m_bookInfo.main[0],t=app.db.getPropertyCnByEn(e.key),a=app.db.getPropertyIdByEn(e.key),i=e.val[0],n=e.val[1];a&&2==app.db.dbProperty[a].NUMTYPE&&(i=i/10+"%",n=n/10+"%"),this.p_nodeMainProp.getChildByName("prop_name").getComponent(cc.Label).string=t,this.p_nodeMainProp.getChildByName("prop_value").getComponent(cc.Label).string="+"+i,this.p_nodeMainProp.getChildByName("prop_add").getComponent(cc.Label).string=window.langMgr.getString("bookAwakenPage",2,n);var r=this.m_bookInfo.rand;this.p_nodeRand.active=r&&r.length>0;for(var o=0;o<this.p_arrNodeRandProp.length;o++){var s=r[o];if((f=this.p_arrNodeRandProp[o]).active=!!s,s){var p=app.db.getPropertyCnByEn(s.key),c=app.db.getPropertyIdByEn(s.key),h=s.val[0],l=s.val[1];c&&2==app.db.dbProperty[c].NUMTYPE&&(h=h/10+"%",l=l/10+"%"),f.getChildByName("prop_name").getComponent(cc.Label).string=p,f.getChildByName("prop_value").getComponent(cc.Label).string="+"+h,f.getChildByName("prop_add").getComponent(cc.Label).string=window.langMgr.getString("bookAwakenPage",2,l)}}var g=app.db.getBBaseByGsid(this.m_bookInfo.gsid),d=0;1==this.m_numShowType&&(d=app.db.getBSetNumByGuid(g.SUITID,this.m_generalGuid)),this.p_labName.string=g.NAME;var u=app.db.getSuitBookById(g.SUITID,g.STAR).PROP;for(o=0;o<u.length;o++){s=u[o];var f=this.p_arrNodeSuitProp[o],m=window.langMgr.getString("windowsPageTipsBook",0);d>=2*(o+1)&&(m=window.langMgr.getString("windowsPageTipsBook",1));var _=app.db.getPropertyCnByEn(s.KEY),v=app.db.getPropertyIdByEn(s.KEY),b=s.VAL;v&&2==app.db.dbProperty[v].NUMTYPE&&(b=b/10+"%"),f.getChildByName("prop_name").getComponent(cc.Label).string=_,f.getChildByName("prop_value").getComponent(cc.Label).string="+"+b+m}var y=this.m_bookInfo.awake;if(this.p_nodeAwaken.active=y&&y[0],y&&y[0]){var P=gConfig.getBookAwakenPropPath(y[0].key);app.loadTexture(P,this.p_sprAwakenProp,this.prefabPath)}this.p_nodeSuitSkill.getComponent("bookSuitSkill").refreshUI({gsid:this.m_bookInfo.gsid,num:d,target:this}),this.refreshButton(this.m_bookInfo.gsid)},t.prototype.refreshButton=function(e){this.p_nodeOn.active=1==this.m_numShowType;var t=app.db.getBBaseByGsid(e);switch(this.m_numShowType){case 1:case 2:this.p_btnLeft.node.active=!0,this.p_btnRight.node.active=!0,this.p_btnMid.node.active=t.STAR>=5,t.STAR>=5&&(this.p_arrNodeTx[0].active=t.STAR>=6,this.m_isAwaken=5==t.STAR,this.p_arrNodeTx[1].active=5==t.STAR),1==this.m_numShowType?(this.p_btnOff.node.active=!0,this.p_arrNodeTx[2].active=!0,this.p_arrNodeTx[3].active=!1,this.m_isChanage=!0):(this.p_btnOff.node.active=!1,this.p_arrNodeTx[2].active=!1,this.p_arrNodeTx[3].active=!0,this.m_isChanage=!1);break;default:this.p_btnLeft.node.active=!1,this.p_btnRight.node.active=!1,this.p_btnMid.node.active=!1,this.p_btnOff.node.active=!1}},t.prototype.reset=function(){var e=this;app.player.sfBookResetGet(this.m_bookGuid,function(t,a){var i=a?a.book:null,n={guid:e.m_generalGuid,bookGuid:e.m_bookGuid,type:e.m_numShowType,reset:1,prop:i,target:e};app.pages.bookAwakenPage.showPage(n),e.onClose()})},t.prototype.awaken=function(){var e={guid:this.m_generalGuid,bookGuid:this.m_bookGuid,type:this.m_numShowType,target:this};app.pages.bookAwakenPage.showPage(e),this.onClose()},t.prototype.intensify=function(){var e={guid:this.m_generalGuid,bookGuid:this.m_bookGuid,type:this.m_numShowType,closecb:""};app.pages.BookIntensifyPage.showPage(e)},t.prefabPath="windowsPageTipsBook",t.pageType=1,n([s(cc.Node)],t.prototype,"p_nodeItem",void 0),n([s(cc.Node)],t.prototype,"p_nodeOn",void 0),n([s(cc.Label)],t.prototype,"p_labName",void 0),n([s(cc.Node)],t.prototype,"p_nodeMian",void 0),n([s(cc.Node)],t.prototype,"p_nodeRand",void 0),n([s(cc.Node)],t.prototype,"p_nodeSuit",void 0),n([s(cc.Node)],t.prototype,"p_nodeAwaken",void 0),n([s(cc.Node)],t.prototype,"p_nodeSuitSkill",void 0),n([s(cc.Node)],t.prototype,"p_nodeMainProp",void 0),n([s(cc.Node)],t.prototype,"p_arrNodeRandProp",void 0),n([s(cc.Node)],t.prototype,"p_arrNodeSuitProp",void 0),n([s(cc.Sprite)],t.prototype,"p_sprAwakenProp",void 0),n([s(cc.Button)],t.prototype,"p_btnLeft",void 0),n([s(cc.Button)],t.prototype,"p_btnMid",void 0),n([s(cc.Node)],t.prototype,"p_arrNodeTx",void 0),n([s(cc.Button)],t.prototype,"p_btnRight",void 0),n([s(cc.Button)],t.prototype,"p_btnOff",void 0),a=n([o],t)}(e("basePage"));t.exports=p,cc._RF.pop()},{basePage:void 0}],windowsPageTipsBox:[function(e,t){"use strict";cc._RF.push(t,"cfb1fPYsedHyLNTVMyVNshT","windowsPageTipsBox");var a=[{bg:680},{bg:800}],i=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagetipsbox",pageType:1},properties:{p_nodeTop:cc.Node,p_labName:cc.Label,p_pfbPorp:cc.Prefab,p_nodeProp:cc.Node,p_nodeNumBox:cc.Node,p_labIntro:cc.Label,p_labList:cc.Label,p_lsitBox:cc.Node,p_nodeUse:cc.Node,p_labTitleNum:cc.Label,p_btnDown:cc.Button,p_btnUp:cc.Button,p_btnMin:cc.Button,p_btnMax:cc.Button,p_nodeBtn:cc.Node,p_nodeCost:cc.Node,p_btnUse:cc.Button,p_btnBuy:cc.Button,p_sliderNode:cc.Node,p_sliderCount:cc.Label},onLoad:function(){i.instance=this,this.handleUI(),this.stopBgNodeEvent(),this.creatMask(!0)},start:function(){},handleUI:function(){var e=this;this._super(),this.p_btnUse.node.on("click",function(){app.playSound("click"),e.onClickUse()}),this.p_btnBuy.node.on("click",function(){app.playSound("click"),e.onClose(),e.m_confirmCb&&e.m_confirmCb.apply(e.m_target,null)}),this.p_btnUp.node.on("click",function(){app.playSound("click"),e.setNumUse(e.m_numEx+1)}),this.p_btnDown.node.on("click",function(){app.playSound("click"),e.setNumUse(e.m_numEx-1)}),this.p_btnMin.node.on("click",function(){app.playSound("click"),e.setNumUse(e.m_numEx-10)}),this.p_btnMax.node.on("click",function(){app.playSound("click"),e.setNumUse(e.m_numMaxEx)}),this.p_sliderNode.on("slide",function(){var t=e.p_sliderNode.getComponent(cc.Slider).progress,a=Math.round(e.m_numMaxEx*t),i=e.m_numMaxEx<=0?0:1;a=cc.misc.clampf(a,i,e.m_numMaxEx),e.setNumUse(a)},this)},setParam:function(e){this.m_strPropGsid=e.gsid,this.m_strPropCount=e.count,this.m_strShowType=e.type||"normal",this.m_funCb=e.funcb,e.data&&(this.m_data=e.data),e.target&&(this.m_target=e.target),e.confirmcb&&(this.m_confirmCb=e.confirmcb),this.refreshUI()},refreshUI:function(){var e=app.db.getPropsInfoByGsid(this.m_strPropGsid),t=app.db.getTypeByGsid(this.m_strPropGsid);if(e){switch(this.m_objPropBase=e,this.m_strPorpType=t,this.m_numMaxEx=this.m_strPropCount,this.m_nodeItem||(this.m_nodeItem=cc.instantiate(this.p_pfbPorp),this.m_nodeItem.parent=this.p_nodeProp,this.m_nodeItem.setPosition(cc.v2(0,0))),this.m_nodeItem.getComponent("propItem").initForGsid(this.m_strPropGsid,this.m_strPropCount),this.p_labName.string=e.NAME,this.p_labIntro.string=e.INTRO,this.m_strShowType){case"tips":this.p_nodeCost.active=!1,this.p_btnBuy.node.active=!1,this.p_btnUse.node.active=!1,this.p_nodeUse.active=!1;break;case"buy":this.p_nodeCost.getComponent("getItem").refreshUI(this.m_data.COIN,this.m_data.PRICE,!0),this.p_nodeCost.active=!0,this.p_btnBuy.node.active=!0,this.p_btnUse.node.active=!1,this.p_nodeUse.active=!1;break;default:this.setByPropType(t)}this.refreshView()}},refreshView:function(){var e=this.m_objPropBase.ITEMS.length;this.p_lsitBox.getComponent("bagViewCtrl").initView(e,{array:this.m_objPropBase.ITEMS,target:this})},setByPropType:function(e){switch(this.p_nodeCost.active=!1,this.p_btnBuy.node.active=!1,e){case"box":case"rbox":this.p_nodeUse.active=!0,this.p_btnUse.node.active=!0,this.setNumUse();break;default:this.p_nodeCost.active=!1,this.p_btnBuy.node.active=!1,this.p_btnUse.node.active=!1,this.p_nodeUse.active=!1}},setWindowsSize:function(e){var t=a[e];this.p_bgNode.height=t.bg,this.p_nodeTop.getComponent(cc.Widget).updateAlignment(),this.p_nodeBtn.getComponent(cc.Widget).updateAlignment()},itemPorpClick:function(e){if(!this.m_objPropBase.ITEMS[e])return!1;var t=this.m_objPropBase.ITEMS[e];return t.tips="tips",app.showPropTips(t),!1},setNumUse:function(e){e||0==e||(e=this.m_numMaxEx),this.m_numMaxEx<=0?e=0:(e=Math.max(1,e),e=Math.min(this.m_numMaxEx,e)),this.m_numEx=e;var t=this.m_numMaxEx<=0?0:e/this.m_numMaxEx;this.p_sliderNode.getComponent(cc.Slider).progress=t,this.p_sliderNode.getComponent(cc.ProgressBar).progress=t,this.p_sliderCount.string=e+"/"+this.m_numMaxEx},onClickUse:function(){switch(this.m_strPorpType){case"box":case"rbox":this.onExBox()}},onExBox:function(){this.onEx(this.m_numEx)},onClickBtnLy:function(){},onEx:function(e){var t=this,a=app.db.getTypeByGsid(this.m_strPropGsid);if(("grandomchip"==a||"generalchip"==a)&&app.player.gnum+e>app.player.bagspace){var i={content:langMgr.getString("windowsPageTipsBox",1),confirmcb:function(){app.goToPage(1018)},target:this};app.pages.windowspagetipsmsg.showPage(i)}else{var n=app.db.getPropsInfoByGsid(this.m_strPropGsid);app.player.sfExchange(n.EXID,e,null,function(e){app.player.sfPlayerData(function(){cc.director.emit("ex_chips_end"),t.onClose();var a={showtype:1,reward:e,target:t};app.pages.windowspagereward.showPage(a)})})}},onClickBtnSell:function(){if(this.m_strPropCount<=0)app.showNotice(langMgr.getString("windowsPageTipsBox",0));else{var e={gsid:this.m_strPropGsid,maxcount:this.m_strPropCount,type:"sell",confirmcb:this.onEx,target:this};app.pages.windowspagesetnum.showPage(e)}},ExCb:function(){},onClose:function(){this._super(),this.m_funCb&&this.m_funCb()}});cc._RF.pop()},{basePage:void 0}],windowsPageTipsBuff:[function(e,t){"use strict";cc._RF.push(t,"58cf1bi6gFL3qw0heAt2Tbi","windowsPageTipsBuff");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagetipsbuff"},properties:{p_sprBuff:cc.Sprite,p_labName:cc.Label,p_labRemarks:cc.Label,p_labXianxi:cc.Label},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0)},start:function(){},setParam:function(e){this.m_strPath=e.BPATH,this.m_numLast=e.LAST,this.m_strRemark=e.REMARKS,this.m_strName=e.NAME,this.m_numAdd=e.ADDITION,this.m_objData=e,this.refreshUI()},refreshUI:function(){app.loadTexture(gConfig.getDungeonBuffPath(this.m_strPath),this.p_sprBuff,this.prefabPath),this.p_labName.string=this.m_strName,this.p_labRemarks.string=this.m_strRemark+"+"+this.m_numAdd+"%",this.p_labXianxi.string=0==this.m_numLast?langMgr.getString("windowsPageTipsBuff",0):langMgr.getString("windowsPageTipsBuff",1)}});cc._RF.pop()},{basePage:void 0}],windowsPageTipsCamp:[function(e,t){"use strict";cc._RF.push(t,"a358217qmtHKKP7YU1TZFit","windowsPageTipsCamp");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagetipscamp",pageType:1,createShot:!1},properties:{p_sprIntro:cc.Sprite},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0,1)},setParam:function(e){var t=gConfig.getFetterImagePathByCamp(e.camp-1);app.loadTexture(t,this.p_sprIntro,this.prefabPath)}});cc._RF.pop()},{basePage:void 0}],windowsPageTipsChoose:[function(e,t){"use strict";cc._RF.push(t,"9df01TtC7xJZoB78j21Blaw","windowsPageTipsChoose");var a=[{bg:680},{bg:970}],i=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagetipschoose",pageType:1},properties:{p_nodeTop:cc.Node,p_labName:cc.Label,p_pfbPorp:cc.Prefab,p_nodeProp:cc.Node,p_nodePickNum:cc.Node,p_labPickNum:cc.Label,p_labIntro:cc.Label,p_labList:cc.Label,p_lsitBox:cc.Node,p_nodeBtn:cc.Node,p_nodeCost:cc.Node,p_btnUse:cc.Button,p_btnBuy:cc.Button},onLoad:function(){i.instance=this,this.handleUI(),this.stopBgNodeEvent(),this.creatMask(!0)},start:function(){},handleUI:function(){var e=this;this._super(),this.p_btnUse.node.on("click",function(){app.playSound("click"),e.onClickUse()}),this.p_btnBuy.node.on("click",function(){app.playSound("click"),e.onClose(),e.m_confirmCb&&e.m_confirmCb.apply(e.m_target,null)})},setParam:function(e){this.m_strPropGsid=e.gsid,this.m_strPropCount=e.count,this.m_strShowType=e.type||"normal",this.m_funCb=e.funcb,e.data&&(this.m_data=e.data),e.target&&(this.m_target=e.target),e.confirmcb&&(this.m_confirmCb=e.confirmcb),this.refreshUI()},refreshUI:function(){var e=app.db.getPropsInfoByGsid(this.m_strPropGsid),t=app.db.getTypeByGsid(this.m_strPropGsid);if(e){switch(this.m_objPropBase=e,this.m_strPorpType=t,this.m_numMaxEx=this.m_strPropCount,this.m_numPick=0,this.m_nodeItem||(this.m_nodeItem=cc.instantiate(this.p_pfbPorp),this.m_nodeItem.parent=this.p_nodeProp,this.m_nodeItem.setPosition(cc.v2(0,0))),this.m_nodeItem.getComponent("propItem").initForGsid(this.m_strPropGsid,this.m_strPropCount),this.p_labName.string=e.NAME,this.p_labIntro.string=e.INTRO,this.m_strShowType){case"tips":this.m_numMaxEx=0,this.p_nodePickNum.active=!1,this.p_nodeCost.active=!1,this.p_btnBuy.node.active=!1,this.p_btnUse.node.active=!1;break;case"buy":this.p_nodeCost.getComponent("getItem").refreshUI(this.m_data.COIN,this.m_data.PRICE,!0),this.p_nodeCost.active=!0,this.p_btnBuy.node.active=!0,this.p_btnUse.node.active=!1;break;default:this.setByPropType()}this.refreshView()}},refreshPick:function(e){e=Math.max(0,e),e=Math.min(this.m_numMaxEx,e),this.p_labPickNum.string=e+"/"+this.m_numMaxEx},itemPorpClick:function(e){if(!this.m_arrShowData[e])return!1;var t=this.m_arrShowData[e];return t.tips="tips",app.showPropTips(t),!1},refreshView:function(){var e=this,t=this.m_objPropBase.ITEMS;this.m_objPickEx={},"crbox"==this.m_strPorpType&&(t=this.setCondData(t),cc.log(t));var a=t.length;this.m_arrShowData=t,this.p_lsitBox.getComponent("bagViewCtrl").initView(a,{array:t,max:this.m_numMaxEx,funcb:function(){cc.log("call black"),e.onClose()},target:this})},setByPropType:function(){this.p_nodeCost.active=!1,this.p_btnBuy.node.active=!1,1==this.m_numMaxEx?(this.p_btnUse.node.active=!1,this.p_nodePickNum.active=!1):(this.p_btnUse.node.active=!0,this.p_nodePickNum.active=!0)},setWindowsSize:function(e){var t=a[e];this.p_bgNode.height=t.bg,this.p_nodeTop.getComponent(cc.Widget).updateAlignment(),this.p_nodeBtn.getComponent(cc.Widget).updateAlignment()},setCondData:function(e){for(var t=[],a=0;a<e.length;++a){for(var i=e[a],n={},r=0;r<i.COND.length;++r){var o=i.COND[r];n=app.db.checkGeneralCond(0,o,n)}n.COUNT=i.COUNT,n.EXID=i.EXID,t.push(n)}return t},setNumPick:function(e,t){this.m_objPickEx||(this.m_objPickEx={});var a;a=this.m_objPickEx[e]?t-this.m_objPickEx[e]:t,this.m_numPick+=a,this.m_objPickEx[e]=t,this.refreshPick(this.m_numPick)},onClickUse:function(){var e=this;cc.log(this.m_objPickEx);var t=[];for(var a in this.m_objPickEx){var i=this.m_objPickEx[a];0!=i&&t.push({exid:a,times:i})}if(cc.log(t),0===t.length)return app.showNotice(langMgr.getString("windowsPageTipsChoose",1));app.player.sfExchangeMore({batch:t},function(t){app.player.sfPlayerData(function(){e.onClose();var a={showtype:1,reward:t,target:e};app.pages.windowspagereward.showPage(a)})})},onExBox:function(){this.onEx(this.m_numEx)},onClickBtnEx:function(){var e=app.db.getPropsInfoByGsid(this.m_strPropGsid),t=Math.floor(this.m_strPropCount/e.CHIP);if(cc.log("chip can comp num",t),t<=0)app.showNotice(langMgr.getString("windowsPageTipsChoose",2));else if(t>1){t=Math.min(t,10);var a={gsid:this.m_strPropGsid,maxcount:t,type:"chip",confirmcb:this.onEx,target:this};app.pages.windowspagesetnum.showPage(a)}else this.onEx(1)},onEx:function(e){var t=this,a=app.db.getTypeByGsid(this.m_strPropGsid);if(("grandomchip"==a||"generalchip"==a)&&app.player.gnum+e>app.player.bagspace){var i={content:langMgr.getString("windowsPageTipsChoose",4),confirmcb:function(){app.goToPage(1018)},target:this};app.pages.windowspagetipsmsg.showPage(i)}else{var n=app.db.getPropsInfoByGsid(this.m_strPropGsid);if("grandomchip"==a||"generalchip"==a){if(!n.EXID)return;app.player.sfExchange(n.EXID,e,null,function(e){app.player.sfPlayerData(function(){cc.director.emit("ex_chips_end"),t.onClose();var a={showtype:1,reward:e,confirmcb:function(){app.showRecommendGift()},target:t};app.pages.windowspagereward.showPage(a)})})}else app.player.sfExchange(n.EXID,e,null,function(e){app.player.sfPlayerData(function(){cc.director.emit("ex_chips_end"),t.onClose();var a={showtype:1,reward:e,target:t};app.pages.windowspagereward.showPage(a)})})}},onClickBtnSell:function(){if(this.m_strPropCount<=0)app.showNotice(langMgr.getString("windowsPageTipsChoose",3));else{var e={gsid:this.m_strPropGsid,maxcount:this.m_strPropCount,type:"sell",confirmcb:this.onEx,target:this};app.pages.windowspagesetnum.showPage(e)}},ExCb:function(){},onClose:function(){this._super(),this.m_funCb&&this.m_funCb()}});cc._RF.pop()},{basePage:void 0}],windowsPageTipsDetailed:[function(e,t){"use strict";cc._RF.push(t,"aac12HadU5BJLfonTgT5Nwk","windowsPageTipsDetailed");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagetipsdetailed"},properties:{p_sprIcon:cc.Sprite,p_labTitle:cc.Label,p_labCont:cc.Label},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0)},setParam:function(e){this.m_type=e.type,this.m_oucc=e.oucc,this.m_title="",this.m_strCont="";for(var t=0;t<app.db.dbWfetters.length;t++){var a=app.db.dbWfetters[t];if(a.OUCC==this.m_oucc&&a.TYPE==this.m_type){this.m_strCont=a.STRCONT,this.m_title=a.NAME;break}}this.refreshUI()},refreshUI:function(){this.refreshIcon(),this.p_labTitle.string=this.m_title,this.p_labCont.string=this.m_strCont},refreshIcon:function(){if(1==this.m_type){var e=gConfig.getIconGOccuPathBig(this.m_oucc);app.loadTexture(e,this.p_sprIcon,this.prefabPath)}else if(2==this.m_type){var t=gConfig.getIconGCampPath(this.m_oucc);app.loadTexture(t,this.p_sprIcon,this.prefabPath)}}});cc._RF.pop()},{basePage:void 0}],windowsPageTipsEquip:[function(e,t){"use strict";cc._RF.push(t,"7b32eIDv9VONZj0QmRfO3iP","windowsPageTipsEquip");var a=[2,3,4,5],i=[{bg:720,frame:160},{bg:950,frame:400},{bg:1050,frame:520}],n=(e("windowsPageSource"),cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagetipsequip",pageType:1},properties:{p_nodeTop:cc.Node,p_pfbPorp:cc.Prefab,p_nodeProp:cc.Node,p_labName:cc.Label,p_labPos:cc.Label,p_nodeQTips:cc.Node,p_qulityLv:cc.Label,p_btnRecasting:cc.Button,p_nodeProperty:cc.Node,p_nodeIntro:cc.Node,p_nodeBtn:cc.Node,p_arrNodeProp:[cc.Node],p_nodeTitleSet:cc.Node,p_labSet:cc.Label,p_nodeSuit:cc.Node,p_arrNodeSuit:[cc.Node],p_nodeArrSkill:cc.Node,p_arrNodeSkill:[cc.Node],p_labIntro:cc.Label,p_btnOff:cc.Button,p_btnOn:cc.Button,p_btnChange:cc.Button,p_btnSell:cc.Button,p_btnBuild:cc.Button,p_nodeBuy:cc.Node,p_btnBuy:cc.Button,p_nodeCost:cc.Node,p_redPoint:cc.Node,p_arrFrameAnim:[sp.Skeleton],p_arrIntroduceAnim:[sp.Skeleton]},onLoad:function(){n.instance=this,this.handleUI(),this.stopBgNodeEvent(),this.creatMask(!0)},handleUI:function(){var e=this;this._super(),this.p_btnOff.node.on("click",function(){app.playSound("click"),e.onClickBtnOff()}),this.p_btnOn.node.on("click",function(){app.playSound("click"),e.onClickBtnOn()}),this.p_btnChange.node.on("click",function(){app.playSound("click"),e.onClickBtnChange()}),this.p_btnSell.node.on("click",function(){app.playSound("click"),e.onClickBtnSell()}),this.p_btnBuy.node.on("click",function(){app.playSound("click"),e.onClickbtnBuy()}),this.p_btnBuild.node.on("click",function(){app.playSound("click"),e.onClickBtnBuild()}),this.p_btnRecasting.node.on("click",function(){app.playSound("click"),e.onClickBtnRecasting()})},setParam:function(e){cc.log("now init equip data is",e),this.m_strGeneralGuid=e.general,this.m_objGdata=e.gdata,this.m_strEquipGsid=e.gsid,this.m_strEquipCount=e.count,this.m_numShowType=e.type,this.m_funCb=e.funcb,this.m_upCb=e.upcb,this.m_equipPos=e.equipPos,e.data&&(this.m_data=e.data),e.target&&(this.m_target=e.target),e.confirmcb&&(this.m_confirmCb=e.confirmcb),this.isHideBtn=void 0!==e.isHideBtn&&e.isHideBtn,e.isBuild&&this.playRemakeEffects(),this.refreshUI()},refreshUI:function(){var e=app.db.getEBaseByGsid(this.m_strEquipGsid);if(e){this.m_suitType=app.db.getSuitBaseByGsid(this.m_strEquipGsid)?1:0,this.m_nodeItem||(this.m_nodeItem=cc.instantiate(this.p_pfbPorp),this.m_nodeItem.parent=this.p_nodeProp,this.m_nodeItem.setPosition(cc.v2(0,0))),this.m_nodeItem.getComponent("propItem").initForGsid(this.m_strEquipGsid),this.p_labName.string=e.NAME;var t=langMgr.getString("windowsPageTipsEquip",a[e.POS-1]);this.p_labPos.string=t?langMgr.getString("windowsPageTipsEquip",0,t):"",this.p_labIntro.string=e.INTRO;var i=e.PROP;this.p_arrNodeProp.forEach(function(e,t){if(i[t]){e.active=!0;var a=i[t];e.getComponent("propertyItem").refreshUI(a)}else cc.log("no prop",t,i[t]),e.active=!1});var n=0;if(e.SETID){var r;r=this.m_suitType?app.db.dbOccuequipset[e.SETID]:app.db.dbEquipSet[e.SETID],cc.log("now equip set data is",r);var o=0;if(this.m_strGeneralGuid){var s=app.player.general[this.m_strGeneralGuid];s&&(o=app.db.getESetNumByGuid(e.SETID,this.m_strGeneralGuid,s.occu,s.occu2||0))}if(this.m_objGdata&&(o=app.db.getESetNumByGuid(e.SETID,this.m_objGdata.equip,this.m_objGdata.occu,this.m_objGdata.occu2||0)),this.p_labSet.string=r.SUITNAME?r.SUITNAME+" ("+o+"/4)":langMgr.getString("windowsPageTipsEquip",1)+"("+o+"/4)",r){var p=r.PROPERTY,c=r.SKILL;p?(this.p_nodeSuit.active=!0,this.p_nodeArrSkill.active=!1,this.p_arrNodeSuit.forEach(function(e,t){if(p[t]){var a=p[t];e.getComponent("propertySetItem").refreshUI(a,o),e.active=!0}else e.active=!1}),n=1):c&&(this.p_nodeSuit.active=!1,this.p_nodeArrSkill.active=!0,this.p_arrNodeSkill.forEach(function(e,t){if(c[t]){e.active=!0;var a=c[t];e.getComponent("suitSetItem").refreshUI(a,o,t)}else e.active=!1}),n=2),this.p_nodeTitleSet.active=!0}else this.p_nodeTitleSet.active=!1}else this.p_nodeTitleSet.active=!1,this.p_nodeSuit.active=!1,this.p_nodeArrSkill.active=!1;switch(app.player.isSoulGeneral(this.m_strGeneralGuid)&&(this.m_numShowType=0),this.setWindowsSize(n),this.m_numShowType){case 1:this.p_btnOff.node.active=!this.isHideBtn,this.p_btnChange.node.active=!this.isHideBtn,this.p_btnOn.node.active=!1,this.p_btnRecasting.node.active=!!app.db.getSuitBaseByGsid(this.m_strEquipGsid),e.SLEVEL>=17?(this.p_nodeBtn.getComponent(cc.Layout).spacingX=210,this.p_nodeBtn.getComponent(cc.Layout).updateLayout(),this.p_btnBuild.node.active=!0):(this.p_nodeBtn.getComponent(cc.Layout).spacingX=150,this.p_nodeBtn.getComponent(cc.Layout).updateLayout(),this.p_btnBuild.node.active=!1),this.p_btnSell.node.active=!1,this.p_nodeBtn.active=!0,this.p_nodeBuy.active=!1;break;case 2:this.p_btnOff.node.active=!1,this.p_btnChange.node.active=!1,this.p_btnOn.node.active=!0,this.p_btnRecasting.node.active=!1,this.p_btnBuild.node.active=!1,this.p_btnSell.node.active=!1,this.p_nodeBtn.active=!0,this.p_nodeBuy.active=!1;break;case 3:this.p_btnOff.node.active=!1,this.p_btnChange.node.active=!1,this.p_btnOn.node.active=!1,this.p_btnRecasting.node.active=!1,this.p_btnBuild.node.active=!1,this.p_btnSell.node.active=Boolean(e.PRICE),this.p_nodeBtn.active=!0,this.p_nodeBuy.active=!1;break;case"buy":this.p_nodeBuy.active=!0,this.p_nodeCost.active=!0,this.p_btnRecasting.node.active=!1,this.p_nodeCost.getComponent("getItem").refreshUI(this.m_data.COIN,this.m_data.PRICE,!0),this.p_btnBuy.node.active=!0,this.p_nodeBtn.active=!1;break;default:this.p_nodeBtn.active=!1,this.p_btnRecasting.node.active=!1,this.p_btnBuild.node.active=!1,this.p_btnBuy.node.active=!1}if(cc.isValid(this.p_redPoint))try{var h=app.pages.generalbaghandbookpage;void 0===this.m_strGeneralGuid?this.p_redPoint.active=!1:this.p_redPoint.active=h.checkEquip(this.m_strGeneralGuid,this.m_equipPos)}catch(l){cc.log(l),this.p_redPoint.active=!1}this.p_nodeQTips.active=Boolean(e.QLEVEL),this.p_qulityLv.string=""+e.QLEVEL}else cc.log("no equip base info by",this.m_strEquipGsid)},setWindowsSize:function(e){var t=i[e];this.p_bgNode.height=t.bg,this.p_nodeProperty.height=t.frame,this.p_nodeTop.getComponent(cc.Widget).updateAlignment(),this.p_nodeProperty.getComponent(cc.Widget).updateAlignment(),this.p_nodeIntro.getComponent(cc.Widget).updateAlignment(),this.p_nodeBtn.getComponent(cc.Widget).updateAlignment(),this.p_btnClose.getComponent(cc.Widget).updateAlignment()},onClickBtnBuild:function(){var e={};this.m_strGeneralGuid&&(e.guid=this.m_strGeneralGuid),e.gsid=this.m_strEquipGsid,e.isBuild=!0,e.target=this,app.pages.windowspagelistequipsuit.showPage(e),this.onClose()},onClickBtnRecasting:function(){var e={};this.m_strGeneralGuid&&(e.guid=this.m_strGeneralGuid),e.gsid=this.m_strEquipGsid,e.isBuild=!1,e.target=this,app.pages.windowspagelistequipsuit.showPage(e),this.onClose()},onClickBtnOff:function(){var e=this;if(this.m_strGeneralGuid){var t=app.db.getEBaseByGsid(this.m_strEquipGsid).POS,a=app.player.general[this.m_strGeneralGuid]?app.player.general[this.m_strGeneralGuid].power:0;app.player.sfEquipOff(this.m_strGeneralGuid,t,function(t,i){if(t)return app.showNotice(t);app.player.sfPlayerData(function(){if(app.pages.windowspagetipsequip.instance.onClose(),app.pages.windowspagetipsequip.instance.m_funCb&&app.pages.windowspagetipsequip.instance.m_funCb(),app.checkPageValid("generalpage")&&app.pages.generalpage.instance.refreshInfo(i),cc.isValid(e)){var t=app.player.general[e.m_strGeneralGuid]?app.player.general[e.m_strGeneralGuid].power:0;cc.director.emit("EVT_PLAY_POWER_ANIM",{curPower:t,beforePower:a})}})})}},onClickBtnChange:function(){if(this.m_strGeneralGuid){var e=app.db.getEBaseByGsid(this.m_strEquipGsid).POS,t={};t.general=this.m_strGeneralGuid,t.pos=e,app.pages.windowspagetipsequip.instance.onClose(),app.pages.windowspagetipsequip.instance.m_funCb&&app.pages.windowspagetipsequip.instance.m_funCb(),app.pages.windowspagelistequip.showPage(t)}},onClickBtnOn:function(){var e=this;if(this.m_strGeneralGuid){cc.log("equip on");var t=app.player.general[this.m_strGeneralGuid]?app.player.general[this.m_strGeneralGuid].power:0;app.player.sfEquipOn(this.m_strGeneralGuid,this.m_strEquipGsid,function(a,i){a?app.showNotice(a):app.player.sfPlayerData(function(){if(app.pages.windowspagetipsequip.instance.onClose(),app.pages.windowspagelistequip.instance.onClose(),app.pages.windowspagetipsequip.instance.m_funCb&&app.pages.windowspagetipsequip.instance.m_funCb(),app.checkPageValid("generalpage")&&(i&&(i.clickEquipGsid=e.m_strEquipGsid),app.pages.generalpage.instance.refreshInfo(i)),cc.isValid(e)){var a=app.player.general[e.m_strGeneralGuid]?app.player.general[e.m_strGeneralGuid].power:0;cc.director.emit("EVT_PLAY_POWER_ANIM",{curPower:a,beforePower:t})}})})}},onClickbtnBuy:function(){this.m_funCb&&this.m_funCb(),this.m_confirmCb&&this.m_confirmCb.apply(this.m_target,null),this.onClose()},onClickBtnSell:function(){var e={gsid:this.m_strEquipGsid,maxcount:this.m_strEquipCount,type:"sell",confirmcb:this.sellCb,target:this};app.pages.windowspagesetnum.showPage(e)},sellCallBack:function(e){var t=this;app.player.sfEquipSell(this.m_strEquipGsid,e,function(e,a){if(e)app.showNotice(e);else{var i={showtype:1,reward:a,confirmcb:function(){app.player.sfPlayerByParam(["others","hide","props"],function(){t.onClose(),app.pages.propbagpage.instance.setData(),app.pages.propbagpage.instance.refreshView(2)})},target:t};app.pages.windowspagereward.showPage(i)}})},sellCb:function(e){var t=this;if(app.db.getEBaseByGsid(this.m_strEquipGsid).SLEVEL>9){var a={content:"\u5f53\u524d\u88c5\u5907\u4ef7\u503c\u8f83\u9ad8\uff0c\u662f\u5426\u7ee7\u7eed\u51fa\u552e\uff1f",confirmcb:function(){t.sellCallBack(e)},target:this};app.pages.windowspagetipsmsg.showPage(a,this.node)}else this.sellCallBack(e)},playRemakeEffects:function(){this.p_arrFrameAnim.forEach(function(e){cc.isValid(e)&&(e.node.active=!0,e.setAnimation(0,"shengji",!1))}),this.p_arrIntroduceAnim.forEach(function(e){cc.isValid(e)&&(e.node.active=!0,e.setAnimation(0,"shengji01",!1))})}}));cc._RF.pop()},{basePage:void 0,windowsPageSource:"windowsPageSource"}],windowsPageTipsExclus:[function(e,t){"use strict";cc._RF.push(t,"c738aWCNWZPhJPSTIv6p11L","windowsPageTipsExclus");var a=[{bg:700,frame:180},{bg:920,frame:400},{bg:1025,frame:520}],i=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagetipsexclus",pageType:1},properties:{p_nodeTop:cc.Node,p_nodeFrameInfo:cc.Node,p_nodeIntro:cc.Node,p_nodeBtn:cc.Node,p_nodeInfoProp:cc.Node,p_nodeSkill:cc.Node,p_pfbPorp:cc.Prefab,p_nodeExclus:cc.Node,p_labName:cc.Label,p_arrNodeProp:[cc.Node],p_arrNodeSkill:[cc.Node],p_labIntro:cc.Label,p_btnReset:cc.Button,p_btnUp:cc.Button,btnCustSkill:cc.Node,frameAnims:[sp.Skeleton],introdcueAnims:[sp.Skeleton]},onLoad:function(){i.instance=this,this.handleUI(),this.stopBgNodeEvent(),this.creatMask(!0)},start:function(){var e=this;cc.director.on("EVT_REFRESH_EXCLUS_INFO",function(t){e.refreshSkillPanel(t),e.m_objExclusData=app.player.general[e.m_strGeneralGuid].exclusive,e.frameAnims.forEach(function(e){e.node.parent.activeInHierarchy&&(e.node.active=!0,e.setAnimation(0,"shengji",!1))}),e.introdcueAnims.forEach(function(e){e.node.parent.activeInHierarchy&&(e.node.active=!0,e.setAnimation(0,"shengji01",!1))})},this)},handleUI:function(){var e=this;this._super(),this.p_btnReset.node.on("click",function(){app.playSound("click"),e.onClickBtnReset()}),this.p_btnUp.node.on("click",function(){app.playSound("click"),e.onClickBtnUp()}),this.btnCustSkill.on("click",function(){if(app.playSound("click"),e.m_objExclusData.level<18)return app.showNotice(langMgr.getString("windowsPageTipsExclus",1));app.pages.windowsPageMountSkillChoice.showPage({mountGsid:e.m_objExclusData.gsid,mountLv:e.m_objExclusData.level,skillGsids:e.m_objExclusData.skill,generalGuid:e.m_strGeneralGuid})},this)},setParam:function(e){this.m_strShowType=e.type,this.m_objExclusData=e.data,this.m_strGeneralGuid=e.general,this.m_funCb=e.funcb,this.m_funUp=e.funup,this.isHideBtn=void 0!==e.isHideBtn&&e.isHideBtn,this.refreshUI()},refreshUI:function(){var e=this,t=this.m_objExclusData.gsid,a=this.m_objExclusData.level,i=app.db.getExclusiveById(t,a);i&&(this.btnCustSkill.active=Boolean(a>=11)&&!app.player.isSoulGeneral(this.m_strGeneralGuid)&&!this.isHideBtn,this.m_nodeItem||(this.m_nodeItem=cc.instantiate(this.p_pfbPorp),this.m_nodeItem.parent=this.p_nodeExclus,this.m_nodeItem.setPosition(cc.v2(0,0))),this.m_nodeItem.getComponent("propItem").initForGExclus(t,a),this.p_labName.string=i.NAME||langMgr.getString("windowsPageTipsExclus",0),this.p_labIntro.string=i.INTRO||"",this.p_arrNodeProp.forEach(function(t,a){if(e.m_objExclusData.property[a]){t.active=!0;var i=e.m_objExclusData.property[a];t.getComponent("propertyItem").refreshUI(i)}else cc.log("no prop",a,e.m_objExclusData.property[a]),t.active=!1}),this.refreshSkillPanel(this.m_objExclusData.skill),this.p_btnUp.node.active=this.m_objExclusData.level+1<=app.db.getExclusMaxLv()&&!this.isHideBtn,this.p_btnReset.node.active=!this.isHideBtn)},setWindowsSize:function(e){var t=a[e];this.p_nodeSkill.active=e>0,this.p_bgNode.height=t.bg,this.p_nodeFrameInfo.height=t.frame,this.p_nodeTop.getComponent(cc.Widget).updateAlignment(),this.p_nodeFrameInfo.getComponent(cc.Widget).updateAlignment(),this.p_nodeIntro.getComponent(cc.Widget).updateAlignment(),this.p_nodeBtn.getComponent(cc.Widget).updateAlignment(),this.p_btnClose.getComponent(cc.Widget).updateAlignment(),this.p_nodeInfoProp.getComponent(cc.Widget).updateAlignment()},onClickBtnReset:function(){var e={general:this.m_strGeneralGuid,data:this.m_objExclusData,cb:this.m_funUp};this.onClose(),app.pages.generalequicresetpage.showPage(e)},onClickBtnUp:function(){if(this.m_objExclusData.level+1>app.db.getExclusMaxLv())app.showNotice(langMgr.getString("windowsPageTipsExclus",2));else{var e={general:this.m_strGeneralGuid,data:this.m_objExclusData,cb:this.m_funUp};this.onClose(),app.pages.generalequicuppage.showPage(e)}},onClose:function(){if(this._super(),this.m_funCb&&this.m_funCb(),app.player.hasBeenSoulBind(this.m_strGeneralGuid)){var e=app.player.getSoulBindGuid(this.m_strGeneralGuid);e&&app.player.sfQueryGeneralListInfo([e])}},onDestroy:function(){this._super(),cc.director.targetOff(this)},refreshSkillPanel:function(e){var t=0;this.p_arrNodeSkill.forEach(function(a,i){if(e[i]){a.active=!0;var n=e[i];a.getComponent("skillIExclusItem").refreshUI(n),++t}else a.active=!1}),this.setWindowsSize(t)}});cc._RF.pop()},{basePage:void 0}],windowsPageTipsGeneral:[function(e,t){"use strict";cc._RF.push(t,"ad3dbRyEJVPt4ZX2NelRaJ9","windowsPageTipsGeneral");var a=["hp","atk","def","mdef"],i=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagetipsgeneral"},properties:{p_nodeIcon:cc.Node,p_sprName:cc.Sprite,p_labPower:cc.Label,p_arrNodeClass:[cc.Node],p_arrNodeNowClass:[cc.Node],p_arrLabProperty:[cc.Label],p_arrNodeSkill:[cc.Node],p_arrNodeEquip:[cc.Node]},onLoad:function(){i.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.creatMask(!0)},handleUI:function(){var e=this;this._super(),this.p_arrNodeSkill.forEach(function(t,a){t.on("touchend",function(){var t=e.p_arrNodeSkill[a],i=app.db.getGBaseByGsid(e.m_objGData.gsid);if(i){var n=i.SKILL[a];if(n){var r=t.getComponent("skillItem").isLock(),o={type:"general",gsid:n,index:a,lock:r};app.pages.windowspagetipsskill.showPage(o)}}})}),this.p_arrNodeEquip.forEach(function(t,a){t.on("touchend",function(){if(4==a){if(!e.m_boolShowEx)return;var t={type:"tips"};t.data=e.m_objGData.exclusive,app.pages.windowspagetipsexclus.showPage(t)}else if(5==a);else{var i=e.m_objEquipPos[a+1];if(!i)return;var n={};n.gsid=i,n.type="tips",n.gdata=e.m_objGData,app.pages.windowspagetipsequip.showPage(n)}})})},setParam:function(e){this.m_objGData=e,this.refreshUI()},refreshUI:function(){var e=this,t=app.db.getGBaseByGsid(this.m_objGData.gsid);this.p_nodeIcon.getComponent("generalPortraitItem").initForTips(this.m_objGData);var i=app.db.getGNamePathHByGsid(this.m_objGData.gsid);app.loadTexture(i,this.p_sprName,this.prefabPath),this.p_arrNodeClass.forEach(function(e,a){e.active=a<t.MAXCLASS}),this.p_arrNodeNowClass.forEach(function(t,a){t.active=a<e.m_objGData.class}),this.p_labPower.string=this.m_objGData.power||0,this.p_arrLabProperty.forEach(function(t,i){var n=a[i];t.string=Math.round(e.m_objGData.property[n])});for(var n=0;n<4;++n){var r=t.SKILL[n];if(r){this.p_arrNodeSkill[n].active=!0,app.db.getSkillInfoByGsid(r);var o=!(r==app.db.getUnLockSkill(this.m_objGData.gsid,this.m_objGData.class)[n]);this.p_arrNodeSkill[n].getComponent("skillItem").initForGSkill(r,o,this)}else this.p_arrNodeSkill[n].active=!1}var s=this.m_objGData.equip,p=this.m_objGData.treasure,c=this.m_objGData.exclusive;this.m_objEquipPos={};for(var h=0;h<s.length;++h){var l=s[h];if(l){var g=app.db.getEBaseByGsid(l);g&&(this.m_objEquipPos[g.POS]=l)}}for(var d=1;d<5;++d)this.m_objEquipPos[d]?this.p_arrNodeEquip[d-1].getComponent("propItem").initForGEquip(this.m_objEquipPos[d]):this.p_arrNodeEquip[d-1].getComponent("propItem").initForGEquip();var u=this.m_objGData.level<40,f=0==c.level&&this.m_objGData.level>=40;u&&u?(this.m_boolShowEx=!1,this.p_arrNodeEquip[4].getComponent("propItem").initForGEquip()):(this.m_boolShowEx=!0,this.p_arrNodeEquip[4].getComponent("propItem").initForGExclus(c.gsid,c.level,u,f)),p?(this.p_arrNodeEquip[5].getComponent("propItem").initForGEquip(p),this.p_arrNodeEquip[5].getComponent("propItem").setClick(!0)):(this.p_arrNodeEquip[5].getComponent("propItem").initForGEquip(),this.p_arrNodeEquip[5].getComponent("propItem").setClick(!1))}});cc._RF.pop()},{basePage:void 0}],windowsPageTipsGodbeastHalo:[function(e,t){"use strict";cc._RF.push(t,"109a8hObmNKWICwCJc0MLOR","windowsPageTipsGodbeastHalo");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagetipsgodbeasthalo"},properties:{p_sprSkillIcon:cc.Sprite,p_labSkillName:cc.Label,p_labSkillLevel:cc.Label,p_labSkillIntro:cc.Label},onLoad:function(){a.instance=this,this.handleUI(),this.stopBgNodeEvent(),this.creatMask(!0)},setParam:function(e){this.m_index=e.index,this.m_objMBase=e.base,this.m_objMData=e.data,this.refreshUI()},refreshUI:function(){var e=this.m_objMBase.PSKILL[this.m_index],t=this.m_objMData.pskill[this.m_index]||0,a={skill:e,lv:t};this.p_sprSkillIcon.getComponent("godbeastHaloItem").refreshUI(a,this);var i=app.db.getSkillInfoByGsid(e,t);this.p_labSkillLevel.string="Lv."+t||0,this.p_labSkillName.string=i.NAME,this.p_labSkillIntro.string=i.INTRO}});cc._RF.pop()},{basePage:void 0}],windowsPageTipsGppvpSkill:[function(e,t){"use strict";cc._RF.push(t,"91b27w0mcxOjoPtgnl1+lDs","windowsPageTipsGppvpSkill");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagetipsgppvpskill",pageType:1},properties:{p_labName:cc.Label,p_rtxIntro:cc.RichText,p_spSkillIcon:cc.Sprite,p_labSkillLv:cc.Label,p_labSkillCategory:cc.Label},onLoad:function(){a.instance=this,this.handleUI(),this.stopBgNodeEvent(),this.creatMask(!0,1)},start:function(){},handleUI:function(){this._super()},setParam:function(e){this.m_objData=e,this.refreshUI()},refreshUI:function(){app.loadTexture(this.m_objData.iconPath,this.p_spSkillIcon,this.m_objData.targetPrefabPath),this.p_labName.string=this.m_objData.name||"",this.p_labSkillLv.node.active=!1,this.p_labSkillCategory.string=langMgr.getString("windowsPageTipsSkill",5)+""+(1==this.m_objData.type?langMgr.getString("windowsPageTipsSkill",3):langMgr.getString("windowsPageTipsSkill",4)),this.p_rtxIntro.string=this.m_objData.des||""}});cc._RF.pop()},{basePage:void 0}],windowsPageTipsHelp:[function(e,t){"use strict";cc._RF.push(t,"d68302o2/1AtIzf5vYh7jBn","windowsPageTipsHelp");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagetipshelp",pageType:1,_forceCreateNewShot:!0},properties:{p_nodeView:cc.Node,p_sprNode:cc.Sprite},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.creatMask(!0)},handleUI:function(){},setParam:function(e){var t=app.db.getHelpData(e),a="";t&&(a=t.image||t.IMAGE||""),this.m_image=a,this.refreshUI()},refreshUI:function(){var e=this,t=gConfig.getHelpIconPath(this.m_image);app.loadTexture(t,this.p_sprNode,this.prefabPath,function(){cc.isValid(e)&&(e.p_nodeView.getComponent(cc.Mask).enabled=e.p_sprNode.node.height>e.p_nodeView.height)})}});cc._RF.pop()},{basePage:void 0}],windowsPageTipsHide:[function(e,t){"use strict";cc._RF.push(t,"a40a7zyz2FLw7uCibukGSw+","windowsPageTipsHide");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagetipshide",pageType:1,createShot:!0,_forceCreateNewShot:!0},properties:{p_propItem:cc.Node,p_pfbItem:cc.Prefab,p_labName:cc.Label,p_labConent:cc.Label},onLoad:function(){a.instance=this,this.creatMask(!0),this.m_nodeItem=cc.instantiate(this.p_pfbItem),this.m_nodeItem.parent=this.p_propItem},setParam:function(e){this.m_objData=e,this.refreshUI()},refreshUI:function(){var e=this.m_objData.gsid,t=app.db.getPropsInfoByGsid(e);t&&(this.m_nodeItem.getComponent("propItem").initForGsid(e),this.p_labName.string=t.NAME||"",this.p_labConent.string=t.INTRO||"")}});cc._RF.pop()},{basePage:void 0}],windowsPageTipsLegionLock:[function(e,t){"use strict";cc._RF.push(t,"5b2e81YndNIF7ZedpelP+pk","windowsPageTipsLegionLock");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagetipslegionlock",pageType:1},properties:{p_rtxContent:cc.Label,p_sprTitle:cc.Label,p_labChatper:cc.Label,p_btnConfirm:cc.Button},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.creatMask(!0),this.m_arrTitle=[langMgr.getString("windowsPageTipsLegionLock",0),langMgr.getString("windowsPageTipsLegionLock",1),langMgr.getString("windowsPageTipsLegionLock",2)],this.m_arrIntro=[langMgr.getString("windowsPageTipsLegionLock",3),langMgr.getString("windowsPageTipsLegionLock",4),langMgr.getString("windowsPageTipsLegionLock",5)]},handleUI:function(){var e=this;this._super(),this.p_btnConfirm.node.on("click",function(){app.playSound("click"),e.onClose()})},setParam:function(e){this.refreshUI(e.index,e.level)},refreshUI:function(e,t){this.p_sprTitle.string=this.m_arrTitle[e],this.p_labChatper.string=langMgr.getString("windowsPageTipsLegionLock",6,t),this.p_rtxContent.string=this.m_arrIntro[e]}});cc._RF.pop()},{basePage:void 0}],windowsPageTipsLegionStarcraft:[function(e,t){"use strict";cc._RF.push(t,"7d182M/NltNDbSN8zUFJ63f","windowsPageTipsLegionStarcraft");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagetipslegionstarcraft",pageType:1},properties:{p_labVitality:cc.Label,p_btnGoto:cc.Button},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.creatMask(!0)},handleUI:function(){this._super(),this.p_btnGoto.node.on("click",function(){app.playSound("cancel"),app.legionInfo.level<4?app.showNotice(langMgr.getString("windowsPageTipsLegionStarcraft",0)):app.pages.legionwarpage.showPage()})},setParam:function(e){this.p_labVitality.string=langMgr.getString("windowsPageTipsLegionStarcraft",1,e),app.lockFunConfig&&app.lockFunConfig.checkPreFuncByKey("LEGION_WAR")&&(this.p_btnGoto.node.active=!1)}});cc._RF.pop()},{basePage:void 0}],windowsPageTipsLevel:[function(e,t){"use strict";cc._RF.push(t,"1b76cRMaoVHSrK3+QWbnwW/","windowsPageTipsLevel");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagetipslevel",pageType:1},properties:{},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){this._super()}});cc._RF.pop()},{basePage:void 0}],windowsPageTipsLock:[function(e,t){"use strict";cc._RF.push(t,"da8cbcCo9BOJpLdjSnxhRQj","windowsPageTipsLock");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagetipslock",pageType:1},properties:{p_rtxContent:cc.RichText,p_sprTitle:cc.Sprite,p_labChatper:cc.Label,p_btnConfirm:cc.Button,p_btnCancel:cc.Button},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.creatMask(!0)},handleUI:function(){var e=this;this._super(),this.p_btnConfirm.node.on("click",function(){app.playSound("click"),e.onClose(),e.m_confirmCb&&e.m_confirmCb.apply(e.m_target,e.m_confirmParm)}),this.p_btnCancel.node.on("click",function(){app.playSound("cancel"),e.onClose(),e.m_cancelCb&&e.m_cancelCb.call(e.m_target)})},setParam:function(e){this.m_objData=e,this.m_functionId=e.functionId,this.m_confirmCb=e.confirmcb,this.m_confirmParm=e.confirmparm,this.m_cancelCb=e.cancelcb,this.m_target=e.target,this.refreshUI()},refreshUI:function(){this.m_objData.type||(this.m_objData.type="comfirm"),this.p_btnCancel.node.active=!("nocancel"==this.m_objData.type);var e=app.db.getFuncLockInfo(this.m_functionId);this.p_rtxContent.string=e.TIPS||"",app.loadTexture(gConfig.getLockTxPath(e.PATH),this.p_sprTitle,this.prefabPath);var t=app.db.getMapInfo(e.MAXMAPID);this.p_labChatper.string=t?langMgr.getString("activeGrowupItem",1,t.NAME):langMgr.getString("activeGrowupItem",0,e.LEVEL)}});cc._RF.pop()},{basePage:void 0}],windowsPageTipsMountSkill:[function(e,t){"use strict";cc._RF.push(t,"d7486KIEQJNCa0jp/0UUfYl","windowsPageTipsMountSkill");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagetipsmountskill",pageType:1},properties:{p_labName:cc.Label,p_rtxIntro:cc.RichText},onLoad:function(){a.instance=this,this.handleUI(),this.stopBgNodeEvent(),this.creatMask(!0,1)},start:function(){},handleUI:function(){this._super()},setParam:function(e){this.m_strType=e.type,this.m_strSkillGsid=e.gsid,this.m_numSkillIndex=e.index,this.m_isLock=e.lock,this.refreshUI()},refreshUI:function(){var e=app.db.getSkillInfoByGsid(this.m_strSkillGsid);cc.log("=== Mount Skill Options: ",e),e&&(this.p_labName.string=e.NAME||"",this.p_nodeType1.active=!(1!=e.TYPE),this.p_nodeType2.active=!(2!=e.TYPE),this.p_rtxIntro.string=e.INTRO||"")}});cc._RF.pop()},{basePage:void 0}],windowsPageTipsMsg2:[function(e,t){"use strict";cc._RF.push(t,"65decH6w+pNQ6E/zD9EMLAJ","windowsPageTipsMsg2");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagetipsmsg2"},properties:{p_rtxContent:cc.RichText,p_btnConfirm:cc.Button,p_btnCancel:cc.Button},onLoad:function(){a.instance=this,this.handleUI(),this.creatMask()},handleUI:function(){var e=this;this._super(),this.p_btnConfirm.node.on("click",function(){app.playSound("click"),e.onClose(),e.m_confirmCb&&e.m_confirmCb.apply(e.m_target,e.m_confirmParm)}),this.p_btnCancel.node.on("click",function(){app.playSound("cancel"),e.onClose(),e.m_cancelCb&&e.m_cancelCb.call(e.m_target)})},setParam:function(e){this.m_objData=e,this.m_confirmCb=e.confirmcb,this.m_confirmParm=e.confirmparm,this.m_cancelCb=e.cancelcb,this.m_target=e.target,this.refreshUI()},refreshUI:function(){this.m_objData.type||(this.m_objData.type="comfirm"),this.p_btnCancel.node.active=!("nocancel"==this.m_objData.type),this.p_rtxContent.string=this.m_objData.content||""}});cc._RF.pop()},{basePage:void 0}],windowsPageTipsMsg:[function(e,t){"use strict";cc._RF.push(t,"c1dd5AN9sFEYqEWinyM5y5C","windowsPageTipsMsg");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagetipsmsg",pageType:1,_forceCreateNewShot:!0},properties:{p_rtxContent:cc.RichText,p_btnConfirm:cc.Button,p_btnCancel:cc.Button,p_colContext:cc.Color},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.creatMask()},handleUI:function(){var e=this;this._super(),this.p_btnConfirm.node.on("click",function(){app.playSound("click"),e.onClose(),e.m_confirmCb&&e.m_confirmCb.apply(e.m_target,e.m_confirmParm)}),this.p_btnCancel.node.on("click",function(){app.playSound("cancel"),e.onClose(),e.m_cancelCb&&e.m_cancelCb.call(e.m_target)})},setParam:function(e){this.m_objData=e,this.m_confirmCb=e.confirmcb,this.m_confirmParm=e.confirmparm,this.m_cancelCb=e.cancelcb,this.m_target=e.target,this.refreshUI()},refreshUI:function(){this.m_objData.type||(this.m_objData.type="comfirm"),this.p_btnCancel.node.active=!("nocancel"==this.m_objData.type);var e=this.p_rtxContent.imageAtlas,t=this.m_objData.content.replace(/<propId>(\d*)<\/p>/gi,function(t,a){if(!e)return"";var i=e.getSpriteFrame(a);return cc.isValid(i)?"<img src='"+a+"'/>":app.db.getPropsName(a)});this.p_rtxContent.string="<color=#"+this.p_colContext.toHEX("#rrggbb")+">"+t+"</c>"}});cc._RF.pop()},{basePage:void 0}],windowsPageTipsOccu:[function(e,t){"use strict";cc._RF.push(t,"752304UO2BPM4IfCSMG+mbg","windowsPageTipsOccu");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagetipsoccu",pageType:1,createShot:!1},properties:{p_sprIntro:cc.Sprite},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0,1)},setParam:function(e){this.m_strOccu=e.occu;var t=gConfig.getFetterImagePathByOccu(e.occu-1);app.loadTexture(t,this.p_sprIntro,this.prefabPath)}});cc._RF.pop()},{basePage:void 0}],windowsPageTipsProp:[function(e,t){"use strict";cc._RF.push(t,"7e9ec44rQhHXJN7tRAoZR6H","windowsPageTipsProp");var a=[{bg:680},{bg:835}],i=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagetipsprop",pageType:1},properties:{p_nodeTop:cc.Node,p_arrNodeTitle:[cc.Node],p_labName:cc.Label,p_pfbPorp:cc.Prefab,p_nodeProp:cc.Node,p_labNumTips:cc.Label,p_labNum:cc.Label,p_labTitleIntro:cc.Label,p_labIntro:cc.RichText,p_nodeUse:cc.Node,p_labTitleNum:cc.Label,p_nodeGet:cc.Node,p_nodeChip:cc.Node,p_btnDown:cc.Button,p_btnUp:cc.Button,p_nodeBtn:cc.Node,p_nodeCost:cc.Node,p_btnUse:cc.Button,p_btnBuy:cc.Button,p_btnCheck:cc.Button,p_sliderNode:cc.Node,p_proBar:cc.ProgressBar,p_sliderCount:cc.Label},onLoad:function(){i.instance=this,this.handleUI(),this.stopBgNodeEvent(),this.creatMask(!0)},start:function(){},handleUI:function(){var e=this;this._super(),this.p_btnUse.node.on("click",function(){app.playSound("click"),e.onClickUse()}),this.p_btnCheck.node.on("click",function(){app.playSound("click");var t={isShowMode:!0};t.gsid=e.m_strPropGsid-1e4,t.tips="general",t.target=e,app.pages.generalpage.showPage(t)}),this.p_btnBuy.node.on("click",function(){app.playSound("click"),e.onClose(),e.m_funCb&&e.m_funCb(),e.m_confirmCb&&e.m_confirmCb.apply(e.m_target,null)}),this.p_btnUp.node.on("click",function(){app.playSound("click"),e.setNumUse(e.m_numEx+1)}),this.p_btnDown.node.on("click",function(){app.playSound("click"),e.setNumUse(e.m_numEx-1)}),this.p_sliderNode.on("slide",function(){var t=e.p_sliderNode.getComponent(cc.Slider).progress,a=Math.round(e.m_numMaxEx*t),i=e.m_numMaxEx<=0?0:1;a=cc.misc.clampf(a,i,e.m_numMaxEx),e.setNumUse(a)},this)},setParam:function(e){cc.log(e),this.m_strPropGsid=e.gsid,this.m_strPropCount=e.count,this.m_strShowType=e.type||"normal",this.m_funCb=e.funcb,e.data&&(this.m_data=e.data),e.target&&(this.m_target=e.target),e.confirmcb&&(this.m_confirmCb=e.confirmcb),this.refreshUI()},refreshUI:function(){var e=app.db.getPropsInfoByGsid(this.m_strPropGsid),t=app.db.getTypeByGsid(this.m_strPropGsid);if(e){if(this.m_objPropBase=e,this.m_strPorpType=t,e.CHIP){var a=Math.floor(this.m_strPropCount/e.CHIP);this.m_numMaxEx=a}else this.m_numMaxEx=this.m_strPropCount;this.m_nodeItem||(this.m_nodeItem=cc.instantiate(this.p_pfbPorp),this.m_nodeItem.parent=this.p_nodeProp,this.m_nodeItem.setPosition(cc.v2(0,0))),this.m_nodeItem.getComponent("propItem").initForGsid(this.m_strPropGsid,this.m_strPropCount),this.p_labName.string=e.NAME;var i=app.player.getCount(this.m_strPropGsid);switch(this.p_labNumTips.string=langMgr.getString("windowsPageTipsProp",0),this.p_labNum.string=i,this.p_labIntro.string=e.INTRO,this.m_strShowType){case"tips":this.p_nodeCost.active=!1,this.p_btnBuy.node.active=!1,this.p_btnUse.node.active=!1,this.p_btnCheck.node.active=!1,this.p_nodeUse.active=!1,this.p_arrNodeTitle[0].active=!0,this.p_arrNodeTitle[1].active=!1;break;case"buy":this.p_nodeCost.getComponent("getItem").refreshUI(this.m_data.COIN,this.m_data.PRICE,!0),this.p_nodeCost.active=!0,this.p_btnBuy.node.active=!0,this.p_btnUse.node.active=!1,this.p_btnCheck.node.active=!1,this.p_nodeUse.active=!1,this.p_arrNodeTitle[0].active=!0,this.p_arrNodeTitle[1].active=!1;break;default:this.setByPropType(t)}}},setByPropType:function(e){var t=this;switch(this.p_nodeCost.active=!1,this.p_btnBuy.node.active=!1,console.log(e),this.p_btnCheck.node.active=!1,e){case"generalchip":this.p_btnCheck.node.active=!0;case"treaschip":case"trandomchip":case"grandomchip":this.p_nodeUse.active=!0,this.p_btnUse.node.active=!0,this.setNumUse(),this.p_nodeChip.active=!0,this.p_nodeGet.active=!1,this.p_nodeChip.getComponent("costItem").refreshUI(this.m_strPropGsid,this.m_objPropBase.CHIP,this),this.setWindowsSize(1),this.p_arrNodeTitle[0].active=!1,this.p_arrNodeTitle[1].active=!0;break;case"reap":this.p_nodeUse.active=!0,this.p_btnUse.node.active=!0,this.p_btnCheck.node.active=!1,app.player.sfReapPreview(this.m_strPropGsid,1,function(e,a){e?app.showNotice(e):(t.m_arrGetOne=a.items,t.setNumUse())}),this.p_nodeChip.active=!1,this.p_nodeGet.active=!0,this.setWindowsSize(1),this.p_arrNodeTitle[0].active=!0,this.p_arrNodeTitle[1].active=!1;break;default:this.p_nodeCost.active=!1,this.p_btnBuy.node.active=!1,this.p_btnUse.node.active=!1,this.p_btnCheck.node.active=!1,this.p_nodeUse.active=!1,this.setWindowsSize(0),this.p_arrNodeTitle[0].active=!0,this.p_arrNodeTitle[1].active=!1}},setWindowsSize:function(e){var t=a[e];this.p_bgNode.height=t.bg,this.p_nodeTop.getComponent(cc.Widget).updateAlignment(),this.p_nodeBtn.getComponent(cc.Widget).updateAlignment()},setNumUse:function(e){if(e||0==e||(e=this.m_numMaxEx),this.m_numMaxEx<=0?e=0:(e=Math.max(1,e),e=Math.min(this.m_numMaxEx,e)),this.m_numEx=e,"reap"==this.m_strPorpType){var t=this.getReapTotal(this.m_numEx);this.p_nodeGet.getComponent("getArrItem").refreshUI(t)}var a=this.m_numMaxEx<=0?0:e/this.m_numMaxEx;this.p_sliderNode.getComponent(cc.Slider).progress=a,this.p_proBar.progress=a,this.p_sliderCount.string=e+"/"+this.m_numMaxEx,this.p_btnUp.interactable=this.m_numEx<this.m_numMaxEx,this.p_btnDown.interactable=this.m_numEx>1},getReapTotal:function(e){for(var t=[],a=0;a<this.m_arrGetOne.length;++a){var i=this.m_arrGetOne[a];t.push({GSID:i.GSID,COUNT:i.COUNT*e})}return t},onClickUse:function(){switch(this.m_strPorpType){case"generalchip":case"grandomchip":case"treaschip":case"trandomchip":this.onExGeneralChip();break;case"reap":this.onExReap()}},onExGeneralChip:function(){this.m_numEx<=0?app.showNotice(langMgr.getString("windowsPageTipsProp",1)):this.onEx(this.m_numEx)},onExReap:function(){var e=this;app.player.sfReapExec(this.m_strPropGsid,this.m_numEx,function(t,a){e.onClose(),e.m_funCb&&e.m_funCb();var i={showtype:1,reward:a.items,target:e};app.pages.windowspagereward.showPage(i)})},onEx:function(e){var t=this,a=app.db.getTypeByGsid(this.m_strPropGsid);if(("grandomchip"==a||"generalchip"==a)&&app.player.gnum+e>app.player.bagspace){var i={content:langMgr.getString("windowsPageTipsProp",2),confirmcb:function(){app.goToPage(1018)},target:this};app.pages.windowspagetipsmsg.showPage(i)}else{var n=app.db.getPropsInfoByGsid(this.m_strPropGsid);if("grandomchip"==a||"generalchip"==a){if(!n.EXID)return;app.player.sfExchange(n.EXID,e,null,function(e){app.player.sfPlayerData(function(){cc.director.emit("ex_chips_end"),t.onClose(),t.m_funCb&&t.m_funCb();var a={showtype:1,reward:e,confirmcb:function(){app.showRecommendGift()},target:t};app.pages.windowspagereward.showPage(a)})})}else app.player.sfExchange(n.EXID,e,null,function(e){app.player.sfPlayerData(function(){cc.director.emit("ex_chips_end"),t.onClose(),t.m_funCb&&t.m_funCb();var a={showtype:1,reward:e,target:t};app.pages.windowspagereward.showPage(a)})})}},ExCb:function(){},onClose:function(){this._super()}});cc._RF.pop()},{basePage:void 0}],windowsPageTipsQxsy:[function(e,t){"use strict";cc._RF.push(t,"56a5fEtTzNHToqRM7yCjPI0","windowsPageTipsQxsy");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagetipsqxsy",pageType:1},properties:{p_nodeParent:cc.Layout,p_pfItem:cc.Prefab,p_labNum:cc.Label,p_nodeFinish:cc.Node,p_nodeReward:cc.Node,p_labTitle:cc.Label},onLoad:function(){if(a.instance=this,this.handleUI(),this.creatMask(!0,150),!this.m_arrItems){this.m_arrItems=[];var e=cc.instantiate(this.p_pfItem);e.scale=.8,e.parent=this.p_nodeParent.node,this.m_arrItems.push(e)}},handleUI:function(){this._super()},setParam:function(e){this.m_objData=e,this.refreshUI()},refreshUI:function(){this.m_arrItems=this.m_arrItems||[];for(var e=this.m_objData.items,t=0,a=0;a<e.length;++a)if(!(e[a].GSID>9e4)){var i=this.m_arrItems[t];i||((i=cc.instantiate(this.p_pfItem)).scale=.8,i.parent=this.p_nodeParent.node,this.m_arrItems.push(i)),i.active=!0,i.getComponent("propItem").initForBag(e[a]),i.getComponent("propItem").setClick(!0),++t}this.p_nodeFinish.active=this.m_objData.finishState,this.p_nodeReward.active=!this.m_objData.finishState,this.p_labTitle.string=this.m_objData.TITLE||"",this.m_objData.finishState||(this.p_labNum.string=this.m_objData.consume[0].COUNT)}});cc._RF.pop()},{basePage:void 0}],windowsPageTipsRestrain:[function(e,t){"use strict";cc._RF.push(t,"b1000eUWlpB+KKL+UdmCTp6","windowsPageTipsRestrain");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagetipsrestrain",pageType:1},properties:{},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.creatMask(!0)}});cc._RF.pop()},{basePage:void 0}],windowsPageTipsRewards:[function(e,t){"use strict";cc._RF.push(t,"7584fd5lwFLhIwMQaffRfRZ","windowsPageTipsRewards");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagetipsrewards",pageType:1},properties:{p_layoutRewards:cc.Layout,p_nodeItem:cc.Prefab,p_pfbPropItem:cc.Prefab},onLoad:function(){a.instance=this,this.handleUI(),this.creatMask(!0)},handleUI:function(){this._super()},refreshTView:function(e){this.m_arrItems||(this.m_arrItems=[]);var t=0;if("object"==typeof e[0]){for(var a=0;a<e.length;++a)t+=e[a].chance||e[a].CHANCE||0;for(var i=0;i<e.length;++i){var n,r,o,s,p,c,h,l,g,d,u,f,m=this.getRewardItem(i),_=null!=(n=e[i].gsid)?n:e[i].GSID,v=null!=(r=e[i].count)?r:e[i].COUNT,b=null!=(o=null!=(s=e[i].chance)?s:e[i].CHANCE)?o:0,y=null!=(p=null!=(c=e[i].day)?c:e[i].DAY)?p:0,P=null!=(h=null!=(l=e[i].have)?l:e[i].HAVE)?h:0,w=null==(g=m.getChildByName("PropContent"))?void 0:g.getChildByName("porp_item");if(app.setNodeState(w,!1),m.getChildByName("tx_lingqu").active=!1,v?null==w||null==(u=w.getComponent("propItem"))||u.initForBag(e[i]):null==w||null==(f=w.getComponent("propItem"))||f.initForGsid(_),b){m.getChildByName("lab_rand").active=!0;var I=100*b/t;I=Math.round(100*I)/100,m.getChildByName("lab_rand").getComponent(cc.Label).string=I+"%"}else y?(m.getChildByName("lab_rand").active=!0,m.getChildByName("lab_rand").getComponent(cc.Label).string=langMgr.getString("windowsPageTipsRewards",0,y),P&&(app.setNodeState(w,!0),m.getChildByName("tx_lingqu").active=!0)):m.getChildByName("lab_rand").active=!1;null==w||null==(d=w.getComponent("propItem"))||d.setClick(!0)}}else for(var S=0;S<e.length;++S){var C,N,k,T=this.getRewardItem(S),R=null==(C=T.getChildByName("PropContent"))?void 0:C.getChildByName("porp_item");T.getChildByName("lab_rand").active=!1,null==R||null==(N=R.getComponent("propItem"))||N.initForGsid(e[S]),null==R||null==(k=R.getComponent("propItem"))||k.setClick(!0)}for(var B=e.length;B<this.m_arrItems.length;++B)this.m_arrItems[B].active=!1},setParam:function(e){this.m_objData=e,this.refreshUI()},refreshUI:function(){this.refreshTView(this.m_objData)},getRewardItem:function(e){var t=this.m_arrItems[e];if(cc.isValid(t))t.active=!0;else{t=cc.instantiate(this.p_nodeItem),this.p_layoutRewards.node.addChild(t),this.m_arrItems[e]=t;var a=t.getChildByName("PropContent");if(cc.isValid(a)){var i=cc.instantiate(this.p_pfbPropItem);a.addChild(i),i.setPosition(cc.Vec2.ZERO)}}return t}});cc._RF.pop()},{basePage:void 0}],windowsPageTipsSkill:[function(e,t){"use strict";cc._RF.push(t,"ecabcu/la9GwrdMG1HUFkYg","windowsPageTipsSkill");var a=[[101,201],[101,141],[101,161],[101,181]],i=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagetipsskill",pageType:1,createShot:!1},properties:{p_labName:cc.Label,p_nodeType1:cc.Node,p_nodeType2:cc.Node,p_rtxIntro:cc.RichText,p_labTips:cc.Label,p_spSkillIcon:cc.Sprite,p_labSkillLv:cc.Label,p_labSkillCategory:cc.Label,p_richTExtraIntroduce:cc.RichText},onLoad:function(){i.instance=this,this.handleUI(),this.stopBgNodeEvent(),this.creatMask(!0,1)},start:function(){},handleUI:function(){this._super()},setParam:function(e){this.m_strType=e.type,this.m_strSkillGsid=e.gsid,this.m_numSkillIndex=e.index,this.m_isLock=e.lock,this.m_worldPos=e.worldpos,this.refreshUI()},refreshUI:function(){var e=app.db.getSkillInfoByGsid(this.m_strSkillGsid);if(cc.log(e),e){var t=app.db.getSkillPathByGsid(this.m_strSkillGsid);app.loadTexture(t,this.p_spSkillIcon),this.p_labName.string=e.NAME||"",this.p_labSkillLv.string="Lv."+e.LEVEL,this.p_labSkillCategory.string=langMgr.getString("windowsPageTipsSkill",5)+""+(1==e.TYPE?langMgr.getString("windowsPageTipsSkill",3):langMgr.getString("windowsPageTipsSkill",4));var i=Boolean(e.EXTRA_INTRO);if(this.p_richTExtraIntroduce.node.parent.active=i,i&&(this.p_richTExtraIntroduce.string=e.EXTRA_INTRO),this.p_rtxIntro.string=e.INTRO||"","general"==this.m_strType){var n=app.db.getGSkillUnLockClass()[this.m_numSkillIndex];if(this.m_isLock){var r=1;n>0&&(r=app.db.dbGeneralClass[n-1].MAXLV+1),this.p_labTips.string=langMgr.getString("windowsPageTipsSkill",0,r)}else{var o=a[this.m_numSkillIndex][e.LEVEL-1];this.p_labTips.string=o?langMgr.getString("windowsPageTipsSkill",2,o):langMgr.getString("windowsPageTipsSkill",1)}}else this.p_labTips.string="";if("mount"===this.m_strType){this.p_labTips.node.active=!1,cc.isValid(this.p_nodeType2)&&(this.p_nodeType2.active=!1);var s=this.p_labName.string[this.p_labName.string.length-1];isNaN(Number(s))||(this.p_labName.string=this.p_labName.string.slice(0,this.p_labName.string.indexOf("(")))}this.setPos()}},setPos:function(){if(this.m_worldPos){var e=this.node.convertToNodeSpaceAR(this.m_worldPos),t=e.x,a=-this.p_bgNode.parent.width/2+this.p_bgNode.width/2,i=-a;t=Math.max(a,t),t=Math.min(i,t);var n=e.y+this.p_bgNode.height/2;this.p_bgNode.setPosition(cc.v2(t,n))}else this.p_bgNode.setPosition(cc.v2(0,0))}});cc._RF.pop()},{basePage:void 0}],windowsPageTipsSoulStoneInfo:[function(e,t){"use strict";cc._RF.push(t,"f37b1t/XMVBoKD9sD6cuDKI","windowsPageTipsSoulStoneInfo");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagetipssoulstoneinfo",pageType:1,SHOW_TYPE:{TEMPLE:"temple",STONE_BAG:"bag",GENERAL:"general",REWARD:"reward"}},properties:{p_nodeTop:cc.Node,p_nodeFrameInfo:cc.Node,p_nodeIntro:cc.Node,p_nodeBtn:cc.Node,p_nodeInfoProp:cc.Node,p_nodeStone:cc.Node,p_labName:cc.Label,p_arrNodeProp:[cc.Node],p_arrNodeAttr:[cc.Node],p_labIntro:cc.Label,p_btnCuilian:cc.Button,p_btnXiexia:cc.Button,p_btnOn:cc.Button},onLoad:function(){a.instance=this,this.handleUI(),this.stopBgNodeEvent(),this.creatMask(!0),this.setWindowsSize()},handleUI:function(){var e=this;this._super(),this.p_btnCuilian.node.on("click",function(){app.playSound("click"),e.onClose();var t={isGoToCL:!0,stone:app.db.getPropsInfoByGsid(e.m_stoneData.gsid)};t.stone.gsid=e.m_stoneData.gsid,t.stone.guid=e.m_stoneData.guid,t.stone.main=e.m_stoneData.main,t.stone.rand=e.m_stoneData.rand,app.pages.soultemplepage.showPage(t)}),this.p_btnXiexia.node.on("click",function(){app.playSound("click"),app.player.sfSoulStoneOff(e.m_generalGuid,e.m_stoneData.guid,e.m_stonePos,function(t,a){e.onClose(),app.player.sfPlayerByParam(["soulstones"],function(){app.pages.generalpage.instance.refreshInfo(a)})})}),this.p_btnOn.node.on("click",function(){app.playSound("click"),e.m_banStonePtypes.indexOf(e.m_stoneData.pType)>=0?app.showNotice("\u5df2\u6fc0\u6d3b\u540c\u7c7b\u578b\u517d\u9b42"):app.player.sfSoulStoneOn(e.m_generalGuid,e.m_stoneData.guid,e.m_stonePos,function(t,a){e.onClose(),app.pages.soulstonebagpage.instance&&app.pages.soulstonebagpage.instance.onClose(),app.player.sfPlayerByParam(["soulstones"],function(){app.pages.generalpage.instance.refreshInfo(a)})})})},setParam:function(e){this.showType=e.showType||e.type,this.m_stoneData=e.stone,this.m_stonePos=e.stonePos,this.m_generalGuid=e.guid,this.m_banStonePtypes=app.pages.generalbaghandbookpage.checkStoneOn(this.m_stonePos,this.m_generalGuid),this.refreshUI()},refreshUI:function(){var e=this,t=this.m_stoneData.gsid,i=(this.m_stoneData.guid,app.db.getPropsInfoByGsid(t));if(i){this.p_nodeStone.getComponent("soulStItem").refreshUI({stone:i,click:!0}),this.p_labName.string=i.NAME,this.p_labIntro.string=i.INTRO||"";var n=Object.keys(this.m_stoneData.main);if(this.p_arrNodeProp.forEach(function(t,a){if(n[a]){var i={KEY:n[a],VAL:e.m_stoneData.main[n[a]]};t.active=!0,t.getComponent("propertyItem").refreshUI(i)}else cc.log("no prop",a),t.active=!1}),this.m_stoneData.rand){var r=Object.keys(this.m_stoneData.rand);this.p_arrNodeAttr.forEach(function(t,a){if(r[a]){var i={KEY:r[a],VAL:e.m_stoneData.rand[r[a]]};t.active=!0,t.getComponent("propertyItem").refreshUI(i)}else cc.log("no prop",a),t.active=!1})}else this.p_arrNodeAttr.forEach(function(e){e.active=!1});this.p_btnCuilian.node.active="tips"!==this.showType&&this.showType!==a.SHOW_TYPE.TEMPLE&&5==i.STAR,this.p_btnXiexia.node.active=this.showType===a.SHOW_TYPE.GENERAL,this.p_btnOn.node.active=this.showType===a.SHOW_TYPE.STONE_BAG}},setWindowsSize:function(){this.p_nodeTop.getComponent(cc.Widget).updateAlignment(),this.p_nodeFrameInfo.getComponent(cc.Widget).updateAlignment(),this.p_nodeIntro.getComponent(cc.Widget).updateAlignment(),this.p_nodeBtn.getComponent(cc.Widget).updateAlignment(),this.p_btnClose.getComponent(cc.Widget).updateAlignment(),this.p_nodeInfoProp.getComponent(cc.Widget).updateAlignment()},onDestroy:function(){this._super(),cc.director.targetOff(this)}});cc._RF.pop()},{basePage:void 0}],windowsPageTipsTalent:[function(e,t){"use strict";cc._RF.push(t,"50e9eOpzGZDM5VkShDuBDxa","windowsPageTipsTalent");var a={HP:"\u751f\u547d",PATKDAM:"\u5e73\u780d",PASP:"\u653b\u901f",PCRI:"\u66b4\u51fb",PCRID:"\u66b4\u4f24",PMPS:"\u56de\u80fd",PSKIDAM:"\u6280\u80fd\u4f24\u5bb3",PPBS:"\u7269\u5438",PMBS:"\u6cd5\u5438",PEFC:"\u514d\u63a7",PDEX:"\u95ea\u907f",PMDEX:"\u62b5\u6297",PDAM:"\u4f24\u5bb3",ATK:"\u653b\u51fb"},i=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagetipstalent",pageType:1},properties:{p_labName:cc.Label,p_labIntro:cc.Label},onLoad:function(){i.instance=this,this.handleUI(),this.stopBgNodeEvent(),this.creatMask(!0,1)},start:function(){},handleUI:function(){this._super()},setParam:function(e){for(var t=e.mid,i=e.id,n=app.player.mythical[t].talent||[],r={},o=0;o<n.length;o++)if(n[o][i])for(var s in n[o][i].attr)r[s]||(r[s]=0),r[s]+=n[o][i].attr[s];var p=[];for(var c in r)p.push({key:c,val:r[c]});this.p_labName.string=e.title;var h="";p.length||(h="\u6682\u65e0\u52a0\u6210");for(var l=0;l<p.length;l++)0!=l&&(h+="  "),h+=a[p[l].key]+" +"+p[l].val;this.p_labIntro.string=h}});cc._RF.pop()},{basePage:void 0}],windowsPageTipsTreas:[function(e,t){"use strict";cc._RF.push(t,"43d9feV6jVE7IIZSx2nQA9Z","windowsPageTipsTreas"),e("../utils/gameConfig");var a=[[{bg:760,frame:175},{bg:800,frame:375}],[{bg:940,frame:360},{bg:980,frame:560}],[{bg:1080,frame:500},{bg:1120,frame:700}]],i=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagetipstreas",pageType:1},properties:{p_nodeTop:cc.Node,p_nodeFrameProp:cc.Node,p_nodeSkill:cc.Node,p_nodeAwakenProp:cc.Node,p_nodeIntro:cc.Node,p_nodeBtn:cc.Node,p_nodeInfoProp:cc.Node,p_nodeTreas:cc.Node,p_pfbPorp:cc.Prefab,p_labName:cc.Label,p_arrNodeProp:[cc.Node],p_arrNodeSkill:[cc.Node],p_arrSprAwakenProp:[cc.Sprite],p_labTitleSkill:cc.Label,p_labTitleAwaken:cc.Label,p_labIntro:cc.Label,p_btnOff:cc.Button,p_btnOn:cc.Button,p_btnChange:cc.Button,p_btnUp:cc.Button,p_btnAwaken:cc.Button,p_nodeBuy:cc.Node,p_btnBuy:cc.Button,p_nodeCost:cc.Node,p_redPoint:cc.Node,p_nodeQLv:cc.Node,p_qulityLv:cc.Label,p_btnReset:cc.Button},onLoad:function(){i.instance=this,this.handleUI(),this.stopBgNodeEvent(),this.creatMask(!0)},start:function(){},handleUI:function(){var e=this;this._super(),this.p_btnBuy.node.on("click",function(){app.playSound("click"),e.onClose(),e.m_confirmCb&&e.m_confirmCb.apply(e.m_target,null)}),this.p_btnReset.node.on("click",function(){app.playSound("click"),app.player.sfTreasResetGet(e.m_strTreasGuid,function(t,a){app.pages.windowsPageTreasReset.showPage({general:e.m_strGeneralGuid,prop:a,target:e})})}),this.p_btnOff.node.on("click",function(){app.playSound("click"),e.onClickBtnOff()}),this.p_btnUp.node.on("click",function(){app.playSound("click"),e.onClickBtnUp()}),this.p_btnAwaken.node.on("click",function(){app.playSound("click"),e.onClickBtnUp()}),this.p_btnOn.node.on("click",function(){app.playSound("click"),e.onClickBtnOn()}),this.p_btnChange.node.on("click",function(){app.playSound("click"),e.onClickBtnChange()})},setParam:function(e){this.m_strGeneralGuid=e.general,this.m_strTreasGsid=e.gsid,this.m_strTreasGuid=e.guid,this.m_treasureInfo=e.treasure,this.m_numTreasCount=e.count,this.m_numShowType=e.type,this.m_funCb=e.funcb,this.m_upCb=e.upcb,e.data&&(this.m_data=e.data),e.target&&(this.m_target=e.target),e.confirmcb&&(this.m_confirmCb=e.confirmcb),this.isHideBtn=void 0!==e.isHideBtn&&e.isHideBtn,this.refreshUI()},refreshUI:function(){if(!this.m_treasureInfo)switch(this.m_numShowType){case 1:this.m_treasureInfo=app.player.general[this.m_strGeneralGuid].treasure;break;default:this.m_strTreasGuid?this.m_treasureInfo=app.player.treas[this.m_strTreasGuid]:this.m_treasureInfo=app.player.treas[this.m_strTreasGsid]}var e=app.db.getTBaseByGsid(this.m_strTreasGsid);if(e){if(this.m_objBase=e,this.m_nodeItem||(this.m_nodeItem=cc.instantiate(this.p_pfbPorp),this.m_nodeItem.parent=this.p_nodeTreas,this.m_nodeItem.setPosition(cc.v2(0,0))),this.m_nodeItem.getComponent("propItem").initForGsid(this.m_strTreasGsid),this.p_nodeQLv.active=e.QUALITY>4,this.p_qulityLv.string=""+e.QLEVEL,this.p_labTitleAwaken.string=langMgr.getString("windowspagetipstreas",1),this.m_treasureInfo&&this.m_treasureInfo.property)for(var t=this.m_treasureInfo.property,a=0;a<t.length;a++){var i=gConfig.getTreasurePropPath(t[a].key),n=this.p_arrSprAwakenProp[a];app.loadTexture(i,n,this.prefabPath)}this.p_labName.string=e.NAME,this.p_labIntro.string=e.INTRO;var r=[];if(this.m_treasureInfo&&this.m_treasureInfo.property){for(var o=Number(this.m_strTreasGsid)-(e.STAR-5-this.m_treasureInfo.property.length),s=app.db.dbTreasureAwaken.TREASURE[o],p=0;p<e.PROP.length;p++)if(e.PROP[p].KEY){var c=Number(e.PROP[p].VAL)+Number(s.PROP[p]),h={KEY:e.PROP[p].KEY,VAL:c};r.push(h)}}else r=e.PROP;this.p_arrNodeProp.forEach(function(e,t){if(r[t]){e.active=!0;var a=r[t];e.getComponent("propertyItem").refreshUI(a)}else cc.log("no prop",t,r[t]),e.active=!1}),this.p_labTitleSkill.string=langMgr.getString("windowspagetipstreas",0);var l=e.SKILL,g=0;switch(this.p_arrNodeSkill.forEach(function(e,t){if(l[t]){e.active=!0;var a=l[t];e.getComponent("skillIExclusItem").refreshUI(a),++g}else e.active=!1}),this.p_nodeSkill.active=Boolean(g>0),this.setWindowsSize(g),this.m_numShowType){case 1:this.m_objBase.QUALITY>=6&&this.m_objBase.STAR>=6&&this.m_treasureInfo&&!this.m_treasureInfo.awake?(this.p_btnAwaken.node.active=!this.isHideBtn,this.p_btnUp.node.active=!1):(this.p_btnAwaken.node.active=!1,this.p_btnUp.node.active=Boolean(!this.isHideBtn&&this.m_objBase.NEXT)),this.p_btnReset.node.active=this.m_treasureInfo&&this.m_treasureInfo.property,this.p_btnOff.node.active=!this.isHideBtn,this.p_btnChange.node.active=!this.isHideBtn,this.p_btnOn.node.active=!1,this.m_treasureInfo.property&&this.m_treasureInfo.property.length>=3||this.m_objBase.QUALITY<6&&!this.m_objBase.NEXT?this.p_nodeBtn.getComponent(cc.Layout).spacingX=80:this.p_nodeBtn.getComponent(cc.Layout).spacingX=0,this.p_nodeBtn.active=!0,this.p_nodeBuy.active=!1;break;case 2:this.p_btnUp.node.active=!1,this.p_btnAwaken.node.active=!1,this.p_btnReset.node.active=!1,this.p_btnOff.node.active=!1,this.p_btnChange.node.active=!1,this.p_btnOn.node.active=!0,this.p_nodeBtn.active=!0,this.p_nodeBuy.active=!1;break;case 3:this.p_btnUp.node.active=!1,this.p_btnAwaken.node.active=!1,this.p_btnReset.node.active=!1,this.p_btnOff.node.active=!1,this.p_btnChange.node.active=!1,this.p_btnOn.node.active=!1,this.p_nodeBtn.active=!1,this.p_nodeBuy.active=!1;break;case"buy":this.p_btnReset.node.active=!1,this.p_nodeBuy.active=!0,this.p_nodeCost.active=!0,this.p_nodeCost.getComponent("getItem").refreshUI(this.m_data.COIN,this.m_data.PRICE,!0),this.p_btnBuy.node.active=!0,this.p_nodeBtn.active=!1;break;default:this.p_nodeBuy.active=!1,this.p_nodeBtn.active=!1,this.p_btnReset.node.active=!1}if(cc.isValid(this.p_redPoint))try{var d=app.pages.generalbaghandbookpage;void 0===this.m_strGeneralGuid?this.p_redPoint.active=!1:this.p_redPoint.active=d.checkTreas(this.m_strGeneralGuid)}catch(u){cc.log(u),this.p_redPoint.active=!1}}},setWindowsSize:function(e){this.p_nodeAwakenProp.active=this.m_objBase.QUALITY>=6&&this.m_objBase.STAR>=6,this.p_nodeIntro.active=!this.p_nodeAwakenProp.active;var t=this.p_nodeAwakenProp.active?1:0,i=a[e][t];this.p_bgNode.height=i.bg,this.p_nodeFrameProp.height=i.frame,this.p_nodeTop.getComponent(cc.Widget).updateAlignment(),this.p_nodeFrameProp.getComponent(cc.Widget).updateAlignment(),this.p_nodeIntro.getComponent(cc.Widget).updateAlignment(),this.p_nodeBtn.getComponent(cc.Widget).updateAlignment()},onClickBtnOff:function(){var e=this;if(this.m_strGeneralGuid){var t=app.player.general[this.m_strGeneralGuid]?app.player.general[this.m_strGeneralGuid].power:0;app.player.sfTreasOff(this.m_strGeneralGuid,function(a,i){a?app.showNotice(a):app.player.sfPlayerData(function(){if(cc.isValid(e)){var a=app.player.general[e.m_strGeneralGuid]?app.player.general[e.m_strGeneralGuid].power:0;cc.director.emit("EVT_PLAY_POWER_ANIM",{curPower:a,beforePower:t}),e.onClose(),e.m_funCb&&e.m_funCb()}app.checkPageValid("generalpage")&&app.pages.generalpage.instance.refreshInfo(i)})})}},onClickBtnChange:function(){if(this.m_strGeneralGuid){var e={};e.general=this.m_strGeneralGuid,e.pos=6,this.onClose(),this.m_funCb&&this.m_funCb(),app.pages.windowspagelistequip.showPage(e)}},onClickBtnOn:function(){var e=this;if(this.m_strGeneralGuid){cc.log("treas on");var t=app.player.general[this.m_strGeneralGuid]?app.player.general[this.m_strGeneralGuid].power:0,a=this.m_strTreasGuid?this.m_strTreasGuid:this.m_strTreasGsid;app.player.sfTreasOn(this.m_strGeneralGuid,a,function(a,i){a?app.showNotice(a):app.player.sfPlayerData(function(){if(cc.isValid(e)){var a=app.player.general[e.m_strGeneralGuid]?app.player.general[e.m_strGeneralGuid].power:0;cc.director.emit("EVT_PLAY_POWER_ANIM",{curPower:a,beforePower:t})}e.onClose(),e.m_funCb&&e.m_funCb(),app.pages.windowspagelistequip.instance.onClose(),app.checkPageValid("generalpage")&&(i&&(i.clickTreasGsid=e.m_strTreasGsid),app.pages.generalpage.instance.refreshInfo(i))})})}},onClickBtnSell:function(){this.onClose();var e={gsid:this.m_strTreasGsid,maxcount:this.m_numTreasCount,type:"sell",confirmcb:this.sellCb,target:this};app.pages.windowspagesetnum.showPage(e)},onClickBtnLy:function(){},onClickBtnUp:function(){if(!(this.m_treasureInfo.property&&this.m_treasureInfo.property.length>=3)){this.onClose();var e={};this.m_strGeneralGuid&&(e.guid=this.m_strGeneralGuid),this.m_strTreasGuid&&(e.treasGuid=this.m_strTreasGuid),e.gsid=this.m_strTreasGsid,e.closecb=this.m_upCb,this.m_objBase.QUALITY>=6&&this.m_objBase.STAR>=6&&!this.m_treasureInfo.awake?app.pages.windowsPageTreasAwaken.showPage(e):app.pages.treasurestarpage.showPage(e)}},onClose:function(){this._super()},sellCb:function(e){app.player.sfTreasSell(this.m_strTreasGsid,e,function(e){e?app.showNotice(e):app.player.sfPlayerData(function(){app.pages.propbagpage.instance.setData(),app.pages.propbagpage.instance.refreshView(3)})})}});cc._RF.pop()},{"../utils/gameConfig":void 0,basePage:void 0}],windowsPageTreasAwakenSucc:[function(e,t){"use strict";cc._RF.push(t,"74f30ncnjJPLI/Z/nTlxSIb","windowsPageTreasAwakenSucc");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=cc._decorator,o=r.ccclass,s=r.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_nodeLevel=null,t.p_arrNodeProperty=[],t.p_arrSprFStar=[],t.p_sprProp=null,t.m_gsid=0,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},t.prototype.setStar=function(e,t){if(cc.isValid(e)){var a=null;if(t>10){a=gConfig.gHightStarBgPath;var i=null;if(!cc.isValid(e.children[0])){var n=new cc.Node("hightstarnum");n.addComponent(cc.Sprite),n.active=!0,e.addChild(n),i=n}i||(i=e.getChildByName("hightstarnum")),i.active=!0;var r=gConfig.getIconCommonStarNumPath(t-10);app.loadTexture(r,i.getComponent(cc.Sprite)),e.active=!0}else a=gConfig.getIconCommonStarPath(t-1),cc.isValid(e.children[0])&&(e.children[0].active=!1);app.loadTexture(a,e.getComponent(cc.Sprite)),e.active=!0}},t.prototype.setParam=function(e){this.m_general=e.general,this.refreshUI()},t.prototype.refreshUI=function(){this.m_generalInfo=app.player.general[this.m_general];var e=gConfig.getTreasurePropPath(this.m_generalInfo.treasure.property[this.m_generalInfo.treasure.property.length-1].key);app.loadTexture(e,this.p_sprProp,this.prefabPath),this.m_gsid=this.m_generalInfo.treasure.gsid;var t=app.db.getTIconByGsid(this.m_gsid);app.loadTexture(t,this.p_sprIcon,this.prefabPath);var a=app.db.getTBaseByGsid(this.m_gsid),i=this.setData(a,0),n=this.setData(a,1),r=a.NEXT?a.STAR+1:a.STAR;this.setStar(this.p_nodeLevel.getChildByName("old"),a.STAR>6?a.STAR+4:a.STAR),this.setStar(this.p_nodeLevel.getChildByName("new"),r+4),console.log("old_star:---------"+a.STAR),console.log("new_star:---------"+r);for(var o=0;o<i.length;o++){var s=i[o],p=n[o],c=this.p_arrNodeProperty[o];this.refreshProp(s,p,c)}for(o=i.length;o<this.p_arrNodeProperty.length;o++)this.p_arrNodeProperty[o].active=!1},t.prototype.refreshProp=function(e,t,a){if(cc.isValid(a)){a.active=!0;var i,n,r,o,s,p=a.getChildByName("name").getComponent(cc.Label),c=a.getChildByName("old").getComponent(cc.Label),h=a.getChildByName("new").getComponent(cc.Label);e&&(n=e.key||e.KEY,r=e.val||e.VAL),t&&(o=t.key||t.KEY,s=t.val||t.VAL),n&&(i=n),!n&&o&&(i=o);var l=app.db.getPropertyCnByEn(i),g=app.db.getPropertyIdByEn(i);g&&2==app.db.dbProperty[g].NUMTYPE&&(r=r/10+"%",(s||0==s)&&(s=s/10+"%")),p.string=l,c.string=r,h.string=s}},t.prototype.setNewData=function(e){for(var t=app.db.dbTreasureAwaken.TREASURE[this.m_gsid],a=[],i=0;i<e.length;i++)if(e[i].KEY){var n=Number(e[i].VAL)+Number(t.PROP[i]),r={KEY:e[i].KEY,VAL:n};a.push(r)}return a},t.prototype.setNowData=function(e){if(e.STAR<=6)return e.PROP;for(var t=e.PROP,a=Number(this.m_gsid)-1,i=app.db.dbTreasureAwaken.TREASURE[a],n=[],r=0;r<t.length;r++)if(t[r].KEY){var o=Number(t[r].VAL)+Number(i.PROP[r]),s={KEY:t[r].KEY,VAL:o};n.push(s)}return n},t.prototype.setData=function(e,t){var a,i=e.PROP;if(t)a=this.m_gsid;else{if(!(app.db.getTBaseByGsid(this.m_gsid).STAR>6))return i;a=Number(this.m_gsid)-1}for(var n=app.db.dbTreasureAwaken.TREASURE[a].PROP,r=[],o=0;o<i.length;o++){var s=i[o].VAL+n[o],p={KEY:i[o].KEY,VAL:s};r.push(p)}return r},t.prototype.onClose=function(){app.pages.generalpage.instance.refreshInfo(this.m_generalInfo),e.prototype.onClose.call(this)},t.prefabPath="windowsPageTreasAwakenSucc",t.pageType=1,n([s(cc.Node)],t.prototype,"p_nodeLevel",void 0),n([s(cc.Node)],t.prototype,"p_arrNodeProperty",void 0),n([s(cc.SpriteFrame)],t.prototype,"p_arrSprFStar",void 0),n([s(cc.Sprite)],t.prototype,"p_sprProp",void 0),a=n([o],t)}(e("basePage"));t.exports=p,cc._RF.pop()},{basePage:void 0}],windowsPageTreasAwaken:[function(e,t){"use strict";cc._RF.push(t,"5580d/JEllIApJgqnmcY9ZR","windowsPageTreasAwaken");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=e("../lang/langMgr"),o=cc._decorator,s=o.ccclass,p=o.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_sprIcon=null,t.p_btnAwaken=null,t.p_btnHelp=null,t.p_btnPreview=null,t.p_sprCostIcon=null,t.p_labCost=null,t.p_labCostRed=null,t.p_nodeLevel=null,t.p_arrNodeProperty=[],t.p_arrSprFStar=[],t.p_spAwakenAnim=null,t.p_arrPropNames=[],t.p_arrPropOlds=[],t.p_arrPropNews=[],t.p_labStarTitle=null,t.p_spTreasAnim=null,t.p_nodeOperaMask=null,t.m_gsid=0,t.m_guid=0,t.m_generalGuid=0,t.m_awakenCount=0,t.m_isAwaken=!1,t._isChanged=!1,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){var e=this;a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.fitTopMenu(),this.p_labStarTitle.string=r.getString("windowsPageTreasAwaken",0),this.p_btnAwaken.node.on("click",function(){if(!e.m_isAwaken){app.playSound("click"),e.m_isAwaken=!0;var t=app.db.dbTreasureAwaken.COST[e.m_awakenCount].COST;if(app.player.getCount(t.GSID)<t.COUNT){var a=app.db.getPropsInfoByGsid(t.GSID);return app.showNotice(r.getString("playerData",0,a.NAME)),void(e.m_isAwaken=!1)}app.player.sfTreasAdd(e.m_generalGuid,e.m_guid,function(t){t?e.m_isAwaken=!1:cc.isValid(e)&&(e._isChanged=!0,e.p_nodeOperaMask.active=!0,e.p_spTreasAnim.node.opacity=255,e.p_spTreasAnim.setAnimation(0,"effect",!1))})}}),this.p_spTreasAnim.setCompleteListener(function(){cc.isValid(e)&&(e.p_spTreasAnim.setCompleteListener(null),e.p_spAwakenAnim.node.opacity=255,e.p_spAwakenAnim.setAnimation(0,"effect",!1))}),this.p_spAwakenAnim.setCompleteListener(function(){e.p_spAwakenAnim.node.opacity=0,app.player.sfPlayerByParam(["props","others"],function(){app.pages.windowsPageTreasAwakenSucc.showPage({general:e.m_generalGuid}),cc.isValid(e)&&(e.m_isAwaken=!1,e.p_nodeOperaMask.active=!1,e.onClose())})}),this.p_btnPreview.node.on("click",function(){app.playSound("click"),app.pages.windowsPageTreasurePreview.showPage({count:e.m_len})})},t.prototype.setParam=function(e){this.m_guid=e.gsid,this.m_generalGuid=e.guid,this.refreshUI()},t.prototype.setStar=function(e,t){if(cc.isValid(e)){var a=null;if(t>10){a=gConfig.gHightStarBgPath;var i=null;if(!cc.isValid(e.children[0])){var n=new cc.Node("hightstarnum");n.addComponent(cc.Sprite),n.active=!0,e.addChild(n),i=n}i||(i=e.getChildByName("hightstarnum")),i.active=!0;var r=gConfig.getIconCommonStarNumPath(t-10);app.loadTexture(r,i.getComponent(cc.Sprite)),e.active=!0}else a=gConfig.getIconCommonStarPath(t-1),cc.isValid(e.children[0])&&(e.children[0].active=!1);app.loadTexture(a,e.getComponent(cc.Sprite)),e.active=!0}},t.prototype.refreshUI=function(){this.m_generalInfo=app.player.general[this.m_generalGuid]||[],this.m_gsid=this.m_generalInfo.treasure.gsid?this.m_generalInfo.treasure.gsid:this.m_generalInfo.treasure,this.m_len=this.m_generalInfo.treasure.property?this.m_generalInfo.treasure.property.length+1:1;var e=app.db.getTIconByGsid(this.m_gsid);app.loadTexture(e,this.p_sprIcon,this.prefabPath);var t=app.db.getTBaseByGsid(this.m_gsid),a=this.setData(t.PROP,0),i=this.setData(t.PROP,1),n=t.NEXT?t.STAR+1:t.STAR;this.setStar(this.p_nodeLevel.getChildByName("old"),t.STAR>6?t.STAR+4:t.STAR),this.setStar(this.p_nodeLevel.getChildByName("new"),n+4),console.log("old_star:---------"+t.STAR),console.log("new_star:---------"+n);for(var r=0;r<a.length;r++){var o=a[r],s=i[r],p=this.p_arrNodeProperty[r];this.refreshProp(o,s,p,r)}for(r=a.length;r<this.p_arrNodeProperty.length;r++)this.p_arrNodeProperty[r].active=!1,this.p_arrPropNames[r].string="",this.p_arrPropOlds[r].string="",this.p_arrPropNews[r].string="";this.m_awakenCount=t.STAR-6;var c=app.db.dbTreasureAwaken.COST[this.m_awakenCount].COST,h=app.db.getPropsIconPath(c.GSID);app.loadTexture(h,this.p_sprCostIcon,this.prefabPath),app.player.getCount(c.GSID)<c.COUNT?(this.p_labCost.node.active=!1,this.p_labCostRed.node.active=!0,this.p_labCostRed.string=app.player.getCount(c.GSID)+"/"+c.COUNT):(this.p_labCost.node.active=!0,this.p_labCostRed.node.active=!1,this.p_labCost.string=app.player.getCount(c.GSID)+"/"+c.COUNT)},t.prototype.refreshProp=function(e,t,a,i){a.active=!0;var n,r,o,s,p,c=this.p_arrPropNames[i],h=this.p_arrPropOlds[i],l=this.p_arrPropNews[i];e&&(r=e.key||e.KEY,o=e.val||e.VAL),t&&(s=t.key||t.KEY,p=t.val||t.VAL),r&&(n=r),!r&&s&&(n=s);var g=app.db.getPropertyCnByEn(n),d=app.db.getPropertyIdByEn(n);d&&2==app.db.dbProperty[d].NUMTYPE&&(o=o/10+"%",(p||0==p)&&(p=p/10+"%")),cc.isValid(c)&&(c.string=g),cc.isValid(h)&&(h.string=o),cc.isValid(l)&&(l.string=p)},t.prototype.setData=function(e,t){var a;if(t)a=this.m_gsid;else{if(!(app.db.getTBaseByGsid(this.m_gsid).STAR>6))return e;a=Number(this.m_gsid)-1}for(var i=app.db.dbTreasureAwaken.TREASURE[a].PROP,n=[],r=0;r<e.length;r++){var o=e[r].VAL+i[r],s={KEY:e[r].KEY,VAL:o};n.push(s)}return n},t.prototype.onClose=function(){if(e.prototype.onClose&&e.prototype.onClose.call(this),this._isChanged&&app.player.hasBeenSoulBind(this.m_generalGuid)){var t=app.player.getSoulBindGuid(this.m_generalGuid);t&&app.player.sfQueryGeneralListInfo([t])}},t.prefabPath="windowsPageTreasAwaken",n([p(cc.Sprite)],t.prototype,"p_sprIcon",void 0),n([p(cc.Button)],t.prototype,"p_btnAwaken",void 0),n([p(cc.Button)],t.prototype,"p_btnHelp",void 0),n([p(cc.Button)],t.prototype,"p_btnPreview",void 0),n([p(cc.Sprite)],t.prototype,"p_sprCostIcon",void 0),n([p(cc.Label)],t.prototype,"p_labCost",void 0),n([p(cc.Label)],t.prototype,"p_labCostRed",void 0),n([p(cc.Node)],t.prototype,"p_nodeLevel",void 0),n([p(cc.Node)],t.prototype,"p_arrNodeProperty",void 0),n([p(cc.SpriteFrame)],t.prototype,"p_arrSprFStar",void 0),n([p(sp.Skeleton)],t.prototype,"p_spAwakenAnim",void 0),n([p([cc.Label])],t.prototype,"p_arrPropNames",void 0),n([p([cc.Label])],t.prototype,"p_arrPropOlds",void 0),n([p([cc.Label])],t.prototype,"p_arrPropNews",void 0),n([p(cc.Label)],t.prototype,"p_labStarTitle",void 0),n([p(sp.Skeleton)],t.prototype,"p_spTreasAnim",void 0),n([p(cc.Node)],t.prototype,"p_nodeOperaMask",void 0),a=n([s],t)}(e("basePage"));t.exports=c,cc._RF.pop()},{"../lang/langMgr":void 0,basePage:void 0}],windowsPageTreasReset:[function(e,t){"use strict";cc._RF.push(t,"1c711eCQqRB2a69NE8ZrpP7","windowsPageTreasReset");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=e("langMgr"),o=cc._decorator,s=o.ccclass,p=o.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_sprIcon=null,t.p_btnReset=null,t.p_nodeSelect=null,t.p_sprSelectIcon=null,t.p_labCostNum=null,t.p_labCostNumRed=null,t.p_nodeOld=null,t.p_nodeNew=null,t.p_nodeItem=null,t.p_nodeWenHao=null,t.p_spAnim=null,t.p_btnHelp=null,t.p_btnCancel=null,t.p_btnOk=null,t.p_btnPreview=null,t.m_prop=null,t.m_newProp=null,t.m_closeType=!1,t.m_isReset=!1,t._isChanged=!1,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){var e=this;a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.fitTopMenu(),this.p_btnCancel.node.on("click",function(){app.playSound("click"),e.resetConfirm(0)}),this.p_btnOk.node.on("click",function(){app.playSound("click"),e.resetConfirm(1)}),this.p_btnReset.node.on("click",function(){if(app.playSound("click"),e.m_selectGsid){var t=app.player.treas[e.m_selectGsid].guid?app.player.treas[e.m_selectGsid].gsid:e.m_selectGsid,a=app.db.getTBaseByGsid(t);if(e.m_selectGsid.length>5||a.STAR>6){var i={content:r.getString("windowsPageTreasReset",0),confirmcb:function(){e.reset()},target:e};app.pages.windowspagetipsmsg.showPage(i)}else e.reset()}else app.showNotice(r.getString("windowsPageTreasReset",1))}),this.p_btnHelp.node.on("click",function(){app.playSound("click")}),this.p_nodeSelect.on("touchend",function(){e.m_isReset||(app.playSound("click"),app.pages.windowsPageTreasSelect.showPage({gsid:e.m_selectGsid,target:e}))}),this.p_sprSelectIcon.node.on("touchend",function(){e.m_isReset||(app.playSound("click"),app.pages.windowsPageTreasSelect.showPage({gsid:e.m_selectGsid,target:e}))}),this.p_btnPreview.node.on("click",function(){app.playSound("click"),app.pages.windowsPageTreasurePreview.showPage({count:e.m_len})})},t.prototype.reset=function(){var e=this;app.player.sfTreasReset(this.m_guid,this.m_selectGsid,function(t,a){t||app.player.sfPlayerByParam(["props","others"],function(){e.m_isReset=!0,e.p_spAnim.node.active=!0,e.p_spAnim.setAnimation(0,"shengji01",!1),e.refreshRightUI(a.property)})})},t.prototype.setParam=function(e){this.m_general=e.general,this.m_target=e.target,this.m_previewProp=e.prop;var t=app.player.general[this.m_general];this.m_len=t.treasure.property?t.treasure.property.length:1,this.m_gsid=t.treasure.gsid?t.treasure.gsid:t.treasure,this.m_guid=t.treasure.guid?t.treasure.guid:t.treasure,this.m_prop=t.treasure.property,this.refreshUI(),this.m_previewProp&&this.refreshRightUI(this.m_previewProp.property)},t.prototype.refreshUI=function(){if(this.p_nodeSelect.active=!this.m_selectGsid,this.p_sprSelectIcon.node.active=!!this.m_selectGsid,this.p_labCostNum.node.active=!!this.m_selectGsid,this.p_labCostNumRed.node.active=!this.m_selectGsid,this.m_selectGsid){var e=app.player.treas[this.m_selectGsid].guid?app.player.treas[this.m_selectGsid].gsid:this.m_selectGsid,t=app.db.getTIconByGsid(e);app.loadTexture(t,this.p_sprSelectIcon,this.prefabPath)}var a=app.db.getTIconByGsid(this.m_gsid);app.loadTexture(a,this.p_sprIcon,this.prefabPath);for(var i=0;i<this.m_prop.length;i++){var n=this.p_nodeOld.children[i];n||((n=cc.instantiate(this.p_nodeItem)).parent=this.p_nodeOld),n.active=!0;var r=n.getComponent(cc.Sprite),o=this.m_prop[i].key,s=gConfig.getTreasurePropPath(o);app.loadTexture(s,r,this.prefabPath)}for(i=this.m_prop.length;i<this.p_nodeOld.children.length;i++)this.p_nodeOld.children[i].active=!1;this.p_nodeNew.active=!1,this.p_nodeWenHao.active=!0,this.p_btnCancel.node.active=!1,this.p_btnOk.node.active=!1,this.p_btnReset.node.active=!0},t.prototype.refreshRightUI=function(e){this.m_newProp=e;for(var t=0;t<this.m_newProp.length;t++){var a=this.p_nodeNew.children[t];a||((a=cc.instantiate(this.p_nodeItem)).parent=this.p_nodeNew),a.active=!0;var i=a.getComponent(cc.Sprite),n=this.m_newProp[t].key,r=gConfig.getTreasurePropPath(n);app.loadTexture(r,i,this.prefabPath)}for(t=this.m_newProp.length;t<this.p_nodeNew.children.length;t++)this.p_nodeNew.children[t].active=!1;this.p_nodeNew.active=!0,this.p_nodeWenHao.active=!1,this.p_btnCancel.node.active=!0,this.p_btnOk.node.active=!0,this.p_btnReset.node.active=!1},t.prototype.resetConfirm=function(e){var t=this;app.player.sfTreasResetConfirm(this.m_general,this.m_guid,e,function(a,i){a||(t._isChanged=!0,t.m_isReset=!1,t.m_selectGsid=0,t.m_target.m_treasureInfo=i.general.treasure,app.pages.generalpage.instance&&cc.isValid(app.pages.generalpage.instance.node)&&app.pages.generalpage.instance.refreshInfo(i.general),e&&(t.m_prop=t.m_newProp),t.refreshUI())})},t.prototype.onClose=function(){if(this._isChanged&&app.player.hasBeenSoulBind(this.m_general)){var t=app.player.getSoulBindGuid(this.m_general);t&&app.player.sfQueryGeneralListInfo([t])}this.m_isReset?app.showNotice(r.getString("windowsPageTreasReset",2)):(this.m_target.refreshUI(),e.prototype.onClose.call(this))},t.prefabPath="windowsPageTreasReset",n([p(cc.Sprite)],t.prototype,"p_sprIcon",void 0),n([p(cc.Button)],t.prototype,"p_btnReset",void 0),n([p(cc.Node)],t.prototype,"p_nodeSelect",void 0),n([p(cc.Sprite)],t.prototype,"p_sprSelectIcon",void 0),n([p(cc.Label)],t.prototype,"p_labCostNum",void 0),n([p(cc.Label)],t.prototype,"p_labCostNumRed",void 0),n([p(cc.Node)],t.prototype,"p_nodeOld",void 0),n([p(cc.Node)],t.prototype,"p_nodeNew",void 0),n([p(cc.Node)],t.prototype,"p_nodeItem",void 0),n([p(cc.Node)],t.prototype,"p_nodeWenHao",void 0),n([p(sp.Skeleton)],t.prototype,"p_spAnim",void 0),n([p(cc.Button)],t.prototype,"p_btnHelp",void 0),n([p(cc.Button)],t.prototype,"p_btnCancel",void 0),n([p(cc.Button)],t.prototype,"p_btnOk",void 0),n([p(cc.Button)],t.prototype,"p_btnPreview",void 0),a=n([s],t)}(e("basePage"));t.exports=c,cc._RF.pop()},{basePage:void 0,langMgr:void 0}],windowsPageTreasSelect:[function(e,t){"use strict";cc._RF.push(t,"03a91p4uv9C354SlQhLe8So","windowsPageTreasSelect");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=cc._decorator,o=r.ccclass,s=r.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_btnOk=null,t.p_btnCancel=null,t.p_nodeTabView=null,t.m_selectGsid=-1,t.m_data=null,t.m_target=null,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){var e=this;a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.p_btnOk.node.on("click",function(){app.playSound("click"),e.m_target.m_selectGsid=e.m_selectGsid,e.m_target.refreshUI(),e.onClose()}),this.p_btnCancel.node.on("click",function(){app.playSound("click"),e.onClose()})},t.prototype.start=function(){},t.prototype.setParam=function(e){this.m_selectGsid=e.gsid,this.m_data=this.setData(),this.m_target=e.target,this.refresh()},t.prototype.setData=function(){var e=[],t=app.player.treas;for(var a in t){var i=t[a].gsid?t[a].gsid:a,n=app.db.getTBaseByGsid(i);if(n&&"34000"!=a){var r={gsid:i,count:t[a].count||1,guid:0};t[a].guid&&(r.guid=t[a].guid),n.QUALITY>=6&&n.QLEVEL<10&&e.push(r)}}return cc.log("equip list show data : ",e),e},t.prototype.refresh=function(){var e=this.m_data.length;this.p_nodeTabView.getComponent("tableView").initTableView(e,{array:this.m_data,gsid:this.m_selectGsid,target:this})},t.prefabPath="windowsPageTreasSelect",t.pageType=1,n([s(cc.Button)],t.prototype,"p_btnOk",void 0),n([s(cc.Button)],t.prototype,"p_btnCancel",void 0),n([s(cc.Node)],t.prototype,"p_nodeTabView",void 0),a=n([o],t)}(e("basePage"));t.exports=p,cc._RF.pop()},{basePage:void 0}],windowsPageTreasurePreview:[function(e,t){"use strict";cc._RF.push(t,"44ce8HhE+FBL7oFhvetIG9V","windowsPageTreasurePreview");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=e("langMgr"),o=cc._decorator,s=o.ccclass,p=o.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_nodeContent=null,t.p_labTitle=null,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0,150),this.handleUI(),this.p_labTitle.string=r.getString("windowsPageTreasurePreview",0)},t.prototype.setParam=function(e){this.m_count=e.count,this.refreshUI()},t.prototype.refreshUI=function(){for(var e=this.setData(),t=0;t<e.length;t++){var a=this.p_nodeContent.children[t];a||((a=cc.instantiate(this.p_nodeContent.children[0])).parent=this.p_nodeContent),a.active=!0;var i=gConfig.getTreasurePropPath(e[t].ATTR.toLowerCase());app.loadTexture(i,a.getComponent(cc.Sprite),this.prefabPath)}for(t=e.length;t<this.p_nodeContent.children.length;t++)this.p_nodeContent.children[t].active=!1},t.prototype.setData=function(){for(var e=app.db.dbTreasureAwaken.UATTRS,t=[],a=0;a<e.length;a++)e[a].LEVEL<=this.m_count&&t.push(e[a]);return t},t.prefabPath="windowsPageTreasurePreview",t.pageType=1,n([p(cc.Node)],t.prototype,"p_nodeContent",void 0),n([p(cc.Label)],t.prototype,"p_labTitle",void 0),a=n([s],t)}(e("basePage"));t.exports=c,cc._RF.pop()},{basePage:void 0,langMgr:void 0}],windowsPageTurn:[function(e,t){"use strict";cc._RF.push(t,"708d0AoEEFC0bZlKMvvP45X","windowsPageTurn");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspageturn",pageType:1},properties:{p_arrCard:[cc.Node],p_arrItem:[cc.Node],p_pfbItem:cc.Prefab,p_nodeNoTequan:cc.Node,p_nodeTequan:cc.Node,p_nodeFront:cc.Node,p_btnGoActive:cc.Button,p_labLeftDays:cc.Label,p_labTime:cc.Label},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!1),this.handleUI()},handleUI:function(){for(var e=this,t=function(t){e.p_arrCard[t].getChildByName("turn").active=!1,e.p_arrCard[t].on("touchend",function(){e._open||e.runTurn(t)})},a=0;a<this.p_arrCard.length;++a)t(a);this.p_btnGoActive.node.on("click",function(){e.onClose(),app.battleType?eventMgr.emit(eventStr.commonEvent.TurnEvent,1043):app.goToPage(1043)})},setParam:function(e){this.m_arrReward=e,this._open=!1,this.m_time=3,this.p_labTime.node.active=!1,this.bmaskclose=!1;for(var t=0;t<this.p_arrItem.length;++t)this.p_arrItem[t].active=!1;this.refreshUI()},refreshUI:function(){this._tequan=!0;for(var e=0;e<this.m_arrReward.length;++e)if(!this.m_arrReward[e].real){this._tequan=!1;break}if(this.p_nodeNoTequan.active=!this._tequan,this.p_nodeTequan.active=this._tequan,this.p_labLeftDays.node.active=this._tequan,this.p_btnGoActive.node.active=!1,this._tequan){var t=app.player.getServerTime(),a=app.player.special.specialbw;a||(a=0),cc.log(a,t);var i=Math.floor((a-t)/1e3/60/60)||1,n=i>24?langMgr.getString("windowsPageTurn",1,Math.ceil(i/24)):langMgr.getString("windowsPageTurn",2,i);this.p_labLeftDays.string=n}},runTurn:function(e){for(var t=this,a=[],i=[],n=0;n<this.m_arrReward.length;++n)this.m_arrReward[n].real?a.push(n):i.push(n);if(a.length<=1){this.p_arrItem[e].getComponent("propItem").initForBag(this.m_arrReward[0]),this.p_arrItem[e].getComponent("propItem").setClick(!0);var r=this.p_arrCard[e].getChildByName("ImgSpecial");cc.isValid(r)&&(r.opacity=app.db.isRareReward(this.m_arrReward[0].GSID)?255:0);for(var o=0,s=0;o<this.p_arrItem.length;++o)if(o!=e){this.p_arrItem[o].getComponent("propItem").initForBag(this.m_arrReward[i[s]]),this.p_arrItem[o].getComponent("propItem").setClick(!0);var p=this.p_arrCard[o].getChildByName("ImgSpecial");cc.isValid(p)&&(p.opacity=app.db.isRareReward(this.m_arrReward[i[s]].GSID)?255:0),s++}}else for(var c=0;c<this.p_arrItem.length;++c){this.p_arrItem[c].getComponent("propItem").initForBag(this.m_arrReward[c]),this.p_arrItem[c].getComponent("propItem").setClick(!0);var h=this.p_arrCard[c].getChildByName("ImgSpecial");cc.isValid(h)&&(h.opacity=app.db.isRareReward(this.m_arrReward[c].GSID)?255:0)}this._open=!0,this.scheduleOnce(function(){t.p_arrCard[e].scaleX=.1;for(var a=function(a){a==e?(t.p_arrItem[a].active=!0,t.p_arrCard[a].getChildByName("turn").active=!0,t.p_arrCard[a].getChildByName("light").active=!0,t._tequan,t.p_arrCard[a].getChildByName("light").scale=.75,t.p_arrCard[a].runAction(cc.scaleTo(.2,1,1)),t.p_arrCard[a].parent=t.p_nodeFront,app.playSound("reward")):t.p_arrCard[a].runAction(cc.sequence(cc.delayTime(.5),cc.callFunc(function(){t.p_arrCard[a].scaleX=.1,t.p_arrItem[a].active=!0,t._tequan?(t.p_arrCard[a].getChildByName("turn").active=!0,t.p_arrCard[a].getChildByName("light").scale=.75,t.p_arrCard[a].getChildByName("light").active=!0):(t.p_arrCard[a].getChildByName("turn").active=!0,app.setSpriteState(t.p_arrCard[a].getChildByName("turn").getComponent(cc.Sprite),!0)),app.playSound("reward")}),cc.scaleTo(.3,1,1),cc.callFunc(function(){t.bmaskclose=!0,t.p_btnGoActive.node.active=!t._tequan&&!gSetting.checkReviewServ()})))},i=0;i<t.p_arrCard.length;++i)a(i);t.scheduleOnce(function(){t.refreshTime()},1)},.1)},refreshTime:function(){var e=this;this.p_labTime.node.active=!0,this.p_labTime.string=langMgr.getString("windowsPageTurn",0,this.m_time),this.schedule(function(){e.m_time--,e.m_time<0&&e.onClose(),e.p_labTime.string=langMgr.getString("windowsPageTurn",0,e.m_time)},1,3)},onClose:function(){for(var e=0;e<this.p_arrCard.length;++e)this.p_arrCard[e].getChildByName("turn").active=!1,this.p_arrCard[e].getChildByName("light").active=!1;this._super()}});cc._RF.pop()},{basePage:void 0}],windowsPageUpgradeReady:[function(e,t){"use strict";cc._RF.push(t,"c0507q4iqlCH4l5XNQ7Qw81","windowsPageUpgradeReady");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspageupgradeready",pageType:1},properties:{p_labMaxLvTips:cc.Label,p_nodeNoSkill:cc.Node,p_nodeSkill:cc.Node,p_nodeSkillOld:cc.Node,p_nodeSkillNew:cc.Node,p_nodeArrow:cc.Node,p_arrNodeCost:[cc.Node],p_btnConfirm:cc.Button,p_btnCancel:cc.Button},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.handleUI(),this.creatMask(!0)},handleUI:function(){var e=this;this.p_btnConfirm.node.on("click",function(){app.playSound("click"),e.onClickBtnUp()}),this.p_btnCancel.node.on("click",function(){app.playSound("click"),e.onClose()})},setParam:function(e){this.m_objData=e.gdata,this.m_target=e.target,this.refreshUI(e.gdata)},refreshUI:function(e){var t=app.db.getGMaxLvByClass(e.class),a=app.db.getGMaxLvByClass(e.class+1)-t;this.p_labMaxLvTips.string=langMgr.getString("windowsPageUpgradeReady",0,a);var i=this.getCost(e);i||(i=[]),this.m_arrCost=i;for(var n=0;n<this.p_arrNodeCost.length;++n)i[n]?(this.p_arrNodeCost[n].getComponent("costItem").refreshUI(i[n].GSID,i[n].COUNT,this),this.p_arrNodeCost[n].active=!0):this.p_arrNodeCost[n].active=!1;var r=app.db.getNextClassSkill(e.gsid,e.class);r.length<=0?(this.p_nodeSkill.active=!1,this.p_nodeNoSkill.active=!0):(this.p_nodeNoSkill.active=!1,this.p_nodeSkill.active=!0,this.p_nodeArrow.active=!1,this.p_nodeSkillOld.active=!1,this.p_nodeSkillNew.active=!0,this.p_nodeSkillNew.getComponent("skillItem").initForShow(r[0],this))},getCost:function(e){var t=app.db.getGLevelCostByLevel(e.level)||[];return t.sort(function(e,t){var a=[38006,30001,30015];return a.indexOf(Number(e.GSID))-a.indexOf(Number(t.GSID))}),t},onClickBtnUp:function(){for(var e=this,t=1,a=0;a<this.m_arrCost.length;++a){var i=this.m_arrCost[a];if(!app.player.checkCount(i.GSID,i.COUNT)){t=0;break}}t&&app.player.sfGeneralLvUp(this.m_objData.guid,function(t,a){if(t)app.showNotice(t);else if(cc.isValid(e)){e.onClose();var i={old:e.m_objData,new:a};app.pages.windowspageupgradesucc.showPage(i),app.player.addGeneral(a),app.player.sfPlayerByParam(["others","props"],function(){}),e.m_target.m_isUpgrade=!0,e.m_target.m_objParent.refreshInfo(a)}})},getPower:function(e){app.db.getGBaseByGsid(e.gsid)}});cc._RF.pop()},{basePage:void 0}],windowsPageUpgradeSucc:[function(e,t){"use strict";cc._RF.push(t,"ef638R8jcVAqa9irp+VFqvg","windowsPageUpgradeSucc");var a=["hp","atk","def","mdef"],i=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspageupgradesucc",pageType:1},properties:{p_nodePowerOld:cc.Node,p_nodePowerNew:cc.Node,p_arrLabOld:[cc.Label],p_arrLabNew:[cc.Label],p_nodeTips:cc.Node,p_nodeSkill:cc.Node,p_nodeSkillOld:cc.Node,p_nodeSkillNew:cc.Node,p_nodeArrow:cc.Node,p_spTitleAnim:sp.Skeleton,p_labUnlockTip:cc.Label},onLoad:function(){i.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),app.playSound("reward")},setParam:function(e){this.m_objOldData=e.old,this.m_objNewData=e.new,cc.log("old data is ",this.m_objOldData),cc.log("new data is ",this.m_objNewData),this.refreshUI(),app.playUpgradeAnim({spComp:this.p_spTitleAnim,startName:"appear",endName:"loop",index:8,target:this})},refreshUI:function(){var e=this;app.db.getGBaseByGsid(this.m_objNewData.gsid),this.p_nodePowerOld.getComponent(cc.Label).string=gUtils.showNum(this.m_objOldData.power),this.p_nodePowerNew.getComponent(cc.Label).string=gUtils.showNum(this.m_objNewData.power),this.p_arrLabOld.forEach(function(t,i){var n;n=0==i?app.db.getGMaxLvByGsid(e.m_objOldData.gsid,e.m_objOldData.class):e.m_objOldData.property[a[i-1]],t.string=n}),this.p_arrLabNew.forEach(function(t,i){var n;n=0==i?app.db.getGMaxLvByGsid(e.m_objNewData.gsid,e.m_objNewData.class):e.m_objNewData.property[a[i-1]],t.string=n});var t=app.db.getNextClassSkill(this.m_objOldData.gsid,this.m_objOldData.class);this.p_labUnlockTip.node.opacity=t.length<=0?255:0,t.length<=0?this.p_nodeSkill.active=!1:(this.p_nodeSkill.active=!0,this.p_nodeArrow.active=!1,this.p_nodeSkillOld.active=!1,this.p_nodeSkillNew.active=!0,this.p_nodeSkillNew.getComponent("skillItem").initForShow(t[0],this))}});cc._RF.pop()},{basePage:void 0}],windowsPageXYBZTipsSkill:[function(e,t){"use strict";cc._RF.push(t,"6aa2475lpZNnL/RIYzcehCY","windowsPageXYBZTipsSkill");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=cc._decorator,o=r.ccclass,s=r.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_labName=null,t.p_labIntro=null,t.p_labHit=null,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},t.prototype.setParam=function(e){this.m_data=e.data,this.m_target=e.target,this.refreshUI()},t.prototype.refreshUI=function(){this.p_labHit.string=window.langMgr.getString("windowsPageXYBZTipsSkill",0);var e=app.db.getDungeonBuffInfo(this.m_data.ID||this.m_data.id);this.p_labName.string=e.NAME,this.p_labIntro.string=e.REMARKS+"+"+this.m_data.val/10+"%"},t.prefabPath="windowsPageXYBZTipsSkill",t.pageType=1,n([s(cc.Label)],t.prototype,"p_labName",void 0),n([s(cc.Label)],t.prototype,"p_labIntro",void 0),n([s(cc.Label)],t.prototype,"p_labHit",void 0),a=n([o],t)}(e("basePage"));t.exports=p,cc._RF.pop()},{basePage:void 0}],windowsPageXybzMsg:[function(e,t){"use strict";cc._RF.push(t,"7c9075aW3JE15cZrMFj2gUw","windowsPageXybzMsg");var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,a,i){var n,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r<3?n(o):r>3?n(t,a,o):n(t,a))||o);return r>3&&o&&Object.defineProperty(t,a,o),o},r=cc._decorator,o=r.ccclass,s=r.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.p_btnEnd=null,t.p_btnBack=null,t.m_endFun=null,t.m_backFun=null,t.m_target=null,t}var a;return i(t,e),a=t,t.prototype.onLoad=function(){var e=this;a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI(),this.p_btnEnd.node.on("click",function(){app.playSound("click"),e.m_endFun&&e.m_endFun.apply(e.m_target),e.onClose()}),this.p_btnBack.node.on("click",function(){app.playSound("click"),e.m_backFun&&e.m_backFun.apply(e.m_target),e.onClose()})},t.prototype.start=function(){},t.prototype.setParam=function(e){this.m_endFun=e.endFun,this.m_backFun=e.backFun,this.m_target=e.target},t.prototype.onClose=function(){e.prototype.onClose.call(this)},t.prefabPath="windowsPageXybzMsg",t.pageType=1,n([s(cc.Button)],t.prototype,"p_btnEnd",void 0),n([s(cc.Button)],t.prototype,"p_btnBack",void 0),a=n([o],t)}(e("basePage"));t.exports=p,cc._RF.pop()},{basePage:void 0}],windowsPageYdright:[function(e,t){"use strict";cc._RF.push(t,"9ad0fyuV3tMLaUDQCfI28bv","windowsPageYdright");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspageydright"},properties:{p_scrView:cc.ScrollView,p_nodeItem:cc.Node,p_btnBuy:cc.Button},onLoad:function(){a.instance=this,this.stopNodeEvent(),this.stopBgNodeEvent(),this.creatMask(!0,150),this.handleUI()},handleUI:function(){var e=this;this._super(),this.p_btnBuy.node.on("click",function(){e.onClickBtnBuy()})},setParam:function(){var e=app.db.dbMActivityFinal;this.refreshUI(e)},refreshUI:function(e){this.p_btnBuy.interactable=!app.player.special.specialyd,this.refreshSView(e)},refreshSView:function(e){this.m_arrItems||(this.m_arrItems=[],this.m_arrItems.push(this.p_nodeItem));for(var t=0;t<e.length;++t){var a=this.m_arrItems[t];a||((a=cc.instantiate(this.p_nodeItem)).parent=this.p_scrView.content,this.m_arrItems.push(a)),a.active=!0,a.getComponent("monthRightItem").refreshUI(e[t],this)}for(var i=e.length;i<this.m_arrItems.length;++i)this.m_arrItems[i].active=!1},onClickBtnBuy:function(){var e=this;app.player.pay("specialyd",function(){e.refreshUI(e.m_objData,e.m_strType)},function(){console.log("\u652f\u4ed8\u53d6\u6d88or\u5931\u8d25")})}});cc._RF.pop()},{basePage:void 0}],windowsPageZhanYiBoss:[function(e,t){"use strict";cc._RF.push(t,"6cedcfivWVN/IbeKKxl6puD","windowsPageZhanYiBoss"),cc.Class({extends:cc.Component,properties:{p_nodeReward:cc.Node,p_sprName:cc.Sprite,p_sprGeneral:cc.Sprite,p_spGeneral:sp.Skeleton,p_animGeneral:cc.Animation,p_proHp:cc.ProgressBar,p_labHp:cc.Label,p_btnFight:cc.Button,p_btnMop:cc.Button,p_node:cc.Node,p_nodeKill:cc.Node,p_propItem:cc.Prefab,p_sprIcon:cc.Sprite},onLoad:function(){var e=this;this.p_btnFight.node.on("click",function(){app.player.sfMonthBossInfo(e.m_boss.bossid,function(t,a){app.player.getCount(30024)<=0?app.showNotice(langMgr.getString("windowsPageZhanYiBoss",0)):e&&cc.isValid(e.node)&&(app.battleIndex=e.m_boss.bossid,app.battleParam=2,app.goToBossBattle("dramaboss",a))})}),this.p_btnMop.node.on("click",function(){e.m_boss.lastdamge?e.onConfirmMop():app.showNotice(langMgr.getString("windowsPageZhanYiBoss",1))})},refreshUI:function(e,t){var a=this;this.m_boss=e.boss,t&&(this.m_target=t);var i=app.db.getDramaBossInfo(e.boss.bossid),n=i.GSID,r=i.REWARDS,o=app.db.getGNamePathHByGsid(n);app.loadTexture(o,this.p_sprName,app.pages.windowspageplotboss.prefabPath),app.loadTexture(app.db.getPropsIconPath(30024),this.p_sprIcon,app.pages.windowspageplotboss.prefabPath),setTimeout(function(){app.loadGeneral(n,a.p_sprGeneral,a.p_spGeneral,a.p_animGeneral,null,app.pages.windowspageplotboss.prefabPath)},100),this.m_nodeReward||(this.m_nodeReward=[]);for(var s=0;s<r.length;s++){var p=r[s],c=this.m_nodeReward[s];c||((c=cc.instantiate(this.p_propItem)).scale=.8,this.p_nodeReward.addChild(c),this.m_nodeReward[s]=c),c.active=!0,c.getComponent("propItem").initForBag(p),c.getComponent("propItem").setClick(!0)}for(var h=r.length;h<this.m_nodeReward.length;h++)this.m_nodeReward[h].active=!1;if(this.m_boss.subindex==this.m_boss.bossindex){var l=e.boss.totalHp-e.boss.totaldamge;this.p_labHp.string=(100*l/e.boss.totalHp).toFixed(2)+"%",this.p_proHp.progress=l/e.boss.totalHp,this.p_node.active=!0,this.p_nodeKill.active=!1}else this.p_labHp.string="0%",this.p_proHp.progress=0,this.p_node.active=!1,this.p_nodeKill.active=!0},onConfirmMop:function(){if(app.player.getCount(30024)<=0)app.showNotice(langMgr.getString("windowsPageZhanYiBoss",0));else{var e=(this.m_boss.totalHp-this.m_boss.totaldamge)/this.m_boss.lastdamge,t=Math.ceil(e),a={gsid:30024,maxcount:Math.min(t,app.player.getCount(30024)),type:"nums",tips:langMgr.getString("windowsPageZhanYiBoss",3),coin:30024,confirmcb:this.onMop,target:this};app.pages.windowspagesetnum.showPage(a)}},onMop:function(e){var t,a=this;t=function(){app.player.sfMonthBossFarm({index:a.m_boss.bossid,times:e},function(t,i){if(!t){var n={showtype:1,reward:i.items,target:a,confirmcb:function(){app.showRecommendGift()}};app.player.addItem(i.items),app.pages.windowspagereward.showPage(n),app.player.reduceItem({gsid:30024,count:e}),i.global_gifts&&app.setNewRecommendGift(i.global_gifts),app.player.sfDramaBossList(function(e){for(var t,i=0;i<e.eventlist.length;i++)e.eventlist[i].boss.bossid==a.m_boss.bossid&&(t=e.eventlist[i]);a.refreshUI(t),a.m_target.m_objData=t})}})};var i={content:langMgr.getString("windowsPageZhanYiBoss",2,[this.m_boss.lastdamge,e]),confirmcb:t,target:this};app.pages.windowspagetipsmsg.showPage(i)}}),cc._RF.pop()},{}],windowsPageZhanYiExchange:[function(e,t){"use strict";cc._RF.push(t,"c2a01x3hrpMAbToWKw3Wkgy","windowsPageZhanYiExchange"),cc.Class({extends:cc.Component,properties:{p_tabNode:cc.Node},start:function(){},refreshUI:function(e,t){var a=this;t&&(this.m_target=t);var i=this.setData(e.exchange),n=i.length;this.p_tabNode.getComponent("tableView").initTableView(n,{bossid:e.boss.bossid,array:i,target:this,confirmcb:function(){a.m_target.refreshUI()}})},refreshTableView:function(e){var t=this,a=this.setData(e.exchange),i=a.length;this.p_tabNode.getComponent("tableView").newReload(i,{bossid:e.boss.bossid,array:a,target:this,confirmcb:function(){t.m_target.refreshUI()}})},setData:function(e){return e.sort(function(e,t){return e.limit-e.times>0&&t.limit-t.times<=0?-1:e.limit-e.times<=0&&t.limit-t.times>0?1:0}),e}}),cc._RF.pop()},{}],windowsPageZhanYiMission:[function(e,t){"use strict";cc._RF.push(t,"817230+rNdM6ZN2zs5UqyYj","windowsPageZhanYiMission"),cc.Class({extends:cc.Component,properties:{p_labMissionCount:cc.Label,p_tabNode:cc.Node,p_btnBox:cc.Button,p_sprBox:cc.Sprite,p_boxSprF:[cc.SpriteFrame],p_sprLight:cc.Sprite,p_nodeRed:cc.Node,p_progressBar:cc.ProgressBar},onLoad:function(){var e=this;this.p_btnBox.node.on("click",function(){if(e.m_box.process>=e.m_box.num&&!e.m_box.status)app.player.sfDramaScoreBox(e.m_bossData.boss.bossid,e.m_box.id,function(t,a){var i={showtype:1,reward:a.items,confirmcb:function(){app.player.sfDramaBossList(function(t){for(var a,i=0;i<t.eventlist.length;i++)t.eventlist[i].boss.bossid==e.m_bossData.boss.bossid&&(a=t.eventlist[i]);e.refreshUI(a),e.m_target.m_objData=a,e.m_target.refreshUI()})},target:e};app.pages.windowspagereward.showPage(i)});else{var t=e.m_box.items.length-2,a={worldPos:e.p_btnBox.node.convertToWorldSpaceAR(cc.v2(-20-100*t,0)),arrReward:e.m_box.items};app.pages.windowspagerewardtips.showPage(a)}})},start:function(){},refreshUI:function(e,t){var a=this;t&&(this.m_target=t),this.m_bossData=e;var i=this.setData(e.task),n=i.length;this.p_tabNode.getComponent("tableView").initTableView(n,{bossid:e.boss.bossid,array:i,target:this,confirmcb:function(){a.m_target.refreshUI()}}),this.m_box=e.taskscore[0],this.p_labMissionCount.string=this.m_box.process+"/"+this.m_box.num,this.p_progressBar.progress=this.m_box.process/this.m_box.num,this.p_sprBox.spriteFrame=this.m_box.status?this.p_boxSprF[1]:this.p_boxSprF[0],this.p_sprLight.enabled=this.m_box.process>=this.m_box.num&&!this.m_box.status,this.p_nodeRed.active=this.m_box.process>=this.m_box.num&&!this.m_box.status},setData:function(e){for(var t=0;t<e.length;t++)1==e[t].status?e[t].state=2:e[t].process<e[t].require?e[t].state=1:e[t].state=0;return e.sort(function(e,t){return e.state-t.state}),e}}),cc._RF.pop()},{}],windowsPageZhanYi:[function(e,t){"use strict";cc._RF.push(t,"c8d48d5uYlM0YZEq5gw6SrK","windowsPageZhanYi");var a=[cc.v2(-116,-67),cc.v2(187,42),cc.v2(21,214),cc.v2(-205,352),cc.v2(150,441)];cc.Class({extends:cc.Component,properties:{p_arrNodeEnemy:[cc.Node],p_labIntro:cc.Label,p_labTime:cc.Label,p_arrSprF:[cc.SpriteFrame],p_nodeFight:cc.Node,p_arrNodePower:[cc.Node],p_sprLine:cc.Sprite,p_nodeFightAnim:cc.Node},onLoad:function(){var e=this;this.p_arrNodeEnemy.forEach(function(t,a){t.getChildByName("base").getChildByName("btn").on("touchend",function(){app.pages.windowspagebossbattle.showPage({data:e.m_bossData,target:e,index:a})})})},start:function(){},refreshUI:function(e,t){var i=this;t&&(this.m_target=t),this.m_bossData=e,this.m_index=e.boss.subindex;var n=app.db.getDramaEventInfo(e.boss.bossid);this.p_labIntro.string=n.INTRO;var r=app.db.getDramaBossInfo(e.boss.bossid).BATTLE,o="game_ui/04_page/battle_map_zhanyi/"+n.LINE;app.loadTexture(o,this.p_sprLine,t.prefabPath);for(var s=function(e){var a=r[e],n=(i.p_arrNodeEnemy[e].getComponent(cc.Sprite),i.p_arrNodeEnemy[e].getChildByName("base")),o=n.getChildByName("hero_anim"),s=n.getChildByName("icon_bg").getChildByName("icon_node").getChildByName("icon").getComponent(cc.Sprite),p="game_ui/04_page/battle_map_zhanyi/"+a.IMAGE;app.loadTexture(p,o.getComponent(cc.Sprite),t.prefabPath);var c=app.db.getGHeadIconByGsid(a.BOSSGSID);app.loadTexture(c,s,t.prefabPath,function(){n.getChildByName("icon_bg").active=e==i.m_index}),n.getChildByName("pass_icon").active=e<i.m_index,app.setSpriteState(o.getComponent(cc.Sprite),e>i.m_index);var h=i.p_arrNodePower[e],l=app.db.getPveProperInfo(i.m_bossData.bossset[e].bset);if(h){var g=0;for(var d in l.team)g+=l.team[d].power||0;h.getComponent(cc.Label).string=gUtils.showNum(g)}n.getChildByName("guanka_tx").active=e===i.m_index,i.m_index},p=0;p<this.p_arrNodeEnemy.length;p++)s(p);if(this.p_arrNodeEnemy[this.m_index]){var c=this.p_arrNodeEnemy[this.m_index].getChildByName("base").getChildByName("icon_bg").convertToWorldSpaceAR(cc.v2(0,0)),h=this.node.convertToNodeSpaceAR(c);this.p_nodeFightAnim.position=cc.v2(h.x,h.y-40)}else this.p_nodeFightAnim.position=cc.v2(-500,0);this.m_index>4?(this.p_nodeFight.active=!1,this.m_bossData.boss.bossindex==this.m_index&&this.m_target.m_menu.setMenuIndex(0)):this.p_nodeFight.setPosition(a[this.m_index])},afterBattleFresh:function(){var e=this;switch(app.battleOverType){case"dramaboss":app.player.sfDramaBossList(function(t){for(var a,i=0;i<t.length;i++)t[i].boss.bossid==e.m_bossData.boss.bossid&&(a=t[i]);e.refreshUI(a),e.m_target.m_objData=a})}}}),cc._RF.pop()},{}],windowsPageZhengzhanNotice:[function(e,t){"use strict";cc._RF.push(t,"5e546q9P+FHUKp11kvvVCgY","windowsPageZhengzhanNotice");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"windowspagezhengzhannotice"},properties:{p_nodeAnyingzhazhai:cc.Node,p_nodeLiangcaogaoji:cc.Node,p_btnYanwu:cc.Button,p_btnShilianta:cc.Button,p_btnDazhanyi:cc.Button,p_btnYuanzheng:cc.Button,p_labAnyingzhazhai:cc.Label,p_labLiangcaogaoji:cc.Label,p_btnZhengshui:cc.Button},onLoad:function(){a.instance=this,this.stopBgNodeEvent(),this.creatMask(!0),this.handleUI()},handleUI:function(){var e=this;this._super(),this.p_btnYanwu.node.on("click",function(){app.playSound("click"),app.mainScene.onMenu(0),app.pages.pvpentrancepage.showPage(null,app.mainScene.p_nodeBg)}),this.p_btnShilianta.node.on("click",function(){app.playSound("click"),app.mainScene.onMenu(0),app.player.level>=20?app.pages.towermanagepage.showPage():app.pages.climbingtowerpage.showPage()}),this.p_btnDazhanyi.node.on("click",function(){app.playSound("click"),app.mainScene.onMenu(0),app.pages.bigbattlepage.showPage()}),this.p_btnYuanzheng.node.on("click",function(){app.playSound("click"),app.mainScene.onMenu(0),app.pages.expeditionpage.showPage(null,app.mainScene.p_nodeBg)}),this.p_btnZhengshui.node.on("click",function(){app.playSound("click"),e.onClose(),app.pages.newworldmappage.instance.getHangProfit()})},setParam:function(e){this.refreshUI(e)},refreshHangTime:function(){if(app.player.lastreap){var e=!1,t=app.player.getServerTime()-app.player.lastreap,a=gUtils.getDayHourMinSecTime(t),i=a[1],n=a[2];a[3],a[0]>=1?e=!0:i?e=!0:n>=5&&(e=!0),this.p_nodeAnyingzhazhai.active=!e,this.p_nodeLiangcaogaoji.active=e,this.p_bgNode.height=e?this.p_nodeLiangcaogaoji.height:this.p_nodeAnyingzhazhai.height}},refreshUI:function(e){this.refreshHangTime(),this.p_labAnyingzhazhai.string=langMgr.getString("windowsPageZhengzhanNotice",0,e),this.p_labLiangcaogaoji.string=langMgr.getString("windowsPageZhengzhanNotice",0,e)}});cc._RF.pop()},{basePage:void 0}],windowsWait:[function(e,t){"use strict";cc._RF.push(t,"52bf3R2EwtGKrblJlZiZOdY","windowsWait"),cc.Class({extends:cc.Component,statics:{},properties:{p_nodeBg:cc.Node,p_sprWait:cc.Sprite,p_labTime:cc.Label,p_labTips:cc.Label,p_nodeTips:cc.Node,p_nodeBack:cc.Node},onLoad:function(){this.m_isTime=!1,this.m_showIndex=0,this.node.on("touchstart",function(e){e.stopPropagation()}),this.node.on("touchmove",function(e){e.stopPropagation()}),this.node.on("touchend",function(e){console.log("click wait page!!!"),e.stopPropagation()}),this.p_nodeBack.on("touchend",function(){cc.director.loadScene("scenes_login")}),cc.winSize.height/cc.winSize.width>2e3/1080&&(this.p_nodeBack.getComponent(cc.Widget).top=0,this.p_nodeBack.getComponent(cc.Widget).updateAlignment())},show:function(e){this.node.active=!0,e?(this.m_numWaitTime=e.numWaitTime,this.m_isShowTime=e.isShowTime,this.m_strTips=e.strTips,this.m_confirmcb=e.confirmcb,this.m_confirmparm=e.confirmparm,this.m_target=e.target,this.m_isShow=e.isShow,this.m_isNoTips=e.isNoResetTips):this.m_isShow=!0,this.refreshUI()},refreshUI:function(){if(this.m_time=1,this.m_oneTime=0,this.m_showTipsTime=0,this.m_isShowTips=!1,this.initShow(),0==this.m_isShow)return this.m_isTime=!1,this.p_sprWait.node.active=!1,this.p_nodeBg.active=!1,this.p_nodeTips.active=!1,this.p_nodeBack.active=!1,this.p_labTime.node.active=!1,void(this.p_labTips.node.active=!1);this.p_sprWait.node.active=!0,this.p_nodeBg.active=!0,this.p_nodeTips.active=!0,this.openAction()},initShow:function(){this.m_numWaitTime||this.m_isShowTime?this.m_isTime=!0:this.m_isTime=!1,this.m_isShowTime?(this.p_labTime.node.active=!0,this.p_labTime.string=this.m_time):this.p_labTime.node.active=!1,this.m_strTips?(this.p_labTips.node.active=!0,this.p_labTips.string=this.m_strTips):this.p_labTips.node.active=!1},openAction:function(){null==this.m_activeReq&&(this.m_activeReq=cc.repeatForever(cc.rotateBy(1,360)),this.p_sprWait.node.runAction(this.m_activeReq))},stopAction:function(){null!=this.m_activeReq&&(this.p_sprWait.node.stopAction(this.m_activeReq),this.m_activeReq=null)},upLabTime:function(){this.p_labTime.string=this.m_time},hide:function(){this.m_showIndex<=0&&(this.m_showIndex=0,this.m_isTime=!1,this.stopAction(),this.node.active=!1)},update:function(e){this.m_showTipsTime+=e,this.m_showTipsTime>=2&&!this.m_isShowTips&&(this.m_isShowTips=!0,this.p_sprWait.node.active&&(this.p_nodeBack.active=!this.m_isNoTips)),this.m_isTime&&(this.m_oneTime+=e,this.m_oneTime>=1&&(this.m_oneTime=0,this.m_time++,this.m_isShowTime&&this.upLabTime(),this.m_time>=this.m_numWaitTime&&(this.m_confirmcb&&this.m_confirmcb.apply(this.m_target,this.m_confirmparm),this.hide())))}}),cc._RF.pop()},{}],wuhunListPage:[function(e,t){"use strict";cc._RF.push(t,"be1721GZHVJPIZbdWeyr3Rp","wuhunListPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"wuhunlistpage"},properties:{p_arrRowMenu:[cc.Node],p_arrRowLock:[cc.Node],p_arrColMenu:[cc.Node],p_arrColLock:[cc.Node],p_arrWuhun:[cc.Node],p_arrHunLock:[cc.Node]},onLoad:function(){a.instance=this,this.handleUI(),this.stopBgNodeEvent(),this.creatMask(!0)},handleUI:function(){var e=this;this._super(),this.p_arrRowMenu.forEach(function(t,a){t.on("touchend",function(){e.showIntroPage(a+1)})}),this.p_arrColMenu.forEach(function(t,a){t.on("touchend",function(){e.showIntroPage(a+1)})}),this.p_arrWuhun.forEach(function(t,a){t.on("touchend",function(){e.showIntroPage(a+2e4)})})},setParam:function(e){this.m_objGData=app.player.general[e.guid],this.refreshUI()},refreshUI:function(){for(var e=3;e<5;++e)this.p_arrRowMenu[e].active=this.m_objGData.star>=12+2*(e-3),this.p_arrColMenu[e].active=this.m_objGData.star>=12+2*(e-3),this.p_arrRowLock[e-3].active=this.m_objGData.star<12+2*(e-3),this.p_arrColLock[e-3].active=this.m_objGData.star<12+2*(e-3);var t=[1,2,3];this.m_objGData.star>=14?t=[1,2,3,4,5]:this.m_objGData.star>=12&&(t=[1,2,3,4]);for(var a=[],i=0;i<t.length;++i)for(var n=0;n<t.length;++n){var r=app.db.dbTalentWuhun[t[i].toString()+t[n].toString()];r&&a.push(Number(r))}for(var o=6;o<this.p_arrWuhun.length;++o){var s=a.indexOf(2e4+o)>=0;this.p_arrWuhun[o].active=s,this.p_arrHunLock[o-6].active=!s}},showIntroPage:function(e){app.pages.wuhunskilltipspage.showPage({id:e})}});cc._RF.pop()},{basePage:void 0}],wuhunSkillTipsPage:[function(e,t){"use strict";cc._RF.push(t,"25070dbnllN4ZeJt6wHKtyl","wuhunSkillTipsPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"wuhunskilltipspage"},properties:{p_sprIcon:cc.Sprite,p_labName:cc.Label,p_rtIntro:cc.RichText},onLoad:function(){a.instance=this,this.handleUI(),this.stopBgNodeEvent(),this.creatMask(!0)},setParam:function(e){this._id=e.id,this.refreshUI()},refreshUI:function(){this.id<=5?(this.p_sprIcon.node.setPosition(-168,6),this.p_sprIcon.node.width=95,this.p_sprIcon.node.height=95):(this.p_sprIcon.node.setPosition(-166,-1),this.p_sprIcon.node.width=83,this.p_sprIcon.node.height=83);var e=app.db.getTalentInfo(this._id);app.loadTexture(gConfig.rootPath.uiwuhun+e.ICON,this.p_sprIcon,this.prefabPath),this.p_labName.string=e.NAME,this.p_rtIntro.string=e.INTRO}});cc._RF.pop()},{basePage:void 0}],wuhunTianfuPage:[function(e,t){"use strict";cc._RF.push(t,"7377fCqzw1K8b/EAgbIQxiI","wuhunTianfuPage");var a=cc.Class({extends:e("basePage"),statics:{prefabPath:"wuhuntianfupage"},properties:{p_arrTalent:[cc.Node],p_arrIcon:[cc.Node],p_arrLock:[cc.Node],p_arrLockLab:[cc.Node],p_nodeChoose:cc.Node,p_labName:cc.Label,p_labIntro:cc.Label,p_labNum:cc.Label,p_btnSet:cc.Button,p_labOwn:cc.Label,p_labCost:cc.Label},onLoad:function(){a.instance=this,this.handleUI(),this.stopBgNodeEvent(),this.creatMask(!0)},handleUI:function(){var e=this;this._super(),this.p_arrTalent.forEach(function(t,a){t.on("touchend",function(){e.refreshIntro(a)})}),this.p_btnSet.node.on("click",function(){e.setTalent()})},setParam:function(e){this.m_objGData=app.player.general[e.guid],this._index=e.index,this._talent=e.talent||0,this._target=e.target,this.refreshUI(),this.refreshIntro((e.talent||1)-1,!0)},refreshUI:function(){this.p_arrIcon[0].active=this.m_objGData.star>=12,this.p_arrIcon[1].active=this.m_objGData.star>=14,this.p_arrLock[0].active=this.m_objGData.star<12,this.p_arrLock[1].active=this.m_objGData.star<14,this.p_arrLockLab[0].active=!1,this.p_arrLockLab[1].active=!1;var e=app.player.getCount(90341),t=app.db.dbTalentCost[e]||app.db.dbTalentCost[app.db.dbTalentCost.length-1],a=this.m_objGData.talent||[0,0,0,0,0,0],i=app.player.getCount(38005);0==a[this._index]?(this.p_labOwn.node.color=this.p_labCost.node.color,this.p_labOwn.string=langMgr.getString("wuhunTianfuPage",0),this.p_labCost.string=langMgr.getString("wuhunTianfuPage",1)):(this.p_labOwn.node.color=i>=t.COUNT?cc.color(155,81,14):cc.Color.RED,this.p_labOwn.string=gUtils.showNum(i),this.p_labCost.string="/"+gUtils.showNum(t.COUNT))},refreshIntro:function(e,t){if(t||this.m_nIndex!=e){var a=app.db.getTalentInfo(e+1);if(this.m_objGData.star<a.LOCK)app.showNotice(langMgr.getString("wuhunTianfuPage",2));else{this.m_nIndex=e,this.p_nodeChoose.setPosition(this.p_arrTalent[e].position),this.p_labName.string=a.NAME,this.p_labIntro.string=a.INTRO;var i=a.INTRO.split("+");this.p_labIntro.string=i[0],this.p_labNum.string="+"+i[1],this.p_btnSet.interactable=this.checkIsCanChange().result}}},checkIsCanChange:function(){if(this.m_objGData.star<this._index+10)return{result:!1,err:"\u661f\u7ea7\u4e0d\u591f\uff0c\u6682\u672a\u89e3\u9501"};var e=app.db.getTalentInfo(this.m_nIndex+1);if(this.m_objGData.star<e.LOCK)return{result:!1,err:e.LOCK+"\u661f\u89e3\u9501"};if(this.m_nIndex=this.m_nIndex||0,this.m_nIndex+1>5||this.m_nIndex+1<1)return{result:!1,err:"\u5929\u8d4b\u6570\u503c\u5f02\u5e38"};var t=app.player.getCount(90341),a=app.db.dbTalentCost[t]||app.db.dbTalentCost[app.db.dbTalentCost.length-1],i=this.m_objGData.talent||[0,0,0,0,0,0];return i[this._index]==this.m_nIndex+1?{result:!1,err:"\u8bf7\u52ff\u8bbe\u7f6e\u60a8\u5f53\u524d\u4f7f\u7528\u7684\u5929\u8d4b"}:i[this._index]>0&&app.player.getCount(a.GSID)<a.COUNT?{result:!1,err:"\u5143\u5b9d\u4e0d\u8db3"}:{result:!0}},setTalent:function(){var e=this,t=this.checkIsCanChange();if(t.result){var a=app.player.getCount(90341),i=app.db.dbTalentCost[a]||app.db.dbTalentCost[app.db.dbTalentCost.length-1],n=this.m_objGData.talent||[0,0,0,0,0,0],r=app.db.getTalentInfo(this.m_nIndex+1),o={content:n[this._index]>0?langMgr.getString("wuhunTianfuPage",10,[i.COUNT,r.NAME]):langMgr.getString("wuhunTianfuPage",11,r.NAME),confirmcb:function(){app.player.sfGeneralWuhun(e.m_objGData.guid,e._index,e.m_nIndex+1,function(t){t?app.showNotice(t):(n[e._index]>0?(app.player.reduceItem({gsid:i.GSID,count:i.COUNT}),app.player.addItem([{gsid:90341,count:1}]),app.showNotice(langMgr.getString("wuhunTianfuPage",3,r.NAME))):app.showNotice(langMgr.getString("wuhunTianfuPage",4,r.NAME)),app.player.general[e.m_objGData.guid].talent[e._index]=e.m_nIndex+1,cc.isValid(e.node)&&e.refreshUI(),app.refreshPageLogic("generalwuhunpage","refreshUI"),app.refreshPageLogic("generalwuhunpage","refreshMod"),app.refreshPageLogic("wuhuntianfupage","onClose"),e.p_btnSet.interactable=e.checkIsCanChange().result)})},target:this};app.pages.windowspagetipsmsg.showPage(o,this.node)}else app.showNotice(t.err)}});cc._RF.pop()},{basePage:void 0}]},{},["ActivityCornucopia","ActivityHydtPage","ActivityLuxuryGifts","ActivityRebatePage","ActivityRebateProcessPage","ActivityZHDPageSoul","AttributeInfoChange","BookIntensifyPage","BulletScreen","ChooseTutorPage","FiveWarIntroducePage","GeneralAppoint","GeneralRankListPage","GeneralSkinPanel","MilitaryRankRewardPage","NationRoyalMemberListPage","NationWarMainPage","RecordBroadcast","RegisterCdkPage","Typewriter","WindowsPageAppointSuccess","WindowsPageAuction","WindowsPageAuctionBuyTips","WindowsPageAuctionRecordList","WindowsPageCompleteChoiceSkill","WindowsPageCompleteSoulBinding","WindowsPageEquipCompound","WindowsPageExclusiveEquip","WindowsPageExclusiveStrengthenSuccess","WindowsPageFastUpgrade","WindowsPageGeneralTeamList","WindowsPageLegionWarRewardDisplay","WindowsPageMilitaryRank","WindowsPageMilitaryRankPreview","WindowsPageOfficeBuffInfo","WindowsPageOfficeChangeTip","WindowsPageOfficeConsumeTip","WindowsPageOfficialCandidate","WindowsPageOfficialInfo","WindowsPagePersonAuctionList","WindowsPageRelieveSoulBinding","WindowsPageRetinueResetTip","WindowsPageRetinueSuccess","WindowsPageRingRank","WindowsPageSkinReward","WindowsPageSoulBindingInfo","WindowsPageSportsReward","WindowsPageTipsExclusiveEquip","WindowsPageTipsRebate","WindowsPageWarRewardList","WindowsPageWeektargetLclb","activityBlessBagPage","activityCbgPage","activityCbgPageBjsd","activityCbgPageMjsl","activityCbgPageZcjb","activityCbgPageZcjbLog","activityCfhdPage","activityCjhdPageXCRW","activityDbqbPage","activityDbqbPageDbrw","activityDbqbPageDbsd","activityDbqbPageJgkl","activityDlhlPage","activityDwhdPage","activityDwhdPageMjbg","activityDwhdPageMjbgAccess","activityDwhdPageMjbgChosemb","activityDwhdPageMjbgPreview","activityDwhdPageRlwj","activityDwhdPageTgsl","activityDwhdPageZmfl","activityDyrpfListPage","activityDyrpfPage","activityDyrpfPreview","activityGcflPage","activityGelbPage","activityGiftGStarPage","activityGiftLevelPage","activityJchdPage","activityJchdPageGrowup","activityJchdPageItem","activityJchdPageMrqd","activityJchdPageMylb","activityJchdPageMzlb","activityJchdPageNoble","activityJchdPageVipclub","activityJrhdPage","activityJrhdPage2","activityJrhdPage2Sub","activityJrhdPageSub","activityLdjlPage","activityLdjlPageHtzh","activityLdjlPageHtzhExit","activityLdjlPageHyhl","activityLdjlPageJhlb","activityLdjlPageJthl","activityLdjlPageLdcf","activityLdjlPageLdzh","activityLdjlPageLjcz","activityLdjlPageLjdl","activityLdjlPageSslx","activityLdjlPageSwlb","activityLdjlPageYhsh","activityLdjlPageYhzh","activityMRSCPage","activityNewVersionPage","activityNhdPage","activityNovicePage","activityOnlinePage","activityPage","activityPageCode","activityPageDbqb","activityPageFreeWelfare","activityPageFreeZmfl","activityPageModel","activityPageXYBZ","activityPageXYBZBossInfo","activityPageXYBZGuard","activityPageXYBZMap","activityPageXfzh","activityPageXfzhRw","activityPageXfzhTo","activityPageXfzhToChange","activityQiriChoisePage","activityQiriPage","activityQrqdPage","activitySgyPage","activityShouchongPage","activitySrlbPage","activityThjj1Page","activityThjjPage","activityThjjRewardSelectPage","activityTjfxPage","activityWeekTargetPage","activityWlklbPage","activityWlklbPage2","activityWlzlBuylvPage","activityWlzlJjzlPage","activityWlzlPage","activityWorthFundPage","activityWstzPage","activityWstzPageBoss","activityWstzPageRank","activityWstzPageTask","activityWzqdPage","activityXgSmallPage","activityXiangouPage","activityYblbPage","activityYdhdPage","activityYdhdPageKh","activityYyhdPage","activityYylbPage","activityZhanshenlvbuPage","activityZhdCxryVowPage","activityZhdPage","activityZhdPage2","activityZhdPageCjxg","activityZhdPageCxry","activityZhdPageCzlb","activityZhdPageDcdy","activityZhdPageDjjf","activityZhdPageDjrw","activityZhdPageGjdl","activityZhdPageGjdl2","activityZhdPageGxdb","activityZhdPageHhyy","activityZhdPageHhyyPreview","activityZhdPageHhyyResult","activityZhdPageHjyt","activityZhdPageJfbx","activityZhdPageJrlb","activityZhdPagePflb","activityZhdPageQxsy","activityZhdPageSbjl","activityZhdPageSbjlInfo","activityZhdPageSmbx","activityZhdPageSzhc","activityZhdPageThlb","activityZhdPageTnqw","activityZhdPageWjcs","activityZhdPageWjzh","activityZhdPageXsdh","activityZhdPageXygx","activityZhdPageXylp","activityZhdPageZmjf","activityZhdPageZmzf","activityZhdPageZsth","activityZhdPageZsthChose","activityZhdPageZsthrmb","activityZhdPageZtlb","activityZylbPage","advanceNoticePage","ancientFieldPage","ancientFieldRewardPage","ancientFieldWinPage","ancientFirstTimesPage","ancientLvWinPage","ancientMapInfoPage","ancientMapPage","ancientRankPage","autoBattleResultPage","battleEnemyInfoPage","battleLoseNormPage","battleLosePvpPage","battleReadyDetailPage","battleReadyEnemyPage","battleReadyFormPage","battleReadyPage","battleReportPage","battleResultMultipvpPage","battleResultPage","battleWinNormalPage","battleWinPvpPage","beastsoulHandbookPage","beastsoulSkillDetailPage","bigBattleBossInfoPage","bigBattleChapterPage","bigBattleMbossPage","bigBattlePage","bookAwakenPage","bookCompoundPage","bookPickPage","bookResetPage","bookResolvePage","bookSkillPreviewPage","bountyCZJJPage","bountyPage","cardManagePage","cardRecruitingPage","carddrawPage","cardpubBasePage","chapterPage","chatPage","cityPage","climbingTowerPage","cloudManager","dramaBossSurePage","dramabossListPage","dungeonBuffChoosePage","dungeonBuffRewardPage","dungeonBuffinfoPage","dungeonEnemyinfoPage","dungeonEntrancePage","dungeonFailPage","dungeonFarmRewardPage","dungeonPage","dungeonPotionPage","dungeonQuickResultPage","dungeonRankPage","dungeonSaveGeneralsPage","dungeonShopPage","dungeonShoplistPage","dungeonTurntablePage","editMapPage","equicSuitBuildPage","equipLevelPage","eventPageAct","eventPageBingo","eventPageDialogue","eventPageOffice","eventPageReward","eventPageShop","eventPageTips","exchangePage","expeditionBagPage","expeditionBlessPage","expeditionBossInfoPage","expeditionBountyPage","expeditionCheckpointPage","expeditionEntrancePage","expeditionEventPage","expeditionMoqiPage","expeditionPage","expeditionStatuePage","expeditionTreatmentPage","fiveWarAnnoPage","fiveWarBattlesetPage","fiveWarCampOutPage","fiveWarCampPrePage","fiveWarGroundPage","fiveWarJoinPage","fiveWarMainPage","fiveWarServPage","fiveWartoCampPage","friendAddExplorePage","friendAddFriendPage","friendAllExplorePage","friendCheckpointDetailsPage","friendExploreBossPage","friendPage","friendPageApply","friendPageExplore","friendPageExploreBossInterface","friendPageExploreInterface","friendPageList","friendRecruitPage","fusionPage","generalAttributeDetailedPage","generalCompPage","generalEquicResetPage","generalEquicSkillListPage","generalEquicUpPage","generalManagePage","generalPage","generalPageBook","generalPageCompound","generalPageInfo","generalPagePot","generalPageStar","generalPageTrain","generalPageWuhun","generalRelivePage","generalResetPage","generalShowPage","generalSoulBindingPage","generalSpecialEquicPage","generalWuhunPage","generalbagHandbookPage","generalbagHandbookPageBook","giftRecommendPage","godbeastBattlePage","godbeastChoosePage","godbeastPage","goldmidasPage","gongchengshengliPage","gppvpActivityYurePage","gppvpBuyTicketPage","gppvpChooseFetterPage","gppvpChoosePage","gppvpChooseResultPage","gppvpChooseTutorPage","gppvpFightPage","gppvpInfoPage","gppvpMissionPage","gppvpPage","gppvpPlayerInfoPage","gppvpReplayPage","gppvpResetTipPage","gppvpRewardPage","groundPage","guanZhuPage","itnBossPage","itnFriendChoicePage","itnFriendPickPage","itnMissionChoicePage","itnMissionLvPage","itnMissionPage","itnMissionPageFriend","itnMissionPagePerson","itnMissionReelPage","itnPersonPickPage","kingpvpFightPage","kingpvpFightResultPage","kingpvpMatchHidePage","kingpvpMatchPage","kingpvpMissionPage","kingpvpPage","kingpvpPlayerInfoPage","kingpvpReplayPage","kingpvpRewardPage","kingpvpSelfLineupPage","kingpvpStageInfoPage","legionApplyPage","legionBossPage","legionBossRankPage","legionBossRecordPage","legionBossRewardPage","legionCreatePage","legionCsRankPage","legionHomePage","legionIconPage","legionInfoPage","legionLogPage","legionLookRewardPage","legionPage","legionPracticeDebuffPage","legionPracticePage","legionPracticeRankPage","legionPracticeRewardPage","legionRankPage","legionRecommendPage","legionSettingPage","legionShopPage","legionSignLogPage","legionSignPage","legionSkillPage","legionWarBattleSetPage","legionWarBossPage","legionWarCampsitePage","legionWarDemonstrationPage","legionWarJoinPage","legionWarMobPage","legionWarPage","legionWarPlayerinfoPage","legionWarRecordPage","legionWarResultPage","legionWarRewardPage","lineupNamePage","lookstarPage","mailAnnoPage","mailInfoPage","mailPage","mailReplyPage","manorAchievePage","manorBossPage","manorBuildInfoPage","manorBuildPage","manorEnemyPage","manorFuyaPage","manorGrainPage","manorHousePage","manorMilitaryBuildingPage","manorNormalEnemyPage","manorOfficePage","manorPage","manorPrisonHomePage","manorPrisonPage","manorResourceBuildingPage","manorSiegePage","manorSweepPage","manorTeamPage","mapEvent","missionPage","nationWarRankPage","nationWarRewardFinalPage","nationWarRewardOpenPage","nationWarRewardPage","nationWarRewardRoundPage","newExpeditionAutobattlePage","newExpeditionBoxPage","newExpeditionBuffPage","newExpeditionCardPage","newExpeditionFirstPage","newExpeditionPage","newExpeditionShopPage","newHandChoosePage","newManorSiegePage","newWorldMapPage","normalRecruitPage","northBattleSetPage","northBossInfoPage","northBossRewardPage","northRewardPage","noticePage","occThalentPage","officePage","officePageOfficial","officePageSurrender","officePageSurrenderSucc","officeRewardShowPage","palaceGiftPage","palaceIconPage","palaceKingShangPage","palaceNewkingPage","palacePage","palacePunishPage","palaceRightInfoPage","palaceSearchPlayerPage","palaceYoujieConfirmPage","palaceYoujiePage","palaceYoujieStatisticPage","playVideoPage","playerOtherInfoMorePage","playerOtherInfoPage","playerinfoDecoratePage","playerinfoDecoratePageHead","playerinfoDecoratePageImage","playerinfoDecoratePageTxk","playerinfoHeadiconPage","playerinfoNamePage","playerinfoPage","playerinfoSignaturePage","practiceTowerPage","practiceTowerRankPage","practiceTowerReplayPage","practiceTowerRewardPage","prePageLegionpractice","prePageLegionwar","prePagePalace","prePageSummitpvp","premiumPage","propbagPage","propbagTreasureHandbookPage","pvpBuyTicketPage","pvpChampionPage","pvpCrossServicePage","pvpEntrancePage","pvpMatchPage","pvpPage","pvpRankPage","pvpReplayPage","pvpRewardPage","quickBattleFormPage","quickBattleLoadPage","quickBattleResultPage","rankAchievePage","rankListPage","rankMainPage","rankPage","rechargeBountyPage","rechargeFixtimePageMSSQ","rechargeFixtimePageZXLB","rechargeNormalPageBWLB","rechargeNormalPageCZYB","rechargeNormalPageDWLB","rechargeNormalPageMRLB","rechargeNormalPageMRXG","rechargeNormalPageMYLB","rechargeNormalPageMZLB","rechargePage","rechargePageAdVip","rechargePageMain","rechargePageRight","rechargePageVip","rechargeWelfarePageCJCZJJ","rechargeWelfarePageCZJJ","rechargeWelfarePageJthl","rechargeWelfarePageMrlc","rechargeWelfarePageSLJJ","rechargeWelfarePageTHLB","rechargeWelfarePageTQLB","rechargeWelfarePageYK","rookieHandbookPage","seasonPage","seniorRecruitPage","shiMingPage","shopPage","siegePage","soulTemplePage","soulstoneBagPage","soulstoneListPage","summitpvpChapmionPage","summitpvpDropdownBox","summitpvpGuessPage","summitpvpGuessStatPage","summitpvpPage","summitpvpPreFlagPage","summitpvpPrePage","summitpvpPreRecordPage","summitpvpRewardPage","teampvpChallengeOrderPage","teampvpCompetitionTipsPage","teampvpCreateTeamPage","teampvpEnemyTeaminfoPage","teampvpFightRecordPage","teampvpFightResultPage","teampvpInvitationPage","teampvpPage","teampvpPlayerinfoPage","teampvpResultSimplePage","teampvpRewardPage","teampvpSearchEnemyPage","teampvpSearchTeamPage","teampvpSearchTeammatePage","towerManagePage","treasureStarPage","vipKeFuPage","vipPrivilegePage","wangpvpGuessPage","wangpvpPage","windowsAyzzActivity","windowsAyzzGJ","windowsCjhdPageJNXL","windowsCjhdPageXYS","windowsPageAYZZ","windowsPageAchieve","windowsPageActiveSource","windowsPageAdvanceNotice","windowsPageAutoBattleInfo","windowsPageBookAwakenPreview","windowsPageBookAwakenSucc","windowsPageBookRandomPreview","windowsPageBossBattle","windowsPageBossTalk","windowsPageChapterInfo","windowsPageCityInfo","windowsPageCode","windowsPageCutCity","windowsPageDeclare","windowsPageEquipBuildSucc","windowsPageExpeditionCSM","windowsPageExpeditionCardPreview","windowsPageExpeditionCards","windowsPageExpeditionEnmy","windowsPageExpeditionGeneral","windowsPageExpeditionLMKZ","windowsPageExpeditionPass","windowsPageExpeditionSLZM","windowsPageExpeditionSMDK","windowsPageExpeditionSMLZ","windowsPageExpeditionSevenlight","windowsPageExpeditionSkill","windowsPageExpeditionTSZC","windowsPageExpeditionXYSR","windowsPageGClassReady","windowsPageGClassSkill","windowsPageGClassSucc","windowsPageGStarSucc","windowsPageGoToPub","windowsPageGodBeastTalent","windowsPageGodbeastClass","windowsPageGodbeastPreview","windowsPageJgklSelect","windowsPageJiban","windowsPageLegionPlacard","windowsPageLegionSet","windowsPageLiangCao","windowsPageListCard","windowsPageListEquip","windowsPageListEquipSuit","windowsPageListGeneral","windowsPageManorLock","windowsPageMentor","windowsPageMountSkillChoice","windowsPageNameChange","windowsPageNorthBuff","windowsPageNoticeBingo","windowsPageNoticeLongbtn","windowsPageNoticeReap","windowsPageNoticeReward","windowsPageOccThalent","windowsPageOccThalentTotal","windowsPageOfficeRaised","windowsPageOfficeReward","windowsPageOfficeUp","windowsPageOnline","windowsPagePlayerLvUp","windowsPagePlotBoss","windowsPagePower","windowsPagePreview","windowsPageProperty","windowsPageQuickReward","windowsPageQxlb","windowsPageRechargeBounty","windowsPageRechargeBuy","windowsPageRechargeCZJJ","windowsPageRechargeVip","windowsPageRecommendReward","windowsPageRecommendStronger","windowsPageReplay","windowsPageReward","windowsPageRewardGeneral","windowsPageRewardList","windowsPageRewardPick","windowsPageRewardTips","windowsPageScoreRecruit","windowsPageSeasonTip","windowsPageSetnum","windowsPageShareChat","windowsPageShowGeneralList","windowsPageSiege","windowsPageSource","windowsPageStarRewards","windowsPageTalentSkill","windowsPageTalk","windowsPageTipsBook","windowsPageTipsBox","windowsPageTipsBuff","windowsPageTipsCamp","windowsPageTipsChoose","windowsPageTipsDetailed","windowsPageTipsEquip","windowsPageTipsExclus","windowsPageTipsGeneral","windowsPageTipsGodbeastHalo","windowsPageTipsGppvpSkill","windowsPageTipsHelp","windowsPageTipsHide","windowsPageTipsLegionLock","windowsPageTipsLegionStarcraft","windowsPageTipsLevel","windowsPageTipsLock","windowsPageTipsMountSkill","windowsPageTipsMsg","windowsPageTipsMsg2","windowsPageTipsOccu","windowsPageTipsProp","windowsPageTipsQxsy","windowsPageTipsRestrain","windowsPageTipsRewards","windowsPageTipsSkill","windowsPageTipsSoulStoneInfo","windowsPageTipsTalent","windowsPageTipsTreas","windowsPageTreasAwaken","windowsPageTreasAwakenSucc","windowsPageTreasReset","windowsPageTreasSelect","windowsPageTreasurePreview","windowsPageTurn","windowsPageUpgradeReady","windowsPageUpgradeSucc","windowsPageXYBZTipsSkill","windowsPageXybzMsg","windowsPageYdright","windowsPageZhanYi","windowsPageZhanYiBoss","windowsPageZhanYiExchange","windowsPageZhanYiMission","windowsPageZhengzhanNotice","windowsWait","wuhunListPage","wuhunSkillTipsPage","wuhunTianfuPage"]);